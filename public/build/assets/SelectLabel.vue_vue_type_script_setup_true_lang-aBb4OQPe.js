import{bt as T,eW as L,bs as B,bA as S,ci as H,bB as y,cB as E,co as w,cq as W,bE as g,fc as R,cn as I,fd as j,cu as q,cp as z,dv as F}from"./vendor-DgjuSLrY.js";import{u as x,i as A,b as V,d as N,T as O,F as P,e as U,f as D,g as G,h as J,M as K,k as Q}from"./vendor-tiptap-e7hIkjFs.js";import{M as X}from"./MermaidExtension-Dvf1XLzG.js";import{_ as Y}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{c as Z}from"./index-BevM4Rk7.js";const ee={class:"bg-background"},te=T({__name:"RichTextViewer",props:{content:{},showFontControls:{type:Boolean,default:!0},viewerClass:{default:"prose-sm"}},setup(b){const $=L(R),u=b,v=t=>t?(t=t.replace(/```mermaid\n?([\s\S]*?)```/g,(r,e)=>{const a=e.trim();return`<div data-mermaid data-mermaid-code="${a.replace(/&/g,"&amp;").replace(/"/g,"&quot;").replace(/</g,"&lt;").replace(/>/g,"&gt;")}" data-view-mode="diagram"><pre><code class="language-mermaid">${a}</code></pre></div>`}),t=t.replace(/``mermaid\n?([\s\S]*?)``/g,(r,e)=>{const a=e.trim();return`<div data-mermaid data-mermaid-code="${a.replace(/&/g,"&amp;").replace(/"/g,"&quot;").replace(/</g,"&lt;").replace(/>/g,"&gt;")}" data-view-mode="diagram"><pre><code class="language-mermaid">${a}</code></pre></div>`}),t=t.replace(/`mermaid\n([\s\S]*?)`/g,(r,e)=>{const a=e.trim();return`<div data-mermaid data-mermaid-code="${a.replace(/&/g,"&amp;").replace(/"/g,"&quot;").replace(/</g,"&lt;").replace(/>/g,"&gt;")}" data-view-mode="diagram"><pre><code class="language-mermaid">${a}</code></pre></div>`}),t):"",_=t=>t?(t=t.replace(/```(\w+)\n?([\s\S]*?)```/g,(r,e,a)=>`<pre><code class="language-${e}">${a.trim()}</code></pre>`),t=t.replace(/```\n?([\s\S]*?)```/g,(r,e)=>`<pre><code>${e.trim()}</code></pre>`),t):"",k=t=>{if(!t)return"";const r=t.split(`
`);let e=[],a=0;for(;a<r.length;){const s=r[a];if(s.includes("|")){const l=M(r,a);if(l.html){e.push(l.html),a=l.nextIndex;continue}}e.push(s),a++}return e.join(`
`)},M=(t,r)=>{let e=t[r];if(!e||!e.includes("|"))return{html:null,nextIndex:r+1};const a=e.split("|").map(c=>c.trim()).filter(c=>c.length>0);if(a.length===0)return{html:null,nextIndex:r+1};const s=t[r+1];if(!s||!s.includes("|")||!s.includes("-"))return{html:null,nextIndex:r+1};let l=[],h=r+2;for(;h<t.length;){const c=t[h];if(!c||!c.includes("|"))break;const m=c.split("|").map(n=>n.trim()).filter(n=>n.length>0);m.length>0&&l.push(m),h++}let o='<div class="tableWrapper"><table>';return o+="<thead><tr>",a.forEach(c=>{o+=`<th>${c}</th>`}),o+="</tr></thead>",l.length>0&&(o+="<tbody>",l.forEach(c=>{o+="<tr>";for(let m=0;m<a.length;m++){const n=c[m]||"";o+=`<td>${n}</td>`}o+="</tr>"}),o+="</tbody>"),o+="</table></div>",{html:o,nextIndex:h}},C=t=>{if(!t)return"";if(t.includes("<p>")||t.includes("<h1>")||t.includes("<h2>")||t.includes("<div>")){let s=v(t);return s=_(s),s}let e=t;return e=v(e),e=_(e),e=e.replace(/^#### (.*$)/gim,"<h4>$1</h4>"),e=e.replace(/^### (.*$)/gim,"<h3>$1</h3>"),e=e.replace(/^## (.*$)/gim,"<h2>$1</h2>"),e=e.replace(/^# (.*$)/gim,"<h1>$1</h1>"),e=e.replace(/\*\*(.*?)\*\*/g,"<strong>$1</strong>"),e=e.replace(/(?<!\*)\*([^*\n]+?)\*(?!\*)/g,"<em>$1</em>"),e=e.replace(/`([^`]+)`/g,"<code>$1</code>"),e=k(e),e.split(/\n\s*\n/).filter(s=>s.trim()).map(s=>{const l=s.trim();if(l.startsWith("<h1>")||l.startsWith("<h2>")||l.startsWith("<h3>")||l.startsWith("<h4>"))return l;if(l.includes(`
`)){const o=l.split(`
`).map(n=>n.trim()).filter(n=>n),c=o.some(n=>n.match(/^\d+\.\s/)),m=o.some(n=>n.match(/^[-*]\s/));if(c||m){const n=o.map(i=>i.match(/^\d+\.\s/)?`<li>${i.replace(/^\d+\.\s/,"")}</li>`:i.match(/^[-*]\s/)?`<li>${i.replace(/^[-*]\s/,"")}</li>`:i);let f=[],p="";for(const i of n)i.startsWith("<li>")?(p&&f.push(p),p=i):p&&(p=p.replace("</li>",` ${i}</li>`));return p&&f.push(p),c?`<ol>${f.join("")}</ol>`:`<ul>${f.join("")}</ul>`}}return`<p>${l.replace(/\n/g,"<br>")}</p>`}).join("")},d=x({content:C(u.content),editable:!1,extensions:[A.configure({heading:{levels:[1,2,3]},codeBlock:!1}),V.configure({lowlight:$,HTMLAttributes:{class:"code-block-highlighted"}}),N,O,P,U.configure({resizable:!0}),D,G,J,K.configure({katexOptions:{throwOnError:!1}}),X],editorProps:{attributes:{class:`prose dark:prose-invert max-w-none focus:outline-none ${u.viewerClass}`}}});return B("11.5"),S(()=>{setTimeout(()=>{d.value&&d.value.chain().selectAll().setFontSize("11.5pt").run()},100)}),H(()=>u.content,t=>{if(d.value&&d.value.getHTML()!==t){const r=C(t);d.value.commands.setContent(r)}}),y(()=>{d.value&&d.value.destroy()}),(t,r)=>(w(),E("div",ee,[W(g(Q),{editor:g(d)},null,8,["editor"])]))}}),oe=Y(te,[["__scopeId","data-v-8bb99980"]]),ce=T({__name:"SelectLabel",props:{for:{},asChild:{type:Boolean},as:{},class:{}},setup(b){const $=b;return(u,v)=>(w(),I(g(j),{"data-slot":"select-label",class:q(g(Z)("px-2 py-1.5 text-sm font-medium",$.class))},{default:z(()=>[F(u.$slots,"default")]),_:3},8,["class"]))}});export{oe as R,ce as _};
