import{d as z,c as y,o as b,F as t,L as A,K as a,u as o,w as v,M as k,H as w,B as _,b as I,n as T,N as P,U as E,a as V,a1 as X,f as F,a8 as j,O as Y,y as Z,af as M,P as R}from"./app-Bo97tXR7.js";import{c as J,_ as S}from"./index-D3d1G8kJ.js";import{_ as ee}from"./ChapterNavigation.vue_vue_type_script_setup_true_lang-Cevdd75t.js";import{_ as q}from"./index-DbvdGjWg.js";import{L as H}from"./lightbulb-m0fndsgY.js";import{X as N}from"./x-DxpWGJqH.js";import{_ as O,a as U,b as G}from"./CollapsibleTrigger.vue_vue_type_script_setup_true_lang--_YdoWkg.js";import{_ as te}from"./Progress.vue_vue_type_script_setup_true_lang-Bsdp52pg.js";import{_ as se}from"./Checkbox.vue_vue_type_script_setup_true_lang-Dhk72CqI.js";import{_ as L}from"./Separator.vue_vue_type_script_setup_true_lang-DQnO4z8s.js";import{T as B}from"./target-CpCoyHcO.js";import{C as K}from"./chevron-down-3G8i5M-G.js";import{L as ae}from"./loader-circle-Dg4GmgPT.js";import{C as W}from"./circle-check-BnkgVZ8x.js";import{C as oe}from"./circle-CJvr2xNP.js";import{t as C}from"./index-BxsHf2vm.js";import{W as ne,b as re}from"./useTextHistory-BD2S9UIX.js";import{S as ie}from"./sparkles-B00DqvF1.js";import{av as le,ap as de}from"./RichTextEditor-AU3K_MPZ.js";import{T as ce}from"./type-DTuina14.js";import{_ as ue}from"./DefensePreparationPanel.vue_vue_type_script_setup_true_lang-ynIORVIJ.js";import{_ as pe}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{u as Q}from"./index-BTMUG24f.js";/**
 * @license lucide-vue-next v0.468.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ge=J("BookmarkIcon",[["path",{d:"m19 21-7-4-7 4V5a2 2 0 0 1 2-2h10a2 2 0 0 1 2 2v16z",key:"1fy3hk"}]]),me={class:"bg-card/50 backdrop-blur-sm border rounded-xl p-4 shadow-sm transition-all hover:shadow-md"},fe={class:"flex items-start justify-between gap-4"},ve={class:"flex-1 space-y-3"},he={class:"flex items-center gap-2"},be={class:"p-1.5 rounded-md bg-primary/10 text-primary"},xe=["innerHTML"],ye={key:0,class:"pt-2 border-t border-border/50"},we={class:"text-xs text-amber-600 dark:text-amber-400 flex items-center gap-1.5"},_e={class:"flex flex-col gap-1"},Ce={class:"mt-4 flex justify-end"},Se=z({__name:"SmartSuggestionPanel",props:{suggestion:{},analysis:{}},emits:["save","clear","apply"],setup(h,{emit:d}){const i=h,e=d,l=(p=>({writing_guide:{label:"Writing Guide",variant:"default"},claims_without_evidence:{label:"Evidence Needed",variant:"destructive"},insufficient_citations:{label:"Add Citations",variant:"warning"},insufficient_tables:{label:"Add Data",variant:"secondary"},weak_arguments:{label:"Strengthen Arguments",variant:"warning"},insufficient_content:{label:"Expand Content",variant:"secondary"}})[p]||{label:p,variant:"default"})(i.suggestion.suggestion_type);return(p,r)=>(b(),y("div",me,[t("div",fe,[t("div",ve,[t("div",he,[t("div",be,[a(o(H),{class:"w-4 h-4"})]),r[3]||(r[3]=t("h3",{class:"font-semibold text-sm"},"Smart Suggestion",-1)),a(o(q),{variant:o(l).variant,class:"text-[10px] px-2 py-0.5 h-5"},{default:v(()=>[k(w(o(l).label),1)]),_:1},8,["variant"])]),t("div",{class:"prose prose-sm dark:prose-invert max-w-none text-sm text-muted-foreground leading-relaxed",innerHTML:p.suggestion.suggestion_content},null,8,xe),p.analysis&&p.analysis.detected_issues.length>0?(b(),y("div",ye,[t("p",we,[r[4]||(r[4]=t("span",{class:"w-1.5 h-1.5 rounded-full bg-amber-500"},null,-1)),k(" Issues: "+w(p.analysis.detected_issues.join(", ").replace(/_/g," ")),1)])])):A("",!0)]),t("div",_e,[a(o(S),{size:"icon",variant:"ghost",class:"h-7 w-7",onClick:r[0]||(r[0]=n=>e("clear")),title:"Dismiss"},{default:v(()=>[a(o(N),{class:"w-4 h-4"})]),_:1}),a(o(S),{size:"icon",variant:"ghost",class:"h-7 w-7",onClick:r[1]||(r[1]=n=>e("save")),title:"Save for later"},{default:v(()=>[a(o(ge),{class:"w-4 h-4"})]),_:1})])]),t("div",Ce,[a(o(S),{size:"sm",variant:"default",onClick:r[2]||(r[2]=n=>e("apply")),class:"w-full sm:w-auto"},{default:v(()=>[...r[5]||(r[5]=[k(" Apply Suggestion ",-1)])]),_:1})])]))}}),ke={class:"space-y-2"},$e={class:"flex items-center gap-3"},je={class:"flex flex-col items-start gap-1"},Te={key:0,class:"text-[10px] text-muted-foreground"},Le={key:0,class:"flex items-center justify-center py-8"},Ae={class:"space-y-2"},ze={class:"flex justify-between text-xs"},Ie={class:"text-muted-foreground"},Pe={class:"space-y-3"},Be={class:"flex items-center justify-between"},Ne={class:"text-sm font-semibold flex items-center gap-2"},Ee={class:"space-y-2"},Me=["onClick"],Re={key:0,class:"p-3 rounded-lg bg-blue-500/10 border border-blue-500/20"},We={class:"flex items-start gap-2"},De={class:"flex-1"},Fe={class:"text-xs leading-relaxed text-foreground"},qe={class:"space-y-3"},He={class:"text-sm font-semibold flex items-center gap-2"},Oe={class:"space-y-2"},Ue={key:2,class:"text-center py-8"},Ge=z({__name:"ProgressiveGuidancePanel",props:{guidance:{},isLoading:{type:Boolean}},emits:["toggleStep"],setup(h,{emit:d}){const i=h,e=d,c=_(!0),l=I(()=>{const n=i.guidance?.stage||"planning",u={planning:"bg-blue-500/10 text-blue-600 dark:text-blue-400",introduction:"bg-purple-500/10 text-purple-600 dark:text-purple-400",body_development:"bg-amber-500/10 text-amber-600 dark:text-amber-400",body_advanced:"bg-orange-500/10 text-orange-600 dark:text-orange-400",refinement:"bg-green-500/10 text-green-600 dark:text-green-400"};return u[n]||u.planning}),p=I(()=>i.guidance?i.guidance.next_steps.filter(n=>n.completed).length:0),r=I(()=>i.guidance?.next_steps.length||0);return(n,u)=>(b(),y("div",ke,[a(o(O),{open:c.value,"onUpdate:open":u[0]||(u[0]=g=>c.value=g),class:"space-y-2"},{default:v(()=>[a(o(U),{class:"flex w-full items-center justify-between rounded-xl p-4 hover:bg-accent/50 transition-colors duration-200 group"},{default:v(()=>[t("div",$e,[t("div",{class:T(["p-2 rounded-lg",l.value])},[a(o(B),{class:"h-4 w-4"})],2),t("div",je,[u[1]||(u[1]=t("span",{class:"text-sm font-semibold"},"Writing Progress",-1)),n.guidance?(b(),y("span",Te,w(n.guidance.stage_label),1)):A("",!0)])]),a(o(K),{class:T(["h-4 w-4 text-muted-foreground transition-transform duration-200",c.value?"rotate-180":""])},null,8,["class"])]),_:1}),a(o(G),{class:"space-y-4 px-4 pb-4"},{default:v(()=>[n.isLoading?(b(),y("div",Le,[a(o(ae),{class:"h-6 w-6 animate-spin text-muted-foreground"})])):n.guidance?(b(),y(P,{key:1},[t("div",Ae,[t("div",ze,[u[2]||(u[2]=t("span",{class:"font-medium text-foreground"},"Overall Progress",-1)),t("span",Ie,w(n.guidance.completion_percentage)+"% ",1)]),a(o(te),{"model-value":n.guidance.completion_percentage,class:"h-2"},null,8,["model-value"])]),a(o(L),{class:"bg-border/50"}),t("div",Pe,[t("div",Be,[t("h4",Ne,[a(o(W),{class:"h-4 w-4 text-primary"}),u[3]||(u[3]=k(" Next Steps ",-1))]),a(o(q),{variant:"secondary",class:"text-[10px] px-2 py-0.5"},{default:v(()=>[k(w(p.value)+" / "+w(r.value),1)]),_:1})]),t("div",Ee,[(b(!0),y(P,null,E(n.guidance.next_steps,g=>(b(),y("div",{key:g.id,class:"flex items-start gap-3 p-3 rounded-lg hover:bg-accent/30 transition-colors duration-200 cursor-pointer group",onClick:f=>e("toggleStep",g.id)},[a(o(se),{checked:g.completed,"onUpdate:checked":f=>e("toggleStep",g.id),class:"mt-0.5"},null,8,["checked","onUpdate:checked"]),t("span",{class:T(["text-xs leading-relaxed flex-1",g.completed?"line-through text-muted-foreground":"text-foreground"])},w(g.text),3)],8,Me))),128))])]),n.guidance.contextual_tip?(b(),y("div",Re,[t("div",We,[a(o(H),{class:"h-4 w-4 text-blue-600 dark:text-blue-400 mt-0.5 flex-shrink-0"}),t("div",De,[t("p",Fe,w(n.guidance.contextual_tip),1)])])])):A("",!0),a(o(L),{class:"bg-border/50"}),t("div",qe,[t("h4",He,[a(o(B),{class:"h-4 w-4 text-primary"}),u[4]||(u[4]=k(" Milestones ",-1))]),t("div",Oe,[(b(!0),y(P,null,E(n.guidance.writing_milestones,g=>(b(),y("div",{key:g.id,class:"flex items-center gap-3 p-2 rounded-lg"},[(b(),V(X(g.completed?o(W):o(oe)),{class:T(["h-4 w-4",g.completed?"text-green-600 dark:text-green-400":"text-muted-foreground"])},null,8,["class"])),t("span",{class:T(["text-xs",g.completed?"text-foreground font-medium":"text-muted-foreground"])},w(g.label),3)]))),128))])])],64)):(b(),y("div",Ue,[a(o(B),{class:"h-12 w-12 mx-auto text-muted-foreground/50 mb-3"}),u[5]||(u[5]=t("p",{class:"text-sm text-muted-foreground"}," Start writing to get personalized guidance ",-1))]))]),_:1})]),_:1},8,["open"])]))}}),Ke={class:"space-y-2"},Qe={class:"flex items-center gap-3"},Ve={class:"p-2 rounded-lg bg-purple-500/10 text-purple-600 dark:text-purple-400"},Xe={class:"grid grid-cols-2 gap-2"},Ye={class:"p-1.5 rounded-full bg-blue-500/10 text-blue-500"},Ze={class:"text-xs font-medium"},Je={class:"p-1.5 rounded-full bg-purple-500/10 text-purple-500"},et={class:"text-xs font-medium"},tt={class:"p-1.5 rounded-full bg-orange-500/10 text-orange-500"},st={class:"text-xs font-medium"},at={class:"p-1.5 rounded-full bg-emerald-500/10 text-emerald-500"},ot={class:"text-xs font-medium"},nt=z({__name:"QuickActionsPanel",props:{projectSlug:{},chapterNumber:{},selectedText:{},isProcessing:{type:Boolean}},emits:["textImproved","textExpanded","citationsSuggested","textRephrased"],setup(h,{emit:d}){const i=h,e=d,c=_(!0),l=_({improve:!1,expand:!1,cite:!1,rephrase:!1}),p=async r=>{if(!i.selectedText&&(r==="expand"||r==="rephrase")){C.error("Please select some text first");return}l.value[r]=!0;try{let n="",u;switch(r){case"improve":n="projects.manual-editor.improve-text",u="textImproved";break;case"expand":n="projects.manual-editor.expand-text",u="textExpanded";break;case"cite":n="projects.manual-editor.suggest-citations",u="citationsSuggested";break;case"rephrase":n="projects.manual-editor.rephrase-text",u="textRephrased";break}const g=await fetch(route(n,{project:i.projectSlug,chapter:i.chapterNumber}),{method:"POST",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":document.querySelector('meta[name="csrf-token"]')?.content||""},body:JSON.stringify({text:i.selectedText})});if(!g.ok)throw new Error("Failed to process request");const f=await g.json();r==="improve"&&f.improvedText?(e("textImproved",f.improvedText),C.success("Text improved successfully!")):r==="expand"&&f.expandedText?(e("textExpanded",f.expandedText),C.success("Text expanded successfully!")):r==="cite"&&f.suggestions?(e("citationsSuggested",f.suggestions),C.success("Citation suggestions generated!")):r==="rephrase"&&f.alternatives&&(e("textRephrased",f.alternatives),C.success("Alternative phrasings generated!"))}catch(n){console.error(`Failed to ${r} text:`,n),C.error(`Failed to ${r} text. Please try again.`)}finally{l.value[r]=!1}};return(r,n)=>(b(),y("div",Ke,[a(o(O),{open:c.value,"onUpdate:open":n[4]||(n[4]=u=>c.value=u),class:"space-y-2"},{default:v(()=>[a(o(U),{class:"flex w-full items-center justify-between rounded-xl p-4 hover:bg-accent/50 transition-colors duration-200 group"},{default:v(()=>[t("div",Qe,[t("div",Ve,[a(o(ne),{class:"h-4 w-4"})]),n[5]||(n[5]=t("div",{class:"flex flex-col items-start gap-1"},[t("span",{class:"text-sm font-semibold"},"Quick Actions"),t("span",{class:"text-[10px] text-muted-foreground"}," AI-powered writing tools ")],-1))]),a(o(K),{class:T(["h-4 w-4 text-muted-foreground transition-transform duration-200",c.value?"rotate-180":""])},null,8,["class"])]),_:1}),a(o(G),{class:"space-y-4 px-4 pb-4"},{default:v(()=>[t("div",Xe,[a(o(S),{onClick:n[0]||(n[0]=u=>p("improve")),disabled:r.isProcessing||l.value.improve,variant:"outline",class:"h-20 flex-col gap-2 rounded-xl border-border/50 bg-background/50 hover:bg-accent hover:border-accent transition-all duration-300"},{default:v(()=>[t("div",Ye,[a(o(ie),{class:"h-4 w-4"})]),t("span",Ze,w(l.value.improve?"Improving...":"Improve"),1)]),_:1},8,["disabled"]),a(o(S),{onClick:n[1]||(n[1]=u=>p("expand")),disabled:!r.selectedText||r.isProcessing||l.value.expand,variant:"outline",class:"h-20 flex-col gap-2 rounded-xl border-border/50 bg-background/50 hover:bg-accent hover:border-accent transition-all duration-300"},{default:v(()=>[t("div",Je,[a(o(le),{class:"h-4 w-4"})]),t("span",et,w(l.value.expand?"Expanding...":"Expand"),1)]),_:1},8,["disabled"]),a(o(S),{onClick:n[2]||(n[2]=u=>p("cite")),disabled:r.isProcessing||l.value.cite,variant:"outline",class:"h-20 flex-col gap-2 rounded-xl border-border/50 bg-background/50 hover:bg-accent hover:border-accent transition-all duration-300"},{default:v(()=>[t("div",tt,[a(o(de),{class:"h-4 w-4"})]),t("span",st,w(l.value.cite?"Citing...":"Cite"),1)]),_:1},8,["disabled"]),a(o(S),{onClick:n[3]||(n[3]=u=>p("rephrase")),disabled:!r.selectedText||r.isProcessing||l.value.rephrase,variant:"outline",class:"h-20 flex-col gap-2 rounded-xl border-border/50 bg-background/50 hover:bg-accent hover:border-accent transition-all duration-300"},{default:v(()=>[t("div",at,[a(o(ce),{class:"h-4 w-4"})]),t("span",ot,w(l.value.rephrase?"Rephrasing...":"Rephrase"),1)]),_:1},8,["disabled"])]),n[6]||(n[6]=t("div",{class:"p-3 rounded-lg bg-muted/50 border border-border/50"},[t("p",{class:"text-[10px] text-muted-foreground leading-relaxed"},[t("strong",null,"Tip:"),k(" Select text before using Expand or Rephrase. Improve and Cite work on your entire content. ")])],-1))]),_:1})]),_:1},8,["open"])]))}}),rt={key:0,class:"fixed inset-0 z-50 lg:hidden"},it={class:"fixed top-0 left-0 h-full w-80 overflow-y-auto border-r bg-background shadow-xl transform transition-transform"},lt={class:"border-b p-3"},dt={class:"flex items-center justify-between"},ct={class:"space-y-4 p-4 mobile-enhanced"},ut={key:0,class:"fixed inset-0 z-50 lg:hidden"},pt={class:"fixed top-0 right-0 h-full w-96 overflow-y-auto border-l bg-background shadow-xl transform transition-transform"},gt={class:"border-b p-3"},mt={class:"flex items-center justify-between"},ft={class:"space-y-4 p-4 mobile-enhanced"},vt={key:0,class:"space-y-2"},ht=z({__name:"MobileNavOverlay",props:{showLeftSidebar:{type:Boolean},showRightSidebar:{type:Boolean},isMobile:{type:Boolean},allChapters:{},currentChapter:{},project:{},facultyChapters:{},currentWordCount:{},targetWordCount:{},chapterContentLength:{},selectedText:{},isAnalyzing:{type:Boolean},isSaving:{type:Boolean},currentSuggestion:{},currentAnalysis:{},guidance:{},isLoadingGuidance:{type:Boolean},chapterContent:{},showCitationHelper:{type:Boolean}},emits:["update:showLeftSidebar","update:showRightSidebar","update:showCitationHelper","goToChapter","generateNextChapter","deleteChapter","saveSuggestion","clearSuggestion","applySuggestion","toggleStep","textImproved","textExpanded","citationsSuggested","textRephrased","insertCitation"],setup(h,{emit:d}){const i=h,e=d,c=_(!0),l=_(i.showCitationHelper);F(()=>i.showCitationHelper,s=>{l.value=s});const p=()=>e("update:showLeftSidebar",!1),r=()=>e("update:showRightSidebar",!1),n=s=>{l.value=s,e("update:showCitationHelper",s)},u=s=>{e("goToChapter",s),p()},g=()=>e("generateNextChapter"),f=s=>e("deleteChapter",s),$=s=>e("insertCitation",s);return(s,m)=>(b(),y("div",null,[a(j,{"enter-active-class":"duration-300 ease-out","enter-from-class":"opacity-0","enter-to-class":"opacity-100","leave-active-class":"duration-200 ease-in","leave-from-class":"opacity-100","leave-to-class":"opacity-0"},{default:v(()=>[s.showLeftSidebar&&s.isMobile?(b(),y("div",rt,[a(j,{"enter-active-class":"duration-300 ease-out","enter-from-class":"opacity-0","enter-to-class":"opacity-100","leave-active-class":"duration-200 ease-in","leave-from-class":"opacity-100","leave-to-class":"opacity-0"},{default:v(()=>[t("div",{class:"fixed inset-0 bg-black/50",onClick:p})]),_:1}),a(j,{"enter-active-class":"duration-300 ease-out","enter-from-class":"-translate-x-full","enter-to-class":"translate-x-0","leave-active-class":"duration-200 ease-in","leave-from-class":"translate-x-0","leave-to-class":"-translate-x-full"},{default:v(()=>[t("div",it,[t("div",lt,[t("div",dt,[m[10]||(m[10]=t("h2",{class:"text-base font-semibold"},"Table of Contents",-1)),a(o(S),{onClick:p,variant:"ghost",size:"sm",class:"h-8 w-8"},{default:v(()=>[a(o(N),{class:"h-4 w-4"})]),_:1})])]),t("div",ct,[a(ee,{"all-chapters":s.allChapters,"current-chapter":s.currentChapter,project:s.project,outlines:s.project.outlines||[],"faculty-chapters":s.facultyChapters||[],"current-word-count":s.currentWordCount,"target-word-count":s.targetWordCount,"writing-quality-score":0,"chapter-content-length":s.chapterContentLength,onGoToChapter:u,onGenerateNextChapter:g,onDeleteChapter:f},null,8,["all-chapters","current-chapter","project","outlines","faculty-chapters","current-word-count","target-word-count","chapter-content-length"])])])]),_:1})])):A("",!0)]),_:1}),a(j,{"enter-active-class":"duration-300 ease-out","enter-from-class":"opacity-0","enter-to-class":"opacity-100","leave-active-class":"duration-200 ease-in","leave-from-class":"opacity-100","leave-to-class":"opacity-0"},{default:v(()=>[s.showRightSidebar&&s.isMobile?(b(),y("div",ut,[a(j,{"enter-active-class":"duration-300 ease-out","enter-from-class":"opacity-0","enter-to-class":"opacity-100","leave-active-class":"duration-200 ease-in","leave-from-class":"opacity-100","leave-to-class":"opacity-0"},{default:v(()=>[t("div",{class:"fixed inset-0 bg-black/50",onClick:r})]),_:1}),a(j,{"enter-active-class":"duration-300 ease-out","enter-from-class":"translate-x-full","enter-to-class":"translate-x-0","leave-active-class":"duration-200 ease-in","leave-from-class":"translate-x-0","leave-to-class":"translate-x-full"},{default:v(()=>[t("div",pt,[t("div",gt,[t("div",mt,[m[11]||(m[11]=t("h2",{class:"text-base font-semibold"},"AI Tools",-1)),a(o(S),{onClick:r,variant:"ghost",size:"sm",class:"h-8 w-8"},{default:v(()=>[a(o(N),{class:"h-4 w-4"})]),_:1})])]),t("div",ft,[s.currentSuggestion?(b(),y("div",vt,[a(Se,{suggestion:s.currentSuggestion,analysis:s.currentAnalysis,onSave:m[0]||(m[0]=x=>s.$emit("saveSuggestion",x)),onClear:m[1]||(m[1]=x=>s.$emit("clearSuggestion")),onApply:m[2]||(m[2]=x=>s.$emit("applySuggestion"))},null,8,["suggestion","analysis"]),a(o(L),{class:"bg-border/50"})])):A("",!0),a(Ge,{guidance:s.guidance,"is-loading":s.isLoadingGuidance,onToggleStep:m[3]||(m[3]=x=>s.$emit("toggleStep",x))},null,8,["guidance","is-loading"]),a(o(L),{class:"bg-border/50"}),a(nt,{"project-slug":s.project.slug,"chapter-number":s.currentChapter.chapter_number,"selected-text":s.selectedText,"is-processing":s.isAnalyzing||s.isSaving,onTextImproved:m[4]||(m[4]=x=>s.$emit("textImproved",x)),onTextExpanded:m[5]||(m[5]=x=>s.$emit("textExpanded",x)),onCitationsSuggested:m[6]||(m[6]=x=>s.$emit("citationsSuggested",x)),onTextRephrased:m[7]||(m[7]=x=>s.$emit("textRephrased",x))},null,8,["project-slug","chapter-number","selected-text","is-processing"]),a(o(L),{class:"bg-border/50"}),a(re,{"show-citation-helper":l.value,"onUpdate:showCitationHelper":[m[8]||(m[8]=x=>l.value=x),n],"chapter-content":s.chapterContent,onInsertCitation:$},null,8,["show-citation-helper","chapter-content"]),a(o(L),{class:"bg-border/50"}),a(ue,{"show-defense-prep":c.value,"onUpdate:showDefensePrep":m[9]||(m[9]=x=>c.value=x),questions:[],"is-loading":!1,"is-generating":!1,"chapter-context":{project:s.project,chapter:s.currentChapter,wordCount:s.currentWordCount},onGenerateMore:()=>{},onRefresh:()=>{}},null,8,["show-defense-prep","chapter-context"])])])]),_:1})])):A("",!0)]),_:1})]))}}),Ft=pe(ht,[["__scopeId","data-v-081ef745"]]);function qt(h,d){const i=_(h.content||""),e=_(!1),c=_(!1),l=_(null),p=s=>{i.value=s,e.value=!0,n()},r=async()=>{if(!(!e.value||c.value)){c.value=!0;try{await M.post(R("projects.manual-editor.save",{project:d,chapter:h.chapter_number}),{content:i.value}),e.value=!1,l.value=new Date().toLocaleTimeString()}catch(s){throw console.error("Failed to save chapter:",s),s}finally{c.value=!1}}},n=Q(r,2e3),u=async()=>{if(!c.value){c.value=!0;try{return await M.post(R("projects.manual-editor.save",{project:d,chapter:h.chapter_number}),{content:i.value}),e.value=!1,l.value=new Date().toLocaleTimeString(),!0}catch(s){throw console.error("Failed to save chapter:",s),s}finally{c.value=!1}}},g=s=>{e.value&&(s.preventDefault(),s.returnValue="")},f=s=>{e.value&&!confirm("You have unsaved changes. Are you sure you want to leave?")&&s.preventDefault()};window.addEventListener("beforeunload",g);const $=Y.on("before",f);return Z(()=>{window.removeEventListener("beforeunload",g),$(),e.value&&r()}),{content:i,isDirty:e,isSaving:c,lastSaved:l,updateContent:p,save:r,manualSave:u}}class D{static analyze(d){const e=new DOMParser().parseFromString(d,"text/html");return{word_count:this.countWords(e),citation_count:this.countCitations(e),table_count:this.countTables(e),figure_count:this.countFigures(e),claim_count:this.countClaims(e),has_introduction:this.hasIntroduction(e),has_conclusion:this.hasConclusion(e),detected_issues:this.detectIssues(e),quality_metrics:this.calculateQualityMetrics(e)}}static countWords(d){return(d.body.textContent||"").trim().split(/\s+/).filter(e=>e.length>0).length}static countCitations(d){const i=d.body.textContent||"",e=[/\([A-Z][a-z]+,?\s+\d{4}\)/g,/\[[0-9]+\]/g,/\([A-Z][a-z]+\s+et al\.,?\s+\d{4}\)/g];let c=0;return e.forEach(l=>{const p=i.match(l);p&&(c+=p.length)}),c+=d.querySelectorAll("cite, [data-citation]").length,c}static countTables(d){return d.querySelectorAll("table").length}static countFigures(d){return d.querySelectorAll("img, figure").length}static countClaims(d){const e=(d.body.textContent||"").split(/[.!?]+/),c=["demonstrates","proves","shows","indicates","reveals","confirms","establishes","suggests","implies","evidences"];return e.filter(l=>c.some(p=>l.toLowerCase().includes(p))).length}static hasIntroduction(d){const i=(d.body.textContent||"").toLowerCase();return["introduction","background","overview"].some(c=>i.includes(c))}static hasConclusion(d){const i=(d.body.textContent||"").toLowerCase();return["conclusion","summary","in summary"].some(c=>i.includes(c))}static detectIssues(d){const i=[],e=d.body.textContent||"",c=this.countClaims(d),l=this.countCitations(d);return c>0&&l===0&&i.push("claims_without_evidence"),c>l*2&&i.push("insufficient_citations"),e.toLowerCase().includes("methodology")&&this.countTables(d)===0&&i.push("insufficient_tables"),["maybe","might","could possibly","seems to"].some(g=>e.toLowerCase().includes(g))&&c>3&&i.push("weak_arguments"),this.countWords(d)<100&&i.push("insufficient_content"),i}static calculateQualityMetrics(d){const e=(d.body.textContent||"").split(/[.!?]+/).filter(p=>p.trim().length>0),c=d.querySelectorAll("p").length,l=e.length>0?this.countWords(d)/e.length:0;return{avg_sentence_length:Math.round(l),paragraph_count:c,reading_level:l>25?"complex":l>15?"moderate":"simple"}}}function Ht(h,d,i){const e=_(d),c=_(null),l=_(!1),r=Q(async()=>{if(!(i.value.length<100)){l.value=!0;try{const f=D.analyze(i.value);if(c.value=f,f.detected_issues.length===0){l.value=!1;return}const $=await axios.post(route("projects.manual-editor.analyze",{project:h.project.slug,chapter:h.id}),{analysis:f});$.data.suggestion&&(e.value=$.data.suggestion)}catch(f){console.error("Failed to analyze and request suggestion:",f)}finally{l.value=!1}}},5e3);return F(i,()=>{i.value.length>0&&(c.value=D.analyze(i.value)),r()}),{currentSuggestion:e,currentAnalysis:c,isAnalyzing:l,saveSuggestion:async()=>{if(e.value)try{await axios.post(route("projects.manual-editor.suggestion.save",{project:h.project.slug,chapter:h.id,suggestion:e.value.id})),C("Suggestion saved",{description:"You can refer to this suggestion later."})}catch{C("Failed to save suggestion",{description:"Please try again."})}},clearSuggestion:async()=>{if(e.value)try{await axios.post(route("projects.manual-editor.suggestion.clear",{project:h.project.slug,chapter:h.id,suggestion:e.value.id})),e.value=null}catch{C("Failed to clear suggestion",{description:"Please try again."})}},applySuggestion:async()=>{if(e.value)try{await axios.post(route("projects.manual-editor.suggestion.apply",{project:h.project.slug,chapter:h.id,suggestion:e.value.id})),C("Suggestion applied",{description:"The suggestion has been marked as applied."}),e.value=null}catch{C("Failed to apply suggestion",{description:"Please try again."})}}}}export{Ft as M,nt as _,Ht as a,Ge as b,Se as c,qt as u};
