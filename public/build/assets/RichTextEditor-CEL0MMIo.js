import{bu as Oe,bt as h,ck as F,bB as Be,cS as Ft,cn as ie,co as T,cp as i,cr as d,cD as I,cI as P,cu as y,ct as V,bF as t,fa as Bt,fb as Wt,fc as Ot,d0 as me,ci as ne,bC as tt,cq as a,cw as Ke,dW as Nt,cx as qt,eF as at,fd as jt,cT as We,cO as rt,fe as st,ff as ot,cs as b,cQ as nt,dQ as Gt,cb as lt,aP as it,aQ as dt,bO as Xt,bN as Yt,fg as Kt,bE as Fe,fh as Qt,fi as Jt,fj as Zt,fk as ea,fl as ta,dH as aa,fm as ra,fn as sa,fo as oa,fp as na,fq as la,eo as ia,fr as da,cP as ua,fs as ca,dJ as ga,ft as fa,fu as ma,fv as pa,fw as va,cH as ha,di as xa,fx as ba,fy as ya}from"./vendor-B5jlBrgV.js";import{N as ut,a as ct,V as gt,m as ft,E as mt,i as wa,b as ka,c as Ca,d as Ta,T as za,C as Aa,H as Sa,L as Ma,e as _a,f as $a,g as La,h as Ea,j as Ra,u as Ha,k as Ia}from"./vendor-tiptap-CeHW2ROA.js";import{_ as Va}from"./Progress.vue_vue_type_script_setup_true_lang-DwlWDfQ5.js";import{_ as Ne}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{M as Da}from"./MermaidExtension-LU-z_FW5.js";import{_ as v}from"./index-D4mJyiz8.js";import{_ as le}from"./Input.vue_vue_type_script_setup_true_lang-xMT9dCF9.js";import{_ as $e,a as Le}from"./DialogContent.vue_vue_type_script_setup_true_lang-DATQht2f.js";import{_ as Ee}from"./DialogDescription.vue_vue_type_script_setup_true_lang-DsP71UmP.js";import{_ as Re}from"./DialogFooter.vue_vue_type_script_setup_true_lang-B5lGGt-M.js";import{_ as He,a as Ie}from"./DialogTitle.vue_vue_type_script_setup_true_lang-Cb9j7AhV.js";import{_ as fe}from"./Label.vue_vue_type_script_setup_true_lang-BlhK8lFl.js";import{_ as Qe,a as Je,c as q,d as _e,e as Ze}from"./Sonner.vue_vue_type_script_setup_true_lang-sxjlERgN.js";const Pa={class:"space-y-2"},Ua={class:"font-semibold text-sm"},Fa={key:0,class:"text-xs text-gray-600 dark:text-gray-300"},Ba={class:"flex items-center space-x-2 text-xs"},Wa={key:0,class:"text-gray-500"},Oa={key:1,class:"text-xs text-blue-600 dark:text-blue-400"},Na={class:"flex space-x-2 pt-2 border-t"},qa=Oe({__name:"CitationNodeView",props:{node:{type:Object,required:!0},editor:{type:Object,required:!0},getPos:{type:Function,required:!0},updateAttributes:{type:Function,required:!0}},emits:["verify","edit","remove"],setup(l,{emit:n}){const f=l,k=n,m=h(!1),z=h({top:"0px",left:"0px"}),U=F(()=>f.node.attrs.text||"[Citation]"),C=F(()=>f.node.attrs.verified===!1&&f.node.attrs.confidence<.8),S=F(()=>({"citation-verified":f.node.attrs.verified,"citation-unverified":C.value,"citation-pending":!f.node.attrs.verified&&!C.value})),M=F(()=>f.node.attrs.verified?"bg-green-100 dark:bg-green-900 text-green-800 dark:text-green-200 border border-green-300 dark:border-green-700":C.value?"bg-red-100 dark:bg-red-900 text-red-800 dark:text-red-200 border border-red-300 dark:border-red-700":"bg-yellow-100 dark:bg-yellow-900 text-yellow-800 dark:text-yellow-200 border border-yellow-300 dark:border-yellow-700"),B=F(()=>f.node.attrs.verified?"text-green-600 dark:text-green-400":C.value?"text-red-600 dark:text-red-400":"text-yellow-600 dark:text-yellow-400"),W=F(()=>f.node.attrs.verified?"Verified":C.value?"Needs Review":"Pending"),X=F(()=>f.node.attrs.verified?"bg-green-100 dark:bg-green-900 text-green-800 dark:text-green-200":C.value?"bg-red-100 dark:bg-red-900 text-red-800 dark:text-red-200":"bg-yellow-100 dark:bg-yellow-900 text-yellow-800 dark:text-yellow-200"),O=w=>{if(w.stopPropagation(),m.value)L();else{const de=w.target.getBoundingClientRect();z.value={top:`${de.height+5}px`,left:"0px"},m.value=!0}},L=()=>{m.value=!1},ee=async()=>{try{const w=await axios.post("/api/citations/verify",{citation_id:f.node.attrs.id,citation_text:f.node.attrs.text});w.data.verified&&f.updateAttributes({verified:!0,confidence:w.data.confidence,data:w.data.citation,doi:w.data.citation.doi}),k("verify",w.data),L()}catch(w){console.error("Failed to verify citation:",w)}},Y=()=>{k("edit",{id:f.node.attrs.id,text:f.node.attrs.text,attributes:f.node.attrs}),L()},r=()=>{if(confirm("Are you sure you want to remove this citation?")){const w=f.getPos();f.editor.commands.deleteRange({from:w,to:w+1}),k("remove",f.node.attrs.id)}L()},te=w=>{w.key==="Enter"||w.key===" "?(w.preventDefault(),O(w)):w.key==="Escape"&&L()};return Be(()=>{document.addEventListener("keydown",te)}),Ft(()=>{document.removeEventListener("keydown",te)}),(w,de)=>(T(),ie(t(ut),{class:y(["citation-node inline-block relative cursor-pointer",S.value]),onClick:O},{default:i(()=>[d("span",{class:y(["citation-text px-2 py-1 rounded text-sm font-medium transition-all duration-200",M.value])},V(U.value),3),d("span",{class:y(["verification-indicator ml-1",B.value])},[l.node.attrs.verified?(T(),ie(t(Bt),{key:0,class:"w-3 h-3"})):C.value?(T(),ie(t(Wt),{key:1,class:"w-3 h-3"})):(T(),ie(t(Ot),{key:2,class:"w-3 h-3"}))],2),m.value?(T(),I("div",{key:0,class:"citation-popover absolute z-50 mt-2 p-4 bg-white dark:bg-gray-800 rounded-lg shadow-lg border max-w-sm",style:me(z.value)},[d("div",Pa,[d("div",Ua,V(l.node.attrs.text||"[Citation]"),1),l.node.attrs.data&&l.node.attrs.data.title?(T(),I("div",Fa,V(l.node.attrs.data.title),1)):P("",!0),d("div",Ba,[d("span",{class:y(["px-2 py-1 rounded",X.value])},V(W.value),3),l.node.attrs.confidence?(T(),I("span",Wa,V(Math.round(l.node.attrs.confidence*100))+"% confidence ",1)):P("",!0)]),l.node.attrs.doi?(T(),I("div",Oa," DOI: "+V(l.node.attrs.doi),1)):P("",!0),d("div",Na,[l.node.attrs.verified?P("",!0):(T(),I("button",{key:0,onClick:ee,class:"text-xs px-2 py-1 bg-blue-600 text-white rounded hover:bg-blue-700"}," Verify ")),d("button",{onClick:Y,class:"text-xs px-2 py-1 bg-gray-600 text-white rounded hover:bg-gray-700"}," Edit "),d("button",{onClick:r,class:"text-xs px-2 py-1 bg-red-600 text-white rounded hover:bg-red-700"}," Remove ")])])],4)):P("",!0),m.value?(T(),I("div",{key:1,class:"fixed inset-0 z-40",onClick:L})):P("",!0)]),_:1},8,["class"]))}}),ja=Ne(qa,[["__scopeId","data-v-4fc4981e"]]),Ga=ct.create({name:"citation",group:"inline",inline:!0,atom:!0,addAttributes(){return{id:{default:null},text:{default:""},verified:{default:!1},confidence:{default:0},format:{default:"apa"},doi:{default:null},data:{default:{}}}},parseHTML(){return[{tag:"span[data-citation]"}]},renderHTML({HTMLAttributes:l}){return["span",ft(l,{"data-citation":""})]},addNodeView(){return gt(ja)},addCommands(){return{insertCitation:l=>({commands:n})=>n.insertContent({type:this.name,attrs:l}),updateCitation:(l,n)=>({state:f,dispatch:k})=>{const{doc:m,tr:z}=f;let U=!1;return m.descendants((C,S)=>{if(C.type.name===this.name&&C.attrs.id===l)return z.setNodeMarkup(S,null,{...C.attrs,...n}),U=!0,!1}),U?(k(z),!0):!1}}},addKeyboardShortcuts(){return{"Mod-Shift-c":()=>this.editor.commands.insertCitation({text:"[Citation]",verified:!1})}}}),Xa={class:"text-muted-foreground text-xs mt-1 truncate max-w-full"},Ya=["src","alt","title"],Ka={key:2,class:"mt-2 w-full"},Qa={key:3,class:"mt-2 text-center text-sm text-muted-foreground italic"},Ja={key:5,class:"absolute -top-12 left-1/2 -translate-x-1/2 flex items-center gap-1.5 px-3 py-1.5 bg-background/95 backdrop-blur-md rounded-lg border border-border shadow-lg z-10 min-w-max"},Za={class:"text-xs text-muted-foreground whitespace-nowrap"},er={class:"grid gap-4 py-4"},tr={class:"grid gap-2"},ar={class:"grid gap-2"},rr=Oe({__name:"ImageNodeView",props:{node:{},updateAttributes:{type:Function},deleteNode:{type:Function},selected:{type:Boolean},editor:{}},setup(l){const n=l,f=h(null),k=h(null),m=h(!1),z=h(null),U=h(0),C=h(0),S=h(0),M=h(0),B=h(n.node.attrs.width||400),W=h(n.node.attrs.height||300),X=h(!0),O=h(!1),L=h(!1),ee=h(""),Y=h(""),r=h(n.node.attrs.caption||""),te=F(()=>{switch(n.node.attrs.alignment){case"left":return"mr-auto";case"right":return"ml-auto";default:return"mx-auto"}}),w=F(()=>({width:`${B.value}px`,height:`${W.value}px`,maxWidth:"100%"})),de=()=>{if(X.value=!1,O.value=!1,f.value&&!n.node.attrs.width){const p=f.value.naturalWidth,o=f.value.naturalHeight,c=600;if(p>c){const N=c/p;B.value=c,W.value=Math.round(o*N)}else B.value=p,W.value=o;n.updateAttributes({width:B.value,height:W.value,aspectRatio:p/o})}},pe=()=>{X.value=!1,O.value=!0},_=(p,o)=>{if(!n.selected)return;o.preventDefault(),o.stopPropagation(),m.value=!0,z.value=p;const c="touches"in o?o.touches[0].clientX:o.clientX,N="touches"in o?o.touches[0].clientY:o.clientY;U.value=c,C.value=N,S.value=B.value,M.value=W.value,document.addEventListener("mousemove",K),document.addEventListener("mouseup",Q),document.addEventListener("touchmove",K),document.addEventListener("touchend",Q)},K=p=>{if(!m.value)return;const o="touches"in p?p.touches[0].clientX:p.clientX,c="touches"in p?p.touches[0].clientY:p.clientY,N=o-U.value,he=c-C.value,xe=n.node.attrs.aspectRatio||S.value/M.value,re=z.value;let G=S.value,J=M.value;re?.includes("e")&&(G=Math.max(100,S.value+N)),re?.includes("w")&&(G=Math.max(100,S.value-N)),re?.includes("s")&&(J=Math.max(100,M.value+he)),re?.includes("n")&&(J=Math.max(100,M.value-he)),re?.length===2&&(Math.abs(N)>Math.abs(he)?J=Math.round(G/xe):G=Math.round(J*xe));const Te=800;G>Te&&(G=Te,J=Math.round(G/xe)),B.value=G,W.value=J},Q=()=>{m.value&&(m.value=!1,z.value=null,n.updateAttributes({width:B.value,height:W.value}),document.removeEventListener("mousemove",K),document.removeEventListener("mouseup",Q),document.removeEventListener("touchmove",K),document.removeEventListener("touchend",Q))},ve=p=>{n.updateAttributes({alignment:p})},Ve=()=>{ee.value=n.node.attrs.alt||"",Y.value=n.node.attrs.title||"",L.value=!0},De=()=>{n.updateAttributes({alt:ee.value,title:Y.value}),L.value=!1},Ce=()=>{n.updateAttributes({caption:r.value})},ae=async()=>{const p=n.node.attrs.src;if(p&&p.startsWith("/storage/"))try{await lt.delete("/editor/images",{data:{url:p}})}catch(o){console.warn("Failed to delete image from storage:",o)}n.deleteNode()};return ne(()=>n.node.attrs.caption,p=>{p!==r.value&&(r.value=p||"")}),ne(()=>[n.node.attrs.width,n.node.attrs.height],([p,o])=>{p&&!m.value&&(B.value=p),o&&!m.value&&(W.value=o)},{immediate:!0}),tt(()=>{document.removeEventListener("mousemove",K),document.removeEventListener("mouseup",Q),document.removeEventListener("touchmove",K),document.removeEventListener("touchend",Q)}),(p,o)=>(T(),ie(t(ut),{class:"resizable-image-wrapper my-4"},{default:i(()=>[d("figure",{ref_key:"containerRef",ref:k,class:y(["relative inline-block",[te.value,{"ring-2 ring-primary ring-offset-2":p.selected}]])},[X.value?(T(),I("div",{key:0,class:"flex items-center justify-center bg-muted/50 rounded-lg",style:me(w.value)},[a(t(Nt),{class:"w-8 h-8 animate-spin text-muted-foreground"})],4)):O.value?(T(),I("div",{key:1,class:"flex flex-col items-center justify-center bg-destructive/10 border border-destructive/30 rounded-lg p-4",style:me(w.value)},[o[24]||(o[24]=d("span",{class:"text-destructive text-sm"},"Failed to load image",-1)),d("span",Xa,V(p.node.attrs.src),1)],4)):P("",!0),Ke(d("img",{ref_key:"imageRef",ref:f,src:p.node.attrs.src,alt:p.node.attrs.alt,title:p.node.attrs.title,style:me(w.value),class:y(["block rounded-lg object-contain",{"cursor-move":p.selected}]),onLoad:de,onError:pe,draggable:"false"},null,46,Ya),[[qt,!X.value&&!O.value]]),p.selected&&!O.value?(T(),I("div",Ka,[Ke(d("input",{"onUpdate:modelValue":o[0]||(o[0]=c=>r.value=c),type:"text",placeholder:"Add a caption...",class:"w-full text-center text-sm text-muted-foreground bg-transparent border-none focus:outline-none focus:ring-0 placeholder:text-muted-foreground/50",onBlur:Ce,onKeydown:at(Ce,["enter"])},null,544),[[jt,r.value]])])):p.node.attrs.caption&&!O.value?(T(),I("figcaption",Qa,V(p.node.attrs.caption),1)):P("",!0),p.selected&&!O.value&&!X.value?(T(),I(We,{key:4},[d("div",{class:"absolute -top-1.5 -left-1.5 w-3 h-3 bg-primary border-2 border-background rounded-full cursor-nw-resize z-20 hover:scale-125 transition-transform",onMousedown:o[1]||(o[1]=c=>_("nw",c)),onTouchstart:o[2]||(o[2]=c=>_("nw",c))},null,32),d("div",{class:"absolute -top-1.5 -right-1.5 w-3 h-3 bg-primary border-2 border-background rounded-full cursor-ne-resize z-20 hover:scale-125 transition-transform",onMousedown:o[3]||(o[3]=c=>_("ne",c)),onTouchstart:o[4]||(o[4]=c=>_("ne",c))},null,32),d("div",{class:"absolute -bottom-1.5 -left-1.5 w-3 h-3 bg-primary border-2 border-background rounded-full cursor-sw-resize z-20 hover:scale-125 transition-transform",onMousedown:o[5]||(o[5]=c=>_("sw",c)),onTouchstart:o[6]||(o[6]=c=>_("sw",c))},null,32),d("div",{class:"absolute -bottom-1.5 -right-1.5 w-3 h-3 bg-primary border-2 border-background rounded-full cursor-se-resize z-20 hover:scale-125 transition-transform",onMousedown:o[7]||(o[7]=c=>_("se",c)),onTouchstart:o[8]||(o[8]=c=>_("se",c))},null,32),d("div",{class:"absolute top-1/2 -left-1.5 w-3 h-3 bg-primary border-2 border-background rounded-full cursor-w-resize z-20 -translate-y-1/2 hover:scale-125 transition-transform",onMousedown:o[9]||(o[9]=c=>_("w",c)),onTouchstart:o[10]||(o[10]=c=>_("w",c))},null,32),d("div",{class:"absolute top-1/2 -right-1.5 w-3 h-3 bg-primary border-2 border-background rounded-full cursor-e-resize z-20 -translate-y-1/2 hover:scale-125 transition-transform",onMousedown:o[11]||(o[11]=c=>_("e",c)),onTouchstart:o[12]||(o[12]=c=>_("e",c))},null,32),d("div",{class:"absolute -top-1.5 left-1/2 w-3 h-3 bg-primary border-2 border-background rounded-full cursor-n-resize z-20 -translate-x-1/2 hover:scale-125 transition-transform",onMousedown:o[13]||(o[13]=c=>_("n",c)),onTouchstart:o[14]||(o[14]=c=>_("n",c))},null,32),d("div",{class:"absolute -bottom-1.5 left-1/2 w-3 h-3 bg-primary border-2 border-background rounded-full cursor-s-resize z-20 -translate-x-1/2 hover:scale-125 transition-transform",onMousedown:o[15]||(o[15]=c=>_("s",c)),onTouchstart:o[16]||(o[16]=c=>_("s",c))},null,32)],64)):P("",!0),p.selected?(T(),I("div",Ja,[O.value?P("",!0):(T(),I(We,{key:0},[a(t(v),{variant:"ghost",size:"sm",class:y(["h-7 w-7 p-0",{"bg-primary/10 text-primary":p.node.attrs.alignment==="left"}]),onClick:o[17]||(o[17]=c=>ve("left"))},{default:i(()=>[a(t(rt),{class:"w-4 h-4"})]),_:1},8,["class"]),a(t(v),{variant:"ghost",size:"sm",class:y(["h-7 w-7 p-0",{"bg-primary/10 text-primary":p.node.attrs.alignment==="center"}]),onClick:o[18]||(o[18]=c=>ve("center"))},{default:i(()=>[a(t(st),{class:"w-4 h-4"})]),_:1},8,["class"]),a(t(v),{variant:"ghost",size:"sm",class:y(["h-7 w-7 p-0",{"bg-primary/10 text-primary":p.node.attrs.alignment==="right"}]),onClick:o[19]||(o[19]=c=>ve("right"))},{default:i(()=>[a(t(ot),{class:"w-4 h-4"})]),_:1},8,["class"]),o[26]||(o[26]=d("div",{class:"w-px h-5 bg-border mx-1"},null,-1)),a(t(v),{variant:"ghost",size:"sm",class:"h-7 px-2 text-xs gap-1",onClick:Ve},{default:i(()=>[a(t(nt),{class:"w-3 h-3"}),o[25]||(o[25]=b(" Alt ",-1))]),_:1}),o[27]||(o[27]=d("div",{class:"w-px h-5 bg-border mx-1"},null,-1)),d("span",Za,V(Math.round(B.value))+" x "+V(Math.round(W.value)),1),o[28]||(o[28]=d("div",{class:"w-px h-5 bg-border mx-1"},null,-1))],64)),a(t(v),{variant:"ghost",size:"sm",class:"h-7 w-7 p-0 text-destructive hover:text-destructive",onClick:ae},{default:i(()=>[a(t(Gt),{class:"w-4 h-4"})]),_:1})])):P("",!0)],2),a(t($e),{open:L.value,"onUpdate:open":o[23]||(o[23]=c=>L.value=c)},{default:i(()=>[a(t(Le),null,{default:i(()=>[a(t(He),null,{default:i(()=>[a(t(Ie),null,{default:i(()=>[...o[29]||(o[29]=[b("Image Properties",-1)])]),_:1}),a(t(Ee),null,{default:i(()=>[...o[30]||(o[30]=[b("Edit the alt text and title for this image.",-1)])]),_:1})]),_:1}),d("div",er,[d("div",tr,[a(t(fe),{for:"alt-text"},{default:i(()=>[...o[31]||(o[31]=[b("Alt Text",-1)])]),_:1}),a(t(le),{id:"alt-text",modelValue:ee.value,"onUpdate:modelValue":o[20]||(o[20]=c=>ee.value=c),placeholder:"Describe this image for accessibility..."},null,8,["modelValue"]),o[32]||(o[32]=d("p",{class:"text-xs text-muted-foreground"}," Alt text helps screen readers describe the image to visually impaired users. ",-1))]),d("div",ar,[a(t(fe),{for:"title-text"},{default:i(()=>[...o[33]||(o[33]=[b("Title",-1)])]),_:1}),a(t(le),{id:"title-text",modelValue:Y.value,"onUpdate:modelValue":o[21]||(o[21]=c=>Y.value=c),placeholder:"Optional title shown on hover..."},null,8,["modelValue"])])]),a(t(Re),null,{default:i(()=>[a(t(v),{variant:"outline",onClick:o[22]||(o[22]=c=>L.value=!1)},{default:i(()=>[...o[34]||(o[34]=[b("Cancel",-1)])]),_:1}),a(t(v),{onClick:De},{default:i(()=>[...o[35]||(o[35]=[b("Save",-1)])]),_:1})]),_:1})]),_:1})]),_:1},8,["open"])]),_:1}))}}),sr=Ne(rr,[["__scopeId","data-v-bc29ad5b"]]),or=ct.create({name:"resizableImage",group:"block",atom:!0,draggable:!0,addOptions(){return{HTMLAttributes:{class:"resizable-image-block"},maxWidth:800}},addAttributes(){return{src:{default:null,parseHTML:l=>l.querySelector("img")?.getAttribute("src")||l.getAttribute("src")},alt:{default:"",parseHTML:l=>l.querySelector("img")?.getAttribute("alt")||l.getAttribute("alt")||""},title:{default:"",parseHTML:l=>l.querySelector("img")?.getAttribute("title")||l.getAttribute("title")||""},width:{default:null,parseHTML:l=>{const f=l.querySelector("img")?.getAttribute("width")||l.getAttribute("data-width");return f?parseInt(f,10):null}},height:{default:null,parseHTML:l=>{const f=l.querySelector("img")?.getAttribute("height")||l.getAttribute("data-height");return f?parseInt(f,10):null}},alignment:{default:"center",parseHTML:l=>l.getAttribute("data-alignment")||"center"},aspectRatio:{default:null,parseHTML:l=>{const n=l.getAttribute("data-aspect-ratio");return n?parseFloat(n):null}},caption:{default:"",parseHTML:l=>l.querySelector("figcaption")?.textContent||l.getAttribute("data-caption")||""}}},parseHTML(){return[{tag:"figure[data-resizable-image]"},{tag:"div[data-resizable-image]"},{tag:"img[src]",getAttrs:l=>{if(typeof l=="string")return!1;const n=l;return{src:n.getAttribute("src"),alt:n.getAttribute("alt"),title:n.getAttribute("title"),width:n.getAttribute("width")?parseInt(n.getAttribute("width"),10):null,height:n.getAttribute("height")?parseInt(n.getAttribute("height"),10):null}}}]},renderHTML({HTMLAttributes:l,node:n}){const f=ft(this.options.HTMLAttributes,{"data-resizable-image":"","data-alignment":n.attrs.alignment,"data-width":n.attrs.width,"data-height":n.attrs.height,"data-aspect-ratio":n.attrs.aspectRatio,"data-caption":n.attrs.caption||""}),k={src:l.src||n.attrs.src,alt:n.attrs.alt||"",title:n.attrs.title||""};n.attrs.width&&(k.width=n.attrs.width),n.attrs.height&&(k.height=n.attrs.height);const m=[["img",k]];return n.attrs.caption&&m.push(["figcaption",{},n.attrs.caption]),["figure",f,...m]},addNodeView(){return gt(sr)},addCommands(){return{setImage:l=>({commands:n})=>n.insertContent({type:this.name,attrs:{src:l.src,alt:l.alt||"",title:l.title||"",width:l.width||null,height:l.height||null,caption:l.caption||"",aspectRatio:l.width&&l.height?l.width/l.height:null}}),updateImageSize:l=>({commands:n})=>n.updateAttributes(this.name,{width:l.width,height:l.height}),setImageAlignment:l=>({commands:n})=>n.updateAttributes(this.name,{alignment:l})}},addProseMirrorPlugins(){return[new it({key:new dt("resizableImageDropPaste"),props:{handleDrop:(l,n,f,k)=>{if(k||!n.dataTransfer?.files?.length)return!1;const m=n.dataTransfer.files[0];return m.type.startsWith("image/")?(n.preventDefault(),document.dispatchEvent(new CustomEvent("tiptap-image-drop",{detail:{file:m,view:l,pos:l.posAtCoords({left:n.clientX,top:n.clientY})}})),!0):!1},handlePaste:(l,n)=>{const f=n.clipboardData?.items;if(!f)return!1;for(const k of f)if(k.type.startsWith("image/")){n.preventDefault();const m=k.getAsFile();return m&&document.dispatchEvent(new CustomEvent("tiptap-image-paste",{detail:{file:m,view:l}})),!0}return!1}}})]}}),Z=new dt("ghostText"),nr=mt.create({name:"ghostText",addOptions(){return{onManualTrigger:null,onAccepted:null,onDismissed:null}},addCommands(){return{setGhostText:({text:l,position:n,format:f})=>({tr:k,state:m,dispatch:z})=>{const U=typeof n=="number"?n:m.selection.to;return k.setMeta(Z,{type:"set",text:l,format:f??"text",position:U}),z?.(k),!0},clearGhostText:()=>({tr:l,dispatch:n})=>(l.setMeta(Z,{type:"clear"}),n?.(l),!0)}},addKeyboardShortcuts(){return{Tab:()=>{const l=Z.getState(this.editor.state);if(!l?.isVisible||!l.text||!this.editor.state.selection.empty)return!1;const n=l.position,f=l.text;return this.editor.chain().focus().insertContentAt({from:n,to:n},f).command(({tr:k,dispatch:m})=>(k.setMeta(Z,{type:"clear"}),m?.(k),!0)).run(),this.options.onAccepted?.(f),!0},Escape:()=>Z.getState(this.editor.state)?.isVisible?(this.editor.commands.clearGhostText(),this.options.onDismissed?.(),!0):!1,"Mod-Space":()=>(this.options.onManualTrigger?.(),!0)}},addProseMirrorPlugins(){return[new it({key:Z,state:{init:()=>({text:null,format:"text",position:0,isVisible:!1}),apply:(l,n)=>{const f=l.getMeta(Z);return f?.type==="clear"?{text:null,format:"text",position:0,isVisible:!1}:f?.type==="set"?{text:f.text,format:f.format,position:f.position,isVisible:!0}:l.docChanged?(n.isVisible&&this.options.onDismissed?.(),{text:null,format:"text",position:0,isVisible:!1}):l.selectionSet&&n.isVisible?(this.options.onDismissed?.(),{text:null,format:"text",position:0,isVisible:!1}):n}},props:{decorations:l=>{const n=Z.getState(l);if(!n?.isVisible||!n.text)return null;const f=Math.min(Math.max(0,n.position),l.doc.content.size),k=Xt.widget(f,()=>{const m=document.createElement("span");if(m.className="tiptap-ghost-text",n.format==="html"&&n.text.includes("<")){const z=document.createElement("div");z.innerHTML=n.text,m.textContent=(z.textContent||"").trim()}else m.textContent=n.text??"";return m},{side:1});return Yt.create(l.doc,[k])}}})]}}),lr={class:"relative flex flex-col w-full h-full group bg-background"},ir={class:"flex items-center gap-0.5 border-r border-border/40 pr-1.5 mr-1.5 flex-shrink-0"},dr={class:"flex items-center gap-0.5 border-r border-border/40 pr-1.5 mr-1.5 flex-shrink-0"},ur={class:"text-xs text-zinc-700 dark:text-zinc-100"},cr={class:"flex items-center gap-0.5"},gr={class:"flex h-8 w-9 items-center justify-center border-y border-border/20 bg-muted/20 text-xs font-medium text-foreground"},fr={class:"flex items-center gap-0.5 border-r border-border/40 pr-1.5 mr-1.5 flex-shrink-0"},mr={class:"flex items-center gap-0.5 border-r border-border/40 pr-1.5 mr-1.5 flex-shrink-0"},pr={class:"flex items-center gap-0.5 border-l border-border/20 ml-0.5 pl-0.5"},vr={class:"flex items-center gap-0.5 flex-shrink-0"},hr={class:"relative flex-1 min-h-0"},xr={key:0,class:"absolute top-4 left-1/2 -translate-x-1/2 z-20 pointer-events-none"},br={class:"flex items-center gap-3 pl-3 pr-4 py-2 bg-indigo-950/90 text-white dark:bg-indigo-500/10 dark:text-indigo-100 dark:border-indigo-400/20 backdrop-blur-md border border-indigo-200/20 rounded-full shadow-[0_8px_32px_rgba(79,70,229,0.25)] pointer-events-auto ring-1 ring-white/10"},yr={class:"relative flex items-center justify-center w-5 h-5"},wr={class:"flex flex-col gap-0.5 min-w-[140px]"},kr={class:"flex items-center justify-between gap-4"},Cr={class:"text-[11px] font-semibold tracking-wide uppercase text-indigo-100/90 dark:text-indigo-200"},Tr={class:"text-[10px] font-mono tabular-nums opacity-80"},zr={class:"h-1 w-full bg-indigo-900/50 dark:bg-indigo-950/50 rounded-full overflow-hidden"},Ar={class:"flex flex-col items-end"},Sr={class:"text-xs font-bold font-mono tracking-tight leading-none text-white dark:text-indigo-50"},Mr={class:"grid gap-4 py-4"},_r={class:"grid gap-2"},$r={class:"grid gap-2"},Lr={class:"grid gap-4 py-4"},Er={class:"flex items-center gap-4"},Rr={class:"flex flex-wrap gap-2"},Hr=["onClick"],Ir={class:"grid gap-4 py-4"},Vr={class:"grid gap-2"},Dr={class:"flex items-center gap-2"},Pr={key:1,class:"text-sm text-destructive"},Ur={class:"grid gap-2"},Fr={class:"flex gap-2"},et=300,Br=Oe({__name:"RichTextEditor",props:{modelValue:{},placeholder:{default:"Start writing..."},readonly:{type:Boolean,default:!1},minHeight:{default:"200px"},showToolbar:{type:Boolean,default:!0},toolbarTeleportTarget:{default:""},isGenerating:{type:Boolean,default:!1},generationProgress:{default:""},generationPercentage:{default:0},generationPhase:{default:""},streamingMode:{type:Boolean,default:!1},ghostText:{default:null},ghostTextFormat:{default:"text"},ghostTextPosition:{default:null}},emits:["update:modelValue","update:selectedText","update:selectionRange","ghost-manual-trigger","ghost-accepted","ghost-dismissed"],setup(l,{expose:n,emit:f}){const k=Kt(ya),m=l,z=h(!1),U=h(0),C=h(""),S=h(null),M=f,B=mt.create({name:"fontSize",addOptions(){return{types:["textStyle"]}},addGlobalAttributes(){return[{types:this.options.types,attributes:{fontSize:{default:null,parseHTML:s=>{const e=s.style.fontSize;return e||null},renderHTML:s=>s.fontSize?{style:`font-size: ${s.fontSize}`}:{}}}}]},addCommands(){return{setFontSize:s=>({chain:e})=>e().setMark("textStyle",{fontSize:s}).run(),unsetFontSize:()=>({chain:s})=>s().setMark("textStyle",{fontSize:null}).removeEmptyTextStyle().run()}}}),W=s=>{if(!s)return"";const e=s.split(`
`);let u=[],g=0;for(;g<e.length;){const $=e[g];if($.includes("|")){const E=X(e,g);if(E.html){u.push(E.html),g=E.nextIndex;continue}}u.push($),g++}return u.join(`
`)},X=(s,e)=>{let u=s[e];if(!u||!u.includes("|"))return{html:null,nextIndex:e+1};const g=u.split("|").map(R=>R.trim()).filter(R=>R.length>0);if(g.length===0)return{html:null,nextIndex:e+1};const $=s[e+1];if(!$||!$.includes("|")||!$.includes("-"))return{html:null,nextIndex:e+1};let E=[],x=e+2;for(;x<s.length;){const R=s[x];if(!R||!R.includes("|"))break;const D=R.split("|").map(H=>H.trim()).filter(H=>H.length>0);D.length>0&&E.push(D),x++}let A='<div class="tableWrapper"><table>';return A+="<thead><tr>",g.forEach(R=>{A+=`<th>${R}</th>`}),A+="</tr></thead>",E.length>0&&(A+="<tbody>",E.forEach(R=>{A+="<tr>";for(let D=0;D<g.length;D++){const H=R[D]||"";A+=`<td>${H}</td>`}A+="</tr>"}),A+="</tbody>"),A+="</table></div>",{html:A,nextIndex:x}},O=s=>s?(s=s.replace(/```(\w+)\n?([\s\S]*?)```/g,(e,u,g)=>`<pre><code class="language-${u}">${g.trim()}</code></pre>`),s=s.replace(/```\n?([\s\S]*?)```/g,(e,u)=>`<pre><code>${u.trim()}</code></pre>`),s):"",L=s=>{if(!s)return"";if(s.includes("<p>")||s.includes("<h1>")||s.includes("<h2>")||s.includes("<div>")||s.includes("<div "))return s;let e=s;const u=[];e=e.replace(/```mermaid\n?([\s\S]*?)```/g,(E,x)=>{const A=x.trim(),D=`<div data-mermaid data-mermaid-code="${A.replace(/&/g,"&amp;").replace(/"/g,"&quot;").replace(/</g,"&lt;").replace(/>/g,"&gt;")}" data-view-mode="diagram"><pre><code class="language-mermaid">${A}</code></pre></div>`,H=u.length;return u.push(D),`__MERMAID_PLACEHOLDER_${H}__`}),e=e.replace(/``mermaid\n?([\s\S]*?)``/g,(E,x)=>{const A=x.trim(),D=`<div data-mermaid data-mermaid-code="${A.replace(/&/g,"&amp;").replace(/"/g,"&quot;").replace(/</g,"&lt;").replace(/>/g,"&gt;")}" data-view-mode="diagram"><pre><code class="language-mermaid">${A}</code></pre></div>`,H=u.length;return u.push(D),`__MERMAID_PLACEHOLDER_${H}__`}),e=e.replace(/`mermaid\n([\s\S]*?)`/g,(E,x)=>{const A=x.trim(),D=`<div data-mermaid data-mermaid-code="${A.replace(/&/g,"&amp;").replace(/"/g,"&quot;").replace(/</g,"&lt;").replace(/>/g,"&gt;")}" data-view-mode="diagram"><pre><code class="language-mermaid">${A}</code></pre></div>`,H=u.length;return u.push(D),`__MERMAID_PLACEHOLDER_${H}__`}),e=O(e),e=e.replace(/^### (.*$)/gim,"<h3>$1</h3>"),e=e.replace(/^## (.*$)/gim,"<h2>$1</h2>"),e=e.replace(/^# (.*$)/gim,"<h1>$1</h1>"),e=e.replace(/\*\*(.*?)\*\*/g,"<strong>$1</strong>"),e=e.replace(/\*(.*?)\*/g,"<em>$1</em>"),e=e.replace(/`([^`]+)`/g,"<code>$1</code>"),e=W(e);let $=e.split(`

`).filter(E=>E.trim()).map(E=>{const x=E.trim();if(x.startsWith("<h1>")||x.startsWith("<h2>")||x.startsWith("<h3>")||x.startsWith("<div")||x.startsWith("<table")||x.startsWith("<pre")||x.startsWith("<ul")||x.startsWith("<ol")||x.startsWith("<blockquote")||x.startsWith("__MERMAID_PLACEHOLDER_"))return x;if(x.includes(`
`)&&(x.match(/^\d+\./)||x.match(/^-\s/)||x.match(/^\*\s/))){const R=x.split(`
`).map(D=>{const H=D.trim();return H.match(/^\d+\.\s/)?`<li>${H.replace(/^\d+\.\s/,"")}</li>`:H.match(/^[-*]\s/)?`<li>${H.replace(/^[-*]\s/,"")}</li>`:H}).filter(D=>D.startsWith("<li>"));return x.match(/^\d+\./)?`<ol>${R.join("")}</ol>`:`<ul>${R.join("")}</ul>`}return`<p>${x.replace(/\n/g,"<br>")}</p>`}).join("");return u.forEach((E,x)=>{$=$.replace(`__MERMAID_PLACEHOLDER_${x}__`,E)}),$},Y=[wa.configure({heading:{levels:[1,2,3]},codeBlock:!1,link:!1}),ka.configure({lowlight:k,HTMLAttributes:{class:"code-block-highlighted"}}),Ca.configure({placeholder:m.placeholder}),Ta,za,B,Aa,Sa.configure({multicolor:!0}),Ma.configure({openOnClick:!1,HTMLAttributes:{class:"prose-link text-primary hover:text-primary/80 underline decoration-primary/50"}}),_a.configure({resizable:!0}),$a,La,Ea,Ga,Da,or.configure({maxWidth:800}),Ra.configure({types:["heading","paragraph"]}),nr.configure({onManualTrigger:()=>M("ghost-manual-trigger"),onAccepted:s=>M("ghost-accepted",s),onDismissed:()=>M("ghost-dismissed")})].filter((s,e,u)=>e===u.findIndex(g=>g.name===s.name)),r=Ha({content:L(m.modelValue),editable:!m.readonly,extensions:Y,editorProps:{attributes:{class:"prose prose-sm dark:prose-invert max-w-none focus:outline-none",style:`min-height: ${m.minHeight}; padding: 12px;`}},onUpdate:({editor:s})=>{M("update:modelValue",s.getHTML()),ke()},onSelectionUpdate:({editor:s})=>{ke();const{from:e,to:u,empty:g}=s.state.selection;if(g)M("update:selectedText",""),M("update:selectionRange",null),console.log("ðŸ”„ RichTextEditor - No selection, cleared");else{if(!s.state.doc)return;const $=s.state.doc.textBetween(e,u);$.split(/\s+/).filter(x=>x.length>0).length<=200?(M("update:selectedText",$),M("update:selectionRange",{from:e,to:u}),console.log("âœ… RichTextEditor - Selection emitted to parent")):(M("update:selectedText",""),M("update:selectionRange",null),console.log("âŒ RichTextEditor - Selection too long, cleared"))}}});ne(()=>m.modelValue,s=>{if(r.value){if(m.streamingMode&&z.value){de(s);return}if(r.value.getHTML()!==s){const e=L(s);r.value.commands.setContent(e,{emitUpdate:!1}),Fe(()=>{r.value&&M("update:modelValue",r.value.getHTML())})}}}),ne([()=>m.ghostText,()=>m.ghostTextFormat,()=>m.ghostTextPosition],([s,e,u])=>{if(!r.value)return;const g=(s??"").toString();if(!g){r.value.commands.clearGhostText?.();return}r.value.commands.setGhostText?.({text:g,format:e??"text",position:typeof u=="number"?u:void 0})},{immediate:!0}),ne(()=>m.streamingMode,s=>{s?te():w()});function te(){z.value=!0,U.value=0,C.value="",console.log("RichTextEditor: Streaming mode started (throttled)")}function w(){S.value&&(clearTimeout(S.value),S.value=null),C.value&&r.value&&pe(C.value),z.value=!1,C.value="",U.value=0,console.log("RichTextEditor: Streaming mode ended")}function de(s){if(!r.value||!z.value)return;C.value=s;const u=Date.now()-U.value;if(u>=et){pe(s);return}if(!S.value){const g=et-u;S.value=setTimeout(()=>{S.value=null,z.value&&C.value&&pe(C.value)},g)}}function pe(s){if(!r.value)return;U.value=Date.now();const e=L(s);r.value.getHTML()!==e&&r.value.commands.setContent(e,{emitUpdate:!1})}function _(){if(!r.value)return;const s=C.value||m.modelValue,e=L(s);r.value.commands.setContent(e,{emitUpdate:!1})}function K(){const s=C.value||m.modelValue;return{length:s.length,wordCount:s.split(/\s+/).filter(e=>e.length>0).length}}ne(()=>m.readonly,s=>{r.value&&r.value.setEditable(!s)}),Be(()=>{setTimeout(()=>{r.value&&ke()},100),document.addEventListener("tiptap-image-drop",je),document.addEventListener("tiptap-image-paste",Ge)}),tt(()=>{S.value&&(clearTimeout(S.value),S.value=null),r.value&&r.value.destroy(),document.removeEventListener("tiptap-image-drop",je),document.removeEventListener("tiptap-image-paste",Ge),o()});const Q=()=>r.value?.chain().focus().toggleBold().run(),ve=()=>r.value?.chain().focus().toggleItalic().run(),Ve=()=>r.value?.chain().focus().toggleStrike().run(),De=()=>r.value?.chain().focus().toggleCode().run(),Ce=()=>{r.value?.chain().focus().insertMermaid().run()},ae=h(!1);let p=null;const o=()=>{p&&(p.disconnect(),p=null)},c=()=>{if(typeof document>"u"){ae.value=!1;return}ae.value=!!(m.toolbarTeleportTarget&&document.querySelector(m.toolbarTeleportTarget))};typeof document<"u"&&c();const N=F(()=>!m.toolbarTeleportTarget||!ae.value);F(()=>!N.value);const he=F(()=>N.value?"body":m.toolbarTeleportTarget||"body"),xe=F(()=>{const s="z-20 flex items-center gap-1 border-border/40 bg-background/95 p-1.5 shadow-sm backdrop-blur-md transition-all duration-200 supports-[backdrop-filter]:bg-background/80 overflow-x-auto no-scrollbar mask-gradient-right";return N.value?`sticky top-0 mx-0 sm:mx-2 md:mx-4 mt-0 sm:mt-1 md:mt-2 mb-2 md:mb-4 rounded-none sm:rounded-lg md:rounded-xl border-y sm:border ${s}`:`w-full ${s} rounded-lg border`});ne(()=>m.toolbarTeleportTarget,async()=>{await Fe(),c()},{flush:"post"}),Be(async()=>{await Fe(),c(),!ae.value&&m.toolbarTeleportTarget&&typeof MutationObserver<"u"&&typeof document<"u"&&document.body&&(o(),p=new MutationObserver(()=>{c(),ae.value&&o()}),p.observe(document.body,{childList:!0,subtree:!0}))});const re=()=>r.value?.chain().focus().toggleUnderline().run(),G=()=>r.value?.chain().focus().toggleHeading({level:1}).run(),J=()=>r.value?.chain().focus().toggleHeading({level:2}).run(),Te=()=>r.value?.chain().focus().toggleHeading({level:3}).run(),pt=()=>r.value?.chain().focus().toggleBulletList().run(),vt=()=>r.value?.chain().focus().toggleOrderedList().run(),ht=()=>r.value?.chain().focus().toggleBlockquote().run(),xt=()=>r.value?.chain().focus().setParagraph().run(),bt=()=>r.value?.chain().focus().undo().run(),yt=()=>r.value?.chain().focus().redo().run(),be=h(!1),ze=h(!1),j=h({url:"",text:""}),se=h({color:"#000000"}),wt=()=>{const{from:s,to:e}=r.value?.state.selection||{from:0,to:0},u=r.value?.state.doc.textBetween(s,e)||"";r.value?.isActive("link")?r.value.chain().focus().unsetLink().run():(j.value.text=u,j.value.url="",be.value=!0)},kt=()=>{if(j.value.url){if(j.value.text){const{from:s,to:e}=r.value?.state.selection||{from:0,to:0};r.value?.chain().focus().deleteRange({from:s,to:e}).insertContent(`<a href="${j.value.url}">${j.value.text}</a>`).run()}else r.value?.chain().focus().setLink({href:j.value.url}).run();be.value=!1}},Ct=()=>{ze.value=!0},Tt=()=>{se.value.color&&r.value?.chain().focus().setColor(se.value.color).run(),ze.value=!1},zt=()=>{r.value?.chain().focus().unsetColor().run()},ue=h(!1),ce=h(""),ye=h(!1),Ae=h(0),ge=h(""),Se=h(null),At=()=>{ce.value="",ge.value="",ue.value=!0},qe=()=>{ce.value&&(r.value?.chain().focus().setImage({src:ce.value}).run(),ue.value=!1)},St=s=>{const u=s.target.files?.[0];u&&Pe(u)},Pe=async s=>{if(!s.type.startsWith("image/")){ge.value="Please select an image file";return}ye.value=!0,ge.value="",Ae.value=0;try{const e=new FormData;e.append("image",s);const u=await lt.post("/editor/images",e,{headers:{"Content-Type":"multipart/form-data"},onUploadProgress:g=>{g.total&&(Ae.value=Math.round(g.loaded*100/g.total))}});u.data.success&&(r.value?.chain().focus().setImage({src:u.data.url,width:u.data.width,height:u.data.height}).run(),ue.value=!1)}catch(e){ge.value=e.response?.data?.message||"Upload failed"}finally{ye.value=!1,Ae.value=0,Se.value&&(Se.value.value="")}},je=s=>{const{file:e}=s.detail;Pe(e)},Ge=s=>{const{file:e}=s.detail;Pe(e)},Xe=h("#ffff00"),Mt=()=>{if(r.value?.isActive("highlight"))r.value.chain().focus().unsetHighlight().run();else{const s=prompt("Enter highlight color (hex, rgb, or color name):",Xe.value);s?(Xe.value=s,r.value?.chain().focus().setHighlight({color:s}).run()):r.value?.chain().focus().setHighlight().run()}},Me=s=>{r.value?.chain().focus().setTextAlign(s).run()},_t=()=>{r.value?.chain().focus().insertTable({rows:3,cols:3,withHeaderRow:!0}).run()},$t=()=>{r.value?.chain().focus().addColumnBefore().run()},Lt=()=>{r.value?.chain().focus().addColumnAfter().run()},Et=()=>{r.value?.chain().focus().deleteColumn().run()},Rt=()=>{r.value?.chain().focus().addRowBefore().run()},Ht=()=>{r.value?.chain().focus().addRowAfter().run()},It=()=>{r.value?.chain().focus().deleteRow().run()},Vt=()=>{r.value?.chain().focus().deleteTable().run()},oe=()=>r.value?.isActive("table")??!1,Ye=h("12pt"),we=["8pt","9pt","10pt","11pt","12pt","14pt","16pt","18pt","20pt","24pt","28pt","36pt","48pt","72pt"],Dt=()=>{const s=Ue(),e=we.indexOf(s);if(e===-1)r.value?.chain().focus().setFontSize("14pt").run();else if(e<we.length-1){const u=we[e+1];r.value?.chain().focus().setFontSize(u).run()}ke()},Pt=()=>{const s=Ue(),e=we.indexOf(s);if(e===-1)r.value?.chain().focus().setFontSize("11pt").run();else if(e>0){const u=we[e-1];r.value?.chain().focus().setFontSize(u).run()}ke()},Ue=()=>{const{from:s,to:e}=r.value?.state.selection||{from:0,to:0};let u="";return r.value?.state.doc.nodesBetween(s,e,g=>{g.marks&&g.marks.forEach($=>{$.type.name==="textStyle"&&$.attrs.fontSize&&(u=$.attrs.fontSize)})}),u||"12pt"},ke=()=>{const s=Ue();Ye.value=s},Ut=F(()=>r.value?r.value.state.doc.textContent.split(/\s+/).filter(e=>e.length>0).length:0);return n({getSelectionRange:()=>{if(!r.value)return null;const{from:s,to:e,empty:u}=r.value.state.selection;return u?null:{from:s,to:e}},getSelectedText:()=>{if(!r.value)return"";const{from:s,to:e}=r.value.state.selection;return r.value.state.doc.textBetween(s,e)},replaceSelection:(s,e)=>{if(!r.value)return console.error("âŒ RichTextEditor - Cannot replace selection: editor not available"),!1;try{const u=e||r.value.state.selection;return console.log("ðŸ”„ RichTextEditor - Starting text replacement:",{range:u,newTextLength:s.length,newTextPreview:s.substring(0,100)+(s.length>100?"...":"")}),r.value.chain().focus().insertContentAt({from:u.from,to:u.to},s,{parseOptions:{preserveWhitespace:"full"}}).run(),console.log("âœ… RichTextEditor - Text replacement successful"),!0}catch(u){return console.error("âŒ RichTextEditor - Error replacing selection:",u),!1}},replaceTextAt:(s,e)=>{if(!r.value)return!1;try{return r.value.chain().focus().insertContentAt(s,e).run(),!0}catch(u){return console.error("Error replacing text at position:",u),!1}},getCursorPosition:()=>r.value?r.value.state.selection.anchor:0,setCursorPosition:s=>{if(!r.value)return!1;try{return r.value.commands.setTextSelection(s),!0}catch(e){return console.error("Error setting cursor position:",e),!1}},focus:()=>r.value?.commands.focus(),blur:()=>r.value?.commands.blur(),getHTML:()=>r.value?.getHTML()||"",getText:()=>r.value?.getText()||"",wordCount:Ut,startStreamingMode:te,endStreamingMode:w,refreshContent:_,getStreamingInfo:K,isStreamingActive:()=>z.value,editor:()=>r.value}),(s,e)=>{const u=Qt("Sparkles");return T(),I("div",lr,[s.showToolbar&&!s.readonly?(T(),ie(Jt,{key:0,to:he.value,disabled:N.value},[d("div",{class:y(xe.value)},[d("div",ir,[a(t(v),{variant:"ghost",size:"icon",class:"h-8 w-8 rounded-lg hover:bg-muted/80 text-zinc-700 dark:text-zinc-300 hover:text-foreground",onClick:bt,disabled:!t(r)?.can().undo()},{default:i(()=>[a(t(Zt),{class:"h-4 w-4"})]),_:1},8,["disabled"]),a(t(v),{variant:"ghost",size:"icon",class:"h-8 w-8 rounded-lg hover:bg-muted/80 text-zinc-700 dark:text-zinc-300 hover:text-foreground",onClick:yt,disabled:!t(r)?.can().redo()},{default:i(()=>[a(t(ea),{class:"h-4 w-4"})]),_:1},8,["disabled"])]),d("div",dr,[a(t(Ze),null,{default:i(()=>[a(t(Qe),{asChild:""},{default:i(()=>[a(t(v),{variant:"ghost",size:"sm",class:"h-8 gap-1 px-2 font-medium text-zinc-700 dark:text-zinc-300 hover:text-foreground hover:bg-muted/80"},{default:i(()=>[d("span",ur,V(t(r)?.isActive("heading",{level:1})?"H1":t(r)?.isActive("heading",{level:2})?"H2":t(r)?.isActive("heading",{level:3})?"H3":"Paragraph"),1),a(t(nt),{class:"h-3.5 w-3.5 opacity-70"})]),_:1})]),_:1}),a(t(Je),{align:"start"},{default:i(()=>[a(t(q),{onClick:xt,class:y({"bg-accent":t(r)?.isActive("paragraph")})},{default:i(()=>[...e[15]||(e[15]=[d("span",{class:"text-sm"},"Paragraph",-1)])]),_:1},8,["class"]),a(t(_e)),a(t(q),{onClick:G,class:y({"bg-accent":t(r)?.isActive("heading",{level:1})})},{default:i(()=>[...e[16]||(e[16]=[d("span",{class:"text-lg font-bold"},"Heading 1",-1)])]),_:1},8,["class"]),a(t(q),{onClick:J,class:y({"bg-accent":t(r)?.isActive("heading",{level:2})})},{default:i(()=>[...e[17]||(e[17]=[d("span",{class:"text-base font-bold"},"Heading 2",-1)])]),_:1},8,["class"]),a(t(q),{onClick:Te,class:y({"bg-accent":t(r)?.isActive("heading",{level:3})})},{default:i(()=>[...e[18]||(e[18]=[d("span",{class:"text-sm font-bold"},"Heading 3",-1)])]),_:1},8,["class"])]),_:1})]),_:1}),d("div",cr,[a(t(v),{variant:"ghost",size:"icon",class:"h-8 w-6 rounded-l-lg text-zinc-700 dark:text-zinc-300 hover:text-foreground hover:bg-muted/80",onClick:Pt},{default:i(()=>[a(t(ta),{class:"h-3 w-3"})]),_:1}),d("div",gr,V(Ye.value.replace("pt","")),1),a(t(v),{variant:"ghost",size:"icon",class:"h-8 w-6 rounded-r-lg text-zinc-700 dark:text-zinc-300 hover:text-foreground hover:bg-muted/80",onClick:Dt},{default:i(()=>[a(t(aa),{class:"h-3 w-3"})]),_:1})])]),d("div",fr,[a(t(v),{variant:"ghost",size:"icon",class:y(["h-8 w-8 rounded-lg text-zinc-700 dark:text-zinc-300 hover:text-foreground hover:bg-muted/80",{"bg-primary/10 text-primary":t(r)?.isActive("bold")}]),onClick:Q},{default:i(()=>[a(t(ra),{class:"h-4 w-4"})]),_:1},8,["class"]),a(t(v),{variant:"ghost",size:"icon",class:y(["h-8 w-8 rounded-lg text-zinc-700 dark:text-zinc-300 hover:text-foreground hover:bg-muted/80",{"bg-primary/10 text-primary":t(r)?.isActive("italic")}]),onClick:ve},{default:i(()=>[a(t(sa),{class:"h-4 w-4"})]),_:1},8,["class"]),a(t(v),{variant:"ghost",size:"icon",class:y(["h-8 w-8 rounded-lg text-zinc-700 dark:text-zinc-300 hover:text-foreground hover:bg-muted/80",{"bg-primary/10 text-primary":t(r)?.isActive("underline")}]),onClick:re},{default:i(()=>[a(t(oa),{class:"h-4 w-4"})]),_:1},8,["class"]),a(t(v),{variant:"ghost",size:"icon",class:y(["h-8 w-8 rounded-lg text-zinc-700 dark:text-zinc-300 hover:text-foreground hover:bg-muted/80",{"bg-primary/10 text-primary":t(r)?.isActive("strike")}]),onClick:Ve},{default:i(()=>[a(t(na),{class:"h-4 w-4"})]),_:1},8,["class"]),a(t(v),{variant:"ghost",size:"icon",class:y(["h-8 w-8 rounded-lg text-zinc-700 dark:text-zinc-300 hover:text-foreground hover:bg-muted/80",{"bg-primary/10 text-primary":t(r)?.isActive("code")}]),onClick:De},{default:i(()=>[a(t(la),{class:"h-4 w-4"})]),_:1},8,["class"])]),d("div",mr,[a(t(v),{variant:"ghost",size:"icon",class:y(["h-8 w-8 rounded-lg text-zinc-700 dark:text-zinc-300 hover:text-foreground hover:bg-muted/80",{"bg-primary/10 text-primary":t(r)?.isActive("bulletList")}]),onClick:pt},{default:i(()=>[a(t(ia),{class:"h-4 w-4"})]),_:1},8,["class"]),a(t(v),{variant:"ghost",size:"icon",class:y(["h-8 w-8 rounded-lg text-zinc-700 dark:text-zinc-300 hover:text-foreground hover:bg-muted/80",{"bg-primary/10 text-primary":t(r)?.isActive("orderedList")}]),onClick:vt},{default:i(()=>[a(t(da),{class:"h-4 w-4"})]),_:1},8,["class"]),a(t(v),{variant:"ghost",size:"icon",class:y(["h-8 w-8 rounded-lg text-zinc-700 dark:text-zinc-300 hover:text-foreground hover:bg-muted/80",{"bg-primary/10 text-primary":t(r)?.isActive("blockquote")}]),onClick:ht},{default:i(()=>[a(t(ua),{class:"h-4 w-4"})]),_:1},8,["class"]),d("div",pr,[a(t(v),{variant:"ghost",size:"icon",class:y(["h-8 w-8 rounded-lg text-zinc-700 dark:text-zinc-300 hover:text-foreground hover:bg-muted/80",{"bg-primary/10 text-primary":t(r)?.isActive({textAlign:"left"})}]),onClick:e[0]||(e[0]=g=>Me("left"))},{default:i(()=>[a(t(rt),{class:"h-4 w-4"})]),_:1},8,["class"]),a(t(v),{variant:"ghost",size:"icon",class:y(["h-8 w-8 rounded-lg text-zinc-700 dark:text-zinc-300 hover:text-foreground hover:bg-muted/80",{"bg-primary/10 text-primary":t(r)?.isActive({textAlign:"center"})}]),onClick:e[1]||(e[1]=g=>Me("center"))},{default:i(()=>[a(t(st),{class:"h-4 w-4"})]),_:1},8,["class"]),a(t(v),{variant:"ghost",size:"icon",class:y(["h-8 w-8 rounded-lg text-zinc-700 dark:text-zinc-300 hover:text-foreground hover:bg-muted/80",{"bg-primary/10 text-primary":t(r)?.isActive({textAlign:"right"})}]),onClick:e[2]||(e[2]=g=>Me("right"))},{default:i(()=>[a(t(ot),{class:"h-4 w-4"})]),_:1},8,["class"]),a(t(v),{variant:"ghost",size:"icon",class:y(["h-8 w-8 rounded-lg text-zinc-700 dark:text-zinc-300 hover:text-foreground hover:bg-muted/80",{"bg-primary/10 text-primary":t(r)?.isActive({textAlign:"justify"})}]),onClick:e[3]||(e[3]=g=>Me("justify"))},{default:i(()=>[a(t(ca),{class:"h-4 w-4"})]),_:1},8,["class"])])]),d("div",vr,[a(t(v),{variant:"ghost",size:"icon",class:"h-8 w-8 rounded-lg text-zinc-700 dark:text-zinc-300 hover:text-foreground hover:bg-muted/80",title:"Insert Mermaid diagram (Ctrl/Cmd+Alt+M)",onClick:Ce},{default:i(()=>[...e[19]||(e[19]=[d("span",{class:"text-[11px] font-semibold"},"M",-1)])]),_:1}),a(t(v),{variant:"ghost",size:"icon",class:y(["h-8 w-8 rounded-lg text-zinc-700 dark:text-zinc-300 hover:text-foreground hover:bg-muted/80",{"bg-primary/10 text-primary":t(r)?.isActive("link")}]),onClick:wt},{default:i(()=>[a(t(ga),{class:"h-4 w-4"})]),_:1},8,["class"]),a(t(v),{variant:"ghost",size:"icon",class:"h-8 w-8 rounded-lg text-zinc-700 dark:text-zinc-300 hover:text-foreground hover:bg-muted/80",title:"Insert image",onClick:At},{default:i(()=>[a(t(fa),{class:"h-4 w-4"})]),_:1}),a(t(Ze),null,{default:i(()=>[a(t(Qe),{asChild:""},{default:i(()=>[a(t(v),{variant:"ghost",size:"icon",class:y(["h-8 w-8 rounded-lg text-zinc-700 dark:text-zinc-300 hover:text-foreground hover:bg-muted/80",{"bg-primary/10 text-primary":t(r)?.isActive("table")}])},{default:i(()=>[a(t(ma),{class:"h-4 w-4"})]),_:1},8,["class"])]),_:1}),a(t(Je),null,{default:i(()=>[a(t(q),{onClick:_t},{default:i(()=>[...e[20]||(e[20]=[b("Insert Table (3x3)",-1)])]),_:1}),a(t(_e)),a(t(q),{onClick:$t,disabled:!oe()},{default:i(()=>[...e[21]||(e[21]=[b("Add Column Before",-1)])]),_:1},8,["disabled"]),a(t(q),{onClick:Lt,disabled:!oe()},{default:i(()=>[...e[22]||(e[22]=[b("Add Column After",-1)])]),_:1},8,["disabled"]),a(t(q),{onClick:Et,disabled:!oe()},{default:i(()=>[...e[23]||(e[23]=[b("Delete Column",-1)])]),_:1},8,["disabled"]),a(t(_e)),a(t(q),{onClick:Rt,disabled:!oe()},{default:i(()=>[...e[24]||(e[24]=[b("Add Row Before",-1)])]),_:1},8,["disabled"]),a(t(q),{onClick:Ht,disabled:!oe()},{default:i(()=>[...e[25]||(e[25]=[b("Add Row After",-1)])]),_:1},8,["disabled"]),a(t(q),{onClick:It,disabled:!oe()},{default:i(()=>[...e[26]||(e[26]=[b("Delete Row",-1)])]),_:1},8,["disabled"]),a(t(_e)),a(t(q),{onClick:Vt,disabled:!oe(),class:"text-destructive"},{default:i(()=>[...e[27]||(e[27]=[b("Delete Table ",-1)])]),_:1},8,["disabled"])]),_:1})]),_:1}),a(t(v),{variant:"ghost",size:"icon",class:y(["h-8 w-8 rounded-lg text-zinc-700 dark:text-zinc-300 hover:text-foreground hover:bg-muted/80",{"bg-primary/10 text-primary":t(r)?.isActive("highlight")}]),onClick:Mt},{default:i(()=>[a(t(pa),{class:"h-4 w-4"})]),_:1},8,["class"]),a(t(v),{variant:"ghost",size:"icon",class:y(["h-8 w-8 rounded-lg text-zinc-700 dark:text-zinc-300 hover:text-foreground hover:bg-muted/80",{"bg-primary/10 text-primary":t(r)?.getAttributes("textStyle").color}]),onClick:Ct},{default:i(()=>[a(t(va),{class:"h-4 w-4"})]),_:1},8,["class"])])],2)],8,["to","disabled"])):P("",!0),d("div",hr,[a(t(Ia),{editor:t(r),class:"h-full w-full outline-none"},null,8,["editor"]),a(ha,{"enter-active-class":"transition-all duration-300 cubic-bezier(0.34, 1.56, 0.64, 1)","enter-from-class":"opacity-0 -translate-y-4 scale-95","enter-to-class":"opacity-100 translate-y-0 scale-100","leave-active-class":"transition-all duration-200 cubic-bezier(0.4, 0, 0.2, 1)","leave-from-class":"opacity-100 translate-y-0 scale-100","leave-to-class":"opacity-0 -translate-y-4 scale-95"},{default:i(()=>[s.isGenerating?(T(),I("div",xr,[d("div",br,[d("div",yr,[e[28]||(e[28]=d("div",{class:"absolute inset-0 rounded-full bg-indigo-400/30 animate-ping"},null,-1)),a(u,{class:"w-4 h-4 text-indigo-300 animate-pulse relative z-10"})]),d("div",wr,[d("div",kr,[d("span",Cr,V(s.generationPhase||"Writing..."),1),d("span",Tr,V(s.generationPercentage)+"% ",1)]),d("div",zr,[d("div",{class:"h-full bg-gradient-to-r from-indigo-400 to-purple-400 transition-all duration-300 ease-out",style:me({width:`${s.generationPercentage}%`})},[...e[29]||(e[29]=[d("div",{class:"absolute inset-0 bg-white/20 animate-[shimmer_2s_infinite]"},null,-1)])],4)])]),e[31]||(e[31]=d("div",{class:"w-px h-6 bg-white/10 mx-1"},null,-1)),d("div",Ar,[e[30]||(e[30]=d("span",{class:"text-[10px] font-medium text-indigo-200/80"}," Word Count ",-1)),d("span",Sr,V(s.generationProgress?.match(/\d+/)?.[0]||"..."),1)])])])):P("",!0)]),_:1})]),a(t($e),{open:be.value,"onUpdate:open":e[7]||(e[7]=g=>be.value=g)},{default:i(()=>[a(t(Le),null,{default:i(()=>[a(t(He),null,{default:i(()=>[a(t(Ie),null,{default:i(()=>[...e[32]||(e[32]=[b("Insert Link",-1)])]),_:1}),a(t(Ee),null,{default:i(()=>[...e[33]||(e[33]=[b("Enter the URL for the link.",-1)])]),_:1})]),_:1}),d("div",Mr,[d("div",_r,[a(t(fe),{htmlFor:"link-text"},{default:i(()=>[...e[34]||(e[34]=[b("Text",-1)])]),_:1}),a(t(le),{id:"link-text",modelValue:j.value.text,"onUpdate:modelValue":e[4]||(e[4]=g=>j.value.text=g),placeholder:"Link text"},null,8,["modelValue"])]),d("div",$r,[a(t(fe),{htmlFor:"link-url"},{default:i(()=>[...e[35]||(e[35]=[b("URL",-1)])]),_:1}),a(t(le),{id:"link-url",modelValue:j.value.url,"onUpdate:modelValue":e[5]||(e[5]=g=>j.value.url=g),placeholder:"https://example.com"},null,8,["modelValue"])])]),a(t(Re),null,{default:i(()=>[a(t(v),{variant:"outline",onClick:e[6]||(e[6]=g=>be.value=!1)},{default:i(()=>[...e[36]||(e[36]=[b("Cancel",-1)])]),_:1}),a(t(v),{onClick:kt},{default:i(()=>[...e[37]||(e[37]=[b("Insert",-1)])]),_:1})]),_:1})]),_:1})]),_:1},8,["open"]),a(t($e),{open:ze.value,"onUpdate:open":e[10]||(e[10]=g=>ze.value=g)},{default:i(()=>[a(t(Le),null,{default:i(()=>[a(t(He),null,{default:i(()=>[a(t(Ie),null,{default:i(()=>[...e[38]||(e[38]=[b("Text Color",-1)])]),_:1}),a(t(Ee),null,{default:i(()=>[...e[39]||(e[39]=[b("Choose a color for the selected text.",-1)])]),_:1})]),_:1}),d("div",Lr,[d("div",Er,[a(t(le),{type:"color",modelValue:se.value.color,"onUpdate:modelValue":e[8]||(e[8]=g=>se.value.color=g),class:"h-12 w-12 p-1"},null,8,["modelValue"]),a(t(le),{modelValue:se.value.color,"onUpdate:modelValue":e[9]||(e[9]=g=>se.value.color=g),placeholder:"#000000",class:"flex-1"},null,8,["modelValue"])]),d("div",Rr,[(T(),I(We,null,xa(["#000000","#ef4444","#f97316","#eab308","#22c55e","#3b82f6","#a855f7","#ec4899"],g=>d("button",{key:g,class:"h-8 w-8 rounded-full border border-border shadow-sm transition-transform hover:scale-110 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2",style:me({backgroundColor:g}),onClick:$=>se.value.color=g},null,12,Hr)),64))])]),a(t(Re),null,{default:i(()=>[a(t(v),{variant:"outline",onClick:zt},{default:i(()=>[...e[40]||(e[40]=[b("Reset",-1)])]),_:1}),a(t(v),{onClick:Tt},{default:i(()=>[...e[41]||(e[41]=[b("Apply",-1)])]),_:1})]),_:1})]),_:1})]),_:1},8,["open"]),a(t($e),{open:ue.value,"onUpdate:open":e[14]||(e[14]=g=>ue.value=g)},{default:i(()=>[a(t(Le),{class:"sm:max-w-md"},{default:i(()=>[a(t(He),null,{default:i(()=>[a(t(Ie),null,{default:i(()=>[...e[42]||(e[42]=[b("Insert Image",-1)])]),_:1}),a(t(Ee),null,{default:i(()=>[...e[43]||(e[43]=[b("Upload an image or enter a URL.",-1)])]),_:1})]),_:1}),d("div",Ir,[d("div",Vr,[a(t(fe),null,{default:i(()=>[...e[44]||(e[44]=[b("Upload from computer",-1)])]),_:1}),d("div",Dr,[d("input",{ref_key:"imageFileInput",ref:Se,type:"file",accept:"image/*",class:"hidden",onChange:St},null,544),a(t(v),{variant:"outline",class:"w-full",disabled:ye.value,onClick:e[11]||(e[11]=g=>Se.value?.click())},{default:i(()=>[a(t(ba),{class:"w-4 h-4 mr-2"}),b(" "+V(ye.value?"Uploading...":"Choose File"),1)]),_:1},8,["disabled"])]),ye.value?(T(),ie(t(Va),{key:0,"model-value":Ae.value,class:"h-2"},null,8,["model-value"])):P("",!0),ge.value?(T(),I("p",Pr,V(ge.value),1)):P("",!0)]),e[47]||(e[47]=d("div",{class:"relative"},[d("div",{class:"absolute inset-0 flex items-center"},[d("span",{class:"w-full border-t"})]),d("div",{class:"relative flex justify-center text-xs uppercase"},[d("span",{class:"bg-background px-2 text-muted-foreground"},"Or")])],-1)),d("div",Ur,[a(t(fe),{for:"image-url"},{default:i(()=>[...e[45]||(e[45]=[b("Image URL",-1)])]),_:1}),d("div",Fr,[a(t(le),{id:"image-url",modelValue:ce.value,"onUpdate:modelValue":e[12]||(e[12]=g=>ce.value=g),placeholder:"https://example.com/image.jpg",onKeydown:at(qe,["enter"])},null,8,["modelValue"]),a(t(v),{onClick:qe,disabled:!ce.value},{default:i(()=>[...e[46]||(e[46]=[b(" Insert ",-1)])]),_:1},8,["disabled"])])])]),a(t(Re),null,{default:i(()=>[a(t(v),{variant:"outline",onClick:e[13]||(e[13]=g=>ue.value=!1)},{default:i(()=>[...e[48]||(e[48]=[b("Cancel",-1)])]),_:1})]),_:1})]),_:1})]),_:1},8,["open"])])}}}),ls=Ne(Br,[["__scopeId","data-v-47d534bc"]]);export{ls as R};
