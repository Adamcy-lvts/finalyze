const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/ChapterNavigation-CzLHj3F7.js","assets/ChapterNavigation.vue_vue_type_script_setup_true_lang-Cevdd75t.js","assets/index-D3d1G8kJ.js","assets/app-Bo97tXR7.js","assets/app-Pa-271I5.css","assets/ScrollArea.vue_vue_type_script_setup_true_lang-NWvPXL4H.js","assets/Presence-Dwqo9iE1.js","assets/useForwardExpose-C97CAlAR.js","assets/index-BTMUG24f.js","assets/useNonce-C4TbBN9H.js","assets/AlertDialogTitle.vue_vue_type_script_setup_true_lang-iU3BsOhj.js","assets/VisuallyHidden-C-xRdpIz.js","assets/DropdownMenuTrigger.vue_vue_type_script_setup_true_lang-Bu6hdF-6.js","assets/DialogTrigger-BFcFOVPp.js","assets/index-DbvdGjWg.js","assets/index-BxsHf2vm.js","assets/plus-FhD9przB.js","assets/chevron-right-DDXDTgI8.js","assets/circle-check-big-BrGBqWsd.js","assets/lock-HVPSCO5l.js","assets/target-CpCoyHcO.js","assets/trash-2-CvPjaLNy.js","assets/MobileNavOverlay-D8U2dswS.js","assets/index-BYYRduxq.js","assets/DefensePreparationPanel.vue_vue_type_script_setup_true_lang-ynIORVIJ.js","assets/CardContent.vue_vue_type_script_setup_true_lang-OLZW0R35.js","assets/CardTitle.vue_vue_type_script_setup_true_lang-D_luTp_a.js","assets/CollapsibleTrigger.vue_vue_type_script_setup_true_lang--_YdoWkg.js","assets/Progress.vue_vue_type_script_setup_true_lang-Bsdp52pg.js","assets/nullish-CHIgUVhi.js","assets/Separator.vue_vue_type_script_setup_true_lang-DQnO4z8s.js","assets/Separator-C6ierpps.js","assets/Switch.vue_vue_type_script_setup_true_lang-BUzIvkMf.js","assets/VisuallyHiddenInput-BbV2ap4Q.js","assets/chevron-down-3G8i5M-G.js","assets/loader-circle-Dg4GmgPT.js","assets/lightbulb-m0fndsgY.js","assets/useTextHistory-BD2S9UIX.js","assets/Input.vue_vue_type_script_setup_true_lang-UF9MSFTy.js","assets/RichTextEditor-AU3K_MPZ.js","assets/_plugin-vue_export-helper-DlAUqK2U.js","assets/purify.es-DxJI3Wx7.js","assets/index-BWEDi_FC.js","assets/step-DrZ9DcYd.js","assets/chart-column-RZxAGCKu.js","assets/calendar-BRGQP5JO.js","assets/brain-Cqeg3r8V.js","assets/users-BM4bKDpT.js","assets/circle-alert-CtLBvLPB.js","assets/eye-5y2uPyBn.js","assets/check-BSDtehIQ.js","assets/download-nVPrd6Ks.js","assets/DialogTitle.vue_vue_type_script_setup_true_lang-BTwjwsHf.js","assets/x-DxpWGJqH.js","assets/DialogFooter.vue_vue_type_script_setup_true_lang-Bd583s7e.js","assets/Label.vue_vue_type_script_setup_true_lang-C18rjiYc.js","assets/type-DTuina14.js","assets/minus-DlFTaqDB.js","assets/list-B4RL7yBM.js","assets/RichTextEditor-DYzABef7.css","assets/search-gmPLkDv5.js","assets/Checkbox.vue_vue_type_script_setup_true_lang-Dhk72CqI.js","assets/ohash.D__AXeF1-C-E83dC9.js","assets/RovingFocusItem-7Pn4sKcg.js","assets/file-text-CFGSCE65.js","assets/refresh-cw-Dn0QcLEG.js","assets/UserInfo.vue_vue_type_script_setup_true_lang-Lg03Q3eS.js","assets/AppLayout.vue_vue_type_script_setup_true_lang-mJi7KbVb.js","assets/coins-kxq0_VHb.js","assets/log-out-UCKehK-q.js","assets/AppLogo.vue_vue_type_script_setup_true_lang-D_sjVztu.js","assets/library-DCJPO3Gx.js","assets/Sonner.vue_vue_type_script_setup_true_lang-BRU9uEi-.js","assets/triangle-alert-B0pqqksE.js","assets/circle-check-BnkgVZ8x.js","assets/sun-BPG5VYn8.js","assets/PurchaseModal.vue_vue_type_script_setup_true_lang-CBZnnn1t.js","assets/sparkles-B00DqvF1.js","assets/arrow-right-hohRvIeY.js","assets/useChapterWordCount-CktTGw2e.js","assets/toNumber-Bl5pTOaw.js","assets/save-BrZfnkYJ.js","assets/zap-BmyVnEYR.js","assets/pen-tool-DHgBad7e.js","assets/arrow-left-D4rZFUXt.js","assets/menu-DawWGxSZ.js","assets/minimize-2-pmNB9HNu.js","assets/message-square-D0XP4ChL.js","assets/MobileNavOverlay-CN-XSdXy.css","assets/CitationVerificationLayout-RN8XDsp3.js","assets/SafeHtmlText.vue_vue_type_script_setup_true_lang-AJbLW2OQ.js"])))=>i.map(i=>d[i]);
import{aA as Qs,ae as Ks,W as Vs,f as ne,B as S,Z as It,b as R,P as K,O as Z,i as je,I as Me,af as re,d as Oe,y as Js,c as O,o as E,K as r,u as e,a as N,w as n,F as s,M as f,H as b,n as He,D as Te,G as Le,L as X,a8 as Pe,Y as Xs,J as Ys,N as Et,aB as et,a3 as Qe,aC as Zs,Q as Tt,k as er,aD as tt}from"./app-Bo97tXR7.js";import{_ as Ee}from"./index-DbvdGjWg.js";import{c as Ut,_ as A}from"./index-D3d1G8kJ.js";import{_ as ee,a as te}from"./CardContent.vue_vue_type_script_setup_true_lang-OLZW0R35.js";import{_ as se,a as oe}from"./CardTitle.vue_vue_type_script_setup_true_lang-D_luTp_a.js";import{a as $t}from"./ScrollArea.vue_vue_type_script_setup_true_lang-NWvPXL4H.js";import{_ as Be}from"./Separator.vue_vue_type_script_setup_true_lang-DQnO4z8s.js";import{a as le,b as ie,_ as de}from"./UserInfo.vue_vue_type_script_setup_true_lang-Lg03Q3eS.js";import{r as tr,u as sr,a as Dt,_ as At,b as rr}from"./AppLayout.vue_vue_type_script_setup_true_lang-mJi7KbVb.js";import{t as P}from"./index-BxsHf2vm.js";import{_ as nr}from"./PurchaseModal.vue_vue_type_script_setup_true_lang-CBZnnn1t.js";import{a as ar,u as or,b as lr}from"./useChapterWordCount-CktTGw2e.js";import{t as jt}from"./toNumber-Bl5pTOaw.js";import{_ as ir}from"./Input.vue_vue_type_script_setup_true_lang-UF9MSFTy.js";import{_ as dr}from"./Label.vue_vue_type_script_setup_true_lang-C18rjiYc.js";import{az as ur,aA as cr,aB as pr,aC as gr,aD as fr,aE as mr,aF as hr,aG as vr,aH as br,aI as xr,aJ as wr,aK as yr,aL as _r,aM as Cr,aa as Qt,av as kr,ap as Sr}from"./RichTextEditor-AU3K_MPZ.js";import{_ as ot}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{E as Kt}from"./eye-5y2uPyBn.js";import{S as Vt}from"./save-BrZfnkYJ.js";import{C as at}from"./circle-check-big-BrGBqWsd.js";import{_ as Mt,a as Ft,b as Lt}from"./CollapsibleTrigger.vue_vue_type_script_setup_true_lang--_YdoWkg.js";import{_ as Er}from"./Progress.vue_vue_type_script_setup_true_lang-Bsdp52pg.js";import{W as Tr,b as $r,u as Dr,_ as st,a as Ar,P as jr}from"./useTextHistory-BD2S9UIX.js";import{B as Fe}from"./brain-Cqeg3r8V.js";import{Z as Mr}from"./zap-BmyVnEYR.js";import{C as Pt}from"./chevron-down-3G8i5M-G.js";import{P as Rt}from"./pen-tool-DHgBad7e.js";import{R as Fr}from"./refresh-cw-Dn0QcLEG.js";import{C as Lr}from"./circle-check-BnkgVZ8x.js";import{S as Pr}from"./sparkles-B00DqvF1.js";import{T as Rr}from"./type-DTuina14.js";import{A as rt}from"./arrow-left-D4rZFUXt.js";import{M as zt}from"./menu-DawWGxSZ.js";import{M as Wt,a as Nt}from"./minimize-2-pmNB9HNu.js";import{M as Gt,S as Bt}from"./sun-BPG5VYn8.js";import{S as Ht}from"./search-gmPLkDv5.js";import{a as zr,P as Wr}from"./AlertDialogTitle.vue_vue_type_script_setup_true_lang-iU3BsOhj.js";import{M as Nr}from"./message-square-D0XP4ChL.js";var nt=function(){return Qs.Date.now()},Gr="Expected a function",Br=Math.max,Hr=Math.min;function Or(x,w,l){var D,c,g,y,m,C,i=0,_=!1,p=!1,u=!0;if(typeof x!="function")throw new TypeError(Gr);w=jt(w)||0,Ks(l)&&(_=!!l.leading,p="maxWait"in l,g=p?Br(jt(l.maxWait)||0,w):g,u="trailing"in l?!!l.trailing:u);function d(a){var h=D,G=c;return D=c=void 0,i=a,y=x.apply(G,h),y}function T(a){return i=a,m=setTimeout(M,w),_?d(a):y}function z(a){var h=a-C,G=a-i,H=w-h;return p?Hr(H,g-G):H}function j(a){var h=a-C,G=a-i;return C===void 0||h>=w||h<0||p&&G>=g}function M(){var a=nt();if(j(a))return $(a);m=setTimeout(M,z(a))}function $(a){return m=void 0,u&&D?d(a):(D=c=void 0,y)}function W(){m!==void 0&&clearTimeout(m),i=0,D=C=c=m=void 0}function q(){return m===void 0?y:$(nt())}function v(){var a=nt(),h=j(a);if(D=arguments,c=this,C=a,h){if(m===void 0)return T(C);if(p)return clearTimeout(m),m=setTimeout(M,w),d(C)}return m===void 0&&(m=setTimeout(M,w)),y}return v.cancel=W,v.flush=q,v}/**
 * @license lucide-vue-next v0.468.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Jt=Ut("BookCheckIcon",[["path",{d:"M4 19.5v-15A2.5 2.5 0 0 1 6.5 2H19a1 1 0 0 1 1 1v18a1 1 0 0 1-1 1H6.5a1 1 0 0 1 0-5H20",key:"k3hazp"}],["path",{d:"m9 9.5 2 2 4-4",key:"1dth82"}]]);/**
 * @license lucide-vue-next v0.468.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const qr=Ut("PenIcon",[["path",{d:"M21.174 6.812a1 1 0 0 0-3.986-3.987L3.842 16.174a2 2 0 0 0-.5.83l-1.321 4.352a.5.5 0 0 0 .623.622l4.353-1.32a2 2 0 0 0 .83-.497z",key:"1a8usu"}]]);function Ir(x){const w=Vs();ne(()=>w.props?.flash,I=>{I&&(I.success&&P.success(I.success),I.error&&P.error(I.error))},{deep:!0,immediate:!0});const l=S(x.chapter.title||""),D=S(x.chapter.content||""),c=S(!0),{isDark:g,toggle:y}=It(),m=R(()=>g.value),C=()=>{},i=()=>{y()},_=S(!1),p=S(!1),u=S(!1),d=S("write"),T=S(""),z=S(0),j=S(!1),M=S(!1),$=S(!0),W=()=>{try{return localStorage.getItem(`chatMode_${x.project.id}_${x.chapter.chapter_number}`)==="true"}catch(I){return console.warn("Failed to load chat mode from localStorage:",I),!1}},q=I=>{try{localStorage.setItem(`chatMode_${x.project.id}_${x.chapter.chapter_number}`,String(I))}catch(Y){console.warn("Failed to save chat mode to localStorage:",Y)}},v=S(!1),a=S(!1),h=S(!1),G=S(!1),H=S(!1),V=S(!0),ve=S(!0);return{chapterTitle:l,chapterContent:D,showPreview:c,isEditorDark:m,initChapterTheme:C,toggleChapterTheme:i,isNativeFullscreen:_,showAISidebar:p,showStatistics:u,activeTab:d,selectedText:T,cursorPosition:z,showChatMode:j,showCitationMode:M,showDefensePrep:$,loadChatModeFromStorage:W,saveChatModeToStorage:q,showLeftSidebar:v,showRightSidebar:a,isMobile:h,isLeftSidebarCollapsed:G,isRightSidebarCollapsed:H,showLeftSidebarInFullscreen:V,showRightSidebarInFullscreen:ve}}function Ur({props:x,allChapters:w,targetWordCount:l,estimates:D,ensureBalance:c,save:g}){return{generateNextChapter:async()=>{const m=D.chapter(l.value||0);if(!c(m,"generate the next chapter with AI"))return;await g();const C=w.map(p=>p.chapter_number).sort((p,u)=>p-u),i=C.indexOf(x.chapter.chapter_number);let _;if(i===-1||i===C.length-1)_=Math.max(...C)+1;else{const p=C[i+1];p===x.chapter.chapter_number+1?_=p:_=x.chapter.chapter_number+1}try{const p=K("chapters.write",{project:x.project.slug,chapter:_}),u=new URL(p,window.location.origin);u.searchParams.set("ai_generate","true"),u.searchParams.set("generation_type","progressive"),Z.visit(u.toString())}catch(p){console.error("âŒ Error generating next chapter:",p)}}}}function Qr(x,w,l,D){const g=S(!1),y=S(0),m=S(!1),C=h=>{if(!h)return 0;const H=h.replace(/<[^>]*>/g,"").trim().replace(/\s+/g," ");if(!H)return 0;const V=H.match(/\b\w+\b/g);return V?V.length:0},i=R(()=>C(l.value)),_=R(()=>i.value>=800),p=()=>`defense_generation_triggered_${x.id}_ch_${w.chapter_number}`,u=()=>{const h=p();return localStorage.getItem(h)==="true"},d=()=>{const h=p();localStorage.setItem(h,"true"),g.value=!0},T=()=>{const h=p();localStorage.removeItem(h),g.value=!1,console.log(`ðŸ”„ DEFENSE WATCHER: Reset generation trigger for Chapter ${w.chapter_number}`)},z=Or(async()=>{if(!m.value)return;const h=i.value;console.log(`ðŸ“Š DEFENSE WATCHER: Word count check - Chapter ${w.chapter_number}: ${h} words`),h<800*.8&&g.value&&(console.log("â¬‡ï¸ DEFENSE WATCHER: Content dropped below 80% of threshold, resetting trigger"),T()),y.value=h},2e3),j=()=>m.value?void 0:(m.value=!0,g.value=u(),y.value=i.value,console.log(`ðŸ‘€ DEFENSE WATCHER: Started watching Chapter ${w.chapter_number}`),console.log(`   Initial word count: ${y.value}`),console.log(`   Generation already triggered: ${g.value}`),console.log("   Threshold: 800 words"),ne(l,(G,H)=>{G!==H&&z()},{immediate:!1})),M=()=>{m.value=!1,z.cancel(),console.log(`ðŸ›‘ DEFENSE WATCHER: Stopped watching Chapter ${w.chapter_number}`)},$=async()=>{console.log(`ðŸ” DEFENSE WATCHER: Force checking Chapter ${w.chapter_number}`),await z(),z.flush()},W=R(()=>{const h=i.value;return h>0&&h<800&&!g.value}),q=R(()=>{const h=i.value/800*100;return Math.min(h,100)}),v=R(()=>{const h=800-i.value;return Math.max(h,0)});return{isWatching:m,hasTriggeredGeneration:g,currentWordCount:i,lastWordCount:y,meetsThreshold:_,shouldShowProgressIndicator:W,progressPercentage:q,wordsRemaining:v,startWatching:j,stopWatching:M,forceCheck:$,resetGenerationTrigger:T,markGenerationTriggered:d,getStatusMessage:()=>{const h=i.value;return g.value?`Defense questions available (${h} words)`:h>=800?`Ready for defense questions (${h} words)`:h>0?`${800-h} more words needed for defense questions`:"Start writing to enable defense questions (800 words needed)"},countWords:C,DEFENSE_WORD_COUNT_THRESHOLD:800}}function Kr({props:x,chapterContent:w,currentWordCount:l,ensureBalance:D,estimates:c}){const g=S([]),y=S(!1),m=S(!1),C=S(null),i=S(!1),_=R(()=>x.chapter),{hasTriggeredGeneration:p,startWatching:u,stopWatching:d,forceCheck:T,getStatusMessage:z,markGenerationTriggered:j,meetsThreshold:M,shouldShowProgressIndicator:$,progressPercentage:W,wordsRemaining:q,DEFENSE_WORD_COUNT_THRESHOLD:v}=Qr(x.project,x.chapter,w),a=(F,B)=>`defense_auto_generate_${F}_ch_${B}`,h=()=>{try{return localStorage.getItem(a(x.project.id,x.chapter.chapter_number))==="true"}catch(F){return console.warn("Failed to load defense auto-generation preference:",F),!1}},G=F=>{try{localStorage.setItem(a(x.project.id,x.chapter.chapter_number),String(F))}catch(B){console.warn("Failed to save defense auto-generation preference:",B)}};i.value=h();const H=()=>{if(!g.value.length||!C.value)return!0;const F=new Date(Date.now()-360*60*1e3);return C.value<F},V=async(F=!1,B={})=>{if(y.value)return;const U=B.skipGeneration??!0;y.value=!0;try{console.log("Loading defense questions with params:",{project_id:x.project.id,chapter_number:_.value?.chapter_number,limit:5,force_refresh:F,skip_generation:U});const L=await re.get(`/api/projects/${x.project.id}/defense/questions`,{params:{chapter_number:_.value?.chapter_number||null,limit:5,force_refresh:F?1:0,skip_generation:U?1:0},headers:{Accept:"application/json","X-Requested-With":"XMLHttpRequest"}});if(console.log("Defense questions loaded:",L.data),g.value=L.data.questions||[],C.value=new Date,L.data.questions&&L.data.questions.length>0){const J=`defense_questions_${x.project.id}_chapter_${_.value?.chapter_number}`;localStorage.setItem(J,JSON.stringify({questions:L.data.questions,chapter_number:_.value?.chapter_number,loaded_at:new Date().toISOString()}))}else F||(console.log("No existing questions found for this chapter"),console.log(`Current word count: ${l.value}/${v}`),console.log('User must click "Generate Questions" button to create defense questions'))}catch(L){if(console.error("Failed to load defense questions:",L),L.response)if(console.error("Response status:",L.response.status),console.error("Response data:",L.response.data),L.response.status===422){const J=Object.values(L.response.data.errors||{})[0];J&&Array.isArray(J)?P.error(`Validation Error: ${J[0]}`):P.error("Invalid request parameters. Please refresh the page.")}else L.response.status===500?P.error("Server error. Please try again later."):P.error("Failed to load defense questions");else L.request?(console.error("No response received:",L.request),P.error("Network error. Please check your connection.")):(console.error("Error setting up request:",L.message),P.error("An unexpected error occurred"));g.value=[]}finally{y.value=!1}},ve=F=>F?F.replace(/<[^>]*>/g," ").trim().split(/\s+/).filter(B=>B.length>0).length:0,I=async(F={})=>{if(m.value)return;const B=F.autoTriggered??!1,U=c.defense();if(D(U,"generate defense questions")){m.value=!0;try{const L=await re.post(`/api/projects/${x.project.id}/defense/questions/generate`,{chapter_number:_.value.chapter_number},{headers:{"X-CSRF-TOKEN":document.querySelector('meta[name="csrf-token"]')?.getAttribute("content"),Accept:"application/json","Content-Type":"application/json"}});if(L.data&&L.data.questions){g.value=L.data.questions,C.value=new Date;const J=L.data.questions.reduce((ze,xe)=>{const We=ve(xe.question),Ke=ve(xe.suggested_answer),we=(xe.key_points||[]).reduce((ye,ue)=>ye+ve(ue),0);return ze+We+Ke+we},0),Re=`defense_questions_${x.project.id}_chapter_${_.value?.chapter_number}`;localStorage.setItem(Re,JSON.stringify({questions:L.data.questions,chapter_number:_.value?.chapter_number,loaded_at:new Date().toISOString()})),P.success(`Generated ${L.data.questions.length} new questions`),tr(J||c.defense(),"Defense questions","chapter",x.chapter.id).catch(ze=>console.error("Failed to record word usage (defense):",ze)),p.value=!0,j(),B&&console.log("Auto-generated defense questions after meeting threshold.")}}catch(L){console.error("Failed to generate defense questions:",L),P.error("Failed to generate defense questions")}finally{m.value=!1}}},Y=async()=>{!i.value||m.value||y.value||p.value||!M.value||g.value.length>0||await I({autoTriggered:!0})},qe=F=>{i.value=F,G(F),F&&Y()},$e=async(F,B)=>{try{await re.patch(`/api/projects/${x.project.id}/defense/questions/${F}`,{user_marked_helpful:B},{headers:{"X-CSRF-TOKEN":document.querySelector('meta[name="csrf-token"]')?.getAttribute("content"),Accept:"application/json","Content-Type":"application/json"}});const U=g.value.find(L=>L.id===F);U&&(U.user_marked_helpful=B),P.success(B?"Question marked as helpful":"Removed helpful mark")}catch(U){console.error("Failed to mark question:",U),P.error("Failed to update question")}},De=async F=>{try{await re.delete(`/api/projects/${x.project.id}/defense/questions/${F}`,{headers:{"X-CSRF-TOKEN":document.querySelector('meta[name="csrf-token"]')?.getAttribute("content"),Accept:"application/json"}}),g.value=g.value.filter(B=>B.id!==F),localStorage.setItem(`defense_questions_${x.project.id}`,JSON.stringify({questions:g.value,loaded_at:new Date().toISOString()})),P.success("Question hidden")}catch(B){console.error("Failed to hide question:",B),P.error("Failed to hide question")}},be=async()=>{const F=`defense_questions_${x.project.id}_chapter_${_.value?.chapter_number}`,B=localStorage.getItem(F);let U=!0;if(B){const L=JSON.parse(B),J=new Date(L.loaded_at),Re=new Date(Date.now()-360*60*1e3);J>Re&&L.chapter_number===_.value?.chapter_number&&(g.value=L.questions,C.value=J,U=!1)}U&&await V(!1,{skipGeneration:!0})};return ne(()=>x.chapter,async()=>{g.value=[],d(),u(),i.value=h(),await V(!1,{skipGeneration:!0}),await je(()=>{T(),Y()})},{immediate:!1}),ne([l,i],()=>{Y()}),Me(async()=>{await be(),u(),await je(()=>{T(),Y()})}),{defenseQuestions:g,isLoadingDefenseQuestions:y,isGeneratingDefenseQuestions:m,autoGenerateDefense:i,shouldLoadDefenseQuestions:H,loadDefenseQuestions:V,generateNewDefenseQuestions:I,markQuestionHelpful:$e,hideQuestion:De,handleDefenseAutoToggle:qe,attemptAutoGenerateDefense:Y,getDefenseStatusMessage:z,shouldShowDefenseProgress:$,defenseProgressPercentage:W,defenseWordsRemaining:q,hasTriggeredGeneration:p,meetsDefenseThreshold:M}}const Vr={class:"bg-background"},Jr=Oe({__name:"RichTextViewer",props:{content:{},showFontControls:{type:Boolean,default:!0}},setup(x){const w=ur(Cr),l=x,D=i=>i?(i=i.replace(/```mermaid\n?([\s\S]*?)```/g,(_,p)=>{const u=p.trim();return`<div data-mermaid data-mermaid-code="${u.replace(/&/g,"&amp;").replace(/"/g,"&quot;").replace(/</g,"&lt;").replace(/>/g,"&gt;")}" data-view-mode="diagram"><pre><code class="language-mermaid">${u}</code></pre></div>`}),i=i.replace(/``mermaid\n?([\s\S]*?)``/g,(_,p)=>{const u=p.trim();return`<div data-mermaid data-mermaid-code="${u.replace(/&/g,"&amp;").replace(/"/g,"&quot;").replace(/</g,"&lt;").replace(/>/g,"&gt;")}" data-view-mode="diagram"><pre><code class="language-mermaid">${u}</code></pre></div>`}),i=i.replace(/`mermaid\n([\s\S]*?)`/g,(_,p)=>{const u=p.trim();return`<div data-mermaid data-mermaid-code="${u.replace(/&/g,"&amp;").replace(/"/g,"&quot;").replace(/</g,"&lt;").replace(/>/g,"&gt;")}" data-view-mode="diagram"><pre><code class="language-mermaid">${u}</code></pre></div>`}),i):"",c=i=>i?(i=i.replace(/```(\w+)\n?([\s\S]*?)```/g,(_,p,u)=>`<pre><code class="language-${p}">${u.trim()}</code></pre>`),i=i.replace(/```\n?([\s\S]*?)```/g,(_,p)=>`<pre><code>${p.trim()}</code></pre>`),i):"",g=i=>{if(!i)return"";const _=i.split(`
`);let p=[],u=0;for(;u<_.length;){const d=_[u];if(d.includes("|")){const T=y(_,u);if(T.html){p.push(T.html),u=T.nextIndex;continue}}p.push(d),u++}return p.join(`
`)},y=(i,_)=>{let p=i[_];if(!p||!p.includes("|"))return{html:null,nextIndex:_+1};const u=p.split("|").map(M=>M.trim()).filter(M=>M.length>0);if(u.length===0)return{html:null,nextIndex:_+1};const d=i[_+1];if(!d||!d.includes("|")||!d.includes("-"))return{html:null,nextIndex:_+1};let T=[],z=_+2;for(;z<i.length;){const M=i[z];if(!M||!M.includes("|"))break;const $=M.split("|").map(W=>W.trim()).filter(W=>W.length>0);$.length>0&&T.push($),z++}let j='<div class="tableWrapper"><table>';return j+="<thead><tr>",u.forEach(M=>{j+=`<th>${M}</th>`}),j+="</tr></thead>",T.length>0&&(j+="<tbody>",T.forEach(M=>{j+="<tr>";for(let $=0;$<u.length;$++){const W=M[$]||"";j+=`<td>${W}</td>`}j+="</tr>"}),j+="</tbody>"),j+="</table></div>",{html:j,nextIndex:z}},m=i=>{if(!i)return"";if(i.includes("<p>")||i.includes("<h1>")||i.includes("<h2>")||i.includes("<div>")){let d=D(i);return d=c(d),d}let p=i;return p=D(p),p=c(p),p=p.replace(/^#### (.*$)/gim,"<h4>$1</h4>"),p=p.replace(/^### (.*$)/gim,"<h3>$1</h3>"),p=p.replace(/^## (.*$)/gim,"<h2>$1</h2>"),p=p.replace(/^# (.*$)/gim,"<h1>$1</h1>"),p=p.replace(/\*\*(.*?)\*\*/g,"<strong>$1</strong>"),p=p.replace(new RegExp("(?<!\\*)\\*([^*\\n]+?)\\*(?!\\*)","g"),"<em>$1</em>"),p=p.replace(/`([^`]+)`/g,"<code>$1</code>"),p=g(p),p.split(/\n\s*\n/).filter(d=>d.trim()).map(d=>{const T=d.trim();if(T.startsWith("<h1>")||T.startsWith("<h2>")||T.startsWith("<h3>")||T.startsWith("<h4>"))return T;if(T.includes(`
`)){const j=T.split(`
`).map(W=>W.trim()).filter(W=>W),M=j.some(W=>W.match(/^\d+\.\s/)),$=j.some(W=>W.match(/^[-*]\s/));if(M||$){const W=j.map(a=>a.match(/^\d+\.\s/)?`<li>${a.replace(/^\d+\.\s/,"")}</li>`:a.match(/^[-*]\s/)?`<li>${a.replace(/^[-*]\s/,"")}</li>`:a);let q=[],v="";for(const a of W)a.startsWith("<li>")?(v&&q.push(v),v=a):v&&(v=v.replace("</li>",` ${a}</li>`));return v&&q.push(v),M?`<ol>${q.join("")}</ol>`:`<ul>${q.join("")}</ul>`}}return`<p>${T.replace(/\n/g,"<br>")}</p>`}).join("")},C=cr({content:m(l.content),editable:!1,extensions:[pr.configure({heading:{levels:[1,2,3]},codeBlock:!1}),gr.configure({lowlight:w,HTMLAttributes:{class:"code-block-highlighted"}}),fr,mr,hr,vr.configure({resizable:!0}),br,xr,wr,yr],editorProps:{attributes:{class:"prose prose-sm dark:prose-invert max-w-none focus:outline-none"}}});return S("12"),Me(()=>{setTimeout(()=>{C.value&&C.value.chain().selectAll().setFontSize("12pt").run()},100)}),ne(()=>l.content,i=>{if(C.value&&C.value.getHTML()!==i){const _=m(i);C.value.commands.setContent(_)}}),Js(()=>{C.value&&C.value.destroy()}),(i,_)=>(E(),O("div",Vr,[r(e(_r),{editor:e(C)},null,8,["editor"])]))}}),Xt=ot(Jr,[["__scopeId","data-v-87fd46f8"]]),Xr={class:"flex items-center justify-between"},Yr={class:"space-y-1 w-full max-w-[520px]"},Zr={class:"flex items-center justify-between gap-3"},en={class:"flex flex-col"},tn={class:"flex items-center gap-2"},sn={class:"flex items-center justify-between px-6 py-2 border-b border-border/30 bg-muted/5"},rn={class:"flex items-center gap-2"},nn={class:"space-y-1 relative z-10"},an={class:"text-sm font-medium text-foreground"},on={class:"text-[10px] text-muted-foreground line-clamp-2 leading-relaxed"},ln={class:"flex-1 relative bg-background"},dn={class:"px-12 py-10 min-h-[500px]"},un={class:"sticky bottom-0 z-10 border-t border-border/30 bg-background/80 backdrop-blur-md p-4 flex items-center justify-between"},cn={class:"text-xs text-muted-foreground"},pn={class:"flex items-center gap-2"},Ot=Oe({__name:"ChapterEditorPaperCard",props:{context:{}},setup(x){const l=x.context,D=R(()=>{const y=l.getSectionInfo(l.nextSection);return l.aiChapterAnalysis?.section||y}),c=R(()=>D.value?.name||""),g=R(()=>D.value?.description||"");return(y,m)=>(E(),N(e(ee),{class:"w-full max-w-[850px] min-h-[calc(100vh-180px)] flex flex-col bg-background shadow-xl shadow-black/5 ring-1 ring-black/5 dark:ring-white/10 rounded-xl overflow-hidden transition-all duration-300"},{default:n(()=>[r(e(se),{class:"flex-shrink-0 border-b border-border/30 px-8 py-6 bg-background/50 backdrop-blur-sm sticky top-0 z-10"},{default:n(()=>[s("div",Xr,[s("div",Yr,[s("div",Zr,[s("div",en,[r(e(dr),{for:"chapter-title",class:"text-xs font-medium text-zinc-500 dark:text-zinc-400 uppercase tracking-wider"},{default:n(()=>[...m[3]||(m[3]=[f("Chapter Title",-1)])]),_:1}),r(e(ir),{id:"chapter-title",modelValue:e(l).chapterTitle,"onUpdate:modelValue":m[0]||(m[0]=C=>e(l).chapterTitle=C),placeholder:"Enter chapter title...",class:"h-auto p-0 border-0 bg-transparent text-2xl font-bold placeholder:text-muted-foreground/40 focus-visible:ring-0 px-0 text-foreground"},null,8,["modelValue"])]),s("div",tn,[r(e(Ee),{variant:e(l).chapter.status==="approved"?"default":"secondary",class:"rounded-full px-3"},{default:n(()=>[f(b(e(l).chapter.status.replace("_"," ")),1)]),_:1},8,["variant"]),r(e(Ee),{variant:"outline",class:He(["rounded-full px-3 transition-colors",{"text-green-600 border-green-200 bg-green-50 dark:bg-green-900/20 dark:border-green-800":(e(l).latestAnalysis?.total_score||0)>=80,"text-yellow-600 border-yellow-200 bg-yellow-50 dark:bg-yellow-900/20 dark:border-yellow-800":(e(l).latestAnalysis?.total_score||0)>=70&&(e(l).latestAnalysis?.total_score||0)<80,"text-orange-600 border-orange-200 bg-orange-50 dark:bg-orange-900/20 dark:border-orange-800":(e(l).latestAnalysis?.total_score||0)>=60&&(e(l).latestAnalysis?.total_score||0)<70,"text-red-600 border-red-200 bg-red-50 dark:bg-red-900/20 dark:border-red-800":(e(l).latestAnalysis?.total_score||0)<60}])},{default:n(()=>[f(b(e(l).latestAnalysis?.total_score?Math.round(e(l).latestAnalysis.total_score):e(l).writingQualityScore)+"% Quality ",1)]),_:1},8,["class"])])])])])]),_:1}),r(e(te),{class:"flex min-h-0 flex-1 flex-col p-0"},{default:n(()=>[s("div",sn,[s("div",rn,[r(e(A),{onClick:e(l).togglePresentationMode,variant:e(l).showPresentationMode?"default":"ghost",size:"sm",class:"h-7 text-xs rounded-full text-zinc-700 dark:text-zinc-300 hover:text-foreground"},{default:n(()=>[r(e(Kt),{class:"mr-1.5 h-3.5 w-3.5"}),f(" "+b(e(l).showPresentationMode?"Edit":"Preview"),1)]),_:1},8,["onClick","variant"])]),s("div",nn,[s("div",an,b(c.value),1),s("div",on,b(g.value),1)])]),s("div",ln,[Te(r(Qt,{modelValue:e(l).chapterContent,"onUpdate:modelValue":m[1]||(m[1]=C=>e(l).chapterContent=C),placeholder:"Start writing your chapter...","min-height":"500px",class:"min-h-[500px] px-8 py-6",ref:e(l).richTextEditor,"show-toolbar":!0,"streaming-mode":e(l).isStreamingMode,"is-generating":e(l).isGenerating,"generation-progress":e(l).generationProgress,"generation-percentage":e(l).generationPercentage,"generation-phase":e(l).generationPhase,"onUpdate:selectedText":e(l).setSelectedText},null,8,["modelValue","streaming-mode","is-generating","generation-progress","generation-percentage","generation-phase","onUpdate:selectedText"]),[[Le,!e(l).showPresentationMode]]),Te(s("div",dn,[r(Xt,{content:e(l).chapterContent,"show-font-controls":!1,class:"prose-lg mx-auto",style:{"font-family":"'Times New Roman', serif","line-height":"1.8"}},null,8,["content"])],512),[[Le,e(l).showPresentationMode]])])]),_:1}),s("div",un,[s("div",cn,b(e(l).isSaving?"Saving...":"All changes saved"),1),s("div",pn,[r(e(A),{onClick:m[2]||(m[2]=()=>e(l).save(!1)),disabled:!e(l).isValid||e(l).isSaving,size:"sm",variant:"ghost",class:"h-8 rounded-full text-zinc-700 dark:text-zinc-300 hover:text-foreground"},{default:n(()=>[r(e(Vt),{class:"mr-2 h-3.5 w-3.5"}),m[4]||(m[4]=f(" Save Draft ",-1))]),_:1},8,["disabled"]),r(e(A),{onClick:e(l).goToBulkAnalysis,variant:"outline",size:"sm",class:"h-8 rounded-full"},{default:n(()=>[r(e(Jt),{class:"mr-2 h-3.5 w-3.5"}),m[5]||(m[5]=f(" Run Bulk Analysis ",-1))]),_:1},8,["onClick"]),r(e(A),{onClick:e(l).markAsComplete,disabled:e(l).isSaving,size:"sm",class:"h-8 rounded-full bg-gradient-to-r from-primary to-primary/90 shadow-sm hover:shadow-md transition-all"},{default:n(()=>[r(e(at),{class:"mr-2 h-3.5 w-3.5"}),m[6]||(m[6]=f(" Complete ",-1))]),_:1},8,["onClick","disabled"])])])]),_:1}))}}),gn={class:"flex flex-col gap-4 p-1"},fn={class:"p-1.5 rounded-lg bg-primary/10 text-primary"},mn={class:"flex items-center gap-2"},hn={class:"space-y-3"},vn={class:"flex items-center gap-2"},bn={class:"font-semibold"},xn={class:"text-[10px] opacity-70 font-normal"},wn={key:0,class:"space-y-2"},yn={class:"flex items-center justify-between w-full relative z-10"},_n={class:"flex items-center gap-2 text-primary"},Cn={class:"space-y-1 relative z-10"},kn={class:"text-sm font-medium text-foreground"},Sn={class:"text-[10px] text-muted-foreground line-clamp-2 leading-relaxed"},En={key:0,class:"p-4 rounded-xl bg-green-500/10 border border-green-500/20 space-y-3"},Tn={class:"flex items-center gap-2 text-green-600 dark:text-green-400"},$n={class:"space-y-2"},Dn={class:"flex justify-between text-[10px] font-medium text-muted-foreground"},An={class:"grid grid-cols-2 gap-2 mt-2"},jn={class:"p-1.5 rounded-full bg-blue-500/10 text-blue-500"},Mn={class:"p-1.5 rounded-full bg-purple-500/10 text-purple-500"},Fn={class:"p-1.5 rounded-full bg-orange-500/10 text-orange-500"},Ln={class:"p-1.5 rounded-full bg-emerald-500/10 text-emerald-500"},Pn={class:"flex items-center gap-2"},Rn={class:"p-1 rounded-xl bg-muted/30 border border-border/50"},zn=Oe({__name:"AISidebar",props:{project:{},chapter:{},isGenerating:{type:Boolean},selectedText:{},isLoadingSuggestions:{type:Boolean},showCitationHelper:{type:Boolean},chapterContent:{},cursorPosition:{},currentWordCount:{},targetWordCount:{}},emits:["startStreamingGeneration","getAISuggestions","update:showCitationHelper","insert-citation","checkCitations"],setup(x,{emit:w}){const l=x,D=w,c=S("Academic Formal"),g=S(null),y=S(!1),m=S({expand:!1,improve:!1,rephrase:!1,cite:!1,"generate-full":!1,"generate-section":!1}),C=R(()=>!!l.chapter?.id&&!!l.chapter?.chapter_number),i=R(()=>l.chapterContent&&l.chapterContent.trim().length>0),_=R(()=>!i.value&&C.value),p=R(()=>!g.value&&C.value),u=R(()=>!l.isGenerating&&!!l.chapterContent);R(()=>!l.isLoadingSuggestions&&!!l.selectedText);const d=R(()=>g.value&&g.value.section.name!=="NONE"?g.value.section.name.toLowerCase().replace(/\s+/g,"_"):M()),T=R(()=>!l.isGenerating&&!!l.chapter?.id),z=()=>[{id:"introduction",name:"Introduction",description:"Overview and objectives of this chapter"},{id:"content",name:"Main Content",description:"Chapter main content"},{id:"conclusion",name:"Conclusion",description:"Summary and transition to next chapter"}],j=async(v,a)=>{if(Object.values(m.value).some(h=>h)){P("Please wait for the current action to complete");return}try{switch(v in m.value&&(m.value[v]=!0),v){case"expand":l.selectedText?(D("startStreamingGeneration","expand",{selectedText:l.selectedText}),P("Expanding selected text...")):P.error("Please select text to expand");break;case"improve":D("startStreamingGeneration","improve"),P("Improving chapter content...");break;case"rephrase":l.selectedText?(D("startStreamingGeneration","rephrase",{selectedText:l.selectedText,style:c.value}),P("Rephrasing selected text...")):P.error("Please select text to rephrase");break;case"cite":D("update:showCitationHelper",!0),P("Opening citation helper...");break;case"generate-full":D("startStreamingGeneration","progressive"),P("Generating complete chapter...");break;case"generate-section":const h=a?.section||d.value;D("startStreamingGeneration","section",{section:h,mode:"progressive"}),P(`Generating ${h} section...`);break;default:throw new Error(`Unknown action: ${v}`)}}catch(h){console.error(`Quick action '${v}' failed:`,h),P.error(`Failed to ${v.replace("-"," ")}. Please try again.`)}finally{setTimeout(()=>{v in m.value&&(m.value[v]=!1)},1e3)}},M=()=>{if(!i.value)return"introduction";const v=l.chapterContent.toLowerCase(),a=z();for(const h of a)if(![h.name.toLowerCase(),h.id.replace("_"," ")].some(V=>v.includes(V)))return h.id;return"conclusion"},$=v=>{const a=z();return a.find(h=>h.id===v)||a[0]},W=async()=>{if(y.value||!C.value)return;y.value=!0;const v=Date.now();try{const{data:a}=await re.post(`/api/projects/${l.project.id}/chapters/${l.chapter.id}/suggest-section?t=${Date.now()}`,{current_content:l.chapterContent||""}),h=Date.now()-v,G=Math.max(0,800-h);if(G>0&&await new Promise(H=>setTimeout(H,G)),a.success&&a.analysis){if(g.value=a.analysis,g.value.word_count_progress&&l.currentWordCount!==void 0){const H=l.targetWordCount||g.value.word_count_progress.target;g.value.word_count_progress.current=l.currentWordCount,g.value.word_count_progress.percentage=H>0?Math.round(l.currentWordCount/H*100*100)/100:0}console.log("âœ… Fresh chapter analysis complete:",{status:a.analysis.status,completion:a.analysis.completion_percentage,wordProgress:g.value.word_count_progress,usingLiveWordCount:l.currentWordCount!==void 0,usingStructuredData:a.structured||!0,cached:!1}),P.success("Chapter analyzed successfully")}else P.error("Failed to analyze chapter")}catch(a){console.error("Chapter analysis failed:",a),P.error("Failed to analyze chapter. Please try again.")}finally{y.value=!1}},q=v=>{D("insert-citation",v)};return ne(()=>l.chapter,v=>{v?.id&&(g.value=null)},{immediate:!1}),ne(()=>l.chapterContent,v=>{g.value&&(!v||v.trim().length===0)&&(g.value=null)},{immediate:!1}),(v,a)=>(E(),O("div",gn,[r(e(ee),{class:"border-none shadow-none bg-transparent"},{default:n(()=>[r(e(se),{class:"px-2 py-3"},{default:n(()=>[r(e(oe),{class:"flex items-center gap-2 text-sm font-semibold text-foreground/80"},{default:n(()=>[s("div",fn,[r(e(Fe),{class:"h-4 w-4"})]),a[8]||(a[8]=f(" AI Assistant ",-1))]),_:1})]),_:1}),r(e(te),{class:"px-2 space-y-6"},{default:n(()=>[r(e(Mt),{open:!0,class:"space-y-2"},{default:n(()=>[r(e(Ft),{class:"flex w-full items-center justify-between text-xs font-medium text-muted-foreground hover:text-foreground transition-colors group"},{default:n(()=>[s("span",mn,[r(e(Mr),{class:"h-3.5 w-3.5 text-amber-500/70 group-hover:text-amber-500 transition-colors"}),a[9]||(a[9]=f(" QUICK ACTIONS ",-1))]),r(e(Pt),{class:"h-3 w-3 transition-transform duration-200 group-data-[state=open]:rotate-180"})]),_:1}),r(e(Lt),{class:"space-y-3 pt-1"},{default:n(()=>[s("div",hn,[p.value?(E(),N(e(A),{key:0,onClick:W,disabled:v.isGenerating||y.value,class:"w-full h-auto flex-col gap-1.5 p-4 rounded-xl bg-gradient-to-br from-primary/10 via-primary/5 to-transparent border border-primary/10 hover:border-primary/30 text-primary hover:from-primary/15 transition-all duration-300 shadow-sm"},{default:n(()=>[s("div",vn,[r(e(Fe),{class:"h-4 w-4"}),s("span",bn,b(y.value?"Analyzing...":_.value?"Start Writing":"Analyze Chapter"),1)]),s("span",xn,b(_.value?"Get AI suggestions to begin":"Generate next steps & suggestions"),1)]),_:1},8,["disabled"])):X("",!0),r(Pe,{"enter-active-class":"transition-all duration-300 ease-out","enter-from-class":"opacity-0 scale-95 translate-y-1","enter-to-class":"opacity-100 scale-100 translate-y-0"},{default:n(()=>[g.value&&g.value.show_section_button?(E(),O("div",wn,[r(e(A),{onClick:a[0]||(a[0]=h=>j("generate-section")),disabled:!T.value||y.value||v.isGenerating||m.value["generate-section"],variant:"outline",class:"w-full h-auto flex-col items-start gap-2 p-3 rounded-xl border-primary/20 bg-background/50 hover:bg-primary/5 hover:border-primary/40 transition-all duration-300 text-left group relative overflow-hidden"},{default:n(()=>[a[11]||(a[11]=s("div",{class:"absolute inset-0 bg-gradient-to-r from-primary/5 to-transparent opacity-0 group-hover:opacity-100 transition-opacity"},null,-1)),s("div",yn,[s("div",_n,[r(e(Rt),{class:"h-3.5 w-3.5"}),a[10]||(a[10]=s("span",{class:"text-xs font-semibold"},"Write Next Section",-1))]),m.value["generate-section"]?(E(),N(e(Fr),{key:0,class:"h-3 w-3 animate-spin text-primary"})):X("",!0)]),s("div",Cn,[s("div",kn,b(g.value?.section.name||$(d.value).name),1),s("div",Sn,b(g.value?.section.description||$(d.value).description),1)])]),_:1},8,["disabled"])])):X("",!0)]),_:1}),r(Pe,{"enter-active-class":"transition-all duration-300 ease-out","enter-from-class":"opacity-0 scale-95 translate-y-1","enter-to-class":"opacity-100 scale-100 translate-y-0"},{default:n(()=>[g.value&&g.value.show_full_chapter_button?(E(),N(e(A),{key:0,onClick:a[1]||(a[1]=h=>j("generate-full")),disabled:v.isGenerating||y.value||m.value["generate-full"],variant:"ghost",class:"w-full h-9 justify-start gap-2 px-3 rounded-lg text-xs text-muted-foreground hover:text-primary hover:bg-primary/5"},{default:n(()=>[r(e(Tr),{class:"h-3.5 w-3.5"}),a[12]||(a[12]=s("span",null,"Generate Complete Chapter",-1))]),_:1},8,["disabled"])):X("",!0)]),_:1}),r(Pe,{"enter-active-class":"transition-all duration-500 ease-out","enter-from-class":"opacity-0 scale-95 translate-y-2","enter-to-class":"opacity-100 scale-100 translate-y-0"},{default:n(()=>[g.value&&g.value.status==="COMPLETE"?(E(),O("div",En,[s("div",Tn,[r(e(Lr),{class:"h-4 w-4"}),a[13]||(a[13]=s("span",{class:"text-sm font-semibold"},"Chapter Complete",-1))]),s("div",$n,[s("div",Dn,[a[14]||(a[14]=s("span",null,"Progress",-1)),s("span",null,b(g.value.completion_percentage)+"%",1)]),r(e(Er),{"model-value":g.value.completion_percentage,class:"h-1.5"},null,8,["model-value"])])])):X("",!0)]),_:1})]),s("div",An,[r(e(A),{onClick:a[2]||(a[2]=h=>j("improve")),disabled:!u.value||v.isGenerating||m.value.improve,variant:"outline",class:"h-20 flex-col gap-2 rounded-xl border-border/50 bg-background/50 hover:bg-accent hover:border-accent transition-all duration-300"},{default:n(()=>[s("div",jn,[r(e(Pr),{class:"h-4 w-4"})]),a[15]||(a[15]=s("span",{class:"text-xs font-medium"},"Improve",-1))]),_:1},8,["disabled"]),r(e(A),{onClick:a[3]||(a[3]=h=>j("expand")),disabled:!v.selectedText||v.isGenerating||m.value.expand,variant:"outline",class:"h-20 flex-col gap-2 rounded-xl border-border/50 bg-background/50 hover:bg-accent hover:border-accent transition-all duration-300"},{default:n(()=>[s("div",Mn,[r(e(kr),{class:"h-4 w-4"})]),a[16]||(a[16]=s("span",{class:"text-xs font-medium"},"Expand",-1))]),_:1},8,["disabled"]),r(e(A),{onClick:a[4]||(a[4]=h=>j("cite")),disabled:v.isGenerating||m.value.cite,variant:"outline",class:"h-20 flex-col gap-2 rounded-xl border-border/50 bg-background/50 hover:bg-accent hover:border-accent transition-all duration-300"},{default:n(()=>[s("div",Fn,[r(e(Sr),{class:"h-4 w-4"})]),a[17]||(a[17]=s("span",{class:"text-xs font-medium"},"Cite",-1))]),_:1},8,["disabled"]),r(e(A),{onClick:a[5]||(a[5]=h=>j("rephrase")),disabled:!v.selectedText||v.isGenerating||m.value.rephrase,variant:"outline",class:"h-20 flex-col gap-2 rounded-xl border-border/50 bg-background/50 hover:bg-accent hover:border-accent transition-all duration-300"},{default:n(()=>[s("div",Ln,[r(e(Rr),{class:"h-4 w-4"})]),a[18]||(a[18]=s("span",{class:"text-xs font-medium"},"Rephrase",-1))]),_:1},8,["disabled"])])]),_:1})]),_:1}),r(e(Be),{class:"bg-border/50"}),r(e(Mt),{open:!0,class:"space-y-2"},{default:n(()=>[r(e(Ft),{class:"flex w-full items-center justify-between text-xs font-medium text-muted-foreground hover:text-foreground transition-colors group"},{default:n(()=>[s("span",Pn,[r(e(Rt),{class:"h-3.5 w-3.5 text-indigo-500/70 group-hover:text-indigo-500 transition-colors"}),a[19]||(a[19]=f(" WRITING STYLE ",-1))]),r(e(Pt),{class:"h-3 w-3 transition-transform duration-200 group-data-[state=open]:rotate-180"})]),_:1}),r(e(Lt),{class:"pt-1"},{default:n(()=>[s("div",Rn,[Te(s("select",{"onUpdate:modelValue":a[6]||(a[6]=h=>c.value=h),class:"w-full bg-transparent border-none text-xs font-medium focus:ring-0 cursor-pointer py-1.5 px-2"},[...a[20]||(a[20]=[s("option",{value:"Academic Formal"},"Academic Formal",-1),s("option",{value:"Academic Casual"},"Academic Casual",-1),s("option",{value:"Technical"},"Technical",-1),s("option",{value:"Analytical"},"Analytical",-1),s("option",{value:"Research-Heavy"},"Research-Heavy",-1)])],512),[[Xs,c.value]])])]),_:1})]),_:1})]),_:1})]),_:1}),r($r,{"show-citation-helper":v.showCitationHelper,"chapter-content":v.chapterContent,"onUpdate:showCitationHelper":a[7]||(a[7]=h=>D("update:showCitationHelper",h)),onInsertCitation:q},null,8,["show-citation-helper","chapter-content"])]))}}),Wn=ot(zn,[["__scopeId","data-v-03da2601"]]),Nn={class:"h-14 flex items-center justify-between px-4 border-b border-border/40 shrink-0"},Gn={class:"flex-1 overflow-y-auto custom-scrollbar"},Bn={class:"p-4 space-y-6"},qt=Oe({__name:"ChapterEditorRightSidebar",props:{project:{},chapter:{},isGenerating:{type:Boolean},selectedText:{},isLoadingSuggestions:{type:Boolean},showCitationHelper:{type:Boolean},chapterContent:{},currentWordCount:{},targetWordCount:{},handleAIGeneration:{type:Function},getAISuggestions:{type:Function},updateCitationHelper:{type:Function},insertCitation:{type:Function},checkCitations:{type:Function},showDefensePrep:{type:Boolean},defenseQuestions:{},isLoadingDefenseQuestions:{type:Boolean},isGeneratingDefenseQuestions:{type:Boolean},chapterContext:{},defenseWatcher:{},autoGenerateDefense:{type:Boolean},handleDefensePanelToggle:{type:Function},generateNewDefenseQuestions:{type:Function},handleDefenseAutoToggle:{type:Function},refreshDefenseQuestions:{type:Function},markQuestionHelpful:{type:Function},hideQuestion:{type:Function},isCollapsed:{type:Boolean},containerClass:{}},setup(x){const w=x;return(l,D)=>Te((E(),O("aside",{class:He(w.containerClass)},[s("div",Nn,[D[1]||(D[1]=s("span",{class:"text-sm font-semibold tracking-tight text-foreground"},"Writing Assistant",-1)),r(e(de),null,{default:n(()=>[r(e(le),{asChild:""},{default:n(()=>[r(e(A),{variant:"ghost",size:"icon",class:"h-7 w-7"},{default:n(()=>[r(e(Jt),{class:"h-3.5 w-3.5"})]),_:1})]),_:1}),r(e(ie),null,{default:n(()=>[...D[0]||(D[0]=[f("Manage Citations",-1)])]),_:1})]),_:1})]),s("div",Gn,[s("div",Bn,[r(Wn,{project:w.project,chapter:w.chapter,"is-generating":w.isGenerating,"selected-text":w.selectedText,"is-loading-suggestions":w.isLoadingSuggestions,"show-citation-helper":w.showCitationHelper,"chapter-content":w.chapterContent,"current-word-count":w.currentWordCount,"target-word-count":w.targetWordCount,onStartStreamingGeneration:w.handleAIGeneration,onGetAiSuggestions:w.getAISuggestions,"onUpdate:showCitationHelper":w.updateCitationHelper,onInsertCitation:w.insertCitation,onCheckCitations:w.checkCitations},null,8,["project","chapter","is-generating","selected-text","is-loading-suggestions","show-citation-helper","chapter-content","current-word-count","target-word-count","onStartStreamingGeneration","onGetAiSuggestions","onUpdate:showCitationHelper","onInsertCitation","onCheckCitations"])])])],2)),[[Le,!w.isCollapsed]])}});function Hn(x){const w=S({sentences:0,paragraphs:0,readingTime:0,avgWordLength:0,uniqueWords:0,commonWords:[]}),l=R(()=>x.value?x.value.split(/\s+/).filter(g=>g.length>0).length:0),D=()=>{if(!x.value){w.value={sentences:0,paragraphs:0,readingTime:0,avgWordLength:0,uniqueWords:0,commonWords:[]};return}const g=x.value,y=g.split(/\s+/).filter(u=>u.length>0),m=g.split(/[.!?]+/).filter(u=>u.trim().length>0),C=g.split(`

`).filter(u=>u.trim().length>0),i=new Map;y.forEach(u=>{const d=u.toLowerCase().replace(/[^a-z0-9]/g,"");d&&i.set(d,(i.get(d)||0)+1)});const _=new Set(["the","a","an","and","or","but","in","on","at","to","for","of","with","by","is","was","are","were"]),p=Array.from(i.entries()).filter(([u])=>!_.has(u)).sort((u,d)=>d[1]-u[1]).slice(0,5).map(([u])=>u);w.value={sentences:m.length,paragraphs:C.length,readingTime:Math.ceil(y.length/200),avgWordLength:y.reduce((u,d)=>u+d.length,0)/y.length,uniqueWords:i.size,commonWords:p}},c=R(()=>{if(!x.value)return 0;let g=0;const y=x.value;y.includes("##")&&(g+=20),y.length>1e3&&(g+=20),y.match(/\[.*?\]/g)&&(g+=15),(y.includes("**")||y.includes("*"))&&(g+=10);const m=y.split(/[.!?]+/).filter(i=>i.trim().length>0);if(m.length>0){const i=m.reduce((_,p)=>_+p.split(/\s+/).length,0)/m.length;i>10&&i<25&&(g+=20)}return y.split(`

`).filter(i=>i.trim().length>0).length>3&&(g+=15),Math.min(g,100)});return{writingStats:w,currentWordCount:l,writingQualityScore:c,calculateWritingStats:D}}function On(x){const w=S(!1),l=S(null),D=S([]),c=S(null),g=R(()=>{if(!l.value?.quality_level)return"text-muted-foreground";switch(l.value.quality_level){case"Excellent":return"text-green-600";case"Good":return"text-blue-600";case"Satisfactory":return"text-yellow-600";case"Needs Improvement":return"text-orange-600";case"Poor":return"text-red-600";default:return"text-muted-foreground"}}),y=R(()=>l.value?.scores?Object.entries(l.value.scores).sort(([,d],[,T])=>d.percentage-T.percentage).slice(0,3).map(([d,T])=>({category:d.replace(" & "," & "),percentage:Math.round(T.percentage),score:T.score,max:T.max})):[]),m=async()=>{try{w.value=!0,c.value=null,await re.get("/sanctum/csrf-cookie");const d=await re.post(K("api.chapters.analysis.analyze",{chapter:x}));if(d.data.success)return l.value=d.data.analysis,d.data.analysis;throw new Error(d.data.error||"Analysis failed")}catch(d){return c.value=d.response?.data?.error||d.message||"Analysis failed",console.error("Chapter analysis failed:",d),null}finally{w.value=!1}};return{isAnalyzing:w,latestAnalysis:l,analysisHistory:D,error:c,qualityLevelColor:g,topImprovementAreas:y,analyzeChapter:m,getLatestAnalysis:async()=>{try{await re.get("/sanctum/csrf-cookie");const d=await re.get(K("api.chapters.analysis.latest",{chapter:x}));return d.data.success?(l.value=d.data.analysis,d.data.analysis):(l.value=null,null)}catch(d){return d.response?.status!==404&&(c.value=d.response?.data?.error||d.message||"Failed to get analysis",console.error("Failed to get latest analysis:",d)),null}},getAnalysisHistory:async()=>{try{await re.get("/sanctum/csrf-cookie");const d=await re.get(K("api.chapters.analysis.history",{chapter:x}));if(d.data.success)return D.value=d.data.analyses,d.data.analyses;throw new Error(d.data.error||"Failed to get history")}catch(d){return c.value=d.response?.data?.error||d.message||"Failed to get analysis history",console.error("Failed to get analysis history:",d),[]}},autoAnalyze:async(d,T=500)=>{d>=T&&await m()},getScoreColor:(d,T)=>{const z=d/T*100;return z>=80?"text-green-600":z>=70?"text-blue-600":z>=60?"text-yellow-600":z>=40?"text-orange-600":"text-red-600"},getProgressVariant:d=>d>=80?"success":d>=60?"default":"destructive"}}const qn={key:0,class:"min-h-screen bg-background text-foreground"},In={class:"mx-auto max-w-5xl p-6"},Un={class:"flex items-center justify-between gap-4"},Qn={class:"flex items-center gap-3"},Kn={class:"mt-6 grid gap-4"},Vn={class:"flex flex-wrap gap-x-6 gap-y-1"},Jn={class:"grid gap-1"},Xn={class:"grid gap-1"},Yn={class:"grid gap-4 md:grid-cols-3"},Zn={class:"mx-auto w-full max-w-5xl p-6"},ea={class:"flex items-center justify-between gap-4"},ta={class:"flex items-center gap-3"},sa={class:"mt-6 grid gap-4"},ra={class:"flex flex-wrap gap-x-6 gap-y-1"},na={class:"grid gap-1"},aa={class:"grid gap-1"},oa={class:"grid gap-4 md:grid-cols-3"},la={key:0,class:"rounded-xl border border-border bg-card p-4"},ia={key:1,class:"flex h-screen flex-col overflow-hidden bg-background dark:bg-background font-sans selection:bg-primary/20 transition-colors duration-300"},da={class:"relative z-20 flex flex-shrink-0 items-center justify-between border-b border-border/40 bg-background/60 p-4 backdrop-blur-xl supports-[backdrop-filter]:bg-background/40 transition-all duration-300"},ua={class:"flex items-center gap-5"},ca={class:"flex flex-col"},pa={class:"text-lg font-bold tracking-tight text-foreground/90 font-display"},ga={class:"flex items-center gap-3 text-xs text-muted-foreground"},fa={class:"flex items-center gap-1.5"},ma={class:"flex items-center gap-4"},ha={class:"flex items-center p-1 rounded-full border border-border/40 bg-background/50 backdrop-blur-sm shadow-sm"},va={class:"flex items-center gap-2"},ba={class:"relative z-20 h-[2px] w-full bg-border/20"},xa={key:0,class:"mx-3 my-2"},wa={class:"relative overflow-hidden rounded-xl border border-blue-200 bg-gradient-to-br from-blue-50 to-purple-50 p-3 shadow-sm dark:border-blue-800 dark:from-blue-950/30 dark:to-purple-950/30"},ya={class:"relative z-10 mb-2 flex items-center justify-between"},_a={class:"flex items-center gap-2"},Ca={class:"relative"},ka={class:"flex h-6 w-6 items-center justify-center rounded-full bg-gradient-to-br from-blue-500 to-purple-600"},Sa={class:"text-xs text-blue-700 dark:text-blue-300"},Ea={class:"relative z-10 mb-2"},Ta={class:"mb-1 flex items-center justify-between"},$a={class:"text-xs text-blue-600 dark:text-blue-400"},Da={class:"relative h-2 overflow-hidden rounded-full bg-blue-100 dark:bg-blue-900/50"},Aa={class:"relative z-10 flex items-center gap-2"},ja={class:"flex-shrink-0"},Ma={key:0,class:"h-2 w-2 animate-bounce rounded-full bg-blue-500"},Fa={key:1,class:"flex gap-0.5"},La={key:2,class:"h-2 w-2 animate-spin rounded-full border-2 border-blue-500 border-t-transparent"},Pa={key:3,class:"h-2 w-2 rounded-full bg-green-500"},Ra={key:4,class:"h-2 w-2 rounded-full bg-red-500"},za={class:"flex-1 text-xs text-blue-800 dark:text-blue-200"},Wa={class:"relative z-10 flex flex-1 overflow-hidden"},Na={key:0,class:"w-[320px] flex-shrink-0 border-r border-border/50 bg-background/80 backdrop-blur-xl shadow-xl z-20"},Ga={class:"h-full overflow-y-auto custom-scrollbar"},Ba={class:"p-4"},Ha={class:"mb-3"},Oa={class:"text-xs text-muted-foreground"},qa={class:"flex min-h-0 flex-1 flex-col bg-transparent relative"},Ia={class:"flex-1 overflow-hidden relative"},Ua={class:"absolute inset-0 overflow-y-auto custom-scrollbar flex flex-col items-center py-8 px-4 sm:px-8"},Qa={class:"flex h-full w-full overflow-hidden relative"},Ka={class:"hidden lg:flex w-80 flex-col border-r border-border/40 bg-background/60 backdrop-blur-xl z-20 transition-all duration-300"},Va={class:"h-14 flex items-center justify-between px-4 border-b border-border/40 shrink-0"},Ja={class:"p-4"},Xa={class:"flex-1 flex flex-col relative z-10 min-w-0 bg-background/30 dark:bg-background transition-all duration-300"},Ya={class:"md:hidden flex flex-wrap items-start justify-between border-b border-border/40 bg-background/60 backdrop-blur-md px-4 py-3 relative z-30 transition-all duration-300 gap-y-2"},Za={class:"flex items-center gap-2 flex-shrink-0 order-1"},eo={class:"flex items-center order-2"},to={class:"order-3 w-full flex flex-col gap-3"},so={class:"flex items-start gap-3 w-full min-w-0"},ro={class:"flex items-center gap-2 justify-between mt-1"},no={class:"flex items-center gap-2"},ao={class:"hidden md:flex flex-col w-full z-30 bg-background/60 backdrop-blur-md transition-all duration-300 relative"},oo={class:"h-10 border-b border-border/40 flex items-center justify-center px-4 bg-background/40"},lo={class:"flex items-center gap-3"},io=["innerHTML"],uo={class:"h-12 border-b border-border/40 flex items-center justify-between px-4 gap-3 bg-muted/10"},co={class:"flex items-center gap-1"},po={class:"flex items-center gap-3"},go={class:"flex items-center bg-background/50 rounded-full border border-border/50 p-1 backdrop-blur-sm shadow-sm"},fo={class:"hidden xl:inline"},mo={class:"hidden xl:inline"},ho={class:"flex items-center gap-2"},vo={class:"flex items-center gap-2 pl-2 border-l border-border/50"},bo={class:"inline"},xo={class:"flex-1 overflow-hidden relative group bg-background/20"},wo={key:0,class:"absolute top-6 left-0 right-0 z-40 px-4 flex justify-center pointer-events-none"},yo={class:"w-full max-w-lg pointer-events-auto"},_o={class:"relative overflow-hidden rounded-xl border border-blue-200 bg-gradient-to-br from-blue-50/95 to-purple-50/95 p-3 shadow-lg backdrop-blur-lg dark:border-blue-800 dark:from-blue-950/90 dark:to-purple-950/90"},Co={class:"flex items-center gap-3"},ko={class:"relative flex h-8 w-8 items-center justify-center rounded-full bg-gradient-to-br from-blue-500 to-purple-600 shadow-md"},So={class:"flex-1 min-w-0"},Eo={class:"flex items-center justify-between mb-1"},To={class:"text-xs font-mono text-muted-foreground"},$o={class:"h-1.5 w-full bg-blue-100 dark:bg-blue-900/40 rounded-full overflow-hidden"},Do={class:"mt-2 text-xs text-muted-foreground ml-11 truncate"},Ao={class:"max-w-[850px] mx-auto py-12 px-6 sm:px-10 min-h-full"},jo={class:"min-h-[600px] pb-32"},Mo={class:"pb-32"},Fo={class:"h-7 border-t border-border/30 bg-background/40 backdrop-blur-sm flex items-center justify-between px-4 text-[10px] text-muted-foreground shrink-0"},Lo={class:"flex items-center gap-3"},Po={class:"hidden sm:inline"},Ro={class:"flex items-center gap-2"},zo={key:0,class:"text-green-500 flex items-center gap-1 ml-2"},Wo={key:0,class:"fixed inset-0 bg-black/50 flex items-center justify-center z-50"},No={class:"text-slate-600 dark:text-slate-300 mb-4"},Go={class:"font-semibold text-amber-600 dark:text-amber-400"},Bo={class:"flex flex-col sm:flex-row gap-3"},Ho=1e3,Oo=Oe({__name:"ChapterEditor",props:{project:{},chapter:{},allChapters:{},facultyChapters:{},mode:{}},setup(x){const w=et(()=>tt(()=>import("./ChapterNavigation-CzLHj3F7.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21]))),l=et(()=>tt(()=>import("./MobileNavOverlay-D8U2dswS.js"),__vite__mapDeps([22,3,4,23,2,1,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,68,69,70,71,72,73,74,75,76,77,78,79,80,81,82,83,84,85,86,87,88]))),D=et(()=>tt(()=>import("./CitationVerificationLayout-RN8XDsp3.js"),__vite__mapDeps([89,14,2,3,4,8,25,26,28,6,7,29,5,9,90,41,53,18,73,30,31,66,11,12,67,68,69,70,71,16,15,17,72,35,74,75,76,52,54,77,78,79,80,38,55,39,40,42,43,44,45,46,47,48,49,50,51,21,56,57,58,59,81,27,37,10,34,60,61,62,33,63,64,82,83,65,84,85,86,87]))),c=x,g=S(null),y=S(null),m=S(!1),C=S(!1),i=S(0);if(typeof window<"u"){const o=new URLSearchParams(window.location.search);m.value=o.has("theme_sandbox"),C.value=o.get("theme_sandbox")==="nolayout"||o.has("theme_sandbox_nolayout");const t=o.get("theme_sandbox_step"),k=t?Number.parseInt(t,10):0;i.value=Number.isFinite(k)?k:0}const{appearance:_,isDark:p}=It(),u=S({htmlHasDark:!1,background:"",foreground:"",card:"",sidebarBackground:"",bodyBg:"",insetBg:"",sampleBgBackground:"",sampleBgCard:"",sampleBgMuted:""}),d=S(null),T=S(null),z=S(null);function j(){if(typeof window>"u")return;const o=document.documentElement,t=window.getComputedStyle(o),k=document.querySelector('[data-slot="sidebar-inset"]'),Q=k?window.getComputedStyle(k).backgroundColor:"";u.value={htmlHasDark:o.classList.contains("dark"),background:t.getPropertyValue("--background").trim(),foreground:t.getPropertyValue("--foreground").trim(),card:t.getPropertyValue("--card").trim(),sidebarBackground:t.getPropertyValue("--sidebar-background").trim(),bodyBg:window.getComputedStyle(document.body).backgroundColor,insetBg:Q,sampleBgBackground:d.value?window.getComputedStyle(d.value).backgroundColor:"",sampleBgCard:T.value?window.getComputedStyle(T.value).backgroundColor:"",sampleBgMuted:z.value?window.getComputedStyle(z.value).backgroundColor:""}}const{chapterTitle:M,chapterContent:$,isEditorDark:W,toggleChapterTheme:q,isNativeFullscreen:v,selectedText:a,showChatMode:h,showCitationMode:G,showDefensePrep:H,loadChatModeFromStorage:V,saveChatModeToStorage:ve,showLeftSidebar:I,showRightSidebar:Y,isMobile:qe,isLeftSidebarCollapsed:$e,isRightSidebarCollapsed:De,showLeftSidebarInFullscreen:be,showRightSidebarInFullscreen:F}=Ir(c),{balance:B,showPurchaseModal:U,requiredWordsForModal:L,actionDescriptionForModal:J,checkAndPrompt:Re,closePurchaseModal:ze,estimates:xe}=sr(),We=(o,t)=>Re(Math.max(1,Math.round(o)),t),{hasUnsavedChanges:Ke,isSaving:we,triggerAutoSave:ye,save:ue,clearAutoSave:Yt}=ar({delay:1e4,onSave:Ps});let lt=0;const Zt=()=>{const o=Date.now();o-lt>Ho&&(lt=o,P.success("Saved",{duration:2e3}))},{addToHistory:es,undo:ts,redo:ss}=Dr(c.chapter.content||""),{writingStats:it,writingQualityScore:_e,calculateWritingStats:Ve}=Hn($),{isAnalyzing:rs,latestAnalysis:ns,getLatestAnalysis:as}=On(c.chapter.id),ce=R(()=>{if(c.facultyChapters&&c.facultyChapters.length>0){const t=c.facultyChapters.find(k=>k.number===c.chapter.chapter_number);if(t?.word_count)return t.word_count}if(c.project?.outlines&&c.project.outlines.length>0){const t=c.project.outlines.find(k=>k.chapter_number===c.chapter.chapter_number);if(t?.target_word_count)return t.target_word_count}const o=c.project.type==="undergraduate"?2500:3500;return c.chapter.chapter_number===1||c.chapter.chapter_number===5?Math.round(o*.8):o}),{generateNextChapter:Je}=Ur({props:c,allChapters:c.allChapters,targetWordCount:ce,estimates:xe,ensureBalance:We,save:ue}),{currentWordCount:ae,progressPercentage:os,DEFENSE_THRESHOLD:ls,countWords:is}=or($,ce),dt=os,ut=R(()=>({chapter:c.chapter,chapterTitle:M,chapterContent:$,showPresentationMode:ge,togglePresentationMode:yt,isStreamingMode:ft,isGenerating:Ae,generationProgress:Ie,generationPercentage:Ce,generationPhase:ke,aiChapterAnalysis,nextSection,getSectionInfo,writingStats:it,latestAnalysis:ns,isAnalyzing:rs,writingQualityScore:_e,isSaving:we,isValid:Xe,save:ue,goToBulkAnalysis:Ze,markAsComplete:kt,richTextEditor:g,richTextEditorFullscreen:y,selectedText:a,setSelectedText:o=>{a.value=o}})),ds=R(()=>({chapter_number:xt.value.chapter_number,chapter_title:xt.value.title,word_count:ae.value})),us=R(()=>({meetsThreshold:Ss.value,shouldShowProgress:ys.value,progressPercentage:_s.value,wordsRemaining:Cs.value,hasTriggeredGeneration:ks,threshold:ls,statusMessage:ws()})),ct=R(()=>({project:fe.value,chapter:me.value,isGenerating:Ae.value,selectedText:a.value,isLoadingSuggestions:gt.value,showCitationHelper:Ue.value,chapterContent:$.value,currentWordCount:ae.value,targetWordCount:ce.value,handleAIGeneration:ht,getAISuggestions:vt,updateCitationHelper:o=>{Ue.value=o},insertCitation:js,checkCitations:bt,showDefensePrep:H.value,defenseQuestions:cs.value??[],isLoadingDefenseQuestions:ps.value,isGeneratingDefenseQuestions:gs.value,chapterContext:ds.value,defenseWatcher:us.value,autoGenerateDefense:fs.value,handleDefensePanelToggle:Os,generateNewDefenseQuestions:hs,handleDefenseAutoToggle:xs,refreshDefenseQuestions:()=>pt(!0,{skipGeneration:!0}),markQuestionHelpful:vs,hideQuestion:bs})),{defenseQuestions:cs,isLoadingDefenseQuestions:ps,isGeneratingDefenseQuestions:gs,autoGenerateDefense:fs,shouldLoadDefenseQuestions:ms,loadDefenseQuestions:pt,generateNewDefenseQuestions:hs,markQuestionHelpful:vs,hideQuestion:bs,handleDefenseAutoToggle:xs,getDefenseStatusMessage:ws,shouldShowDefenseProgress:ys,defenseProgressPercentage:_s,defenseWordsRemaining:Cs,hasTriggeredGeneration:ks,meetsDefenseThreshold:Ss}=Kr({props:c,chapterContent:$,currentWordCount:ae,ensureBalance:We,estimates:xe}),{isGenerating:Ae,generationProgress:Ie,generationPercentage:Ce,generationPhase:ke,estimatedTotalWords:Es,streamWordCount:Ts,streamBuffer:Io,lastStreamUpdate:Uo,originalContentForAppend:Qo,aiSuggestions:Ko,isLoadingSuggestions:gt,showCitationHelper:Ue,showPresentationMode:ge,isStreamingMode:ft,showRecoveryDialog:$s,partialContentSaved:Vo,savedWordCountOnError:Ds,isCollectingPapers:Jo,paperCollectionProgress:Xo,paperCollectionPhase:Yo,collectedPapersCount:Zo,paperCollectionPercentage:el,currentSource:tl,sourcesCompleted:sl,papersPreview:rl,paperCollectionData:nl,paperCollectionInterval:al,reconnectAttempts:ol,reconnectDelay:ll,isReconnecting:il,currentGenerationId:dl,currentGenerationType:ul,eventSource:mt,editorScrollRef:As,attachScroller:cl,smoothScrollToBottom:pl,forceScrollToBottom:gl,resetScroller:fl,isAutoScrollActive:ml,isUserScrollingScroller:hl,scrollToBottom:vl,checkConnectionQuality:bl,handleAIGeneration:ht,getAISuggestions:vt,checkCitations:bt,insertCitation:js,resumeGeneration:Ms,dismissRecovery:Fs,checkForAutoGeneration:Ls}=lr({props:c,chapterContent:$,targetWordCount:ce,estimates:xe,ensureBalance:We,save:ue,triggerAutoSave:ye,calculateWritingStats:Ve,countWords:is,selectedText:a,richTextEditor:g,richTextEditorFullscreen:y,isNativeFullscreen:v}),Xe=R(()=>{const o=M.value?.trim(),t=$.value?.trim();return o&&o.length>0&&t&&t.length>50}),fe=R(()=>c.project),me=R(()=>c.chapter),he=R(()=>c.allChapters),xt=R(()=>c.chapter);async function Ps(o=!1){try{const t=await fetch(K("chapters.save",{project:c.project.id}),{method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json","X-Requested-With":"XMLHttpRequest","X-CSRF-TOKEN":document.querySelector('meta[name="csrf-token"]')?.getAttribute("content")||""},body:JSON.stringify({project_id:c.project.id,chapter_number:c.chapter.chapter_number,title:M.value,content:$.value,auto_save:o,statistics:it.value,quality_score:_e.value})});console.log("Response status:",t.status,t.statusText),console.log("Response headers:",t.headers);const k=await t.text();console.log("Raw response:",k);let Q;try{Q=JSON.parse(k)}catch(pe){throw console.error("JSON parse error:",pe),console.error("Response was:",k),new Error(`Server returned non-JSON response: ${t.status} ${t.statusText}`)}t.ok}catch(t){throw o||P.error("âŒ Save Failed",{description:"Please try again or check your connection."}),t}}const Rs=()=>{const o=ts();o!==null&&($.value=o,ye())},zs=()=>{const o=ss();o!==null&&($.value=o,ye())},Ne=o=>{Ke.value&&confirm("You have unsaved changes. Save before switching chapters?")&&ue();const t=c.allChapters.find(pe=>pe.chapter_number===o),Q=t?.content&&t.content.trim()!==""?"chapters.edit":"chapters.write";Z.visit(K(Q,{project:c.project.slug,chapter:o}),{only:["chapter","mode","allChapters"],preserveState:!0,preserveScroll:!1})},wt=()=>document.fullscreenElement||document.webkitFullscreenElement||document.msFullscreenElement||null,Ws=async()=>{try{const o=document.documentElement;o.requestFullscreen?await o.requestFullscreen({navigationUI:"hide"}):o.webkitRequestFullscreen?await o.webkitRequestFullscreen():o.msRequestFullscreen&&await o.msRequestFullscreen()}catch(o){console.error("Error entering fullscreen:",o),P.error("Fullscreen Error",{description:"Unable to enter fullscreen mode"})}},Ns=async()=>{try{document.exitFullscreen?await document.exitFullscreen():document.webkitExitFullscreen?await document.webkitExitFullscreen():document.msExitFullscreen&&await document.msExitFullscreen()}catch(o){console.error("Error exiting fullscreen:",o),P.error("Fullscreen Error",{description:"Unable to exit fullscreen mode"})}},Ye=async()=>{if(wt()){await Ns();return}await Ws()},Se=()=>{v.value=!!wt(),je(()=>{m.value&&j()})},Gs=()=>{h.value=!h.value,h.value&&(G.value=!1),ve(h.value)},Bs=()=>{G.value=!1},yt=()=>{ge.value=!ge.value},Ze=()=>{Z.visit(K("projects.analysis",{project:c.project.slug}))},Hs=()=>{es($.value),ye(),Ve()},_t=o=>{(o.ctrlKey||o.metaKey)&&o.key==="s"&&(o.preventDefault(),ue(),Zt()),(o.ctrlKey||o.metaKey)&&!o.shiftKey&&o.key==="z"&&(o.preventDefault(),Rs()),(o.ctrlKey||o.metaKey)&&o.shiftKey&&o.key==="z"&&(o.preventDefault(),zs()),(o.ctrlKey||o.metaKey)&&o.shiftKey&&(o.key==="f"||o.key==="F")&&(o.preventDefault(),Ye())};Me(()=>{const o=()=>{qe.value=window.innerWidth<1024};o(),window.addEventListener("resize",o),h.value=V(),document.addEventListener("keydown",Ct),document.addEventListener("keydown",_t),document.addEventListener("fullscreenchange",Se),document.addEventListener("webkitfullscreenchange",Se),document.addEventListener("msfullscreenchange",Se),Se(),Ve(),Ls()});const Ct=o=>{if((o.ctrlKey||o.metaKey)&&!["INPUT","TEXTAREA","SELECT"].includes(o.target?.tagName))switch(o.key){case"ArrowLeft":o.preventDefault();const t=c.chapter.chapter_number-1;c.allChapters.find(Ge=>Ge.chapter_number===t)&&Ne(t);break;case"ArrowRight":o.preventDefault();const Q=c.chapter.chapter_number+1;c.allChapters.find(Ge=>Ge.chapter_number===Q)&&Ne(Q);break}};Me(()=>{const o=t=>{const k=Q=>{const{scrollTop:pe,scrollHeight:Ge,clientHeight:qs}=t,St=Q.deltaY,Is=pe<=0,Us=pe+qs>=Ge;St<0&&Is||St>0&&Us||Q.stopPropagation()};return t.addEventListener("wheel",k,{passive:!0}),()=>t.removeEventListener("wheel",k)};je(()=>{const t=document.querySelectorAll('[class*="overflow-y-auto"]'),k=[];t.forEach(Q=>{if(Q instanceof HTMLElement){const pe=o(Q);k.push(pe)}}),window.__scrollChainCleanup=k})}),Ys(()=>{Yt(),mt.value&&mt.value.close(),document.removeEventListener("keydown",_t),document.removeEventListener("keydown",Ct);const o=window.__scrollChainCleanup;o&&Array.isArray(o)&&(o.forEach(t=>t()),delete window.__scrollChainCleanup),document.removeEventListener("fullscreenchange",Se),document.removeEventListener("webkitfullscreenchange",Se),document.removeEventListener("msfullscreenchange",Se)}),ne(()=>c.chapter,async o=>{M.value=o.title||"",$.value=o.content||""},{immediate:!1});const Os=async o=>{H.value=o,o&&ms()&&await pt(!1,{skipGeneration:!0})};ne($,Hs),ne(M,ye);const kt=async()=>{console.log("ðŸ”µ [MARK COMPLETE] Function called"),console.log("ðŸ”µ [MARK COMPLETE] Current word count:",ae.value);try{console.log("ðŸ”µ [MARK COMPLETE] Saving chapter..."),await ue(!1),console.log("âœ… [MARK COMPLETE] Chapter saved");const o=K("chapters.mark-complete",{project:c.project.slug,chapter:c.chapter.chapter_number});console.log("ðŸ”µ [MARK COMPLETE] Posting to:",o),Z.post(o,{},{onSuccess:()=>{console.log("âœ… [MARK COMPLETE] Request successful")},onError:t=>{console.error("âŒ [MARK COMPLETE] Request failed:",t)}})}catch(o){console.error("âŒ [MARK COMPLETE] Error:",o),P.error("Failed to save chapter before marking complete")}};return Me(async()=>{await as()}),Me(()=>{m.value&&je(()=>j())}),ne(p,()=>{m.value&&je(()=>j())},{flush:"post"}),(o,t)=>(E(),N(e(rr),null,{default:n(()=>[m.value?(E(),O(Et,{key:0},[C.value?(E(),O("div",qn,[s("div",In,[s("div",Un,[t[22]||(t[22]=s("div",null,[s("h1",{class:"text-lg font-semibold"},"ChapterEditor Theme Sandbox"),s("p",{class:"text-sm text-muted-foreground"},"No layout mode. Use `?theme_sandbox=nolayout`.")],-1)),s("div",Qn,[r(Dt),r(e(A),{variant:"outline",size:"sm",onClick:j},{default:n(()=>[...t[20]||(t[20]=[f("Refresh",-1)])]),_:1}),r(e(A),{variant:"outline",size:"sm",onClick:t[0]||(t[0]=k=>e(Z).visit(o.window.location.pathname))},{default:n(()=>[...t[21]||(t[21]=[f("Exit",-1)])]),_:1})])]),s("div",Kn,[r(e(ee),{class:"bg-card text-card-foreground"},{default:n(()=>[r(e(se),null,{default:n(()=>[r(e(oe),{class:"text-base"},{default:n(()=>[...t[23]||(t[23]=[f("Theme State",-1)])]),_:1})]),_:1}),r(e(te),{class:"space-y-2 text-sm"},{default:n(()=>[s("div",Vn,[s("div",null,[t[24]||(t[24]=s("span",{class:"text-muted-foreground"},"appearance:",-1)),f(" "+b(e(_)),1)]),s("div",null,[t[25]||(t[25]=s("span",{class:"text-muted-foreground"},"isDark:",-1)),f(" "+b(e(p)),1)]),s("div",null,[t[26]||(t[26]=s("span",{class:"text-muted-foreground"},"html.dark:",-1)),f(" "+b(u.value.htmlHasDark),1)]),s("div",null,[t[27]||(t[27]=s("span",{class:"text-muted-foreground"},"step:",-1)),f(" "+b(i.value),1)])]),r(e(Be)),s("div",Jn,[s("div",null,[t[28]||(t[28]=s("span",{class:"text-muted-foreground"},"--background:",-1)),f(" "+b(u.value.background),1)]),s("div",null,[t[29]||(t[29]=s("span",{class:"text-muted-foreground"},"--foreground:",-1)),f(" "+b(u.value.foreground),1)]),s("div",null,[t[30]||(t[30]=s("span",{class:"text-muted-foreground"},"--card:",-1)),f(" "+b(u.value.card),1)]),s("div",null,[t[31]||(t[31]=s("span",{class:"text-muted-foreground"},"--sidebar-background:",-1)),f(" "+b(u.value.sidebarBackground),1)])]),r(e(Be)),s("div",Xn,[s("div",null,[t[32]||(t[32]=s("span",{class:"text-muted-foreground"},"body bg:",-1)),f(" "+b(u.value.bodyBg),1)]),s("div",null,[t[33]||(t[33]=s("span",{class:"text-muted-foreground"},"inset bg:",-1)),f(" "+b(u.value.insetBg),1)]),s("div",null,[t[34]||(t[34]=s("span",{class:"text-muted-foreground"},"sample bg-background:",-1)),f(" "+b(u.value.sampleBgBackground),1)]),s("div",null,[t[35]||(t[35]=s("span",{class:"text-muted-foreground"},"sample bg-card:",-1)),f(" "+b(u.value.sampleBgCard),1)]),s("div",null,[t[36]||(t[36]=s("span",{class:"text-muted-foreground"},"sample bg-muted:",-1)),f(" "+b(u.value.sampleBgMuted),1)])])]),_:1})]),_:1}),s("div",Yn,[r(e(ee),{ref_key:"sampleBgBackgroundEl",ref:d,class:"bg-background"},{default:n(()=>[r(e(se),null,{default:n(()=>[r(e(oe),{class:"text-base"},{default:n(()=>[...t[37]||(t[37]=[f("bg-background",-1)])]),_:1})]),_:1}),r(e(te),{class:"text-sm text-muted-foreground"},{default:n(()=>[...t[38]||(t[38]=[f("Should flip with theme.",-1)])]),_:1})]),_:1},512),r(e(ee),{ref_key:"sampleBgCardEl",ref:T,class:"bg-card"},{default:n(()=>[r(e(se),null,{default:n(()=>[r(e(oe),{class:"text-base"},{default:n(()=>[...t[39]||(t[39]=[f("bg-card",-1)])]),_:1})]),_:1}),r(e(te),{class:"text-sm text-muted-foreground"},{default:n(()=>[...t[40]||(t[40]=[f("Card surface color.",-1)])]),_:1})]),_:1},512),r(e(ee),{ref_key:"sampleBgMutedEl",ref:z,class:"bg-muted"},{default:n(()=>[r(e(se),null,{default:n(()=>[r(e(oe),{class:"text-base"},{default:n(()=>[...t[41]||(t[41]=[f("bg-muted",-1)])]),_:1})]),_:1}),r(e(te),{class:"text-sm text-muted-foreground"},{default:n(()=>[...t[42]||(t[42]=[f("Muted surface color.",-1)])]),_:1})]),_:1},512)])])])])):(E(),N(At,{key:1,class:"h-screen overflow-hidden bg-background text-foreground"},{default:n(()=>[s("div",Zn,[s("div",ea,[t[45]||(t[45]=s("div",null,[s("h1",{class:"text-lg font-semibold"},"ChapterEditor Theme Sandbox"),s("p",{class:"text-sm text-muted-foreground"}," Use `?theme_sandbox=1` (with layout) or `?theme_sandbox=nolayout`. ")],-1)),s("div",ta,[r(Dt),r(e(A),{variant:"outline",size:"sm",onClick:j},{default:n(()=>[...t[43]||(t[43]=[f("Refresh",-1)])]),_:1}),r(e(A),{variant:"outline",size:"sm",onClick:t[1]||(t[1]=k=>e(Z).visit(o.window.location.pathname))},{default:n(()=>[...t[44]||(t[44]=[f("Exit",-1)])]),_:1})])]),s("div",sa,[r(e(ee),{class:"bg-card text-card-foreground"},{default:n(()=>[r(e(se),null,{default:n(()=>[r(e(oe),{class:"text-base"},{default:n(()=>[...t[46]||(t[46]=[f("Theme State",-1)])]),_:1})]),_:1}),r(e(te),{class:"space-y-2 text-sm"},{default:n(()=>[s("div",ra,[s("div",null,[t[47]||(t[47]=s("span",{class:"text-muted-foreground"},"appearance:",-1)),f(" "+b(e(_)),1)]),s("div",null,[t[48]||(t[48]=s("span",{class:"text-muted-foreground"},"isDark:",-1)),f(" "+b(e(p)),1)]),s("div",null,[t[49]||(t[49]=s("span",{class:"text-muted-foreground"},"html.dark:",-1)),f(" "+b(u.value.htmlHasDark),1)]),s("div",null,[t[50]||(t[50]=s("span",{class:"text-muted-foreground"},"step:",-1)),f(" "+b(i.value),1)])]),r(e(Be)),s("div",na,[s("div",null,[t[51]||(t[51]=s("span",{class:"text-muted-foreground"},"--background:",-1)),f(" "+b(u.value.background),1)]),s("div",null,[t[52]||(t[52]=s("span",{class:"text-muted-foreground"},"--foreground:",-1)),f(" "+b(u.value.foreground),1)]),s("div",null,[t[53]||(t[53]=s("span",{class:"text-muted-foreground"},"--card:",-1)),f(" "+b(u.value.card),1)]),s("div",null,[t[54]||(t[54]=s("span",{class:"text-muted-foreground"},"--sidebar-background:",-1)),f(" "+b(u.value.sidebarBackground),1)])]),r(e(Be)),s("div",aa,[s("div",null,[t[55]||(t[55]=s("span",{class:"text-muted-foreground"},"body bg:",-1)),f(" "+b(u.value.bodyBg),1)]),s("div",null,[t[56]||(t[56]=s("span",{class:"text-muted-foreground"},"inset bg:",-1)),f(" "+b(u.value.insetBg),1)]),s("div",null,[t[57]||(t[57]=s("span",{class:"text-muted-foreground"},"sample bg-background:",-1)),f(" "+b(u.value.sampleBgBackground),1)]),s("div",null,[t[58]||(t[58]=s("span",{class:"text-muted-foreground"},"sample bg-card:",-1)),f(" "+b(u.value.sampleBgCard),1)]),s("div",null,[t[59]||(t[59]=s("span",{class:"text-muted-foreground"},"sample bg-muted:",-1)),f(" "+b(u.value.sampleBgMuted),1)])])]),_:1})]),_:1}),s("div",oa,[r(e(ee),{ref_key:"sampleBgBackgroundEl",ref:d,class:"bg-background"},{default:n(()=>[r(e(se),null,{default:n(()=>[r(e(oe),{class:"text-base"},{default:n(()=>[...t[60]||(t[60]=[f("bg-background",-1)])]),_:1})]),_:1}),r(e(te),{class:"text-sm text-muted-foreground"},{default:n(()=>[...t[61]||(t[61]=[f("Should flip with theme.",-1)])]),_:1})]),_:1},512),r(e(ee),{ref_key:"sampleBgCardEl",ref:T,class:"bg-card"},{default:n(()=>[r(e(se),null,{default:n(()=>[r(e(oe),{class:"text-base"},{default:n(()=>[...t[62]||(t[62]=[f("bg-card",-1)])]),_:1})]),_:1}),r(e(te),{class:"text-sm text-muted-foreground"},{default:n(()=>[...t[63]||(t[63]=[f("Card surface color.",-1)])]),_:1})]),_:1},512),r(e(ee),{ref_key:"sampleBgMutedEl",ref:z,class:"bg-muted"},{default:n(()=>[r(e(se),null,{default:n(()=>[r(e(oe),{class:"text-base"},{default:n(()=>[...t[64]||(t[64]=[f("bg-muted",-1)])]),_:1})]),_:1}),r(e(te),{class:"text-sm text-muted-foreground"},{default:n(()=>[...t[65]||(t[65]=[f("Muted surface color.",-1)])]),_:1})]),_:1},512)]),i.value>=1?(E(),O("div",la,[t[66]||(t[66]=s("div",{class:"text-sm font-medium"},"Step 1: Paper Card only",-1)),t[67]||(t[67]=s("div",{class:"text-xs text-muted-foreground mb-3"},"Adds `ChapterEditorPaperCard` only.",-1)),r(Ot,{context:ut.value},null,8,["context"])])):X("",!0)])])]),_:1}))],64)):(E(),O(Et,{key:1},[e(G)?(E(),N(e(D),{key:0,project:fe.value,chapter:me.value,"chapter-title":e(M),"chapter-content":e($),"current-word-count":e(ae),"target-word-count":ce.value,"progress-percentage":e(dt),onExitCitationMode:Bs},null,8,["project","chapter","chapter-title","chapter-content","current-word-count","target-word-count","progress-percentage"])):e(v)?(E(),O("div",ia,[t[83]||(t[83]=s("div",{class:"absolute inset-0 z-0 overflow-hidden pointer-events-none"},[s("div",{class:"absolute top-[-20%] left-[-10%] w-[50%] h-[50%] rounded-full bg-blue-500/5 blur-[120px]"}),s("div",{class:"absolute bottom-[-20%] right-[-10%] w-[50%] h-[50%] rounded-full bg-purple-500/5 blur-[120px]"})],-1)),s("div",da,[s("div",ua,[r(e(de),null,{default:n(()=>[r(e(le),{asChild:""},{default:n(()=>[r(e(A),{onClick:t[2]||(t[2]=k=>e(Z).visit(e(K)("projects.show",c.project.slug))),variant:"ghost",size:"icon",class:"h-10 w-10 rounded-full hover:bg-primary/10 hover:text-primary transition-all duration-300"},{default:n(()=>[r(e(rt),{class:"h-5 w-5"})]),_:1})]),_:1}),r(e(ie),null,{default:n(()=>[...t[68]||(t[68]=[s("p",null,"Back to Project",-1)])]),_:1})]),_:1}),s("div",ca,[s("h1",pa,b(c.project.title),1),s("div",ga,[r(e(Ee),{variant:"outline",class:"h-5 px-2 rounded-full border-primary/20 bg-primary/5 text-primary font-medium"},{default:n(()=>[f(" Chapter "+b(c.chapter.chapter_number),1)]),_:1}),s("span",fa,[t[69]||(t[69]=s("span",{class:"h-1.5 w-1.5 rounded-full bg-green-500 animate-pulse"},null,-1)),f(" "+b(e(ae))+" words ",1)])])])]),s("div",ma,[s("div",ha,[r(e(A),{onClick:t[3]||(t[3]=k=>be.value=!e(be)),variant:e(be)?"secondary":"ghost",size:"sm",class:He(["h-8 px-4 rounded-full text-xs font-medium transition-all duration-300",e(be)?"bg-primary/10 text-primary hover:bg-primary/15":"hover:bg-muted"])},{default:n(()=>[r(e(zt),{class:"mr-2 h-3.5 w-3.5"}),t[70]||(t[70]=f(" Outline ",-1))]),_:1},8,["variant","class"]),t[72]||(t[72]=s("div",{class:"w-px h-4 bg-border/50 mx-1"},null,-1)),r(e(A),{onClick:t[4]||(t[4]=k=>F.value=!e(F)),variant:e(F)?"secondary":"ghost",size:"sm",class:He(["h-8 px-4 rounded-full text-xs font-medium transition-all duration-300",e(F)?"bg-primary/10 text-primary hover:bg-primary/15":"hover:bg-muted"])},{default:n(()=>[r(e(Fe),{class:"mr-2 h-3.5 w-3.5"}),t[71]||(t[71]=f(" Assistant ",-1))]),_:1},8,["variant","class"])]),s("div",va,[r(e(de),null,{default:n(()=>[r(e(le),{asChild:""},{default:n(()=>[r(e(A),{onClick:Ye,variant:e(v)?"secondary":"ghost",size:"icon",class:"h-9 w-9 rounded-full transition-all hover:bg-muted"},{default:n(()=>[e(v)?(E(),N(e(Wt),{key:0,class:"h-4.5 w-4.5"})):(E(),N(e(Nt),{key:1,class:"h-4.5 w-4.5"}))]),_:1},8,["variant"])]),_:1}),r(e(ie),null,{default:n(()=>[s("p",null,b(e(v)?"Exit fullscreen":"Enter fullscreen"),1)]),_:1})]),_:1}),r(e(de),null,{default:n(()=>[r(e(le),{asChild:""},{default:n(()=>[r(e(A),{onClick:e(q),variant:e(W)?"secondary":"ghost",size:"icon",class:"h-9 w-9 rounded-full transition-all hover:bg-muted"},{default:n(()=>[e(W)?(E(),N(e(Gt),{key:0,class:"h-4.5 w-4.5 text-foreground"})):(E(),N(e(Bt),{key:1,class:"h-4.5 w-4.5 text-muted-foreground"}))]),_:1},8,["onClick","variant"])]),_:1}),r(e(ie),null,{default:n(()=>[...t[73]||(t[73]=[s("p",null,"Toggle Dark Mode",-1)])]),_:1})]),_:1}),r(st,{project:fe.value,"current-chapter":me.value,"all-chapters":he.value,size:"icon",variant:"ghost",class:"h-9 w-9 rounded-full hover:bg-muted"},null,8,["project","current-chapter","all-chapters"])])])]),s("div",ba,[s("div",{class:"absolute top-0 left-0 h-full bg-gradient-to-r from-blue-500 via-purple-500 to-pink-500 transition-all duration-700 ease-out shadow-[0_0_10px_rgba(59,130,246,0.5)]",style:Qe({width:`${Math.min(e(dt),100)}%`})},null,4)]),e(Ae)?(E(),O("div",xa,[s("div",wa,[t[79]||(t[79]=s("div",{class:"absolute inset-0 -skew-x-12 animate-pulse bg-gradient-to-r from-transparent via-white/10 to-transparent"},null,-1)),s("div",ya,[s("div",_a,[s("div",Ca,[s("div",ka,[r(e(Fe),{class:"h-3 w-3 text-white"})]),t[74]||(t[74]=s("div",{class:"absolute inset-0 h-6 w-6 animate-ping rounded-full bg-gradient-to-br from-blue-500 to-purple-600 opacity-20"},null,-1))]),s("div",null,[t[75]||(t[75]=s("h4",{class:"text-xs font-semibold text-blue-900 dark:text-blue-100"},"AI Generator",-1)),s("p",Sa,b(e(ke)),1)])]),r(e(Ee),{variant:"outline",class:"border-blue-300 text-xs text-blue-700 dark:border-blue-700 dark:text-blue-300"},{default:n(()=>[f(b(Math.round(e(Ce)))+"% ",1)]),_:1})]),s("div",Ea,[s("div",Ta,[t[76]||(t[76]=s("span",{class:"text-xs text-blue-800 dark:text-blue-200"},"Generation Progress",-1)),s("span",$a,b(e(Ts))+" / "+b(e(Es))+" words",1)]),s("div",Da,[s("div",{class:"absolute top-0 left-0 h-full rounded-full bg-gradient-to-r from-blue-500 to-purple-500 transition-all duration-500 ease-out",style:Qe({width:`${e(Ce)}%`})},[...t[77]||(t[77]=[s("div",{class:"absolute inset-0 animate-pulse bg-gradient-to-r from-transparent via-white/30 to-transparent"},null,-1)])],4),s("div",{class:"absolute top-0 left-0 h-full rounded-full bg-gradient-to-r from-blue-400 to-purple-400 opacity-50 blur-sm transition-all duration-500",style:Qe({width:`${e(Ce)}%`})},null,4)])]),s("div",Aa,[s("div",ja,[e(ke)==="Initializing"?(E(),O("div",Ma)):e(ke)==="Connecting"?(E(),O("div",Fa,[...t[78]||(t[78]=[s("div",{class:"h-2 w-0.5 animate-pulse rounded-full bg-blue-500"},null,-1),s("div",{class:"h-2 w-0.5 animate-pulse rounded-full bg-purple-500",style:{"animation-delay":"0.2s"}},null,-1),s("div",{class:"h-2 w-0.5 animate-pulse rounded-full bg-blue-500",style:{"animation-delay":"0.4s"}},null,-1)])])):e(ke)==="Generating"?(E(),O("div",La)):e(ke)==="Complete"?(E(),O("div",Pa)):(E(),O("div",Ra))]),s("p",za,b(e(Ie)),1)])])])):X("",!0),s("div",Wa,[r(Pe,{"enter-active-class":"transition-all duration-300 ease-in-out","enter-from-class":"-ml-72 opacity-0","enter-to-class":"ml-0 opacity-100","leave-active-class":"transition-all duration-300 ease-in-out","leave-from-class":"ml-0 opacity-100","leave-to-class":"-ml-72 opacity-0"},{default:n(()=>[e(be)?(E(),O("div",Na,[s("div",Ga,[s("div",Ba,[s("div",Ha,[t[80]||(t[80]=s("h2",{class:"text-sm font-semibold text-foreground mb-1"},"Table of Contents",-1)),s("p",Oa,b(he.value.length)+" Chapters ",1)]),(E(),N(Zs,null,{fallback:n(()=>[...t[81]||(t[81]=[s("div",{class:"flex items-center justify-center p-8"},[s("div",{class:"h-6 w-6 animate-spin rounded-full border-2 border-primary border-t-transparent"})],-1)])]),default:n(()=>[r(e(w),{"all-chapters":he.value,"current-chapter":me.value,project:fe.value,outlines:o.project.outlines||[],"faculty-chapters":o.facultyChapters||[],"current-word-count":e(ae),"target-word-count":ce.value,"writing-quality-score":e(_e),"chapter-content-length":e($).length,onGoToChapter:Ne,onGenerateNextChapter:e(Je)},null,8,["all-chapters","current-chapter","project","outlines","faculty-chapters","current-word-count","target-word-count","writing-quality-score","chapter-content-length","onGenerateNextChapter"])]),_:1}))])])])):X("",!0)]),_:1}),s("div",qa,[s("div",Ia,[s("div",Ua,[r(Ot,{context:ut.value},null,8,["context"]),t[82]||(t[82]=s("div",{class:"h-12"},null,-1))])])]),r(Pe,{"enter-active-class":"transition-all duration-300 ease-in-out","enter-from-class":"-mr-72 opacity-0","enter-to-class":"mr-0 opacity-100","leave-active-class":"transition-all duration-300 ease-in-out","leave-from-class":"mr-0 opacity-100","leave-to-class":"-mr-72 opacity-0"},{default:n(()=>[e(F)?(E(),N(qt,Tt({key:0,"container-class":"w-72 flex-shrink-0 border-l border-border/40 bg-background/40 backdrop-blur-md"},ct.value),null,16)):X("",!0)]),_:1})])])):(E(),N(At,{key:2,class:"h-screen overflow-hidden bg-background dark:bg-background transition-colors duration-300"},{default:n(()=>[s("div",Qa,[t[87]||(t[87]=s("div",{class:"absolute inset-0 z-0 overflow-hidden pointer-events-none"},[s("div",{class:"absolute top-[-10%] left-[-10%] w-[40%] h-[40%] rounded-full bg-blue-500/5 blur-[100px]"}),s("div",{class:"absolute bottom-[-10%] right-[-10%] w-[40%] h-[40%] rounded-full bg-purple-500/5 blur-[100px]"})],-1)),Te(s("aside",Ka,[s("div",Va,[t[84]||(t[84]=s("span",{class:"text-sm font-semibold tracking-tight text-foreground"},"Navigation",-1)),r(e(Ee),{variant:"outline",class:"text-[10px] h-5 px-1.5"},{default:n(()=>[f(b(he.value.length)+" Chapters ",1)]),_:1})]),r(e($t),{class:"flex-1"},{default:n(()=>[s("div",Ja,[r(e(w),{"all-chapters":he.value,"current-chapter":me.value,project:fe.value,outlines:o.project.outlines||[],"faculty-chapters":o.facultyChapters||[],"current-word-count":e(ae),"target-word-count":ce.value,"writing-quality-score":e(_e),"chapter-content-length":e($).length,onGoToChapter:Ne,onGenerateNextChapter:e(Je)},null,8,["all-chapters","current-chapter","project","outlines","faculty-chapters","current-word-count","target-word-count","writing-quality-score","chapter-content-length","onGenerateNextChapter"])])]),_:1})],512),[[Le,!e($e)]]),s("main",Xa,[s("header",Ya,[s("div",Za,[r(e(de),null,{default:n(()=>[r(e(le),{asChild:""},{default:n(()=>[r(e(A),{variant:"ghost",size:"icon",class:"h-9 w-9 text-zinc-700 dark:text-zinc-300 hover:text-foreground hover:bg-muted/50 rounded-full",onClick:t[5]||(t[5]=k=>e(Z).visit(e(K)("projects.writing",c.project.slug)))},{default:n(()=>[r(e(rt),{class:"w-4 h-4"})]),_:1})]),_:1}),r(e(ie),null,{default:n(()=>[...t[85]||(t[85]=[f("Back to Writing",-1)])]),_:1})]),_:1}),t[86]||(t[86]=s("div",{class:"h-6 w-px bg-border/50 mx-1 hidden lg:block"},null,-1)),r(e(A),{variant:"ghost",size:"icon",onClick:t[6]||(t[6]=k=>I.value=!0),class:"lg:hidden text-muted-foreground hover:text-foreground h-9 w-9 hover:bg-muted/50 rounded-full"},{default:n(()=>[r(e(zt),{class:"h-4.5 w-4.5"})]),_:1})]),s("div",eo,[r(e(A),{variant:"ghost",size:"icon",onClick:t[7]||(t[7]=k=>Y.value=!0),class:"text-muted-foreground hover:text-foreground h-9 w-9 hover:bg-muted/50 rounded-full"},{default:n(()=>[r(e(Fe),{class:"h-4.5 w-4.5"})]),_:1})]),s("div",to,[s("div",so,[s("h1",{class:"text-xl font-bold tracking-tight text-foreground leading-snug cursor-pointer hover:text-primary/80 transition-colors break-words",onClick:t[8]||(t[8]=k=>e(Z).visit(e(K)("projects.show",c.project.slug)))},b(c.project.title),1),r(e(Ee),{variant:"secondary",class:"shrink-0 h-5 px-2 text-[10px] font-medium rounded-full bg-secondary/50 border border-border/50 mt-1"},{default:n(()=>[f(" Ch "+b(c.chapter.chapter_number),1)]),_:1})]),s("div",ro,[s("div",no,[r(st,{project:fe.value,"current-chapter":me.value,"all-chapters":he.value,size:"icon",variant:"outline","trigger-element":"icon","button-class":"h-8 w-8 rounded-full bg-background/50 backdrop-blur-sm",class:"text-zinc-700 dark:text-zinc-300"},null,8,["project","current-chapter","all-chapters"]),r(e(A),{variant:"outline",size:"icon",class:"h-8 w-8 gap-2 text-zinc-700 dark:text-zinc-300 hover:text-foreground bg-background/50 backdrop-blur-sm rounded-full",onClick:Ze},{default:n(()=>[r(e(Ht),{class:"w-4 h-4"})]),_:1})])])])])])]),s("div",ao,[s("div",oo,[s("div",lo,[s("h1",{class:"text-sm font-bold text-foreground cursor-pointer hover:text-primary transition-colors flex items-center",onClick:t[9]||(t[9]=k=>e(Z).visit(e(K)("projects.show",c.project.slug)))},[s("div",{innerHTML:c.project.title,class:"inline-block"},null,8,io)]),r(e(Ee),{variant:"secondary",class:"h-5 px-2 text-[10px] font-medium rounded-full bg-secondary/50 border border-border/50"},{default:n(()=>[f(" Ch "+b(c.chapter.chapter_number),1)]),_:1})])]),s("div",uo,[s("div",co,[r(e(de),null,{default:n(()=>[r(e(le),{asChild:""},{default:n(()=>[r(e(A),{variant:"ghost",size:"icon",class:"h-8 w-8 text-zinc-700 dark:text-zinc-300 hover:text-foreground rounded-full",onClick:t[10]||(t[10]=k=>e(Z).visit(e(K)("projects.writing",c.project.slug)))},{default:n(()=>[r(e(rt),{class:"w-4 h-4"})]),_:1})]),_:1}),r(e(ie),null,{default:n(()=>[...t[88]||(t[88]=[f("Back to Writing",-1)])]),_:1})]),_:1}),t[89]||(t[89]=s("div",{class:"h-4 w-px bg-border/50 mx-1"},null,-1)),r(e(A),{variant:"ghost",size:"icon",onClick:t[11]||(t[11]=k=>$e.value=!e($e)),class:"text-muted-foreground hover:text-foreground h-8 w-8 rounded-full"},{default:n(()=>[e($e)?(E(),N(e(Wr),{key:1,class:"h-4 w-4"})):(E(),N(e(zr),{key:0,class:"h-4 w-4"}))]),_:1})]),s("div",po,[s("div",go,[r(e(de),null,{default:n(()=>[r(e(le),{asChild:""},{default:n(()=>[r(e(A),{onClick:yt,variant:e(ge)?"secondary":"ghost",size:"sm",class:"h-7 px-3 text-xs gap-2 text-zinc-700 dark:text-zinc-300 hover:text-foreground rounded-full"},{default:n(()=>[e(ge)?(E(),N(e(qr),{key:1,class:"h-3.5 w-3.5"})):(E(),N(e(Kt),{key:0,class:"h-3.5 w-3.5"})),s("span",fo,b(e(ge)?"Edit":"Preview"),1)]),_:1},8,["variant"])]),_:1}),r(e(ie),null,{default:n(()=>[...t[90]||(t[90]=[f("Toggle Preview Mode",-1)])]),_:1})]),_:1}),t[94]||(t[94]=s("div",{class:"w-px h-3 bg-border/50 mx-0.5"},null,-1)),r(e(de),null,{default:n(()=>[r(e(le),{asChild:""},{default:n(()=>[r(e(A),{onClick:Gs,variant:"ghost",size:"sm",class:"h-7 px-3 text-xs gap-2 text-muted-foreground hover:text-foreground rounded-full"},{default:n(()=>[r(e(Nr),{class:"h-3.5 w-3.5 text-blue-500"}),t[91]||(t[91]=s("span",{class:"hidden xl:inline text-foreground"},"AI Chat",-1))]),_:1})]),_:1}),r(e(ie),null,{default:n(()=>[...t[92]||(t[92]=[f("Open AI Assistant",-1)])]),_:1})]),_:1}),t[95]||(t[95]=s("div",{class:"w-px h-3 bg-border/50 mx-0.5"},null,-1)),r(e(de),null,{default:n(()=>[r(e(le),{asChild:""},{default:n(()=>[r(e(A),{onClick:Ye,variant:"ghost",size:"sm",class:"h-7 px-3 text-xs gap-2 text-muted-foreground hover:text-foreground rounded-full"},{default:n(()=>[e(v)?(E(),N(e(Wt),{key:0,class:"h-3.5 w-3.5"})):(E(),N(e(Nt),{key:1,class:"h-3.5 w-3.5"})),s("span",mo,b(e(v)?"Exit Fullscreen":"Fullscreen"),1)]),_:1})]),_:1}),r(e(ie),null,{default:n(()=>[s("p",null,b(e(v)?"Exit fullscreen":"Enter fullscreen"),1)]),_:1})]),_:1}),t[96]||(t[96]=s("div",{class:"w-px h-3 bg-border/50 mx-0.5"},null,-1)),r(e(de),null,{default:n(()=>[r(e(le),{asChild:""},{default:n(()=>[r(e(A),{onClick:e(q),variant:"ghost",size:"sm",class:"h-7 px-3 text-xs gap-2 text-zinc-700 dark:text-zinc-300 hover:text-foreground rounded-full"},{default:n(()=>[e(W)?(E(),N(e(Gt),{key:0,class:"h-3.5 w-3.5 text-foreground"})):(E(),N(e(Bt),{key:1,class:"h-3.5 w-3.5"}))]),_:1},8,["onClick"])]),_:1}),r(e(ie),null,{default:n(()=>[...t[93]||(t[93]=[f("Toggle Dark Mode",-1)])]),_:1})]),_:1})]),s("div",ho,[r(st,{project:fe.value,"current-chapter":me.value,"all-chapters":he.value,size:"sm",variant:"outline","trigger-element":"button","button-class":"h-9 gap-2 px-3 rounded-full bg-background/50 backdrop-blur-sm",class:"text-zinc-700 dark:text-zinc-300"},null,8,["project","current-chapter","all-chapters"]),r(e(A),{variant:"outline",size:"sm",class:"h-9 gap-2 text-zinc-700 dark:text-zinc-300 hover:text-foreground bg-background/50 backdrop-blur-sm rounded-full",onClick:Ze,title:"Open bulk analysis"},{default:n(()=>[r(e(Ht),{class:"w-4 h-4"}),t[97]||(t[97]=s("span",{class:"text-xs font-medium"},"Analyze",-1))]),_:1})]),s("div",vo,[r(e(A),{onClick:t[12]||(t[12]=k=>e(ue)(!1)),disabled:e(we),variant:Xe.value?"default":"secondary",size:"sm",class:"h-9 px-4 text-xs shadow-sm gap-2 rounded-full min-w-[32px]"},{default:n(()=>[r(e(Vt),{class:"h-3.5 w-3.5"}),s("span",bo,b(e(we)?"Saving":"Save"),1)]),_:1},8,["disabled","variant"]),r(e(A),{onClick:kt,disabled:e(we),size:"sm",class:"h-9 px-4 text-xs shadow-sm gap-2 rounded-full"},{default:n(()=>[r(e(at),{class:"h-3.5 w-3.5"}),t[98]||(t[98]=s("span",null,"Mark Complete",-1))]),_:1},8,["disabled"]),t[99]||(t[99]=s("div",{class:"w-px h-4 bg-border/50 mx-1"},null,-1)),r(e(A),{variant:"ghost",size:"icon",onClick:t[13]||(t[13]=k=>De.value=!e(De)),class:"hidden lg:flex text-muted-foreground hover:text-foreground h-9 w-9 hover:bg-muted/50 rounded-full"},{default:n(()=>[e(De)?(E(),N(e(jr),{key:1,class:"h-4.5 w-4.5"})):(E(),N(e(Ar),{key:0,class:"h-4.5 w-4.5"}))]),_:1})])])])]),s("div",xo,[r(Pe,{"enter-active-class":"transition-all duration-300 ease-out","enter-from-class":"opacity-0 -translate-y-4","enter-to-class":"opacity-100 translate-y-0","leave-active-class":"transition-all duration-200 ease-in","leave-from-class":"opacity-100 translate-y-0","leave-to-class":"opacity-0 -translate-y-4"},{default:n(()=>[e(Ae)?(E(),O("div",wo,[s("div",yo,[s("div",_o,[s("div",Co,[s("div",ko,[r(e(Fe),{class:"h-4 w-4 text-white animate-pulse"})]),s("div",So,[s("div",Eo,[t[100]||(t[100]=s("h4",{class:"text-xs font-semibold text-foreground"}," Generating Content...",-1)),s("span",To,b(Math.round(e(Ce)))+"%",1)]),s("div",$o,[s("div",{class:"h-full bg-gradient-to-r from-blue-500 to-purple-500 transition-all duration-300",style:Qe({width:`${e(Ce)}%`})},null,4)])])]),s("p",Do,b(e(Ie)),1)])])])):X("",!0)]),_:1}),r(e($t),{ref_key:"editorScrollRef",ref:As,class:"h-full w-full"},{default:n(()=>[s("div",Ao,[Te(s("div",jo,[r(Qt,{ref_key:"richTextEditorFullscreen",ref:y,modelValue:e($),"onUpdate:modelValue":t[14]||(t[14]=k=>er($)?$.value=k:null),placeholder:"Start writing your chapter...",class:"prose prose-slate dark:prose-invert prose-lg max-w-none focus:outline-none min-h-[500px]","streaming-mode":e(ft),"is-generating":e(Ae),"generation-progress":e(Ie),"generation-percentage":e(Ce),"generation-phase":e(ke),"onUpdate:selectedText":t[15]||(t[15]=k=>a.value=k),"min-height":"500px"},null,8,["modelValue","streaming-mode","is-generating","generation-progress","generation-percentage","generation-phase"])],512),[[Le,!e(ge)]]),Te(s("div",Mo,[r(Xt,{content:e($),class:"prose prose-slate dark:prose-invert prose-lg max-w-none"},null,8,["content"])],512),[[Le,e(ge)]])])]),_:1},512)]),s("div",Fo,[s("div",Lo,[s("span",null,"Words: "+b(e(ae))+" / "+b(ce.value),1),s("span",Po,"Last saved: "+b(e(we)?"Saving...":`Just
                            now`),1)]),s("div",Ro,[s("span",null,[t[101]||(t[101]=f("Quality: ",-1)),s("span",{class:He(e(_e)>70?"text-green-500":"text-amber-500")},b(e(_e))+"%",3)]),Xe.value?(E(),O("span",zo,[r(e(at),{class:"h-3 w-3"}),t[102]||(t[102]=f(" Ready ",-1))])):X("",!0)])]),r(qt,Tt({"is-collapsed":e(De),"container-class":"hidden lg:flex w-96 flex-col border-l border-border/40 bg-background/60 backdrop-blur-xl z-20 transition-all duration-300"},ct.value),null,16,["is-collapsed"]),r(e(l),{"show-left-sidebar":e(I),"show-right-sidebar":e(Y),"is-mobile":e(qe),"all-chapters":he.value,"current-chapter":me.value,project:fe.value,"current-word-count":e(ae),"target-word-count":ce.value,"writing-quality-score":e(_e),"chapter-content-length":e($).length,"is-generating":e(Ae),"selected-text":e(a),"is-loading-suggestions":e(gt),"show-citation-helper":e(Ue),"chapter-content":e($),"onUpdate:showLeftSidebar":t[16]||(t[16]=k=>I.value=k),"onUpdate:showRightSidebar":t[17]||(t[17]=k=>Y.value=k),onGoToChapter:Ne,onGenerateNextChapter:e(Je),onStartStreamingGeneration:e(ht),onGetAiSuggestions:e(vt),"onUpdate:showCitationHelper":t[18]||(t[18]=k=>Ue.value=k),onCheckCitations:e(bt)},null,8,["show-left-sidebar","show-right-sidebar","is-mobile","all-chapters","current-chapter","project","current-word-count","target-word-count","writing-quality-score","chapter-content-length","is-generating","selected-text","is-loading-suggestions","show-citation-helper","chapter-content","onGenerateNextChapter","onStartStreamingGeneration","onGetAiSuggestions","onCheckCitations"]),r(nr,{open:e(U),"current-balance":e(B),"required-words":e(L),action:e(J),"onUpdate:open":t[19]||(t[19]=k=>U.value=k),onClose:e(ze)},null,8,["open","current-balance","required-words","action","onClose"]),e($s)?(E(),O("div",Wo,[r(e(ee),{class:"w-full max-w-md mx-4 bg-white dark:bg-slate-900 border-amber-500/50 shadow-2xl"},{default:n(()=>[r(e(se),null,{default:n(()=>[r(e(oe),{class:"flex items-center gap-2 text-amber-600 dark:text-amber-400"},{default:n(()=>[...t[103]||(t[103]=[s("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[s("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"})],-1),f(" Generation Interrupted ",-1)])]),_:1})]),_:1}),r(e(te),null,{default:n(()=>[s("p",No,[t[104]||(t[104]=f(" Connection lost. ",-1)),s("span",Go,b(e(Ds))+" words",1),t[105]||(t[105]=f(" may have been saved. ",-1))]),s("div",Bo,[r(e(A),{onClick:e(Ms),class:"flex-1 bg-amber-600 hover:bg-amber-700 text-white"},{default:n(()=>[...t[106]||(t[106]=[s("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-4 w-4 mr-2",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[s("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"})],-1),f(" Reload & Recover ",-1)])]),_:1},8,["onClick"]),r(e(A),{onClick:e(Fs),variant:"outline",class:"flex-1"},{default:n(()=>[...t[107]||(t[107]=[f(" Dismiss ",-1)])]),_:1},8,["onClick"])])]),_:1})]),_:1})])):X("",!0)]),_:1}))],64))]),_:1}))}}),qo=ot(Oo,[["__scopeId","data-v-84b4e47c"]]),ri=Object.freeze(Object.defineProperty({__proto__:null,default:qo},Symbol.toStringTag,{value:"Module"}));export{Wn as A,Jt as B,ri as C,Xt as R};
