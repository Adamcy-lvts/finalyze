import{bt as N,bs as p,dt as T,ci as D,cn as y,co as d,cp as l,cq as r,bE as a,cr as t,cs as n,ct as i,cB as _,cG as b,cR as U,dg as A,cu as z,dl as B,du as L,dv as P,ce as h,cl as C,cj as m}from"./vendor-CugNIqr3.js";import{_ as O}from"./AdminLayout.vue_vue_type_script_setup_true_lang-BDUWd0bJ.js";import{_ as q,a as K}from"./CardContent.vue_vue_type_script_setup_true_lang-Ds49DaDx.js";import{_ as M}from"./CardDescription.vue_vue_type_script_setup_true_lang-BAFga_4Y.js";import{_ as X,a as G}from"./CardTitle.vue_vue_type_script_setup_true_lang-IDxgLF4I.js";import{_ as u}from"./index-Ia6CVdS0.js";import{_ as k}from"./Input.vue_vue_type_script_setup_true_lang-ASyfdFt6.js";import{_ as J}from"./Label.vue_vue_type_script_setup_true_lang-BAVAvlHZ.js";import{_ as Q}from"./index-DBZ0Wbkn.js";import{_ as H,a as I}from"./DialogContent.vue_vue_type_script_setup_true_lang-CJcqQR4M.js";import{_ as W}from"./DialogDescription.vue_vue_type_script_setup_true_lang-B73YHsAb.js";import{_ as Y}from"./DialogFooter.vue_vue_type_script_setup_true_lang-DOvydC-g.js";import{_ as Z,a as ee}from"./DialogTitle.vue_vue_type_script_setup_true_lang-DUiYGDJZ.js";import"./Sonner.vue_vue_type_script_setup_true_lang-DLPHW2_2.js";import"./UserInfo.vue_vue_type_script_setup_true_lang-DoXK2xYg.js";import"./TooltipTrigger.vue_vue_type_script_setup_true_lang-C8jiVShk.js";const te={class:"mb-6"},se={key:0,class:"text-center py-12 text-muted-foreground"},ae={key:1,class:"overflow-x-auto"},oe={class:"w-full"},re={class:"py-4 px-2"},le={class:"font-medium"},ie={class:"text-sm text-muted-foreground"},ne={class:"py-4 px-2"},de={class:"px-2 py-1 bg-muted rounded text-sm"},me={class:"py-4 px-2 text-center"},ue={class:"py-4 px-2 text-right font-medium text-green-600"},fe={class:"py-4 px-2 text-center"},ce={class:"flex items-center justify-center gap-2"},pe={class:"font-medium"},_e={class:"py-4 px-2 text-right"},ge={class:"flex items-center justify-end gap-2"},ve={key:2,class:"flex items-center justify-between mt-6"},xe={class:"text-sm text-muted-foreground"},ye={class:"flex gap-2"},be={class:"space-y-4 py-4"},he={class:"space-y-2"},Ce={class:"text-sm text-muted-foreground"},Le=N({__name:"List",props:{affiliates:{},defaultRate:{}},setup(R){const w=R,f=p(""),c=p(!1),g=p(null),v=p(!1),x=p({commission_rate:0}),S=T(()=>{h.get(C("admin.affiliates.list"),{search:f.value},{preserveState:!0,replace:!0})},300);D(f,()=>{S()});const $=o=>{h.get(C("admin.affiliates.list"),{page:o,search:f.value},{preserveState:!0})},E=o=>{g.value=o,x.value.commission_rate=o.commission_rate??w.defaultRate,c.value=!0},V=async()=>{if(g.value){v.value=!0;try{const e=await(await fetch(C("admin.affiliates.update",g.value.id),{method:"PUT",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":document.querySelector('meta[name="csrf-token"]')?.getAttribute("content")||""},body:JSON.stringify({commission_rate:x.value.commission_rate})})).json();e.success?(m.success(e.message||"Commission rate updated"),c.value=!1,h.reload({only:["affiliates"]})):m.error(e.message||"Failed to update rate")}catch{m.error("Failed to update rate")}finally{v.value=!1}}},j=async o=>{try{const s=await(await fetch(C("admin.affiliates.reset-rate",o.id),{method:"DELETE",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":document.querySelector('meta[name="csrf-token"]')?.getAttribute("content")||""}})).json();s.success?(m.success(s.message||"Rate reset to default"),h.reload({only:["affiliates"]})):m.error(s.message||"Failed to reset rate")}catch{m.error("Failed to reset rate")}};return(o,e)=>(d(),y(O,{title:"Affiliates",subtitle:"Manage affiliates and their commission rates."},{default:l(()=>[r(a(q),{class:"border-border/50"},{default:l(()=>[r(a(X),{class:"flex flex-row items-center justify-between pb-4"},{default:l(()=>[t("div",null,[r(a(G),{class:"text-base"},{default:l(()=>[...e[6]||(e[6]=[n("All Affiliates",-1)])]),_:1}),r(a(M),null,{default:l(()=>[n(" Default commission rate: "+i(o.defaultRate)+"%. Users with custom rates are highlighted. ",1)]),_:1})])]),_:1}),r(a(K),null,{default:l(()=>[t("div",te,[r(a(k),{modelValue:f.value,"onUpdate:modelValue":e[0]||(e[0]=s=>f.value=s),placeholder:"Search by name, email, or referral code...",class:"max-w-md"},null,8,["modelValue"])]),o.affiliates.data.length===0?(d(),_("div",se," No affiliates found ")):(d(),_("div",ae,[t("table",oe,[e[8]||(e[8]=t("thead",null,[t("tr",{class:"border-b border-border/50"},[t("th",{class:"text-left py-3 px-2 text-sm font-medium text-muted-foreground"},"User"),t("th",{class:"text-left py-3 px-2 text-sm font-medium text-muted-foreground"},"Referral Code"),t("th",{class:"text-center py-3 px-2 text-sm font-medium text-muted-foreground"},"Referrals"),t("th",{class:"text-right py-3 px-2 text-sm font-medium text-muted-foreground"},"Total Earned"),t("th",{class:"text-center py-3 px-2 text-sm font-medium text-muted-foreground"},"Commission Rate"),t("th",{class:"text-right py-3 px-2 text-sm font-medium text-muted-foreground"},"Actions")])],-1)),t("tbody",null,[(d(!0),_(U,null,A(o.affiliates.data,s=>(d(),_("tr",{key:s.id,class:z(["border-b border-border/30",{"bg-primary/5":s.has_custom_rate}])},[t("td",re,[t("div",null,[t("p",le,i(s.name),1),t("p",ie,i(s.email),1)])]),t("td",ne,[t("code",de,i(s.referral_code),1)]),t("td",me,i(s.total_referrals),1),t("td",ue,i(s.total_earned_formatted),1),t("td",fe,[t("div",ce,[t("span",pe,i(s.effective_rate)+"%",1),s.has_custom_rate?(d(),y(a(Q),{key:0,variant:"secondary",class:"text-xs"},{default:l(()=>[...e[7]||(e[7]=[n(" Custom ",-1)])]),_:1})):b("",!0)])]),t("td",_e,[t("div",ge,[r(a(u),{variant:"outline",size:"sm",onClick:F=>E(s)},{default:l(()=>[r(a(B),{class:"h-4 w-4"})]),_:2},1032,["onClick"]),s.has_custom_rate?(d(),y(a(u),{key:0,variant:"ghost",size:"sm",onClick:F=>j(s),title:"Reset to default"},{default:l(()=>[r(a(L),{class:"h-4 w-4"})]),_:2},1032,["onClick"])):b("",!0)])])],2))),128))])])])),o.affiliates.last_page>1?(d(),_("div",ve,[t("p",xe," Page "+i(o.affiliates.current_page)+" of "+i(o.affiliates.last_page),1),t("div",ye,[r(a(u),{variant:"outline",size:"sm",disabled:o.affiliates.current_page===1,onClick:e[1]||(e[1]=s=>$(o.affiliates.current_page-1))},{default:l(()=>[...e[9]||(e[9]=[n(" Previous ",-1)])]),_:1},8,["disabled"]),r(a(u),{variant:"outline",size:"sm",disabled:o.affiliates.current_page===o.affiliates.last_page,onClick:e[2]||(e[2]=s=>$(o.affiliates.current_page+1))},{default:l(()=>[...e[10]||(e[10]=[n(" Next ",-1)])]),_:1},8,["disabled"])])])):b("",!0)]),_:1})]),_:1}),r(a(H),{open:c.value,"onUpdate:open":e[5]||(e[5]=s=>c.value=s)},{default:l(()=>[r(a(I),null,{default:l(()=>[r(a(Z),null,{default:l(()=>[r(a(ee),null,{default:l(()=>[...e[11]||(e[11]=[n("Edit Commission Rate",-1)])]),_:1}),r(a(W),null,{default:l(()=>[n(" Set a custom commission rate for "+i(g.value?.name),1)]),_:1})]),_:1}),t("div",be,[t("div",he,[r(a(J),null,{default:l(()=>[...e[12]||(e[12]=[n("Commission Rate (%)",-1)])]),_:1}),r(a(k),{modelValue:x.value.commission_rate,"onUpdate:modelValue":e[3]||(e[3]=s=>x.value.commission_rate=s),modelModifiers:{number:!0},type:"number",min:"0",max:"100",step:"0.5"},null,8,["modelValue"]),t("p",Ce," Default rate is "+i(o.defaultRate)+"%. Leave empty or set to default to use the global rate. ",1)])]),r(a(Y),null,{default:l(()=>[r(a(u),{variant:"outline",onClick:e[4]||(e[4]=s=>c.value=!1)},{default:l(()=>[...e[13]||(e[13]=[n(" Cancel ",-1)])]),_:1}),r(a(u),{onClick:V,disabled:v.value},{default:l(()=>[v.value?(d(),y(a(P),{key:0,class:"h-4 w-4 animate-spin mr-2"})):b("",!0),e[14]||(e[14]=n(" Save Rate ",-1))]),_:1},8,["disabled"])]),_:1})]),_:1})]),_:1},8,["open"])]),_:1}))}});export{Le as default};
