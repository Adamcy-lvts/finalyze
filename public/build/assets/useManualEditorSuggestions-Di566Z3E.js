import{d as P,c as y,o as x,g as s,f as z,k as a,u as l,j as b,y as T,z as w,b as _,e as M,n as L,F,h as W,i as J,v as ee,U as $,t as q,a8 as j,X as te,s as se,af as A}from"./app-BicGrlwU.js";import{c as ae,_ as k}from"./index-C2F2o1a3.js";import{_ as ne}from"./ChapterNavigation.vue_vue_type_script_setup_true_lang-DotjkkyE.js";import{_ as O}from"./index-CRqxo5FJ.js";import{L as G}from"./lightbulb-B0smeiP8.js";import{X as R}from"./x-C7Pzo2_h.js";import{_ as K,a as Q,b as V}from"./CollapsibleTrigger.vue_vue_type_script_setup_true_lang-cwydoWVa.js";import{_ as oe}from"./Progress.vue_vue_type_script_setup_true_lang-DXXPFYZh.js";import{_ as re}from"./Checkbox.vue_vue_type_script_setup_true_lang-C3c6Bwtw.js";import{_ as I}from"./Separator.vue_vue_type_script_setup_true_lang-Dqh7oTLH.js";import{T as N}from"./target-fKT4UHRA.js";import{C as X}from"./chevron-down-BzBSIM3j.js";import{L as ie}from"./loader-circle-C1bSNMcD.js";import{C as D}from"./DropdownMenuTrigger.vue_vue_type_script_setup_true_lang-QaRya4Lh.js";import{C as le}from"./circle-6sFXVBex.js";import{t as C}from"./index-BPEm9iTg.js";import{W as ce,b as de}from"./useTextHistory-_UoCaC96.js";import{S as ue}from"./sparkles-CJgP0bJt.js";import{au as pe,at as ge}from"./RichTextEditor-BK4Soqft.js";import{T as me}from"./type-C1pu9aTT.js";import{_ as fe}from"./DefensePreparationPanel.vue_vue_type_script_setup_true_lang-CoGJwZEf.js";import{_ as he}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{u as Y}from"./index-DN_PCO6k.js";import{r as ve}from"./useWordBalance-VQu8dcZZ.js";/**
 * @license lucide-vue-next v0.468.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const be=ae("BookmarkIcon",[["path",{d:"m19 21-7-4-7 4V5a2 2 0 0 1 2-2h10a2 2 0 0 1 2 2v16z",key:"1fy3hk"}]]),xe={class:"bg-card/50 backdrop-blur-sm border rounded-xl p-4 shadow-sm transition-all hover:shadow-md"},ye={class:"flex items-start justify-between gap-4"},we={class:"flex-1 space-y-3"},_e={class:"flex items-center gap-2"},Ce={class:"p-1.5 rounded-md bg-primary/10 text-primary"},Se=["innerHTML"],ke={key:0,class:"pt-2 border-t border-border/50"},$e={class:"text-xs text-amber-600 dark:text-amber-400 flex items-center gap-1.5"},Te={class:"flex flex-col gap-1"},je={class:"mt-4 flex justify-end"},Le=P({__name:"SmartSuggestionPanel",props:{suggestion:{},analysis:{}},emits:["save","clear","apply"],setup(f,{emit:o}){const r=f,t=o,c=(m=>({writing_guide:{label:"Writing Guide",variant:"default"},claims_without_evidence:{label:"Evidence Needed",variant:"destructive"},insufficient_citations:{label:"Add Citations",variant:"warning"},insufficient_tables:{label:"Add Data",variant:"secondary"},weak_arguments:{label:"Strengthen Arguments",variant:"warning"},insufficient_content:{label:"Expand Content",variant:"secondary"}})[m]||{label:m,variant:"default"})(r.suggestion.suggestion_type);return(m,p)=>(x(),y("div",xe,[s("div",ye,[s("div",we,[s("div",_e,[s("div",Ce,[a(l(G),{class:"w-4 h-4"})]),p[3]||(p[3]=s("h3",{class:"font-semibold text-sm"},"Smart Suggestion",-1)),a(l(O),{variant:l(c).variant,class:"text-[10px] px-2 py-0.5 h-5"},{default:b(()=>[T(w(l(c).label),1)]),_:1},8,["variant"])]),s("div",{class:"prose prose-sm dark:prose-invert max-w-none text-sm text-muted-foreground leading-relaxed",innerHTML:m.suggestion.suggestion_content},null,8,Se),m.analysis&&m.analysis.detected_issues.length>0?(x(),y("div",ke,[s("p",$e,[p[4]||(p[4]=s("span",{class:"w-1.5 h-1.5 rounded-full bg-amber-500"},null,-1)),T(" Issues: "+w(m.analysis.detected_issues.join(", ").replace(/_/g," ")),1)])])):z("",!0)]),s("div",Te,[a(l(k),{size:"icon",variant:"ghost",class:"h-7 w-7",onClick:p[0]||(p[0]=g=>t("clear")),title:"Dismiss"},{default:b(()=>[a(l(R),{class:"w-4 h-4"})]),_:1}),a(l(k),{size:"icon",variant:"ghost",class:"h-7 w-7",onClick:p[1]||(p[1]=g=>t("save")),title:"Save for later"},{default:b(()=>[a(l(be),{class:"w-4 h-4"})]),_:1})])]),s("div",je,[a(l(k),{size:"sm",variant:"default",onClick:p[2]||(p[2]=g=>t("apply")),class:"w-full sm:w-auto"},{default:b(()=>[...p[5]||(p[5]=[T(" Apply Suggestion ",-1)])]),_:1})])]))}}),Ae={class:"space-y-2"},Ie={class:"flex items-center gap-3"},ze={class:"flex flex-col items-start gap-1"},Be={key:0,class:"text-[10px] text-muted-foreground"},Pe={key:0,class:"flex items-center justify-center py-8"},Ee={class:"space-y-2"},Me={class:"flex justify-between text-xs"},Fe={class:"text-muted-foreground"},Ne={class:"space-y-3"},Re={class:"flex items-center justify-between"},Ue={class:"text-sm font-semibold flex items-center gap-2"},We={class:"space-y-2"},De=["onClick"],He={key:0,class:"p-3 rounded-lg bg-blue-500/10 border border-blue-500/20"},qe={class:"flex items-start gap-2"},Oe={class:"flex-1"},Ge={class:"text-xs leading-relaxed text-foreground"},Ke={class:"space-y-3"},Qe={class:"text-sm font-semibold flex items-center gap-2"},Ve={class:"space-y-2"},Xe={key:2,class:"text-center py-8"},Ye=P({__name:"ProgressiveGuidancePanel",props:{guidance:{},isLoading:{type:Boolean}},emits:["toggleStep"],setup(f,{emit:o}){const r=f,t=o,u=_(!0),c=M(()=>{const g=r.guidance?.stage||"planning",n={planning:"bg-blue-500/10 text-blue-600 dark:text-blue-400",introduction:"bg-purple-500/10 text-purple-600 dark:text-purple-400",body_development:"bg-amber-500/10 text-amber-600 dark:text-amber-400",body_advanced:"bg-orange-500/10 text-orange-600 dark:text-orange-400",refinement:"bg-green-500/10 text-green-600 dark:text-green-400"};return n[g]||n.planning}),m=M(()=>r.guidance?r.guidance.next_steps.filter(g=>g.completed).length:0),p=M(()=>r.guidance?.next_steps.length||0);return(g,n)=>(x(),y("div",Ae,[a(l(K),{open:u.value,"onUpdate:open":n[0]||(n[0]=i=>u.value=i),class:"space-y-2"},{default:b(()=>[a(l(Q),{class:"flex w-full items-center justify-between rounded-xl p-4 hover:bg-accent/50 transition-colors duration-200 group"},{default:b(()=>[s("div",Ie,[s("div",{class:L(["p-2 rounded-lg",c.value])},[a(l(N),{class:"h-4 w-4"})],2),s("div",ze,[n[1]||(n[1]=s("span",{class:"text-sm font-semibold"},"Writing Progress",-1)),g.guidance?(x(),y("span",Be,w(g.guidance.stage_label),1)):z("",!0)])]),a(l(X),{class:L(["h-4 w-4 text-muted-foreground transition-transform duration-200",u.value?"rotate-180":""])},null,8,["class"])]),_:1}),a(l(V),{class:"space-y-4 px-4 pb-4"},{default:b(()=>[g.isLoading?(x(),y("div",Pe,[a(l(ie),{class:"h-6 w-6 animate-spin text-muted-foreground"})])):g.guidance?(x(),y(F,{key:1},[s("div",Ee,[s("div",Me,[n[2]||(n[2]=s("span",{class:"font-medium text-foreground"},"Overall Progress",-1)),s("span",Fe,w(g.guidance.completion_percentage)+"% ",1)]),a(l(oe),{"model-value":g.guidance.completion_percentage,class:"h-2"},null,8,["model-value"])]),a(l(I),{class:"bg-border/50"}),s("div",Ne,[s("div",Re,[s("h4",Ue,[a(l(D),{class:"h-4 w-4 text-primary"}),n[3]||(n[3]=T(" Next Steps ",-1))]),a(l(O),{variant:"secondary",class:"text-[10px] px-2 py-0.5"},{default:b(()=>[T(w(m.value)+" / "+w(p.value),1)]),_:1})]),s("div",We,[(x(!0),y(F,null,W(g.guidance.next_steps,i=>(x(),y("div",{key:i.id,class:"flex items-start gap-3 p-3 rounded-lg hover:bg-accent/30 transition-colors duration-200 cursor-pointer group",onClick:v=>t("toggleStep",i.id)},[a(l(re),{checked:i.completed,"onUpdate:checked":v=>t("toggleStep",i.id),class:"mt-0.5"},null,8,["checked","onUpdate:checked"]),s("span",{class:L(["text-xs leading-relaxed flex-1",i.completed?"line-through text-muted-foreground":"text-foreground"])},w(i.text),3)],8,De))),128))])]),g.guidance.contextual_tip?(x(),y("div",He,[s("div",qe,[a(l(G),{class:"h-4 w-4 text-blue-600 dark:text-blue-400 mt-0.5 flex-shrink-0"}),s("div",Oe,[s("p",Ge,w(g.guidance.contextual_tip),1)])])])):z("",!0),a(l(I),{class:"bg-border/50"}),s("div",Ke,[s("h4",Qe,[a(l(N),{class:"h-4 w-4 text-primary"}),n[4]||(n[4]=T(" Milestones ",-1))]),s("div",Ve,[(x(!0),y(F,null,W(g.guidance.writing_milestones,i=>(x(),y("div",{key:i.id,class:"flex items-center gap-3 p-2 rounded-lg"},[(x(),J(ee(i.completed?l(D):l(le)),{class:L(["h-4 w-4",i.completed?"text-green-600 dark:text-green-400":"text-muted-foreground"])},null,8,["class"])),s("span",{class:L(["text-xs",i.completed?"text-foreground font-medium":"text-muted-foreground"])},w(i.label),3)]))),128))])])],64)):(x(),y("div",Xe,[a(l(N),{class:"h-12 w-12 mx-auto text-muted-foreground/50 mb-3"}),n[5]||(n[5]=s("p",{class:"text-sm text-muted-foreground"}," Start writing to get personalized guidance ",-1))]))]),_:1})]),_:1},8,["open"])]))}});function B(f){if(!f)return 0;const r=String(f).replace(/<[^>]*>/g,"").trim().replace(/\s+/g," ");if(!r)return 0;const t=r.match(/\b\w+\b/g);return t?t.length:0}const Ze={class:"space-y-2"},Je={class:"flex items-center gap-3"},et={class:"p-2 rounded-lg bg-purple-500/10 text-purple-600 dark:text-purple-400"},tt={class:"grid grid-cols-2 gap-2"},st={class:"p-1.5 rounded-full bg-blue-500/10 text-blue-500"},at={class:"text-xs font-medium"},nt={class:"p-1.5 rounded-full bg-purple-500/10 text-purple-500"},ot={class:"text-xs font-medium"},rt={class:"p-1.5 rounded-full bg-orange-500/10 text-orange-500"},it={class:"text-xs font-medium"},lt={class:"p-1.5 rounded-full bg-emerald-500/10 text-emerald-500"},ct={class:"text-xs font-medium"},dt=P({__name:"QuickActionsPanel",props:{projectSlug:{},chapterNumber:{},selectedText:{},chapterContent:{},isProcessing:{type:Boolean},ensureBalance:{type:Function},onUsage:{type:Function}},emits:["textImproved","textExpanded","citationsSuggested","textRephrased","customPromptExecuted","openCitationHelper"],setup(f,{emit:o}){const r=f,t=o,u=_(!0),c=_({improve:!1,expand:!1,cite:!1,rephrase:!1,custom:!1}),m=n=>{const i=r.selectedText?.trim()||"",v=r.chapterContent?.trim()||"";return n==="expand"||n==="rephrase"?i:v||i},p=async n=>{try{const i=await n.json();return i?.message||i?.error||`HTTP ${n.status}`}catch{return`HTTP ${n.status}`}},g=async n=>{if(r.ensureBalance&&!r.ensureBalance(300,"use quick actions"))return;const i=m(n);if(!i){C.error(n==="expand"||n==="rephrase"?"Please select some text first":"Please add some content first");return}if(!r.selectedText&&(n==="expand"||n==="rephrase")){C.error("Please select some text first");return}if(n==="cite"){t("openCitationHelper"),C("Opening citation helper...");return}c.value[n]=!0;try{let v="",S;switch(n){case"improve":v="projects.manual-editor.improve-text",S="textImproved";break;case"expand":v="projects.manual-editor.expand-text",S="textExpanded";break;case"rephrase":v="projects.manual-editor.rephrase-text",S="textRephrased";break}const e=await fetch($(v,{project:r.projectSlug,chapter:r.chapterNumber}),{method:"POST",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":document.querySelector('meta[name="csrf-token"]')?.content||"",Accept:"application/json"},body:JSON.stringify({text:i})});if(!e.ok){const h=await p(e);throw new Error(h)}const d=await e.json();n==="improve"&&d.improvedText?(t("textImproved",d.improvedText),await r.onUsage?.(B(d.improvedText),"Manual editor: Improve"),C.success("Text improved successfully!")):n==="expand"&&d.expandedText?(t("textExpanded",d.expandedText),await r.onUsage?.(B(d.expandedText),"Manual editor: Expand"),C.success("Text expanded successfully!")):n==="rephrase"&&d.alternatives&&(t("textRephrased",d.alternatives),await r.onUsage?.(B(d.alternatives),"Manual editor: Rephrase"),C.success("Alternative phrasings generated!"))}catch(v){console.error(`Failed to ${n} text:`,v);const S=v instanceof Error?v.message:"";C.error(`Failed to ${n} text. Please try again.`,S?{description:S}:void 0)}finally{c.value[n]=!1}};return(n,i)=>(x(),y("div",Ze,[a(l(K),{open:u.value,"onUpdate:open":i[4]||(i[4]=v=>u.value=v),class:"space-y-2"},{default:b(()=>[a(l(Q),{class:"flex w-full items-center justify-between rounded-xl p-4 hover:bg-accent/50 transition-colors duration-200 group"},{default:b(()=>[s("div",Je,[s("div",et,[a(l(ce),{class:"h-4 w-4"})]),i[5]||(i[5]=s("div",{class:"flex flex-col items-start gap-1"},[s("span",{class:"text-sm font-semibold"},"Quick Actions"),s("span",{class:"text-[10px] text-muted-foreground"}," AI-powered writing tools ")],-1))]),a(l(X),{class:L(["h-4 w-4 text-muted-foreground transition-transform duration-200",u.value?"rotate-180":""])},null,8,["class"])]),_:1}),a(l(V),{class:"space-y-4 px-4 pb-4"},{default:b(()=>[s("div",tt,[a(l(k),{onClick:i[0]||(i[0]=v=>g("improve")),disabled:n.isProcessing||c.value.improve,variant:"outline",class:"h-20 flex-col gap-2 rounded-xl border-border/50 bg-background/50 hover:bg-accent hover:border-accent transition-all duration-300"},{default:b(()=>[s("div",st,[a(l(ue),{class:"h-4 w-4"})]),s("span",at,w(c.value.improve?"Improving...":"Improve"),1)]),_:1},8,["disabled"]),a(l(k),{onClick:i[1]||(i[1]=v=>g("expand")),disabled:!n.selectedText||n.isProcessing||c.value.expand,variant:"outline",class:"h-20 flex-col gap-2 rounded-xl border-border/50 bg-background/50 hover:bg-accent hover:border-accent transition-all duration-300"},{default:b(()=>[s("div",nt,[a(l(pe),{class:"h-4 w-4"})]),s("span",ot,w(c.value.expand?"Expanding...":"Expand"),1)]),_:1},8,["disabled"]),a(l(k),{onClick:i[2]||(i[2]=v=>g("cite")),disabled:n.isProcessing||c.value.cite,variant:"outline",class:"h-20 flex-col gap-2 rounded-xl border-border/50 bg-background/50 hover:bg-accent hover:border-accent transition-all duration-300"},{default:b(()=>[s("div",rt,[a(l(ge),{class:"h-4 w-4"})]),s("span",it,w(c.value.cite?"Citing...":"Cite"),1)]),_:1},8,["disabled"]),a(l(k),{onClick:i[3]||(i[3]=v=>g("rephrase")),disabled:!n.selectedText||n.isProcessing||c.value.rephrase,variant:"outline",class:"h-20 flex-col gap-2 rounded-xl border-border/50 bg-background/50 hover:bg-accent hover:border-accent transition-all duration-300"},{default:b(()=>[s("div",lt,[a(l(me),{class:"h-4 w-4"})]),s("span",ct,w(c.value.rephrase?"Rephrasing...":"Rephrase"),1)]),_:1},8,["disabled"])]),i[6]||(i[6]=s("div",{class:"p-3 rounded-lg bg-muted/50 border border-border/50"},[s("p",{class:"text-[10px] text-muted-foreground leading-relaxed"},[s("strong",null,"Tip:"),T(" Select text before using Expand or Rephrase. Improve and Cite work on your entire content. ")])],-1))]),_:1})]),_:1},8,["open"])]))}}),ut={key:0,class:"fixed inset-0 z-50 lg:hidden"},pt={class:"fixed top-0 left-0 h-full w-80 overflow-y-auto border-r bg-background shadow-xl transform transition-transform"},gt={class:"border-b p-3"},mt={class:"flex items-center justify-between"},ft={class:"space-y-4 p-4 mobile-enhanced"},ht={key:0,class:"fixed inset-0 z-50 lg:hidden"},vt={class:"fixed top-0 right-0 h-full w-96 overflow-y-auto border-l bg-background shadow-xl transform transition-transform"},bt={class:"border-b p-3"},xt={class:"flex items-center justify-between"},yt={class:"space-y-4 p-4 mobile-enhanced"},wt={key:0,class:"space-y-2"},_t=P({__name:"MobileNavOverlay",props:{showLeftSidebar:{type:Boolean},showRightSidebar:{type:Boolean},isMobile:{type:Boolean},allChapters:{},currentChapter:{},project:{},facultyChapters:{},currentWordCount:{},targetWordCount:{},chapterContentLength:{},selectedText:{},isAnalyzing:{type:Boolean},isSaving:{type:Boolean},currentSuggestion:{},currentAnalysis:{},guidance:{},isLoadingGuidance:{type:Boolean},chapterContent:{},showCitationHelper:{type:Boolean},ensureBalance:{type:Function},onUsage:{type:Function}},emits:["update:showLeftSidebar","update:showRightSidebar","update:showCitationHelper","goToChapter","generateNextChapter","deleteChapter","saveSuggestion","clearSuggestion","applySuggestion","toggleStep","textImproved","textExpanded","citationsSuggested","textRephrased","insertCitation"],setup(f,{emit:o}){const r=f,t=o,u=_(!0),c=_(r.showCitationHelper);q(()=>r.showCitationHelper,e=>{c.value=e});const m=()=>t("update:showLeftSidebar",!1),p=()=>t("update:showRightSidebar",!1),g=e=>{c.value=e,t("update:showCitationHelper",e)},n=e=>{t("goToChapter",e),m()},i=()=>t("generateNextChapter"),v=e=>t("deleteChapter",e),S=e=>t("insertCitation",e);return(e,d)=>(x(),y("div",null,[a(j,{"enter-active-class":"duration-300 ease-out","enter-from-class":"opacity-0","enter-to-class":"opacity-100","leave-active-class":"duration-200 ease-in","leave-from-class":"opacity-100","leave-to-class":"opacity-0"},{default:b(()=>[e.showLeftSidebar&&e.isMobile?(x(),y("div",ut,[a(j,{"enter-active-class":"duration-300 ease-out","enter-from-class":"opacity-0","enter-to-class":"opacity-100","leave-active-class":"duration-200 ease-in","leave-from-class":"opacity-100","leave-to-class":"opacity-0"},{default:b(()=>[s("div",{class:"fixed inset-0 bg-black/50",onClick:m})]),_:1}),a(j,{"enter-active-class":"duration-300 ease-out","enter-from-class":"-translate-x-full","enter-to-class":"translate-x-0","leave-active-class":"duration-200 ease-in","leave-from-class":"translate-x-0","leave-to-class":"-translate-x-full"},{default:b(()=>[s("div",pt,[s("div",gt,[s("div",mt,[d[10]||(d[10]=s("h2",{class:"text-base font-semibold"},"Table of Contents",-1)),a(l(k),{onClick:m,variant:"ghost",size:"sm",class:"h-8 w-8"},{default:b(()=>[a(l(R),{class:"h-4 w-4"})]),_:1})])]),s("div",ft,[a(ne,{"all-chapters":e.allChapters,"current-chapter":e.currentChapter,project:e.project,outlines:e.project.outlines||[],"faculty-chapters":e.facultyChapters||[],"current-word-count":e.currentWordCount,"target-word-count":e.targetWordCount,"writing-quality-score":0,"chapter-content-length":e.chapterContentLength,onGoToChapter:n,onGenerateNextChapter:i,onDeleteChapter:v},null,8,["all-chapters","current-chapter","project","outlines","faculty-chapters","current-word-count","target-word-count","chapter-content-length"])])])]),_:1})])):z("",!0)]),_:1}),a(j,{"enter-active-class":"duration-300 ease-out","enter-from-class":"opacity-0","enter-to-class":"opacity-100","leave-active-class":"duration-200 ease-in","leave-from-class":"opacity-100","leave-to-class":"opacity-0"},{default:b(()=>[e.showRightSidebar&&e.isMobile?(x(),y("div",ht,[a(j,{"enter-active-class":"duration-300 ease-out","enter-from-class":"opacity-0","enter-to-class":"opacity-100","leave-active-class":"duration-200 ease-in","leave-from-class":"opacity-100","leave-to-class":"opacity-0"},{default:b(()=>[s("div",{class:"fixed inset-0 bg-black/50",onClick:p})]),_:1}),a(j,{"enter-active-class":"duration-300 ease-out","enter-from-class":"translate-x-full","enter-to-class":"translate-x-0","leave-active-class":"duration-200 ease-in","leave-from-class":"translate-x-0","leave-to-class":"translate-x-full"},{default:b(()=>[s("div",vt,[s("div",bt,[s("div",xt,[d[11]||(d[11]=s("h2",{class:"text-base font-semibold"},"AI Tools",-1)),a(l(k),{onClick:p,variant:"ghost",size:"sm",class:"h-8 w-8"},{default:b(()=>[a(l(R),{class:"h-4 w-4"})]),_:1})])]),s("div",yt,[e.currentSuggestion?(x(),y("div",wt,[a(Le,{suggestion:e.currentSuggestion,analysis:e.currentAnalysis,onSave:d[0]||(d[0]=h=>e.$emit("saveSuggestion",h)),onClear:d[1]||(d[1]=h=>e.$emit("clearSuggestion")),onApply:d[2]||(d[2]=h=>e.$emit("applySuggestion"))},null,8,["suggestion","analysis"]),a(l(I),{class:"bg-border/50"})])):z("",!0),a(Ye,{guidance:e.guidance,"is-loading":e.isLoadingGuidance,onToggleStep:d[3]||(d[3]=h=>e.$emit("toggleStep",h))},null,8,["guidance","is-loading"]),a(l(I),{class:"bg-border/50"}),a(dt,{"project-slug":e.project.slug,"chapter-number":e.currentChapter.chapter_number,"selected-text":e.selectedText,"chapter-content":e.chapterContent,"is-processing":e.isAnalyzing||e.isSaving,"ensure-balance":e.ensureBalance,"on-usage":e.onUsage,onTextImproved:d[4]||(d[4]=h=>e.$emit("textImproved",h)),onTextExpanded:d[5]||(d[5]=h=>e.$emit("textExpanded",h)),onCitationsSuggested:d[6]||(d[6]=h=>e.$emit("citationsSuggested",h)),onTextRephrased:d[7]||(d[7]=h=>e.$emit("textRephrased",h))},null,8,["project-slug","chapter-number","selected-text","chapter-content","is-processing","ensure-balance","on-usage"]),a(l(I),{class:"bg-border/50"}),a(de,{"show-citation-helper":c.value,"onUpdate:showCitationHelper":[d[8]||(d[8]=h=>c.value=h),g],"chapter-content":e.chapterContent,onInsertCitation:S},null,8,["show-citation-helper","chapter-content"]),a(l(I),{class:"bg-border/50"}),a(fe,{"show-defense-prep":u.value,"onUpdate:showDefensePrep":d[9]||(d[9]=h=>u.value=h),questions:[],"is-loading":!1,"is-generating":!1,"chapter-context":{project:e.project,chapter:e.currentChapter,wordCount:e.currentWordCount},onGenerateMore:()=>{},onRefresh:()=>{}},null,8,["show-defense-prep","chapter-context"])])])]),_:1})])):z("",!0)]),_:1})]))}}),Kt=he(_t,[["__scopeId","data-v-4ca5dd74"]]);function Qt(f,o){const r=_(f.content||""),t=_(!1),u=_(!1),c=_(null),m=e=>{r.value=e,t.value=!0,g()},p=async()=>{if(!(!t.value||u.value)){u.value=!0;try{await A.post($("projects.manual-editor.save",{project:o,chapter:f.chapter_number}),{content:r.value}),t.value=!1,c.value=new Date().toLocaleTimeString()}catch(e){throw console.error("Failed to save chapter:",e),e}finally{u.value=!1}}},g=Y(p,2e3),n=async()=>{if(!u.value){u.value=!0;try{return await A.post($("projects.manual-editor.save",{project:o,chapter:f.chapter_number}),{content:r.value}),t.value=!1,c.value=new Date().toLocaleTimeString(),!0}catch(e){throw console.error("Failed to save chapter:",e),e}finally{u.value=!1}}},i=e=>{t.value&&(e.preventDefault(),e.returnValue="")},v=e=>{t.value&&!confirm("You have unsaved changes. Are you sure you want to leave?")&&e.preventDefault()};window.addEventListener("beforeunload",i);const S=te.on("before",v);return se(()=>{window.removeEventListener("beforeunload",i),S(),t.value&&p()}),{content:r,isDirty:t,isSaving:u,lastSaved:c,updateContent:m,save:p,manualSave:n}}class H{static analyze(o){const t=new DOMParser().parseFromString(o,"text/html");return{word_count:this.countWords(t),citation_count:this.countCitations(t),table_count:this.countTables(t),figure_count:this.countFigures(t),claim_count:this.countClaims(t),has_introduction:this.hasIntroduction(t),has_conclusion:this.hasConclusion(t),detected_issues:this.detectIssues(t),quality_metrics:this.calculateQualityMetrics(t)}}static countWords(o){return(o.body.textContent||"").trim().split(/\s+/).filter(t=>t.length>0).length}static countCitations(o){const r=o.body.textContent||"",t=[/\([A-Z][a-z]+,?\s+\d{4}\)/g,/\[[0-9]+\]/g,/\([A-Z][a-z]+\s+et al\.,?\s+\d{4}\)/g];let u=0;return t.forEach(c=>{const m=r.match(c);m&&(u+=m.length)}),u+=o.querySelectorAll("cite, [data-citation]").length,u}static countTables(o){return o.querySelectorAll("table").length}static countFigures(o){return o.querySelectorAll("img, figure").length}static countClaims(o){const t=(o.body.textContent||"").split(/[.!?]+/),u=["demonstrates","proves","shows","indicates","reveals","confirms","establishes","suggests","implies","evidences"];return t.filter(c=>u.some(m=>c.toLowerCase().includes(m))).length}static hasIntroduction(o){const r=(o.body.textContent||"").toLowerCase();return["introduction","background","overview"].some(u=>r.includes(u))}static hasConclusion(o){const r=(o.body.textContent||"").toLowerCase();return["conclusion","summary","in summary"].some(u=>r.includes(u))}static detectIssues(o){const r=[],t=o.body.textContent||"",u=this.countClaims(o),c=this.countCitations(o);return u>0&&c===0&&r.push("claims_without_evidence"),u>c*2&&r.push("insufficient_citations"),t.toLowerCase().includes("methodology")&&this.countTables(o)===0&&r.push("insufficient_tables"),["maybe","might","could possibly","seems to"].some(i=>t.toLowerCase().includes(i))&&u>3&&r.push("weak_arguments"),this.countWords(o)<100&&r.push("insufficient_content"),r}static calculateQualityMetrics(o){const t=(o.body.textContent||"").split(/[.!?]+/).filter(m=>m.trim().length>0),u=o.querySelectorAll("p").length,c=t.length>0?this.countWords(o)/t.length:0;return{avg_sentence_length:Math.round(c),paragraph_count:u,reading_level:c>25?"complex":c>15?"moderate":"simple"}}}function Vt(f,o,r,t,u){const c=_(r),m=_(null),p=_(!1),g=_(new Set),i=Y(async()=>{if(!(t.value.length<100)&&!(!o||!f?.chapter_number)){p.value=!0;try{const d=H.analyze(t.value);if(m.value=d,d.detected_issues.length===0){p.value=!1;return}const h=await A.post($("projects.manual-editor.analyze",{project:o,chapter:f.chapter_number}),{analysis:d});if(h.data.suggestion){c.value=h.data.suggestion;const E=Number(h.data.suggestion?.id);if(E&&!g.value.has(E)){const U=B(h.data.suggestion?.suggestion_content||"");U>0&&(g.value.add(E),ve(U,"Manual editor: Smart suggestion","chapter",f.id).then(()=>u?.onUsageRecorded?.()).catch(Z=>console.error("Failed to record word usage (manual suggestion):",Z)))}}}catch(d){console.error("Failed to analyze and request suggestion:",d)}finally{p.value=!1}}},5e3);return q(t,()=>{t.value.length>0&&(m.value=H.analyze(t.value)),i()}),{currentSuggestion:c,currentAnalysis:m,isAnalyzing:p,saveSuggestion:async()=>{if(c.value&&!(!o||!f?.chapter_number))try{await A.post($("projects.manual-editor.suggestion.save",{project:o,chapter:f.chapter_number,suggestion:c.value.id})),C("Suggestion saved",{description:"You can refer to this suggestion later."})}catch{C("Failed to save suggestion",{description:"Please try again."})}},clearSuggestion:async()=>{if(c.value&&!(!o||!f?.chapter_number))try{await A.post($("projects.manual-editor.suggestion.clear",{project:o,chapter:f.chapter_number,suggestion:c.value.id})),c.value=null}catch{C("Failed to clear suggestion",{description:"Please try again."})}},applySuggestion:async()=>{if(c.value&&!(!o||!f?.chapter_number))try{await A.post($("projects.manual-editor.suggestion.apply",{project:o,chapter:f.chapter_number,suggestion:c.value.id})),C("Suggestion applied",{description:"The suggestion has been marked as applied."}),c.value=null}catch{C("Failed to apply suggestion",{description:"Please try again."})}}}}export{Kt as M,dt as _,Vt as a,Ye as b,Le as c,B as d,Qt as u};
