const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/AISidebar-Css40JTa.js","assets/app-kMzXYWEA.js","assets/app-DD1yInD9.css","assets/index-2wKCe29u.js","assets/CardContent.vue_vue_type_script_setup_true_lang-BEr9lm65.js","assets/CardTitle.vue_vue_type_script_setup_true_lang-BYHSNR5l.js","assets/CollapsibleTrigger.vue_vue_type_script_setup_true_lang-Bs35rMEx.js","assets/VisuallyHidden-RPO-SrT_.js","assets/useForwardExpose-CSFTgCZL.js","assets/Separator.vue_vue_type_script_setup_true_lang-C2t36Wk3.js","assets/Separator-BrtoA9xi.js","assets/Progress.vue_vue_type_script_setup_true_lang-BameWd8f.js","assets/nullish-CHIgUVhi.js","assets/Sonner.vue_vue_type_script_setup_true_lang-BSo03tA9.js","assets/DropdownMenuTrigger.vue_vue_type_script_setup_true_lang-C2-2kYX8.js","assets/triangle-alert-DfeVAgAr.js","assets/circle-check-BRAsXQY8.js","assets/CitationHelper.vue_vue_type_script_setup_true_lang-DEJQg6Vw.js","assets/index-B2pAlSlg.js","assets/Input.vue_vue_type_script_setup_true_lang-I_dB1RyU.js","assets/ScrollArea.vue_vue_type_script_setup_true_lang-D0j-Q_Ir.js","assets/useNonce-B48ae4MP.js","assets/AlertDialogTitle.vue_vue_type_script_setup_true_lang-CSSi6mUJ.js","assets/RichTextEditor-Cw2Kabxu.js","assets/_plugin-vue_export-helper-DlAUqK2U.js","assets/SafeHtmlText.vue_vue_type_script_setup_true_lang-7w4om_r4.js","assets/index-BWEDi_FC.js","assets/step-DrZ9DcYd.js","assets/chart-column-BWryFIfo.js","assets/calendar-Cu6k7iQ9.js","assets/brain-6sG0E3cb.js","assets/users-CMaJBj0k.js","assets/circle-alert-1d0qPHdh.js","assets/eye-Cyt6oIwH.js","assets/check-m4EVPAIF.js","assets/download-CS6obBBH.js","assets/trash-2-D2BqslQf.js","assets/DialogTitle.vue_vue_type_script_setup_true_lang-CQ89JXhn.js","assets/DialogFooter.vue_vue_type_script_setup_true_lang-BNc2ZwIO.js","assets/Label.vue_vue_type_script_setup_true_lang-BuwkxDsL.js","assets/type-CTedqkTn.js","assets/minus-BWJpyRQt.js","assets/plus-DG5l8axV.js","assets/list-D_3E2WE5.js","assets/RichTextEditor-z2v7eHQ7.css","assets/chevron-down-DTau5fl-.js","assets/wand-sparkles-CaTSGDFD.js","assets/search-EctnIPw2.js","assets/history-iPNi5_hM.js","assets/zap-CzcwfdhO.js","assets/pen-tool-DzZZwWKx.js","assets/refresh-cw-Doe3uHEJ.js","assets/sparkles-ChGUHL-d.js","assets/AISidebar-Ymbz_oju.css","assets/ChapterNavigation-CfFFsHnN.js","assets/ChapterNavigation.vue_vue_type_script_setup_true_lang-DRwpGoIM.js","assets/DialogTrigger-Bohzrxkh.js","assets/chevron-right-m57K1jQj.js","assets/circle-check-big-ZZkD1CsK.js","assets/lock-B35P9o98.js","assets/target-CbSVr0kh.js","assets/MobileNavOverlay-DFSb1_TC.js","assets/index-BouxiyS6.js","assets/DefensePreparationPanel.vue_vue_type_script_setup_true_lang-jrRrL4mR.js","assets/Switch.vue_vue_type_script_setup_true_lang-BpCQqS53.js","assets/VisuallyHiddenInput-B0vU2HJq.js","assets/thumbs-up-BUDg611F.js","assets/lightbulb-DD7iJAqI.js","assets/DataCollectionPanel.vue_vue_type_script_setup_true_lang-DrFAOYb1.js","assets/MobileNavOverlay-CN-XSdXy.css","assets/ChatModeLayout-Yy2VGwgB.js","assets/ChatModeLayout.vue_vue_type_script_setup_true_lang-TzLlOu-v.js","assets/square-BoXXWAqr.js","assets/useTextHistory-BiMf8zgM.js","assets/Checkbox.vue_vue_type_script_setup_true_lang-CCq6AgC0.js","assets/ohash.D__AXeF1-C-E83dC9.js","assets/RovingFocusItem-BhSUgOck.js","assets/file-text-vk6Muk7n.js","assets/useTextHistory-Bq6uVPnZ.css","assets/loader-DgHOYqfS.js","assets/message-square-BTp2GeD3.js","assets/chevron-left-24wNCJlQ.js","assets/clock-CNDDN6e3.js","assets/user-CKsvvdaZ.js","assets/save-Bnsj-Ycn.js","assets/ChatModeLayout-wjQGykpm.css","assets/CitationVerificationLayout-D_hXlDi9.js","assets/DefensePreparationPanel-DN8dywKO.js","assets/DataCollectionPanel-D5pzz7B0.js"])))=>i.map(i=>d[i]);
import{ak as ya,ab as _a,d as Tr,g as M,c as K,q as oe,o as k,u as r,w as l,k as n,e as a,s as A,n as pe,t as R,a as B,F as vr,A as hr,X as st,z as i,Q as Te,C as fe,y as Q,U as Ca,h as ht,p as ft,j as ka,H as Ea,al as Fe,x as Be,T as mt,am as wt,b as Qe,f as Je,an as Le}from"./app-kMzXYWEA.js";import{_ as Oe}from"./index-B2pAlSlg.js";import{_ as H}from"./index-2wKCe29u.js";import{_ as Dt,a as Ft}from"./CardContent.vue_vue_type_script_setup_true_lang-BEr9lm65.js";import{_ as Lt,a as Ar}from"./CardTitle.vue_vue_type_script_setup_true_lang-BYHSNR5l.js";import{_ as Sa}from"./Input.vue_vue_type_script_setup_true_lang-I_dB1RyU.js";import{_ as Ta}from"./Label.vue_vue_type_script_setup_true_lang-BuwkxDsL.js";import{_ as fr}from"./ScrollArea.vue_vue_type_script_setup_true_lang-D0j-Q_Ir.js";import{_ as ke,a as Ee,b as Se}from"./UserInfo.vue_vue_type_script_setup_true_lang-CAiijHe9.js";import{u as Aa,r as Xe,_ as $a,a as Ra}from"./AppLayout.vue_vue_type_script_setup_true_lang-D6MNitP0.js";import{_ as mr}from"./SafeHtmlText.vue_vue_type_script_setup_true_lang-7w4om_r4.js";import{t as w,M as Pa,S as Ma}from"./Sonner.vue_vue_type_script_setup_true_lang-BSo03tA9.js";import{_ as qa}from"./PurchaseModal.vue_vue_type_script_setup_true_lang-CWZZZqEs.js";import{_ as ja}from"./Progress.vue_vue_type_script_setup_true_lang-BameWd8f.js";import{B as xt,u as Da,M as wr,_ as br,R as xr,a as Fa,b as La,P as Oa,c as Na}from"./useTextHistory-BiMf8zgM.js";import{T as Wa}from"./trending-up-ODdrsND8.js";import{C as Ia}from"./circle-alert-1d0qPHdh.js";import{ap as yr}from"./RichTextEditor-Cw2Kabxu.js";import{t as _r}from"./toNumber-CyJmWCaI.js";import{A as za}from"./arrow-left-CMcRJYqh.js";import{B as nt}from"./brain-6sG0E3cb.js";import{T as Cr}from"./target-CbSVr0kh.js";import{E as kr}from"./eye-Cyt6oIwH.js";import{S as Er}from"./save-Bnsj-Ycn.js";import{C as qt}from"./circle-check-big-ZZkD1CsK.js";import{P as Ga,a as Ha}from"./panel-left-open-DEYu1Wlm.js";import{M as Ua}from"./message-square-BTp2GeD3.js";import{_ as Ka}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./useForwardExpose-CSFTgCZL.js";import"./VisuallyHidden-RPO-SrT_.js";import"./useNonce-B48ae4MP.js";import"./DropdownMenuTrigger.vue_vue_type_script_setup_true_lang-C2-2kYX8.js";import"./coins-k_o5Vu46.js";import"./AppLogoIcon.vue_vue_type_script_setup_true_lang-Db7OmfV4.js";import"./plus-DG5l8axV.js";import"./chevron-right-m57K1jQj.js";import"./triangle-alert-DfeVAgAr.js";import"./circle-check-BRAsXQY8.js";import"./DialogTitle.vue_vue_type_script_setup_true_lang-CQ89JXhn.js";import"./DialogFooter.vue_vue_type_script_setup_true_lang-BNc2ZwIO.js";import"./sparkles-ChGUHL-d.js";import"./arrow-right-B1g1Hkwk.js";import"./nullish-CHIgUVhi.js";import"./Checkbox.vue_vue_type_script_setup_true_lang-CCq6AgC0.js";import"./ohash.D__AXeF1-C-E83dC9.js";import"./VisuallyHiddenInput-B0vU2HJq.js";import"./RovingFocusItem-BhSUgOck.js";import"./minus-BWJpyRQt.js";import"./check-m4EVPAIF.js";import"./Separator.vue_vue_type_script_setup_true_lang-C2t36Wk3.js";import"./Separator-BrtoA9xi.js";import"./download-CS6obBBH.js";import"./chevron-down-DTau5fl-.js";import"./file-text-vk6Muk7n.js";import"./index-BWEDi_FC.js";import"./step-DrZ9DcYd.js";import"./chart-column-BWryFIfo.js";import"./calendar-Cu6k7iQ9.js";import"./users-CMaJBj0k.js";import"./trash-2-D2BqslQf.js";import"./type-CTedqkTn.js";import"./list-D_3E2WE5.js";var jt=function(){return ya.Date.now()},Va="Expected a function",Ba=Math.max,Qa=Math.min;function Ja(L,C,q){var N,f,p,x,g,s,P=0,G=!1,h=!1,F=!0;if(typeof L!="function")throw new TypeError(Va);C=_r(C)||0,_a(q)&&(G=!!q.leading,h="maxWait"in q,p=h?Ba(_r(q.maxWait)||0,C):p,F="trailing"in q?!!q.trailing:F);function v(W){var y=N,te=f;return N=f=void 0,P=W,x=L.apply(te,y),x}function O(W){return P=W,g=setTimeout(Z,C),G?v(W):x}function I(W){var y=W-s,te=W-P,re=C-y;return h?Qa(re,p-te):re}function J(W){var y=W-s,te=W-P;return s===void 0||y>=C||y<0||h&&te>=p}function Z(){var W=jt();if(J(W))return ge(W);g=setTimeout(Z,I(W))}function ge(W){return g=void 0,F&&N?v(W):(N=f=void 0,x)}function ue(){g!==void 0&&clearTimeout(g),P=0,N=s=f=g=void 0}function xe(){return g===void 0?x:ge(jt())}function ve(){var W=jt(),y=J(W);if(N=arguments,f=this,s=W,y){if(g===void 0)return O(s);if(h)return clearTimeout(g),g=setTimeout(Z,C),v(s)}return g===void 0&&(g=setTimeout(Z,C)),x}return ve.cancel=ue,ve.flush=xe,ve}const Xa={class:"flex items-center justify-between mb-3"},Ya={class:"flex items-center gap-3"},Za={class:"p-2 rounded-lg bg-blue-500/10"},eo={class:"text-right"},to={class:"space-y-2"},ro={class:"flex justify-between items-center text-xs"},ao={class:"relative"},oo={key:0},no={class:"space-y-3"},so={class:"flex-1"},lo={class:"text-sm font-medium"},io={class:"text-xs text-muted-foreground"},co={class:"w-20 h-2 bg-muted rounded-full overflow-hidden ml-3"},uo={key:1},po={class:"space-y-2"},go={class:"flex-1"},vo={class:"text-sm font-medium"},ho={class:"text-xs text-muted-foreground"},fo={key:2,class:"flex items-center justify-center gap-3 p-4 rounded-lg bg-blue-50/50 border border-blue-200/50"},mo={key:3,class:"text-center p-4 rounded-lg bg-muted/30"},Sr=Tr({__name:"WritingStatistics",props:{showStatistics:{type:Boolean},currentWordCount:{},writingStats:{},qualityAnalysis:{},isAnalyzing:{type:Boolean}},setup(L){const C=L;M(()=>{if(!C.qualityAnalysis?.quality_level)return"text-muted-foreground";switch(C.qualityAnalysis.quality_level){case"Excellent":return"text-green-600";case"Good":return"text-blue-600";case"Satisfactory":return"text-yellow-600";case"Needs Improvement":return"text-orange-600";case"Poor":return"text-red-600";default:return"text-muted-foreground"}});const q=M(()=>C.qualityAnalysis?.scores?Object.entries(C.qualityAnalysis.scores).filter(([,f])=>f.max>0).filter(([,f])=>f.percentage<75).sort(([,f],[,p])=>f.percentage-p.percentage).map(([f,p])=>({category:f.replace(" & "," & "),percentage:Math.round(p.percentage),score:p.score,max:p.max,status:p.percentage<40?"poor":p.percentage<60?"needs-work":"fair"})):[]),N=M(()=>{const f=C.qualityAnalysis?.total_score||0;return f>=80?{text:"Excellent",color:"text-green-600",bgColor:"bg-green-50"}:f>=70?{text:"Satisfactory",color:"text-yellow-600",bgColor:"bg-yellow-50"}:f>=60?{text:"Needs Work",color:"text-orange-600",bgColor:"bg-orange-50"}:{text:"Poor",color:"text-red-600",bgColor:"bg-red-50"}});return(f,p)=>f.showStatistics?(k(),K(r(Dt),{key:0,class:"border border-border/50 bg-gradient-to-br from-card/80 to-card/60 backdrop-blur-sm shadow-lg"},{default:l(()=>[f.qualityAnalysis?(k(),K(r(Lt),{key:0,class:"pb-4 border-b border-border/50"},{default:l(()=>[a("div",Xa,[a("div",Ya,[a("div",Za,[n(r(xt),{class:"h-4 w-4 text-blue-600"})]),a("div",null,[n(r(Ar),{class:"text-sm font-semibold"},{default:l(()=>[...p[0]||(p[0]=[A("Academic Quality",-1)])]),_:1}),p[1]||(p[1]=a("p",{class:"text-xs text-muted-foreground"},"AI-powered analysis",-1))])]),a("div",eo,[a("div",{class:pe(["text-2xl font-bold",N.value.color])},[A(R(f.qualityAnalysis.total_score),1),p[2]||(p[2]=a("span",{class:"text-sm text-muted-foreground"},"/100",-1))],2),n(r(Oe),{class:pe([[N.value.color,N.value.bgColor],"text-xs font-medium"]),variant:"outline"},{default:l(()=>[A(R(N.value.text),1)]),_:1},8,["class"])])]),a("div",to,[a("div",ro,[p[3]||(p[3]=a("span",{class:"text-muted-foreground"},"Overall Score",-1)),a("span",{class:pe(["font-medium",f.qualityAnalysis.meets_threshold?"text-green-600":"text-orange-600"])},R(f.qualityAnalysis.meets_threshold?"Meets threshold âœ“":"Below 80% threshold"),3)]),a("div",ao,[n(r(ja),{"model-value":Math.round(f.qualityAnalysis.total_score||0),class:pe(["h-2",{"[&>[data-slot=progress-indicator]]:bg-green-500":(f.qualityAnalysis.total_score||0)>=80,"[&>[data-slot=progress-indicator]]:bg-yellow-500":(f.qualityAnalysis.total_score||0)>=70&&(f.qualityAnalysis.total_score||0)<80,"[&>[data-slot=progress-indicator]]:bg-orange-500":(f.qualityAnalysis.total_score||0)>=60&&(f.qualityAnalysis.total_score||0)<70,"[&>[data-slot=progress-indicator]]:bg-red-500":(f.qualityAnalysis.total_score||0)<60}])},null,8,["model-value","class"]),p[4]||(p[4]=a("div",{class:"absolute inset-0 flex items-center justify-center"},[a("div",{class:"w-0.5 h-4 bg-orange-400/60 rounded-full",style:{"margin-left":"80%"}})],-1))])])]),_:1})):oe("",!0),n(r(Ft),{class:"p-4 space-y-4"},{default:l(()=>[f.qualityAnalysis?.scores?(k(),B("div",oo,[p[5]||(p[5]=a("h4",{class:"text-xs font-semibold text-muted-foreground mb-3 flex items-center gap-2"},[a("div",{class:"w-1 h-4 bg-green-500 rounded-full"}),A(" Analysis Results ")],-1)),a("div",no,[(k(!0),B(vr,null,hr(Object.entries(f.qualityAnalysis.scores).filter(([,x])=>x.max>0),([x,g])=>(k(),B("div",{key:x,class:"flex items-center justify-between p-3 rounded-lg bg-muted/30 hover:bg-muted/40 transition-colors"},[a("div",so,[a("div",lo,R(x),1),a("div",io,[A(R(g.score)+"/"+R(g.max)+" points ",1),a("span",{class:pe(["ml-1",{"text-red-500":g.percentage<50,"text-orange-500":g.percentage>=50&&g.percentage<75,"text-blue-500":g.percentage>=75&&g.percentage<90,"text-green-500":g.percentage>=90}])}," ("+R(Math.round(g.percentage))+"%) ",3)])]),a("div",co,[a("div",{class:pe(["h-full transition-all duration-500 rounded-full",{"bg-red-500":g.percentage<50,"bg-orange-500":g.percentage>=50&&g.percentage<75,"bg-blue-500":g.percentage>=75&&g.percentage<90,"bg-green-500":g.percentage>=90}]),style:st({width:`${g.percentage}%`})},null,6)])]))),128))])])):oe("",!0),q.value.length>0?(k(),B("div",uo,[p[6]||(p[6]=a("h4",{class:"text-xs font-semibold text-muted-foreground mb-3 flex items-center gap-2"},[a("div",{class:"w-1 h-4 bg-orange-500 rounded-full"}),A(" Focus Areas ")],-1)),a("div",po,[(k(!0),B(vr,null,hr(q.value,x=>(k(),B("div",{key:x.category,class:"flex items-center gap-3 p-3 rounded-lg border border-orange-200/50 bg-orange-50/30"},[n(r(Ia),{class:"h-4 w-4 text-orange-500 flex-shrink-0"}),a("div",go,[a("div",vo,R(x.category),1),a("div",ho,[A(R(x.score)+"/"+R(x.max)+" points - ",1),a("span",{class:pe({"text-red-600":x.status==="poor","text-orange-600":x.status==="needs-work","text-yellow-600":x.status==="fair"})},R(x.status==="poor"?"needs significant improvement":x.status==="needs-work"?"needs improvement":"fair, could be better"),3)])])]))),128))])])):oe("",!0),f.isAnalyzing?(k(),B("div",fo,[n(r(Wa),{class:"h-4 w-4 text-blue-500 animate-pulse"}),p[7]||(p[7]=a("span",{class:"text-sm text-blue-700 font-medium"},"Analyzing academic quality with AI...",-1))])):oe("",!0),!f.qualityAnalysis&&!f.isAnalyzing?(k(),B("div",mo,[n(r(xt),{class:"h-8 w-8 text-muted-foreground mx-auto mb-2"}),p[8]||(p[8]=a("p",{class:"text-sm text-muted-foreground"},'Click "Analyze" to get AI-powered quality insights',-1))])):oe("",!0)]),_:1})]),_:1})):oe("",!0)}});function wo(L){const{delay:C=1e4,onSave:q}=L,N=i(!1),f=i(!1),p=i(null),x=()=>{N.value=!0,p.value&&clearTimeout(p.value),p.value=setTimeout(()=>{g(!0)},C)},g=async(P=!1)=>{if(!f.value){f.value=!0;try{await q(P),N.value=!1,p.value&&(clearTimeout(p.value),p.value=null)}finally{f.value=!1}}};return{hasUnsavedChanges:N,isSaving:f,triggerAutoSave:x,save:g,clearAutoSave:()=>{p.value&&(clearTimeout(p.value),p.value=null)}}}function bo(L){const C=i({sentences:0,paragraphs:0,readingTime:0,avgWordLength:0,uniqueWords:0,commonWords:[]}),q=M(()=>L.value?L.value.split(/\s+/).filter(p=>p.length>0).length:0),N=()=>{if(!L.value){C.value={sentences:0,paragraphs:0,readingTime:0,avgWordLength:0,uniqueWords:0,commonWords:[]};return}const p=L.value,x=p.split(/\s+/).filter(F=>F.length>0),g=p.split(/[.!?]+/).filter(F=>F.trim().length>0),s=p.split(`

`).filter(F=>F.trim().length>0),P=new Map;x.forEach(F=>{const v=F.toLowerCase().replace(/[^a-z0-9]/g,"");v&&P.set(v,(P.get(v)||0)+1)});const G=new Set(["the","a","an","and","or","but","in","on","at","to","for","of","with","by","is","was","are","were"]),h=Array.from(P.entries()).filter(([F])=>!G.has(F)).sort((F,v)=>v[1]-F[1]).slice(0,5).map(([F])=>F);C.value={sentences:g.length,paragraphs:s.length,readingTime:Math.ceil(x.length/200),avgWordLength:x.reduce((F,v)=>F+v.length,0)/x.length,uniqueWords:P.size,commonWords:h}},f=M(()=>{if(!L.value)return 0;let p=0;const x=L.value;x.includes("##")&&(p+=20),x.length>1e3&&(p+=20),x.match(/\[.*?\]/g)&&(p+=15),(x.includes("**")||x.includes("*"))&&(p+=10);const g=x.split(/[.!?]+/).filter(P=>P.trim().length>0);if(g.length>0){const P=g.reduce((G,h)=>G+h.split(/\s+/).length,0)/g.length;P>10&&P<25&&(p+=20)}return x.split(`

`).filter(P=>P.trim().length>0).length>3&&(p+=15),Math.min(p,100)});return{writingStats:C,currentWordCount:q,writingQualityScore:f,calculateWritingStats:N}}function xo(L,C=i(3e3),q=.8){const N=c=>{if(!c)return 0;const _=c.replace(/<[^>]*>/g,"").trim().replace(/\s+/g," ");if(!_)return 0;const V=_.match(/\b\w+\b/g);return V?V.length:0},f=c=>c?c.replace(/<[^>]*>/g,"").replace(/\r\n|\r/g,`
`).trim().split(/\n\s*\n/).filter(E=>E.trim().length>0).length:0,p=c=>{if(!c)return 0;const _=c.replace(/<[^>]*>/g,"").match(/[.!?]+/g);return _?_.length:0},x=c=>Math.round(c/200*10)/10,g=M(()=>N(L.value)),s=M(()=>L.value.length),P=M(()=>L.value.replace(/\s/g,"").length),G=M(()=>f(L.value)),h=M(()=>p(L.value)),F=M(()=>x(g.value)),v=M(()=>{const c=C.value;return!c||c<=0?0:Math.min(g.value/c*100,100)}),O=M(()=>g.value>=C.value*q),I=M(()=>{const c=C.value-g.value;return Math.max(c,0)}),J=M(()=>{const c=C.value*q-g.value;return Math.max(c,0)}),Z=M(()=>({wordCount:g.value,characterCount:s.value,characterCountNoSpaces:P.value,paragraphCount:G.value,sentenceCount:h.value,readingTimeMinutes:F.value})),ge=M(()=>({current:g.value,target:C.value,percentage:v.value,isComplete:O.value,completionThreshold:q})),ue=c=>c>=1e3?`${Math.round(c/100)/10}k`:c.toString(),xe=(c=0)=>`${Math.round(v.value*Math.pow(10,c))/Math.pow(10,c)}%`,ve=()=>`${g.value} / ${C.value} words (${xe()}%)`,W=()=>{if(O.value)return`âœ… Complete (${ue(g.value)} words)`;const c=J.value;return`${ue(c)} more words to complete`},y=()=>{const c=g.value,b=C.value;return c===0?"empty":c<b*.25?"started":c<b*.75?"progressing":c<b*q?"near_complete":c<b?"complete":"exceeded"},te=()=>{const c=y();return{empty:"text-gray-500",started:"text-blue-500",progressing:"text-yellow-500",near_complete:"text-orange-500",complete:"text-green-500",exceeded:"text-emerald-600"}[c]},re=()=>{const c=y();return{empty:"bg-gray-200",started:"bg-blue-200",progressing:"bg-yellow-200",near_complete:"bg-orange-200",complete:"bg-green-200",exceeded:"bg-emerald-200"}[c]},le=800,Ae=M(()=>g.value>=le),$e=M(()=>Math.max(le-g.value,0)),j=M(()=>Math.min(g.value/le*100,100));return{currentWordCount:g,characterCount:s,characterCountNoSpaces:P,paragraphCount:G,sentenceCount:h,readingTimeMinutes:F,progressPercentage:v,isComplete:O,wordsRemaining:I,wordsToComplete:J,wordCountStats:Z,wordCountProgress:ge,meetsDefenseThreshold:Ae,defenseWordsRemaining:$e,defenseProgressPercentage:j,DEFENSE_THRESHOLD:le,formatWordCount:ue,formatProgress:xe,getProgressDisplay:ve,getCompletionDisplay:W,getWordCountStatus:y,getStatusColor:te,getProgressBarColor:re,countWords:N}}function yo(L,C,q,N){const p=i(!1),x=i(0),g=i(!1),s=y=>{if(!y)return 0;const re=y.replace(/<[^>]*>/g,"").trim().replace(/\s+/g," ");if(!re)return 0;const le=re.match(/\b\w+\b/g);return le?le.length:0},P=M(()=>s(q.value)),G=M(()=>P.value>=800),h=()=>`defense_generation_triggered_${L.id}_ch_${C.chapter_number}`,F=()=>{const y=h();return localStorage.getItem(y)==="true"},v=()=>{const y=h();localStorage.setItem(y,"true"),p.value=!0},O=()=>{const y=h();localStorage.removeItem(y),p.value=!1,console.log(`ðŸ”„ DEFENSE WATCHER: Reset generation trigger for Chapter ${C.chapter_number}`)},I=Ja(async()=>{if(!g.value)return;const y=P.value;console.log(`ðŸ“Š DEFENSE WATCHER: Word count check - Chapter ${C.chapter_number}: ${y} words`),y<800*.8&&p.value&&(console.log("â¬‡ï¸ DEFENSE WATCHER: Content dropped below 80% of threshold, resetting trigger"),O()),x.value=y},2e3),J=()=>g.value?void 0:(g.value=!0,p.value=F(),x.value=P.value,console.log(`ðŸ‘€ DEFENSE WATCHER: Started watching Chapter ${C.chapter_number}`),console.log(`   Initial word count: ${x.value}`),console.log(`   Generation already triggered: ${p.value}`),console.log("   Threshold: 800 words"),Te(q,(te,re)=>{te!==re&&I()},{immediate:!1})),Z=()=>{g.value=!1,I.cancel(),console.log(`ðŸ›‘ DEFENSE WATCHER: Stopped watching Chapter ${C.chapter_number}`)},ge=async()=>{console.log(`ðŸ” DEFENSE WATCHER: Force checking Chapter ${C.chapter_number}`),await I(),I.flush()},ue=M(()=>{const y=P.value;return y>0&&y<800&&!p.value}),xe=M(()=>{const y=P.value/800*100;return Math.min(y,100)}),ve=M(()=>{const y=800-P.value;return Math.max(y,0)});return{isWatching:g,hasTriggeredGeneration:p,currentWordCount:P,lastWordCount:x,meetsThreshold:G,shouldShowProgressIndicator:ue,progressPercentage:xe,wordsRemaining:ve,startWatching:J,stopWatching:Z,forceCheck:ge,resetGenerationTrigger:O,markGenerationTriggered:v,getStatusMessage:()=>{const y=P.value;return p.value?`Defense questions available (${y} words)`:y>=800?`Ready for defense questions (${y} words)`:y>0?`${800-y} more words needed for defense questions`:"Start writing to enable defense questions (800 words needed)"},countWords:s,DEFENSE_WORD_COUNT_THRESHOLD:800}}function _o(L){const C=i(!1),q=i(null),N=i([]),f=i(null),p=M(()=>{if(!q.value?.quality_level)return"text-muted-foreground";switch(q.value.quality_level){case"Excellent":return"text-green-600";case"Good":return"text-blue-600";case"Satisfactory":return"text-yellow-600";case"Needs Improvement":return"text-orange-600";case"Poor":return"text-red-600";default:return"text-muted-foreground"}}),x=M(()=>q.value?.scores?Object.entries(q.value.scores).sort(([,v],[,O])=>v.percentage-O.percentage).slice(0,3).map(([v,O])=>({category:v.replace(" & "," & "),percentage:Math.round(O.percentage),score:O.score,max:O.max})):[]),g=async()=>{try{C.value=!0,f.value=null,await fe.get("/sanctum/csrf-cookie");const v=await fe.post(Q("api.chapters.analysis.analyze",{chapter:L}));if(v.data.success)return q.value=v.data.analysis,v.data.analysis;throw new Error(v.data.error||"Analysis failed")}catch(v){return f.value=v.response?.data?.error||v.message||"Analysis failed",console.error("Chapter analysis failed:",v),null}finally{C.value=!1}};return{isAnalyzing:C,latestAnalysis:q,analysisHistory:N,error:f,qualityLevelColor:p,topImprovementAreas:x,analyzeChapter:g,getLatestAnalysis:async()=>{try{await fe.get("/sanctum/csrf-cookie");const v=await fe.get(Q("api.chapters.analysis.latest",{chapter:L}));return v.data.success?(q.value=v.data.analysis,v.data.analysis):(q.value=null,null)}catch(v){return v.response?.status!==404&&(f.value=v.response?.data?.error||v.message||"Failed to get analysis",console.error("Failed to get latest analysis:",v)),null}},getAnalysisHistory:async()=>{try{await fe.get("/sanctum/csrf-cookie");const v=await fe.get(Q("api.chapters.analysis.history",{chapter:L}));if(v.data.success)return N.value=v.data.analyses,v.data.analyses;throw new Error(v.data.error||"Failed to get history")}catch(v){return f.value=v.response?.data?.error||v.message||"Failed to get analysis history",console.error("Failed to get analysis history:",v),[]}},autoAnalyze:async(v,O=500)=>{v>=O&&await g()},getScoreColor:(v,O)=>{const I=v/O*100;return I>=80?"text-green-600":I>=70?"text-blue-600":I>=60?"text-yellow-600":I>=40?"text-orange-600":"text-red-600"},getProgressVariant:v=>v>=80?"success":v>=60?"default":"destructive"}}const Co={key:2,class:"flex h-screen flex-col overflow-hidden bg-zinc-50 dark:bg-zinc-950 font-sans selection:bg-primary/20"},ko={class:"relative z-20 flex flex-shrink-0 items-center justify-between border-b border-border/40 bg-background/60 p-4 backdrop-blur-xl supports-[backdrop-filter]:bg-background/40 transition-all duration-300"},Eo={class:"flex items-center gap-5"},So={class:"flex flex-col"},To={class:"flex items-center gap-3 text-xs text-muted-foreground"},Ao={class:"flex items-center gap-1.5"},$o={class:"flex items-center gap-4"},Ro={class:"flex items-center p-1 rounded-full border border-border/40 bg-background/50 backdrop-blur-sm shadow-sm"},Po={class:"flex items-center gap-2"},Mo={class:"relative z-20 h-[2px] w-full bg-border/20"},qo={key:0,class:"mx-3 my-2"},jo={class:"relative overflow-hidden rounded-xl border border-blue-200 bg-gradient-to-br from-blue-50 to-purple-50 p-3 shadow-sm dark:border-blue-800 dark:from-blue-950/30 dark:to-purple-950/30"},Do={class:"relative z-10 mb-2 flex items-center justify-between"},Fo={class:"flex items-center gap-2"},Lo={class:"relative"},Oo={class:"flex h-6 w-6 items-center justify-center rounded-full bg-gradient-to-br from-blue-500 to-purple-600"},No={class:"text-xs text-blue-700 dark:text-blue-300"},Wo={class:"relative z-10 mb-2"},Io={class:"mb-1 flex items-center justify-between"},zo={class:"text-xs text-blue-600 dark:text-blue-400"},Go={class:"relative h-2 overflow-hidden rounded-full bg-blue-100 dark:bg-blue-900/50"},Ho={class:"relative z-10 flex items-center gap-2"},Uo={class:"flex-shrink-0"},Ko={key:0,class:"h-2 w-2 animate-bounce rounded-full bg-blue-500"},Vo={key:1,class:"flex gap-0.5"},Bo={key:2,class:"h-2 w-2 animate-spin rounded-full border-2 border-blue-500 border-t-transparent"},Qo={key:3,class:"h-2 w-2 rounded-full bg-green-500"},Jo={key:4,class:"h-2 w-2 rounded-full bg-red-500"},Xo={class:"flex-1 text-xs text-blue-800 dark:text-blue-200"},Yo={class:"relative z-10 flex flex-1 overflow-hidden"},Zo={key:0,class:"w-[320px] flex-shrink-0 border-r border-border/50 bg-background/80 backdrop-blur-xl shadow-xl z-20"},en={class:"h-full overflow-y-auto custom-scrollbar"},tn={class:"p-4"},rn={class:"mb-3"},an={class:"text-xs text-muted-foreground"},on={class:"flex min-h-0 flex-1 flex-col bg-transparent relative"},nn={class:"flex-1 overflow-hidden relative"},sn={class:"absolute inset-0 overflow-y-auto custom-scrollbar flex flex-col items-center py-8 px-4 sm:px-8"},ln={class:"flex items-center justify-between"},cn={class:"space-y-1"},un={class:"flex items-center gap-2"},dn={class:"flex items-center justify-between px-6 py-2 border-b border-border/30 bg-muted/5"},pn={class:"flex items-center gap-2"},gn={class:"space-y-1 relative z-10"},vn={class:"text-sm font-medium text-foreground"},hn={class:"text-[10px] text-muted-foreground line-clamp-2 leading-relaxed"},fn={class:"flex-1 relative bg-background"},mn={class:"px-12 py-10 min-h-[500px]"},wn={class:"sticky bottom-0 z-10 border-t border-border/30 bg-background/80 backdrop-blur-md p-4 flex items-center justify-between"},bn={class:"text-xs text-muted-foreground"},xn={class:"flex items-center gap-2"},yn={key:0,class:"w-72 flex-shrink-0 border-l border-border/40 bg-background/40 backdrop-blur-md"},_n={class:"h-full overflow-y-auto custom-scrollbar"},Cn={class:"space-y-6 p-4"},kn={class:"flex h-full w-full overflow-hidden relative"},En={class:"hidden lg:flex w-80 flex-col border-r border-border/40 bg-background/60 backdrop-blur-xl z-20 transition-all duration-300"},Sn={class:"h-14 flex items-center justify-between px-4 border-b border-border/40 shrink-0"},Tn={class:"p-4"},An={class:"flex-1 flex flex-col relative z-10 min-w-0 bg-background/30 transition-all duration-300"},$n={class:"min-h-[5.5rem] flex flex-shrink-0 items-center justify-between border-b border-border/40 bg-background/60 backdrop-blur-md px-4 py-2 relative z-30 transition-all duration-300"},Rn={class:"flex items-center gap-4 flex-1"},Pn={class:"flex items-center gap-2 flex-shrink-0 h-full self-start mt-1"},Mn={class:"flex flex-col gap-1.5 flex-1 min-w-0"},qn={class:"flex items-start gap-3 w-full"},jn={class:"flex items-center gap-2 flex-wrap"},Dn={class:"flex items-center bg-background/50 rounded-md border border-border/50 p-0.5 mr-2 backdrop-blur-sm hidden sm:flex"},Fn={class:"flex items-center self-start mt-1 ml-2"},Ln={class:"flex-1 overflow-hidden relative group bg-background/20"},On={key:0,class:"absolute top-6 left-0 right-0 z-40 px-4 flex justify-center pointer-events-none"},Nn={class:"w-full max-w-lg pointer-events-auto"},Wn={class:"relative overflow-hidden rounded-xl border border-blue-200 bg-gradient-to-br from-blue-50/95 to-purple-50/95 p-3 shadow-lg backdrop-blur-lg dark:border-blue-800 dark:from-blue-950/90 dark:to-purple-950/90"},In={class:"flex items-center gap-3"},zn={class:"relative flex h-8 w-8 items-center justify-center rounded-full bg-gradient-to-br from-blue-500 to-purple-600 shadow-md"},Gn={class:"flex-1 min-w-0"},Hn={class:"flex items-center justify-between mb-1"},Un={class:"text-xs font-mono text-muted-foreground"},Kn={class:"h-1.5 w-full bg-blue-100 dark:bg-blue-900/40 rounded-full overflow-hidden"},Vn={class:"mt-2 text-xs text-muted-foreground ml-11 truncate"},Bn={class:"max-w-[850px] mx-auto py-12 px-6 sm:px-10 min-h-full"},Qn={class:"min-h-[600px] pb-32"},Jn={class:"pb-32"},Xn={class:"h-7 border-t border-border/30 bg-background/40 backdrop-blur-sm flex items-center justify-between px-4 text-[10px] text-muted-foreground shrink-0"},Yn={class:"flex items-center gap-3"},Zn={class:"hidden sm:inline"},es={class:"flex items-center gap-2"},ts={key:0,class:"text-green-500 flex items-center gap-1 ml-2"},rs={class:"hidden lg:flex w-96 flex-col border-l border-border/40 bg-background/60 backdrop-blur-xl z-20 transition-all duration-300"},as={class:"h-14 flex items-center justify-between px-4 border-b border-border/40 shrink-0"},os={class:"flex-1 overflow-y-auto custom-scrollbar"},ns={class:"p-4 space-y-6"},ss={key:0,class:"fixed inset-0 bg-black/50 flex items-center justify-center z-50"},ls={class:"text-slate-600 dark:text-slate-300 mb-4"},is={class:"font-semibold text-amber-600 dark:text-amber-400"},cs={class:"flex flex-col sm:flex-row gap-3"},bt=3,us=1e3,ds=Tr({__name:"ChapterEditor",props:{project:{},chapter:{},allChapters:{},facultyChapters:{},mode:{}},setup(L){const C=Fe(()=>Le(()=>import("./AISidebar-Css40JTa.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53]))),q=Fe(()=>Le(()=>import("./ChapterNavigation-CfFFsHnN.js"),__vite__mapDeps([54,55,3,1,2,20,7,8,21,22,14,56,18,13,15,16,42,57,58,59,60,36]))),N=Fe(()=>Le(()=>import("./MobileNavOverlay-DFSb1_TC.js"),__vite__mapDeps([61,1,2,62,3,0,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,55,56,57,58,59,60,63,64,65,66,67,68,69]))),f=Fe(()=>Le(()=>import("./ChatModeLayout-Yy2VGwgB.js"),__vite__mapDeps([70,71,1,2,18,3,8,4,11,7,12,20,21,23,24,25,26,27,28,29,30,31,32,33,34,35,36,14,37,38,19,39,40,41,42,43,44,72,73,74,75,65,76,9,10,13,15,16,45,77,78,62,79,47,80,81,57,82,50,66,60,49,52,58,83,84,85]))),p=Fe(()=>Le(()=>import("./CitationVerificationLayout-D_hXlDi9.js"),__vite__mapDeps([86,18,3,1,2,8,4,5,11,7,12,20,21,25,73,23,24,26,27,28,29,30,31,32,33,34,35,36,14,37,38,19,39,40,41,42,43,44,74,75,65,76,9,10,13,15,16,45,77,78,79,58]))),x=Fe(()=>Le(()=>import("./DefensePreparationPanel-DN8dywKO.js"),__vite__mapDeps([87,63,1,2,62,3,18,8,4,5,6,7,11,12,20,21,9,10,64,65,45,66,67,46,51,35,14,32]))),g=Fe(()=>Le(()=>import("./DataCollectionPanel-D5pzz7B0.js"),__vite__mapDeps([88,68,1,2,13,3,14,8,7,15,16]))),s=L,P=Ca();Te(()=>P.props?.flash,t=>{t&&(t.success&&w.success(t.success),t.error&&w.error(t.error))},{deep:!0,immediate:!0});const G=i(s.chapter.title||""),h=i(s.chapter.content||""),F=i(!0),v=i(!1),O=i(!1);i(!1);const I=i(!1);i("write");const J=i("");i(0);const Z=i(!1),ge=i(!1),ue=i(!0),xe=()=>{try{return localStorage.getItem(`chatMode_${s.project.id}_${s.chapter.chapter_number}`)==="true"}catch(t){return console.warn("Failed to load chat mode from localStorage:",t),!1}},ve=t=>{try{localStorage.setItem(`chatMode_${s.project.id}_${s.chapter.chapter_number}`,String(t))}catch(e){console.warn("Failed to save chat mode to localStorage:",e)}},W=i(!1),y=i(!1),te=i(!1),re=i(!1),le=i(!1),Ae=i(!0),$e=i(!0),j=i(!1),c=i(""),b=i(0),_=i(""),V=i(0),E=i(0),S=i(null),D=i(""),Ne=i(0),yt=i(""),Ot=i([]),Ye=i(!1),Re=i(!1),ie=i(0),_t=i(2e3),We=i(!1),lt=i(null);i("progressive");const Ie=i(!1),it=i(!1),ct=i(0);i(!1),i(0);const $r=async()=>{if(!navigator.onLine)return w.error("No Internet Connection",{description:"Please check your internet connection and try again."}),!1;const t=navigator.connection||navigator.mozConnection||navigator.webkitConnection;if(t){const e=t.effectiveType;(e==="slow-2g"||e==="2g")&&w.warning("Slow Connection Detected",{description:"Your connection is slow. Content will be auto-saved during generation.",duration:4e3})}try{const e=new AbortController,u=setTimeout(()=>e.abort(),5e3),o=performance.now();await fetch(Q("api.ping"),{method:"HEAD",cache:"no-cache",signal:e.signal}),clearTimeout(u);const d=performance.now()-o;console.log("ðŸ“¡ Server latency:",d.toFixed(0),"ms"),d>2e3&&w.info("Connection is slow",{description:"Content will be auto-saved during generation to prevent data loss.",duration:3e3})}catch(e){console.warn("Connection check ping failed:",e),w.info("Connection check skipped",{description:"Content will be auto-saved during generation.",duration:2e3})}return!0},{balance:Rr,showPurchaseModal:Nt,requiredWordsForModal:Pr,actionDescriptionForModal:Mr,checkAndPrompt:qr,closePurchaseModal:jr,estimates:ye}=Aa(),ze=(t,e)=>qr(Math.max(1,Math.round(t)),e),Ze=i(!1),Ge=i(""),He=i(""),Dr=i(0),Pe=i(null),Fr=i(0),Lr=i(null),Or=i([]),Nr=i([]),Wr=i(null);i(null),i(null);const Wt=i(),Ir=i(),zr=i(),Gr=i();i(null),i(null);const X=i(!1),{hasUnsavedChanges:Hr,isSaving:_e,triggerAutoSave:Me,save:me,clearAutoSave:Ur}=wo({delay:1e4,onSave:Ht});let It=0;const Kr=()=>{const t=Date.now();t-It>us&&(It=t,w.success("Saved",{duration:2e3}))},{contentHistory:Vr,historyIndex:Br,addToHistory:Qr,undo:Jr,redo:Xr}=Da(s.chapter.content||""),{writingStats:Ct,writingQualityScore:Ce,calculateWritingStats:ut}=bo(h),{isAnalyzing:zt,latestAnalysis:he,getLatestAnalysis:Yr}=_o(s.chapter.id),ce=M(()=>{if(s.facultyChapters&&s.facultyChapters.length>0){const e=s.facultyChapters.find(u=>u.number===s.chapter.chapter_number);if(e?.word_count)return e.word_count}if(s.project?.outlines&&s.project.outlines.length>0){const e=s.project.outlines.find(u=>u.chapter_number===s.chapter.chapter_number);if(e?.target_word_count)return e.target_word_count}const t=s.project.type==="undergraduate"?2500:3500;return s.chapter.chapter_number===1||s.chapter.chapter_number===5?Math.round(t*.8):t}),{currentWordCount:Y,progressPercentage:Zr,meetsDefenseThreshold:ea,defenseWordsRemaining:ta,defenseProgressPercentage:ra,DEFENSE_THRESHOLD:dt,countWords:Gt}=xo(h,ce),kt=Zr,pt=M(()=>{const t=G.value?.trim(),e=h.value?.trim();return t&&t.length>0&&e&&e.length>50}),we=M(()=>s.project),be=M(()=>s.chapter),qe=M(()=>s.allChapters);async function Ht(t=!1){try{const e=await fetch(Q("chapters.save",{project:s.project.id}),{method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json","X-Requested-With":"XMLHttpRequest","X-CSRF-TOKEN":document.querySelector('meta[name="csrf-token"]')?.getAttribute("content")||""},body:JSON.stringify({project_id:s.project.id,chapter_number:s.chapter.chapter_number,title:G.value,content:h.value,auto_save:t,statistics:Ct.value,quality_score:Ce.value})});console.log("Response status:",e.status,e.statusText),console.log("Response headers:",e.headers);const u=await e.text();console.log("Raw response:",u);let o;try{o=JSON.parse(u)}catch(d){throw console.error("JSON parse error:",d),console.error("Response was:",u),new Error(`Server returned non-JSON response: ${e.status} ${e.statusText}`)}e.ok}catch(e){throw t||w.error("âŒ Save Failed",{description:"Please try again or check your connection."}),e}}const Ut=()=>{const t=Jr();t!==null&&(h.value=t,Me())},Kt=()=>{const t=Xr();t!==null&&(h.value=t,Me())},et=t=>{Hr.value&&confirm("You have unsaved changes. Save before switching chapters?")&&me();const e=s.allChapters.find(d=>d.chapter_number===t),o=e?.content&&e.content.trim()!==""?"chapters.edit":"chapters.write";Be.visit(Q(o,{project:s.project.slug,chapter:t}),{only:["chapter","mode","allChapters"],preserveState:!0,preserveScroll:!1})},Et=async()=>{const t=ye.chapter(ce.value||0);if(!ze(t,"generate the next chapter with AI"))return;await me();const e=s.allChapters.map(d=>d.chapter_number).sort((d,m)=>d-m),u=e.indexOf(s.chapter.chapter_number);let o;if(u===-1||u===e.length-1)o=Math.max(...e)+1;else{const d=e[u+1];d===s.chapter.chapter_number+1?o=d:o=s.chapter.chapter_number+1}console.log("ðŸ“ Generating next chapter:",{currentChapter:s.chapter.chapter_number,existingChapters:e,nextChapterNumber:o});try{const d=Q("chapters.write",{project:s.project.slug,chapter:o});console.log("ðŸ”— Generated URL for next chapter:",d);const m=new URL(d,window.location.origin);m.searchParams.set("ai_generate","true"),m.searchParams.set("generation_type","progressive"),console.log("ðŸš€ Navigating to:",m.toString()),Be.visit(m.toString())}catch(d){console.error("âŒ Error generating next chapter:",d),w.error("Navigation Error",{description:"Failed to navigate to next chapter. Please try again."})}},St=(t,e)=>{t==="section"&&e?.section?aa(e.section):t==="rephrase"&&e?.selectedText?oa(e.selectedText,e.style||"Academic Formal"):t==="expand"&&e?.selectedText?na(e.selectedText):Tt(t)},aa=async t=>{j.value=!0,D.value="",E.value=0,b.value=5,_.value="Papers",c.value="Checking for verified sources...",V.value=600,yt.value=h.value||s.chapter.content||"",X.value=!0;try{b.value=50,_.value="Papers",c.value="Using existing verified sources...",await new Promise(u=>setTimeout(u,500)),_.value="Section",c.value=`Generating ${t} section with verified sources...`,b.value=51;const e=Q("chapters.stream",{project:s.project.slug,chapter:s.chapter.chapter_number});S.value=new EventSource(`${e}?generation_type=section&section_type=${t}`),S.value.onmessage=u=>{const o=JSON.parse(u.data);switch(o.type){case"start":_.value="Generating Section",b.value=52,c.value=`Starting ${t} section generation...`;break;case"content":D.value+=o.content,E.value=o.word_count||Gt(D.value);const d=Date.now();if(d-Ne.value>150){const $=D.value;h.value=yt.value+`

`+$,Ne.value=d;const T=Math.min(E.value/V.value*43,43);b.value=Math.max(52,52+T),c.value=`Generating ${t} section... (${E.value} / ${V.value} words)`,ut(),Rt()}break;case"complete":b.value=100,_.value="Complete",c.value=`âœ“ Generated ${t} section (${E.value} words)`;const m=D.value;h.value=yt.value+`

`+m,me(!0),w.success("âœ… Section Generated Successfully",{description:`Added ${t} section with ${E.value} words and verified citations.`,duration:5e3}),j.value=!1,S.value?.close();break;case"error":throw new Error(o.message||"Section generation failed");case"heartbeat":b.value<95&&(b.value+=.5);break}},S.value.onerror=()=>{j.value=!1,_.value="Error",c.value="âŒ Section generation failed",w.error("âŒ Generation Failed",{description:"Unable to generate section. Please check your connection and try again."}),S.value?.close()}}catch(e){console.error("Section generation failed:",e),j.value=!1,_.value="Error",c.value="âŒ Section generation error",w.error("âŒ Generation Failed",{description:"Section generation encountered an error."})}},oa=async(t,e)=>{const u=t.split(/\s+/).length,o=Math.max(u,ye.rephrase());if(!ze(o,`rephrase about ${u} words`))return;console.log("ðŸš€ ChapterEditor - Starting rephrase generation:",{selectedTextLength:t.length,selectedTextPreview:t.substring(0,100)+(t.length>100?"...":""),style:e,timestamp:new Date().toISOString()}),j.value=!0,D.value="",E.value=0,b.value=10,_.value="Rephrasing",c.value="Preparing to rephrase selected text...",V.value=Math.max(u,50);const d=gt.value||tt.value,m=d?.getSelectionRange();console.log("ðŸ“ ChapterEditor - Editor and selection info:",{hasActiveEditor:!!d,selectionRange:m,selectedWordCount:u,estimatedWords:V.value});const $={originalText:t,range:m,wordCount:u,style:e,startTime:Date.now()};console.log("ðŸ’¾ ChapterEditor - Stored rephrase context:",$),X.value=!0;try{b.value=20,c.value=`Rephrasing ${u} words in ${e} style...`;const ee=`${Q("chapters.stream",{project:s.project.slug,chapter:s.chapter.chapter_number})}?generation_type=rephrase&selected_text=${encodeURIComponent(t)}&style=${encodeURIComponent(e)}`;console.log("ðŸŒ ChapterEditor - Creating EventSource:",{url:ee,encodedTextLength:encodeURIComponent(t).length}),S.value=new EventSource(ee),S.value.onmessage=U=>{const z=JSON.parse(U.data);switch(console.log("ðŸ“¨ ChapterEditor - EventSource message received:",{type:z.type,hasContent:!!z.content,contentLength:z.content?.length||0,wordCount:z.word_count}),z.type){case"start":console.log("â–¶ï¸ ChapterEditor - Rephrase generation started"),_.value="Rephrasing Text",b.value=30,c.value=`Rephrasing text in ${e} style...`;break;case"content":D.value+=z.content,E.value=z.word_count||Gt(D.value),console.log("ðŸ“ ChapterEditor - Content chunk received:",{chunkLength:z.content?.length||0,totalBufferLength:D.value.length,totalWords:E.value});const se=Math.min(E.value/V.value*60,60);b.value=Math.max(30,30+se),c.value=`Rephrasing... (${E.value} words)`;break;case"complete":if(console.log("ðŸ ChapterEditor - Rephrase generation complete"),b.value=100,_.value="Complete",c.value=`âœ“ Text rephrased successfully (${E.value} words)`,console.log("ðŸ”„ ChapterEditor - Starting text replacement:",{hasRange:!!$.range,hasContent:!!D.value.trim(),range:$.range,newContentLength:D.value.trim().length,newContentPreview:D.value.trim().substring(0,100)+"..."}),$.range&&D.value.trim()){console.log("ðŸŽ¯ ChapterEditor - Attempting text replacement with activeEditor:",{editorType:d===gt.value?"fullscreen":"normal",hasActiveEditor:!!d});const de=d?.replaceSelection(D.value.trim(),$.range);console.log("ðŸ“Š ChapterEditor - Text replacement result:",{success:de}),de?(console.log("âœ… ChapterEditor - Text replacement successful, updating chapter content"),setTimeout(()=>{const De=d?.getHTML()||h.value;console.log("ðŸ“„ ChapterEditor - Updated chapter content length:",De.length),h.value=De},100)):(console.warn("âŒ ChapterEditor - Failed to replace selected text, falling back to manual update"),w.warning("Please manually replace the selected text",{description:"The rephrased text is ready but couldn't be automatically replaced."}))}else console.error("âŒ ChapterEditor - Cannot replace text:",{missingRange:!$.range,missingContent:!D.value.trim()});me(!0),w.success("âœ… Text Rephrased Successfully",{description:`Rephrased ${u} words in ${e} style.`,duration:5e3}),Xe(E.value||u,`Rephrase (${e})`,"chapter",s.chapter.id).catch(de=>console.error("Failed to record word usage (rephrase):",de)),j.value=!1,S.value?.close();break;case"error":throw new Error(z.message||"Text rephrasing failed");case"heartbeat":b.value<95&&(b.value+=.5);break}},S.value.onerror=()=>{j.value=!1,_.value="Error",c.value="âŒ Text rephrasing failed",w.error("âŒ Rephrasing Failed",{description:"Unable to rephrase text. Please check your connection and try again."}),S.value?.close()}}catch(T){console.error("Text rephrasing failed:",T),j.value=!1,_.value="Error",c.value="âŒ Rephrasing error",w.error("âŒ Rephrasing Failed",{description:"Text rephrasing encountered an error."})}},na=async t=>{const e=t.split(/\s+/).length,u=Math.max(e*2,ye.expand());if(!ze(u,`expand about ${e} words`))return;console.log("ðŸ“ˆ ChapterEditor - Starting expand generation:",{selectedTextLength:t.length,selectedTextPreview:t.substring(0,100)+(t.length>100?"...":""),timestamp:new Date().toISOString()}),j.value=!0,D.value="",E.value=0,b.value=10,_.value="Expanding",c.value="Preparing to expand selected text...",V.value=Math.max(e*2,100);const o=gt.value||tt.value,d=o?.getSelectionRange();console.log("ðŸ“ ChapterEditor - Editor and selection info for expand:",{hasActiveEditor:!!o,selectionRange:d,selectedWordCount:e,estimatedWords:V.value});const m={originalText:t,range:d,wordCount:e,startTime:Date.now()};console.log("ðŸ’¾ ChapterEditor - Stored expand context:",m);try{const T=`${Q("chapters.stream",{project:s.project.slug,chapter:s.chapter.chapter_number})}?generation_type=expand&selected_text=${encodeURIComponent(t)}`;console.log("ðŸŒ ChapterEditor - Creating EventSource for expand:",{url:T,encodedTextLength:encodeURIComponent(t).length}),S.value=new EventSource(T),S.value.onmessage=ee=>{const U=JSON.parse(ee.data);switch(console.log("ðŸ“¨ ChapterEditor - EventSource message received:",{type:U.type,hasContent:!!U.content,contentLength:U.content?.length||0,wordCount:U.word_count}),U.type){case"start":console.log("â–¶ï¸ ChapterEditor - Expand generation started"),_.value="Expanding Text",b.value=20,c.value="Starting text expansion...";break;case"content":D.value+=U.content,E.value=U.word_count||D.value.split(/\s+/).filter(se=>se.length>0).length;const z=Math.min(E.value/V.value*90,90);b.value=Math.max(z,25),c.value=`Expanding text... ${E.value}/${V.value} words`,console.log("ðŸ“ ChapterEditor - Expand content received:",{chunkLength:U.content?.length||0,totalWords:E.value,progress:b.value});break;case"complete":if(console.log("âœ… ChapterEditor - Expand generation complete"),_.value="Complete",c.value="âœ… Text expansion completed",b.value=100,m.range&&D.value.trim()){console.log("ðŸŽ¯ ChapterEditor - Attempting text replacement for expand");const se=o?.replaceSelection(D.value.trim(),m.range);console.log("ðŸ“Š ChapterEditor - Expand text replacement result:",{success:se}),se?(console.log("âœ… ChapterEditor - Expand text replacement successful"),setTimeout(()=>{const de=o?.getHTML()||h.value;console.log("ðŸ“„ ChapterEditor - Updated chapter content length after expand:",de.length),h.value=de},100)):(console.warn("âŒ ChapterEditor - Failed to replace expanded text"),w.warning("Please manually replace the selected text",{description:"The expanded text is ready but couldn't be automatically replaced."}))}else console.error("âŒ ChapterEditor - Cannot replace expanded text:",{missingRange:!m.range,missingContent:!D.value.trim()});me(!0),w.success("âœ… Text Expanded Successfully",{description:`Expanded ${m.wordCount} words into ${E.value} words`}),Xe(E.value||m.wordCount*2,"Expand text","chapter",s.chapter.id).catch(se=>console.error("Failed to record word usage (expand):",se)),j.value=!1,S.value?.close();break;case"error":console.error("âŒ ChapterEditor - Expand generation error:",U.message),j.value=!1,_.value="Error",c.value="âŒ Text expansion failed",w.error("âŒ Expansion Failed",{description:U.message||"Text expansion encountered an error."}),S.value?.close();break}},S.value.onerror=()=>{console.error("âŒ ChapterEditor - Expand stream error occurred"),j.value=!1,_.value="Error",c.value="âŒ Text expansion failed",w.error("âŒ Expansion Failed",{description:"Unable to expand text. Please check your connection and try again."}),S.value?.close()}}catch($){console.error("Text expansion failed:",$),j.value=!1,_.value="Error",c.value="âŒ Expansion error",w.error("âŒ Expansion Failed",{description:"Text expansion encountered an error."})}},sa=async()=>{Ze.value=!0,He.value="Starting",Ge.value="Initializing source collection...",b.value=5;try{const t=document.querySelector('meta[name="csrf-token"]')?.content;if(!t)throw new Error("CSRF token not found - please refresh the page");const e=await fetch(Q("api.projects.paper-collection.start",{project:s.project.slug}),{method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json","X-CSRF-TOKEN":t,"X-Requested-With":"XMLHttpRequest"},credentials:"include"});if(!e.ok){const u=await e.text();if(console.error("API Error:",e.status,u),e.status===409)try{const o=JSON.parse(u);throw new Error(o.message||"Source collection is already in progress")}catch{throw new Error("Source collection is already in progress for this project")}throw new Error(`Failed to start source collection: ${e.status}`)}return await la()}catch(t){return console.error("Paper collection failed:",t),He.value="Error",Ge.value="âŒ Source collection failed",Ze.value=!1,!1}},la=async()=>new Promise(t=>{let e=0;const u=120,o=async()=>{try{const m=await(await fetch(Q("api.projects.paper-collection.status",{project:s.project.slug}))).json();if(m.success&&m.data){Wr.value=m.data;const $=m.data.status,T=m.data.papers_count||m.data.count||0,ee=m.data.message,U=m.data.percentage||0,z=m.data.current_source,se=m.data.sources_completed||[],de=m.data.papers_preview||[];if(Dr.value=T,Fr.value=U,Lr.value=z,Or.value=se,Nr.value=de,$==="completed"){He.value="Complete",Ge.value=`âœ“ Collected ${T} verified sources from ${se.length} databases`,b.value=50,Ze.value=!1,Pe.value&&clearInterval(Pe.value),t(!0);return}else if($==="collecting_papers"||$==="initializing"||$==="processing"||$==="storing"){let De="";z&&(De={semantic_scholar:"Semantic Scholar",openalex:"OpenAlex",crossref:"CrossRef",pubmed:"PubMed"}[z]||z),He.value=De||"Collecting Sources",Ge.value=ee||"Collecting sources from academic databases...",b.value=Math.min(5+U*.4,45)}else if($==="collection_failed"){He.value="Error",Ge.value=ee||"âŒ Source collection failed",Ze.value=!1,Pe.value&&clearInterval(Pe.value),t(!1);return}}e++,e>=u&&(He.value="Timeout",Ge.value="â±ï¸ Source collection timed out",Ze.value=!1,Pe.value&&clearInterval(Pe.value),t(!1))}catch(d){console.error("Error checking paper collection status:",d),e++}};o(),Pe.value=setInterval(o,5e3)}),Tt=async t=>{const e=ye.chapter(ce.value||0);if(!ze(e,"generate this chapter with AI")||!await $r())return;if(j.value=!0,D.value="",E.value=0,b.value=5,_.value="Papers",c.value="Checking for verified sources...",V.value=ce.value,X.value=!0,!await sa()){w.error("Paper Collection Failed",{description:"Unable to collect verified papers. Please try again."}),j.value=!1,X.value=!1;return}_.value="Initializing",c.value="Starting AI generation with verified sources...",b.value=51;const d=setInterval(()=>{b.value<52&&j.value?b.value+=.2:clearInterval(d)},100),m=Q("chapters.stream",{project:s.project.slug,chapter:s.chapter.chapter_number});S.value=new EventSource(`${m}?generation_type=${t}`),S.value.onmessage=$=>{const T=JSON.parse($.data);switch(T.type){case"start":_.value="Connecting",b.value=52,c.value="Connecting to AI service...";break;case"content":_.value="Generating",D.value+=T.content,E.value=T.word_count||D.value.split(/\s+/).filter(z=>z.length>0).length;const ee=Date.now();if(ee-Ne.value>200){h.value=D.value,Ne.value=ee;const z=Math.min(E.value/V.value*43,43);b.value=Math.max(52,52+z),c.value=`Generating chapter content... (${E.value} / ${V.value} words)`,Rt()}break;case"heartbeat":b.value<95&&(b.value+=.5);break;case"complete":_.value="Complete",b.value=100,j.value=!1,h.value=D.value;const U=T.final_word_count||E.value;c.value=`âœ“ Generated ${U} words successfully`,ut(),Xe(U,`Chapter generation (${s.chapter.chapter_number})`,"chapter",s.chapter.id).catch(z=>console.error("Failed to record word usage (chapter generation):",z)),setTimeout(()=>{Me()},500),S.value?.close(),S.value=null;break;case"error":_.value="Error",b.value=50,T.partial_saved&&(it.value=!0,ct.value=T.saved_word_count||0),T.code==="OFFLINE_MODE"?(c.value="ðŸ“¡ AI services offline",j.value=!1,w.error("AI Services Offline",{description:"Please check your internet connection and try again."})):T.can_resume?(c.value=`âš ï¸ Generation interrupted (${T.saved_word_count} words saved)`,j.value=!1,Ie.value=!0,w.warning("Generation Interrupted",{description:`${T.saved_word_count} words were saved. You can resume generation.`,duration:8e3})):(c.value="âŒ Generation failed",j.value=!1,w.error("Generation Error",{description:T.message||"Please try again."})),S.value?.close(),S.value=null;break;case"autosave":T.word_count&&(console.log(`ðŸ’¾ Auto-saved: ${T.word_count} words`),T.generation_id&&(lt.value=T.generation_id));break}},S.value.onerror=()=>{if(ie.value<bt){ie.value++,We.value=!0,_.value="Reconnecting",c.value=`ðŸ”„ Connection lost. Reconnecting... (${ie.value}/${bt})`,S.value?.close(),S.value=null;const $=_t.value*Math.pow(2,ie.value-1);console.log(`ðŸ”Œ Attempting reconnection in ${$}ms (attempt ${ie.value})`),setTimeout(()=>{Vt(t)},$)}else _.value="Error",b.value=50,j.value=!1,We.value=!1,c.value="âŒ Connection failed after multiple attempts",E.value>100?(it.value=!0,ct.value=E.value,Ie.value=!0,w.warning("Connection Lost",{description:`${E.value} words may have been saved. Check and resume if needed.`,duration:8e3})):w.error("Connection Error",{description:"Please check your internet connection and try again."}),S.value?.close(),S.value=null,ie.value=0,_t.value=2e3}},Vt=t=>{const e=Q("chapters.stream",{project:s.project.slug,chapter:s.chapter.chapter_number}),u=new URLSearchParams({generation_type:t,resume_from:E.value.toString()});lt.value&&u.set("generation_id",lt.value),console.log(`ðŸ”Œ Reconnecting to stream from ${E.value} words...`),S.value=new EventSource(`${e}?${u}`),S.value.onmessage=o=>{const d=JSON.parse(o.data);switch((d.type==="content"||d.type==="start")&&(We.value=!1,ie.value=0,_.value="Generating"),d.type){case"start":c.value="âœ… Reconnected! Continuing generation...",w.success("Reconnected",{description:"Generation resumed successfully.",duration:3e3});break;case"content":_.value="Generating",D.value+=d.content,E.value=d.word_count||D.value.split(/\s+/).filter(T=>T.length>0).length;const m=Date.now();if(m-Ne.value>150){h.value=D.value,Ne.value=m;const T=Math.min(E.value/V.value*43,43);b.value=Math.max(52,52+T),c.value=`Generating chapter content... (${E.value} / ${V.value} words)`,Rt()}break;case"complete":_.value="Complete",b.value=100,j.value=!1,We.value=!1,h.value=D.value;const $=d.final_word_count||E.value;c.value=`âœ“ Generated ${$} words successfully`,Xe($,`Chapter generation (${s.chapter.chapter_number})`,"chapter",s.chapter.id).catch(T=>console.error("Failed to record word usage:",T)),setTimeout(()=>{Me()},500),S.value?.close(),S.value=null;break;case"error":_.value="Error",j.value=!1,We.value=!1,c.value="âŒ Generation failed",w.error("Generation Error",{description:d.message||"Please try again."}),S.value?.close(),S.value=null;break;case"autosave":d.generation_id&&(lt.value=d.generation_id);break}},S.value.onerror=()=>{if(ie.value<bt){ie.value++;const o=_t.value*Math.pow(2,ie.value-1);c.value=`ðŸ”„ Reconnecting... (${ie.value}/${bt})`,S.value?.close(),setTimeout(()=>{Vt(t)},o)}else _.value="Error",j.value=!1,We.value=!1,c.value="âŒ Connection failed",E.value>100?(Ie.value=!0,w.warning("Connection Lost",{description:`${E.value} words may be saved. Refresh to recover.`})):w.error("Connection Error",{description:"Please check your connection and try again."}),S.value?.close(),S.value=null,ie.value=0}},ia=()=>{Ie.value=!1,it.value=!1,window.location.reload()},ca=()=>{Ie.value=!1,it.value=!1,ct.value=0},At=async()=>{if(!J.value)return;const t=ye.suggestion();if(ze(t,"get AI suggestions")){Ye.value=!0;try{const u=await(await fetch(Q("chapters.suggestions",{project:s.project.slug,chapter:s.chapter.chapter_number}),{method:"POST",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":document.querySelector('meta[name="csrf-token"]')?.getAttribute("content")||""},body:JSON.stringify({selected_text:J.value,context:h.value})})).json();Ot.value=u.suggestions||[],Ot.value.length&&Xe(ye.suggestion(),"AI suggestions","chapter",s.chapter.id).catch(o=>console.error("Failed to record word usage (suggestions):",o))}catch{w.error("Error getting suggestions",{description:"Please try again."})}finally{Ye.value=!1}}},$t=()=>{Re.value=!0,w.success("Citation Manager opened!",{description:"Review and verify your citations in the panel below."})},Bt=t=>{try{const e=gt.value?.editor||tt.value?.editor;if(!e){w.error("Editor not found");return}const{from:u}=e.state.selection;e.chain().focus().insertContentAt(u,` ${t} `).run(),w.success("Citation inserted successfully")}catch(e){console.error("Failed to insert citation:",e),w.error("Failed to insert citation")}},tt=i(null),gt=i(null),ua=async()=>{try{const t=document.documentElement;t.requestFullscreen?await t.requestFullscreen():t.webkitRequestFullscreen?await t.webkitRequestFullscreen():t.msRequestFullscreen&&await t.msRequestFullscreen()}catch(t){console.error("Error entering fullscreen:",t),w.error("Fullscreen Error",{description:"Unable to enter fullscreen mode"})}},da=async()=>{try{document.exitFullscreen?await document.exitFullscreen():document.webkitExitFullscreen?await document.webkitExitFullscreen():document.msExitFullscreen&&await document.msExitFullscreen()}catch(t){console.error("Error exiting fullscreen:",t),w.error("Fullscreen Error",{description:"Unable to exit fullscreen mode"})}},Qt=async()=>{O.value?await da():await ua()},Ue=()=>{const t=document.fullscreenElement||document.webkitFullscreenElement||document.msFullscreenElement;O.value=!!t},pa=()=>{v.value=!v.value,document.documentElement.classList.toggle("dark",v.value),localStorage.setItem("darkMode",v.value.toString())},ga=()=>{Z.value=!Z.value,Z.value&&(ge.value=!1),ve(Z.value)},va=()=>{Z.value=!1,ve(!1)},ha=()=>{ge.value=!1},Jt=()=>{X.value=!X.value},Xt=()=>{Be.visit(Q("projects.analysis",{project:s.project.slug}))},Yt=()=>{Qr(h.value),Me(),ut()},Zt=t=>{(t.ctrlKey||t.metaKey)&&t.key==="s"&&(t.preventDefault(),me(),Kr()),(t.ctrlKey||t.metaKey)&&!t.shiftKey&&t.key==="z"&&(t.preventDefault(),Ut()),(t.ctrlKey||t.metaKey)&&t.shiftKey&&t.key==="z"&&(t.preventDefault(),Kt()),t.key==="F11"&&(t.preventDefault(),Qt())};ht(()=>{const t=()=>{te.value=window.innerWidth<1024};t(),window.addEventListener("resize",t);const e=localStorage.getItem("darkMode")==="true";v.value=e,document.documentElement.classList.toggle("dark",e),Z.value=xe(),document.addEventListener("keydown",er),document.addEventListener("keydown",Zt),document.addEventListener("fullscreenchange",Ue),document.addEventListener("webkitfullscreenchange",Ue),document.addEventListener("msfullscreenchange",Ue),ut(),fa()});const Rt=()=>{ft(()=>{if(j.value){const t=X.value?O.value?Gr.value:zr.value:O.value?Ir.value:Wt.value;if(t)try{const e=t;if(!e)return;const u=e.$el||e;if(!u)return;let o=u.querySelector("[data-radix-scroll-area-viewport]");if(o||(o=u.querySelector("[data-viewport]")),o||(o=u.querySelector('[role="region"]')),o||(o=u.querySelector('div[style*="overflow"]')),o||(o=u.querySelector("[data-scrollable]")),!o){const d=u.querySelectorAll("div");for(const m of d){const $=window.getComputedStyle(m);if($.overflow==="auto"||$.overflow==="scroll"||$.overflowY==="auto"||$.overflowY==="scroll"||m.scrollHeight>m.clientHeight){o=m;break}}}if(!o){const d=u.querySelector('.ProseMirror, [contenteditable="true"]');d&&(o=d.closest('div[style*="overflow"]')||d.closest("[data-radix-scroll-area-viewport]")||d.parentElement)}if(o){const d=o.scrollHeight-o.clientHeight;o.scrollTop=d,requestAnimationFrame(()=>{o.scrollTop=o.scrollHeight,o.scrollTo&&o.scrollTo({top:o.scrollHeight,behavior:"instant"})})}else console.warn("Could not find scrollable viewport in ScrollArea",{scrollAreaEl:u,children:u.children,mode:X.value?"preview":"editor",fullscreen:O.value})}catch(e){console.warn("Auto-scroll failed:",e)}else{const e=document.querySelector(".ProseMirror");e&&e.scrollIntoView({behavior:"instant",block:"end"})}}})},fa=()=>{const t=new URLSearchParams(window.location.search),e=t.get("ai_generate")==="true",u=t.get("generation_type");e&&u&&setTimeout(()=>{if(u==="progressive"){Tt("progressive");const o=new URL(window.location.href);o.searchParams.delete("ai_generate"),o.searchParams.delete("generation_type"),window.history.replaceState({},"",o.toString()),w.success("ðŸš€ AI Generation Started",{description:`Generating ${s.chapter.title} with AI assistance...`})}else if(u==="single"){Tt("progressive");const o=new URL(window.location.href);o.searchParams.delete("ai_generate"),o.searchParams.delete("generation_type"),window.history.replaceState({},"",o.toString()),w.success("ðŸš€ AI Generation Started",{description:`Generating ${s.chapter.title} with AI assistance...`})}},1e3)},er=t=>{if((t.ctrlKey||t.metaKey)&&!["INPUT","TEXTAREA","SELECT"].includes(t.target?.tagName))switch(t.key){case"ArrowLeft":t.preventDefault();const e=s.chapter.chapter_number-1;s.allChapters.find(m=>m.chapter_number===e)&&et(e);break;case"ArrowRight":t.preventDefault();const o=s.chapter.chapter_number+1;s.allChapters.find(m=>m.chapter_number===o)&&et(o);break}};ht(()=>{const t=e=>{const u=o=>{const{scrollTop:d,scrollHeight:m,clientHeight:$}=e,T=o.deltaY,ee=d<=0,U=d+$>=m;T<0&&ee||T>0&&U||o.stopPropagation()};return e.addEventListener("wheel",u,{passive:!0}),()=>e.removeEventListener("wheel",u)};ft(()=>{const e=document.querySelectorAll('[class*="overflow-y-auto"]'),u=[];e.forEach(o=>{if(o instanceof HTMLElement){const d=t(o);u.push(d)}}),window.__scrollChainCleanup=u})}),ka(()=>{Ur(),S.value&&S.value.close(),document.removeEventListener("keydown",Zt),document.removeEventListener("keydown",er);const t=window.__scrollChainCleanup;t&&Array.isArray(t)&&(t.forEach(e=>e()),delete window.__scrollChainCleanup),document.removeEventListener("fullscreenchange",Ue),document.removeEventListener("webkitfullscreenchange",Ue),document.removeEventListener("msfullscreenchange",Ue)}),Te(()=>s.chapter,async t=>{G.value=t.title||"",h.value=t.content||"",ne.value=[],ba(),nr(),je.value=rr(),await at(!1,{skipGeneration:!0}),await ft(()=>{sr(),vt()})},{immediate:!1});const ne=i([]),Ke=i(!1),Ve=i(!1),rt=i(null),je=i(!1),tr=(t,e)=>`defense_auto_generate_${t}_ch_${e}`,rr=()=>{try{return localStorage.getItem(tr(s.project.id,s.chapter.chapter_number))==="true"}catch(t){return console.warn("Failed to load defense auto-generation preference:",t),!1}},ma=t=>{try{localStorage.setItem(tr(s.project.id,s.chapter.chapter_number),String(t))}catch(e){console.warn("Failed to save defense auto-generation preference:",e)}};je.value=rr(),Te(h,Yt),Te(G,Me);const ae=M(()=>s.chapter),ar=async t=>{ue.value=t,t&&wa()&&await at(!1,{skipGeneration:!0})},wa=()=>{if(!ne.value.length||!rt.value)return!0;const t=new Date(Date.now()-360*60*1e3);return rt.value<t},at=async(t=!1,e={})=>{if(Ke.value)return;const u=e.skipGeneration??!0;Ke.value=!0;try{console.log("Loading defense questions with params:",{project_id:s.project.id,chapter_number:ae.value?.chapter_number,limit:5,force_refresh:t,skip_generation:u});const o=await fe.get(`/api/projects/${s.project.id}/defense/questions`,{params:{chapter_number:ae.value?.chapter_number||null,limit:5,force_refresh:t?1:0,skip_generation:u?1:0},headers:{Accept:"application/json","X-Requested-With":"XMLHttpRequest"}});if(console.log("Defense questions loaded:",o.data),console.log("Questions array:",o.data.questions),console.log("Questions count:",o.data.questions?o.data.questions.length:0),ne.value=o.data.questions||[],rt.value=new Date,o.data.questions&&o.data.questions.length>0){const d=`defense_questions_${s.project.id}_chapter_${ae.value?.chapter_number}`;localStorage.setItem(d,JSON.stringify({questions:o.data.questions,chapter_number:ae.value?.chapter_number,loaded_at:new Date().toISOString()}))}else t||(console.log("No existing questions found for this chapter"),console.log(`Current word count: ${Y.value}/${dt}`),console.log('User must click "Generate Questions" button to create defense questions'))}catch(o){if(console.error("Failed to load defense questions:",o),o.response)if(console.error("Response status:",o.response.status),console.error("Response data:",o.response.data),o.response.status===422){console.error("Validation errors:",o.response.data.errors);const d=Object.values(o.response.data.errors||{})[0];d&&Array.isArray(d)?w.error(`Validation Error: ${d[0]}`):w.error("Invalid request parameters. Please refresh the page.")}else o.response.status===500?w.error("Server error. Please try again later."):w.error("Failed to load defense questions");else o.request?(console.error("No response received:",o.request),w.error("Network error. Please check your connection.")):(console.error("Error setting up request:",o.message),w.error("An unexpected error occurred"));ne.value=[]}finally{Ke.value=!1}},vt=async()=>{!je.value||Ve.value||Ke.value||ot.value||!Mt.value||ne.value.length>0||await Pt({autoTriggered:!0})},or=t=>{je.value=t,ma(t),t&&vt()};Te(h,Yt),Te(G,Me),Te([Y,je],()=>{vt()});const Pt=async(t={})=>{if(Ve.value)return;const e=t.autoTriggered??!1,u=ye.defense();if(ze(u,"generate defense questions")){Ve.value=!0;try{const o=m=>m?m.replace(/<[^>]*>/g," ").trim().split(/\s+/).filter($=>$.length>0).length:0,d=await fe.post(`/api/projects/${s.project.id}/defense/questions/generate`,{chapter_number:ae.value.chapter_number},{headers:{"X-CSRF-TOKEN":document.querySelector('meta[name="csrf-token"]')?.getAttribute("content"),Accept:"application/json","Content-Type":"application/json"}});if(d.data&&d.data.questions){ne.value=d.data.questions,rt.value=new Date;const m=d.data.questions.reduce((T,ee)=>{const U=o(ee.question),z=o(ee.suggested_answer),se=(ee.key_points||[]).reduce((de,De)=>de+o(De),0);return T+U+z+se},0),$=`defense_questions_${s.project.id}_chapter_${ae.value?.chapter_number}`;localStorage.setItem($,JSON.stringify({questions:d.data.questions,chapter_number:ae.value?.chapter_number,loaded_at:new Date().toISOString()})),w.success(`Generated ${d.data.questions.length} new questions`),Xe(m||ye.defense(),"Defense questions","chapter",s.chapter.id).catch(T=>console.error("Failed to record word usage (defense):",T)),ot.value=!0,xa(),e&&console.log("Auto-generated defense questions after meeting threshold.")}}catch(o){console.error("Failed to generate defense questions:",o),w.error("Failed to generate defense questions")}finally{Ve.value=!1}}},{hasTriggeredGeneration:ot,startWatching:nr,stopWatching:ba,forceCheck:sr,getStatusMessage:lr,markGenerationTriggered:xa}=yo(s.project,s.chapter,h),Mt=ea,ir=async()=>{console.log("ðŸ”µ [MARK COMPLETE] Function called"),console.log("ðŸ”µ [MARK COMPLETE] Current word count:",Y.value);try{console.log("ðŸ”µ [MARK COMPLETE] Saving chapter..."),await me(!1),console.log("âœ… [MARK COMPLETE] Chapter saved");const t=Q("chapters.mark-complete",{project:s.project.slug,chapter:s.chapter.chapter_number});console.log("ðŸ”µ [MARK COMPLETE] Posting to:",t),Be.post(t,{},{onSuccess:()=>{console.log("âœ… [MARK COMPLETE] Request successful")},onError:e=>{console.error("âŒ [MARK COMPLETE] Request failed:",e)}})}catch(t){console.error("âŒ [MARK COMPLETE] Error:",t),w.error("Failed to save chapter before marking complete")}},cr=M(()=>{const t=Y.value;return t>0&&t<dt&&!ot.value}),ur=ra,dr=ta,pr=async(t,e)=>{try{await fe.patch(`/api/projects/${s.project.id}/defense/questions/${t}`,{user_marked_helpful:e},{headers:{"X-CSRF-TOKEN":document.querySelector('meta[name="csrf-token"]')?.getAttribute("content"),Accept:"application/json","Content-Type":"application/json"}});const u=ne.value.find(o=>o.id===t);u&&(u.user_marked_helpful=e),w.success(e?"Question marked as helpful":"Removed helpful mark")}catch(u){console.error("Failed to mark question:",u),w.error("Failed to update question")}},gr=async t=>{try{await fe.delete(`/api/projects/${s.project.id}/defense/questions/${t}`,{headers:{"X-CSRF-TOKEN":document.querySelector('meta[name="csrf-token"]')?.getAttribute("content"),Accept:"application/json"}}),ne.value=ne.value.filter(e=>e.id!==t),localStorage.setItem(`defense_questions_${s.project.id}`,JSON.stringify({questions:ne.value,loaded_at:new Date().toISOString()})),w.success("Question hidden")}catch(e){console.error("Failed to hide question:",e),w.error("Failed to hide question")}};return ht(async()=>{const t=`defense_questions_${s.project.id}_chapter_${ae.value?.chapter_number}`,e=localStorage.getItem(t);let u=!0;if(e){const o=JSON.parse(e),d=new Date(o.loaded_at),m=new Date(Date.now()-360*60*1e3);d>m&&o.chapter_number===ae.value?.chapter_number&&(ne.value=o.questions,rt.value=d,u=!1)}u&&await at(!1,{skipGeneration:!0}),nr(),await ft(()=>{sr(),vt()})}),ht(async()=>{await Yr()}),(t,e)=>{const u=Ea("Edit2");return k(),K(r(Ra),null,{default:l(()=>[Z.value?(k(),K(r(f),{key:0,project:we.value,chapter:be.value,"chapter-title":G.value,"chapter-content":h.value,"current-word-count":r(Y),"target-word-count":ce.value,"progress-percentage":r(kt),"writing-quality-score":r(Ce),"is-valid":pt.value,"is-saving":r(_e),"show-preview":F.value,"is-generating":j.value,"generation-progress":c.value,"history-index":r(Br),"content-history-length":r(Vr).length,"selected-text":J.value,"onUpdate:chapterTitle":e[0]||(e[0]=o=>G.value=o),"onUpdate:chapterContent":e[1]||(e[1]=o=>h.value=o),"onUpdate:selectedText":e[2]||(e[2]=o=>J.value=o),"onUpdate:showPreview":e[3]||(e[3]=o=>F.value=o),onSave:e[4]||(e[4]=o=>Ht(o)),onUndo:Ut,onRedo:Kt,onExitChatMode:va},null,8,["project","chapter","chapter-title","chapter-content","current-word-count","target-word-count","progress-percentage","writing-quality-score","is-valid","is-saving","show-preview","is-generating","generation-progress","history-index","content-history-length","selected-text"])):ge.value?(k(),K(r(p),{key:1,project:we.value,chapter:be.value,"chapter-title":G.value,"chapter-content":h.value,"current-word-count":r(Y),"target-word-count":ce.value,"progress-percentage":r(kt),onExitCitationMode:ha},null,8,["project","chapter","chapter-title","chapter-content","current-word-count","target-word-count","progress-percentage"])):O.value?(k(),B("div",Co,[e[52]||(e[52]=a("div",{class:"absolute inset-0 z-0 overflow-hidden pointer-events-none"},[a("div",{class:"absolute top-[-20%] left-[-10%] w-[50%] h-[50%] rounded-full bg-blue-500/5 blur-[120px]"}),a("div",{class:"absolute bottom-[-20%] right-[-10%] w-[50%] h-[50%] rounded-full bg-purple-500/5 blur-[120px]"})],-1)),a("div",ko,[a("div",Eo,[n(r(ke),null,{default:l(()=>[n(r(Ee),{asChild:""},{default:l(()=>[n(r(H),{onClick:e[5]||(e[5]=o=>r(Be).visit(r(Q)("projects.show",s.project.slug))),variant:"ghost",size:"icon",class:"h-10 w-10 rounded-full hover:bg-primary/10 hover:text-primary transition-all duration-300"},{default:l(()=>[n(r(za),{class:"h-5 w-5"})]),_:1})]),_:1}),n(r(Se),null,{default:l(()=>[...e[30]||(e[30]=[a("p",null,"Back to Project",-1)])]),_:1})]),_:1}),a("div",So,[n(mr,{as:"h1",class:"text-lg font-bold tracking-tight text-foreground/90 font-display",content:s.project.title},null,8,["content"]),a("div",To,[n(r(Oe),{variant:"outline",class:"h-5 px-2 rounded-full border-primary/20 bg-primary/5 text-primary font-medium"},{default:l(()=>[A(" Chapter "+R(s.chapter.chapter_number),1)]),_:1}),a("span",Ao,[e[31]||(e[31]=a("span",{class:"h-1.5 w-1.5 rounded-full bg-green-500 animate-pulse"},null,-1)),A(" "+R(r(Y))+" words ",1)])])])]),a("div",$o,[a("div",Ro,[n(r(H),{onClick:e[6]||(e[6]=o=>Ae.value=!Ae.value),variant:Ae.value?"secondary":"ghost",size:"sm",class:pe(["h-8 px-4 rounded-full text-xs font-medium transition-all duration-300",Ae.value?"bg-primary/10 text-primary hover:bg-primary/15":"hover:bg-muted"])},{default:l(()=>[n(r(wr),{class:"mr-2 h-3.5 w-3.5"}),e[32]||(e[32]=A(" Outline ",-1))]),_:1},8,["variant","class"]),e[34]||(e[34]=a("div",{class:"w-px h-4 bg-border/50 mx-1"},null,-1)),n(r(H),{onClick:e[7]||(e[7]=o=>$e.value=!$e.value),variant:$e.value?"secondary":"ghost",size:"sm",class:pe(["h-8 px-4 rounded-full text-xs font-medium transition-all duration-300",$e.value?"bg-primary/10 text-primary hover:bg-primary/15":"hover:bg-muted"])},{default:l(()=>[n(r(nt),{class:"mr-2 h-3.5 w-3.5"}),e[33]||(e[33]=A(" Assistant ",-1))]),_:1},8,["variant","class"])]),a("div",Po,[n(r(ke),null,{default:l(()=>[n(r(Ee),{asChild:""},{default:l(()=>[n(r(H),{onClick:e[8]||(e[8]=o=>I.value=!I.value),variant:I.value?"secondary":"ghost",size:"icon",class:"h-9 w-9 rounded-full transition-all hover:bg-muted"},{default:l(()=>[n(r(Cr),{class:"h-4.5 w-4.5 text-muted-foreground"})]),_:1},8,["variant"])]),_:1}),n(r(Se),null,{default:l(()=>[a("p",null,R(I.value?"Hide":"Show")+" Statistics",1)]),_:1})]),_:1}),n(r(ke),null,{default:l(()=>[n(r(Ee),{asChild:""},{default:l(()=>[n(r(H),{onClick:pa,variant:"ghost",size:"icon",class:"h-9 w-9 rounded-full transition-all hover:bg-muted"},{default:l(()=>[v.value?(k(),K(r(Ma),{key:1,class:"h-4.5 w-4.5 text-muted-foreground"})):(k(),K(r(Pa),{key:0,class:"h-4.5 w-4.5 text-muted-foreground"}))]),_:1})]),_:1}),n(r(Se),null,{default:l(()=>[...e[35]||(e[35]=[a("p",null,"Toggle Theme",-1)])]),_:1})]),_:1}),n(br,{project:we.value,"current-chapter":be.value,"all-chapters":qe.value,size:"icon",variant:"ghost",class:"h-9 w-9 rounded-full hover:bg-muted"},null,8,["project","current-chapter","all-chapters"])])])]),a("div",Mo,[a("div",{class:"absolute top-0 left-0 h-full bg-gradient-to-r from-blue-500 via-purple-500 to-pink-500 transition-all duration-700 ease-out shadow-[0_0_10px_rgba(59,130,246,0.5)]",style:st({width:`${Math.min(r(kt),100)}%`})},null,4)]),j.value?(k(),B("div",qo,[a("div",jo,[e[41]||(e[41]=a("div",{class:"absolute inset-0 -skew-x-12 animate-pulse bg-gradient-to-r from-transparent via-white/10 to-transparent"},null,-1)),a("div",Do,[a("div",Fo,[a("div",Lo,[a("div",Oo,[n(r(nt),{class:"h-3 w-3 text-white"})]),e[36]||(e[36]=a("div",{class:"absolute inset-0 h-6 w-6 animate-ping rounded-full bg-gradient-to-br from-blue-500 to-purple-600 opacity-20"},null,-1))]),a("div",null,[e[37]||(e[37]=a("h4",{class:"text-xs font-semibold text-blue-900 dark:text-blue-100"},"AI Generator",-1)),a("p",No,R(_.value),1)])]),n(r(Oe),{variant:"outline",class:"border-blue-300 text-xs text-blue-700 dark:border-blue-700 dark:text-blue-300"},{default:l(()=>[A(R(Math.round(b.value))+"% ",1)]),_:1})]),a("div",Wo,[a("div",Io,[e[38]||(e[38]=a("span",{class:"text-xs text-blue-800 dark:text-blue-200"},"Generation Progress",-1)),a("span",zo,R(E.value)+" / "+R(V.value)+" words",1)]),a("div",Go,[a("div",{class:"absolute top-0 left-0 h-full rounded-full bg-gradient-to-r from-blue-500 to-purple-500 transition-all duration-500 ease-out",style:st({width:`${b.value}%`})},[...e[39]||(e[39]=[a("div",{class:"absolute inset-0 animate-pulse bg-gradient-to-r from-transparent via-white/30 to-transparent"},null,-1)])],4),a("div",{class:"absolute top-0 left-0 h-full rounded-full bg-gradient-to-r from-blue-400 to-purple-400 opacity-50 blur-sm transition-all duration-500",style:st({width:`${b.value}%`})},null,4)])]),a("div",Ho,[a("div",Uo,[_.value==="Initializing"?(k(),B("div",Ko)):_.value==="Connecting"?(k(),B("div",Vo,[...e[40]||(e[40]=[a("div",{class:"h-2 w-0.5 animate-pulse rounded-full bg-blue-500"},null,-1),a("div",{class:"h-2 w-0.5 animate-pulse rounded-full bg-purple-500",style:{"animation-delay":"0.2s"}},null,-1),a("div",{class:"h-2 w-0.5 animate-pulse rounded-full bg-blue-500",style:{"animation-delay":"0.4s"}},null,-1)])])):_.value==="Generating"?(k(),B("div",Bo)):_.value==="Complete"?(k(),B("div",Qo)):(k(),B("div",Jo))]),a("p",Xo,R(c.value),1)])])])):oe("",!0),I.value?(k(),K(Sr,{key:1,"show-statistics":I.value,"current-word-count":r(Y),"writing-stats":r(Ct),"quality-analysis":r(he),"is-analyzing":r(zt),class:"relative z-20 mx-4 mt-2 rounded-lg border border-border/40 bg-background/60 backdrop-blur-md"},null,8,["show-statistics","current-word-count","writing-stats","quality-analysis","is-analyzing"])):oe("",!0),a("div",Yo,[n(mt,{"enter-active-class":"transition-all duration-300 ease-in-out","enter-from-class":"-ml-72 opacity-0","enter-to-class":"ml-0 opacity-100","leave-active-class":"transition-all duration-300 ease-in-out","leave-from-class":"ml-0 opacity-100","leave-to-class":"-ml-72 opacity-0"},{default:l(()=>[Ae.value?(k(),B("div",Zo,[a("div",en,[a("div",tn,[a("div",rn,[e[42]||(e[42]=a("h2",{class:"text-sm font-semibold text-foreground mb-1"},"Table of Contents",-1)),a("p",an,R(qe.value.length)+" Chapters ",1)]),(k(),K(wt,null,{fallback:l(()=>[...e[43]||(e[43]=[a("div",{class:"flex items-center justify-center p-8"},[a("div",{class:"h-6 w-6 animate-spin rounded-full border-2 border-primary border-t-transparent"})],-1)])]),default:l(()=>[n(r(q),{"all-chapters":qe.value,"current-chapter":be.value,project:we.value,outlines:t.project.outlines||[],"faculty-chapters":t.facultyChapters||[],"current-word-count":r(Y),"target-word-count":ce.value,"writing-quality-score":r(Ce),"chapter-content-length":h.value.length,onGoToChapter:et,onGenerateNextChapter:Et},null,8,["all-chapters","current-chapter","project","outlines","faculty-chapters","current-word-count","target-word-count","writing-quality-score","chapter-content-length"])]),_:1}))])])])):oe("",!0)]),_:1}),a("div",on,[a("div",nn,[a("div",sn,[n(r(Dt),{class:"w-full max-w-[850px] min-h-[calc(100vh-180px)] flex flex-col bg-background shadow-xl shadow-black/5 ring-1 ring-black/5 dark:ring-white/10 rounded-xl overflow-hidden transition-all duration-300"},{default:l(()=>[n(r(Lt),{class:"flex-shrink-0 border-b border-border/30 px-8 py-6 bg-background/50 backdrop-blur-sm sticky top-0 z-10"},{default:l(()=>[a("div",ln,[a("div",cn,[n(r(Ta),{for:"chapter-title-fs",class:"text-xs font-medium text-muted-foreground uppercase tracking-wider"},{default:l(()=>[...e[44]||(e[44]=[A("Chapter Title",-1)])]),_:1}),n(r(Sa),{id:"chapter-title-fs",modelValue:G.value,"onUpdate:modelValue":e[9]||(e[9]=o=>G.value=o),placeholder:"Enter chapter title...",class:"h-auto p-0 border-0 bg-transparent text-2xl font-bold placeholder:text-muted-foreground/40 focus-visible:ring-0 px-0"},null,8,["modelValue"])]),a("div",un,[n(r(Oe),{variant:t.chapter.status==="approved"?"default":"secondary",class:"rounded-full px-3"},{default:l(()=>[A(R(t.chapter.status.replace("_"," ")),1)]),_:1},8,["variant"]),n(r(Oe),{variant:"outline",class:pe(["rounded-full px-3 transition-colors",{"text-green-600 border-green-200 bg-green-50 dark:bg-green-900/20 dark:border-green-800":(r(he)?.total_score||0)>=80,"text-yellow-600 border-yellow-200 bg-yellow-50 dark:bg-yellow-900/20 dark:border-yellow-800":(r(he)?.total_score||0)>=70&&(r(he)?.total_score||0)<80,"text-orange-600 border-orange-200 bg-orange-50 dark:bg-orange-900/20 dark:border-orange-800":(r(he)?.total_score||0)>=60&&(r(he)?.total_score||0)<70,"text-red-600 border-red-200 bg-red-50 dark:bg-red-900/20 dark:border-red-800":(r(he)?.total_score||0)<60}])},{default:l(()=>[A(R(r(he)?.total_score?Math.round(r(he).total_score):r(Ce))+"% Quality ",1)]),_:1},8,["class"])])])]),_:1}),n(r(Ft),{class:"flex min-h-0 flex-1 flex-col p-0"},{default:l(()=>[a("div",dn,[a("div",pn,[n(r(H),{onClick:Jt,variant:X.value?"default":"ghost",size:"sm",class:"h-7 text-xs rounded-full"},{default:l(()=>[n(r(kr),{class:"mr-1.5 h-3.5 w-3.5"}),A(" "+R(X.value?"Edit":"Preview"),1)]),_:1},8,["variant"])]),a("div",gn,[a("div",vn,R(t.aiChapterAnalysis?.section.name||t.getSectionInfo(t.nextSection).name),1),a("div",hn,R(t.aiChapterAnalysis?.section.description||t.getSectionInfo(t.nextSection).description),1)])]),a("div",fn,[Qe(n(yr,{modelValue:h.value,"onUpdate:modelValue":e[10]||(e[10]=o=>h.value=o),placeholder:"Start writing your chapter...","min-height":"500px",class:"min-h-[500px] px-8 py-6",ref_key:"richTextEditor",ref:tt,"show-toolbar":!0,"onUpdate:selectedText":e[11]||(e[11]=o=>{J.value=o})},null,8,["modelValue"]),[[Je,!X.value]]),Qe(a("div",mn,[n(xr,{content:h.value,"show-font-controls":!1,class:"prose-lg mx-auto",style:{"font-family":"'Times New Roman', serif","line-height":"1.8"}},null,8,["content"])],512),[[Je,X.value]])])]),_:1}),a("div",wn,[a("div",bn,R(r(_e)?"Saving...":"All changes saved"),1),a("div",xn,[n(r(H),{onClick:e[12]||(e[12]=o=>r(me)(!1)),disabled:!pt.value||r(_e),size:"sm",variant:"ghost",class:"h-8 rounded-full"},{default:l(()=>[n(r(Er),{class:"mr-2 h-3.5 w-3.5"}),e[45]||(e[45]=A(" Save Draft ",-1))]),_:1},8,["disabled"]),n(r(H),{onClick:Xt,variant:"outline",size:"sm",class:"h-8 rounded-full"},{default:l(()=>[n(r(xt),{class:"mr-2 h-3.5 w-3.5"}),e[46]||(e[46]=A(" Run Bulk Analysis ",-1))]),_:1}),n(r(H),{onClick:ir,disabled:r(_e),size:"sm",class:"h-8 rounded-full bg-gradient-to-r from-primary to-primary/90 shadow-sm hover:shadow-md transition-all"},{default:l(()=>[n(r(qt),{class:"mr-2 h-3.5 w-3.5"}),e[47]||(e[47]=A(" Complete ",-1))]),_:1},8,["disabled"])])])]),_:1}),e[48]||(e[48]=a("div",{class:"h-12"},null,-1))])])]),n(mt,{"enter-active-class":"transition-all duration-300 ease-in-out","enter-from-class":"-mr-72 opacity-0","enter-to-class":"mr-0 opacity-100","leave-active-class":"transition-all duration-300 ease-in-out","leave-from-class":"mr-0 opacity-100","leave-to-class":"-mr-72 opacity-0"},{default:l(()=>[$e.value?(k(),B("div",yn,[a("div",_n,[a("div",Cn,[(k(),K(wt,null,{fallback:l(()=>[...e[49]||(e[49]=[a("div",{class:"flex items-center justify-center p-8"},[a("div",{class:"h-6 w-6 animate-spin rounded-full border-2 border-primary border-t-transparent"})],-1)])]),default:l(()=>[n(r(C),{project:we.value,chapter:be.value,"is-generating":j.value,"selected-text":J.value,"is-loading-suggestions":Ye.value,"show-citation-helper":Re.value,"chapter-content":h.value,"current-word-count":r(Y),"target-word-count":ce.value,onStartStreamingGeneration:St,onGetAiSuggestions:At,"onUpdate:showCitationHelper":e[13]||(e[13]=o=>Re.value=o),onInsertCitation:Bt,onCheckCitations:$t},null,8,["project","chapter","is-generating","selected-text","is-loading-suggestions","show-citation-helper","chapter-content","current-word-count","target-word-count"])]),_:1})),(k(),K(wt,null,{fallback:l(()=>[...e[50]||(e[50]=[a("div",{class:"flex items-center justify-center p-4"},[a("div",{class:"h-4 w-4 animate-spin rounded-full border-2 border-muted border-t-transparent"})],-1)])]),default:l(()=>[n(r(x),{"show-defense-prep":ue.value,questions:ne.value,"is-loading":Ke.value,"is-generating":Ve.value,"chapter-context":{chapter_number:ae.value.chapter_number,chapter_title:ae.value.title,word_count:r(Y)},"defense-watcher":{meetsThreshold:r(Mt),shouldShowProgress:cr.value,progressPercentage:r(ur),wordsRemaining:r(dr),hasTriggeredGeneration:r(ot),threshold:r(dt),statusMessage:r(lr)()},"auto-generate-enabled":je.value,"onUpdate:showDefensePrep":ar,onGenerateMore:Pt,onToggleAutoGenerate:or,onRefresh:e[14]||(e[14]=()=>at(!0,{skipGeneration:!0})),onMarkHelpful:pr,onHideQuestion:gr},null,8,["show-defense-prep","questions","is-loading","is-generating","chapter-context","defense-watcher","auto-generate-enabled"])]),_:1})),(k(),K(wt,null,{fallback:l(()=>[...e[51]||(e[51]=[a("div",{class:"flex items-center justify-center p-4"},[a("div",{class:"h-4 w-4 animate-spin rounded-full border-2 border-muted border-t-transparent"})],-1)])]),default:l(()=>[n(r(g),{"chapter-id":ae.value.id,content:h.value},null,8,["chapter-id","content"])]),_:1}))])])])):oe("",!0)]),_:1})])])):(k(),K($a,{key:3,class:"h-screen overflow-hidden bg-zinc-50 dark:bg-zinc-950"},{default:l(()=>[a("div",kn,[e[76]||(e[76]=a("div",{class:"absolute inset-0 z-0 overflow-hidden pointer-events-none"},[a("div",{class:"absolute top-[-10%] left-[-10%] w-[40%] h-[40%] rounded-full bg-blue-500/5 blur-[100px]"}),a("div",{class:"absolute bottom-[-10%] right-[-10%] w-[40%] h-[40%] rounded-full bg-purple-500/5 blur-[100px]"})],-1)),Qe(a("aside",En,[a("div",Sn,[e[53]||(e[53]=a("span",{class:"text-sm font-semibold tracking-tight"},"Navigation",-1)),n(r(Oe),{variant:"outline",class:"text-[10px] h-5 px-1.5"},{default:l(()=>[A(R(qe.value.length)+" Chapters ",1)]),_:1})]),n(r(fr),{class:"flex-1"},{default:l(()=>[a("div",Tn,[n(r(q),{"all-chapters":qe.value,"current-chapter":be.value,project:we.value,outlines:t.project.outlines||[],"faculty-chapters":t.facultyChapters||[],"current-word-count":r(Y),"target-word-count":ce.value,"writing-quality-score":r(Ce),"chapter-content-length":h.value.length,onGoToChapter:et,onGenerateNextChapter:Et},null,8,["all-chapters","current-chapter","project","outlines","faculty-chapters","current-word-count","target-word-count","writing-quality-score","chapter-content-length"])])]),_:1})],512),[[Je,!re.value]]),a("main",An,[a("header",$n,[a("div",Rn,[a("div",Pn,[n(r(H),{variant:"ghost",size:"icon",onClick:e[15]||(e[15]=o=>re.value=!re.value),class:"hidden lg:flex text-muted-foreground hover:text-foreground -ml-2 h-8 w-8"},{default:l(()=>[re.value?(k(),K(r(Ha),{key:1,class:"h-4 w-4"})):(k(),K(r(Ga),{key:0,class:"h-4 w-4"}))]),_:1}),n(r(H),{variant:"ghost",size:"icon",onClick:e[16]||(e[16]=o=>W.value=!0),class:"lg:hidden text-muted-foreground hover:text-foreground -ml-2 h-8 w-8"},{default:l(()=>[n(r(wr),{class:"h-4 w-4"})]),_:1}),e[54]||(e[54]=a("div",{class:"h-8 w-px bg-border/50 hidden lg:block mx-1"},null,-1))]),a("div",Mn,[a("div",qn,[n(mr,{as:"h1",class:"text-lg font-bold tracking-tight text-foreground leading-tight cursor-pointer hover:text-primary/80 transition-colors break-words line-clamp-2",content:s.project.title,onClick:e[17]||(e[17]=o=>r(Be).visit(r(Q)("projects.show",s.project.slug)))},null,8,["content"]),n(r(Oe),{variant:"secondary",class:"h-5 px-2 text-[10px] font-medium rounded-full bg-secondary/50 border border-border/50 shrink-0 mt-0.5"},{default:l(()=>[A(" Ch "+R(s.chapter.chapter_number),1)]),_:1})]),a("div",jn,[a("div",Dn,[n(r(ke),null,{default:l(()=>[n(r(Ee),{asChild:""},{default:l(()=>[n(r(H),{onClick:e[18]||(e[18]=o=>I.value=!I.value),variant:I.value?"secondary":"ghost",size:"sm",class:"h-7 px-3 text-xs gap-2"},{default:l(()=>[n(r(Cr),{class:"h-3.5 w-3.5"}),e[55]||(e[55]=A(" Stats ",-1))]),_:1},8,["variant"])]),_:1}),n(r(Se),null,{default:l(()=>[...e[56]||(e[56]=[A("Toggle Writing Statistics",-1)])]),_:1})]),_:1}),e[61]||(e[61]=a("div",{class:"w-px h-3 bg-border/50 mx-0.5"},null,-1)),n(r(ke),null,{default:l(()=>[n(r(Ee),{asChild:""},{default:l(()=>[n(r(H),{onClick:Jt,variant:X.value?"secondary":"ghost",size:"sm",class:"h-7 px-3 text-xs gap-2"},{default:l(()=>[X.value?(k(),K(u,{key:1,class:"h-3.5 w-3.5"})):(k(),K(r(kr),{key:0,class:"h-3.5 w-3.5"})),A(" "+R(X.value?"Edit":"Preview"),1)]),_:1},8,["variant"])]),_:1}),n(r(Se),null,{default:l(()=>[...e[57]||(e[57]=[A("Toggle Preview Mode",-1)])]),_:1})]),_:1}),e[62]||(e[62]=a("div",{class:"w-px h-3 bg-border/50 mx-0.5"},null,-1)),n(r(ke),null,{default:l(()=>[n(r(Ee),{asChild:""},{default:l(()=>[n(r(H),{onClick:ga,variant:"ghost",size:"sm",class:"h-7 px-3 text-xs gap-2"},{default:l(()=>[n(r(Ua),{class:"h-3.5 w-3.5 text-blue-500"}),e[58]||(e[58]=A(" AI Chat ",-1))]),_:1})]),_:1}),n(r(Se),null,{default:l(()=>[...e[59]||(e[59]=[A("Open AI Assistant Overlay",-1)])]),_:1})]),_:1}),e[63]||(e[63]=a("div",{class:"w-px h-3 bg-border/50 mx-0.5"},null,-1)),n(r(ke),null,{default:l(()=>[n(r(Ee),{asChild:""},{default:l(()=>[n(r(H),{onClick:Qt,variant:"ghost",size:"sm",class:"h-7 px-3 text-xs gap-2",title:O.value?"Exit Full Screen":"Enter Full Screen"},{default:l(()=>[O.value?(k(),K(r(Fa),{key:0,class:"h-3.5 w-3.5"})):(k(),K(r(La),{key:1,class:"h-3.5 w-3.5"}))]),_:1},8,["title"])]),_:1}),n(r(Se),null,{default:l(()=>[...e[60]||(e[60]=[A("Toggle Full Screen",-1)])]),_:1})]),_:1})]),n(br,{project:we.value,"current-chapter":be.value,"all-chapters":qe.value,size:"sm",variant:"outline",class:"h-7 hidden md:flex"},null,8,["project","current-chapter","all-chapters"]),n(r(H),{variant:"ghost",size:"sm",class:"hidden md:flex h-7 gap-2",onClick:Xt,title:"Open bulk analysis"},{default:l(()=>[n(r(nt),{class:"w-4 h-4"}),e[64]||(e[64]=a("span",{class:"text-xs font-medium"},"Analyze",-1))]),_:1}),n(r(H),{onClick:e[19]||(e[19]=o=>r(me)(!1)),disabled:r(_e),variant:pt.value?"default":"secondary",size:"sm",class:"h-7 px-3 text-xs shadow-sm gap-2"},{default:l(()=>[n(r(Er),{class:"h-3.5 w-3.5"}),A(" "+R(r(_e)?"Saving...":"Save"),1)]),_:1},8,["disabled","variant"]),n(r(H),{onClick:ir,disabled:r(_e),size:"sm",class:"h-7 px-3 text-xs shadow-sm gap-2"},{default:l(()=>[n(r(qt),{class:"h-3.5 w-3.5"}),e[65]||(e[65]=A(" Mark Complete ",-1))]),_:1},8,["disabled"])])])]),a("div",Fn,[n(r(H),{variant:"ghost",size:"icon",onClick:e[20]||(e[20]=o=>le.value=!le.value),class:"hidden lg:flex text-muted-foreground hover:text-foreground ml-1 h-8 w-8"},{default:l(()=>[le.value?(k(),K(r(Na),{key:1,class:"h-4 w-4"})):(k(),K(r(Oa),{key:0,class:"h-4 w-4"}))]),_:1}),n(r(H),{variant:"ghost",size:"icon",onClick:e[21]||(e[21]=o=>y.value=!0),class:"lg:hidden text-muted-foreground hover:text-foreground ml-1 h-8 w-8"},{default:l(()=>[n(r(nt),{class:"h-4 w-4"})]),_:1})])]),a("div",Ln,[n(mt,{"enter-active-class":"transition-all duration-300 ease-out","enter-from-class":"opacity-0 -translate-y-4","enter-to-class":"opacity-100 translate-y-0","leave-active-class":"transition-all duration-200 ease-in","leave-from-class":"opacity-100 translate-y-0","leave-to-class":"opacity-0 -translate-y-4"},{default:l(()=>[j.value?(k(),B("div",On,[a("div",Nn,[a("div",Wn,[a("div",In,[a("div",zn,[n(r(nt),{class:"h-4 w-4 text-white animate-pulse"})]),a("div",Gn,[a("div",Hn,[e[66]||(e[66]=a("h4",{class:"text-xs font-semibold text-foreground"},"Generating Content...",-1)),a("span",Un,R(Math.round(b.value))+"%",1)]),a("div",Kn,[a("div",{class:"h-full bg-gradient-to-r from-blue-500 to-purple-500 transition-all duration-300",style:st({width:`${b.value}%`})},null,4)])])]),a("p",Vn,R(c.value),1)])])])):oe("",!0)]),_:1}),n(r(fr),{ref_key:"editorScrollRef",ref:Wt,class:"h-full w-full"},{default:l(()=>[a("div",Bn,[n(mt,{"enter-active-class":"transition-all duration-300 ease-out","enter-from-class":"opacity-0 -translate-y-2","enter-to-class":"opacity-100 translate-y-0","leave-active-class":"transition-all duration-200 ease-in","leave-from-class":"opacity-100 translate-y-0","leave-to-class":"opacity-0 -translate-y-2"},{default:l(()=>[I.value?(k(),K(Sr,{key:0,"show-statistics":!0,"current-word-count":r(Y),"writing-stats":r(Ct),"quality-analysis":r(he),"is-analyzing":r(zt),class:"mb-8"},null,8,["current-word-count","writing-stats","quality-analysis","is-analyzing"])):oe("",!0)]),_:1}),Qe(a("div",Qn,[n(yr,{ref_key:"richTextEditor",ref:tt,modelValue:h.value,"onUpdate:modelValue":e[22]||(e[22]=o=>h.value=o),placeholder:"Start writing your chapter...",class:"prose prose-slate dark:prose-invert prose-lg max-w-none focus:outline-none min-h-[500px]","onUpdate:selectedText":e[23]||(e[23]=o=>J.value=o),"min-height":"500px"},null,8,["modelValue"])],512),[[Je,!X.value]]),Qe(a("div",Jn,[n(xr,{content:h.value,class:"prose prose-slate dark:prose-invert prose-lg max-w-none"},null,8,["content"])],512),[[Je,X.value]])])]),_:1},512)]),a("div",Xn,[a("div",Yn,[a("span",null,"Words: "+R(r(Y))+" / "+R(ce.value),1),a("span",Zn,"Last saved: "+R(r(_e)?"Saving...":"Just now"),1)]),a("div",es,[a("span",null,[e[67]||(e[67]=A("Quality: ",-1)),a("span",{class:pe(r(Ce)>70?"text-green-500":"text-amber-500")},R(r(Ce))+"%",3)]),pt.value?(k(),B("span",ts,[n(r(qt),{class:"h-3 w-3"}),e[68]||(e[68]=A(" Ready ",-1))])):oe("",!0)])])]),Qe(a("aside",rs,[a("div",as,[e[70]||(e[70]=a("span",{class:"text-sm font-semibold tracking-tight"},"Writing Assistant",-1)),n(r(ke),null,{default:l(()=>[n(r(Ee),{asChild:""},{default:l(()=>[n(r(H),{variant:"ghost",size:"icon",class:"h-7 w-7"},{default:l(()=>[n(r(xt),{class:"h-3.5 w-3.5"})]),_:1})]),_:1}),n(r(Se),null,{default:l(()=>[...e[69]||(e[69]=[A("Manage Citations",-1)])]),_:1})]),_:1})]),a("div",os,[a("div",ns,[n(r(C),{project:we.value,chapter:be.value,"is-generating":j.value,"selected-text":J.value,"is-loading-suggestions":Ye.value,"show-citation-helper":Re.value,"chapter-content":h.value,"current-word-count":r(Y),"target-word-count":ce.value,onStartStreamingGeneration:St,onGetAiSuggestions:At,"onUpdate:showCitationHelper":e[24]||(e[24]=o=>Re.value=o),onInsertCitation:Bt,onCheckCitations:$t},null,8,["project","chapter","is-generating","selected-text","is-loading-suggestions","show-citation-helper","chapter-content","current-word-count","target-word-count"]),n(r(x),{"show-defense-prep":ue.value,questions:ne.value,"is-loading":Ke.value,"is-generating":Ve.value,"chapter-context":{chapter_number:ae.value.chapter_number,chapter_title:ae.value.title,word_count:r(Y)},"defense-watcher":{meetsThreshold:r(Mt),shouldShowProgress:cr.value,progressPercentage:r(ur),wordsRemaining:r(dr),hasTriggeredGeneration:r(ot),threshold:r(dt),statusMessage:r(lr)()},"auto-generate-enabled":je.value,"onUpdate:showDefensePrep":ar,onGenerateMore:Pt,onToggleAutoGenerate:or,onRefresh:e[25]||(e[25]=()=>at(!0,{skipGeneration:!0})),onMarkHelpful:pr,onHideQuestion:gr},null,8,["show-defense-prep","questions","is-loading","is-generating","chapter-context","defense-watcher","auto-generate-enabled"])])])],512),[[Je,!le.value]]),n(r(N),{"show-left-sidebar":W.value,"show-right-sidebar":y.value,"is-mobile":te.value,"all-chapters":qe.value,"current-chapter":be.value,project:we.value,"current-word-count":r(Y),"target-word-count":ce.value,"writing-quality-score":r(Ce),"chapter-content-length":h.value.length,"is-generating":j.value,"selected-text":J.value,"is-loading-suggestions":Ye.value,"show-citation-helper":Re.value,"chapter-content":h.value,"onUpdate:showLeftSidebar":e[26]||(e[26]=o=>W.value=o),"onUpdate:showRightSidebar":e[27]||(e[27]=o=>y.value=o),onGoToChapter:et,onGenerateNextChapter:Et,onStartStreamingGeneration:St,onGetAiSuggestions:At,"onUpdate:showCitationHelper":e[28]||(e[28]=o=>Re.value=o),onCheckCitations:$t},null,8,["show-left-sidebar","show-right-sidebar","is-mobile","all-chapters","current-chapter","project","current-word-count","target-word-count","writing-quality-score","chapter-content-length","is-generating","selected-text","is-loading-suggestions","show-citation-helper","chapter-content"]),n(qa,{open:r(Nt),"current-balance":r(Rr),"required-words":r(Pr),action:r(Mr),"onUpdate:open":e[29]||(e[29]=o=>Nt.value=o),onClose:r(jr)},null,8,["open","current-balance","required-words","action","onClose"]),Ie.value?(k(),B("div",ss,[n(r(Dt),{class:"w-full max-w-md mx-4 bg-white dark:bg-slate-900 border-amber-500/50 shadow-2xl"},{default:l(()=>[n(r(Lt),null,{default:l(()=>[n(r(Ar),{class:"flex items-center gap-2 text-amber-600 dark:text-amber-400"},{default:l(()=>[...e[71]||(e[71]=[a("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[a("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"})],-1),A(" Generation Interrupted ",-1)])]),_:1})]),_:1}),n(r(Ft),null,{default:l(()=>[a("p",ls,[e[72]||(e[72]=A(" Connection lost. ",-1)),a("span",is,R(ct.value)+" words",1),e[73]||(e[73]=A(" may have been saved. ",-1))]),a("div",cs,[n(r(H),{onClick:ia,class:"flex-1 bg-amber-600 hover:bg-amber-700 text-white"},{default:l(()=>[...e[74]||(e[74]=[a("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-4 w-4 mr-2",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[a("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"})],-1),A(" Reload & Recover ",-1)])]),_:1}),n(r(H),{onClick:ca,variant:"outline",class:"flex-1"},{default:l(()=>[...e[75]||(e[75]=[A(" Dismiss ",-1)])]),_:1})])]),_:1})]),_:1})])):oe("",!0)])]),_:1}))]),_:1})}}}),yl=Ka(ds,[["__scopeId","data-v-683db5b1"]]);export{yl as default};
