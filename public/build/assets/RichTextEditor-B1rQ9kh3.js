import{bt as We,bs as h,ck as B,bA as Oe,cR as Ft,cn as de,co as z,cp as i,cr as u,cB as I,cG as P,cu as w,ct as V,bE as t,eM as Wt,eN as Nt,eO as qt,cQ as pe,ci as le,bB as tt,cq as a,cw as Ke,du as jt,cx as Xt,eP as at,eQ as Gt,cS as Fe,cM as rt,eR as nt,eS as st,cs as b,cO as ot,dU as Yt,cb as lt,aO as it,aP as dt,bN as Kt,bM as Qt,eT as Jt,bD as Be,eU as Zt,eV as ea,eW as ta,eX as aa,dL as ra,eY as na,eZ as sa,e_ as oa,e$ as la,f0 as ia,f1 as da,f2 as ua,cN as ca,f3 as ga,dN as fa,f4 as ma,f5 as pa,f6 as va,f7 as ha,cL as xa,cF as ba,df as wa,f8 as ya,f9 as ka}from"./vendor-DTjPma1U.js";import{N as ut,a as ct,V as gt,m as ft,E as mt,i as Ca,b as za,c as Ta,d as Aa,T as Ma,C as Sa,H as La,L as $a,e as _a,f as Ea,g as Ra,h as Ha,M as Ia,j as Va,u as Da,k as Pa}from"./vendor-tiptap-CWuLaYAE.js";import{_ as Ua}from"./Progress.vue_vue_type_script_setup_true_lang-C4cUO6LH.js";import{_ as Ne}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{M as Ba}from"./MermaidExtension-DGYp9fUY.js";import{_ as p}from"./index-mwxrBKxi.js";import{_ as ie}from"./Input.vue_vue_type_script_setup_true_lang-DAeY8mMm.js";import{_ as Le,a as $e}from"./DialogContent.vue_vue_type_script_setup_true_lang-3pmUscSv.js";import{_ as _e}from"./DialogDescription.vue_vue_type_script_setup_true_lang-krf9iH0t.js";import{_ as Ee}from"./DialogFooter.vue_vue_type_script_setup_true_lang-Djbi9e8D.js";import{_ as Re,a as He}from"./DialogTitle.vue_vue_type_script_setup_true_lang-DT1UgW8j.js";import{_ as me}from"./Label.vue_vue_type_script_setup_true_lang-D84UGLqY.js";import{_ as Qe,a as Je,c as N,d as Se,e as Ze}from"./Sonner.vue_vue_type_script_setup_true_lang-D0ynKKgD.js";const Oa={class:"space-y-2"},Fa={class:"font-semibold text-sm"},Wa={key:0,class:"text-xs text-gray-600 dark:text-gray-300"},Na={class:"flex items-center space-x-2 text-xs"},qa={key:0,class:"text-gray-500"},ja={key:1,class:"text-xs text-blue-600 dark:text-blue-400"},Xa={class:"flex space-x-2 pt-2 border-t"},Ga=We({__name:"CitationNodeView",props:{node:{type:Object,required:!0},editor:{type:Object,required:!0},getPos:{type:Function,required:!0},updateAttributes:{type:Function,required:!0}},emits:["verify","edit","remove"],setup(d,{emit:o}){const g=d,k=o,f=h(!1),T=h({top:"0px",left:"0px"}),U=B(()=>g.node.attrs.text||"[Citation]"),C=B(()=>g.node.attrs.verified===!1&&g.node.attrs.confidence<.8),M=B(()=>({"citation-verified":g.node.attrs.verified,"citation-unverified":C.value,"citation-pending":!g.node.attrs.verified&&!C.value})),S=B(()=>g.node.attrs.verified?"bg-green-100 dark:bg-green-900 text-green-800 dark:text-green-200 border border-green-300 dark:border-green-700":C.value?"bg-red-100 dark:bg-red-900 text-red-800 dark:text-red-200 border border-red-300 dark:border-red-700":"bg-yellow-100 dark:bg-yellow-900 text-yellow-800 dark:text-yellow-200 border border-yellow-300 dark:border-yellow-700"),O=B(()=>g.node.attrs.verified?"text-green-600 dark:text-green-400":C.value?"text-red-600 dark:text-red-400":"text-yellow-600 dark:text-yellow-400"),F=B(()=>g.node.attrs.verified?"Verified":C.value?"Needs Review":"Pending"),G=B(()=>g.node.attrs.verified?"bg-green-100 dark:bg-green-900 text-green-800 dark:text-green-200":C.value?"bg-red-100 dark:bg-red-900 text-red-800 dark:text-red-200":"bg-yellow-100 dark:bg-yellow-900 text-yellow-800 dark:text-yellow-200"),W=y=>{if(y.stopPropagation(),f.value)$();else{const ue=y.target.getBoundingClientRect();T.value={top:`${ue.height+5}px`,left:"0px"},f.value=!0}},$=()=>{f.value=!1},ae=async()=>{try{const y=await axios.post("/api/citations/verify",{citation_id:g.node.attrs.id,citation_text:g.node.attrs.text});y.data.verified&&g.updateAttributes({verified:!0,confidence:y.data.confidence,data:y.data.citation,doi:y.data.citation.doi}),k("verify",y.data),$()}catch(y){console.error("Failed to verify citation:",y)}},Y=()=>{k("edit",{id:g.node.attrs.id,text:g.node.attrs.text,attributes:g.node.attrs}),$()},n=()=>{if(confirm("Are you sure you want to remove this citation?")){const y=g.getPos();g.editor.commands.deleteRange({from:y,to:y+1}),k("remove",g.node.attrs.id)}$()},re=y=>{y.key==="Enter"||y.key===" "?(y.preventDefault(),W(y)):y.key==="Escape"&&$()};return Oe(()=>{document.addEventListener("keydown",re)}),Ft(()=>{document.removeEventListener("keydown",re)}),(y,ue)=>(z(),de(t(ut),{class:w(["citation-node inline-block relative cursor-pointer",M.value]),onClick:W},{default:i(()=>[u("span",{class:w(["citation-text px-2 py-1 rounded text-sm font-medium transition-all duration-200",S.value])},V(U.value),3),u("span",{class:w(["verification-indicator ml-1",O.value])},[d.node.attrs.verified?(z(),de(t(Wt),{key:0,class:"w-3 h-3"})):C.value?(z(),de(t(Nt),{key:1,class:"w-3 h-3"})):(z(),de(t(qt),{key:2,class:"w-3 h-3"}))],2),f.value?(z(),I("div",{key:0,class:"citation-popover absolute z-50 mt-2 p-4 bg-white dark:bg-gray-800 rounded-lg shadow-lg border max-w-sm",style:pe(T.value)},[u("div",Oa,[u("div",Fa,V(d.node.attrs.text||"[Citation]"),1),d.node.attrs.data&&d.node.attrs.data.title?(z(),I("div",Wa,V(d.node.attrs.data.title),1)):P("",!0),u("div",Na,[u("span",{class:w(["px-2 py-1 rounded",G.value])},V(F.value),3),d.node.attrs.confidence?(z(),I("span",qa,V(Math.round(d.node.attrs.confidence*100))+"% confidence ",1)):P("",!0)]),d.node.attrs.doi?(z(),I("div",ja," DOI: "+V(d.node.attrs.doi),1)):P("",!0),u("div",Xa,[d.node.attrs.verified?P("",!0):(z(),I("button",{key:0,onClick:ae,class:"text-xs px-2 py-1 bg-blue-600 text-white rounded hover:bg-blue-700"}," Verify ")),u("button",{onClick:Y,class:"text-xs px-2 py-1 bg-gray-600 text-white rounded hover:bg-gray-700"}," Edit "),u("button",{onClick:n,class:"text-xs px-2 py-1 bg-red-600 text-white rounded hover:bg-red-700"}," Remove ")])])],4)):P("",!0),f.value?(z(),I("div",{key:1,class:"fixed inset-0 z-40",onClick:$})):P("",!0)]),_:1},8,["class"]))}}),Ya=Ne(Ga,[["__scopeId","data-v-4fc4981e"]]),Ka=ct.create({name:"citation",group:"inline",inline:!0,atom:!0,addAttributes(){return{id:{default:null},text:{default:""},verified:{default:!1},confidence:{default:0},format:{default:"apa"},doi:{default:null},data:{default:{}}}},parseHTML(){return[{tag:"span[data-citation]"}]},renderHTML({HTMLAttributes:d}){return["span",ft(d,{"data-citation":""})]},addNodeView(){return gt(Ya)},addCommands(){return{insertCitation:d=>({commands:o})=>o.insertContent({type:this.name,attrs:d}),updateCitation:(d,o)=>({state:g,dispatch:k})=>{const{doc:f,tr:T}=g;let U=!1;return f.descendants((C,M)=>{if(C.type.name===this.name&&C.attrs.id===d)return T.setNodeMarkup(M,null,{...C.attrs,...o}),U=!0,!1}),U?(k(T),!0):!1}}},addKeyboardShortcuts(){return{"Mod-Shift-c":()=>this.editor.commands.insertCitation({text:"[Citation]",verified:!1})}}}),Qa={class:"text-muted-foreground text-xs mt-1 truncate max-w-full"},Ja=["src","alt","title"],Za={key:2,class:"mt-2 w-full"},er={key:3,class:"mt-2 text-center text-sm text-muted-foreground italic"},tr={key:5,class:"absolute -top-12 left-1/2 -translate-x-1/2 flex items-center gap-1.5 px-3 py-1.5 bg-background/95 backdrop-blur-md rounded-lg border border-border shadow-lg z-10 min-w-max"},ar={class:"text-xs text-muted-foreground whitespace-nowrap"},rr={class:"grid gap-4 py-4"},nr={class:"grid gap-2"},sr={class:"grid gap-2"},or=We({__name:"ImageNodeView",props:{node:{},updateAttributes:{type:Function},deleteNode:{type:Function},selected:{type:Boolean},editor:{}},setup(d){const o=d,g=h(null),k=h(null),f=h(!1),T=h(null),U=h(0),C=h(0),M=h(0),S=h(0),O=h(o.node.attrs.width||400),F=h(o.node.attrs.height||300),G=h(!0),W=h(!1),$=h(!1),ae=h(""),Y=h(""),n=h(o.node.attrs.caption||""),re=B(()=>{switch(o.node.attrs.alignment){case"left":return"mr-auto";case"right":return"ml-auto";default:return"mx-auto"}}),y=B(()=>({width:`${O.value}px`,height:`${F.value}px`,maxWidth:"100%"})),ue=()=>{if(G.value=!1,W.value=!1,g.value&&!o.node.attrs.width){const m=g.value.naturalWidth,s=g.value.naturalHeight,c=600;if(m>c){const q=c/m;O.value=c,F.value=Math.round(s*q)}else O.value=m,F.value=s;o.updateAttributes({width:O.value,height:F.value,aspectRatio:m/s})}},ve=()=>{G.value=!1,W.value=!0},L=(m,s)=>{if(!o.selected)return;s.preventDefault(),s.stopPropagation(),f.value=!0,T.value=m;const c="touches"in s?s.touches[0].clientX:s.clientX,q="touches"in s?s.touches[0].clientY:s.clientY;U.value=c,C.value=q,M.value=O.value,S.value=F.value,document.addEventListener("mousemove",K),document.addEventListener("mouseup",Q),document.addEventListener("touchmove",K),document.addEventListener("touchend",Q)},K=m=>{if(!f.value)return;const s="touches"in m?m.touches[0].clientX:m.clientX,c="touches"in m?m.touches[0].clientY:m.clientY,q=s-U.value,J=c-C.value,Z=o.node.attrs.aspectRatio||M.value/S.value,ne=T.value;let X=M.value,ee=S.value;ne?.includes("e")&&(X=Math.max(100,M.value+q)),ne?.includes("w")&&(X=Math.max(100,M.value-q)),ne?.includes("s")&&(ee=Math.max(100,S.value+J)),ne?.includes("n")&&(ee=Math.max(100,S.value-J)),ne?.length===2&&(Math.abs(q)>Math.abs(J)?ee=Math.round(X/Z):X=Math.round(ee*Z));const Ce=800;X>Ce&&(X=Ce,ee=Math.round(X/Z)),O.value=X,F.value=ee},Q=()=>{f.value&&(f.value=!1,T.value=null,o.updateAttributes({width:O.value,height:F.value}),document.removeEventListener("mousemove",K),document.removeEventListener("mouseup",Q),document.removeEventListener("touchmove",K),document.removeEventListener("touchend",Q))},he=m=>{o.updateAttributes({alignment:m})},Ie=()=>{ae.value=o.node.attrs.alt||"",Y.value=o.node.attrs.title||"",$.value=!0},Ve=()=>{o.updateAttributes({alt:ae.value,title:Y.value}),$.value=!1},ke=()=>{o.updateAttributes({caption:n.value})},De=async()=>{const m=o.node.attrs.src;if(m&&m.startsWith("/storage/"))try{await lt.delete("/editor/images",{data:{url:m}})}catch(s){console.warn("Failed to delete image from storage:",s)}o.deleteNode()};return le(()=>o.node.attrs.caption,m=>{m!==n.value&&(n.value=m||"")}),le(()=>[o.node.attrs.width,o.node.attrs.height],([m,s])=>{m&&!f.value&&(O.value=m),s&&!f.value&&(F.value=s)},{immediate:!0}),tt(()=>{document.removeEventListener("mousemove",K),document.removeEventListener("mouseup",Q),document.removeEventListener("touchmove",K),document.removeEventListener("touchend",Q)}),(m,s)=>(z(),de(t(ut),{class:"resizable-image-wrapper my-4"},{default:i(()=>[u("figure",{ref_key:"containerRef",ref:k,class:w(["relative inline-block",[re.value,{"ring-2 ring-primary ring-offset-2":m.selected}]])},[G.value?(z(),I("div",{key:0,class:"flex items-center justify-center bg-muted/50 rounded-lg",style:pe(y.value)},[a(t(jt),{class:"w-8 h-8 animate-spin text-muted-foreground"})],4)):W.value?(z(),I("div",{key:1,class:"flex flex-col items-center justify-center bg-destructive/10 border border-destructive/30 rounded-lg p-4",style:pe(y.value)},[s[24]||(s[24]=u("span",{class:"text-destructive text-sm"},"Failed to load image",-1)),u("span",Qa,V(m.node.attrs.src),1)],4)):P("",!0),Ke(u("img",{ref_key:"imageRef",ref:g,src:m.node.attrs.src,alt:m.node.attrs.alt,title:m.node.attrs.title,style:pe(y.value),class:w(["block rounded-lg object-contain",{"cursor-move":m.selected}]),onLoad:ue,onError:ve,draggable:"false"},null,46,Ja),[[Xt,!G.value&&!W.value]]),m.selected&&!W.value?(z(),I("div",Za,[Ke(u("input",{"onUpdate:modelValue":s[0]||(s[0]=c=>n.value=c),type:"text",placeholder:"Add a caption...",class:"w-full text-center text-sm text-muted-foreground bg-transparent border-none focus:outline-none focus:ring-0 placeholder:text-muted-foreground/50",onBlur:ke,onKeydown:at(ke,["enter"])},null,544),[[Gt,n.value]])])):m.node.attrs.caption&&!W.value?(z(),I("figcaption",er,V(m.node.attrs.caption),1)):P("",!0),m.selected&&!W.value&&!G.value?(z(),I(Fe,{key:4},[u("div",{class:"absolute -top-1.5 -left-1.5 w-3 h-3 bg-primary border-2 border-background rounded-full cursor-nw-resize z-20 hover:scale-125 transition-transform",onMousedown:s[1]||(s[1]=c=>L("nw",c)),onTouchstart:s[2]||(s[2]=c=>L("nw",c))},null,32),u("div",{class:"absolute -top-1.5 -right-1.5 w-3 h-3 bg-primary border-2 border-background rounded-full cursor-ne-resize z-20 hover:scale-125 transition-transform",onMousedown:s[3]||(s[3]=c=>L("ne",c)),onTouchstart:s[4]||(s[4]=c=>L("ne",c))},null,32),u("div",{class:"absolute -bottom-1.5 -left-1.5 w-3 h-3 bg-primary border-2 border-background rounded-full cursor-sw-resize z-20 hover:scale-125 transition-transform",onMousedown:s[5]||(s[5]=c=>L("sw",c)),onTouchstart:s[6]||(s[6]=c=>L("sw",c))},null,32),u("div",{class:"absolute -bottom-1.5 -right-1.5 w-3 h-3 bg-primary border-2 border-background rounded-full cursor-se-resize z-20 hover:scale-125 transition-transform",onMousedown:s[7]||(s[7]=c=>L("se",c)),onTouchstart:s[8]||(s[8]=c=>L("se",c))},null,32),u("div",{class:"absolute top-1/2 -left-1.5 w-3 h-3 bg-primary border-2 border-background rounded-full cursor-w-resize z-20 -translate-y-1/2 hover:scale-125 transition-transform",onMousedown:s[9]||(s[9]=c=>L("w",c)),onTouchstart:s[10]||(s[10]=c=>L("w",c))},null,32),u("div",{class:"absolute top-1/2 -right-1.5 w-3 h-3 bg-primary border-2 border-background rounded-full cursor-e-resize z-20 -translate-y-1/2 hover:scale-125 transition-transform",onMousedown:s[11]||(s[11]=c=>L("e",c)),onTouchstart:s[12]||(s[12]=c=>L("e",c))},null,32),u("div",{class:"absolute -top-1.5 left-1/2 w-3 h-3 bg-primary border-2 border-background rounded-full cursor-n-resize z-20 -translate-x-1/2 hover:scale-125 transition-transform",onMousedown:s[13]||(s[13]=c=>L("n",c)),onTouchstart:s[14]||(s[14]=c=>L("n",c))},null,32),u("div",{class:"absolute -bottom-1.5 left-1/2 w-3 h-3 bg-primary border-2 border-background rounded-full cursor-s-resize z-20 -translate-x-1/2 hover:scale-125 transition-transform",onMousedown:s[15]||(s[15]=c=>L("s",c)),onTouchstart:s[16]||(s[16]=c=>L("s",c))},null,32)],64)):P("",!0),m.selected?(z(),I("div",tr,[W.value?P("",!0):(z(),I(Fe,{key:0},[a(t(p),{variant:"ghost",size:"sm",class:w(["h-7 w-7 p-0",{"bg-primary/10 text-primary":m.node.attrs.alignment==="left"}]),onClick:s[17]||(s[17]=c=>he("left"))},{default:i(()=>[a(t(rt),{class:"w-4 h-4"})]),_:1},8,["class"]),a(t(p),{variant:"ghost",size:"sm",class:w(["h-7 w-7 p-0",{"bg-primary/10 text-primary":m.node.attrs.alignment==="center"}]),onClick:s[18]||(s[18]=c=>he("center"))},{default:i(()=>[a(t(nt),{class:"w-4 h-4"})]),_:1},8,["class"]),a(t(p),{variant:"ghost",size:"sm",class:w(["h-7 w-7 p-0",{"bg-primary/10 text-primary":m.node.attrs.alignment==="right"}]),onClick:s[19]||(s[19]=c=>he("right"))},{default:i(()=>[a(t(st),{class:"w-4 h-4"})]),_:1},8,["class"]),s[26]||(s[26]=u("div",{class:"w-px h-5 bg-border mx-1"},null,-1)),a(t(p),{variant:"ghost",size:"sm",class:"h-7 px-2 text-xs gap-1",onClick:Ie},{default:i(()=>[a(t(ot),{class:"w-3 h-3"}),s[25]||(s[25]=b(" Alt ",-1))]),_:1}),s[27]||(s[27]=u("div",{class:"w-px h-5 bg-border mx-1"},null,-1)),u("span",ar,V(Math.round(O.value))+" x "+V(Math.round(F.value)),1),s[28]||(s[28]=u("div",{class:"w-px h-5 bg-border mx-1"},null,-1))],64)),a(t(p),{variant:"ghost",size:"sm",class:"h-7 w-7 p-0 text-destructive hover:text-destructive",onClick:De},{default:i(()=>[a(t(Yt),{class:"w-4 h-4"})]),_:1})])):P("",!0)],2),a(t(Le),{open:$.value,"onUpdate:open":s[23]||(s[23]=c=>$.value=c)},{default:i(()=>[a(t($e),null,{default:i(()=>[a(t(Re),null,{default:i(()=>[a(t(He),null,{default:i(()=>[...s[29]||(s[29]=[b("Image Properties",-1)])]),_:1}),a(t(_e),null,{default:i(()=>[...s[30]||(s[30]=[b("Edit the alt text and title for this image.",-1)])]),_:1})]),_:1}),u("div",rr,[u("div",nr,[a(t(me),{for:"alt-text"},{default:i(()=>[...s[31]||(s[31]=[b("Alt Text",-1)])]),_:1}),a(t(ie),{id:"alt-text",modelValue:ae.value,"onUpdate:modelValue":s[20]||(s[20]=c=>ae.value=c),placeholder:"Describe this image for accessibility..."},null,8,["modelValue"]),s[32]||(s[32]=u("p",{class:"text-xs text-muted-foreground"}," Alt text helps screen readers describe the image to visually impaired users. ",-1))]),u("div",sr,[a(t(me),{for:"title-text"},{default:i(()=>[...s[33]||(s[33]=[b("Title",-1)])]),_:1}),a(t(ie),{id:"title-text",modelValue:Y.value,"onUpdate:modelValue":s[21]||(s[21]=c=>Y.value=c),placeholder:"Optional title shown on hover..."},null,8,["modelValue"])])]),a(t(Ee),null,{default:i(()=>[a(t(p),{variant:"outline",onClick:s[22]||(s[22]=c=>$.value=!1)},{default:i(()=>[...s[34]||(s[34]=[b("Cancel",-1)])]),_:1}),a(t(p),{onClick:Ve},{default:i(()=>[...s[35]||(s[35]=[b("Save",-1)])]),_:1})]),_:1})]),_:1})]),_:1},8,["open"])]),_:1}))}}),lr=Ne(or,[["__scopeId","data-v-bc29ad5b"]]),ir=ct.create({name:"resizableImage",group:"block",atom:!0,draggable:!0,addOptions(){return{HTMLAttributes:{class:"resizable-image-block"},maxWidth:800}},addAttributes(){return{src:{default:null,parseHTML:d=>d.querySelector("img")?.getAttribute("src")||d.getAttribute("src")},alt:{default:"",parseHTML:d=>d.querySelector("img")?.getAttribute("alt")||d.getAttribute("alt")||""},title:{default:"",parseHTML:d=>d.querySelector("img")?.getAttribute("title")||d.getAttribute("title")||""},width:{default:null,parseHTML:d=>{const g=d.querySelector("img")?.getAttribute("width")||d.getAttribute("data-width");return g?parseInt(g,10):null}},height:{default:null,parseHTML:d=>{const g=d.querySelector("img")?.getAttribute("height")||d.getAttribute("data-height");return g?parseInt(g,10):null}},alignment:{default:"center",parseHTML:d=>d.getAttribute("data-alignment")||"center"},aspectRatio:{default:null,parseHTML:d=>{const o=d.getAttribute("data-aspect-ratio");return o?parseFloat(o):null}},caption:{default:"",parseHTML:d=>d.querySelector("figcaption")?.textContent||d.getAttribute("data-caption")||""}}},parseHTML(){return[{tag:"figure[data-resizable-image]"},{tag:"div[data-resizable-image]"},{tag:"img[src]",getAttrs:d=>{if(typeof d=="string")return!1;const o=d;return{src:o.getAttribute("src"),alt:o.getAttribute("alt"),title:o.getAttribute("title"),width:o.getAttribute("width")?parseInt(o.getAttribute("width"),10):null,height:o.getAttribute("height")?parseInt(o.getAttribute("height"),10):null}}}]},renderHTML({HTMLAttributes:d,node:o}){const g=ft(this.options.HTMLAttributes,{"data-resizable-image":"","data-alignment":o.attrs.alignment,"data-width":o.attrs.width,"data-height":o.attrs.height,"data-aspect-ratio":o.attrs.aspectRatio,"data-caption":o.attrs.caption||""}),k={src:d.src||o.attrs.src,alt:o.attrs.alt||"",title:o.attrs.title||""};o.attrs.width&&(k.width=o.attrs.width),o.attrs.height&&(k.height=o.attrs.height);const f=[["img",k]];return o.attrs.caption&&f.push(["figcaption",{},o.attrs.caption]),["figure",g,...f]},addNodeView(){return gt(lr)},addCommands(){return{setImage:d=>({commands:o})=>o.insertContent({type:this.name,attrs:{src:d.src,alt:d.alt||"",title:d.title||"",width:d.width||null,height:d.height||null,caption:d.caption||"",aspectRatio:d.width&&d.height?d.width/d.height:null}}),updateImageSize:d=>({commands:o})=>o.updateAttributes(this.name,{width:d.width,height:d.height}),setImageAlignment:d=>({commands:o})=>o.updateAttributes(this.name,{alignment:d})}},addProseMirrorPlugins(){return[new it({key:new dt("resizableImageDropPaste"),props:{handleDrop:(d,o,g,k)=>{if(k||!o.dataTransfer?.files?.length)return!1;const f=o.dataTransfer.files[0];return f.type.startsWith("image/")?(o.preventDefault(),document.dispatchEvent(new CustomEvent("tiptap-image-drop",{detail:{file:f,view:d,pos:d.posAtCoords({left:o.clientX,top:o.clientY})}})),!0):!1},handlePaste:(d,o)=>{const g=o.clipboardData?.items;if(!g)return!1;for(const k of g)if(k.type.startsWith("image/")){o.preventDefault();const f=k.getAsFile();return f&&document.dispatchEvent(new CustomEvent("tiptap-image-paste",{detail:{file:f,view:d}})),!0}return!1}}})]}}),te=new dt("ghostText"),dr=mt.create({name:"ghostText",addOptions(){return{onManualTrigger:null,onAccepted:null,onDismissed:null}},addCommands(){return{setGhostText:({text:d,position:o,format:g})=>({tr:k,state:f,dispatch:T})=>{const U=typeof o=="number"?o:f.selection.to;return k.setMeta(te,{type:"set",text:d,format:g??"text",position:U}),T?.(k),!0},clearGhostText:()=>({tr:d,dispatch:o})=>(d.setMeta(te,{type:"clear"}),o?.(d),!0)}},addKeyboardShortcuts(){return{Tab:()=>{const d=te.getState(this.editor.state);if(!d?.isVisible||!d.text||!this.editor.state.selection.empty)return!1;const o=d.position,g=d.text;return this.editor.chain().focus().insertContentAt({from:o,to:o},g).command(({tr:k,dispatch:f})=>(k.setMeta(te,{type:"clear"}),f?.(k),!0)).run(),this.options.onAccepted?.(g),!0},Escape:()=>te.getState(this.editor.state)?.isVisible?(this.editor.commands.clearGhostText(),this.options.onDismissed?.(),!0):!1,"Mod-Space":()=>(this.options.onManualTrigger?.(),!0)}},addProseMirrorPlugins(){return[new it({key:te,state:{init:()=>({text:null,format:"text",position:0,isVisible:!1}),apply:(d,o)=>{const g=d.getMeta(te);return g?.type==="clear"?{text:null,format:"text",position:0,isVisible:!1}:g?.type==="set"?{text:g.text,format:g.format,position:g.position,isVisible:!0}:d.docChanged?(o.isVisible&&this.options.onDismissed?.(),{text:null,format:"text",position:0,isVisible:!1}):d.selectionSet&&o.isVisible?(this.options.onDismissed?.(),{text:null,format:"text",position:0,isVisible:!1}):o}},props:{decorations:d=>{const o=te.getState(d);if(!o?.isVisible||!o.text)return null;const g=Math.min(Math.max(0,o.position),d.doc.content.size),k=Kt.widget(g,()=>{const f=document.createElement("span");if(f.className="tiptap-ghost-text",o.format==="html"&&o.text.includes("<")){const T=document.createElement("div");T.innerHTML=o.text,f.textContent=(T.textContent||"").trim()}else f.textContent=o.text??"";return f},{side:1});return Qt.create(d.doc,[k])}}})]}}),ur={class:"relative flex flex-col w-full h-full group bg-background"},cr={class:"flex items-center gap-0.5 border-r border-border/40 pr-1.5 mr-1.5 flex-shrink-0"},gr={class:"flex items-center gap-0.5 border-r border-border/40 pr-1.5 mr-1.5 flex-shrink-0"},fr={class:"text-xs text-zinc-700 dark:text-zinc-100"},mr={class:"flex items-center gap-0.5"},pr={class:"flex h-8 w-9 items-center justify-center border-y border-border/20 bg-muted/20 text-xs font-medium text-foreground"},vr={class:"flex items-center gap-0.5 border-r border-border/40 pr-1.5 mr-1.5 flex-shrink-0"},hr={class:"flex items-center gap-0.5 border-r border-border/40 pr-1.5 mr-1.5 flex-shrink-0"},xr={class:"flex items-center gap-0.5 border-l border-border/20 ml-0.5 pl-0.5"},br={class:"flex items-center gap-0.5 flex-shrink-0"},wr={class:"relative flex-1 min-h-0"},yr={key:0,class:"absolute top-4 left-1/2 -translate-x-1/2 z-20 pointer-events-none"},kr={class:"flex items-center gap-3 pl-3 pr-4 py-2 bg-indigo-950/90 text-white dark:bg-indigo-500/10 dark:text-indigo-100 dark:border-indigo-400/20 backdrop-blur-md border border-indigo-200/20 rounded-full shadow-[0_8px_32px_rgba(79,70,229,0.25)] pointer-events-auto ring-1 ring-white/10"},Cr={class:"relative flex items-center justify-center w-5 h-5"},zr={class:"flex flex-col gap-0.5 min-w-[140px]"},Tr={class:"flex items-center justify-between gap-4"},Ar={class:"text-[11px] font-semibold tracking-wide uppercase text-indigo-100/90 dark:text-indigo-200"},Mr={class:"text-[10px] font-mono tabular-nums opacity-80"},Sr={class:"h-1 w-full bg-indigo-900/50 dark:bg-indigo-950/50 rounded-full overflow-hidden"},Lr={class:"flex flex-col items-end"},$r={class:"text-xs font-bold font-mono tracking-tight leading-none text-white dark:text-indigo-50"},_r={class:"grid gap-4 py-4"},Er={class:"grid gap-2"},Rr={class:"grid gap-2"},Hr={class:"grid gap-4 py-4"},Ir={class:"flex items-center gap-4"},Vr={class:"flex flex-wrap gap-2"},Dr=["onClick"],Pr={class:"grid gap-4 py-4"},Ur={class:"grid gap-2"},Br={class:"flex items-center gap-2"},Or={key:1,class:"text-sm text-destructive"},Fr={class:"grid gap-2"},Wr={class:"flex gap-2"},et=100,Nr=We({__name:"RichTextEditor",props:{modelValue:{},placeholder:{default:"Start writing..."},readonly:{type:Boolean,default:!1},minHeight:{default:"200px"},showToolbar:{type:Boolean,default:!0},toolbarTeleportTarget:{default:""},isGenerating:{type:Boolean,default:!1},generationProgress:{default:""},generationPercentage:{default:0},generationPhase:{default:""},streamingMode:{type:Boolean,default:!1},ghostText:{default:null},ghostTextFormat:{default:"text"},ghostTextPosition:{default:null}},emits:["update:modelValue","update:selectedText","update:selectionRange","ghost-manual-trigger","ghost-accepted","ghost-dismissed"],setup(d,{expose:o,emit:g}){const k=Jt(ka),f=d,T=h(!1),U=h(0),C=h(""),M=h(null),S=g,O=mt.create({name:"fontSize",addOptions(){return{types:["textStyle"]}},addGlobalAttributes(){return[{types:this.options.types,attributes:{fontSize:{default:null,parseHTML:r=>{const e=r.style.fontSize;return e||null},renderHTML:r=>r.fontSize?{style:`font-size: ${r.fontSize}`}:{}}}}]},addCommands(){return{setFontSize:r=>({chain:e})=>e().setMark("textStyle",{fontSize:r}).run(),unsetFontSize:()=>({chain:r})=>r().setMark("textStyle",{fontSize:null}).removeEmptyTextStyle().run()}}}),F=r=>{if(!r)return"";const e=r.split(`
`);let l=[],v=0;for(;v<e.length;){const _=e[v];if(_.includes("|")){const E=G(e,v);if(E.html){l.push(E.html),v=E.nextIndex;continue}}l.push(_),v++}return l.join(`
`)},G=(r,e)=>{let l=r[e];if(!l||!l.includes("|"))return{html:null,nextIndex:e+1};const v=l.split("|").map(R=>R.trim()).filter(R=>R.length>0);if(v.length===0)return{html:null,nextIndex:e+1};const _=r[e+1];if(!_||!_.includes("|")||!_.includes("-"))return{html:null,nextIndex:e+1};let E=[],x=e+2;for(;x<r.length;){const R=r[x];if(!R||!R.includes("|"))break;const D=R.split("|").map(H=>H.trim()).filter(H=>H.length>0);D.length>0&&E.push(D),x++}let A='<div class="tableWrapper"><table>';return A+="<thead><tr>",v.forEach(R=>{A+=`<th>${R}</th>`}),A+="</tr></thead>",E.length>0&&(A+="<tbody>",E.forEach(R=>{A+="<tr>";for(let D=0;D<v.length;D++){const H=R[D]||"";A+=`<td>${H}</td>`}A+="</tr>"}),A+="</tbody>"),A+="</table></div>",{html:A,nextIndex:x}},W=r=>r?(r=r.replace(/```(\w+)\n?([\s\S]*?)```/g,(e,l,v)=>`<pre><code class="language-${l}">${v.trim()}</code></pre>`),r=r.replace(/```\n?([\s\S]*?)```/g,(e,l)=>`<pre><code>${l.trim()}</code></pre>`),r):"",$=r=>{if(!r)return"";if(r.includes("<p>")||r.includes("<h1>")||r.includes("<h2>")||r.includes("<div>")||r.includes("<div "))return r;let e=r;const l=[];e=e.replace(/```mermaid\n?([\s\S]*?)```/g,(E,x)=>{const A=x.trim(),D=`<div data-mermaid data-mermaid-code="${A.replace(/&/g,"&amp;").replace(/"/g,"&quot;").replace(/</g,"&lt;").replace(/>/g,"&gt;")}" data-view-mode="diagram"><pre><code class="language-mermaid">${A}</code></pre></div>`,H=l.length;return l.push(D),`__MERMAID_PLACEHOLDER_${H}__`}),e=e.replace(/``mermaid\n?([\s\S]*?)``/g,(E,x)=>{const A=x.trim(),D=`<div data-mermaid data-mermaid-code="${A.replace(/&/g,"&amp;").replace(/"/g,"&quot;").replace(/</g,"&lt;").replace(/>/g,"&gt;")}" data-view-mode="diagram"><pre><code class="language-mermaid">${A}</code></pre></div>`,H=l.length;return l.push(D),`__MERMAID_PLACEHOLDER_${H}__`}),e=e.replace(/`mermaid\n([\s\S]*?)`/g,(E,x)=>{const A=x.trim(),D=`<div data-mermaid data-mermaid-code="${A.replace(/&/g,"&amp;").replace(/"/g,"&quot;").replace(/</g,"&lt;").replace(/>/g,"&gt;")}" data-view-mode="diagram"><pre><code class="language-mermaid">${A}</code></pre></div>`,H=l.length;return l.push(D),`__MERMAID_PLACEHOLDER_${H}__`}),e=W(e),e=e.replace(/^### (.*$)/gim,"<h3>$1</h3>"),e=e.replace(/^## (.*$)/gim,"<h2>$1</h2>"),e=e.replace(/^# (.*$)/gim,"<h1>$1</h1>"),e=e.replace(/\*\*(.*?)\*\*/g,"<strong>$1</strong>"),e=e.replace(/\*(.*?)\*/g,"<em>$1</em>"),e=e.replace(/`([^`]+)`/g,"<code>$1</code>"),e=F(e);let _=e.split(`

`).filter(E=>E.trim()).map(E=>{const x=E.trim();if(x.startsWith("<h1>")||x.startsWith("<h2>")||x.startsWith("<h3>")||x.startsWith("<div")||x.startsWith("<table")||x.startsWith("<pre")||x.startsWith("<ul")||x.startsWith("<ol")||x.startsWith("<blockquote")||x.startsWith("__MERMAID_PLACEHOLDER_"))return x;if(x.includes(`
`)&&(x.match(/^\d+\./)||x.match(/^-\s/)||x.match(/^\*\s/))){const R=x.split(`
`).map(D=>{const H=D.trim();return H.match(/^\d+\.\s/)?`<li>${H.replace(/^\d+\.\s/,"")}</li>`:H.match(/^[-*]\s/)?`<li>${H.replace(/^[-*]\s/,"")}</li>`:H}).filter(D=>D.startsWith("<li>"));return x.match(/^\d+\./)?`<ol>${R.join("")}</ol>`:`<ul>${R.join("")}</ul>`}return`<p>${x.replace(/\n/g,"<br>")}</p>`}).join("");return l.forEach((E,x)=>{_=_.replace(`__MERMAID_PLACEHOLDER_${x}__`,E)}),_},Y=[Ca.configure({heading:{levels:[1,2,3]},codeBlock:!1,link:!1}),za.configure({lowlight:k,HTMLAttributes:{class:"code-block-highlighted"}}),Ta.configure({placeholder:f.placeholder}),Aa,Ma,O,Sa,La.configure({multicolor:!0}),$a.configure({openOnClick:!1,HTMLAttributes:{class:"prose-link text-primary hover:text-primary/80 underline decoration-primary/50"}}),_a.configure({resizable:!0}),Ea,Ra,Ha,Ia.configure({inlineOptions:{onClick:(r,e)=>{const l=n.value;if(!l)return;const v=window.prompt("Edit inline math (LaTeX):",r.attrs.latex);v&&l.chain().setNodeSelection(e).updateInlineMath({latex:v}).focus().run()}},blockOptions:{onClick:(r,e)=>{const l=n.value;if(!l)return;const v=window.prompt("Edit block math (LaTeX):",r.attrs.latex);v&&l.chain().setNodeSelection(e).updateBlockMath({latex:v}).focus().run()}},katexOptions:{throwOnError:!1}}),Ka,Ba,ir.configure({maxWidth:800}),Va.configure({types:["heading","paragraph"]}),dr.configure({onManualTrigger:()=>S("ghost-manual-trigger"),onAccepted:r=>S("ghost-accepted",r),onDismissed:()=>S("ghost-dismissed")})].filter((r,e,l)=>e===l.findIndex(v=>v.name===r.name)),n=Da({content:$(f.modelValue),editable:!f.readonly,extensions:Y,editorProps:{attributes:{class:"prose prose-sm dark:prose-invert max-w-none focus:outline-none",style:`min-height: ${f.minHeight}; padding: 12px;`}},onUpdate:({editor:r})=>{S("update:modelValue",r.getHTML()),ye()},onSelectionUpdate:({editor:r})=>{ye();const{from:e,to:l,empty:v}=r.state.selection;if(v)S("update:selectedText",""),S("update:selectionRange",null),console.log("ðŸ”„ RichTextEditor - No selection, cleared");else{if(!r.state.doc)return;const _=r.state.doc.textBetween(e,l);_.split(/\s+/).filter(x=>x.length>0).length<=200?(S("update:selectedText",_),S("update:selectionRange",{from:e,to:l}),console.log("âœ… RichTextEditor - Selection emitted to parent")):(S("update:selectedText",""),S("update:selectionRange",null),console.log("âŒ RichTextEditor - Selection too long, cleared"))}}});le(()=>f.modelValue,r=>{if(n.value){if(f.streamingMode&&T.value){ue(r);return}if(n.value.getHTML()!==r){const e=$(r);n.value.commands.setContent(e,{emitUpdate:!1}),Be(()=>{n.value&&S("update:modelValue",n.value.getHTML())})}}}),le([()=>f.ghostText,()=>f.ghostTextFormat,()=>f.ghostTextPosition],([r,e,l])=>{if(!n.value)return;const v=(r??"").toString();if(!v){n.value.commands.clearGhostText?.();return}n.value.commands.setGhostText?.({text:v,format:e??"text",position:typeof l=="number"?l:void 0})},{immediate:!0}),le(()=>f.streamingMode,r=>{r?re():y()});function re(){T.value=!0,U.value=0,C.value="",console.log("RichTextEditor: Streaming mode started (throttled)")}function y(){M.value&&(clearTimeout(M.value),M.value=null),C.value&&n.value&&ve(C.value),T.value=!1,C.value="",U.value=0,console.log("RichTextEditor: Streaming mode ended")}function ue(r){if(!n.value||!T.value)return;C.value=r;const l=Date.now()-U.value;if(l>=et){ve(r);return}if(!M.value){const v=et-l;M.value=setTimeout(()=>{M.value=null,T.value&&C.value&&ve(C.value)},v)}}function ve(r){if(!n.value)return;U.value=Date.now();const e=$(r);n.value.getHTML()!==e&&n.value.commands.setContent(e,{emitUpdate:!1})}function L(){if(!n.value)return;const r=C.value||f.modelValue,e=$(r);n.value.commands.setContent(e,{emitUpdate:!1})}function K(){const r=C.value||f.modelValue;return{length:r.length,wordCount:r.split(/\s+/).filter(e=>e.length>0).length}}le(()=>f.readonly,r=>{n.value&&n.value.setEditable(!r)}),Oe(()=>{setTimeout(()=>{n.value&&ye()},100),document.addEventListener("tiptap-image-drop",je),document.addEventListener("tiptap-image-paste",Xe)}),tt(()=>{M.value&&(clearTimeout(M.value),M.value=null),n.value&&n.value.destroy(),document.removeEventListener("tiptap-image-drop",je),document.removeEventListener("tiptap-image-paste",Xe),q()});const Q=()=>n.value?.chain().focus().toggleBold().run(),he=()=>n.value?.chain().focus().toggleItalic().run(),Ie=()=>n.value?.chain().focus().toggleStrike().run(),Ve=()=>n.value?.chain().focus().toggleCode().run(),ke=()=>{const r=n.value;if(!r)return;if(!r.state.selection.empty){r.chain().focus().setInlineMath().run();return}const e=window.prompt("Enter inline math (LaTeX):","");e&&r.chain().focus().insertInlineMath({latex:e}).run()},De=()=>{const r=n.value;if(!r)return;if(!r.state.selection.empty){r.chain().focus().setBlockMath().run();return}const e=window.prompt("Enter block math (LaTeX):","");e&&r.chain().focus().insertBlockMath({latex:e}).run()},m=()=>{n.value?.chain().focus().insertMermaid().run()},s=h(!1);let c=null;const q=()=>{c&&(c.disconnect(),c=null)},J=()=>{if(typeof document>"u"){s.value=!1;return}s.value=!!(f.toolbarTeleportTarget&&document.querySelector(f.toolbarTeleportTarget))};typeof document<"u"&&J();const Z=B(()=>!f.toolbarTeleportTarget||!s.value);B(()=>!Z.value);const ne=B(()=>Z.value?"body":f.toolbarTeleportTarget||"body"),X=B(()=>{const r="z-20 flex items-center gap-1 border-border/40 bg-background/95 p-1.5 shadow-sm backdrop-blur-md transition-all duration-200 supports-[backdrop-filter]:bg-background/80 overflow-x-auto no-scrollbar mask-gradient-right";return Z.value?`sticky top-0 mx-0 sm:mx-2 md:mx-4 mt-0 sm:mt-1 md:mt-2 mb-2 md:mb-4 rounded-none sm:rounded-lg md:rounded-xl border-y sm:border ${r}`:`w-full ${r} rounded-lg border`});le(()=>f.toolbarTeleportTarget,async()=>{await Be(),J()},{flush:"post"}),Oe(async()=>{await Be(),J(),!s.value&&f.toolbarTeleportTarget&&typeof MutationObserver<"u"&&typeof document<"u"&&document.body&&(q(),c=new MutationObserver(()=>{J(),s.value&&q()}),c.observe(document.body,{childList:!0,subtree:!0}))});const ee=()=>n.value?.chain().focus().toggleUnderline().run(),Ce=()=>n.value?.chain().focus().toggleHeading({level:1}).run(),pt=()=>n.value?.chain().focus().toggleHeading({level:2}).run(),vt=()=>n.value?.chain().focus().toggleHeading({level:3}).run(),ht=()=>n.value?.chain().focus().toggleBulletList().run(),xt=()=>n.value?.chain().focus().toggleOrderedList().run(),bt=()=>n.value?.chain().focus().toggleBlockquote().run(),wt=()=>n.value?.chain().focus().setParagraph().run(),yt=()=>n.value?.chain().focus().undo().run(),kt=()=>n.value?.chain().focus().redo().run(),xe=h(!1),ze=h(!1),j=h({url:"",text:""}),se=h({color:"#000000"}),Ct=()=>{const{from:r,to:e}=n.value?.state.selection||{from:0,to:0},l=n.value?.state.doc.textBetween(r,e)||"";n.value?.isActive("link")?n.value.chain().focus().unsetLink().run():(j.value.text=l,j.value.url="",xe.value=!0)},zt=()=>{if(j.value.url){if(j.value.text){const{from:r,to:e}=n.value?.state.selection||{from:0,to:0};n.value?.chain().focus().deleteRange({from:r,to:e}).insertContent(`<a href="${j.value.url}">${j.value.text}</a>`).run()}else n.value?.chain().focus().setLink({href:j.value.url}).run();xe.value=!1}},Tt=()=>{ze.value=!0},At=()=>{se.value.color&&n.value?.chain().focus().setColor(se.value.color).run(),ze.value=!1},Mt=()=>{n.value?.chain().focus().unsetColor().run()},ce=h(!1),ge=h(""),be=h(!1),Te=h(0),fe=h(""),Ae=h(null),St=()=>{ge.value="",fe.value="",ce.value=!0},qe=()=>{ge.value&&(n.value?.chain().focus().setImage({src:ge.value}).run(),ce.value=!1)},Lt=r=>{const l=r.target.files?.[0];l&&Pe(l)},Pe=async r=>{if(!r.type.startsWith("image/")){fe.value="Please select an image file";return}be.value=!0,fe.value="",Te.value=0;try{const e=new FormData;e.append("image",r);const l=await lt.post("/editor/images",e,{headers:{"Content-Type":"multipart/form-data"},onUploadProgress:v=>{v.total&&(Te.value=Math.round(v.loaded*100/v.total))}});l.data.success&&(n.value?.chain().focus().setImage({src:l.data.url,width:l.data.width,height:l.data.height}).run(),ce.value=!1)}catch(e){fe.value=e.response?.data?.message||"Upload failed"}finally{be.value=!1,Te.value=0,Ae.value&&(Ae.value.value="")}},je=r=>{const{file:e}=r.detail;Pe(e)},Xe=r=>{const{file:e}=r.detail;Pe(e)},Ge=h("#ffff00"),$t=()=>{if(n.value?.isActive("highlight"))n.value.chain().focus().unsetHighlight().run();else{const r=prompt("Enter highlight color (hex, rgb, or color name):",Ge.value);r?(Ge.value=r,n.value?.chain().focus().setHighlight({color:r}).run()):n.value?.chain().focus().setHighlight().run()}},Me=r=>{n.value?.chain().focus().setTextAlign(r).run()},_t=()=>{n.value?.chain().focus().insertTable({rows:3,cols:3,withHeaderRow:!0}).run()},Et=()=>{n.value?.chain().focus().addColumnBefore().run()},Rt=()=>{n.value?.chain().focus().addColumnAfter().run()},Ht=()=>{n.value?.chain().focus().deleteColumn().run()},It=()=>{n.value?.chain().focus().addRowBefore().run()},Vt=()=>{n.value?.chain().focus().addRowAfter().run()},Dt=()=>{n.value?.chain().focus().deleteRow().run()},Pt=()=>{n.value?.chain().focus().deleteTable().run()},oe=()=>n.value?.isActive("table")??!1,Ye=h("12pt"),we=["8pt","9pt","10pt","11pt","12pt","14pt","16pt","18pt","20pt","24pt","28pt","36pt","48pt","72pt"],Ut=()=>{const r=Ue(),e=we.indexOf(r);if(e===-1)n.value?.chain().focus().setFontSize("14pt").run();else if(e<we.length-1){const l=we[e+1];n.value?.chain().focus().setFontSize(l).run()}ye()},Bt=()=>{const r=Ue(),e=we.indexOf(r);if(e===-1)n.value?.chain().focus().setFontSize("11pt").run();else if(e>0){const l=we[e-1];n.value?.chain().focus().setFontSize(l).run()}ye()},Ue=()=>{const{from:r,to:e}=n.value?.state.selection||{from:0,to:0};let l="";return n.value?.state.doc.nodesBetween(r,e,v=>{v.marks&&v.marks.forEach(_=>{_.type.name==="textStyle"&&_.attrs.fontSize&&(l=_.attrs.fontSize)})}),l||"12pt"},ye=()=>{const r=Ue();Ye.value=r},Ot=B(()=>n.value?n.value.state.doc.textContent.split(/\s+/).filter(e=>e.length>0).length:0);return o({getSelectionRange:()=>{if(!n.value)return null;const{from:r,to:e,empty:l}=n.value.state.selection;return l?null:{from:r,to:e}},getSelectedText:()=>{if(!n.value)return"";const{from:r,to:e}=n.value.state.selection;return n.value.state.doc.textBetween(r,e)},replaceSelection:(r,e)=>{if(!n.value)return console.error("âŒ RichTextEditor - Cannot replace selection: editor not available"),!1;try{const l=e||n.value.state.selection;return console.log("ðŸ”„ RichTextEditor - Starting text replacement:",{range:l,newTextLength:r.length,newTextPreview:r.substring(0,100)+(r.length>100?"...":"")}),n.value.chain().focus().insertContentAt({from:l.from,to:l.to},r,{parseOptions:{preserveWhitespace:"full"}}).run(),console.log("âœ… RichTextEditor - Text replacement successful"),!0}catch(l){return console.error("âŒ RichTextEditor - Error replacing selection:",l),!1}},replaceTextAt:(r,e)=>{if(!n.value)return!1;try{return n.value.chain().focus().insertContentAt(r,e).run(),!0}catch(l){return console.error("Error replacing text at position:",l),!1}},getCursorPosition:()=>n.value?n.value.state.selection.anchor:0,setCursorPosition:r=>{if(!n.value)return!1;try{return n.value.commands.setTextSelection(r),!0}catch(e){return console.error("Error setting cursor position:",e),!1}},focus:()=>n.value?.commands.focus(),blur:()=>n.value?.commands.blur(),getHTML:()=>n.value?.getHTML()||"",getText:()=>n.value?.getText()||"",wordCount:Ot,startStreamingMode:re,endStreamingMode:y,refreshContent:L,getStreamingInfo:K,isStreamingActive:()=>T.value,editor:()=>n.value}),(r,e)=>(z(),I("div",ur,[r.showToolbar&&!r.readonly?(z(),de(Zt,{key:0,to:ne.value,disabled:Z.value},[u("div",{class:w(X.value)},[u("div",cr,[a(t(p),{variant:"ghost",size:"icon",class:"h-8 w-8 rounded-lg hover:bg-muted/80 text-zinc-700 dark:text-zinc-300 hover:text-foreground",onClick:yt,disabled:!t(n)?.can().undo()},{default:i(()=>[a(t(ea),{class:"h-4 w-4"})]),_:1},8,["disabled"]),a(t(p),{variant:"ghost",size:"icon",class:"h-8 w-8 rounded-lg hover:bg-muted/80 text-zinc-700 dark:text-zinc-300 hover:text-foreground",onClick:kt,disabled:!t(n)?.can().redo()},{default:i(()=>[a(t(ta),{class:"h-4 w-4"})]),_:1},8,["disabled"])]),u("div",gr,[a(t(Ze),null,{default:i(()=>[a(t(Qe),{asChild:""},{default:i(()=>[a(t(p),{variant:"ghost",size:"sm",class:"h-8 gap-1 px-2 font-medium text-zinc-700 dark:text-zinc-300 hover:text-foreground hover:bg-muted/80"},{default:i(()=>[u("span",fr,V(t(n)?.isActive("heading",{level:1})?"H1":t(n)?.isActive("heading",{level:2})?"H2":t(n)?.isActive("heading",{level:3})?"H3":"Paragraph"),1),a(t(ot),{class:"h-3.5 w-3.5 opacity-70"})]),_:1})]),_:1}),a(t(Je),{align:"start"},{default:i(()=>[a(t(N),{onClick:wt,class:w({"bg-accent":t(n)?.isActive("paragraph")})},{default:i(()=>[...e[15]||(e[15]=[u("span",{class:"text-sm"},"Paragraph",-1)])]),_:1},8,["class"]),a(t(Se)),a(t(N),{onClick:Ce,class:w({"bg-accent":t(n)?.isActive("heading",{level:1})})},{default:i(()=>[...e[16]||(e[16]=[u("span",{class:"text-lg font-bold"},"Heading 1",-1)])]),_:1},8,["class"]),a(t(N),{onClick:pt,class:w({"bg-accent":t(n)?.isActive("heading",{level:2})})},{default:i(()=>[...e[17]||(e[17]=[u("span",{class:"text-base font-bold"},"Heading 2",-1)])]),_:1},8,["class"]),a(t(N),{onClick:vt,class:w({"bg-accent":t(n)?.isActive("heading",{level:3})})},{default:i(()=>[...e[18]||(e[18]=[u("span",{class:"text-sm font-bold"},"Heading 3",-1)])]),_:1},8,["class"])]),_:1})]),_:1}),u("div",mr,[a(t(p),{variant:"ghost",size:"icon",class:"h-8 w-6 rounded-l-lg text-zinc-700 dark:text-zinc-300 hover:text-foreground hover:bg-muted/80",onClick:Bt},{default:i(()=>[a(t(aa),{class:"h-3 w-3"})]),_:1}),u("div",pr,V(Ye.value.replace("pt","")),1),a(t(p),{variant:"ghost",size:"icon",class:"h-8 w-6 rounded-r-lg text-zinc-700 dark:text-zinc-300 hover:text-foreground hover:bg-muted/80",onClick:Ut},{default:i(()=>[a(t(ra),{class:"h-3 w-3"})]),_:1})])]),u("div",vr,[a(t(p),{variant:"ghost",size:"icon",class:w(["h-8 w-8 rounded-lg text-zinc-700 dark:text-zinc-300 hover:text-foreground hover:bg-muted/80",{"bg-primary/10 text-primary":t(n)?.isActive("bold")}]),onClick:Q},{default:i(()=>[a(t(na),{class:"h-4 w-4"})]),_:1},8,["class"]),a(t(p),{variant:"ghost",size:"icon",class:w(["h-8 w-8 rounded-lg text-zinc-700 dark:text-zinc-300 hover:text-foreground hover:bg-muted/80",{"bg-primary/10 text-primary":t(n)?.isActive("italic")}]),onClick:he},{default:i(()=>[a(t(sa),{class:"h-4 w-4"})]),_:1},8,["class"]),a(t(p),{variant:"ghost",size:"icon",class:w(["h-8 w-8 rounded-lg text-zinc-700 dark:text-zinc-300 hover:text-foreground hover:bg-muted/80",{"bg-primary/10 text-primary":t(n)?.isActive("underline")}]),onClick:ee},{default:i(()=>[a(t(oa),{class:"h-4 w-4"})]),_:1},8,["class"]),a(t(p),{variant:"ghost",size:"icon",class:w(["h-8 w-8 rounded-lg text-zinc-700 dark:text-zinc-300 hover:text-foreground hover:bg-muted/80",{"bg-primary/10 text-primary":t(n)?.isActive("strike")}]),onClick:Ie},{default:i(()=>[a(t(la),{class:"h-4 w-4"})]),_:1},8,["class"]),a(t(p),{variant:"ghost",size:"icon",class:w(["h-8 w-8 rounded-lg text-zinc-700 dark:text-zinc-300 hover:text-foreground hover:bg-muted/80",{"bg-primary/10 text-primary":t(n)?.isActive("code")}]),onClick:Ve},{default:i(()=>[a(t(ia),{class:"h-4 w-4"})]),_:1},8,["class"])]),u("div",hr,[a(t(p),{variant:"ghost",size:"icon",class:w(["h-8 w-8 rounded-lg text-zinc-700 dark:text-zinc-300 hover:text-foreground hover:bg-muted/80",{"bg-primary/10 text-primary":t(n)?.isActive("bulletList")}]),onClick:ht},{default:i(()=>[a(t(da),{class:"h-4 w-4"})]),_:1},8,["class"]),a(t(p),{variant:"ghost",size:"icon",class:w(["h-8 w-8 rounded-lg text-zinc-700 dark:text-zinc-300 hover:text-foreground hover:bg-muted/80",{"bg-primary/10 text-primary":t(n)?.isActive("orderedList")}]),onClick:xt},{default:i(()=>[a(t(ua),{class:"h-4 w-4"})]),_:1},8,["class"]),a(t(p),{variant:"ghost",size:"icon",class:w(["h-8 w-8 rounded-lg text-zinc-700 dark:text-zinc-300 hover:text-foreground hover:bg-muted/80",{"bg-primary/10 text-primary":t(n)?.isActive("blockquote")}]),onClick:bt},{default:i(()=>[a(t(ca),{class:"h-4 w-4"})]),_:1},8,["class"]),u("div",xr,[a(t(p),{variant:"ghost",size:"icon",class:w(["h-8 w-8 rounded-lg text-zinc-700 dark:text-zinc-300 hover:text-foreground hover:bg-muted/80",{"bg-primary/10 text-primary":t(n)?.isActive({textAlign:"left"})}]),onClick:e[0]||(e[0]=l=>Me("left"))},{default:i(()=>[a(t(rt),{class:"h-4 w-4"})]),_:1},8,["class"]),a(t(p),{variant:"ghost",size:"icon",class:w(["h-8 w-8 rounded-lg text-zinc-700 dark:text-zinc-300 hover:text-foreground hover:bg-muted/80",{"bg-primary/10 text-primary":t(n)?.isActive({textAlign:"center"})}]),onClick:e[1]||(e[1]=l=>Me("center"))},{default:i(()=>[a(t(nt),{class:"h-4 w-4"})]),_:1},8,["class"]),a(t(p),{variant:"ghost",size:"icon",class:w(["h-8 w-8 rounded-lg text-zinc-700 dark:text-zinc-300 hover:text-foreground hover:bg-muted/80",{"bg-primary/10 text-primary":t(n)?.isActive({textAlign:"right"})}]),onClick:e[2]||(e[2]=l=>Me("right"))},{default:i(()=>[a(t(st),{class:"h-4 w-4"})]),_:1},8,["class"]),a(t(p),{variant:"ghost",size:"icon",class:w(["h-8 w-8 rounded-lg text-zinc-700 dark:text-zinc-300 hover:text-foreground hover:bg-muted/80",{"bg-primary/10 text-primary":t(n)?.isActive({textAlign:"justify"})}]),onClick:e[3]||(e[3]=l=>Me("justify"))},{default:i(()=>[a(t(ga),{class:"h-4 w-4"})]),_:1},8,["class"])])]),u("div",br,[a(t(p),{variant:"ghost",size:"icon",class:"h-8 w-8 rounded-lg text-zinc-700 dark:text-zinc-300 hover:text-foreground hover:bg-muted/80",title:"Insert Mermaid diagram (Ctrl/Cmd+Alt+M)",onClick:m},{default:i(()=>[...e[19]||(e[19]=[u("span",{class:"text-[11px] font-semibold"},"M",-1)])]),_:1}),a(t(p),{variant:"ghost",size:"icon",class:"h-8 w-8 rounded-lg text-zinc-700 dark:text-zinc-300 hover:text-foreground hover:bg-muted/80",title:"Insert inline math",onClick:ke},{default:i(()=>[...e[20]||(e[20]=[u("span",{class:"text-[11px] font-semibold"},"fx",-1)])]),_:1}),a(t(p),{variant:"ghost",size:"icon",class:"h-8 w-8 rounded-lg text-zinc-700 dark:text-zinc-300 hover:text-foreground hover:bg-muted/80",title:"Insert block math",onClick:De},{default:i(()=>[...e[21]||(e[21]=[u("span",{class:"text-[11px] font-semibold"},"FX",-1)])]),_:1}),a(t(p),{variant:"ghost",size:"icon",class:w(["h-8 w-8 rounded-lg text-zinc-700 dark:text-zinc-300 hover:text-foreground hover:bg-muted/80",{"bg-primary/10 text-primary":t(n)?.isActive("link")}]),onClick:Ct},{default:i(()=>[a(t(fa),{class:"h-4 w-4"})]),_:1},8,["class"]),a(t(p),{variant:"ghost",size:"icon",class:"h-8 w-8 rounded-lg text-zinc-700 dark:text-zinc-300 hover:text-foreground hover:bg-muted/80",title:"Insert image",onClick:St},{default:i(()=>[a(t(ma),{class:"h-4 w-4"})]),_:1}),a(t(Ze),null,{default:i(()=>[a(t(Qe),{asChild:""},{default:i(()=>[a(t(p),{variant:"ghost",size:"icon",class:w(["h-8 w-8 rounded-lg text-zinc-700 dark:text-zinc-300 hover:text-foreground hover:bg-muted/80",{"bg-primary/10 text-primary":t(n)?.isActive("table")}])},{default:i(()=>[a(t(pa),{class:"h-4 w-4"})]),_:1},8,["class"])]),_:1}),a(t(Je),null,{default:i(()=>[a(t(N),{onClick:_t},{default:i(()=>[...e[22]||(e[22]=[b("Insert Table (3x3)",-1)])]),_:1}),a(t(Se)),a(t(N),{onClick:Et,disabled:!oe()},{default:i(()=>[...e[23]||(e[23]=[b("Add Column Before",-1)])]),_:1},8,["disabled"]),a(t(N),{onClick:Rt,disabled:!oe()},{default:i(()=>[...e[24]||(e[24]=[b("Add Column After",-1)])]),_:1},8,["disabled"]),a(t(N),{onClick:Ht,disabled:!oe()},{default:i(()=>[...e[25]||(e[25]=[b("Delete Column",-1)])]),_:1},8,["disabled"]),a(t(Se)),a(t(N),{onClick:It,disabled:!oe()},{default:i(()=>[...e[26]||(e[26]=[b("Add Row Before",-1)])]),_:1},8,["disabled"]),a(t(N),{onClick:Vt,disabled:!oe()},{default:i(()=>[...e[27]||(e[27]=[b("Add Row After",-1)])]),_:1},8,["disabled"]),a(t(N),{onClick:Dt,disabled:!oe()},{default:i(()=>[...e[28]||(e[28]=[b("Delete Row",-1)])]),_:1},8,["disabled"]),a(t(Se)),a(t(N),{onClick:Pt,disabled:!oe(),class:"text-destructive"},{default:i(()=>[...e[29]||(e[29]=[b("Delete Table ",-1)])]),_:1},8,["disabled"])]),_:1})]),_:1}),a(t(p),{variant:"ghost",size:"icon",class:w(["h-8 w-8 rounded-lg text-zinc-700 dark:text-zinc-300 hover:text-foreground hover:bg-muted/80",{"bg-primary/10 text-primary":t(n)?.isActive("highlight")}]),onClick:$t},{default:i(()=>[a(t(va),{class:"h-4 w-4"})]),_:1},8,["class"]),a(t(p),{variant:"ghost",size:"icon",class:w(["h-8 w-8 rounded-lg text-zinc-700 dark:text-zinc-300 hover:text-foreground hover:bg-muted/80",{"bg-primary/10 text-primary":t(n)?.getAttributes("textStyle").color}]),onClick:Tt},{default:i(()=>[a(t(ha),{class:"h-4 w-4"})]),_:1},8,["class"])])],2)],8,["to","disabled"])):P("",!0),u("div",wr,[a(t(Pa),{editor:t(n),class:"h-full w-full outline-none"},null,8,["editor"]),a(ba,{"enter-active-class":"transition-all duration-300 cubic-bezier(0.34, 1.56, 0.64, 1)","enter-from-class":"opacity-0 -translate-y-4 scale-95","enter-to-class":"opacity-100 translate-y-0 scale-100","leave-active-class":"transition-all duration-200 cubic-bezier(0.4, 0, 0.2, 1)","leave-from-class":"opacity-100 translate-y-0 scale-100","leave-to-class":"opacity-0 -translate-y-4 scale-95"},{default:i(()=>[r.isGenerating?(z(),I("div",yr,[u("div",kr,[u("div",Cr,[e[30]||(e[30]=u("div",{class:"absolute inset-0 rounded-full bg-indigo-400/30 animate-ping"},null,-1)),a(t(xa),{class:"w-4 h-4 text-indigo-300 animate-pulse relative z-10"})]),u("div",zr,[u("div",Tr,[u("span",Ar,V(r.generationPhase||"Writing..."),1),u("span",Mr,V(r.generationPercentage)+"% ",1)]),u("div",Sr,[u("div",{class:"h-full bg-gradient-to-r from-indigo-400 to-purple-400 transition-all duration-300 ease-out",style:pe({width:`${r.generationPercentage}%`})},[...e[31]||(e[31]=[u("div",{class:"absolute inset-0 bg-white/20 animate-[shimmer_2s_infinite]"},null,-1)])],4)])]),e[33]||(e[33]=u("div",{class:"w-px h-6 bg-white/10 mx-1"},null,-1)),u("div",Lr,[e[32]||(e[32]=u("span",{class:"text-[10px] font-medium text-indigo-200/80"}," Word Count ",-1)),u("span",$r,V(r.generationProgress?.match(/\d+/)?.[0]||"..."),1)])])])):P("",!0)]),_:1})]),a(t(Le),{open:xe.value,"onUpdate:open":e[7]||(e[7]=l=>xe.value=l)},{default:i(()=>[a(t($e),null,{default:i(()=>[a(t(Re),null,{default:i(()=>[a(t(He),null,{default:i(()=>[...e[34]||(e[34]=[b("Insert Link",-1)])]),_:1}),a(t(_e),null,{default:i(()=>[...e[35]||(e[35]=[b("Enter the URL for the link.",-1)])]),_:1})]),_:1}),u("div",_r,[u("div",Er,[a(t(me),{htmlFor:"link-text"},{default:i(()=>[...e[36]||(e[36]=[b("Text",-1)])]),_:1}),a(t(ie),{id:"link-text",modelValue:j.value.text,"onUpdate:modelValue":e[4]||(e[4]=l=>j.value.text=l),placeholder:"Link text"},null,8,["modelValue"])]),u("div",Rr,[a(t(me),{htmlFor:"link-url"},{default:i(()=>[...e[37]||(e[37]=[b("URL",-1)])]),_:1}),a(t(ie),{id:"link-url",modelValue:j.value.url,"onUpdate:modelValue":e[5]||(e[5]=l=>j.value.url=l),placeholder:"https://example.com"},null,8,["modelValue"])])]),a(t(Ee),null,{default:i(()=>[a(t(p),{variant:"outline",onClick:e[6]||(e[6]=l=>xe.value=!1)},{default:i(()=>[...e[38]||(e[38]=[b("Cancel",-1)])]),_:1}),a(t(p),{onClick:zt},{default:i(()=>[...e[39]||(e[39]=[b("Insert",-1)])]),_:1})]),_:1})]),_:1})]),_:1},8,["open"]),a(t(Le),{open:ze.value,"onUpdate:open":e[10]||(e[10]=l=>ze.value=l)},{default:i(()=>[a(t($e),null,{default:i(()=>[a(t(Re),null,{default:i(()=>[a(t(He),null,{default:i(()=>[...e[40]||(e[40]=[b("Text Color",-1)])]),_:1}),a(t(_e),null,{default:i(()=>[...e[41]||(e[41]=[b("Choose a color for the selected text.",-1)])]),_:1})]),_:1}),u("div",Hr,[u("div",Ir,[a(t(ie),{type:"color",modelValue:se.value.color,"onUpdate:modelValue":e[8]||(e[8]=l=>se.value.color=l),class:"h-12 w-12 p-1"},null,8,["modelValue"]),a(t(ie),{modelValue:se.value.color,"onUpdate:modelValue":e[9]||(e[9]=l=>se.value.color=l),placeholder:"#000000",class:"flex-1"},null,8,["modelValue"])]),u("div",Vr,[(z(),I(Fe,null,wa(["#000000","#ef4444","#f97316","#eab308","#22c55e","#3b82f6","#a855f7","#ec4899"],l=>u("button",{key:l,class:"h-8 w-8 rounded-full border border-border shadow-sm transition-transform hover:scale-110 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2",style:pe({backgroundColor:l}),onClick:v=>se.value.color=l},null,12,Dr)),64))])]),a(t(Ee),null,{default:i(()=>[a(t(p),{variant:"outline",onClick:Mt},{default:i(()=>[...e[42]||(e[42]=[b("Reset",-1)])]),_:1}),a(t(p),{onClick:At},{default:i(()=>[...e[43]||(e[43]=[b("Apply",-1)])]),_:1})]),_:1})]),_:1})]),_:1},8,["open"]),a(t(Le),{open:ce.value,"onUpdate:open":e[14]||(e[14]=l=>ce.value=l)},{default:i(()=>[a(t($e),{class:"sm:max-w-md"},{default:i(()=>[a(t(Re),null,{default:i(()=>[a(t(He),null,{default:i(()=>[...e[44]||(e[44]=[b("Insert Image",-1)])]),_:1}),a(t(_e),null,{default:i(()=>[...e[45]||(e[45]=[b("Upload an image or enter a URL.",-1)])]),_:1})]),_:1}),u("div",Pr,[u("div",Ur,[a(t(me),null,{default:i(()=>[...e[46]||(e[46]=[b("Upload from computer",-1)])]),_:1}),u("div",Br,[u("input",{ref_key:"imageFileInput",ref:Ae,type:"file",accept:"image/*",class:"hidden",onChange:Lt},null,544),a(t(p),{variant:"outline",class:"w-full",disabled:be.value,onClick:e[11]||(e[11]=l=>Ae.value?.click())},{default:i(()=>[a(t(ya),{class:"w-4 h-4 mr-2"}),b(" "+V(be.value?"Uploading...":"Choose File"),1)]),_:1},8,["disabled"])]),be.value?(z(),de(t(Ua),{key:0,"model-value":Te.value,class:"h-2"},null,8,["model-value"])):P("",!0),fe.value?(z(),I("p",Or,V(fe.value),1)):P("",!0)]),e[49]||(e[49]=u("div",{class:"relative"},[u("div",{class:"absolute inset-0 flex items-center"},[u("span",{class:"w-full border-t"})]),u("div",{class:"relative flex justify-center text-xs uppercase"},[u("span",{class:"bg-background px-2 text-muted-foreground"},"Or")])],-1)),u("div",Fr,[a(t(me),{for:"image-url"},{default:i(()=>[...e[47]||(e[47]=[b("Image URL",-1)])]),_:1}),u("div",Wr,[a(t(ie),{id:"image-url",modelValue:ge.value,"onUpdate:modelValue":e[12]||(e[12]=l=>ge.value=l),placeholder:"https://example.com/image.jpg",onKeydown:at(qe,["enter"])},null,8,["modelValue"]),a(t(p),{onClick:qe,disabled:!ge.value},{default:i(()=>[...e[48]||(e[48]=[b(" Insert ",-1)])]),_:1},8,["disabled"])])])]),a(t(Ee),null,{default:i(()=>[a(t(p),{variant:"outline",onClick:e[13]||(e[13]=l=>ce.value=!1)},{default:i(()=>[...e[50]||(e[50]=[b("Cancel",-1)])]),_:1})]),_:1})]),_:1})]),_:1},8,["open"])]))}}),cn=Ne(Nr,[["__scopeId","data-v-48cae01f"]]);export{cn as R};
