import{_ as q}from"./AdminLayout.vue_vue_type_script_setup_true_lang-BzzpffZS.js";import{_ as y,a as k}from"./CardContent.vue_vue_type_script_setup_true_lang-CHCDuRZd.js";import{_ as w}from"./CardDescription.vue_vue_type_script_setup_true_lang-CUZkTCdh.js";import{_ as C,a as $}from"./CardTitle.vue_vue_type_script_setup_true_lang-CFv199a3.js";import{_ as S}from"./index-Dh4Dof5h.js";import{_ as T}from"./index-DXsLaJg_.js";import{_ as M}from"./Checkbox.vue_vue_type_script_setup_true_lang-DByIfCXz.js";import{_ as O}from"./Input.vue_vue_type_script_setup_true_lang-BcqgGMan.js";import{_ as W,a as Z,b as H,c as I,d as J,e as K,f as Q,g as X}from"./AlertDialogTitle.vue_vue_type_script_setup_true_lang-DYbp3fW0.js";import{_ as Y}from"./AlertDialogTrigger.vue_vue_type_script_setup_true_lang-CfqS7nhA.js";import{bt as ee,ck as f,bs as j,dG as te,cn as D,co as u,cp as a,cr as l,cq as s,bE as t,dg as se,cs as r,e1 as ae,dW as le,ct as i,cB as m,cG as p,e2 as re,cS as B,df as P,cu as oe,e3 as ne,cl as de,cj as E}from"./vendor-BwJgEX4g.js";import"./Sonner.vue_vue_type_script_setup_true_lang-BX3Dlz2r.js";import"./UserInfo.vue_vue_type_script_setup_true_lang-Be-HwAt8.js";import"./TooltipTrigger.vue_vue_type_script_setup_true_lang-DJ0GQY-9.js";const ie={class:"space-y-6 max-w-5xl mx-auto"},ue={class:"flex items-center gap-2"},ce={class:"p-2 rounded-full bg-destructive/10 text-destructive"},me={class:"flex items-center gap-2"},fe={class:"flex items-center gap-2"},pe={class:"font-bold text-destructive text-base"},_e={class:"space-y-1"},ve={class:"flex items-center gap-2"},ge={class:"flex-1 space-y-1"},xe={class:"flex items-center justify-between gap-2"},be={class:"font-semibold text-foreground tracking-tight"},he={class:"text-xs text-muted-foreground flex flex-col gap-0.5"},ye={key:0,class:"text-amber-600 dark:text-amber-500 font-medium"},ke={class:"text-muted-foreground font-normal"},we={key:1,class:"font-medium"},Ce={key:0,class:"absolute inset-0 rounded-xl ring-1 ring-inset ring-primary/10 pointer-events-none"},$e={key:0,class:"border-t border-border/50 px-6 py-4 bg-muted/20"},Se={class:"mb-3 flex items-center gap-2"},Te={class:"text-sm font-semibold text-muted-foreground"},De={class:"grid gap-2 sm:grid-cols-2 lg:grid-cols-4"},Ve={class:"font-mono text-muted-foreground"},Le={class:"text-sm text-muted-foreground"},je={class:"font-semibold text-foreground"},Be={class:"font-mono text-xs bg-muted px-2 py-1 rounded"},Pe={key:0,class:"text-xs text-rose-500"},Ee={key:0,class:"text-xs text-rose-500"},Je=ee({__name:"Cleanup",props:{tables:{},userStats:{},confirmPhrase:{}},setup(R){const _=R,v=f(()=>_.tables),g=f(()=>_.userStats),V=f(()=>_.confirmPhrase),x=f(()=>v.value.filter(o=>!o.locked)),b=f(()=>v.value.filter(o=>o.locked)),d=j(x.value.map(o=>o.name)),h=j(!1),U=f(()=>{const o=new Map;return v.value.forEach(e=>{o.set(e.name,{count:e.count})}),o}),L=f(()=>d.value.reduce((o,e)=>e==="users"?o+g.value.deletable:o+(U.value.get(e)?.count??0),0)),c=te({tables:[],confirm_phrase:""}),z=(o,e)=>{e===!0?d.value.includes(o)||d.value.push(o):d.value=d.value.filter(n=>n!==o)},A=()=>{d.value=x.value.map(o=>o.name)},F=()=>{d.value=[]},G=()=>{c.tables=d.value,c.post(de("admin.system.cleanup.run"),{preserveScroll:!0,onSuccess:()=>{c.confirm_phrase="",h.value=!1,E("Cleanup complete",{description:"Selected tables have been cleared."})},onError:()=>{E("Cleanup failed",{description:"Review the errors and try again."})}})};return(o,e)=>(u(),D(q,{title:"Data Cleanup",subtitle:"Permanently delete non-core data before launch"},{default:a(()=>[l("div",ie,[s(t(y),{class:"border-l-4 border-l-destructive border-t-destructive/20 border-r-destructive/20 border-b-destructive/20 bg-gradient-to-br from-destructive/10 via-background to-destructive/5 shadow-sm"},{default:a(()=>[s(t(C),null,{default:a(()=>[l("div",ue,[l("div",ce,[s(t(se),{class:"w-5 h-5"})]),s(t($),{class:"text-destructive text-lg"},{default:a(()=>[...e[2]||(e[2]=[r("Danger Zone",-1)])]),_:1})]),s(t(w),{class:"text-destructive/80 font-medium"},{default:a(()=>[...e[3]||(e[3]=[r(" This action deletes production data. Core lookup tables are locked and cannot be selected. ",-1)])]),_:1})]),_:1}),s(t(k),{class:"grid gap-2 text-sm text-muted-foreground ml-1"},{default:a(()=>[l("div",me,[s(t(ae),{class:"w-4 h-4 text-emerald-500"}),e[4]||(e[4]=l("span",null,"Superadmin users will always remain protected.",-1))]),l("div",fe,[s(t(le),{class:"w-4 h-4 text-destructive/70"}),l("span",null,[e[5]||(e[5]=r("Selected rows to delete: ",-1)),l("span",pe,i(L.value.toLocaleString()),1)])])]),_:1})]),_:1}),s(t(y),{class:"shadow-sm border-border/60"},{default:a(()=>[s(t(C),{class:"flex flex-col gap-4 md:flex-row md:items-center md:justify-between pb-6"},{default:a(()=>[l("div",_e,[s(t($),{class:"flex items-center gap-2"},{default:a(()=>[s(t(re),{class:"w-5 h-5 text-primary"}),e[6]||(e[6]=r(" Database Tables ",-1))]),_:1}),s(t(w),null,{default:a(()=>[...e[7]||(e[7]=[r("Select which tables to purge. Locked tables are excluded.",-1)])]),_:1})]),l("div",ve,[s(t(S),{variant:"outline",size:"sm",onClick:A,class:"h-8 text-xs"},{default:a(()=>[...e[8]||(e[8]=[r("Select all",-1)])]),_:1}),s(t(S),{variant:"ghost",size:"sm",onClick:F,class:"h-8 text-xs"},{default:a(()=>[...e[9]||(e[9]=[r("Clear all",-1)])]),_:1})])]),_:1}),s(t(k),{class:"grid gap-3 sm:grid-cols-2 lg:grid-cols-3"},{default:a(()=>[(u(!0),m(B,null,P(x.value,n=>(u(),m("label",{key:n.name,class:oe(["group relative flex items-start gap-3 rounded-xl border border-border/50 bg-card p-4 text-sm transition-all duration-200 hover:shadow-md hover:border-primary/20 cursor-pointer",{"ring-1 ring-primary/20 bg-primary/5 border-primary/30":d.value.includes(n.name)}])},[s(t(M),{"model-value":d.value.includes(n.name),class:"mt-1 data-[state=checked]:bg-primary data-[state=checked]:border-primary","onUpdate:modelValue":N=>z(n.name,N)},null,8,["model-value","onUpdate:modelValue"]),l("div",ge,[l("div",xe,[l("span",be,i(n.name),1),d.value.includes(n.name)?(u(),D(t(T),{key:0,variant:"default",class:"h-5 px-1.5 text-[10px] bg-destructive/90 hover:bg-destructive text-destructive-foreground shadow-none"},{default:a(()=>[...e[10]||(e[10]=[r(" Purge ",-1)])]),_:1})):(u(),D(t(T),{key:1,variant:"outline",class:"h-5 px-1.5 text-[10px] text-muted-foreground font-normal"},{default:a(()=>[...e[11]||(e[11]=[r(" Ready ",-1)])]),_:1}))]),l("div",he,[n.name==="users"?(u(),m("span",ye,[r(i(g.value.deletable)+" deletable ",1),l("span",ke,"/ "+i(g.value.total)+" total",1)])):(u(),m("span",we,[r(i(n.count.toLocaleString())+" ",1),e[12]||(e[12]=l("span",{class:"text-muted-foreground font-normal"},"rows",-1))]))])]),d.value.includes(n.name)?(u(),m("div",Ce)):p("",!0)],2))),128))]),_:1}),b.value.length>0?(u(),m("div",$e,[l("div",Se,[s(t(ne),{class:"w-4 h-4 text-muted-foreground"}),l("h3",Te,"Locked System Tables ("+i(b.value.length)+")",1)]),l("div",De,[(u(!0),m(B,null,P(b.value,n=>(u(),m("div",{key:n.name,class:"flex items-center justify-between gap-2 p-2 rounded-lg bg-background/50 border border-border/30 text-xs opacity-75"},[l("span",Ve,i(n.name),1),s(t(T),{variant:"secondary",class:"h-4 px-1 text-[9px] pointer-events-none"},{default:a(()=>[...e[13]||(e[13]=[r("Locked",-1)])]),_:1})]))),128))])])):p("",!0)]),_:1}),s(t(y),null,{default:a(()=>[s(t(C),null,{default:a(()=>[s(t($),null,{default:a(()=>[...e[14]||(e[14]=[r("Run Cleanup",-1)])]),_:1}),s(t(w),null,{default:a(()=>[...e[15]||(e[15]=[r(" Confirm and execute deletion for selected tables. This cannot be undone. ",-1)])]),_:1})]),_:1}),s(t(k),{class:"flex flex-col gap-4"},{default:a(()=>[l("div",Le,[e[16]||(e[16]=r(" Selected tables: ",-1)),l("span",je,i(d.value.length),1)]),s(t(W),{open:h.value,"onUpdate:open":e[1]||(e[1]=n=>h.value=n)},{default:a(()=>[s(t(Y),{"as-child":""},{default:a(()=>[s(t(S),{variant:"destructive",disabled:d.value.length===0},{default:a(()=>[...e[17]||(e[17]=[r(" Delete Selected Data ",-1)])]),_:1},8,["disabled"])]),_:1}),s(t(Z),{class:"max-w-md"},{default:a(()=>[s(t(H),null,{default:a(()=>[s(t(I),{class:"text-destructive"},{default:a(()=>[...e[18]||(e[18]=[r("Confirm data cleanup",-1)])]),_:1}),s(t(J),{class:"space-y-3 text-sm"},{default:a(()=>[l("div",null," This will delete "+i(L.value)+" rows across "+i(d.value.length)+" tables. ",1),l("div",null,[e[19]||(e[19]=r(" Type ",-1)),l("code",Be,i(V.value),1),e[20]||(e[20]=r(" to continue. ",-1))]),s(t(O),{modelValue:t(c).confirm_phrase,"onUpdate:modelValue":e[0]||(e[0]=n=>t(c).confirm_phrase=n),placeholder:"Confirmation phrase"},null,8,["modelValue"]),t(c).errors.confirm_phrase?(u(),m("p",Pe,i(t(c).errors.confirm_phrase),1)):p("",!0)]),_:1})]),_:1}),s(t(K),null,{default:a(()=>[s(t(Q),null,{default:a(()=>[...e[21]||(e[21]=[r("Cancel",-1)])]),_:1}),s(t(X),{class:"bg-destructive text-destructive-foreground hover:bg-destructive/90",disabled:t(c).processing||t(c).confirm_phrase!==V.value,onClick:G},{default:a(()=>[r(i(t(c).processing?"Deleting...":"Confirm Delete"),1)]),_:1},8,["disabled"])]),_:1})]),_:1})]),_:1},8,["open"]),t(c).errors.tables?(u(),m("p",Ee,i(t(c).errors.tables),1)):p("",!0)]),_:1})]),_:1})])]),_:1}))}});export{Je as default};
