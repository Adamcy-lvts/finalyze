import{d as U,b as C,e as N,c as w,o as b,k as n,u as o,j as f,g as a,y as S,z as _,n as j,a3 as D,f as L,F,h as V,i as X,v as ae,U as A,t as J,aa as I,X as ne,s as oe,af as P}from"./app-BVIdTG1I.js";import{c as re,_ as $}from"./index-B1VpDU4x.js";import{_ as ie}from"./ChapterNavigation.vue_vue_type_script_setup_true_lang-BQMvfur1.js";import{_ as ee}from"./index-DOhLGeck.js";import{_ as q,a as O,b as G}from"./CollapsibleTrigger.vue_vue_type_script_setup_true_lang-BVNkpIFE.js";import{h as le,_ as ce}from"./SafeHtmlText.vue_vue_type_script_setup_true_lang-BYGGxntv.js";import{L as te}from"./lightbulb-CjBKl7pS.js";import{C as K}from"./chevron-down-CnDmxo1S.js";import{X as H}from"./x-6A7Bqp_F.js";import{_ as de}from"./Progress.vue_vue_type_script_setup_true_lang-B-tYgY80.js";import{_ as ue}from"./Checkbox.vue_vue_type_script_setup_true_lang-K76gIoIk.js";import{_ as E}from"./Separator.vue_vue_type_script_setup_true_lang-BsMDDgE-.js";import{T as W}from"./target-vCi_z2hW.js";import{L as pe}from"./loader-circle-BaE492Se.js";import{C as Z}from"./DropdownMenuTrigger.vue_vue_type_script_setup_true_lang-DsNFaETY.js";import{C as ge}from"./circle-BgXBNfrC.js";import{t as k}from"./index-B5b3Os__.js";import{W as me,b as fe}from"./useTextHistory-DwFYQCwA.js";import{S as he}from"./sparkles-CzNYXTkb.js";import{au as ve,at as be}from"./RichTextEditor-DuSMNIkl.js";import{T as xe}from"./type-B7PcsQha.js";import{_ as ye}from"./DefensePreparationPanel.vue_vue_type_script_setup_true_lang-Qewu5uVE.js";import{_ as we}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{u as se}from"./index-BhyhKSzW.js";import{r as _e}from"./useWordBalance-hu0KAx3X.js";/**
 * @license lucide-vue-next v0.468.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ce=re("BookmarkIcon",[["path",{d:"m19 21-7-4-7 4V5a2 2 0 0 1 2-2h10a2 2 0 0 1 2 2v16z",key:"1fy3hk"}]]),ke={class:"bg-card/50 backdrop-blur-sm border rounded-xl shadow-sm transition-all hover:shadow-md"},Se={class:"flex items-start justify-between gap-4 p-4"},$e={class:"flex-1 min-w-0"},Te={type:"button",class:"w-full text-left flex items-center gap-2 rounded-lg hover:bg-muted/30 transition-colors pr-2 -mr-2"},je={class:"p-1.5 rounded-md bg-primary/10 text-primary shrink-0"},Ae={class:"flex flex-col gap-1"},Le={class:"px-4 pb-4 space-y-3"},ze={key:0,class:"pt-2 border-t border-border/50"},Be={class:"text-xs text-amber-600 dark:text-amber-400 flex items-center gap-1.5"},Ie={class:"pt-1 flex justify-end"},Pe=U({__name:"SmartSuggestionPanel",props:{suggestion:{},analysis:{}},emits:["save","clear","apply"],setup(h,{emit:c}){const i=h,s=c,d=(t=>({writing_guide:{label:"Writing Guide",variant:"default"},claims_without_evidence:{label:"Evidence Needed",variant:"destructive"},insufficient_citations:{label:"Add Citations",variant:"warning"},insufficient_tables:{label:"Add Data",variant:"secondary"},weak_arguments:{label:"Strengthen Arguments",variant:"warning"},insufficient_content:{label:"Expand Content",variant:"secondary"}})[t]||{label:t,variant:"default"})(i.suggestion.suggestion_type),v=C(!0),y=t=>{const x=t.trim().match(/^```[a-zA-Z0-9_-]*\s*\n([\s\S]*?)\n?```$/);return x?x[1].trim():t},g=t=>{const l=y(t).trim();return l?l.split(/\n\s*\n/).filter(e=>e.trim()).map(e=>{const u=e.trim(),m=u.split(`
`).map(T=>T.trim()).filter(Boolean),z=m.some(T=>/^[-*•]\s+/.test(T)),B=m.some(T=>/^\d+\.\s+/.test(T));if(z||B){const T=m.map(M=>B&&/^\d+\.\s+/.test(M)?`<li>${M.replace(/^\d+\.\s+/,"")}</li>`:z&&/^[-*•]\s+/.test(M)?`<li>${M.replace(/^[-*•]\s+/,"")}</li>`:"").filter(Boolean);return B?`<ol>${T.join("")}</ol>`:`<ul>${T.join("")}</ul>`}return`<p>${u.replace(/\n/g,"<br>")}</p>`}).join(""):""},r=N(()=>{const t=i.suggestion?.suggestion_content||"";if(!t)return"";const l=y(t);return le(l)?l:g(l)});return(t,l)=>(b(),w("div",ke,[n(o(q),{open:v.value,"onUpdate:open":l[3]||(l[3]=x=>v.value=x)},{default:f(()=>[a("div",Se,[a("div",$e,[n(o(O),{"as-child":""},{default:f(()=>[a("button",Te,[a("div",je,[n(o(te),{class:"w-4 h-4"})]),l[4]||(l[4]=a("h3",{class:"font-semibold text-sm truncate"},"Smart Suggestion",-1)),n(o(ee),{variant:o(d).variant,class:"text-[10px] px-2 py-0.5 h-5 shrink-0"},{default:f(()=>[S(_(o(d).label),1)]),_:1},8,["variant"]),n(o(K),{class:j(["w-4 h-4 ml-auto text-muted-foreground transition-transform duration-200 shrink-0",v.value?"rotate-180":""])},null,8,["class"])])]),_:1})]),a("div",Ae,[n(o($),{size:"icon",variant:"ghost",class:"h-7 w-7",onClick:l[0]||(l[0]=D(x=>s("clear"),["stop"])),title:"Dismiss"},{default:f(()=>[n(o(H),{class:"w-4 h-4"})]),_:1}),n(o($),{size:"icon",variant:"ghost",class:"h-7 w-7",onClick:l[1]||(l[1]=D(x=>s("save"),["stop"])),title:"Save for later"},{default:f(()=>[n(o(Ce),{class:"w-4 h-4"})]),_:1})])]),n(o(G),null,{default:f(()=>[a("div",Le,[n(ce,{as:"div",content:r.value,class:"prose prose-sm dark:prose-invert max-w-none text-sm text-muted-foreground leading-relaxed prose-p:my-2 prose-ul:my-2 prose-ol:my-2 prose-li:my-1 prose-pre:my-2 prose-code:text-xs"},null,8,["content"]),t.analysis&&t.analysis.detected_issues.length>0?(b(),w("div",ze,[a("p",Be,[l[5]||(l[5]=a("span",{class:"w-1.5 h-1.5 rounded-full bg-amber-500"},null,-1)),S(" Issues: "+_(t.analysis.detected_issues.join(", ").replace(/_/g," ")),1)])])):L("",!0),a("div",Ie,[n(o($),{size:"sm",variant:"default",onClick:l[2]||(l[2]=x=>s("apply")),class:"w-full sm:w-auto"},{default:f(()=>[...l[6]||(l[6]=[S(" Apply Suggestion ",-1)])]),_:1})])])]),_:1})]),_:1},8,["open"])]))}}),Ee={class:"space-y-2"},Fe={class:"flex items-center gap-3"},Me={class:"flex flex-col items-start gap-1"},Ne={key:0,class:"text-[10px] text-muted-foreground"},Re={key:0,class:"flex items-center justify-center py-8"},Ue={class:"space-y-2"},We={class:"flex justify-between text-xs"},De={class:"text-muted-foreground"},He={class:"space-y-3"},qe={class:"flex items-center justify-between"},Oe={class:"text-sm font-semibold flex items-center gap-2"},Ge={class:"space-y-2"},Ke=["onClick"],Qe={key:0,class:"p-3 rounded-lg bg-blue-500/10 border border-blue-500/20"},Ve={class:"flex items-start gap-2"},Xe={class:"flex-1"},Ze={class:"text-xs leading-relaxed text-foreground"},Ye={class:"space-y-3"},Je={class:"text-sm font-semibold flex items-center gap-2"},et={class:"space-y-2"},tt={key:2,class:"text-center py-8"},st={class:"text-sm text-muted-foreground"},at=U({__name:"ProgressiveGuidancePanel",props:{guidance:{},isLoading:{type:Boolean},hasContent:{type:Boolean}},emits:["toggleStep","guidanceAction"],setup(h,{emit:c}){const i=h,s=c,p=C(!0),d=N(()=>{const g=i.guidance?.stage||"planning",r={planning:"bg-blue-500/10 text-blue-600 dark:text-blue-400",introduction:"bg-purple-500/10 text-purple-600 dark:text-purple-400",body_development:"bg-amber-500/10 text-amber-600 dark:text-amber-400",body_advanced:"bg-orange-500/10 text-orange-600 dark:text-orange-400",refinement:"bg-green-500/10 text-green-600 dark:text-green-400"};return r[g]||r.planning}),v=N(()=>i.guidance?i.guidance.next_steps.filter(g=>g.completed).length:0),y=N(()=>i.guidance?.next_steps.length||0);return(g,r)=>(b(),w("div",Ee,[n(o(q),{open:p.value,"onUpdate:open":r[0]||(r[0]=t=>p.value=t),class:"space-y-2"},{default:f(()=>[n(o(O),{class:"flex w-full items-center justify-between rounded-xl p-4 hover:bg-accent/50 transition-colors duration-200 group"},{default:f(()=>[a("div",Fe,[a("div",{class:j(["p-2 rounded-lg",d.value])},[n(o(W),{class:"h-4 w-4"})],2),a("div",Me,[r[1]||(r[1]=a("span",{class:"text-sm font-semibold"},"Writing Progress",-1)),g.guidance?(b(),w("span",Ne,_(g.guidance.stage_label),1)):L("",!0)])]),n(o(K),{class:j(["h-4 w-4 text-muted-foreground transition-transform duration-200",p.value?"rotate-180":""])},null,8,["class"])]),_:1}),n(o(G),{class:"space-y-4 px-4 pb-4"},{default:f(()=>[g.isLoading?(b(),w("div",Re,[n(o(pe),{class:"h-6 w-6 animate-spin text-muted-foreground"})])):g.guidance?(b(),w(F,{key:1},[a("div",Ue,[a("div",We,[r[2]||(r[2]=a("span",{class:"font-medium text-foreground"},"Overall Progress",-1)),a("span",De,_(g.guidance.completion_percentage)+"% ",1)]),n(o(de),{"model-value":g.guidance.completion_percentage,class:"h-2"},null,8,["model-value"])]),n(o(E),{class:"bg-border/50"}),a("div",He,[a("div",qe,[a("h4",Oe,[n(o(Z),{class:"h-4 w-4 text-primary"}),r[3]||(r[3]=S(" Next Steps ",-1))]),n(o(ee),{variant:"secondary",class:"text-[10px] px-2 py-0.5"},{default:f(()=>[S(_(v.value)+" / "+_(y.value),1)]),_:1})]),a("div",Ge,[(b(!0),w(F,null,V(g.guidance.next_steps,t=>(b(),w("div",{key:t.id,class:"flex items-start gap-3 p-3 rounded-lg hover:bg-accent/30 transition-colors duration-200 cursor-pointer group",onClick:l=>s("toggleStep",t.id)},[n(o(ue),{checked:t.completed,"onUpdate:checked":l=>s("toggleStep",t.id),class:"mt-0.5"},null,8,["checked","onUpdate:checked"]),a("span",{class:j(["text-xs leading-relaxed flex-1",t.completed?"line-through text-muted-foreground":"text-foreground"])},_(t.text),3),t.action&&t.action!=="none"?(b(),X(o($),{key:0,type:"button",size:"sm",variant:"ghost",class:"h-7 px-2 text-[11px] text-primary hover:bg-primary/10",onClick:D(l=>s("guidanceAction",t.id),["stop"])},{default:f(()=>[S(_(t.action==="open_citation_helper"?"Citations":"Insert"),1)]),_:2},1032,["onClick"])):L("",!0)],8,Ke))),128))])]),g.guidance.contextual_tip?(b(),w("div",Qe,[a("div",Ve,[n(o(te),{class:"h-4 w-4 text-blue-600 dark:text-blue-400 mt-0.5 flex-shrink-0"}),a("div",Xe,[a("p",Ze,_(g.guidance.contextual_tip),1)])])])):L("",!0),n(o(E),{class:"bg-border/50"}),a("div",Ye,[a("h4",Je,[n(o(W),{class:"h-4 w-4 text-primary"}),r[4]||(r[4]=S(" Milestones ",-1))]),a("div",et,[(b(!0),w(F,null,V(g.guidance.writing_milestones,t=>(b(),w("div",{key:t.id,class:"flex items-center gap-3 p-2 rounded-lg"},[(b(),X(ae(t.completed?o(Z):o(ge)),{class:j(["h-4 w-4",t.completed?"text-green-600 dark:text-green-400":"text-muted-foreground"])},null,8,["class"])),a("span",{class:j(["text-xs",t.completed?"text-foreground font-medium":"text-muted-foreground"])},_(t.label),3)]))),128))])])],64)):(b(),w("div",tt,[n(o(W),{class:"h-12 w-12 mx-auto text-muted-foreground/50 mb-3"}),a("p",st,[g.hasContent?(b(),w(F,{key:0},[S(" Analyzing your chapter to generate personalized guidance… ")],64)):(b(),w(F,{key:1},[S(" Start writing to get personalized guidance ")],64))])]))]),_:1})]),_:1},8,["open"])]))}});function R(h){if(!h)return 0;const i=String(h).replace(/<[^>]*>/g,"").trim().replace(/\s+/g," ");if(!i)return 0;const s=i.match(/\b\w+\b/g);return s?s.length:0}const nt={class:"space-y-2"},ot={class:"flex items-center gap-3"},rt={class:"p-2 rounded-lg bg-purple-500/10 text-purple-600 dark:text-purple-400"},it={class:"grid grid-cols-2 gap-2"},lt={class:"p-1.5 rounded-full bg-blue-500/10 text-blue-500"},ct={class:"text-xs font-medium"},dt={class:"p-1.5 rounded-full bg-purple-500/10 text-purple-500"},ut={class:"text-xs font-medium"},pt={class:"p-1.5 rounded-full bg-orange-500/10 text-orange-500"},gt={class:"text-xs font-medium"},mt={class:"p-1.5 rounded-full bg-emerald-500/10 text-emerald-500"},ft={class:"text-xs font-medium"},ht=U({__name:"QuickActionsPanel",props:{projectSlug:{},chapterNumber:{},selectedText:{},chapterContent:{},isProcessing:{type:Boolean},ensureBalance:{type:Function},onUsage:{type:Function}},emits:["textImproved","textExpanded","citationsSuggested","textRephrased","customPromptExecuted","openCitationHelper"],setup(h,{emit:c}){const i=h,s=c,p=C(!0),d=C({improve:!1,expand:!1,cite:!1,rephrase:!1,custom:!1}),v=r=>{const t=i.selectedText?.trim()||"",l=i.chapterContent?.trim()||"";return r==="expand"||r==="rephrase"?t:l||t},y=async r=>{try{const t=await r.json();return t?.message||t?.error||`HTTP ${r.status}`}catch{return`HTTP ${r.status}`}},g=async r=>{if(i.ensureBalance&&!i.ensureBalance(300,"use quick actions"))return;const t=v(r);if(!t){k.error(r==="expand"||r==="rephrase"?"Please select some text first":"Please add some content first");return}if(!i.selectedText&&(r==="expand"||r==="rephrase")){k.error("Please select some text first");return}if(r==="cite"){s("openCitationHelper"),k("Opening citation helper...");return}d.value[r]=!0;try{let l="",x;switch(r){case"improve":l="projects.manual-editor.improve-text",x="textImproved";break;case"expand":l="projects.manual-editor.expand-text",x="textExpanded";break;case"rephrase":l="projects.manual-editor.rephrase-text",x="textRephrased";break}const e=await fetch(A(l,{project:i.projectSlug,chapter:i.chapterNumber}),{method:"POST",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":document.querySelector('meta[name="csrf-token"]')?.content||"",Accept:"application/json"},body:JSON.stringify({text:t})});if(!e.ok){const m=await y(e);throw new Error(m)}const u=await e.json();r==="improve"&&u.improvedText?(s("textImproved",u.improvedText),await i.onUsage?.(R(u.improvedText),"Manual editor: Improve"),k.success("Text improved successfully!")):r==="expand"&&u.expandedText?(s("textExpanded",u.expandedText),await i.onUsage?.(R(u.expandedText),"Manual editor: Expand"),k.success("Text expanded successfully!")):r==="rephrase"&&u.alternatives&&(s("textRephrased",u.alternatives),await i.onUsage?.(R(u.alternatives),"Manual editor: Rephrase"),k.success("Alternative phrasings generated!"))}catch(l){console.error(`Failed to ${r} text:`,l);const x=l instanceof Error?l.message:"";k.error(`Failed to ${r} text. Please try again.`,x?{description:x}:void 0)}finally{d.value[r]=!1}};return(r,t)=>(b(),w("div",nt,[n(o(q),{open:p.value,"onUpdate:open":t[4]||(t[4]=l=>p.value=l),class:"space-y-2"},{default:f(()=>[n(o(O),{class:"flex w-full items-center justify-between rounded-xl p-4 hover:bg-accent/50 transition-colors duration-200 group"},{default:f(()=>[a("div",ot,[a("div",rt,[n(o(me),{class:"h-4 w-4"})]),t[5]||(t[5]=a("div",{class:"flex flex-col items-start gap-1"},[a("span",{class:"text-sm font-semibold"},"Quick Actions"),a("span",{class:"text-[10px] text-muted-foreground"}," AI-powered writing tools ")],-1))]),n(o(K),{class:j(["h-4 w-4 text-muted-foreground transition-transform duration-200",p.value?"rotate-180":""])},null,8,["class"])]),_:1}),n(o(G),{class:"space-y-4 px-4 pb-4"},{default:f(()=>[a("div",it,[n(o($),{onClick:t[0]||(t[0]=l=>g("improve")),disabled:r.isProcessing||d.value.improve,variant:"outline",class:"h-20 flex-col gap-2 rounded-xl border-border/50 bg-background/50 hover:bg-accent hover:border-accent transition-all duration-300"},{default:f(()=>[a("div",lt,[n(o(he),{class:"h-4 w-4"})]),a("span",ct,_(d.value.improve?"Improving...":"Improve"),1)]),_:1},8,["disabled"]),n(o($),{onClick:t[1]||(t[1]=l=>g("expand")),disabled:!r.selectedText||r.isProcessing||d.value.expand,variant:"outline",class:"h-20 flex-col gap-2 rounded-xl border-border/50 bg-background/50 hover:bg-accent hover:border-accent transition-all duration-300"},{default:f(()=>[a("div",dt,[n(o(ve),{class:"h-4 w-4"})]),a("span",ut,_(d.value.expand?"Expanding...":"Expand"),1)]),_:1},8,["disabled"]),n(o($),{onClick:t[2]||(t[2]=l=>g("cite")),disabled:r.isProcessing||d.value.cite,variant:"outline",class:"h-20 flex-col gap-2 rounded-xl border-border/50 bg-background/50 hover:bg-accent hover:border-accent transition-all duration-300"},{default:f(()=>[a("div",pt,[n(o(be),{class:"h-4 w-4"})]),a("span",gt,_(d.value.cite?"Citing...":"Cite"),1)]),_:1},8,["disabled"]),n(o($),{onClick:t[3]||(t[3]=l=>g("rephrase")),disabled:!r.selectedText||r.isProcessing||d.value.rephrase,variant:"outline",class:"h-20 flex-col gap-2 rounded-xl border-border/50 bg-background/50 hover:bg-accent hover:border-accent transition-all duration-300"},{default:f(()=>[a("div",mt,[n(o(xe),{class:"h-4 w-4"})]),a("span",ft,_(d.value.rephrase?"Rephrasing...":"Rephrase"),1)]),_:1},8,["disabled"])]),t[6]||(t[6]=a("div",{class:"p-3 rounded-lg bg-muted/50 border border-border/50"},[a("p",{class:"text-[10px] text-muted-foreground leading-relaxed"},[a("strong",null,"Tip:"),S(" Select text before using Expand or Rephrase. Improve and Cite work on your entire content. ")])],-1))]),_:1})]),_:1},8,["open"])]))}}),vt={key:0,class:"fixed inset-0 z-50 lg:hidden"},bt={class:"fixed top-0 left-0 h-full w-80 overflow-y-auto border-r bg-background shadow-xl transform transition-transform"},xt={class:"border-b p-3"},yt={class:"flex items-center justify-between"},wt={class:"space-y-4 p-4 mobile-enhanced"},_t={key:0,class:"fixed inset-0 z-50 lg:hidden"},Ct={class:"fixed top-0 right-0 h-full w-96 overflow-y-auto border-l bg-background shadow-xl transform transition-transform"},kt={class:"border-b p-3"},St={class:"flex items-center justify-between"},$t={class:"space-y-4 p-4 mobile-enhanced"},Tt={key:0,class:"space-y-2"},jt=U({__name:"MobileNavOverlay",props:{showLeftSidebar:{type:Boolean},showRightSidebar:{type:Boolean},isMobile:{type:Boolean},allChapters:{},currentChapter:{},project:{},facultyChapters:{},currentWordCount:{},targetWordCount:{},chapterContentLength:{},selectedText:{},isAnalyzing:{type:Boolean},isSaving:{type:Boolean},currentSuggestion:{},currentAnalysis:{},guidance:{},isLoadingGuidance:{type:Boolean},chapterContent:{},showCitationHelper:{type:Boolean},ensureBalance:{type:Function},onUsage:{type:Function}},emits:["update:showLeftSidebar","update:showRightSidebar","update:showCitationHelper","goToChapter","generateNextChapter","deleteChapter","saveSuggestion","clearSuggestion","applySuggestion","toggleStep","textImproved","textExpanded","citationsSuggested","textRephrased","insertCitation"],setup(h,{emit:c}){const i=h,s=c,p=C(!0),d=C(i.showCitationHelper);J(()=>i.showCitationHelper,e=>{d.value=e});const v=()=>s("update:showLeftSidebar",!1),y=()=>s("update:showRightSidebar",!1),g=e=>{d.value=e,s("update:showCitationHelper",e)},r=e=>{s("goToChapter",e),v()},t=()=>s("generateNextChapter"),l=e=>s("deleteChapter",e),x=e=>s("insertCitation",e);return(e,u)=>(b(),w("div",null,[n(I,{"enter-active-class":"duration-300 ease-out","enter-from-class":"opacity-0","enter-to-class":"opacity-100","leave-active-class":"duration-200 ease-in","leave-from-class":"opacity-100","leave-to-class":"opacity-0"},{default:f(()=>[e.showLeftSidebar&&e.isMobile?(b(),w("div",vt,[n(I,{"enter-active-class":"duration-300 ease-out","enter-from-class":"opacity-0","enter-to-class":"opacity-100","leave-active-class":"duration-200 ease-in","leave-from-class":"opacity-100","leave-to-class":"opacity-0"},{default:f(()=>[a("div",{class:"fixed inset-0 bg-black/50",onClick:v})]),_:1}),n(I,{"enter-active-class":"duration-300 ease-out","enter-from-class":"-translate-x-full","enter-to-class":"translate-x-0","leave-active-class":"duration-200 ease-in","leave-from-class":"translate-x-0","leave-to-class":"-translate-x-full"},{default:f(()=>[a("div",bt,[a("div",xt,[a("div",yt,[u[10]||(u[10]=a("h2",{class:"text-base font-semibold"},"Table of Contents",-1)),n(o($),{onClick:v,variant:"ghost",size:"sm",class:"h-8 w-8"},{default:f(()=>[n(o(H),{class:"h-4 w-4"})]),_:1})])]),a("div",wt,[n(ie,{"all-chapters":e.allChapters,"current-chapter":e.currentChapter,project:e.project,outlines:e.project.outlines||[],"faculty-chapters":e.facultyChapters||[],"current-word-count":e.currentWordCount,"target-word-count":e.targetWordCount,"writing-quality-score":0,"chapter-content-length":e.chapterContentLength,onGoToChapter:r,onGenerateNextChapter:t,onDeleteChapter:l},null,8,["all-chapters","current-chapter","project","outlines","faculty-chapters","current-word-count","target-word-count","chapter-content-length"])])])]),_:1})])):L("",!0)]),_:1}),n(I,{"enter-active-class":"duration-300 ease-out","enter-from-class":"opacity-0","enter-to-class":"opacity-100","leave-active-class":"duration-200 ease-in","leave-from-class":"opacity-100","leave-to-class":"opacity-0"},{default:f(()=>[e.showRightSidebar&&e.isMobile?(b(),w("div",_t,[n(I,{"enter-active-class":"duration-300 ease-out","enter-from-class":"opacity-0","enter-to-class":"opacity-100","leave-active-class":"duration-200 ease-in","leave-from-class":"opacity-100","leave-to-class":"opacity-0"},{default:f(()=>[a("div",{class:"fixed inset-0 bg-black/50",onClick:y})]),_:1}),n(I,{"enter-active-class":"duration-300 ease-out","enter-from-class":"translate-x-full","enter-to-class":"translate-x-0","leave-active-class":"duration-200 ease-in","leave-from-class":"translate-x-0","leave-to-class":"translate-x-full"},{default:f(()=>[a("div",Ct,[a("div",kt,[a("div",St,[u[11]||(u[11]=a("h2",{class:"text-base font-semibold"},"AI Tools",-1)),n(o($),{onClick:y,variant:"ghost",size:"sm",class:"h-8 w-8"},{default:f(()=>[n(o(H),{class:"h-4 w-4"})]),_:1})])]),a("div",$t,[e.currentSuggestion?(b(),w("div",Tt,[n(Pe,{suggestion:e.currentSuggestion,analysis:e.currentAnalysis,onSave:u[0]||(u[0]=m=>e.$emit("saveSuggestion",m)),onClear:u[1]||(u[1]=m=>e.$emit("clearSuggestion")),onApply:u[2]||(u[2]=m=>e.$emit("applySuggestion"))},null,8,["suggestion","analysis"]),n(o(E),{class:"bg-border/50"})])):L("",!0),n(at,{guidance:e.guidance,"is-loading":e.isLoadingGuidance,onToggleStep:u[3]||(u[3]=m=>e.$emit("toggleStep",m))},null,8,["guidance","is-loading"]),n(o(E),{class:"bg-border/50"}),n(ht,{"project-slug":e.project.slug,"chapter-number":e.currentChapter.chapter_number,"selected-text":e.selectedText,"chapter-content":e.chapterContent,"is-processing":e.isAnalyzing||e.isSaving,"ensure-balance":e.ensureBalance,"on-usage":e.onUsage,onTextImproved:u[4]||(u[4]=m=>e.$emit("textImproved",m)),onTextExpanded:u[5]||(u[5]=m=>e.$emit("textExpanded",m)),onCitationsSuggested:u[6]||(u[6]=m=>e.$emit("citationsSuggested",m)),onTextRephrased:u[7]||(u[7]=m=>e.$emit("textRephrased",m))},null,8,["project-slug","chapter-number","selected-text","chapter-content","is-processing","ensure-balance","on-usage"]),n(o(E),{class:"bg-border/50"}),n(fe,{"show-citation-helper":d.value,"onUpdate:showCitationHelper":[u[8]||(u[8]=m=>d.value=m),g],"chapter-content":e.chapterContent,onInsertCitation:x},null,8,["show-citation-helper","chapter-content"]),n(o(E),{class:"bg-border/50"}),n(ye,{"show-defense-prep":p.value,"onUpdate:showDefensePrep":u[9]||(u[9]=m=>p.value=m),questions:[],"is-loading":!1,"is-generating":!1,"chapter-context":{project:e.project,chapter:e.currentChapter,wordCount:e.currentWordCount},onGenerateMore:()=>{},onRefresh:()=>{}},null,8,["show-defense-prep","chapter-context"])])])]),_:1})])):L("",!0)]),_:1})]))}}),es=we(jt,[["__scopeId","data-v-4ca5dd74"]]);function ts(h,c){const i=C(h.content||""),s=C(!1),p=C(!1),d=C(null),v=e=>{i.value=e,s.value=!0,g()},y=async()=>{if(!(!s.value||p.value)){p.value=!0;try{await P.post(A("projects.manual-editor.save",{project:c,chapter:h.chapter_number}),{content:i.value}),s.value=!1,d.value=new Date().toLocaleTimeString()}catch(e){throw console.error("Failed to save chapter:",e),e}finally{p.value=!1}}},g=se(y,2e3),r=async()=>{if(!p.value){p.value=!0;try{return await P.post(A("projects.manual-editor.save",{project:c,chapter:h.chapter_number}),{content:i.value}),s.value=!1,d.value=new Date().toLocaleTimeString(),!0}catch(e){throw console.error("Failed to save chapter:",e),e}finally{p.value=!1}}},t=e=>{s.value&&(e.preventDefault(),e.returnValue="")},l=e=>{s.value&&!confirm("You have unsaved changes. Are you sure you want to leave?")&&e.preventDefault()};window.addEventListener("beforeunload",t);const x=ne.on("before",l);return oe(()=>{window.removeEventListener("beforeunload",t),x(),s.value&&y()}),{content:i,isDirty:s,isSaving:p,lastSaved:d,updateContent:v,save:y,manualSave:r}}class Y{static analyze(c){const s=new DOMParser().parseFromString(c,"text/html");return{word_count:this.countWords(s),citation_count:this.countCitations(s),table_count:this.countTables(s),figure_count:this.countFigures(s),claim_count:this.countClaims(s),has_introduction:this.hasIntroduction(s),has_conclusion:this.hasConclusion(s),detected_issues:this.detectIssues(s),quality_metrics:this.calculateQualityMetrics(s)}}static countWords(c){return(c.body.textContent||"").trim().split(/\s+/).filter(s=>s.length>0).length}static countCitations(c){const i=c.body.textContent||"",s=[/\([A-Z][a-z]+,?\s+\d{4}\)/g,/\[[0-9]+\]/g,/\([A-Z][a-z]+\s+et al\.,?\s+\d{4}\)/g];let p=0;return s.forEach(d=>{const v=i.match(d);v&&(p+=v.length)}),p+=c.querySelectorAll("cite, [data-citation]").length,p}static countTables(c){return c.querySelectorAll("table").length}static countFigures(c){return c.querySelectorAll("img, figure").length}static countClaims(c){const s=(c.body.textContent||"").split(/[.!?]+/),p=["demonstrates","proves","shows","indicates","reveals","confirms","establishes","suggests","implies","evidences"];return s.filter(d=>p.some(v=>d.toLowerCase().includes(v))).length}static hasIntroduction(c){const i=(c.body.textContent||"").toLowerCase();return["introduction","background","overview"].some(p=>i.includes(p))}static hasConclusion(c){const i=(c.body.textContent||"").toLowerCase();return["conclusion","summary","in summary"].some(p=>i.includes(p))}static detectIssues(c){const i=[],s=c.body.textContent||"",p=this.countClaims(c),d=this.countCitations(c);return p>0&&d===0&&i.push("claims_without_evidence"),p>d*2&&i.push("insufficient_citations"),s.toLowerCase().includes("methodology")&&this.countTables(c)===0&&i.push("insufficient_tables"),["maybe","might","could possibly","seems to"].some(t=>s.toLowerCase().includes(t))&&p>3&&i.push("weak_arguments"),this.countWords(c)<100&&i.push("insufficient_content"),i}static calculateQualityMetrics(c){const s=(c.body.textContent||"").split(/[.!?]+/).filter(v=>v.trim().length>0),p=c.querySelectorAll("p").length,d=s.length>0?this.countWords(c)/s.length:0;return{avg_sentence_length:Math.round(d),paragraph_count:p,reading_level:d>25?"complex":d>15?"moderate":"simple"}}}function ss(h,c,i,s,p){const d=C(i),v=C(null),y=C(!1),g=C(new Set),t=se(async()=>{if(!(s.value.length<100)&&!(!c||!h?.chapter_number)){y.value=!0;try{const u=Y.analyze(s.value);if(v.value=u,u.detected_issues.length===0){y.value=!1;return}const m=await P.post(A("projects.manual-editor.analyze",{project:c,chapter:h.chapter_number}),{analysis:u});if(m.data.suggestion){d.value=m.data.suggestion;const z=Number(m.data.suggestion?.id);if(z&&!g.value.has(z)){const B=R(m.data.suggestion?.suggestion_content||"");B>0&&(g.value.add(z),_e(B,"Manual editor: Smart suggestion","chapter",h.id).then(()=>p?.onUsageRecorded?.()).catch(Q=>console.error("Failed to record word usage (manual suggestion):",Q)))}}}catch(u){console.error("Failed to analyze and request suggestion:",u)}finally{y.value=!1}}},5e3);return J(s,()=>{s.value.length>0&&(v.value=Y.analyze(s.value)),t()}),{currentSuggestion:d,currentAnalysis:v,isAnalyzing:y,saveSuggestion:async()=>{if(d.value&&!(!c||!h?.chapter_number))try{await P.post(A("projects.manual-editor.suggestion.save",{project:c,chapter:h.chapter_number,suggestion:d.value.id})),k("Suggestion saved",{description:"You can refer to this suggestion later."})}catch{k("Failed to save suggestion",{description:"Please try again."})}},clearSuggestion:async()=>{if(d.value&&!(!c||!h?.chapter_number))try{await P.post(A("projects.manual-editor.suggestion.clear",{project:c,chapter:h.chapter_number,suggestion:d.value.id})),d.value=null}catch{k("Failed to clear suggestion",{description:"Please try again."})}},applySuggestion:async()=>{if(d.value&&!(!c||!h?.chapter_number))try{await P.post(A("projects.manual-editor.suggestion.apply",{project:c,chapter:h.chapter_number,suggestion:d.value.id})),k("Suggestion applied",{description:"The suggestion has been marked as applied."}),d.value=null}catch{k("Failed to apply suggestion",{description:"Please try again."})}}}}export{es as M,ht as _,ss as a,at as b,Pe as c,R as d,ts as u};
