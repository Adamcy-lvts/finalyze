const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/ChapterNavigation-hIRqQokA.js","assets/ChapterNavigation.vue_vue_type_script_setup_true_lang-DvOYcxmz.js","assets/index-BevM4Rk7.js","assets/vendor-DgjuSLrY.js","assets/vendor-CzjmNn-c.css","assets/ScrollArea.vue_vue_type_script_setup_true_lang-49R_KOXQ.js","assets/AlertDialogTitle.vue_vue_type_script_setup_true_lang-B7qHciLT.js","assets/index-CnOHeVck.js","assets/MobileNavOverlay-C5FrRAR8.js","assets/index-oG5WRuwW.js","assets/DefensePreparationPanel.vue_vue_type_script_setup_true_lang-jzFuR1YY.js","assets/CardContent.vue_vue_type_script_setup_true_lang-CzDqfk0_.js","assets/CardTitle.vue_vue_type_script_setup_true_lang-BXn45Ckp.js","assets/CollapsibleTrigger.vue_vue_type_script_setup_true_lang-DVD2QZ8J.js","assets/Progress.vue_vue_type_script_setup_true_lang-CETf-OHJ.js","assets/Separator.vue_vue_type_script_setup_true_lang-DTOSK7Ef.js","assets/Switch.vue_vue_type_script_setup_true_lang-CVqm-wvl.js","assets/_plugin-vue_export-helper-DlAUqK2U.js","assets/TooltipTrigger.vue_vue_type_script_setup_true_lang-D_wg_4gP.js","assets/WordBalanceDisplay.vue_vue_type_script_setup_true_lang-C0gsDeOo.js","assets/AppLayout.vue_vue_type_script_setup_true_lang-CmZycn6X.js","assets/UserInfo.vue_vue_type_script_setup_true_lang-Bih4cv7s.js","assets/Sonner.vue_vue_type_script_setup_true_lang-oHQkWKcv.js","assets/AppLogo.vue_vue_type_script_setup_true_lang-D9-Oer_g.js","assets/useAppearance-DInpb-p7.js","assets/useWordBalance-BwXIg5EW.js","assets/PWAInstallPrompt.vue_vue_type_script_setup_true_lang-BOOQAjSV.js","assets/AppLayout-Z7jpYWR6.css","assets/PurchaseModal.vue_vue_type_script_setup_true_lang-Dgi-Q1Xe.js","assets/DialogContent.vue_vue_type_script_setup_true_lang-DJU0p3Yl.js","assets/DialogDescription.vue_vue_type_script_setup_true_lang-Dnnzz5pW.js","assets/DialogFooter.vue_vue_type_script_setup_true_lang-C1W2HTa6.js","assets/DialogTitle.vue_vue_type_script_setup_true_lang-CMbLdFHY.js","assets/useChapterWordCount-BMZHnfAn.js","assets/Input.vue_vue_type_script_setup_true_lang-D350FEG5.js","assets/Label.vue_vue_type_script_setup_true_lang-Dev0TU-a.js","assets/RichTextEditor-BZy1q6qT.js","assets/vendor-tiptap-e7hIkjFs.js","assets/MermaidExtension-Dvf1XLzG.js","assets/vendor-mermaid-DeCWk54i.js","assets/MermaidExtension-DI7x6sFR.css","assets/RichTextEditor-DFoxDATl.css","assets/SelectLabel.vue_vue_type_script_setup_true_lang-aBb4OQPe.js","assets/SelectLabel-BFh8wlm9.css","assets/SelectValue.vue_vue_type_script_setup_true_lang-BB_zbU6x.js","assets/SelectGroup.vue_vue_type_script_setup_true_lang-BHVqKJc2.js","assets/useTextHistory-Dj2cnI_V.js","assets/Checkbox.vue_vue_type_script_setup_true_lang-EeZ0qRyW.js","assets/FeedbackPromptModal.vue_vue_type_script_setup_true_lang-BGMs75c4.js","assets/Textarea.vue_vue_type_script_setup_true_lang-OVMI9mdh.js","assets/MobileNavOverlay-CiJwra5Q.css","assets/ChatModeLayout-C-7mnFXs.js","assets/ChatModeLayout-Dr0PWGkM.css","assets/CitationVerificationLayout-Bjr0t6G-.js","assets/SafeHtmlText.vue_vue_type_script_setup_true_lang-CoLAQv_q.js"])))=>i.map(i=>d[i]);
import{ch as Rs,ci as te,cj as R,bs as g,ck as k,cl as W,ce as J,cm as Br,bD as Pe,bA as Re,cb as ie,bt as Je,cn as z,co as y,bE as e,cp as n,cq as r,cr as s,cs as l,ct as p,cu as Ve,cv as Ps,cw as ze,cx as Ne,cy as St,cz as Fs,cA as dt,cB as Q,cC as Xe,cD as Hr,cE as ss,cF as Me,cG as K,cH as rs,cI as ut,cJ as Ur,cK as Qr,cL as Kr,cM as Vr,cN as Xr,cO as Jr,cP as Yr,cQ as zs,cR as Zr,cS as ns,cT as lt,cU as Ct,cV as as,cW as os,cX as ls,cY as is,cZ as ds,c_ as us,c$ as en,d0 as cs,d1 as ps,d2 as gs,d3 as tn,d4 as sn,d5 as rn,d6 as nn,d7 as an,d8 as on,d9 as ln,da as dn,db as un,dc as cn,_ as it}from"./vendor-DgjuSLrY.js";import{_ as Fe}from"./index-CnOHeVck.js";import{_ as v}from"./index-BevM4Rk7.js";import{_ as ae,a as oe}from"./CardContent.vue_vue_type_script_setup_true_lang-CzDqfk0_.js";import{_ as le,a as me}from"./CardTitle.vue_vue_type_script_setup_true_lang-BXn45Ckp.js";import{_ as fs}from"./ScrollArea.vue_vue_type_script_setup_true_lang-49R_KOXQ.js";import{_ as Ke}from"./Separator.vue_vue_type_script_setup_true_lang-DTOSK7Ef.js";import{_ as B,a as H,b as U}from"./TooltipTrigger.vue_vue_type_script_setup_true_lang-D_wg_4gP.js";import{_ as pn}from"./WordBalanceDisplay.vue_vue_type_script_setup_true_lang-C0gsDeOo.js";import{_ as ms,a as hs,b as vs,c as bs,d as xs,e as ws,f as ys,g as _s}from"./AlertDialogTitle.vue_vue_type_script_setup_true_lang-B7qHciLT.js";import{_ as Cs,a as ks}from"./AppLayout.vue_vue_type_script_setup_true_lang-CmZycn6X.js";import{_ as gn}from"./PurchaseModal.vue_vue_type_script_setup_true_lang-Dgi-Q1Xe.js";import{r as fn,u as mn}from"./useWordBalance-BwXIg5EW.js";import{u as Ns}from"./useAppearance-DInpb-p7.js";import{u as hn,a as vn,b as bn}from"./useChapterWordCount-BMZHnfAn.js";import{_ as xn}from"./Input.vue_vue_type_script_setup_true_lang-D350FEG5.js";import{_ as wn}from"./Label.vue_vue_type_script_setup_true_lang-Dev0TU-a.js";import{R as Ms}from"./RichTextEditor-BZy1q6qT.js";import{R as Ls,_ as yn}from"./SelectLabel.vue_vue_type_script_setup_true_lang-aBb4OQPe.js";import{_ as Ss,a as Es,b as Ts}from"./CollapsibleTrigger.vue_vue_type_script_setup_true_lang-DVD2QZ8J.js";import{_ as _n}from"./Progress.vue_vue_type_script_setup_true_lang-CETf-OHJ.js";import{_ as Cn,a as kn,b as Sn,c as En,d as je}from"./SelectValue.vue_vue_type_script_setup_true_lang-BB_zbU6x.js";import{_ as Tn}from"./SelectGroup.vue_vue_type_script_setup_true_lang-BHVqKJc2.js";import{_ as An,u as $n,a as kt}from"./useTextHistory-Dj2cnI_V.js";import{_ as Os}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{_ as Dn}from"./FeedbackPromptModal.vue_vue_type_script_setup_true_lang-BGMs75c4.js";import"./UserInfo.vue_vue_type_script_setup_true_lang-Bih4cv7s.js";import"./Sonner.vue_vue_type_script_setup_true_lang-oHQkWKcv.js";import"./AppLogo.vue_vue_type_script_setup_true_lang-D9-Oer_g.js";import"./PWAInstallPrompt.vue_vue_type_script_setup_true_lang-BOOQAjSV.js";import"./DialogContent.vue_vue_type_script_setup_true_lang-DJU0p3Yl.js";import"./DialogDescription.vue_vue_type_script_setup_true_lang-Dnnzz5pW.js";import"./DialogFooter.vue_vue_type_script_setup_true_lang-C1W2HTa6.js";import"./DialogTitle.vue_vue_type_script_setup_true_lang-CMbLdFHY.js";import"./vendor-tiptap-e7hIkjFs.js";import"./MermaidExtension-Dvf1XLzG.js";import"./vendor-mermaid-DeCWk54i.js";import"./Checkbox.vue_vue_type_script_setup_true_lang-EeZ0qRyW.js";import"./Textarea.vue_vue_type_script_setup_true_lang-OVMI9mdh.js";function jn(m){const b=Rs();te(()=>b.props?.flash,O=>{O&&(O.success&&R.success(O.success),O.error&&R.error(O.error))},{deep:!0,immediate:!0});const i=g(m.chapter.title||""),$=g(m.chapter.content||""),N=g(!0),{isDark:a,toggle:C}=Ns(),f=k(()=>a.value),P=()=>{},x=()=>{C()},D=g(!1),S=g(!1),_=g(!1),c=g("write"),j=g(""),L=g(0),V=g(!1),de=g(!1),w=g(!0),u=()=>{try{return localStorage.getItem(`chatMode_${m.project.id}_${m.chapter.chapter_number}`)==="true"}catch(O){return console.warn("Failed to load chat mode from localStorage:",O),!1}},A=O=>{try{localStorage.setItem(`chatMode_${m.project.id}_${m.chapter.chapter_number}`,String(O))}catch(X){console.warn("Failed to save chat mode to localStorage:",X)}},Y=g(!1),ue=g(!1),E=g(!1),ce=g(!1),pe=g(!1),se=g(!0),ke=g(!0);return{chapterTitle:i,chapterContent:$,showPreview:N,isEditorDark:f,initChapterTheme:P,toggleChapterTheme:x,isNativeFullscreen:D,showAISidebar:S,showStatistics:_,activeTab:c,selectedText:j,cursorPosition:L,showChatMode:V,showCitationMode:de,showDefensePrep:w,loadChatModeFromStorage:u,saveChatModeToStorage:A,showLeftSidebar:Y,showRightSidebar:ue,isMobile:E,isLeftSidebarCollapsed:ce,isRightSidebarCollapsed:pe,showLeftSidebarInFullscreen:se,showRightSidebarInFullscreen:ke}}function Rn({props:m,allChapters:b,targetWordCount:i,estimates:$,ensureBalance:N,save:a}){return{generateNextChapter:async()=>{const f=$.chapter(i.value||0);if(!N(f,"generate the next chapter with AI"))return;await a();const P=b.map(S=>S.chapter_number).sort((S,_)=>S-_),x=P.indexOf(m.chapter.chapter_number);let D;if(x===-1||x===P.length-1)D=Math.max(...P)+1;else{const S=P[x+1];S===m.chapter.chapter_number+1?D=S:D=m.chapter.chapter_number+1}try{const S=W("chapters.write",{project:m.project.slug,chapter:D}),_=new URL(S,window.location.origin);_.searchParams.set("ai_generate","true"),_.searchParams.set("generation_type","progressive"),J.visit(_.toString())}catch(S){console.error("âŒ Error generating next chapter:",S)}}}}function Pn(m,b,i,$){const a=g(!1),C=g(0),f=g(!1),P=E=>{if(!E)return 0;const pe=E.replace(/<[^>]*>/g,"").trim().replace(/\s+/g," ");if(!pe)return 0;const se=pe.match(/\b\w+\b/g);return se?se.length:0},x=k(()=>P(i.value)),D=k(()=>x.value>=800),S=()=>`defense_generation_triggered_${m.id}_ch_${b.chapter_number}`,_=()=>{const E=S();return localStorage.getItem(E)==="true"},c=()=>{const E=S();localStorage.setItem(E,"true"),a.value=!0},j=()=>{const E=S();localStorage.removeItem(E),a.value=!1,console.log(`ðŸ”„ DEFENSE WATCHER: Reset generation trigger for Chapter ${b.chapter_number}`)},L=Br(async()=>{if(!f.value)return;const E=x.value;console.log(`ðŸ“Š DEFENSE WATCHER: Word count check - Chapter ${b.chapter_number}: ${E} words`),E<800*.8&&a.value&&(console.log("â¬‡ï¸ DEFENSE WATCHER: Content dropped below 80% of threshold, resetting trigger"),j()),C.value=E},2e3),V=()=>f.value?void 0:(f.value=!0,a.value=_(),C.value=x.value,console.log(`ðŸ‘€ DEFENSE WATCHER: Started watching Chapter ${b.chapter_number}`),console.log(`   Initial word count: ${C.value}`),console.log(`   Generation already triggered: ${a.value}`),console.log("   Threshold: 800 words"),te(i,(ce,pe)=>{ce!==pe&&L()},{immediate:!1})),de=()=>{f.value=!1,L.cancel(),console.log(`ðŸ›‘ DEFENSE WATCHER: Stopped watching Chapter ${b.chapter_number}`)},w=async()=>{console.log(`ðŸ” DEFENSE WATCHER: Force checking Chapter ${b.chapter_number}`),await L(),L.flush()},u=k(()=>{const E=x.value;return E>0&&E<800&&!a.value}),A=k(()=>{const E=x.value/800*100;return Math.min(E,100)}),Y=k(()=>{const E=800-x.value;return Math.max(E,0)});return{isWatching:f,hasTriggeredGeneration:a,currentWordCount:x,lastWordCount:C,meetsThreshold:D,shouldShowProgressIndicator:u,progressPercentage:A,wordsRemaining:Y,startWatching:V,stopWatching:de,forceCheck:w,resetGenerationTrigger:j,markGenerationTriggered:c,getStatusMessage:()=>{const E=x.value;return a.value?`Defense questions available (${E} words)`:E>=800?`Ready for defense questions (${E} words)`:E>0?`${800-E} more words needed for defense questions`:"Start writing to enable defense questions (800 words needed)"},countWords:P,DEFENSE_WORD_COUNT_THRESHOLD:800}}function Fn({props:m,chapterContent:b,currentWordCount:i,ensureBalance:$,estimates:N}){const a=g([]),C=g(!1),f=g(!1),P=g(null),x=g(!1),D=k(()=>m.chapter),{hasTriggeredGeneration:S,startWatching:_,stopWatching:c,forceCheck:j,getStatusMessage:L,markGenerationTriggered:V,meetsThreshold:de,shouldShowProgressIndicator:w,progressPercentage:u,wordsRemaining:A,DEFENSE_WORD_COUNT_THRESHOLD:Y}=Pn(m.project,m.chapter,b),ue=(h,M)=>`defense_auto_generate_${h}_ch_${M}`,E=()=>{try{return localStorage.getItem(ue(m.project.id,m.chapter.chapter_number))==="true"}catch(h){return console.warn("Failed to load defense auto-generation preference:",h),!1}},ce=h=>{try{localStorage.setItem(ue(m.project.id,m.chapter.chapter_number),String(h))}catch(M){console.warn("Failed to save defense auto-generation preference:",M)}};x.value=E();const pe=()=>{if(!a.value.length||!P.value)return!0;const h=new Date(Date.now()-360*60*1e3);return P.value<h},se=async(h=!1,M={})=>{if(C.value)return;const q=M.skipGeneration??!0;C.value=!0;try{console.log("Loading defense questions with params:",{project_id:m.project.id,chapter_number:D.value?.chapter_number,limit:5,force_refresh:h,skip_generation:q});const T=await ie.get(`/api/projects/${m.project.id}/defense/questions`,{params:{chapter_number:D.value?.chapter_number||null,limit:5,force_refresh:h?1:0,skip_generation:q?1:0},headers:{Accept:"application/json","X-Requested-With":"XMLHttpRequest"}});if(console.log("Defense questions loaded:",T.data),a.value=T.data.questions||[],P.value=new Date,T.data.questions&&T.data.questions.length>0){const G=`defense_questions_${m.project.id}_chapter_${D.value?.chapter_number}`;localStorage.setItem(G,JSON.stringify({questions:T.data.questions,chapter_number:D.value?.chapter_number,loaded_at:new Date().toISOString()}))}else h||(console.log("No existing questions found for this chapter"),console.log(`Current word count: ${i.value}/${Y}`),console.log('User must click "Generate Questions" button to create defense questions'))}catch(T){if(console.error("Failed to load defense questions:",T),T.response)if(console.error("Response status:",T.response.status),console.error("Response data:",T.response.data),T.response.status===422){const G=Object.values(T.response.data.errors||{})[0];G&&Array.isArray(G)?R.error(`Validation Error: ${G[0]}`):R.error("Invalid request parameters. Please refresh the page.")}else T.response.status===500?R.error("Server error. Please try again later."):R.error("Failed to load defense questions");else T.request?(console.error("No response received:",T.request),R.error("Network error. Please check your connection.")):(console.error("Error setting up request:",T.message),R.error("An unexpected error occurred"));a.value=[]}finally{C.value=!1}},ke=h=>h?h.replace(/<[^>]*>/g," ").trim().split(/\s+/).filter(M=>M.length>0).length:0,O=async(h={})=>{if(f.value)return;const M=h.autoTriggered??!1,q=N.defense();if($(q,"generate defense questions")){f.value=!0;try{const T=await ie.post(`/api/projects/${m.project.id}/defense/questions/generate`,{chapter_number:D.value.chapter_number},{headers:{"X-CSRF-TOKEN":document.querySelector('meta[name="csrf-token"]')?.getAttribute("content"),Accept:"application/json","Content-Type":"application/json"}});if(T.data&&T.data.questions){a.value=T.data.questions,P.value=new Date;const G=T.data.questions.reduce((F,De)=>{const Oe=ke(De.question),et=ke(De.suggested_answer),tt=(De.key_points||[]).reduce((re,ge)=>re+ke(ge),0);return F+Oe+et+tt},0),Z=`defense_questions_${m.project.id}_chapter_${D.value?.chapter_number}`;localStorage.setItem(Z,JSON.stringify({questions:T.data.questions,chapter_number:D.value?.chapter_number,loaded_at:new Date().toISOString()})),R.success(`Generated ${T.data.questions.length} new questions`),fn(G||N.defense(),"Defense questions","chapter",m.chapter.id).catch(F=>console.error("Failed to record word usage (defense):",F)),S.value=!0,V(),M&&console.log("Auto-generated defense questions after meeting threshold.")}}catch(T){console.error("Failed to generate defense questions:",T),R.error("Failed to generate defense questions")}finally{f.value=!1}}},X=async()=>{!x.value||f.value||C.value||S.value||!de.value||a.value.length>0||await O({autoTriggered:!0})},Ye=h=>{x.value=h,ce(h),h&&X()},$e=async(h,M)=>{try{await ie.patch(`/api/projects/${m.project.id}/defense/questions/${h}`,{user_marked_helpful:M},{headers:{"X-CSRF-TOKEN":document.querySelector('meta[name="csrf-token"]')?.getAttribute("content"),Accept:"application/json","Content-Type":"application/json"}});const q=a.value.find(T=>T.id===h);q&&(q.user_marked_helpful=M),R.success(M?"Question marked as helpful":"Removed helpful mark")}catch(q){console.error("Failed to mark question:",q),R.error("Failed to update question")}},Ze=async h=>{try{await ie.delete(`/api/projects/${m.project.id}/defense/questions/${h}`,{headers:{"X-CSRF-TOKEN":document.querySelector('meta[name="csrf-token"]')?.getAttribute("content"),Accept:"application/json"}}),a.value=a.value.filter(M=>M.id!==h),localStorage.setItem(`defense_questions_${m.project.id}`,JSON.stringify({questions:a.value,loaded_at:new Date().toISOString()})),R.success("Question hidden")}catch(M){console.error("Failed to hide question:",M),R.error("Failed to hide question")}},Le=async()=>{const h=`defense_questions_${m.project.id}_chapter_${D.value?.chapter_number}`,M=localStorage.getItem(h);let q=!0;if(M){const T=JSON.parse(M),G=new Date(T.loaded_at),Z=new Date(Date.now()-360*60*1e3);G>Z&&T.chapter_number===D.value?.chapter_number&&(a.value=T.questions,P.value=G,q=!1)}q&&await se(!1,{skipGeneration:!0})};return te(()=>m.chapter,async()=>{a.value=[],c(),_(),x.value=E(),await se(!1,{skipGeneration:!0}),await Pe(()=>{j(),X()})},{immediate:!1}),te([i,x],()=>{X()}),Re(async()=>{await Le(),_(),await Pe(()=>{j(),X()})}),{defenseQuestions:a,isLoadingDefenseQuestions:C,isGeneratingDefenseQuestions:f,autoGenerateDefense:x,shouldLoadDefenseQuestions:pe,loadDefenseQuestions:se,generateNewDefenseQuestions:O,markQuestionHelpful:$e,hideQuestion:Ze,handleDefenseAutoToggle:Ye,attemptAutoGenerateDefense:X,getDefenseStatusMessage:L,shouldShowDefenseProgress:w,defenseProgressPercentage:u,defenseWordsRemaining:A,hasTriggeredGeneration:S,meetsDefenseThreshold:de}}const zn={class:"flex items-center justify-between"},Nn={class:"space-y-1 w-full max-w-[520px]"},Mn={class:"flex items-center justify-between gap-3"},Ln={class:"flex flex-col"},On={class:"flex items-center gap-2"},qn={class:"flex items-center justify-between px-6 py-2 border-b border-border/30 bg-muted/5"},Wn={class:"flex items-center gap-2"},Gn={class:"space-y-1 relative z-10"},In={class:"text-sm font-medium text-foreground"},Bn={class:"text-[10px] text-muted-foreground line-clamp-2 leading-relaxed"},Hn={class:"flex-1 relative bg-background"},Un={class:"px-12 py-10 min-h-[500px]"},Qn={class:"sticky bottom-0 z-10 border-t border-border/30 bg-background/80 backdrop-blur-md p-4 flex items-center justify-between"},Kn={class:"text-xs text-muted-foreground"},Vn={class:"flex items-center gap-2"},As=Je({__name:"ChapterEditorPaperCard",props:{context:{}},setup(m){const i=m.context,$=k(()=>{const C=i.getSectionInfo(i.nextSection);return i.aiChapterAnalysis?.section||C}),N=k(()=>$.value?.name||""),a=k(()=>$.value?.description||"");return(C,f)=>(y(),z(e(ae),{class:"w-full max-w-[850px] min-h-[calc(100vh-180px)] flex flex-col bg-background shadow-xl shadow-black/5 ring-1 ring-black/5 dark:ring-white/10 rounded-xl overflow-hidden transition-all duration-300"},{default:n(()=>[r(e(le),{class:"flex-shrink-0 border-b border-border/30 px-8 py-6 bg-background/50 backdrop-blur-sm sticky top-0 z-10"},{default:n(()=>[s("div",zn,[s("div",Nn,[s("div",Mn,[s("div",Ln,[r(e(wn),{for:"chapter-title",class:"text-xs font-medium text-zinc-500 dark:text-zinc-400 uppercase tracking-wider"},{default:n(()=>[...f[3]||(f[3]=[l("Chapter Title",-1)])]),_:1}),r(e(xn),{id:"chapter-title",modelValue:e(i).chapterTitle,"onUpdate:modelValue":f[0]||(f[0]=P=>e(i).chapterTitle=P),placeholder:"Enter chapter title...",class:"h-auto p-0 border-0 bg-transparent text-2xl font-bold placeholder:text-muted-foreground/40 focus-visible:ring-0 px-0 text-foreground"},null,8,["modelValue"])]),s("div",On,[r(e(Fe),{variant:e(i).chapter.status==="approved"?"default":"secondary",class:"rounded-full px-3"},{default:n(()=>[l(p(e(i).chapter.status.replace("_"," ")),1)]),_:1},8,["variant"]),r(e(Fe),{variant:"outline",class:Ve(["rounded-full px-3 transition-colors",{"text-green-600 border-green-200 bg-green-50 dark:bg-green-900/20 dark:border-green-800":(e(i).latestAnalysis?.total_score||0)>=80,"text-yellow-600 border-yellow-200 bg-yellow-50 dark:bg-yellow-900/20 dark:border-yellow-800":(e(i).latestAnalysis?.total_score||0)>=70&&(e(i).latestAnalysis?.total_score||0)<80,"text-orange-600 border-orange-200 bg-orange-50 dark:bg-orange-900/20 dark:border-orange-800":(e(i).latestAnalysis?.total_score||0)>=60&&(e(i).latestAnalysis?.total_score||0)<70,"text-red-600 border-red-200 bg-red-50 dark:bg-red-900/20 dark:border-red-800":(e(i).latestAnalysis?.total_score||0)<60}])},{default:n(()=>[l(p(e(i).latestAnalysis?.total_score?Math.round(e(i).latestAnalysis.total_score):e(i).writingQualityScore)+"% Quality ",1)]),_:1},8,["class"])])])])])]),_:1}),r(e(oe),{class:"flex min-h-0 flex-1 flex-col p-0"},{default:n(()=>[s("div",qn,[s("div",Wn,[r(e(v),{onClick:e(i).togglePresentationMode,variant:e(i).showPresentationMode?"default":"ghost",size:"sm",class:"h-7 text-xs rounded-full text-zinc-700 dark:text-zinc-300 hover:text-foreground"},{default:n(()=>[r(e(Ps),{class:"mr-1.5 h-3.5 w-3.5"}),l(" "+p(e(i).showPresentationMode?"Edit":"Preview"),1)]),_:1},8,["onClick","variant"])]),s("div",Gn,[s("div",In,p(N.value),1),s("div",Bn,p(a.value),1)])]),s("div",Hn,[ze(r(Ms,{modelValue:e(i).chapterContent,"onUpdate:modelValue":f[1]||(f[1]=P=>e(i).chapterContent=P),placeholder:"Start writing your chapter...","min-height":"500px",class:"min-h-[500px] px-8 py-6",ref:e(i).richTextEditor,"show-toolbar":!0,"streaming-mode":e(i).isStreamingMode,"is-generating":e(i).isGenerating,"generation-progress":e(i).generationProgress,"generation-percentage":e(i).generationPercentage,"generation-phase":e(i).generationPhase,"onUpdate:selectedText":e(i).setSelectedText},null,8,["modelValue","streaming-mode","is-generating","generation-progress","generation-percentage","generation-phase","onUpdate:selectedText"]),[[Ne,!e(i).showPresentationMode]]),ze(s("div",Un,[r(Ls,{content:e(i).chapterContent,"show-font-controls":!1,class:"prose-lg mx-auto",style:{"font-family":"'Times New Roman', serif","line-height":"1.8"}},null,8,["content"])],512),[[Ne,e(i).showPresentationMode]])])]),_:1}),s("div",Qn,[s("div",Kn,p(e(i).isSaving?"Saving...":"All changes saved"),1),s("div",Vn,[r(e(v),{onClick:f[2]||(f[2]=()=>e(i).save(!1)),disabled:!e(i).isValid||e(i).isSaving,size:"sm",variant:"ghost",class:"h-8 rounded-full text-zinc-700 dark:text-zinc-300 hover:text-foreground"},{default:n(()=>[r(e(St),{class:"mr-2 h-3.5 w-3.5"}),f[4]||(f[4]=l(" Save Draft ",-1))]),_:1},8,["disabled"]),r(e(v),{onClick:e(i).goToBulkAnalysis,variant:"outline",size:"sm",class:"h-8 rounded-full"},{default:n(()=>[r(e(Fs),{class:"mr-2 h-3.5 w-3.5"}),f[5]||(f[5]=l(" Run Bulk Analysis ",-1))]),_:1},8,["onClick"]),r(e(v),{onClick:e(i).markAsComplete,disabled:e(i).isSaving,size:"sm",class:"h-8 rounded-full bg-gradient-to-r from-primary to-primary/90 shadow-sm hover:shadow-md transition-all"},{default:n(()=>[r(e(dt),{class:"mr-2 h-3.5 w-3.5"}),f[6]||(f[6]=l(" Complete ",-1))]),_:1},8,["onClick","disabled"])])])]),_:1}))}}),Xn={class:"flex flex-col gap-4 p-1"},Jn={class:"p-1.5 rounded-lg bg-primary/10 text-primary"},Yn={class:"flex items-center gap-2"},Zn={class:"space-y-3"},ea={key:0,class:"space-y-2"},ta={class:"flex items-center justify-between w-full relative z-10"},sa={class:"flex items-center gap-2 text-primary"},ra={class:"space-y-1 relative z-10"},na={class:"text-sm font-medium text-foreground"},aa={class:"text-[10px] text-muted-foreground line-clamp-2 leading-relaxed"},oa={key:0,class:"p-4 rounded-xl bg-green-500/10 border border-green-500/20 space-y-3"},la={class:"flex items-center gap-2 text-green-600 dark:text-green-400"},ia={class:"space-y-2"},da={class:"flex justify-between text-[10px] font-medium text-muted-foreground"},ua={class:"grid grid-cols-2 gap-2 mt-2"},ca={class:"p-1.5 rounded-full bg-blue-500/10 text-blue-500"},pa={class:"p-1.5 rounded-full bg-purple-500/10 text-purple-500"},ga={class:"p-1.5 rounded-full bg-orange-500/10 text-orange-500"},fa={class:"p-1.5 rounded-full bg-emerald-500/10 text-emerald-500"},ma={class:"p-1.5 rounded-full bg-amber-500/10 text-amber-500"},ha={class:"flex items-center gap-2"},va={class:"p-1"},ba=Je({__name:"AISidebar",props:{project:{},chapter:{},isGenerating:{type:Boolean},selectedText:{},isLoadingSuggestions:{type:Boolean},showCitationHelper:{type:Boolean},chapterContent:{},cursorPosition:{},currentWordCount:{},targetWordCount:{},canUndo:{type:Boolean}},emits:["startStreamingGeneration","getAISuggestions","update:showCitationHelper","insert-citation","checkCitations","undoLastAction"],setup(m,{emit:b}){const i=m,$=b,N=g(i.project.settings?.writing_style||"Auto"),a=g(null),C=g(!1),f=g({expand:!1,improve:!1,rephrase:!1,cite:!1,"generate-full":!1,"generate-section":!1,custom:!1});te(N,async w=>{try{await ie.patch(route("projects.update",i.project.slug),{settings:{...i.project.settings||{},writing_style:w}}),R.success("Writing style saved")}catch(u){console.error("Failed to save writing style:",u),R.error("Failed to save preferences")}});const P=k(()=>!!i.chapter?.id&&!!i.chapter?.chapter_number),x=k(()=>i.chapterContent&&i.chapterContent.trim().length>0);k(()=>!x.value&&P.value),k(()=>!a.value&&P.value);const D=k(()=>!i.isGenerating&&!!i.chapterContent);k(()=>!i.isLoadingSuggestions&&!!i.selectedText);const S=k(()=>a.value&&a.value.section.name!=="NONE"?a.value.section.name.toLowerCase().replace(/\s+/g,"_"):L()),_=k(()=>!i.isGenerating&&!!i.chapter?.id),c=()=>[{id:"introduction",name:"Introduction",description:"Overview and objectives of this chapter"},{id:"content",name:"Main Content",description:"Chapter main content"},{id:"conclusion",name:"Conclusion",description:"Summary and transition to next chapter"}],j=async(w,u)=>{if(Object.values(f.value).some(A=>A)){R("Please wait for the current action to complete");return}try{switch(w in f.value&&(f.value[w]=!0),w){case"expand":i.selectedText?($("startStreamingGeneration","expand",{selectedText:i.selectedText,style:N.value}),R("Expanding selected text...")):R.error("Please select text to expand");break;case"improve":$("startStreamingGeneration","improve",{style:N.value}),R("Improving chapter content...");break;case"rephrase":i.selectedText?($("startStreamingGeneration","rephrase",{selectedText:i.selectedText,style:N.value}),R("Rephrasing selected text...")):R.error("Please select text to rephrase");break;case"cite":$("update:showCitationHelper",!0),R("Opening citation helper...");break;case"generate-full":$("startStreamingGeneration","progressive"),R("Generating complete chapter...");break;case"generate-section":const A=u?.section||S.value;$("startStreamingGeneration","section",{section:A,mode:"progressive"}),R(`Generating ${A} section...`);break;default:throw new Error(`Unknown action: ${w}`)}}catch(A){console.error(`Quick action '${w}' failed:`,A),R.error(`Failed to ${w.replace("-"," ")}. Please try again.`)}finally{setTimeout(()=>{w in f.value&&(f.value[w]=!1)},1e3)}},L=()=>{if(!x.value)return"introduction";const w=i.chapterContent.toLowerCase(),u=c();for(const A of u)if(![A.name.toLowerCase(),A.id.replace("_"," ")].some(E=>w.includes(E)))return A.id;return"conclusion"},V=w=>{const u=c();return u.find(A=>A.id===w)||u[0]},de=w=>{$("insert-citation",w)};return te(()=>i.chapter,w=>{w?.id&&(a.value=null)},{immediate:!1}),te(()=>i.chapterContent,w=>{a.value&&(!w||w.trim().length===0)&&(a.value=null)},{immediate:!1}),(w,u)=>(y(),Q("div",Xn,[r(e(ae),{class:"border-none shadow-none bg-transparent"},{default:n(()=>[r(e(le),{class:"px-2 py-3"},{default:n(()=>[r(e(me),{class:"flex items-center gap-2 text-sm font-semibold text-foreground/80"},{default:n(()=>[s("div",Jn,[r(e(Xe),{class:"h-4 w-4"})]),u[9]||(u[9]=l(" AI Assistant ",-1))]),_:1})]),_:1}),r(e(oe),{class:"px-2 space-y-6"},{default:n(()=>[r(e(Ss),{open:!0,class:"space-y-2"},{default:n(()=>[r(e(Es),{class:"flex w-full items-center justify-between text-xs font-medium text-muted-foreground hover:text-foreground transition-colors group"},{default:n(()=>[s("span",Yn,[r(e(Hr),{class:"h-3.5 w-3.5 text-amber-500/70 group-hover:text-amber-500 transition-colors"}),u[10]||(u[10]=l(" QUICK ACTIONS ",-1))]),r(e(ss),{class:"h-3 w-3 transition-transform duration-200 group-data-[state=open]:rotate-180"})]),_:1}),r(e(Ts),{class:"space-y-3 pt-1"},{default:n(()=>[s("div",Zn,[r(Me,{"enter-active-class":"transition-all duration-300 ease-out","enter-from-class":"opacity-0 scale-95 translate-y-1","enter-to-class":"opacity-100 scale-100 translate-y-0"},{default:n(()=>[a.value&&a.value.show_section_button?(y(),Q("div",ea,[r(e(v),{onClick:u[0]||(u[0]=A=>j("generate-section")),disabled:!_.value||C.value||w.isGenerating||f.value["generate-section"],variant:"outline",class:"w-full h-auto flex-col items-start gap-2 p-3 rounded-xl border-primary/20 bg-background/50 hover:bg-primary/5 hover:border-primary/40 transition-all duration-300 text-left group relative overflow-hidden"},{default:n(()=>[u[12]||(u[12]=s("div",{class:"absolute inset-0 bg-gradient-to-r from-primary/5 to-transparent opacity-0 group-hover:opacity-100 transition-opacity"},null,-1)),s("div",ta,[s("div",sa,[r(e(rs),{class:"h-3.5 w-3.5"}),u[11]||(u[11]=s("span",{class:"text-xs font-semibold"},"Write Next Section",-1))]),f.value["generate-section"]?(y(),z(e(ut),{key:0,class:"h-3 w-3 animate-spin text-primary"})):K("",!0)]),s("div",ra,[s("div",na,p(a.value?.section.name||V(S.value).name),1),s("div",aa,p(a.value?.section.description||V(S.value).description),1)])]),_:1},8,["disabled"])])):K("",!0)]),_:1}),r(Me,{"enter-active-class":"transition-all duration-300 ease-out","enter-from-class":"opacity-0 scale-95 translate-y-1","enter-to-class":"opacity-100 scale-100 translate-y-0"},{default:n(()=>[a.value&&a.value.show_full_chapter_button?(y(),z(e(v),{key:0,onClick:u[1]||(u[1]=A=>j("generate-full")),disabled:w.isGenerating||C.value||f.value["generate-full"],variant:"ghost",class:"w-full h-9 justify-start gap-2 px-3 rounded-lg text-xs text-muted-foreground hover:text-primary hover:bg-primary/5"},{default:n(()=>[r(e(Ur),{class:"h-3.5 w-3.5"}),u[13]||(u[13]=s("span",null,"Generate Complete Chapter",-1))]),_:1},8,["disabled"])):K("",!0)]),_:1}),r(Me,{"enter-active-class":"transition-all duration-500 ease-out","enter-from-class":"opacity-0 scale-95 translate-y-2","enter-to-class":"opacity-100 scale-100 translate-y-0"},{default:n(()=>[a.value&&a.value.status==="COMPLETE"?(y(),Q("div",oa,[s("div",la,[r(e(Qr),{class:"h-4 w-4"}),u[14]||(u[14]=s("span",{class:"text-sm font-semibold"},"Chapter Complete",-1))]),s("div",ia,[s("div",da,[u[15]||(u[15]=s("span",null,"Progress",-1)),s("span",null,p(a.value.completion_percentage)+"%",1)]),r(e(_n),{"model-value":a.value.completion_percentage,class:"h-1.5"},null,8,["model-value"])])])):K("",!0)]),_:1})]),s("div",ua,[r(e(v),{onClick:u[2]||(u[2]=A=>j("improve")),disabled:!D.value||w.isGenerating||f.value.improve,variant:"outline",class:"h-20 flex-col gap-2 rounded-xl border-border/50 bg-background/50 hover:bg-accent hover:border-accent transition-all duration-300"},{default:n(()=>[s("div",ca,[r(e(Kr),{class:"h-4 w-4"})]),u[16]||(u[16]=s("span",{class:"text-xs font-medium"},"Improve",-1))]),_:1},8,["disabled"]),r(e(v),{onClick:u[3]||(u[3]=A=>j("expand")),disabled:!w.selectedText||w.isGenerating||f.value.expand,variant:"outline",class:"h-20 flex-col gap-2 rounded-xl border-border/50 bg-background/50 hover:bg-accent hover:border-accent transition-all duration-300"},{default:n(()=>[s("div",pa,[r(e(Vr),{class:"h-4 w-4"})]),u[17]||(u[17]=s("span",{class:"text-xs font-medium"},"Expand",-1))]),_:1},8,["disabled"]),r(e(v),{onClick:u[4]||(u[4]=A=>j("cite")),disabled:w.isGenerating||f.value.cite,variant:"outline",class:"h-20 flex-col gap-2 rounded-xl border-border/50 bg-background/50 hover:bg-accent hover:border-accent transition-all duration-300"},{default:n(()=>[s("div",ga,[r(e(Xr),{class:"h-4 w-4"})]),u[18]||(u[18]=s("span",{class:"text-xs font-medium"},"Cite",-1))]),_:1},8,["disabled"]),r(e(v),{onClick:u[5]||(u[5]=A=>j("rephrase")),disabled:!w.selectedText||w.isGenerating||f.value.rephrase,variant:"outline",class:"h-20 flex-col gap-2 rounded-xl border-border/50 bg-background/50 hover:bg-accent hover:border-accent transition-all duration-300"},{default:n(()=>[s("div",fa,[r(e(Jr),{class:"h-4 w-4"})]),u[19]||(u[19]=s("span",{class:"text-xs font-medium"},"Rephrase",-1))]),_:1},8,["disabled"]),w.canUndo?(y(),z(e(v),{key:0,onClick:u[6]||(u[6]=A=>$("undoLastAction")),variant:"outline",class:"h-20 flex-col gap-2 rounded-xl border-border/50 bg-background/50 hover:bg-amber-500/10 hover:border-amber-500/30 transition-all duration-300 col-span-2"},{default:n(()=>[s("div",ma,[r(e(Yr),{class:"h-4 w-4"})]),u[20]||(u[20]=s("span",{class:"text-xs font-medium"},"Undo Last AI Change",-1))]),_:1})):K("",!0)])]),_:1})]),_:1}),r(e(Ke),{class:"bg-border/50"}),r(e(Ss),{open:!0,class:"space-y-2"},{default:n(()=>[r(e(Es),{class:"flex w-full items-center justify-between text-xs font-medium text-muted-foreground hover:text-foreground transition-colors group"},{default:n(()=>[s("span",ha,[r(e(rs),{class:"h-3.5 w-3.5 text-indigo-500/70 group-hover:text-indigo-500 transition-colors"}),u[21]||(u[21]=l(" WRITING STYLE ",-1))]),r(e(ss),{class:"h-3 w-3 transition-transform duration-200 group-data-[state=open]:rotate-180"})]),_:1}),r(e(Ts),{class:"pt-1"},{default:n(()=>[s("div",va,[r(e(Cn),{modelValue:N.value,"onUpdate:modelValue":u[7]||(u[7]=A=>N.value=A)},{default:n(()=>[r(e(kn),{class:"w-full bg-muted/30 border-border/50 text-xs font-medium h-9"},{default:n(()=>[r(e(Sn),{placeholder:"Select style"})]),_:1}),r(e(En),null,{default:n(()=>[r(e(Tn),null,{default:n(()=>[r(e(yn),{class:"text-[10px] text-muted-foreground uppercase tracking-wider"},{default:n(()=>[...u[22]||(u[22]=[l(" Style Preference",-1)])]),_:1}),r(e(je),{value:"Auto"},{default:n(()=>[...u[23]||(u[23]=[s("div",{class:"flex flex-col gap-0.5"},[s("span",{class:"font-medium"},"Auto (AI Decides)"),s("span",{class:"text-[10px] text-muted-foreground"},"Best fit for the content")],-1)])]),_:1}),r(e(je),{value:"Academic Formal"},{default:n(()=>[...u[24]||(u[24]=[l("Academic Formal",-1)])]),_:1}),r(e(je),{value:"Academic Casual"},{default:n(()=>[...u[25]||(u[25]=[l("Academic Casual",-1)])]),_:1}),r(e(je),{value:"Technical"},{default:n(()=>[...u[26]||(u[26]=[l("Technical",-1)])]),_:1}),r(e(je),{value:"Analytical"},{default:n(()=>[...u[27]||(u[27]=[l("Analytical",-1)])]),_:1}),r(e(je),{value:"Research-Heavy"},{default:n(()=>[...u[28]||(u[28]=[l("Research-Heavy",-1)])]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"])])]),_:1})]),_:1})]),_:1})]),_:1}),r(An,{"show-citation-helper":w.showCitationHelper,"chapter-content":w.chapterContent,"chapter-id":w.chapter?.id||0,"onUpdate:showCitationHelper":u[8]||(u[8]=A=>$("update:showCitationHelper",A)),onInsertCitation:de},null,8,["show-citation-helper","chapter-content","chapter-id"])]))}}),xa=Os(ba,[["__scopeId","data-v-e30bcf5b"]]),wa={class:"h-14 flex items-center justify-between px-4 border-b border-border/40 shrink-0"},ya={class:"flex-1 overflow-y-auto custom-scrollbar"},_a={class:"p-4 space-y-6"},$s=Je({__name:"ChapterEditorRightSidebar",props:{project:{},chapter:{},isGenerating:{type:Boolean},selectedText:{},isLoadingSuggestions:{type:Boolean},showCitationHelper:{type:Boolean},chapterContent:{},currentWordCount:{},targetWordCount:{},handleAIGeneration:{type:Function},getAISuggestions:{type:Function},updateCitationHelper:{type:Function},insertCitation:{type:Function},checkCitations:{type:Function},showDefensePrep:{type:Boolean},defenseQuestions:{},isLoadingDefenseQuestions:{type:Boolean},isGeneratingDefenseQuestions:{type:Boolean},chapterContext:{},defenseWatcher:{},autoGenerateDefense:{type:Boolean},handleDefensePanelToggle:{type:Function},generateNewDefenseQuestions:{type:Function},handleDefenseAutoToggle:{type:Function},refreshDefenseQuestions:{type:Function},markQuestionHelpful:{type:Function},hideQuestion:{type:Function},isCollapsed:{type:Boolean},containerClass:{}},setup(m){const b=m;return(i,$)=>ze((y(),Q("aside",{class:Ve(b.containerClass)},[s("div",wa,[$[1]||($[1]=s("span",{class:"text-sm font-semibold tracking-tight text-foreground"},"Writing Assistant",-1)),r(e(U),null,{default:n(()=>[r(e(B),{asChild:""},{default:n(()=>[r(e(v),{variant:"ghost",size:"icon",class:"h-7 w-7"},{default:n(()=>[r(e(Fs),{class:"h-3.5 w-3.5"})]),_:1})]),_:1}),r(e(H),null,{default:n(()=>[...$[0]||($[0]=[l("Manage Citations",-1)])]),_:1})]),_:1})]),s("div",ya,[s("div",_a,[r(xa,{project:b.project,chapter:b.chapter,"is-generating":b.isGenerating,"selected-text":b.selectedText,"is-loading-suggestions":b.isLoadingSuggestions,"show-citation-helper":b.showCitationHelper,"chapter-content":b.chapterContent,"current-word-count":b.currentWordCount,"target-word-count":b.targetWordCount,onStartStreamingGeneration:b.handleAIGeneration,onGetAiSuggestions:b.getAISuggestions,"onUpdate:showCitationHelper":b.updateCitationHelper,onInsertCitation:b.insertCitation,onCheckCitations:b.checkCitations},null,8,["project","chapter","is-generating","selected-text","is-loading-suggestions","show-citation-helper","chapter-content","current-word-count","target-word-count","onStartStreamingGeneration","onGetAiSuggestions","onUpdate:showCitationHelper","onInsertCitation","onCheckCitations"])])])],2)),[[Ne,!b.isCollapsed]])}}),Ca={key:0,class:"w-full relative z-30 bg-background/80 backdrop-blur-xl border-b border-border/50"},ka={class:"absolute top-0 left-0 right-0 h-[2px] bg-primary/10 overflow-hidden"},Sa={class:"container mx-auto max-w-5xl px-4 py-2 flex items-center justify-between gap-4 relative"},Ea={class:"flex items-center gap-3 min-w-0 flex-1"},Ta={class:"relative flex-shrink-0"},Aa={class:"h-6 w-6 rounded-full bg-primary/10 flex items-center justify-center text-primary relative z-10"},$a={class:"flex flex-col min-w-0"},Da={class:"flex items-baseline gap-2"},ja={class:"text-[10px] text-muted-foreground hidden sm:inline-block truncate"},Ra={class:"text-[10px] text-muted-foreground sm:hidden truncate"},Pa={class:"flex items-center gap-3 flex-shrink-0"},Fa={class:"flex items-center gap-1.5 px-2 py-1 rounded-md bg-secondary/50 border border-border/50"},za={class:"text-xs font-mono font-medium text-primary"},Ds=Je({__name:"GenerationStatusOverlay",props:{isGenerating:{type:Boolean},generationProgress:{},generationPercentage:{}},emits:["stop"],setup(m,{emit:b}){const i=m,$=b;return(N,a)=>(y(),z(Me,{"enter-active-class":"transition-all duration-300 ease-out","enter-from-class":"opacity-0 -translate-y-full height-0","enter-to-class":"opacity-100 translate-y-0","leave-active-class":"transition-all duration-300 ease-in","leave-from-class":"opacity-100 translate-y-0","leave-to-class":"opacity-0 -translate-y-full height-0"},{default:n(()=>[i.isGenerating?(y(),Q("div",Ca,[a[7]||(a[7]=s("div",{class:"absolute inset-0 bg-gradient-to-r from-blue-500/5 via-purple-500/5 to-pink-500/5 pointer-events-none"},null,-1)),s("div",ka,[s("div",{class:"h-full bg-gradient-to-r from-blue-500 via-purple-500 to-pink-500 shadow-[0_0_10px_rgba(59,130,246,0.5)] transition-all duration-300 ease-out relative",style:zs({width:`${i.generationPercentage}%`})},[...a[1]||(a[1]=[s("div",{class:"absolute inset-0 bg-white/30 w-full animate-shimmer -skew-x-12 translate-x-[-100%]"},null,-1)])],4)]),s("div",Sa,[s("div",Ea,[s("div",Ta,[a[2]||(a[2]=s("div",{class:"absolute inset-0 rounded-full border-2 border-primary/30 border-t-primary animate-spin",style:{"animation-duration":"1.5s"}},null,-1)),a[3]||(a[3]=s("div",{class:"absolute inset-0 rounded-full animate-ping opacity-20 bg-primary"},null,-1)),s("div",Aa,[r(e(Xe),{class:"h-3.5 w-3.5"})])]),s("div",$a,[s("div",Da,[a[4]||(a[4]=s("span",{class:"text-xs font-semibold text-foreground tracking-tight"},"Writing Chapter",-1)),s("span",ja,p(i.generationProgress||"Initializing..."),1)]),s("span",Ra,p(i.generationProgress||"Initializing..."),1)])]),s("div",Pa,[s("div",Fa,[s("span",za,p(Math.round(i.generationPercentage))+"% ",1)]),a[6]||(a[6]=s("div",{class:"h-4 w-px bg-border/60"},null,-1)),s("button",{onClick:a[0]||(a[0]=C=>$("stop")),class:"group flex items-center gap-1.5 px-2.5 py-1.5 rounded-full hover:bg-destructive/10 hover:text-destructive text-muted-foreground transition-all duration-200",title:"Stop Generation"},[...a[5]||(a[5]=[s("div",{class:"p-0.5 rounded-full bg-destructive/10 group-hover:bg-destructive/20 text-destructive text-[10px]"},[s("div",{class:"h-1.5 w-1.5 rounded-[1px] bg-current"})],-1),s("span",{class:"text-xs font-medium hidden sm:inline-block"},"Stop",-1)])])])])])):K("",!0)]),_:1}))}});function Na(m){const b=g({sentences:0,paragraphs:0,readingTime:0,avgWordLength:0,uniqueWords:0,commonWords:[]}),i=k(()=>m.value?m.value.split(/\s+/).filter(a=>a.length>0).length:0),$=()=>{if(!m.value){b.value={sentences:0,paragraphs:0,readingTime:0,avgWordLength:0,uniqueWords:0,commonWords:[]};return}const a=m.value,C=a.split(/\s+/).filter(_=>_.length>0),f=a.split(/[.!?]+/).filter(_=>_.trim().length>0),P=a.split(`

`).filter(_=>_.trim().length>0),x=new Map;C.forEach(_=>{const c=_.toLowerCase().replace(/[^a-z0-9]/g,"");c&&x.set(c,(x.get(c)||0)+1)});const D=new Set(["the","a","an","and","or","but","in","on","at","to","for","of","with","by","is","was","are","were"]),S=Array.from(x.entries()).filter(([_])=>!D.has(_)).sort((_,c)=>c[1]-_[1]).slice(0,5).map(([_])=>_);b.value={sentences:f.length,paragraphs:P.length,readingTime:Math.ceil(C.length/200),avgWordLength:C.reduce((_,c)=>_+c.length,0)/C.length,uniqueWords:x.size,commonWords:S}},N=k(()=>{if(!m.value)return 0;let a=0;const C=m.value;C.includes("##")&&(a+=20),C.length>1e3&&(a+=20),C.match(/\[.*?\]/g)&&(a+=15),(C.includes("**")||C.includes("*"))&&(a+=10);const f=C.split(/[.!?]+/).filter(x=>x.trim().length>0);if(f.length>0){const x=f.reduce((D,S)=>D+S.split(/\s+/).length,0)/f.length;x>10&&x<25&&(a+=20)}return C.split(`

`).filter(x=>x.trim().length>0).length>3&&(a+=15),Math.min(a,100)});return{writingStats:b,currentWordCount:i,writingQualityScore:N,calculateWritingStats:$}}function Ma(m){const b=g(!1),i=g(null),$=g([]),N=g(null),a=k(()=>{if(!i.value?.quality_level)return"text-muted-foreground";switch(i.value.quality_level){case"Excellent":return"text-green-600";case"Good":return"text-blue-600";case"Satisfactory":return"text-yellow-600";case"Needs Improvement":return"text-orange-600";case"Poor":return"text-red-600";default:return"text-muted-foreground"}}),C=k(()=>i.value?.scores?Object.entries(i.value.scores).sort(([,c],[,j])=>c.percentage-j.percentage).slice(0,3).map(([c,j])=>({category:c.replace(" & "," & "),percentage:Math.round(j.percentage),score:j.score,max:j.max})):[]),f=async()=>{try{b.value=!0,N.value=null,await ie.get("/sanctum/csrf-cookie");const c=await ie.post(W("api.chapters.analysis.analyze",{chapter:m}));if(c.data.success)return i.value=c.data.analysis,c.data.analysis;throw new Error(c.data.error||"Analysis failed")}catch(c){return N.value=c.response?.data?.error||c.message||"Analysis failed",console.error("Chapter analysis failed:",c),null}finally{b.value=!1}};return{isAnalyzing:b,latestAnalysis:i,analysisHistory:$,error:N,qualityLevelColor:a,topImprovementAreas:C,analyzeChapter:f,getLatestAnalysis:async()=>{try{await ie.get("/sanctum/csrf-cookie");const c=await ie.get(W("api.chapters.analysis.latest",{chapter:m}));return c.data.success?(i.value=c.data.analysis,c.data.analysis):(i.value=null,null)}catch(c){return c.response?.status!==404&&(N.value=c.response?.data?.error||c.message||"Failed to get analysis",console.error("Failed to get latest analysis:",c)),null}},getAnalysisHistory:async()=>{try{await ie.get("/sanctum/csrf-cookie");const c=await ie.get(W("api.chapters.analysis.history",{chapter:m}));if(c.data.success)return $.value=c.data.analyses,c.data.analyses;throw new Error(c.data.error||"Failed to get history")}catch(c){return N.value=c.response?.data?.error||c.message||"Failed to get analysis history",console.error("Failed to get analysis history:",c),[]}},autoAnalyze:async(c,j=500)=>{c>=j&&await f()},getScoreColor:(c,j)=>{const L=c/j*100;return L>=80?"text-green-600":L>=70?"text-blue-600":L>=60?"text-yellow-600":L>=40?"text-orange-600":"text-red-600"},getProgressVariant:c=>c>=80?"success":c>=60?"default":"destructive"}}const La={key:0,class:"min-h-screen bg-background text-foreground"},Oa={class:"mx-auto max-w-5xl p-6"},qa={class:"flex items-center justify-between gap-4"},Wa={class:"flex items-center gap-3"},Ga={class:"mt-6 grid gap-4"},Ia={class:"flex flex-wrap gap-x-6 gap-y-1"},Ba={class:"grid gap-1"},Ha={class:"grid gap-1"},Ua={class:"grid gap-4 md:grid-cols-3"},Qa={class:"mx-auto w-full max-w-5xl p-6"},Ka={class:"flex items-center justify-between gap-4"},Va={class:"flex items-center gap-3"},Xa={class:"mt-6 grid gap-4"},Ja={class:"flex flex-wrap gap-x-6 gap-y-1"},Ya={class:"grid gap-1"},Za={class:"grid gap-1"},eo={class:"grid gap-4 md:grid-cols-3"},to={key:0,class:"rounded-xl border border-border bg-card p-4"},so={key:2,class:"flex h-screen flex-col overflow-hidden bg-background dark:bg-background font-sans selection:bg-primary/20 transition-colors duration-300"},ro={class:"relative z-20 flex flex-shrink-0 items-center justify-between border-b border-border/40 bg-background/60 p-4 backdrop-blur-xl supports-[backdrop-filter]:bg-background/40 transition-all duration-300"},no={class:"flex items-center gap-5"},ao={class:"flex flex-col"},oo={class:"text-lg font-bold tracking-tight text-foreground/90 font-display"},lo={class:"flex items-center gap-3 text-xs text-muted-foreground"},io={class:"flex items-center gap-1.5"},uo={class:"flex items-center gap-4"},co={class:"flex items-center p-1 rounded-full border border-border/40 bg-background/50 backdrop-blur-sm shadow-sm"},po={class:"flex items-center gap-2"},go={class:"relative z-20 h-[2px] w-full bg-border/20"},fo={class:"relative z-10 flex flex-1 overflow-hidden"},mo={key:0,class:"w-[320px] flex-shrink-0 border-r border-border/50 bg-background/80 backdrop-blur-xl shadow-xl z-20"},ho={class:"h-full overflow-y-auto custom-scrollbar"},vo={class:"p-4"},bo={class:"mb-3"},xo={class:"text-xs text-muted-foreground"},wo={class:"flex min-h-0 flex-1 flex-col bg-transparent relative"},yo={class:"flex-1 overflow-hidden relative"},_o={"data-editor-scroll-container":"",class:"absolute inset-0 overflow-y-auto custom-scrollbar flex flex-col items-center py-8 px-4 sm:px-8"},Co={class:"flex h-full w-full overflow-hidden relative"},ko={id:"left-sidebar-panel",class:"hidden lg:flex w-80 flex-col border-r border-border/40 bg-background/60 backdrop-blur-xl z-20 transition-all duration-300"},So={class:"h-14 flex items-center justify-between px-4 border-b border-border/40 shrink-0"},Eo={class:"p-4"},To={class:"flex-1 flex flex-col relative z-10 min-w-0 bg-background/30 dark:bg-background transition-all duration-300"},Ao={class:"md:hidden flex flex-wrap items-start justify-between border-b border-border/40 bg-background/60 backdrop-blur-md px-4 py-3 relative z-30 transition-all duration-300 gap-y-2"},$o={class:"flex items-center gap-2 flex-shrink-0 order-1"},Do={class:"flex items-center order-2"},jo={class:"order-3 w-full flex flex-col gap-3"},Ro={class:"flex items-start gap-3 w-full min-w-0"},Po={class:"flex items-center gap-2 justify-between mt-1"},Fo={class:"flex items-center gap-2"},zo={class:"flex items-center gap-2"},No={key:0,class:"inline"},Mo={class:"hidden md:flex flex-col w-full z-30 bg-background/60 backdrop-blur-md transition-all duration-300 relative"},Lo={class:"h-10 border-b border-border/40 flex items-left justify-left px-4 bg-background/40"},Oo={class:"flex items-left gap-3"},qo=["innerHTML"],Wo={class:"h-12 border-b border-border/40 flex items-center justify-between px-4 gap-3 bg-muted/10"},Go={class:"flex items-center gap-1"},Io={class:"flex items-center gap-3"},Bo={id:"view-controls",class:"flex items-center bg-background/50 rounded-full border border-border/50 p-1 backdrop-blur-sm shadow-sm"},Ho={class:"hidden xl:inline"},Uo={class:"hidden xl:inline"},Qo={class:"flex items-center gap-2"},Ko={class:"flex items-center gap-2 pl-2 border-l border-border/50"},Vo={class:"inline"},Xo={class:"flex-1 overflow-hidden relative group bg-background/20 flex flex-col"},Jo={class:"mx-auto py-12 px-6 sm:px-10 min-h-full"},Yo={class:"min-h-[600px] pb-32"},Zo={class:"pb-32"},el={id:"editor-footer",class:"h-10 border-t border-border/30 bg-background/40 backdrop-blur-sm flex items-center justify-between px-4 text-[10px] text-muted-foreground shrink-0 relative"},tl={class:"flex items-center gap-2 z-10 overflow-hidden text-[10px] sm:w-auto"},sl={class:"truncate"},rl={class:"absolute left-1/2 -translate-x-1/2 flex items-center bg-background/50 rounded-full border border-border/40 p-0.5 shadow-sm"},nl={class:"px-3 font-bold text-[11px] min-w-[80px] text-center border-l border-r border-border/40 text-foreground/80"},al={class:"flex items-center gap-2 z-10"},ol={class:"sm:hidden text-[10px] text-muted-foreground truncate max-w-[60px]"},ll={class:"hidden sm:flex items-center gap-2"},il={key:0,class:"text-green-500 flex items-center gap-1 ml-2"},dl={class:"flex items-center gap-3 mb-2"},ul={class:"w-10 h-10 rounded-full bg-amber-500/20 flex items-center justify-center"},cl={class:"list-disc list-inside text-muted-foreground space-y-1 ml-2"},pl={key:0,class:"fixed inset-0 bg-black/50 flex items-center justify-center z-50"},gl={class:"text-slate-600 dark:text-slate-300 mb-4"},fl={class:"font-semibold text-amber-600 dark:text-amber-400"},ml={class:"flex flex-col sm:flex-row gap-3"},js="chapter_editor",hl=1e3,vl=Je({__name:"ChapterEditor",props:{project:{},chapter:{},allChapters:{},facultyChapters:{},mode:{}},setup(m){const b=lt(()=>it(()=>import("./ChapterNavigation-hIRqQokA.js"),__vite__mapDeps([0,1,2,3,4,5,6,7]))),i=lt(()=>it(()=>import("./MobileNavOverlay-C5FrRAR8.js"),__vite__mapDeps([8,3,4,9,2,1,5,6,7,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50]))),$=lt(()=>it(()=>import("./ChatModeLayout-C-7mnFXs.js"),__vite__mapDeps([51,3,4,7,2,11,14,5,37,17,42,38,39,40,43,9,34,29,30,31,32,36,35,22,41,52]))),N=lt(()=>it(()=>import("./CitationVerificationLayout-Bjr0t6G-.js"),__vite__mapDeps([53,7,3,4,2,11,12,14,5,54,42,37,38,39,17,40,43]))),a=m,C=Rs(),f=g(null),P=g(null),x=g(!1),D=g(!1),S=g(null),_=g(null),c=g(""),j=g(""),L=g(!1),V=g(!1),de=k(()=>L.value||V.value),w=k(()=>_.value===null?!1:_.value<3?c.value.trim().length>0:!0),u=k(()=>({page:"chapter_editor",project_id:a.project?.id,chapter_id:a.chapter?.id,path:typeof window<"u"?window.location.pathname:null})),A=g(!1),Y=g(null),ue=()=>document.querySelector('meta[name="csrf-token"]')?.getAttribute("content")||"",E=()=>{D.value=!1,S.value=null,_.value=null,c.value="",j.value=""},ce=async()=>{if(!(!C.props.auth?.user||!a.project?.id))try{const o=await fetch(W("api.feedback.eligibility",{project_id:a.project.id,source:js}));if(!o.ok)return;const t=await o.json();if(!t.eligible)return;if(t.existing_request_id){S.value=t.existing_request_id,D.value=!0;return}const d=await fetch(W("api.feedback.requests.store"),{method:"POST",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":ue()},body:JSON.stringify({project_id:a.project.id,source:js,context:u.value})});if(!d.ok)return;const I=await d.json();S.value=I.id,D.value=!0}catch(o){console.error("Failed to check feedback eligibility:",o)}},pe=async()=>{if(!S.value||!w.value){j.value=_.value&&_.value<3?"Please add a short comment.":"";return}L.value=!0,j.value="";try{const o=await fetch(W("api.feedback.requests.submit",{feedbackRequest:S.value}),{method:"POST",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":ue()},body:JSON.stringify({rating:_.value,comment:c.value.trim()||null})});if(!o.ok){const t=await o.json().catch(()=>({}));j.value=t?.errors?.comment?.[0]??"";return}E(),R.success("Thanks for the feedback!")}catch(o){console.error("Failed to submit feedback:",o)}finally{L.value=!1}},se=async()=>{if(!S.value){E();return}V.value=!0;try{await fetch(W("api.feedback.requests.dismiss",{feedbackRequest:S.value}),{method:"POST",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":ue()}})}catch(o){console.error("Failed to dismiss feedback prompt:",o)}finally{V.value=!1,E()}},ke=o=>{if(o){D.value=!0;return}if(L.value||V.value){D.value=o;return}se()};te([_,c],()=>{j.value&&(j.value="")});const O=g(!1),X=g(!1),Ye=g(!1),$e=g(0);if(typeof window<"u"){const o=new URLSearchParams(window.location.search);X.value=o.has("theme_sandbox"),Ye.value=o.get("theme_sandbox")==="nolayout"||o.has("theme_sandbox_nolayout");const t=o.get("theme_sandbox_step"),d=t?Number.parseInt(t,10):0;$e.value=Number.isFinite(d)?d:0}const{appearance:Ze,isDark:Le}=Ns(),h=g({htmlHasDark:!1,background:"",foreground:"",card:"",sidebarBackground:"",bodyBg:"",insetBg:"",sampleBgBackground:"",sampleBgCard:"",sampleBgMuted:""}),M=g(null),q=g(null),T=g(null);function G(){if(typeof window>"u")return;const o=document.documentElement,t=window.getComputedStyle(o),d=document.querySelector('[data-slot="sidebar-inset"]'),I=d?window.getComputedStyle(d).backgroundColor:"";h.value={htmlHasDark:o.classList.contains("dark"),background:t.getPropertyValue("--background").trim(),foreground:t.getPropertyValue("--foreground").trim(),card:t.getPropertyValue("--card").trim(),sidebarBackground:t.getPropertyValue("--sidebar-background").trim(),bodyBg:window.getComputedStyle(document.body).backgroundColor,insetBg:I,sampleBgBackground:M.value?window.getComputedStyle(M.value).backgroundColor:"",sampleBgCard:q.value?window.getComputedStyle(q.value).backgroundColor:"",sampleBgMuted:T.value?window.getComputedStyle(T.value).backgroundColor:""}}const{chapterTitle:Z,chapterContent:F,showPreview:De,isEditorDark:Oe,initChapterTheme:et,toggleChapterTheme:tt,isNativeFullscreen:re,selectedText:ge,showChatMode:Se,showCitationMode:ct,showDefensePrep:Et,loadChatModeFromStorage:qs,saveChatModeToStorage:Tt,showLeftSidebar:pt,showRightSidebar:gt,isMobile:ft,isLeftSidebarCollapsed:qe,isRightSidebarCollapsed:We,showLeftSidebarInFullscreen:Ge,showRightSidebarInFullscreen:Ie}=jn(a),{balance:Ws,showPurchaseModal:At,requiredWordsForModal:Gs,actionDescriptionForModal:Is,checkAndPrompt:Bs,closePurchaseModal:Hs,estimates:mt}=mn(),ht=(o,t)=>Bs(Math.max(1,Math.round(o)),t),{hasUnsavedChanges:Us,isSaving:he,triggerAutoSave:Be,save:we,clearAutoSave:Qs}=hn({delay:1e4,onSave:Ut});let $t=0;const Ks=()=>{const o=Date.now();o-$t>hl&&($t=o,R.success("Saved",{duration:2e3}))},{contentHistory:Vs,historyIndex:Xs,addToHistory:Js,undo:Ys,redo:Zs}=$n(a.chapter.content||""),{writingStats:Dt,writingQualityScore:ye,calculateWritingStats:vt}=Na(F),{isAnalyzing:er,latestAnalysis:tr,getLatestAnalysis:sr}=Ma(a.chapter.id),fe=k(()=>{if(a.facultyChapters&&a.facultyChapters.length>0){const t=a.facultyChapters.find(d=>d.number===a.chapter.chapter_number);if(t?.word_count)return t.word_count}if(a.project?.outlines&&a.project.outlines.length>0){const t=a.project.outlines.find(d=>d.chapter_number===a.chapter.chapter_number);if(t?.target_word_count)return t.target_word_count}const o=a.project.type==="undergraduate"?2500:3500;return a.chapter.chapter_number===1||a.chapter.chapter_number===5?Math.round(o*.8):o}),{generateNextChapter:st}=Rn({props:a,allChapters:a.allChapters,targetWordCount:fe,estimates:mt,ensureBalance:ht,save:we}),{currentWordCount:ne,progressPercentage:rr,DEFENSE_THRESHOLD:nr,countWords:ar}=vn(F,fe),bt=rr,jt=k(()=>({chapter:a.chapter,chapterTitle:Z,chapterContent:F,showPresentationMode:_e,togglePresentationMode:Jt,isStreamingMode:Mt,isGenerating:ee,generationProgress:He,generationPercentage:rt,generationPhase:Ft,aiChapterAnalysis,nextSection,getSectionInfo,writingStats:Dt,latestAnalysis:tr,isAnalyzing:er,writingQualityScore:ye,isSaving:he,isValid:Ue,save:we,goToBulkAnalysis:yt,markAsComplete:_t,richTextEditor:f,richTextEditorFullscreen:P,selectedText:ge,setSelectedText:o=>{ge.value=o}})),or=k(()=>({chapter_number:It.value.chapter_number,chapter_title:It.value.title,word_count:ne.value})),lr=k(()=>({meetsThreshold:_r.value,shouldShowProgress:br.value,progressPercentage:xr.value,wordsRemaining:wr.value,hasTriggeredGeneration:yr,threshold:nr,statusMessage:vr()})),Rt=k(()=>({project:ve.value,chapter:be.value,isGenerating:ee.value,selectedText:ge.value,isLoadingSuggestions:Nt.value,showCitationHelper:nt.value,chapterContent:F.value,currentWordCount:ne.value,targetWordCount:fe.value,handleAIGeneration:Ot,getAISuggestions:qt,updateCitationHelper:o=>{nt.value=o},insertCitation:Tr,checkCitations:Wt,showDefensePrep:Et.value,defenseQuestions:ir.value??[],isLoadingDefenseQuestions:dr.value,isGeneratingDefenseQuestions:ur.value,chapterContext:or.value,defenseWatcher:lr.value,autoGenerateDefense:cr.value,handleDefensePanelToggle:qr,generateNewDefenseQuestions:gr,handleDefenseAutoToggle:hr,refreshDefenseQuestions:()=>Pt(!0,{skipGeneration:!0}),markQuestionHelpful:fr,hideQuestion:mr})),{defenseQuestions:ir,isLoadingDefenseQuestions:dr,isGeneratingDefenseQuestions:ur,autoGenerateDefense:cr,shouldLoadDefenseQuestions:pr,loadDefenseQuestions:Pt,generateNewDefenseQuestions:gr,markQuestionHelpful:fr,hideQuestion:mr,handleDefenseAutoToggle:hr,getDefenseStatusMessage:vr,shouldShowDefenseProgress:br,defenseProgressPercentage:xr,defenseWordsRemaining:wr,hasTriggeredGeneration:yr,meetsDefenseThreshold:_r}=Fn({props:a,chapterContent:F,currentWordCount:ne,ensureBalance:ht,estimates:mt}),{isGenerating:ee,generationProgress:He,generationPercentage:rt,generationPhase:Ft,estimatedTotalWords:xl,streamWordCount:zt,streamBuffer:wl,lastStreamUpdate:yl,originalContentForAppend:_l,aiSuggestions:Cl,isLoadingSuggestions:Nt,showCitationHelper:nt,showPresentationMode:_e,isStreamingMode:Mt,showRecoveryDialog:Cr,partialContentSaved:kl,savedWordCountOnError:kr,isCollectingPapers:Sl,paperCollectionProgress:El,paperCollectionPhase:Tl,collectedPapersCount:Al,paperCollectionPercentage:$l,currentSource:Dl,sourcesCompleted:jl,papersPreview:Rl,paperCollectionData:Pl,paperCollectionInterval:Fl,reconnectAttempts:zl,reconnectDelay:Nl,isReconnecting:Ml,currentGenerationId:Ll,currentGenerationType:Ol,eventSource:Lt,editorScrollRef:Sr,attachScroller:ql,smoothScrollToBottom:Wl,forceScrollToBottom:Gl,resetScroller:Il,isAutoScrollActive:Bl,isUserScrollingScroller:Hl,scrollToBottom:Ul,checkConnectionQuality:Ql,handleAIGeneration:Ot,handleRegenerateChapter:Er,getAISuggestions:qt,checkCitations:Wt,insertCitation:Tr,resumeGeneration:Ar,dismissRecovery:$r,checkForAutoGeneration:Dr,stopGeneration:at,cleanupGenerationProtection:Gt}=bn({props:a,chapterContent:F,targetWordCount:fe,estimates:mt,ensureBalance:ht,save:we,triggerAutoSave:Be,calculateWritingStats:vt,countWords:ar,selectedText:ge,richTextEditor:f,richTextEditorFullscreen:P,isNativeFullscreen:re}),Ue=k(()=>{const o=Z.value?.trim(),t=F.value?.trim();return o&&o.length>0&&t&&t.length>50}),ve=k(()=>a.project),be=k(()=>a.chapter),Ce=k(()=>a.allChapters),It=k(()=>a.chapter),Bt=k(()=>a.facultyChapters&&a.facultyChapters.length>0?a.facultyChapters.map(o=>{const t=a.allChapters.find(d=>d.chapter_number===o.number);return{chapter_number:o.number,title:o.title,exists:!!t,content:t?.content||null,status:t?t.status:"not_started"}}):a.project.outlines&&a.project.outlines.length>0?a.project.outlines.map(o=>{const t=a.allChapters.find(d=>d.chapter_number===o.chapter_number);return{chapter_number:o.chapter_number,title:o.chapter_title,exists:!!t,content:t?.content||null,status:t?t.status:"not_started"}}):a.allChapters.map(o=>({chapter_number:o.chapter_number,title:o.title,exists:!0,content:o.content,status:o.status}))),Ee=k(()=>{const o=a.chapter.chapter_number;return Bt.value.find(t=>t.chapter_number===o+1)||null}),ot=k(()=>{const o=a.chapter.chapter_number;return Bt.value.find(t=>t.chapter_number===o-1)||null}),Ht=k(()=>!Ee.value||ee.value?!1:!Ee.value.content||Ee.value.content.trim().length<10),xt=()=>{Ee.value&&(Ee.value.exists?Te(Ee.value.chapter_number):st())},jr=()=>{ot.value&&ot.value.exists&&Te(ot.value.chapter_number)};async function Ut(o=!1){try{const t=await fetch(W("chapters.save",{project:a.project.id}),{method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json","X-Requested-With":"XMLHttpRequest","X-CSRF-TOKEN":document.querySelector('meta[name="csrf-token"]')?.getAttribute("content")||""},body:JSON.stringify({project_id:a.project.id,chapter_number:a.chapter.chapter_number,title:Z.value,content:F.value,auto_save:o,statistics:Dt.value,quality_score:ye.value})});console.log("Response status:",t.status,t.statusText),console.log("Response headers:",t.headers);const d=await t.text();console.log("Raw response:",d);let I;try{I=JSON.parse(d)}catch(xe){throw console.error("JSON parse error:",xe),console.error("Response was:",d),new Error(`Server returned non-JSON response: ${t.status} ${t.statusText}`)}t.ok}catch(t){throw o||R.error("âŒ Save Failed",{description:"Please try again or check your connection."}),t}}const Qt=()=>{const o=Ys();o!==null&&(F.value=o,Be())},Kt=()=>{const o=Zs();o!==null&&(F.value=o,Be())},Rr=async()=>{x.value=!1,await Er(!0)},Te=o=>{!ee.value&&Us.value&&confirm("You have unsaved changes. Save before switching chapters?")&&we();const t=a.allChapters.find(xe=>xe.chapter_number===o),I=t?.content&&t.content.trim()!==""?"chapters.edit":"chapters.write";J.visit(W(I,{project:a.project.slug,chapter:o}),{only:["chapter","mode","allChapters"],preserveState:!0,preserveScroll:!1})},Vt=()=>document.fullscreenElement||document.webkitFullscreenElement||document.msFullscreenElement||null,Pr=async()=>{try{const o=document.documentElement;o.requestFullscreen?await o.requestFullscreen({navigationUI:"hide"}):o.webkitRequestFullscreen?await o.webkitRequestFullscreen():o.msRequestFullscreen&&await o.msRequestFullscreen()}catch(o){console.error("Error entering fullscreen:",o),R.error("Fullscreen Error",{description:"Unable to enter fullscreen mode"})}},Fr=async()=>{try{document.exitFullscreen?await document.exitFullscreen():document.webkitExitFullscreen?await document.webkitExitFullscreen():document.msExitFullscreen&&await document.msExitFullscreen()}catch(o){console.error("Error exiting fullscreen:",o),R.error("Fullscreen Error",{description:"Unable to exit fullscreen mode"})}},wt=async()=>{if(Vt()){await Fr();return}await Pr()},Ae=()=>{re.value=!!Vt(),Pe(()=>{et(),X.value&&G()})},Xt=()=>{Se.value=!Se.value,Se.value&&(ct.value=!1),Tt(Se.value)},zr=()=>{Se.value=!1,Tt(!1)},Nr=()=>{ct.value=!1},Jt=()=>{_e.value=!_e.value},yt=()=>{J.visit(W("projects.analysis",{project:a.project.slug}))},Mr=()=>{Js(F.value),Be(),vt()},Yt=o=>{(o.ctrlKey||o.metaKey)&&o.key==="s"&&(o.preventDefault(),we(),Ks()),(o.ctrlKey||o.metaKey)&&!o.shiftKey&&o.key==="z"&&(o.preventDefault(),Qt()),(o.ctrlKey||o.metaKey)&&o.shiftKey&&o.key==="z"&&(o.preventDefault(),Kt()),(o.ctrlKey||o.metaKey)&&o.shiftKey&&(o.key==="f"||o.key==="F")&&(o.preventDefault(),wt())};Re(()=>{const o=()=>{ft.value=window.innerWidth<1024};o(),window.addEventListener("resize",o),Se.value=qs(),document.addEventListener("keydown",Zt),document.addEventListener("keydown",Yt),document.addEventListener("fullscreenchange",Ae),document.addEventListener("webkitfullscreenchange",Ae),document.addEventListener("msfullscreenchange",Ae),Ae(),vt(),Dr(),et(),ce(),J.on("before",t=>O.value?!0:ee.value&&zt.value>0?(Y.value={url:t.detail.visit.url.href,event:t},A.value=!0,!1):!0)});const Lr=()=>{A.value=!1,O.value=!0,at&&at(),Gt(),Y.value&&J.visit(Y.value.url),Y.value=null,setTimeout(()=>{O.value=!1},1e3)},Or=()=>{A.value=!1,Y.value=null},Zt=o=>{if((o.ctrlKey||o.metaKey)&&!["INPUT","TEXTAREA","SELECT"].includes(o.target?.tagName))switch(o.key){case"ArrowLeft":o.preventDefault();const t=a.chapter.chapter_number-1;a.allChapters.find(Qe=>Qe.chapter_number===t)&&Te(t);break;case"ArrowRight":o.preventDefault();const I=a.chapter.chapter_number+1;a.allChapters.find(Qe=>Qe.chapter_number===I)&&Te(I);break}};Re(()=>{const o=t=>{const d=I=>{const{scrollTop:xe,scrollHeight:Qe,clientHeight:Wr}=t,ts=I.deltaY,Gr=xe<=0,Ir=xe+Wr>=Qe;ts<0&&Gr||ts>0&&Ir||I.stopPropagation()};return t.addEventListener("wheel",d,{passive:!0}),()=>t.removeEventListener("wheel",d)};Pe(()=>{const t=document.querySelectorAll('[class*="overflow-y-auto"]'),d=[];t.forEach(I=>{if(I instanceof HTMLElement){const xe=o(I);d.push(xe)}}),window.__scrollChainCleanup=d})}),Zr(()=>{Qs(),Lt.value&&Lt.value.close(),Gt(),document.removeEventListener("keydown",Yt),document.removeEventListener("keydown",Zt);const o=window.__scrollChainCleanup;o&&Array.isArray(o)&&(o.forEach(t=>t()),delete window.__scrollChainCleanup),document.removeEventListener("fullscreenchange",Ae),document.removeEventListener("webkitfullscreenchange",Ae),document.removeEventListener("msfullscreenchange",Ae)}),te(()=>a.chapter,async o=>{Z.value=o.title||"",F.value=o.content||""},{immediate:!1});const qr=async o=>{Et.value=o,o&&pr()&&await Pt(!1,{skipGeneration:!0})},es=()=>{const o=[{popover:{title:"Welcome to the AI Assisted Editor",description:"Experience a powerful writing environment enhanced by AI. Generate an entire chapter with one click and access a suite of AI tools to refine your content.",popoverClass:"driver-popover-welcome"}},{element:"#back-to-project-btn",popover:{title:"Back to Project",description:"Return to your project dashboard."}},{element:"#left-sidebar-panel",popover:{title:"Chapter Navigation",description:"Use the Table of Contents to switch between chapters."},onHighlightStarted:()=>{qe.value=!1},showOnMobile:!1},{element:"#view-controls",popover:{title:"View Options",description:"Customize your view with Preview, AI Chat, Fullscreen, and Dark Mode."}},{element:"#toggle-chat-mode",popover:{title:"AI Chat Assistant",description:"Open the AI assistant to help you write, brainstorm, or refine your content."}},{element:"#export-menu-container",popover:{title:"Export",description:"Export your chapter or entire project."}},{element:"#analyze-button",popover:{title:"Bulk Analysis",description:"Analyze content across chapters."}},{element:"#save-button",popover:{title:"Save Work",description:"Manually save your chapter. Auto-save is also active!"}},{element:"#mark-complete-btn",popover:{title:"Mark as Complete",description:"Finished writing? Mark the chapter as complete."}},{element:"#toggle-right-sidebar",popover:{title:"AI Tools Sidebar",description:"Toggle the sidebar to access AI tools like Smart Suggestions and Citation Helper."},showOnMobile:!1},{element:"#right-sidebar-panel",popover:{title:"AI Assistant Tools",description:"Access powerful AI features here."},onHighlightStarted:()=>{We.value=!1},showOnMobile:!1},{element:"#editor-footer",popover:{title:"Writing Stats",description:"Track your word count, quality score, and readiness."}},{element:"#reset-tour-button",popover:{title:"Need Help?",description:"Click here anytime to restart this tour."}}];cn({showProgress:!0,animate:!0,steps:ft.value?o.filter(d=>d.showOnMobile!==!1):o}).drive()};Re(()=>{if(C.props.auth?.user?.email){const o=`chapter_editor_tour_seen_${C.props.auth.user.email}`;localStorage.getItem(o)||setTimeout(()=>{es(),localStorage.setItem(o,"true")},1e3)}}),te(F,Mr),te(Z,Be);const _t=async()=>{console.log("ðŸ”µ [MARK COMPLETE] Function called"),console.log("ðŸ”µ [MARK COMPLETE] Current word count:",ne.value);try{console.log("ðŸ”µ [MARK COMPLETE] Saving chapter..."),await we(!1),console.log("âœ… [MARK COMPLETE] Chapter saved");const o=W("chapters.mark-complete",{project:a.project.slug,chapter:a.chapter.chapter_number});console.log("ðŸ”µ [MARK COMPLETE] Posting to:",o),J.post(o,{},{onSuccess:()=>{console.log("âœ… [MARK COMPLETE] Request successful")},onError:t=>{console.error("âŒ [MARK COMPLETE] Request failed:",t)}})}catch(o){console.error("âŒ [MARK COMPLETE] Error:",o),R.error("Failed to save chapter before marking complete")}};return Re(async()=>{await sr()}),Re(()=>{X.value&&Pe(()=>G())}),te(Le,()=>{X.value&&Pe(()=>G())},{flush:"post"}),(o,t)=>(y(),z(e(pn),null,{default:n(()=>[r(Dn,{open:D.value,rating:_.value,comment:c.value,"is-submitting":de.value,"comment-error":j.value,"can-submit":w.value,"onUpdate:open":ke,"onUpdate:rating":t[0]||(t[0]=d=>_.value=d),"onUpdate:comment":t[1]||(t[1]=d=>c.value=d),onSubmit:pe,onDismiss:se},null,8,["open","rating","comment","is-submitting","comment-error","can-submit"]),X.value?(y(),Q(ns,{key:0},[Ye.value?(y(),Q("div",La,[s("div",Oa,[s("div",qa,[t[34]||(t[34]=s("div",null,[s("h1",{class:"text-lg font-semibold"},"ChapterEditor Theme Sandbox"),s("p",{class:"text-sm text-muted-foreground"},"No layout mode. Use `?theme_sandbox=nolayout`.")],-1)),s("div",Wa,[r(Cs),r(e(v),{variant:"outline",size:"sm",onClick:G},{default:n(()=>[...t[32]||(t[32]=[l("Refresh",-1)])]),_:1}),r(e(v),{variant:"outline",size:"sm",onClick:t[2]||(t[2]=d=>e(J).visit(o.window.location.pathname))},{default:n(()=>[...t[33]||(t[33]=[l("Exit",-1)])]),_:1})])]),s("div",Ga,[r(e(ae),{class:"bg-card text-card-foreground"},{default:n(()=>[r(e(le),null,{default:n(()=>[r(e(me),{class:"text-base"},{default:n(()=>[...t[35]||(t[35]=[l("Theme State",-1)])]),_:1})]),_:1}),r(e(oe),{class:"space-y-2 text-sm"},{default:n(()=>[s("div",Ia,[s("div",null,[t[36]||(t[36]=s("span",{class:"text-muted-foreground"},"appearance:",-1)),l(" "+p(e(Ze)),1)]),s("div",null,[t[37]||(t[37]=s("span",{class:"text-muted-foreground"},"isDark:",-1)),l(" "+p(e(Le)),1)]),s("div",null,[t[38]||(t[38]=s("span",{class:"text-muted-foreground"},"html.dark:",-1)),l(" "+p(h.value.htmlHasDark),1)]),s("div",null,[t[39]||(t[39]=s("span",{class:"text-muted-foreground"},"step:",-1)),l(" "+p($e.value),1)])]),r(e(Ke)),s("div",Ba,[s("div",null,[t[40]||(t[40]=s("span",{class:"text-muted-foreground"},"--background:",-1)),l(" "+p(h.value.background),1)]),s("div",null,[t[41]||(t[41]=s("span",{class:"text-muted-foreground"},"--foreground:",-1)),l(" "+p(h.value.foreground),1)]),s("div",null,[t[42]||(t[42]=s("span",{class:"text-muted-foreground"},"--card:",-1)),l(" "+p(h.value.card),1)]),s("div",null,[t[43]||(t[43]=s("span",{class:"text-muted-foreground"},"--sidebar-background:",-1)),l(" "+p(h.value.sidebarBackground),1)])]),r(e(Ke)),s("div",Ha,[s("div",null,[t[44]||(t[44]=s("span",{class:"text-muted-foreground"},"body bg:",-1)),l(" "+p(h.value.bodyBg),1)]),s("div",null,[t[45]||(t[45]=s("span",{class:"text-muted-foreground"},"inset bg:",-1)),l(" "+p(h.value.insetBg),1)]),s("div",null,[t[46]||(t[46]=s("span",{class:"text-muted-foreground"},"sample bg-background:",-1)),l(" "+p(h.value.sampleBgBackground),1)]),s("div",null,[t[47]||(t[47]=s("span",{class:"text-muted-foreground"},"sample bg-card:",-1)),l(" "+p(h.value.sampleBgCard),1)]),s("div",null,[t[48]||(t[48]=s("span",{class:"text-muted-foreground"},"sample bg-muted:",-1)),l(" "+p(h.value.sampleBgMuted),1)])])]),_:1})]),_:1}),s("div",Ua,[r(e(ae),{ref_key:"sampleBgBackgroundEl",ref:M,class:"bg-background"},{default:n(()=>[r(e(le),null,{default:n(()=>[r(e(me),{class:"text-base"},{default:n(()=>[...t[49]||(t[49]=[l("bg-background",-1)])]),_:1})]),_:1}),r(e(oe),{class:"text-sm text-muted-foreground"},{default:n(()=>[...t[50]||(t[50]=[l("Should flip with theme.",-1)])]),_:1})]),_:1},512),r(e(ae),{ref_key:"sampleBgCardEl",ref:q,class:"bg-card"},{default:n(()=>[r(e(le),null,{default:n(()=>[r(e(me),{class:"text-base"},{default:n(()=>[...t[51]||(t[51]=[l("bg-card",-1)])]),_:1})]),_:1}),r(e(oe),{class:"text-sm text-muted-foreground"},{default:n(()=>[...t[52]||(t[52]=[l("Card surface color.",-1)])]),_:1})]),_:1},512),r(e(ae),{ref_key:"sampleBgMutedEl",ref:T,class:"bg-muted"},{default:n(()=>[r(e(le),null,{default:n(()=>[r(e(me),{class:"text-base"},{default:n(()=>[...t[53]||(t[53]=[l("bg-muted",-1)])]),_:1})]),_:1}),r(e(oe),{class:"text-sm text-muted-foreground"},{default:n(()=>[...t[54]||(t[54]=[l("Muted surface color.",-1)])]),_:1})]),_:1},512)])])])])):(y(),z(ks,{key:1,class:"h-screen overflow-hidden bg-background text-foreground"},{default:n(()=>[s("div",Qa,[s("div",Ka,[t[57]||(t[57]=s("div",null,[s("h1",{class:"text-lg font-semibold"},"ChapterEditor Theme Sandbox"),s("p",{class:"text-sm text-muted-foreground"}," Use `?theme_sandbox=1` (with layout) or `?theme_sandbox=nolayout`. ")],-1)),s("div",Va,[r(Cs),r(e(v),{variant:"outline",size:"sm",onClick:G},{default:n(()=>[...t[55]||(t[55]=[l("Refresh",-1)])]),_:1}),r(e(v),{variant:"outline",size:"sm",onClick:t[3]||(t[3]=d=>e(J).visit(o.window.location.pathname))},{default:n(()=>[...t[56]||(t[56]=[l("Exit",-1)])]),_:1})])]),s("div",Xa,[r(e(ae),{class:"bg-card text-card-foreground"},{default:n(()=>[r(e(le),null,{default:n(()=>[r(e(me),{class:"text-base"},{default:n(()=>[...t[58]||(t[58]=[l("Theme State",-1)])]),_:1})]),_:1}),r(e(oe),{class:"space-y-2 text-sm"},{default:n(()=>[s("div",Ja,[s("div",null,[t[59]||(t[59]=s("span",{class:"text-muted-foreground"},"appearance:",-1)),l(" "+p(e(Ze)),1)]),s("div",null,[t[60]||(t[60]=s("span",{class:"text-muted-foreground"},"isDark:",-1)),l(" "+p(e(Le)),1)]),s("div",null,[t[61]||(t[61]=s("span",{class:"text-muted-foreground"},"html.dark:",-1)),l(" "+p(h.value.htmlHasDark),1)]),s("div",null,[t[62]||(t[62]=s("span",{class:"text-muted-foreground"},"step:",-1)),l(" "+p($e.value),1)])]),r(e(Ke)),s("div",Ya,[s("div",null,[t[63]||(t[63]=s("span",{class:"text-muted-foreground"},"--background:",-1)),l(" "+p(h.value.background),1)]),s("div",null,[t[64]||(t[64]=s("span",{class:"text-muted-foreground"},"--foreground:",-1)),l(" "+p(h.value.foreground),1)]),s("div",null,[t[65]||(t[65]=s("span",{class:"text-muted-foreground"},"--card:",-1)),l(" "+p(h.value.card),1)]),s("div",null,[t[66]||(t[66]=s("span",{class:"text-muted-foreground"},"--sidebar-background:",-1)),l(" "+p(h.value.sidebarBackground),1)])]),r(e(Ke)),s("div",Za,[s("div",null,[t[67]||(t[67]=s("span",{class:"text-muted-foreground"},"body bg:",-1)),l(" "+p(h.value.bodyBg),1)]),s("div",null,[t[68]||(t[68]=s("span",{class:"text-muted-foreground"},"inset bg:",-1)),l(" "+p(h.value.insetBg),1)]),s("div",null,[t[69]||(t[69]=s("span",{class:"text-muted-foreground"},"sample bg-background:",-1)),l(" "+p(h.value.sampleBgBackground),1)]),s("div",null,[t[70]||(t[70]=s("span",{class:"text-muted-foreground"},"sample bg-card:",-1)),l(" "+p(h.value.sampleBgCard),1)]),s("div",null,[t[71]||(t[71]=s("span",{class:"text-muted-foreground"},"sample bg-muted:",-1)),l(" "+p(h.value.sampleBgMuted),1)])])]),_:1})]),_:1}),s("div",eo,[r(e(ae),{ref_key:"sampleBgBackgroundEl",ref:M,class:"bg-background"},{default:n(()=>[r(e(le),null,{default:n(()=>[r(e(me),{class:"text-base"},{default:n(()=>[...t[72]||(t[72]=[l("bg-background",-1)])]),_:1})]),_:1}),r(e(oe),{class:"text-sm text-muted-foreground"},{default:n(()=>[...t[73]||(t[73]=[l("Should flip with theme.",-1)])]),_:1})]),_:1},512),r(e(ae),{ref_key:"sampleBgCardEl",ref:q,class:"bg-card"},{default:n(()=>[r(e(le),null,{default:n(()=>[r(e(me),{class:"text-base"},{default:n(()=>[...t[74]||(t[74]=[l("bg-card",-1)])]),_:1})]),_:1}),r(e(oe),{class:"text-sm text-muted-foreground"},{default:n(()=>[...t[75]||(t[75]=[l("Card surface color.",-1)])]),_:1})]),_:1},512),r(e(ae),{ref_key:"sampleBgMutedEl",ref:T,class:"bg-muted"},{default:n(()=>[r(e(le),null,{default:n(()=>[r(e(me),{class:"text-base"},{default:n(()=>[...t[76]||(t[76]=[l("bg-muted",-1)])]),_:1})]),_:1}),r(e(oe),{class:"text-sm text-muted-foreground"},{default:n(()=>[...t[77]||(t[77]=[l("Muted surface color.",-1)])]),_:1})]),_:1},512)]),$e.value>=1?(y(),Q("div",to,[t[78]||(t[78]=s("div",{class:"text-sm font-medium"},"Step 1: Paper Card only",-1)),t[79]||(t[79]=s("div",{class:"text-xs text-muted-foreground mb-3"},"Adds `ChapterEditorPaperCard` only.",-1)),r(As,{context:jt.value},null,8,["context"])])):K("",!0)])])]),_:1}))],64)):(y(),Q(ns,{key:1},[e(Se)?(y(),z(e($),{key:0,project:ve.value,chapter:be.value,"chapter-title":e(Z),"chapter-content":e(F),"current-word-count":e(ne),"target-word-count":fe.value,"progress-percentage":e(bt),"writing-quality-score":e(ye),"is-valid":Ue.value,"is-saving":e(he),"show-preview":e(De),"is-generating":e(ee),"generation-progress":e(He),"history-index":e(Xs),"content-history-length":e(Vs).length,"selected-text":e(ge),"onUpdate:chapterTitle":t[4]||(t[4]=d=>Z.value=d),"onUpdate:chapterContent":t[5]||(t[5]=d=>F.value=d),"onUpdate:selectedText":t[6]||(t[6]=d=>ge.value=d),"onUpdate:showPreview":t[7]||(t[7]=d=>De.value=d),onSave:t[8]||(t[8]=d=>Ut(d)),onUndo:Qt,onRedo:Kt,onExitChatMode:zr},null,8,["project","chapter","chapter-title","chapter-content","current-word-count","target-word-count","progress-percentage","writing-quality-score","is-valid","is-saving","show-preview","is-generating","generation-progress","history-index","content-history-length","selected-text"])):e(ct)?(y(),z(e(N),{key:1,project:ve.value,chapter:be.value,"chapter-title":e(Z),"chapter-content":e(F),"current-word-count":e(ne),"target-word-count":fe.value,"progress-percentage":e(bt),onExitCitationMode:Nr},null,8,["project","chapter","chapter-title","chapter-content","current-word-count","target-word-count","progress-percentage"])):e(re)?(y(),Q("div",so,[t[90]||(t[90]=s("div",{class:"absolute inset-0 z-0 overflow-hidden pointer-events-none"},[s("div",{class:"absolute top-[-20%] left-[-10%] w-[50%] h-[50%] rounded-full bg-blue-500/5 blur-[120px]"}),s("div",{class:"absolute bottom-[-20%] right-[-10%] w-[50%] h-[50%] rounded-full bg-purple-500/5 blur-[120px]"})],-1)),s("div",ro,[s("div",no,[r(e(U),null,{default:n(()=>[r(e(B),{asChild:""},{default:n(()=>[r(e(v),{onClick:t[9]||(t[9]=d=>e(J).visit(e(W)("projects.show",a.project.slug))),variant:"ghost",size:"icon",class:"h-10 w-10 rounded-full hover:bg-primary/10 hover:text-primary transition-all duration-300"},{default:n(()=>[r(e(Ct),{class:"h-5 w-5"})]),_:1})]),_:1}),r(e(H),null,{default:n(()=>[...t[80]||(t[80]=[s("p",null,"Back to Project",-1)])]),_:1})]),_:1}),s("div",ao,[s("h1",oo,p(a.project.title),1),s("div",lo,[r(e(Fe),{variant:"outline",class:"h-5 px-2 rounded-full border-primary/20 bg-primary/5 text-primary font-medium"},{default:n(()=>[l(" Chapter "+p(a.chapter.chapter_number),1)]),_:1}),s("span",io,[t[81]||(t[81]=s("span",{class:"h-1.5 w-1.5 rounded-full bg-green-500 animate-pulse"},null,-1)),l(" "+p(e(ne))+" words ",1)])])])]),s("div",uo,[s("div",co,[r(e(v),{onClick:t[10]||(t[10]=d=>Ge.value=!e(Ge)),variant:e(Ge)?"secondary":"ghost",size:"sm",class:Ve(["h-8 px-4 rounded-full text-xs font-medium transition-all duration-300",e(Ge)?"bg-primary/10 text-primary hover:bg-primary/15":"hover:bg-muted"])},{default:n(()=>[r(e(as),{class:"mr-2 h-3.5 w-3.5"}),t[82]||(t[82]=l(" Outline ",-1))]),_:1},8,["variant","class"]),t[84]||(t[84]=s("div",{class:"w-px h-4 bg-border/50 mx-1"},null,-1)),r(e(v),{onClick:t[11]||(t[11]=d=>Ie.value=!e(Ie)),variant:e(Ie)?"secondary":"ghost",size:"sm",class:Ve(["h-8 px-4 rounded-full text-xs font-medium transition-all duration-300",e(Ie)?"bg-primary/10 text-primary hover:bg-primary/15":"hover:bg-muted"])},{default:n(()=>[r(e(Xe),{class:"mr-2 h-3.5 w-3.5"}),t[83]||(t[83]=l(" Assistant ",-1))]),_:1},8,["variant","class"])]),s("div",po,[r(e(U),null,{default:n(()=>[r(e(B),{asChild:""},{default:n(()=>[r(e(v),{onClick:Xt,variant:"ghost",size:"icon",class:"h-9 w-9 rounded-full transition-all hover:bg-muted"},{default:n(()=>[r(e(os),{class:"h-4.5 w-4.5 text-blue-500"})]),_:1})]),_:1}),r(e(H),null,{default:n(()=>[...t[85]||(t[85]=[s("p",null,"Open AI Chat",-1)])]),_:1})]),_:1}),r(e(U),null,{default:n(()=>[r(e(B),{asChild:""},{default:n(()=>[r(e(v),{onClick:wt,variant:e(re)?"secondary":"ghost",size:"icon",class:"h-9 w-9 rounded-full transition-all hover:bg-muted"},{default:n(()=>[e(re)?(y(),z(e(ls),{key:0,class:"h-4.5 w-4.5"})):(y(),z(e(is),{key:1,class:"h-4.5 w-4.5"}))]),_:1},8,["variant"])]),_:1}),r(e(H),null,{default:n(()=>[s("p",null,p(e(re)?"Exit fullscreen":"Enter fullscreen"),1)]),_:1})]),_:1}),r(e(U),null,{default:n(()=>[r(e(B),{asChild:""},{default:n(()=>[r(e(v),{onClick:e(tt),variant:e(Oe)?"secondary":"ghost",size:"icon",class:"h-9 w-9 rounded-full transition-all hover:bg-muted"},{default:n(()=>[e(Oe)?(y(),z(e(ds),{key:0,class:"h-4.5 w-4.5 text-foreground"})):(y(),z(e(us),{key:1,class:"h-4.5 w-4.5 text-muted-foreground"}))]),_:1},8,["onClick","variant"])]),_:1}),r(e(H),null,{default:n(()=>[...t[86]||(t[86]=[s("p",null,"Toggle Dark Mode",-1)])]),_:1})]),_:1}),r(kt,{project:ve.value,"current-chapter":be.value,"all-chapters":Ce.value,size:"icon",variant:"ghost",class:"h-9 w-9 rounded-full hover:bg-muted"},null,8,["project","current-chapter","all-chapters"])])])]),s("div",go,[s("div",{class:"absolute top-0 left-0 h-full bg-gradient-to-r from-blue-500 via-purple-500 to-pink-500 transition-all duration-700 ease-out shadow-[0_0_10px_rgba(59,130,246,0.5)]",style:zs({width:`${Math.min(e(bt),100)}%`})},null,4)]),r(Ds,{"is-generating":e(ee),"generation-progress":e(He),"generation-percentage":e(rt),onStop:e(at)},null,8,["is-generating","generation-progress","generation-percentage","onStop"]),s("div",fo,[r(Me,{"enter-active-class":"transition-all duration-300 ease-in-out","enter-from-class":"-ml-72 opacity-0","enter-to-class":"ml-0 opacity-100","leave-active-class":"transition-all duration-300 ease-in-out","leave-from-class":"ml-0 opacity-100","leave-to-class":"-ml-72 opacity-0"},{default:n(()=>[e(Ge)?(y(),Q("div",mo,[s("div",ho,[s("div",vo,[s("div",bo,[t[87]||(t[87]=s("h2",{class:"text-sm font-semibold text-foreground mb-1"},"Table of Contents",-1)),s("p",xo,p(Ce.value.length)+" Chapters ",1)]),(y(),z(en,null,{fallback:n(()=>[...t[88]||(t[88]=[s("div",{class:"flex items-center justify-center p-8"},[s("div",{class:"h-6 w-6 animate-spin rounded-full border-2 border-primary border-t-transparent"})],-1)])]),default:n(()=>[r(e(b),{"all-chapters":Ce.value,"current-chapter":be.value,project:ve.value,outlines:o.project.outlines||[],"faculty-chapters":o.facultyChapters||[],"current-word-count":e(ne),"target-word-count":fe.value,"writing-quality-score":e(ye),"chapter-content-length":e(F).length,onGoToChapter:Te,onGenerateNextChapter:e(st)},null,8,["all-chapters","current-chapter","project","outlines","faculty-chapters","current-word-count","target-word-count","writing-quality-score","chapter-content-length","onGenerateNextChapter"])]),_:1}))])])])):K("",!0)]),_:1}),s("div",wo,[s("div",yo,[s("div",_o,[r(As,{context:jt.value},null,8,["context"]),t[89]||(t[89]=s("div",{class:"h-12"},null,-1))])])]),r(Me,{"enter-active-class":"transition-all duration-300 ease-in-out","enter-from-class":"-mr-72 opacity-0","enter-to-class":"mr-0 opacity-100","leave-active-class":"transition-all duration-300 ease-in-out","leave-from-class":"mr-0 opacity-100","leave-to-class":"-mr-72 opacity-0"},{default:n(()=>[e(Ie)?(y(),z($s,cs({key:0,"container-class":"w-72 flex-shrink-0 border-l border-border/40 bg-background/40 backdrop-blur-md"},Rt.value),null,16)):K("",!0)]),_:1})])])):(y(),z(ks,{key:3,class:"h-screen overflow-hidden bg-background dark:bg-background transition-colors duration-300"},{default:n(()=>[s("div",Co,[t[115]||(t[115]=s("div",{class:"absolute inset-0 z-0 overflow-hidden pointer-events-none"},[s("div",{class:"absolute top-[-10%] left-[-10%] w-[40%] h-[40%] rounded-full bg-blue-500/5 blur-[100px]"}),s("div",{class:"absolute bottom-[-10%] right-[-10%] w-[40%] h-[40%] rounded-full bg-purple-500/5 blur-[100px]"})],-1)),ze(s("aside",ko,[s("div",So,[t[91]||(t[91]=s("span",{class:"text-sm font-semibold tracking-tight text-foreground"},"Navigation",-1)),r(e(Fe),{variant:"outline",class:"text-[10px] h-5 px-1.5"},{default:n(()=>[l(p(Ce.value.length)+" Chapters ",1)]),_:1})]),r(e(fs),{class:"flex-1"},{default:n(()=>[s("div",Eo,[r(e(b),{"all-chapters":Ce.value,"current-chapter":be.value,project:ve.value,outlines:o.project.outlines||[],"faculty-chapters":o.facultyChapters||[],"current-word-count":e(ne),"target-word-count":fe.value,"writing-quality-score":e(ye),"chapter-content-length":e(F).length,onGoToChapter:Te,onGenerateNextChapter:e(st)},null,8,["all-chapters","current-chapter","project","outlines","faculty-chapters","current-word-count","target-word-count","writing-quality-score","chapter-content-length","onGenerateNextChapter"])])]),_:1})],512),[[Ne,!e(qe)]]),s("main",To,[s("header",Ao,[s("div",$o,[r(e(U),null,{default:n(()=>[r(e(B),{asChild:""},{default:n(()=>[r(e(v),{id:"back-to-project-btn-mobile",variant:"ghost",size:"icon",class:"h-9 w-9 text-zinc-700 dark:text-zinc-300 hover:text-foreground hover:bg-muted/50 rounded-full",onClick:t[12]||(t[12]=d=>e(J).visit(e(W)("projects.writing",a.project.slug)))},{default:n(()=>[r(e(Ct),{class:"w-4 h-4"})]),_:1})]),_:1}),r(e(H),null,{default:n(()=>[...t[92]||(t[92]=[l("Back to Writing",-1)])]),_:1})]),_:1}),t[93]||(t[93]=s("div",{class:"h-6 w-px bg-border/50 mx-1 hidden lg:block"},null,-1)),r(e(v),{variant:"ghost",size:"icon",onClick:t[13]||(t[13]=d=>pt.value=!0),class:"lg:hidden text-muted-foreground hover:text-foreground h-9 w-9 hover:bg-muted/50 rounded-full"},{default:n(()=>[r(e(as),{class:"h-4.5 w-4.5"})]),_:1})]),s("div",Do,[r(e(v),{variant:"ghost",size:"icon",onClick:t[14]||(t[14]=d=>gt.value=!0),class:"text-muted-foreground hover:text-foreground h-9 w-9 hover:bg-muted/50 rounded-full"},{default:n(()=>[r(e(Xe),{class:"h-4.5 w-4.5"})]),_:1})]),s("div",jo,[s("div",Ro,[s("h1",{class:"text-xl font-bold tracking-tight text-foreground leading-snug cursor-pointer hover:text-primary/80 transition-colors break-words",onClick:t[15]||(t[15]=d=>e(J).visit(e(W)("projects.show",a.project.slug)))},p(a.project.title),1),r(e(Fe),{variant:"secondary",class:"shrink-0 h-5 px-2 text-[10px] font-medium rounded-full bg-secondary/50 border border-border/50 mt-1"},{default:n(()=>[l(" Ch "+p(a.chapter.chapter_number),1)]),_:1})]),s("div",Po,[s("div",Fo,[r(kt,{project:ve.value,"current-chapter":be.value,"all-chapters":Ce.value,size:"icon",variant:"outline","trigger-element":"icon","button-class":"h-8 w-8 rounded-full bg-background/50 backdrop-blur-sm",class:"text-zinc-700 dark:text-zinc-300"},null,8,["project","current-chapter","all-chapters"]),r(e(v),{variant:"outline",size:"icon",class:"h-8 w-8 gap-2 text-zinc-700 dark:text-zinc-300 hover:text-foreground bg-background/50 backdrop-blur-sm rounded-full",onClick:yt},{default:n(()=>[r(e(ps),{class:"w-4 h-4"})]),_:1}),r(e(v),{variant:"outline",size:"icon",class:"h-8 w-8 gap-2 text-zinc-700 dark:text-zinc-300 hover:text-foreground bg-background/50 backdrop-blur-sm rounded-full",disabled:e(ee),onClick:t[16]||(t[16]=d=>x.value=!0),title:"Regenerate chapter"},{default:n(()=>[r(e(ut),{class:"w-4 h-4"})]),_:1},8,["disabled"])]),s("div",zo,[Ht.value?(y(),z(e(U),{key:0},{default:n(()=>[r(e(B),{asChild:""},{default:n(()=>[r(e(v),{onClick:xt,size:"icon",variant:"ghost",class:"h-9 w-9 rounded-full hover:bg-muted/50 transition-all active:scale-90"},{default:n(()=>[r(e(gs),{class:"h-4.5 w-4.5 text-foreground/70"})]),_:1})]),_:1}),r(e(H),null,{default:n(()=>[...t[94]||(t[94]=[l("Start writing next chapter",-1)])]),_:1})]),_:1})):K("",!0),r(e(v),{onClick:t[17]||(t[17]=d=>e(we)(!1)),disabled:e(he),variant:Ue.value?"default":"secondary",size:"sm",class:"h-8 px-3 text-xs shadow-sm gap-2 rounded-full min-w-[32px]"},{default:n(()=>[r(e(St),{class:"h-3.5 w-3.5"}),e(he)?(y(),Q("span",No,"Saving")):K("",!0)]),_:1},8,["disabled","variant"]),r(e(v),{onClick:_t,disabled:e(he),size:"sm",class:"h-8 px-3 text-xs shadow-sm gap-2 rounded-full"},{default:n(()=>[r(e(dt),{class:"h-3.5 w-3.5"}),t[95]||(t[95]=s("span",{class:"sm:hidden"},"Done",-1))]),_:1},8,["disabled"])])])])]),s("div",Mo,[s("div",Lo,[s("div",Oo,[s("h1",{class:"text-sm font-bold text-foreground cursor-pointer hover:text-primary transition-colors flex items-center",onClick:t[18]||(t[18]=d=>e(J).visit(e(W)("projects.show",a.project.slug)))},[s("div",{innerHTML:a.project.title,class:"inline-block"},null,8,qo)]),r(e(Fe),{variant:"secondary",class:"h-5 px-2 text-[10px] font-medium rounded-full bg-secondary/50 border border-border/50"},{default:n(()=>[l(" Ch "+p(a.chapter.chapter_number),1)]),_:1})])]),s("div",Wo,[s("div",Go,[r(e(U),null,{default:n(()=>[r(e(B),{asChild:""},{default:n(()=>[r(e(v),{id:"back-to-project-btn",variant:"ghost",size:"icon",class:"h-8 w-8 text-zinc-700 dark:text-zinc-300 hover:text-foreground rounded-full",onClick:t[19]||(t[19]=d=>e(J).visit(e(W)("projects.writing",a.project.slug)))},{default:n(()=>[r(e(Ct),{class:"w-4 h-4"})]),_:1})]),_:1}),r(e(H),null,{default:n(()=>[...t[96]||(t[96]=[l("Back to Writing",-1)])]),_:1})]),_:1}),t[97]||(t[97]=s("div",{class:"h-4 w-px bg-border/50 mx-1"},null,-1)),r(e(v),{id:"toggle-left-sidebar",variant:"ghost",size:"icon",onClick:t[20]||(t[20]=d=>qe.value=!e(qe)),class:"text-muted-foreground hover:text-foreground h-8 w-8 rounded-full"},{default:n(()=>[e(qe)?(y(),z(e(sn),{key:1,class:"h-4 w-4"})):(y(),z(e(tn),{key:0,class:"h-4 w-4"}))]),_:1})]),s("div",Io,[s("div",Bo,[r(e(U),null,{default:n(()=>[r(e(B),{asChild:""},{default:n(()=>[r(e(v),{onClick:Jt,variant:e(_e)?"secondary":"ghost",size:"sm",class:"h-7 px-3 text-xs gap-2 text-zinc-700 dark:text-zinc-300 hover:text-foreground rounded-full"},{default:n(()=>[e(_e)?(y(),z(e(rn),{key:1,class:"h-3.5 w-3.5"})):(y(),z(e(Ps),{key:0,class:"h-3.5 w-3.5"})),s("span",Ho,p(e(_e)?"Edit":"Preview"),1)]),_:1},8,["variant"])]),_:1}),r(e(H),null,{default:n(()=>[...t[98]||(t[98]=[l("Toggle Preview Mode",-1)])]),_:1})]),_:1}),t[102]||(t[102]=s("div",{class:"w-px h-3 bg-border/50 mx-0.5"},null,-1)),r(e(U),null,{default:n(()=>[r(e(B),{asChild:""},{default:n(()=>[r(e(v),{id:"toggle-chat-mode",onClick:Xt,variant:"ghost",size:"sm",class:"h-7 px-3 text-xs gap-2 text-muted-foreground hover:text-foreground rounded-full"},{default:n(()=>[r(e(os),{class:"h-3.5 w-3.5 text-blue-500"}),t[99]||(t[99]=s("span",{class:"hidden xl:inline text-foreground"},"AI Chat",-1))]),_:1})]),_:1}),r(e(H),null,{default:n(()=>[...t[100]||(t[100]=[l("Open AI Assistant",-1)])]),_:1})]),_:1}),t[103]||(t[103]=s("div",{class:"w-px h-3 bg-border/50 mx-0.5"},null,-1)),r(e(U),null,{default:n(()=>[r(e(B),{asChild:""},{default:n(()=>[r(e(v),{onClick:wt,variant:"ghost",size:"sm",class:"h-7 px-3 text-xs gap-2 text-muted-foreground hover:text-foreground rounded-full"},{default:n(()=>[e(re)?(y(),z(e(ls),{key:0,class:"h-3.5 w-3.5"})):(y(),z(e(is),{key:1,class:"h-3.5 w-3.5"})),s("span",Uo,p(e(re)?`Exit
                                                        Fullscreen`:"Fullscreen"),1)]),_:1})]),_:1}),r(e(H),null,{default:n(()=>[s("p",null,p(e(re)?"Exit fullscreen":"Enter fullscreen"),1)]),_:1})]),_:1}),t[104]||(t[104]=s("div",{class:"w-px h-3 bg-border/50 mx-0.5"},null,-1)),r(e(U),null,{default:n(()=>[r(e(B),{asChild:""},{default:n(()=>[r(e(v),{onClick:e(tt),variant:"ghost",size:"sm",class:"h-7 px-3 text-xs gap-2 text-zinc-700 dark:text-zinc-300 hover:text-foreground rounded-full"},{default:n(()=>[e(Oe)?(y(),z(e(ds),{key:0,class:"h-3.5 w-3.5 text-foreground"})):(y(),z(e(us),{key:1,class:"h-3.5 w-3.5"}))]),_:1},8,["onClick"])]),_:1}),r(e(H),null,{default:n(()=>[...t[101]||(t[101]=[l("Toggle Dark Mode",-1)])]),_:1})]),_:1})]),s("div",Qo,[r(kt,{id:"export-menu-container",project:ve.value,"current-chapter":be.value,"all-chapters":Ce.value,size:"sm",variant:"outline","trigger-element":"button","button-class":"h-9 gap-2 px-3 rounded-full bg-background/50 backdrop-blur-sm",class:"text-zinc-700 dark:text-zinc-300"},null,8,["project","current-chapter","all-chapters"]),r(e(v),{id:"analyze-button",variant:"outline",size:"sm",class:"h-9 gap-2 text-zinc-700 dark:text-zinc-300 hover:text-foreground bg-background/50 backdrop-blur-sm rounded-full",onClick:yt,title:"Open bulk analysis"},{default:n(()=>[r(e(ps),{class:"w-4 h-4"}),t[105]||(t[105]=s("span",{class:"text-xs font-medium"},"Analyze",-1))]),_:1}),r(e(U),null,{default:n(()=>[r(e(B),{asChild:""},{default:n(()=>[r(e(v),{id:"regenerate-button",variant:"outline",size:"sm",class:"h-9 gap-2 text-zinc-700 dark:text-zinc-300 hover:text-foreground bg-background/50 backdrop-blur-sm rounded-full",disabled:e(ee),onClick:t[21]||(t[21]=d=>x.value=!0)},{default:n(()=>[r(e(ut),{class:"w-4 h-4"}),t[106]||(t[106]=s("span",{class:"text-xs font-medium"},"Regenerate",-1))]),_:1},8,["disabled"])]),_:1}),r(e(H),null,{default:n(()=>[...t[107]||(t[107]=[l("Regenerate chapter content",-1)])]),_:1})]),_:1})]),s("div",Ko,[Ht.value?(y(),z(e(U),{key:0},{default:n(()=>[r(e(B),{asChild:""},{default:n(()=>[r(e(v),{onClick:xt,size:"icon",variant:"ghost",class:"h-9 w-9 rounded-full hover:bg-muted/50 transition-all active:scale-90"},{default:n(()=>[r(e(gs),{class:"h-5 w-5 text-foreground/70"})]),_:1})]),_:1}),r(e(H),null,{default:n(()=>[...t[108]||(t[108]=[l("Start writing next chapter",-1)])]),_:1})]),_:1})):K("",!0),r(e(v),{id:"save-button",onClick:t[22]||(t[22]=d=>e(we)(!1)),disabled:e(he),variant:Ue.value?"default":"secondary",size:"sm",class:"h-9 px-4 text-xs shadow-sm gap-2 rounded-full min-w-[32px]"},{default:n(()=>[r(e(St),{class:"h-3.5 w-3.5"}),s("span",Vo,p(e(he)?"Saving":"Save"),1)]),_:1},8,["disabled","variant"]),r(e(v),{id:"mark-complete-btn",onClick:_t,disabled:e(he),size:"sm",class:"h-9 px-4 text-xs shadow-sm gap-2 rounded-full"},{default:n(()=>[r(e(dt),{class:"h-3.5 w-3.5"}),t[109]||(t[109]=s("span",null,"Mark Complete",-1))]),_:1},8,["disabled"]),t[111]||(t[111]=s("div",{class:"w-px h-4 bg-border/50 mx-1"},null,-1)),t[112]||(t[112]=s("div",{class:"w-px h-4 bg-border/50 mx-1"},null,-1)),r(e(U),null,{default:n(()=>[r(e(B),{asChild:""},{default:n(()=>[r(e(v),{id:"reset-tour-button",variant:"ghost",size:"icon",onClick:es,class:"text-muted-foreground hover:text-foreground h-9 w-9 hover:bg-muted/50 rounded-full"},{default:n(()=>[r(e(nn),{class:"h-4.5 w-4.5"})]),_:1})]),_:1}),r(e(H),null,{default:n(()=>[...t[110]||(t[110]=[l("Restart Tutorial",-1)])]),_:1})]),_:1}),r(e(v),{id:"toggle-right-sidebar",variant:"ghost",size:"icon",onClick:t[23]||(t[23]=d=>We.value=!e(We)),class:"hidden lg:flex text-muted-foreground hover:text-foreground h-9 w-9 hover:bg-muted/50 rounded-full"},{default:n(()=>[e(We)?(y(),z(e(on),{key:1,class:"h-4.5 w-4.5"})):(y(),z(e(an),{key:0,class:"h-4.5 w-4.5"}))]),_:1})])])])]),s("div",Xo,[r(Ds,{"is-generating":e(ee),"generation-progress":e(He),"generation-percentage":e(rt),onStop:e(at)},null,8,["is-generating","generation-progress","generation-percentage","onStop"]),r(e(fs),{ref_key:"editorScrollRef",ref:Sr,class:"h-full w-full","data-editor-scroll-container":""},{default:n(()=>[s("div",Jo,[ze(s("div",Yo,[r(Ms,{ref_key:"richTextEditorFullscreen",ref:P,modelValue:e(F),"onUpdate:modelValue":t[24]||(t[24]=d=>ln(F)?F.value=d:null),placeholder:"Start writing your chapter...",class:"prose prose-slate dark:prose-invert prose-lg max-w-none focus:outline-none min-h-[500px]","streaming-mode":e(Mt),"is-generating":e(ee),"generation-progress":e(He),"generation-percentage":e(rt),"generation-phase":e(Ft),"onUpdate:selectedText":t[25]||(t[25]=d=>ge.value=d),"min-height":"500px"},null,8,["modelValue","streaming-mode","is-generating","generation-progress","generation-percentage","generation-phase"])],512),[[Ne,!e(_e)]]),ze(s("div",Zo,[r(Ls,{content:e(F),class:"prose prose-slate dark:prose-invert prose-lg max-w-none"},null,8,["content"])],512),[[Ne,e(_e)]])])]),_:1},512)]),s("div",el,[s("div",tl,[s("span",sl,"Words: "+p(e(ne))+" / "+p(fe.value),1)]),s("div",rl,[r(e(v),{disabled:!ot.value?.exists,onClick:jr,variant:"ghost",size:"icon",class:"h-8 w-8 rounded-full hover:bg-muted/50 disabled:opacity-30"},{default:n(()=>[r(e(dn),{class:"h-4 w-4 text-foreground/60"})]),_:1},8,["disabled"]),s("div",nl," Chapter "+p(a.chapter.chapter_number),1),r(e(v),{disabled:!Ee.value,onClick:xt,variant:"ghost",size:"icon",class:"h-8 w-8 rounded-full hover:bg-muted/50 disabled:opacity-30"},{default:n(()=>[r(e(un),{class:"h-4 w-4 text-foreground/60"})]),_:1},8,["disabled"])]),s("div",al,[s("span",ol,p(e(he)?"Saving...":"Saved"),1),s("div",ll,[s("span",null,[t[113]||(t[113]=l("Quality: ",-1)),s("span",{class:Ve(e(ye)>70?"text-green-500":"text-amber-500")},p(e(ye))+"%",3)]),Ue.value?(y(),Q("span",il,[r(e(dt),{class:"h-3 w-3"}),t[114]||(t[114]=l(" Ready ",-1))])):K("",!0)])])])]),r($s,cs({id:"right-sidebar-panel","is-collapsed":e(We),"container-class":"hidden lg:flex w-96 flex-col border-l border-border/40 bg-background/60 backdrop-blur-xl z-20 transition-all duration-300"},Rt.value),null,16,["is-collapsed"])]),r(e(i),{"show-left-sidebar":e(pt),"show-right-sidebar":e(gt),"is-mobile":e(ft),"all-chapters":Ce.value,"current-chapter":be.value,project:ve.value,"current-word-count":e(ne),"target-word-count":fe.value,"writing-quality-score":e(ye),"chapter-content-length":e(F).length,"is-generating":e(ee),"selected-text":e(ge),"is-loading-suggestions":e(Nt),"show-citation-helper":e(nt),"chapter-content":e(F),outlines:o.project.outlines||[],"faculty-chapters":o.facultyChapters||[],"onUpdate:showLeftSidebar":t[26]||(t[26]=d=>pt.value=d),"onUpdate:showRightSidebar":t[27]||(t[27]=d=>gt.value=d),onGoToChapter:Te,onGenerateNextChapter:e(st),onStartStreamingGeneration:e(Ot),onGetAiSuggestions:e(qt),"onUpdate:showCitationHelper":t[28]||(t[28]=d=>nt.value=d),onCheckCitations:e(Wt)},null,8,["show-left-sidebar","show-right-sidebar","is-mobile","all-chapters","current-chapter","project","current-word-count","target-word-count","writing-quality-score","chapter-content-length","is-generating","selected-text","is-loading-suggestions","show-citation-helper","chapter-content","outlines","faculty-chapters","onGenerateNextChapter","onStartStreamingGeneration","onGetAiSuggestions","onCheckCitations"]),r(e(ms),{open:x.value,"onUpdate:open":t[29]||(t[29]=d=>x.value=d)},{default:n(()=>[r(e(hs),null,{default:n(()=>[r(e(vs),null,{default:n(()=>[r(e(bs),null,{default:n(()=>[...t[116]||(t[116]=[l("Regenerate Chapter?",-1)])]),_:1}),r(e(xs),null,{default:n(()=>[...t[117]||(t[117]=[l(" This will replace all existing content with freshly generated content. Your current content will be saved to history, so you can undo if needed. ",-1)])]),_:1})]),_:1}),r(e(ws),null,{default:n(()=>[r(e(ys),null,{default:n(()=>[...t[118]||(t[118]=[l("Cancel",-1)])]),_:1}),r(e(_s),{onClick:Rr,class:"bg-primary hover:bg-primary/90"},{default:n(()=>[r(e(ut),{class:"w-4 h-4 mr-2"}),t[119]||(t[119]=l(" Regenerate ",-1))]),_:1})]),_:1})]),_:1})]),_:1},8,["open"]),r(e(ms),{open:A.value,"onUpdate:open":t[30]||(t[30]=d=>A.value=d)},{default:n(()=>[r(e(hs),{class:"max-w-md"},{default:n(()=>[r(e(vs),null,{default:n(()=>[s("div",dl,[s("div",ul,[r(e(Xe),{class:"w-5 h-5 text-amber-500"})]),r(e(bs),{class:"text-lg"},{default:n(()=>[...t[120]||(t[120]=[l("AI is Writing Your Chapter",-1)])]),_:1})]),r(e(xs),{class:"text-sm space-y-2"},{default:n(()=>[t[122]||(t[122]=s("p",null,"Your chapter is currently being written by AI. Leaving now will:",-1)),s("ul",cl,[t[121]||(t[121]=s("li",null,"Stop the writing process immediately",-1)),s("li",null,"Lose any unsaved content ("+p(e(zt))+" words written so far)",1)]),t[123]||(t[123]=s("p",{class:"font-medium text-foreground pt-2"},"Are you sure you want to leave?",-1))]),_:1})]),_:1}),r(e(ws),{class:"gap-2 sm:gap-0"},{default:n(()=>[r(e(ys),{onClick:Or,class:"flex-1 sm:flex-none"},{default:n(()=>[...t[124]||(t[124]=[l(" Stay on Page ",-1)])]),_:1}),r(e(_s),{onClick:Lr,class:"flex-1 sm:flex-none bg-destructive hover:bg-destructive/90 text-destructive-foreground"},{default:n(()=>[...t[125]||(t[125]=[l(" Leave Anyway ",-1)])]),_:1})]),_:1})]),_:1})]),_:1},8,["open"]),r(gn,{open:e(At),"current-balance":e(Ws),"required-words":e(Gs),action:e(Is),"onUpdate:open":t[31]||(t[31]=d=>At.value=d),onClose:e(Hs)},null,8,["open","current-balance","required-words","action","onClose"]),e(Cr)?(y(),Q("div",pl,[r(e(ae),{class:"w-full max-w-md mx-4 bg-white dark:bg-slate-900 border-amber-500/50 shadow-2xl"},{default:n(()=>[r(e(le),null,{default:n(()=>[r(e(me),{class:"flex items-center gap-2 text-amber-600 dark:text-amber-400"},{default:n(()=>[...t[126]||(t[126]=[s("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[s("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"})],-1),l(" Generation Interrupted ",-1)])]),_:1})]),_:1}),r(e(oe),null,{default:n(()=>[s("p",gl,[t[127]||(t[127]=l(" Connection lost. ",-1)),s("span",fl,p(e(kr))+" words",1),t[128]||(t[128]=l(" may have been saved. ",-1))]),s("div",ml,[r(e(v),{onClick:e(Ar),class:"flex-1 bg-amber-600 hover:bg-amber-700 text-white"},{default:n(()=>[...t[129]||(t[129]=[s("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-4 w-4 mr-2",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[s("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"})],-1),l(" Reload & Recover ",-1)])]),_:1},8,["onClick"]),r(e(v),{onClick:e($r),variant:"outline",class:"flex-1"},{default:n(()=>[...t[130]||(t[130]=[l(" Dismiss ",-1)])]),_:1},8,["onClick"])])]),_:1})]),_:1})])):K("",!0)]),_:1}))],64))]),_:1}))}}),bl=Os(vl,[["__scopeId","data-v-8250a2de"]]),Pi=Object.freeze(Object.defineProperty({__proto__:null,default:bl},Symbol.toStringTag,{value:"Module"}));export{xa as A,Pi as C};
