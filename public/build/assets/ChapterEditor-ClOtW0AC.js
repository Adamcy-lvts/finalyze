const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/AISidebar-CzNKWM82.js","assets/app-Clzd9Bsi.js","assets/app-DFJZ-KiX.css","assets/index-r9kGFX4y.js","assets/CardContent.vue_vue_type_script_setup_true_lang-Cy_Amd0v.js","assets/CardTitle.vue_vue_type_script_setup_true_lang-DNpuNjMF.js","assets/CollapsibleTrigger.vue_vue_type_script_setup_true_lang-DomDuDbQ.js","assets/VisuallyHidden-SAhBLAE3.js","assets/useForwardExpose-BWFJ1onI.js","assets/Separator.vue_vue_type_script_setup_true_lang-Zw7Jpl8K.js","assets/Separator-ByzQ7aSG.js","assets/Progress.vue_vue_type_script_setup_true_lang-CTDyOmHP.js","assets/nullish-CHIgUVhi.js","assets/Sonner.vue_vue_type_script_setup_true_lang-BcKe5NWN.js","assets/DropdownMenuTrigger.vue_vue_type_script_setup_true_lang-Cy9_2Amo.js","assets/triangle-alert-D77akLyL.js","assets/circle-check-yUInOtrO.js","assets/CitationHelper.vue_vue_type_script_setup_true_lang-0OzxY4-f.js","assets/index-BLDDm4SC.js","assets/Input.vue_vue_type_script_setup_true_lang-0QNgDnmY.js","assets/ScrollArea.vue_vue_type_script_setup_true_lang-jITy_fbi.js","assets/useNonce-CIJa6W3y.js","assets/AlertDialogTitle.vue_vue_type_script_setup_true_lang-BF-yljYJ.js","assets/RichTextEditor-DHgubjsI.js","assets/_plugin-vue_export-helper-DlAUqK2U.js","assets/SafeHtmlText.vue_vue_type_script_setup_true_lang-B-58FIzx.js","assets/index-BWEDi_FC.js","assets/step-DrZ9DcYd.js","assets/chart-column-DjZEhbM8.js","assets/calendar-Cuz8iHEp.js","assets/brain-BiY5baCf.js","assets/users-yzWkUIKH.js","assets/circle-alert-DU3aaV_n.js","assets/eye-C1PglN3Z.js","assets/check-DPcyl2yq.js","assets/download-CDL8luKC.js","assets/trash-2-Cx8zxFUg.js","assets/DialogTitle.vue_vue_type_script_setup_true_lang-D4ExXSoE.js","assets/DialogFooter.vue_vue_type_script_setup_true_lang-DGZmytA5.js","assets/Label.vue_vue_type_script_setup_true_lang-CrGDrJDB.js","assets/type-BUJCvLYL.js","assets/minus-CMp3Adeb.js","assets/plus-7MzJ41uZ.js","assets/list-CRiYVQbz.js","assets/RichTextEditor-DZuLOkx6.css","assets/chevron-down-Cl7xuOoR.js","assets/wand-sparkles-DSUcFfgA.js","assets/search-BHEbxjyo.js","assets/history-BatBODM2.js","assets/zap-CBwoTKt7.js","assets/pen-tool-CJwS3M-a.js","assets/refresh-cw-CNVGtNIe.js","assets/sparkles-CvNa-6N9.js","assets/AISidebar-Ymbz_oju.css","assets/ChapterNavigation-CNe3fVBI.js","assets/ChapterNavigation.vue_vue_type_script_setup_true_lang-B3f-_Bnc.js","assets/DialogTrigger-B6r8ncsd.js","assets/chevron-right-LGBOzeQ0.js","assets/circle-check-big-DBBdXBmh.js","assets/lock-EL7SZwTe.js","assets/target-CbVBlev1.js","assets/MobileNavOverlay-Dl_-vF8F.js","assets/index-BP2MGVUy.js","assets/DefensePreparationPanel.vue_vue_type_script_setup_true_lang-TsB7jgtL.js","assets/Switch.vue_vue_type_script_setup_true_lang-DLjlO6MJ.js","assets/VisuallyHiddenInput-D-AtWZ9Z.js","assets/thumbs-up-Bm2NXmgP.js","assets/lightbulb-89fo02fH.js","assets/DataCollectionPanel.vue_vue_type_script_setup_true_lang-CfFPs0Lh.js","assets/MobileNavOverlay-CN-XSdXy.css","assets/ChatModeLayout-Dmw8_0fU.js","assets/ChatModeLayout.vue_vue_type_script_setup_true_lang-BUme9r0e.js","assets/square-CuE3IC4s.js","assets/useTextHistory-BvTeaczw.js","assets/Checkbox.vue_vue_type_script_setup_true_lang-BeIzg5nr.js","assets/ohash.D__AXeF1-C-E83dC9.js","assets/RovingFocusItem-D1xDS2MS.js","assets/file-text-DZWCW32C.js","assets/useTextHistory-BLZ3MaDD.css","assets/loader-zQWAbIQW.js","assets/message-square-CLDwgvlN.js","assets/chevron-left-DHsQ2OBD.js","assets/clock-I2w8x58e.js","assets/user-DGeQtiVi.js","assets/save-DR8xLKJg.js","assets/ChatModeLayout-wjQGykpm.css","assets/CitationVerificationLayout-CnGtSc2A.js","assets/DefensePreparationPanel-C5ptwkXT.js","assets/DataCollectionPanel-1WfeQE6o.js"])))=>i.map(i=>d[i]);
import{ak as Co,ab as So,d as Tr,g as M,c as K,q as oe,o as T,u as r,w as i,k as s,f as o,s as $,n as pe,t as R,a as V,F as vr,A as hr,X as st,z as c,Q as ye,C as he,y as Q,j as Ar,U as ko,h as ht,p as ft,H as Eo,al as qe,x as Ke,T as mt,am as wt,b as Ve,e as Qe,an as De}from"./app-Clzd9Bsi.js";import{_ as Le}from"./index-BLDDm4SC.js";import{_ as B}from"./index-r9kGFX4y.js";import{_ as jt,a as Ft}from"./CardContent.vue_vue_type_script_setup_true_lang-Cy_Amd0v.js";import{_ as Lt,a as $r}from"./CardTitle.vue_vue_type_script_setup_true_lang-DNpuNjMF.js";import{_ as To}from"./Input.vue_vue_type_script_setup_true_lang-0QNgDnmY.js";import{_ as Ao}from"./Label.vue_vue_type_script_setup_true_lang-CrGDrJDB.js";import{_ as fr}from"./ScrollArea.vue_vue_type_script_setup_true_lang-jITy_fbi.js";import{_ as Me,a as je,b as Fe}from"./UserInfo.vue_vue_type_script_setup_true_lang-EoEoUKwX.js";import{u as $o,r as Je,_ as Ro,a as Po}from"./AppLayout.vue_vue_type_script_setup_true_lang-BzRJLKou.js";import{_ as mr}from"./SafeHtmlText.vue_vue_type_script_setup_true_lang-B-58FIzx.js";import{t as w}from"./Sonner.vue_vue_type_script_setup_true_lang-BcKe5NWN.js";import{_ as qo}from"./PurchaseModal.vue_vue_type_script_setup_true_lang-C8Pn1zd6.js";import{_ as Do}from"./Progress.vue_vue_type_script_setup_true_lang-CTDyOmHP.js";import{B as xt,u as Mo,M as wr,_ as br,R as xr,a as jo,b as Fo,P as Lo,c as Oo}from"./useTextHistory-BvTeaczw.js";import{T as Wo}from"./trending-up-CwKgZWcl.js";import{C as Io}from"./circle-alert-DU3aaV_n.js";import{ap as yr}from"./RichTextEditor-DHgubjsI.js";import{t as _r}from"./toNumber-HOLhf6Hz.js";import{A as No}from"./arrow-left-BAVJCNYy.js";import{B as nt}from"./brain-BiY5baCf.js";import{T as Cr}from"./target-CbVBlev1.js";import{E as Sr}from"./eye-C1PglN3Z.js";import{S as kr}from"./save-DR8xLKJg.js";import{C as Dt}from"./circle-check-big-DBBdXBmh.js";import{P as Uo,a as zo}from"./panel-left-open-pvj3LeTX.js";import{M as Go}from"./message-square-CLDwgvlN.js";import{_ as Ho}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./useForwardExpose-BWFJ1onI.js";import"./VisuallyHidden-SAhBLAE3.js";import"./useNonce-CIJa6W3y.js";import"./DropdownMenuTrigger.vue_vue_type_script_setup_true_lang-Cy9_2Amo.js";import"./coins-Dw9CZQGX.js";import"./AppLogoIcon.vue_vue_type_script_setup_true_lang-DbEapk3Q.js";import"./plus-7MzJ41uZ.js";import"./chevron-right-LGBOzeQ0.js";import"./triangle-alert-D77akLyL.js";import"./circle-check-yUInOtrO.js";import"./DialogTitle.vue_vue_type_script_setup_true_lang-D4ExXSoE.js";import"./DialogFooter.vue_vue_type_script_setup_true_lang-DGZmytA5.js";import"./sparkles-CvNa-6N9.js";import"./arrow-right-Bei_KJIu.js";import"./nullish-CHIgUVhi.js";import"./Checkbox.vue_vue_type_script_setup_true_lang-BeIzg5nr.js";import"./ohash.D__AXeF1-C-E83dC9.js";import"./VisuallyHiddenInput-D-AtWZ9Z.js";import"./RovingFocusItem-D1xDS2MS.js";import"./minus-CMp3Adeb.js";import"./check-DPcyl2yq.js";import"./Separator.vue_vue_type_script_setup_true_lang-Zw7Jpl8K.js";import"./Separator-ByzQ7aSG.js";import"./download-CDL8luKC.js";import"./chevron-down-Cl7xuOoR.js";import"./file-text-DZWCW32C.js";import"./index-BWEDi_FC.js";import"./step-DrZ9DcYd.js";import"./chart-column-DjZEhbM8.js";import"./calendar-Cuz8iHEp.js";import"./users-yzWkUIKH.js";import"./trash-2-Cx8zxFUg.js";import"./type-BUJCvLYL.js";import"./list-CRiYVQbz.js";var Mt=function(){return Co.Date.now()},Bo="Expected a function",Ko=Math.max,Vo=Math.min;function Qo(L,v,E){var j,m,d,b,g,n,P=0,N=!1,f=!1,O=!0;if(typeof L!="function")throw new TypeError(Bo);v=_r(v)||0,So(E)&&(N=!!E.leading,f="maxWait"in E,d=f?Ko(_r(E.maxWait)||0,v):d,O="trailing"in E?!!E.trailing:O);function h(I){var C=j,J=m;return j=m=void 0,P=I,b=L.apply(J,C),b}function D(I){return P=I,g=setTimeout(le,v),N?h(I):b}function U(I){var C=I-n,J=I-P,te=v-C;return f?Vo(te,d-J):te}function Z(I){var C=I-n,J=I-P;return n===void 0||C>=v||C<0||f&&J>=d}function le(){var I=Mt();if(Z(I))return ge(I);g=setTimeout(le,U(I))}function ge(I){return g=void 0,O&&j?h(I):(j=m=void 0,b)}function fe(){g!==void 0&&clearTimeout(g),P=0,j=n=m=g=void 0}function me(){return g===void 0?b:ge(Mt())}function ue(){var I=Mt(),C=Z(I);if(j=arguments,m=this,n=I,C){if(g===void 0)return D(n);if(f)return clearTimeout(g),g=setTimeout(le,v),h(n)}return g===void 0&&(g=setTimeout(le,v)),b}return ue.cancel=fe,ue.flush=me,ue}const Jo={class:"flex items-center justify-between mb-3"},Xo={class:"flex items-center gap-3"},Yo={class:"p-2 rounded-lg bg-blue-500/10"},Zo={class:"text-right"},ea={class:"space-y-2"},ta={class:"flex justify-between items-center text-xs"},ra={class:"relative"},oa={key:0},aa={class:"space-y-3"},na={class:"flex-1"},sa={class:"text-sm font-medium"},la={class:"text-xs text-muted-foreground"},ia={class:"w-20 h-2 bg-muted rounded-full overflow-hidden ml-3"},ca={key:1},ua={class:"space-y-2"},da={class:"flex-1"},pa={class:"text-sm font-medium"},ga={class:"text-xs text-muted-foreground"},va={key:2,class:"flex items-center justify-center gap-3 p-4 rounded-lg bg-blue-50/50 border border-blue-200/50"},ha={key:3,class:"text-center p-4 rounded-lg bg-muted/30"},Er=Tr({__name:"WritingStatistics",props:{showStatistics:{type:Boolean},currentWordCount:{},writingStats:{},qualityAnalysis:{},isAnalyzing:{type:Boolean}},setup(L){const v=L;M(()=>{if(!v.qualityAnalysis?.quality_level)return"text-muted-foreground";switch(v.qualityAnalysis.quality_level){case"Excellent":return"text-green-600";case"Good":return"text-blue-600";case"Satisfactory":return"text-yellow-600";case"Needs Improvement":return"text-orange-600";case"Poor":return"text-red-600";default:return"text-muted-foreground"}});const E=M(()=>v.qualityAnalysis?.scores?Object.entries(v.qualityAnalysis.scores).filter(([,m])=>m.max>0).filter(([,m])=>m.percentage<75).sort(([,m],[,d])=>m.percentage-d.percentage).map(([m,d])=>({category:m.replace(" & "," & "),percentage:Math.round(d.percentage),score:d.score,max:d.max,status:d.percentage<40?"poor":d.percentage<60?"needs-work":"fair"})):[]),j=M(()=>{const m=v.qualityAnalysis?.total_score||0;return m>=80?{text:"Excellent",color:"text-green-600",bgColor:"bg-green-50"}:m>=70?{text:"Satisfactory",color:"text-yellow-600",bgColor:"bg-yellow-50"}:m>=60?{text:"Needs Work",color:"text-orange-600",bgColor:"bg-orange-50"}:{text:"Poor",color:"text-red-600",bgColor:"bg-red-50"}});return(m,d)=>m.showStatistics?(T(),K(r(jt),{key:0,class:"border border-border/50 bg-gradient-to-br from-card/80 to-card/60 backdrop-blur-sm shadow-lg"},{default:i(()=>[m.qualityAnalysis?(T(),K(r(Lt),{key:0,class:"pb-4 border-b border-border/50"},{default:i(()=>[o("div",Jo,[o("div",Xo,[o("div",Yo,[s(r(xt),{class:"h-4 w-4 text-blue-600"})]),o("div",null,[s(r($r),{class:"text-sm font-semibold"},{default:i(()=>[...d[0]||(d[0]=[$("Academic Quality",-1)])]),_:1}),d[1]||(d[1]=o("p",{class:"text-xs text-muted-foreground"},"AI-powered analysis",-1))])]),o("div",Zo,[o("div",{class:pe(["text-2xl font-bold",j.value.color])},[$(R(m.qualityAnalysis.total_score),1),d[2]||(d[2]=o("span",{class:"text-sm text-muted-foreground"},"/100",-1))],2),s(r(Le),{class:pe([[j.value.color,j.value.bgColor],"text-xs font-medium"]),variant:"outline"},{default:i(()=>[$(R(j.value.text),1)]),_:1},8,["class"])])]),o("div",ea,[o("div",ta,[d[3]||(d[3]=o("span",{class:"text-muted-foreground"},"Overall Score",-1)),o("span",{class:pe(["font-medium",m.qualityAnalysis.meets_threshold?"text-green-600":"text-orange-600"])},R(m.qualityAnalysis.meets_threshold?"Meets threshold âœ“":"Below 80% threshold"),3)]),o("div",ra,[s(r(Do),{"model-value":Math.round(m.qualityAnalysis.total_score||0),class:pe(["h-2",{"[&>[data-slot=progress-indicator]]:bg-green-500":(m.qualityAnalysis.total_score||0)>=80,"[&>[data-slot=progress-indicator]]:bg-yellow-500":(m.qualityAnalysis.total_score||0)>=70&&(m.qualityAnalysis.total_score||0)<80,"[&>[data-slot=progress-indicator]]:bg-orange-500":(m.qualityAnalysis.total_score||0)>=60&&(m.qualityAnalysis.total_score||0)<70,"[&>[data-slot=progress-indicator]]:bg-red-500":(m.qualityAnalysis.total_score||0)<60}])},null,8,["model-value","class"]),d[4]||(d[4]=o("div",{class:"absolute inset-0 flex items-center justify-center"},[o("div",{class:"w-0.5 h-4 bg-orange-400/60 rounded-full",style:{"margin-left":"80%"}})],-1))])])]),_:1})):oe("",!0),s(r(Ft),{class:"p-4 space-y-4"},{default:i(()=>[m.qualityAnalysis?.scores?(T(),V("div",oa,[d[5]||(d[5]=o("h4",{class:"text-xs font-semibold text-muted-foreground mb-3 flex items-center gap-2"},[o("div",{class:"w-1 h-4 bg-green-500 rounded-full"}),$(" Analysis Results ")],-1)),o("div",aa,[(T(!0),V(vr,null,hr(Object.entries(m.qualityAnalysis.scores).filter(([,b])=>b.max>0),([b,g])=>(T(),V("div",{key:b,class:"flex items-center justify-between p-3 rounded-lg bg-muted/30 hover:bg-muted/40 transition-colors"},[o("div",na,[o("div",sa,R(b),1),o("div",la,[$(R(g.score)+"/"+R(g.max)+" points ",1),o("span",{class:pe(["ml-1",{"text-red-500":g.percentage<50,"text-orange-500":g.percentage>=50&&g.percentage<75,"text-blue-500":g.percentage>=75&&g.percentage<90,"text-green-500":g.percentage>=90}])}," ("+R(Math.round(g.percentage))+"%) ",3)])]),o("div",ia,[o("div",{class:pe(["h-full transition-all duration-500 rounded-full",{"bg-red-500":g.percentage<50,"bg-orange-500":g.percentage>=50&&g.percentage<75,"bg-blue-500":g.percentage>=75&&g.percentage<90,"bg-green-500":g.percentage>=90}]),style:st({width:`${g.percentage}%`})},null,6)])]))),128))])])):oe("",!0),E.value.length>0?(T(),V("div",ca,[d[6]||(d[6]=o("h4",{class:"text-xs font-semibold text-muted-foreground mb-3 flex items-center gap-2"},[o("div",{class:"w-1 h-4 bg-orange-500 rounded-full"}),$(" Focus Areas ")],-1)),o("div",ua,[(T(!0),V(vr,null,hr(E.value,b=>(T(),V("div",{key:b.category,class:"flex items-center gap-3 p-3 rounded-lg border border-orange-200/50 bg-orange-50/30"},[s(r(Io),{class:"h-4 w-4 text-orange-500 flex-shrink-0"}),o("div",da,[o("div",pa,R(b.category),1),o("div",ga,[$(R(b.score)+"/"+R(b.max)+" points - ",1),o("span",{class:pe({"text-red-600":b.status==="poor","text-orange-600":b.status==="needs-work","text-yellow-600":b.status==="fair"})},R(b.status==="poor"?"needs significant improvement":b.status==="needs-work"?"needs improvement":"fair, could be better"),3)])])]))),128))])])):oe("",!0),m.isAnalyzing?(T(),V("div",va,[s(r(Wo),{class:"h-4 w-4 text-blue-500 animate-pulse"}),d[7]||(d[7]=o("span",{class:"text-sm text-blue-700 font-medium"},"Analyzing academic quality with AI...",-1))])):oe("",!0),!m.qualityAnalysis&&!m.isAnalyzing?(T(),V("div",ha,[s(r(xt),{class:"h-8 w-8 text-muted-foreground mx-auto mb-2"}),d[8]||(d[8]=o("p",{class:"text-sm text-muted-foreground"},'Click "Analyze" to get AI-powered quality insights',-1))])):oe("",!0)]),_:1})]),_:1})):oe("",!0)}});function fa(L){const{delay:v=1e4,onSave:E}=L,j=c(!1),m=c(!1),d=c(null),b=()=>{j.value=!0,d.value&&clearTimeout(d.value),d.value=setTimeout(()=>{g(!0)},v)},g=async(P=!1)=>{if(!m.value){m.value=!0;try{await E(P),j.value=!1,d.value&&(clearTimeout(d.value),d.value=null)}finally{m.value=!1}}};return{hasUnsavedChanges:j,isSaving:m,triggerAutoSave:b,save:g,clearAutoSave:()=>{d.value&&(clearTimeout(d.value),d.value=null)}}}function ma(L){const v=c({sentences:0,paragraphs:0,readingTime:0,avgWordLength:0,uniqueWords:0,commonWords:[]}),E=M(()=>L.value?L.value.split(/\s+/).filter(d=>d.length>0).length:0),j=()=>{if(!L.value){v.value={sentences:0,paragraphs:0,readingTime:0,avgWordLength:0,uniqueWords:0,commonWords:[]};return}const d=L.value,b=d.split(/\s+/).filter(O=>O.length>0),g=d.split(/[.!?]+/).filter(O=>O.trim().length>0),n=d.split(`

`).filter(O=>O.trim().length>0),P=new Map;b.forEach(O=>{const h=O.toLowerCase().replace(/[^a-z0-9]/g,"");h&&P.set(h,(P.get(h)||0)+1)});const N=new Set(["the","a","an","and","or","but","in","on","at","to","for","of","with","by","is","was","are","were"]),f=Array.from(P.entries()).filter(([O])=>!N.has(O)).sort((O,h)=>h[1]-O[1]).slice(0,5).map(([O])=>O);v.value={sentences:g.length,paragraphs:n.length,readingTime:Math.ceil(b.length/200),avgWordLength:b.reduce((O,h)=>O+h.length,0)/b.length,uniqueWords:P.size,commonWords:f}},m=M(()=>{if(!L.value)return 0;let d=0;const b=L.value;b.includes("##")&&(d+=20),b.length>1e3&&(d+=20),b.match(/\[.*?\]/g)&&(d+=15),(b.includes("**")||b.includes("*"))&&(d+=10);const g=b.split(/[.!?]+/).filter(P=>P.trim().length>0);if(g.length>0){const P=g.reduce((N,f)=>N+f.split(/\s+/).length,0)/g.length;P>10&&P<25&&(d+=20)}return b.split(`

`).filter(P=>P.trim().length>0).length>3&&(d+=15),Math.min(d,100)});return{writingStats:v,currentWordCount:E,writingQualityScore:m,calculateWritingStats:j}}function wa(L,v=c(3e3),E=.8){const j=l=>{if(!l)return 0;const G=l.replace(/<[^>]*>/g,"").trim().replace(/\s+/g," ");if(!G)return 0;const S=G.match(/\b\w+\b/g);return S?S.length:0},m=l=>l?l.replace(/<[^>]*>/g,"").replace(/\r\n|\r/g,`
`).trim().split(/\n\s*\n/).filter(k=>k.trim().length>0).length:0,d=l=>{if(!l)return 0;const G=l.replace(/<[^>]*>/g,"").match(/[.!?]+/g);return G?G.length:0},b=l=>Math.round(l/200*10)/10,g=M(()=>j(L.value)),n=M(()=>L.value.length),P=M(()=>L.value.replace(/\s/g,"").length),N=M(()=>m(L.value)),f=M(()=>d(L.value)),O=M(()=>b(g.value)),h=M(()=>{const l=v.value;return!l||l<=0?0:Math.min(g.value/l*100,100)}),D=M(()=>g.value>=v.value*E),U=M(()=>{const l=v.value-g.value;return Math.max(l,0)}),Z=M(()=>{const l=v.value*E-g.value;return Math.max(l,0)}),le=M(()=>({wordCount:g.value,characterCount:n.value,characterCountNoSpaces:P.value,paragraphCount:N.value,sentenceCount:f.value,readingTimeMinutes:O.value})),ge=M(()=>({current:g.value,target:v.value,percentage:h.value,isComplete:D.value,completionThreshold:E})),fe=l=>l>=1e3?`${Math.round(l/100)/10}k`:l.toString(),me=(l=0)=>`${Math.round(h.value*Math.pow(10,l))/Math.pow(10,l)}%`,ue=()=>`${g.value} / ${v.value} words (${me()}%)`,I=()=>{if(D.value)return`âœ… Complete (${fe(g.value)} words)`;const l=Z.value;return`${fe(l)} more words to complete`},C=()=>{const l=g.value,x=v.value;return l===0?"empty":l<x*.25?"started":l<x*.75?"progressing":l<x*E?"near_complete":l<x?"complete":"exceeded"},J=()=>{const l=C();return{empty:"text-gray-500",started:"text-blue-500",progressing:"text-yellow-500",near_complete:"text-orange-500",complete:"text-green-500",exceeded:"text-emerald-600"}[l]},te=()=>{const l=C();return{empty:"bg-gray-200",started:"bg-blue-200",progressing:"bg-yellow-200",near_complete:"bg-orange-200",complete:"bg-green-200",exceeded:"bg-emerald-200"}[l]},ae=800,ke=M(()=>g.value>=ae),q=M(()=>Math.max(ae-g.value,0)),_=M(()=>Math.min(g.value/ae*100,100));return{currentWordCount:g,characterCount:n,characterCountNoSpaces:P,paragraphCount:N,sentenceCount:f,readingTimeMinutes:O,progressPercentage:h,isComplete:D,wordsRemaining:U,wordsToComplete:Z,wordCountStats:le,wordCountProgress:ge,meetsDefenseThreshold:ke,defenseWordsRemaining:q,defenseProgressPercentage:_,DEFENSE_THRESHOLD:ae,formatWordCount:fe,formatProgress:me,getProgressDisplay:ue,getCompletionDisplay:I,getWordCountStatus:C,getStatusColor:J,getProgressBarColor:te,countWords:j}}function ba(L,v,E,j){const d=c(!1),b=c(0),g=c(!1),n=C=>{if(!C)return 0;const te=C.replace(/<[^>]*>/g,"").trim().replace(/\s+/g," ");if(!te)return 0;const ae=te.match(/\b\w+\b/g);return ae?ae.length:0},P=M(()=>n(E.value)),N=M(()=>P.value>=800),f=()=>`defense_generation_triggered_${L.id}_ch_${v.chapter_number}`,O=()=>{const C=f();return localStorage.getItem(C)==="true"},h=()=>{const C=f();localStorage.setItem(C,"true"),d.value=!0},D=()=>{const C=f();localStorage.removeItem(C),d.value=!1,console.log(`ðŸ”„ DEFENSE WATCHER: Reset generation trigger for Chapter ${v.chapter_number}`)},U=Qo(async()=>{if(!g.value)return;const C=P.value;console.log(`ðŸ“Š DEFENSE WATCHER: Word count check - Chapter ${v.chapter_number}: ${C} words`),C<800*.8&&d.value&&(console.log("â¬‡ï¸ DEFENSE WATCHER: Content dropped below 80% of threshold, resetting trigger"),D()),b.value=C},2e3),Z=()=>g.value?void 0:(g.value=!0,d.value=O(),b.value=P.value,console.log(`ðŸ‘€ DEFENSE WATCHER: Started watching Chapter ${v.chapter_number}`),console.log(`   Initial word count: ${b.value}`),console.log(`   Generation already triggered: ${d.value}`),console.log("   Threshold: 800 words"),ye(E,(J,te)=>{J!==te&&U()},{immediate:!1})),le=()=>{g.value=!1,U.cancel(),console.log(`ðŸ›‘ DEFENSE WATCHER: Stopped watching Chapter ${v.chapter_number}`)},ge=async()=>{console.log(`ðŸ” DEFENSE WATCHER: Force checking Chapter ${v.chapter_number}`),await U(),U.flush()},fe=M(()=>{const C=P.value;return C>0&&C<800&&!d.value}),me=M(()=>{const C=P.value/800*100;return Math.min(C,100)}),ue=M(()=>{const C=800-P.value;return Math.max(C,0)});return{isWatching:g,hasTriggeredGeneration:d,currentWordCount:P,lastWordCount:b,meetsThreshold:N,shouldShowProgressIndicator:fe,progressPercentage:me,wordsRemaining:ue,startWatching:Z,stopWatching:le,forceCheck:ge,resetGenerationTrigger:D,markGenerationTriggered:h,getStatusMessage:()=>{const C=P.value;return d.value?`Defense questions available (${C} words)`:C>=800?`Ready for defense questions (${C} words)`:C>0?`${800-C} more words needed for defense questions`:"Start writing to enable defense questions (800 words needed)"},countWords:n,DEFENSE_WORD_COUNT_THRESHOLD:800}}function xa(L){const v=c(!1),E=c(null),j=c([]),m=c(null),d=M(()=>{if(!E.value?.quality_level)return"text-muted-foreground";switch(E.value.quality_level){case"Excellent":return"text-green-600";case"Good":return"text-blue-600";case"Satisfactory":return"text-yellow-600";case"Needs Improvement":return"text-orange-600";case"Poor":return"text-red-600";default:return"text-muted-foreground"}}),b=M(()=>E.value?.scores?Object.entries(E.value.scores).sort(([,h],[,D])=>h.percentage-D.percentage).slice(0,3).map(([h,D])=>({category:h.replace(" & "," & "),percentage:Math.round(D.percentage),score:D.score,max:D.max})):[]),g=async()=>{try{v.value=!0,m.value=null,await he.get("/sanctum/csrf-cookie");const h=await he.post(Q("api.chapters.analysis.analyze",{chapter:L}));if(h.data.success)return E.value=h.data.analysis,h.data.analysis;throw new Error(h.data.error||"Analysis failed")}catch(h){return m.value=h.response?.data?.error||h.message||"Analysis failed",console.error("Chapter analysis failed:",h),null}finally{v.value=!1}};return{isAnalyzing:v,latestAnalysis:E,analysisHistory:j,error:m,qualityLevelColor:d,topImprovementAreas:b,analyzeChapter:g,getLatestAnalysis:async()=>{try{await he.get("/sanctum/csrf-cookie");const h=await he.get(Q("api.chapters.analysis.latest",{chapter:L}));return h.data.success?(E.value=h.data.analysis,h.data.analysis):(E.value=null,null)}catch(h){return h.response?.status!==404&&(m.value=h.response?.data?.error||h.message||"Failed to get analysis",console.error("Failed to get latest analysis:",h)),null}},getAnalysisHistory:async()=>{try{await he.get("/sanctum/csrf-cookie");const h=await he.get(Q("api.chapters.analysis.history",{chapter:L}));if(h.data.success)return j.value=h.data.analyses,h.data.analyses;throw new Error(h.data.error||"Failed to get history")}catch(h){return m.value=h.response?.data?.error||h.message||"Failed to get analysis history",console.error("Failed to get analysis history:",h),[]}},autoAnalyze:async(h,D=500)=>{h>=D&&await g()},getScoreColor:(h,D)=>{const U=h/D*100;return U>=80?"text-green-600":U>=70?"text-blue-600":U>=60?"text-yellow-600":U>=40?"text-orange-600":"text-red-600"},getProgressVariant:h=>h>=80?"success":h>=60?"default":"destructive"}}const ya={userScrollTimeout:2e3,scrollBehavior:"smooth",bottomThreshold:100};class _a{scrollContainer=null;isUserScrolling=!1;userScrollTimeout=null;isEnabled=!0;isDestroyed=!1;config;wasAtBottom=!0;rafId=null;handleWheel;handleTouchStart;handleTouchMove;handleScroll;handleKeydown;constructor(v={}){this.config={...ya,...v},this.handleWheel=this.onUserScroll.bind(this),this.handleTouchStart=this.onUserScroll.bind(this),this.handleTouchMove=this.onUserScroll.bind(this),this.handleScroll=this.onScroll.bind(this),this.handleKeydown=this.onKeydown.bind(this)}attach(v){this.isDestroyed||(this.detach(),this.scrollContainer=v,this.setupEventListeners(),this.wasAtBottom=this.isAtBottom())}detach(){this.scrollContainer&&(this.scrollContainer.removeEventListener("wheel",this.handleWheel),this.scrollContainer.removeEventListener("touchstart",this.handleTouchStart),this.scrollContainer.removeEventListener("touchmove",this.handleTouchMove),this.scrollContainer.removeEventListener("scroll",this.handleScroll),this.scrollContainer.removeEventListener("keydown",this.handleKeydown)),this.userScrollTimeout&&(clearTimeout(this.userScrollTimeout),this.userScrollTimeout=null),this.rafId&&(cancelAnimationFrame(this.rafId),this.rafId=null),this.scrollContainer=null}setupEventListeners(){this.scrollContainer&&(this.scrollContainer.addEventListener("wheel",this.handleWheel,{passive:!0}),this.scrollContainer.addEventListener("touchstart",this.handleTouchStart,{passive:!0}),this.scrollContainer.addEventListener("touchmove",this.handleTouchMove,{passive:!0}),this.scrollContainer.addEventListener("scroll",this.handleScroll,{passive:!0}),this.scrollContainer.addEventListener("keydown",this.handleKeydown))}onUserScroll(){this.isEnabled&&(this.isUserScrolling=!0,this.userScrollTimeout&&clearTimeout(this.userScrollTimeout),this.userScrollTimeout=setTimeout(()=>{this.isUserScrolling=!1,this.isAtBottom()&&(this.wasAtBottom=!0)},this.config.userScrollTimeout))}onScroll(){this.wasAtBottom=this.isAtBottom()}onKeydown(v){["ArrowUp","ArrowDown","PageUp","PageDown","Home","End"].includes(v.key)&&this.onUserScroll()}isAtBottom(){if(!this.scrollContainer)return!0;const{scrollTop:v,scrollHeight:E,clientHeight:j}=this.scrollContainer;return E-v-j<=this.config.bottomThreshold}scrollToBottom(){!this.scrollContainer||!this.isEnabled||this.isDestroyed||this.isUserScrolling||!this.wasAtBottom||(this.rafId&&cancelAnimationFrame(this.rafId),this.rafId=requestAnimationFrame(()=>{if(this.rafId=null,!this.scrollContainer||this.isDestroyed)return;const v=this.scrollContainer.scrollHeight-this.scrollContainer.clientHeight;this.config.scrollBehavior==="instant"?this.scrollContainer.scrollTop=v:this.scrollContainer.scrollTo({top:v,behavior:"smooth"}),this.wasAtBottom=!0}))}forceScrollToBottom(){!this.scrollContainer||this.isDestroyed||(this.isUserScrolling=!1,this.wasAtBottom=!0,this.userScrollTimeout&&(clearTimeout(this.userScrollTimeout),this.userScrollTimeout=null),this.scrollToBottom())}enable(){this.isEnabled=!0}disable(){this.isEnabled=!1}isAutoScrollActive(){return this.isEnabled&&!this.isUserScrolling&&this.wasAtBottom}isUserScrollingNow(){return this.isUserScrolling}reset(){this.isUserScrolling=!1,this.wasAtBottom=!0,this.userScrollTimeout&&(clearTimeout(this.userScrollTimeout),this.userScrollTimeout=null)}destroy(){this.isDestroyed=!0,this.detach()}}function Ca(L={}){const v=new _a(L),E=c(!0),j=c(!1);let m=null;function d(D){D?(v.attach(D),g()):(v.detach(),n())}function b(D){ye(D,U=>{d(U)},{immediate:!0})}function g(){n(),m=setInterval(()=>{E.value=v.isAutoScrollActive(),j.value=v.isUserScrollingNow()},100)}function n(){m&&(clearInterval(m),m=null)}function P(){v.scrollToBottom()}function N(){v.forceScrollToBottom()}function f(){v.enable()}function O(){v.disable()}function h(){v.reset(),E.value=!0,j.value=!1}return Ar(()=>{n(),v.destroy()}),{attach:d,attachRef:b,scrollToBottom:P,forceScrollToBottom:N,enable:f,disable:O,reset:h,isAutoScrollActive:E,isUserScrolling:j}}const Sa={key:2,class:"flex h-screen flex-col overflow-hidden bg-zinc-50 dark:bg-zinc-950 font-sans selection:bg-primary/20"},ka={class:"relative z-20 flex flex-shrink-0 items-center justify-between border-b border-border/40 bg-background/60 p-4 backdrop-blur-xl supports-[backdrop-filter]:bg-background/40 transition-all duration-300"},Ea={class:"flex items-center gap-5"},Ta={class:"flex flex-col"},Aa={class:"flex items-center gap-3 text-xs text-muted-foreground"},$a={class:"flex items-center gap-1.5"},Ra={class:"flex items-center gap-4"},Pa={class:"flex items-center p-1 rounded-full border border-border/40 bg-background/50 backdrop-blur-sm shadow-sm"},qa={class:"flex items-center gap-2"},Da={class:"relative z-20 h-[2px] w-full bg-border/20"},Ma={key:0,class:"mx-3 my-2"},ja={class:"relative overflow-hidden rounded-xl border border-blue-200 bg-gradient-to-br from-blue-50 to-purple-50 p-3 shadow-sm dark:border-blue-800 dark:from-blue-950/30 dark:to-purple-950/30"},Fa={class:"relative z-10 mb-2 flex items-center justify-between"},La={class:"flex items-center gap-2"},Oa={class:"relative"},Wa={class:"flex h-6 w-6 items-center justify-center rounded-full bg-gradient-to-br from-blue-500 to-purple-600"},Ia={class:"text-xs text-blue-700 dark:text-blue-300"},Na={class:"relative z-10 mb-2"},Ua={class:"mb-1 flex items-center justify-between"},za={class:"text-xs text-blue-600 dark:text-blue-400"},Ga={class:"relative h-2 overflow-hidden rounded-full bg-blue-100 dark:bg-blue-900/50"},Ha={class:"relative z-10 flex items-center gap-2"},Ba={class:"flex-shrink-0"},Ka={key:0,class:"h-2 w-2 animate-bounce rounded-full bg-blue-500"},Va={key:1,class:"flex gap-0.5"},Qa={key:2,class:"h-2 w-2 animate-spin rounded-full border-2 border-blue-500 border-t-transparent"},Ja={key:3,class:"h-2 w-2 rounded-full bg-green-500"},Xa={key:4,class:"h-2 w-2 rounded-full bg-red-500"},Ya={class:"flex-1 text-xs text-blue-800 dark:text-blue-200"},Za={class:"relative z-10 flex flex-1 overflow-hidden"},en={key:0,class:"w-[320px] flex-shrink-0 border-r border-border/50 bg-background/80 backdrop-blur-xl shadow-xl z-20"},tn={class:"h-full overflow-y-auto custom-scrollbar"},rn={class:"p-4"},on={class:"mb-3"},an={class:"text-xs text-muted-foreground"},nn={class:"flex min-h-0 flex-1 flex-col bg-transparent relative"},sn={class:"flex-1 overflow-hidden relative"},ln={class:"absolute inset-0 overflow-y-auto custom-scrollbar flex flex-col items-center py-8 px-4 sm:px-8"},cn={class:"flex items-center justify-between"},un={class:"space-y-1"},dn={class:"flex items-center gap-2"},pn={class:"flex items-center justify-between px-6 py-2 border-b border-border/30 bg-muted/5"},gn={class:"flex items-center gap-2"},vn={class:"space-y-1 relative z-10"},hn={class:"text-sm font-medium text-foreground"},fn={class:"text-[10px] text-muted-foreground line-clamp-2 leading-relaxed"},mn={class:"flex-1 relative bg-background"},wn={class:"px-12 py-10 min-h-[500px]"},bn={class:"sticky bottom-0 z-10 border-t border-border/30 bg-background/80 backdrop-blur-md p-4 flex items-center justify-between"},xn={class:"text-xs text-muted-foreground"},yn={class:"flex items-center gap-2"},_n={key:0,class:"w-72 flex-shrink-0 border-l border-border/40 bg-background/40 backdrop-blur-md"},Cn={class:"h-full overflow-y-auto custom-scrollbar"},Sn={class:"space-y-6 p-4"},kn={class:"flex h-full w-full overflow-hidden relative"},En={class:"hidden lg:flex w-80 flex-col border-r border-border/40 bg-background/60 backdrop-blur-xl z-20 transition-all duration-300"},Tn={class:"h-14 flex items-center justify-between px-4 border-b border-border/40 shrink-0"},An={class:"p-4"},$n={class:"flex-1 flex flex-col relative z-10 min-w-0 bg-background/30 transition-all duration-300"},Rn={class:"min-h-[5.5rem] flex flex-shrink-0 items-center justify-between border-b border-border/40 bg-background/60 backdrop-blur-md px-4 py-2 relative z-30 transition-all duration-300"},Pn={class:"flex items-center gap-4 flex-1"},qn={class:"flex items-center gap-2 flex-shrink-0 h-full self-start mt-1"},Dn={class:"flex flex-col gap-1.5 flex-1 min-w-0"},Mn={class:"flex items-start gap-3 w-full"},jn={class:"flex items-center gap-2 flex-wrap"},Fn={class:"flex items-center bg-background/50 rounded-md border border-border/50 p-0.5 mr-2 backdrop-blur-sm hidden sm:flex"},Ln={class:"flex items-center self-start mt-1 ml-2"},On={class:"flex-1 overflow-hidden relative group bg-background/20"},Wn={key:0,class:"absolute top-6 left-0 right-0 z-40 px-4 flex justify-center pointer-events-none"},In={class:"w-full max-w-lg pointer-events-auto"},Nn={class:"relative overflow-hidden rounded-xl border border-blue-200 bg-gradient-to-br from-blue-50/95 to-purple-50/95 p-3 shadow-lg backdrop-blur-lg dark:border-blue-800 dark:from-blue-950/90 dark:to-purple-950/90"},Un={class:"flex items-center gap-3"},zn={class:"relative flex h-8 w-8 items-center justify-center rounded-full bg-gradient-to-br from-blue-500 to-purple-600 shadow-md"},Gn={class:"flex-1 min-w-0"},Hn={class:"flex items-center justify-between mb-1"},Bn={class:"text-xs font-mono text-muted-foreground"},Kn={class:"h-1.5 w-full bg-blue-100 dark:bg-blue-900/40 rounded-full overflow-hidden"},Vn={class:"mt-2 text-xs text-muted-foreground ml-11 truncate"},Qn={class:"max-w-[850px] mx-auto py-12 px-6 sm:px-10 min-h-full"},Jn={class:"min-h-[600px] pb-32"},Xn={class:"pb-32"},Yn={class:"h-7 border-t border-border/30 bg-background/40 backdrop-blur-sm flex items-center justify-between px-4 text-[10px] text-muted-foreground shrink-0"},Zn={class:"flex items-center gap-3"},es={class:"hidden sm:inline"},ts={class:"flex items-center gap-2"},rs={key:0,class:"text-green-500 flex items-center gap-1 ml-2"},os={class:"hidden lg:flex w-96 flex-col border-l border-border/40 bg-background/60 backdrop-blur-xl z-20 transition-all duration-300"},as={class:"h-14 flex items-center justify-between px-4 border-b border-border/40 shrink-0"},ns={class:"flex-1 overflow-y-auto custom-scrollbar"},ss={class:"p-4 space-y-6"},ls={key:0,class:"fixed inset-0 bg-black/50 flex items-center justify-center z-50"},is={class:"text-slate-600 dark:text-slate-300 mb-4"},cs={class:"font-semibold text-amber-600 dark:text-amber-400"},us={class:"flex flex-col sm:flex-row gap-3"},bt=3,ds=1e3,ps=Tr({__name:"ChapterEditor",props:{project:{},chapter:{},allChapters:{},facultyChapters:{},mode:{}},setup(L){const v=qe(()=>De(()=>import("./AISidebar-CzNKWM82.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53]))),E=qe(()=>De(()=>import("./ChapterNavigation-CNe3fVBI.js"),__vite__mapDeps([54,55,3,1,2,20,7,8,21,22,14,56,18,13,15,16,42,57,58,59,60,36]))),j=qe(()=>De(()=>import("./MobileNavOverlay-Dl_-vF8F.js"),__vite__mapDeps([61,1,2,62,3,0,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,55,56,57,58,59,60,63,64,65,66,67,68,69]))),m=qe(()=>De(()=>import("./ChatModeLayout-Dmw8_0fU.js"),__vite__mapDeps([70,71,1,2,18,3,8,4,11,7,12,20,21,23,24,25,26,27,28,29,30,31,32,33,34,35,36,14,37,38,19,39,40,41,42,43,44,72,73,74,75,65,76,9,10,13,15,16,45,77,78,62,79,47,80,81,57,82,50,66,60,49,52,58,83,84,85]))),d=qe(()=>De(()=>import("./CitationVerificationLayout-CnGtSc2A.js"),__vite__mapDeps([86,18,3,1,2,8,4,5,11,7,12,20,21,25,73,23,24,26,27,28,29,30,31,32,33,34,35,36,14,37,38,19,39,40,41,42,43,44,74,75,65,76,9,10,13,15,16,45,77,78,79,58]))),b=qe(()=>De(()=>import("./DefensePreparationPanel-C5ptwkXT.js"),__vite__mapDeps([87,63,1,2,62,3,18,8,4,5,6,7,11,12,20,21,9,10,64,65,45,66,67,46,51,35,14,32]))),g=qe(()=>De(()=>import("./DataCollectionPanel-1WfeQE6o.js"),__vite__mapDeps([88,68,1,2,13,3,14,8,7,15,16]))),n=L,P=ko();ye(()=>P.props?.flash,t=>{t&&(t.success&&w.success(t.success),t.error&&w.error(t.error))},{deep:!0,immediate:!0});const N=c(n.chapter.title||""),f=c(n.chapter.content||""),O=c(!0),h=c(!1);c(!1);const D=c(!1);c("write");const U=c("");c(0);const Z=c(!1),le=c(!1),ge=c(!0),fe=()=>{try{return localStorage.getItem(`chatMode_${n.project.id}_${n.chapter.chapter_number}`)==="true"}catch(t){return console.warn("Failed to load chat mode from localStorage:",t),!1}},me=t=>{try{localStorage.setItem(`chatMode_${n.project.id}_${n.chapter.chapter_number}`,String(t))}catch(e){console.warn("Failed to save chat mode to localStorage:",e)}},ue=c(!1),I=c(!1),C=c(!1),J=c(!1),te=c(!1),ae=c(!0),ke=c(!0),q=c(!1),_=c(""),l=c(0),x=c(""),G=c(0),S=c(0),k=c(null),W=c(""),Oe=c(0),yt=c(""),Ot=c([]),Xe=c(!1),Ee=c(!1),ie=c(0),_t=c(2e3),We=c(!1),lt=c(null);c("progressive");const Ie=c(!1),it=c(!1),ct=c(0);c(!1),c(0);const Rr=async()=>{if(!navigator.onLine)return w.error("No Internet Connection",{description:"Please check your internet connection and try again."}),!1;const t=navigator.connection||navigator.mozConnection||navigator.webkitConnection;if(t){const e=t.effectiveType;(e==="slow-2g"||e==="2g")&&w.warning("Slow Connection Detected",{description:"Your connection is slow. Content will be auto-saved during generation.",duration:4e3})}try{const e=new AbortController,u=setTimeout(()=>e.abort(),5e3),a=performance.now();await fetch(Q("api.ping"),{method:"HEAD",cache:"no-cache",signal:e.signal}),clearTimeout(u);const p=performance.now()-a;console.log("ðŸ“¡ Server latency:",p.toFixed(0),"ms"),p>2e3&&w.info("Connection is slow",{description:"Content will be auto-saved during generation to prevent data loss.",duration:3e3})}catch(e){console.warn("Connection check ping failed:",e),w.info("Connection check skipped",{description:"Content will be auto-saved during generation.",duration:2e3})}return!0},{balance:Pr,showPurchaseModal:Wt,requiredWordsForModal:qr,actionDescriptionForModal:Dr,checkAndPrompt:Mr,closePurchaseModal:jr,estimates:_e}=$o(),Ne=(t,e)=>Mr(Math.max(1,Math.round(t)),e),Ye=c(!1),Ue=c(""),ze=c(""),Fr=c(0),Te=c(null),Lr=c(0),Or=c(null),Wr=c([]),Ir=c([]),Nr=c(null);c(null),c(null);const It=c(),ee=c(!1),{attach:Ur,scrollToBottom:zr,reset:Gr,isUserScrolling:Hr}=Ca({userScrollTimeout:2e3,scrollBehavior:"smooth",bottomThreshold:100}),Ze=c(!1),{hasUnsavedChanges:Br,isSaving:Ce,triggerAutoSave:Ae,save:we,clearAutoSave:Kr}=fa({delay:1e4,onSave:Gt});let Nt=0;const Vr=()=>{const t=Date.now();t-Nt>ds&&(Nt=t,w.success("Saved",{duration:2e3}))},{contentHistory:Qr,historyIndex:Jr,addToHistory:Xr,undo:Yr,redo:Zr}=Mo(n.chapter.content||""),{writingStats:Ct,writingQualityScore:Se,calculateWritingStats:ut}=ma(f),{isAnalyzing:Ut,latestAnalysis:ve,getLatestAnalysis:eo}=xa(n.chapter.id),ce=M(()=>{if(n.facultyChapters&&n.facultyChapters.length>0){const e=n.facultyChapters.find(u=>u.number===n.chapter.chapter_number);if(e?.word_count)return e.word_count}if(n.project?.outlines&&n.project.outlines.length>0){const e=n.project.outlines.find(u=>u.chapter_number===n.chapter.chapter_number);if(e?.target_word_count)return e.target_word_count}const t=n.project.type==="undergraduate"?2500:3500;return n.chapter.chapter_number===1||n.chapter.chapter_number===5?Math.round(t*.8):t}),{currentWordCount:X,progressPercentage:to,meetsDefenseThreshold:ro,defenseWordsRemaining:oo,defenseProgressPercentage:ao,DEFENSE_THRESHOLD:dt,countWords:zt}=wa(f,ce),St=to,pt=M(()=>{const t=N.value?.trim(),e=f.value?.trim();return t&&t.length>0&&e&&e.length>50}),be=M(()=>n.project),xe=M(()=>n.chapter),$e=M(()=>n.allChapters);async function Gt(t=!1){try{const e=await fetch(Q("chapters.save",{project:n.project.id}),{method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json","X-Requested-With":"XMLHttpRequest","X-CSRF-TOKEN":document.querySelector('meta[name="csrf-token"]')?.getAttribute("content")||""},body:JSON.stringify({project_id:n.project.id,chapter_number:n.chapter.chapter_number,title:N.value,content:f.value,auto_save:t,statistics:Ct.value,quality_score:Se.value})});console.log("Response status:",e.status,e.statusText),console.log("Response headers:",e.headers);const u=await e.text();console.log("Raw response:",u);let a;try{a=JSON.parse(u)}catch(p){throw console.error("JSON parse error:",p),console.error("Response was:",u),new Error(`Server returned non-JSON response: ${e.status} ${e.statusText}`)}e.ok}catch(e){throw t||w.error("âŒ Save Failed",{description:"Please try again or check your connection."}),e}}const Ht=()=>{const t=Yr();t!==null&&(f.value=t,Ae())},Bt=()=>{const t=Zr();t!==null&&(f.value=t,Ae())},et=t=>{Br.value&&confirm("You have unsaved changes. Save before switching chapters?")&&we();const e=n.allChapters.find(p=>p.chapter_number===t),a=e?.content&&e.content.trim()!==""?"chapters.edit":"chapters.write";Ke.visit(Q(a,{project:n.project.slug,chapter:t}),{only:["chapter","mode","allChapters"],preserveState:!0,preserveScroll:!1})},kt=async()=>{const t=_e.chapter(ce.value||0);if(!Ne(t,"generate the next chapter with AI"))return;await we();const e=n.allChapters.map(p=>p.chapter_number).sort((p,y)=>p-y),u=e.indexOf(n.chapter.chapter_number);let a;if(u===-1||u===e.length-1)a=Math.max(...e)+1;else{const p=e[u+1];p===n.chapter.chapter_number+1?a=p:a=n.chapter.chapter_number+1}console.log("ðŸ“ Generating next chapter:",{currentChapter:n.chapter.chapter_number,existingChapters:e,nextChapterNumber:a});try{const p=Q("chapters.write",{project:n.project.slug,chapter:a});console.log("ðŸ”— Generated URL for next chapter:",p);const y=new URL(p,window.location.origin);y.searchParams.set("ai_generate","true"),y.searchParams.set("generation_type","progressive"),console.log("ðŸš€ Navigating to:",y.toString()),Ke.visit(y.toString())}catch(p){console.error("âŒ Error generating next chapter:",p),w.error("Navigation Error",{description:"Failed to navigate to next chapter. Please try again."})}},Et=(t,e)=>{t==="section"&&e?.section?no(e.section):t==="rephrase"&&e?.selectedText?so(e.selectedText,e.style||"Academic Formal"):t==="expand"&&e?.selectedText?lo(e.selectedText):Tt(t)},no=async t=>{q.value=!0,W.value="",S.value=0,l.value=5,x.value="Papers",_.value="Checking for verified sources...",G.value=600,yt.value=f.value||n.chapter.content||"",ee.value=!0;try{l.value=50,x.value="Papers",_.value="Using existing verified sources...",await new Promise(u=>setTimeout(u,500)),x.value="Section",_.value=`Generating ${t} section with verified sources...`,l.value=51;const e=Q("chapters.stream",{project:n.project.slug,chapter:n.chapter.chapter_number});k.value=new EventSource(`${e}?generation_type=section&section_type=${t}`),k.value.onmessage=u=>{const a=JSON.parse(u.data);switch(a.type){case"start":x.value="Generating Section",l.value=52,_.value=`Starting ${t} section generation...`;break;case"content":W.value+=a.content,S.value=a.word_count||zt(W.value);const p=Date.now();if(p-Oe.value>150){const F=W.value;f.value=yt.value+`

`+F,Oe.value=p;const A=Math.min(S.value/G.value*43,43);l.value=Math.max(52,52+A),_.value=`Generating ${t} section... (${S.value} / ${G.value} words)`,ut(),Rt()}break;case"complete":l.value=100,x.value="Complete",_.value=`âœ“ Generated ${t} section (${S.value} words)`;const y=W.value;f.value=yt.value+`

`+y,we(!0),w.success("âœ… Section Generated Successfully",{description:`Added ${t} section with ${S.value} words and verified citations.`,duration:5e3}),q.value=!1,k.value?.close();break;case"error":throw new Error(a.message||"Section generation failed");case"heartbeat":l.value<95&&(l.value+=.5);break}},k.value.onerror=()=>{q.value=!1,x.value="Error",_.value="âŒ Section generation failed",w.error("âŒ Generation Failed",{description:"Unable to generate section. Please check your connection and try again."}),k.value?.close()}}catch(e){console.error("Section generation failed:",e),q.value=!1,x.value="Error",_.value="âŒ Section generation error",w.error("âŒ Generation Failed",{description:"Section generation encountered an error."})}},so=async(t,e)=>{const u=t.split(/\s+/).length,a=Math.max(u,_e.rephrase());if(!Ne(a,`rephrase about ${u} words`))return;console.log("ðŸš€ ChapterEditor - Starting rephrase generation:",{selectedTextLength:t.length,selectedTextPreview:t.substring(0,100)+(t.length>100?"...":""),style:e,timestamp:new Date().toISOString()}),q.value=!0,W.value="",S.value=0,l.value=10,x.value="Rephrasing",_.value="Preparing to rephrase selected text...",G.value=Math.max(u,50);const p=tt.value||gt.value,y=p?.getSelectionRange();console.log("ðŸ“ ChapterEditor - Editor and selection info:",{hasActiveEditor:!!p,selectionRange:y,selectedWordCount:u,estimatedWords:G.value});const F={originalText:t,range:y,wordCount:u,style:e,startTime:Date.now()};console.log("ðŸ’¾ ChapterEditor - Stored rephrase context:",F),ee.value=!0;try{l.value=20,_.value=`Rephrasing ${u} words in ${e} style...`;const Y=`${Q("chapters.stream",{project:n.project.slug,chapter:n.chapter.chapter_number})}?generation_type=rephrase&selected_text=${encodeURIComponent(t)}&style=${encodeURIComponent(e)}`;console.log("ðŸŒ ChapterEditor - Creating EventSource:",{url:Y,encodedTextLength:encodeURIComponent(t).length}),k.value=new EventSource(Y),k.value.onmessage=H=>{const z=JSON.parse(H.data);switch(console.log("ðŸ“¨ ChapterEditor - EventSource message received:",{type:z.type,hasContent:!!z.content,contentLength:z.content?.length||0,wordCount:z.word_count}),z.type){case"start":console.log("â–¶ï¸ ChapterEditor - Rephrase generation started"),x.value="Rephrasing Text",l.value=30,_.value=`Rephrasing text in ${e} style...`;break;case"content":W.value+=z.content,S.value=z.word_count||zt(W.value),console.log("ðŸ“ ChapterEditor - Content chunk received:",{chunkLength:z.content?.length||0,totalBufferLength:W.value.length,totalWords:S.value});const se=Math.min(S.value/G.value*60,60);l.value=Math.max(30,30+se),_.value=`Rephrasing... (${S.value} words)`;break;case"complete":if(console.log("ðŸ ChapterEditor - Rephrase generation complete"),l.value=100,x.value="Complete",_.value=`âœ“ Text rephrased successfully (${S.value} words)`,console.log("ðŸ”„ ChapterEditor - Starting text replacement:",{hasRange:!!F.range,hasContent:!!W.value.trim(),range:F.range,newContentLength:W.value.trim().length,newContentPreview:W.value.trim().substring(0,100)+"..."}),F.range&&W.value.trim()){console.log("ðŸŽ¯ ChapterEditor - Attempting text replacement with activeEditor:",{editorType:p===tt.value?"fullscreen":"normal",hasActiveEditor:!!p});const de=p?.replaceSelection(W.value.trim(),F.range);console.log("ðŸ“Š ChapterEditor - Text replacement result:",{success:de}),de?(console.log("âœ… ChapterEditor - Text replacement successful, updating chapter content"),setTimeout(()=>{const Pe=p?.getHTML()||f.value;console.log("ðŸ“„ ChapterEditor - Updated chapter content length:",Pe.length),f.value=Pe},100)):(console.warn("âŒ ChapterEditor - Failed to replace selected text, falling back to manual update"),w.warning("Please manually replace the selected text",{description:"The rephrased text is ready but couldn't be automatically replaced."}))}else console.error("âŒ ChapterEditor - Cannot replace text:",{missingRange:!F.range,missingContent:!W.value.trim()});we(!0),w.success("âœ… Text Rephrased Successfully",{description:`Rephrased ${u} words in ${e} style.`,duration:5e3}),Je(S.value||u,`Rephrase (${e})`,"chapter",n.chapter.id).catch(de=>console.error("Failed to record word usage (rephrase):",de)),q.value=!1,k.value?.close();break;case"error":throw new Error(z.message||"Text rephrasing failed");case"heartbeat":l.value<95&&(l.value+=.5);break}},k.value.onerror=()=>{q.value=!1,x.value="Error",_.value="âŒ Text rephrasing failed",w.error("âŒ Rephrasing Failed",{description:"Unable to rephrase text. Please check your connection and try again."}),k.value?.close()}}catch(A){console.error("Text rephrasing failed:",A),q.value=!1,x.value="Error",_.value="âŒ Rephrasing error",w.error("âŒ Rephrasing Failed",{description:"Text rephrasing encountered an error."})}},lo=async t=>{const e=t.split(/\s+/).length,u=Math.max(e*2,_e.expand());if(!Ne(u,`expand about ${e} words`))return;console.log("ðŸ“ˆ ChapterEditor - Starting expand generation:",{selectedTextLength:t.length,selectedTextPreview:t.substring(0,100)+(t.length>100?"...":""),timestamp:new Date().toISOString()}),q.value=!0,W.value="",S.value=0,l.value=10,x.value="Expanding",_.value="Preparing to expand selected text...",G.value=Math.max(e*2,100);const a=tt.value||gt.value,p=a?.getSelectionRange();console.log("ðŸ“ ChapterEditor - Editor and selection info for expand:",{hasActiveEditor:!!a,selectionRange:p,selectedWordCount:e,estimatedWords:G.value});const y={originalText:t,range:p,wordCount:e,startTime:Date.now()};console.log("ðŸ’¾ ChapterEditor - Stored expand context:",y);try{const A=`${Q("chapters.stream",{project:n.project.slug,chapter:n.chapter.chapter_number})}?generation_type=expand&selected_text=${encodeURIComponent(t)}`;console.log("ðŸŒ ChapterEditor - Creating EventSource for expand:",{url:A,encodedTextLength:encodeURIComponent(t).length}),k.value=new EventSource(A),k.value.onmessage=Y=>{const H=JSON.parse(Y.data);switch(console.log("ðŸ“¨ ChapterEditor - EventSource message received:",{type:H.type,hasContent:!!H.content,contentLength:H.content?.length||0,wordCount:H.word_count}),H.type){case"start":console.log("â–¶ï¸ ChapterEditor - Expand generation started"),x.value="Expanding Text",l.value=20,_.value="Starting text expansion...";break;case"content":W.value+=H.content,S.value=H.word_count||W.value.split(/\s+/).filter(se=>se.length>0).length;const z=Math.min(S.value/G.value*90,90);l.value=Math.max(z,25),_.value=`Expanding text... ${S.value}/${G.value} words`,console.log("ðŸ“ ChapterEditor - Expand content received:",{chunkLength:H.content?.length||0,totalWords:S.value,progress:l.value});break;case"complete":if(console.log("âœ… ChapterEditor - Expand generation complete"),x.value="Complete",_.value="âœ… Text expansion completed",l.value=100,y.range&&W.value.trim()){console.log("ðŸŽ¯ ChapterEditor - Attempting text replacement for expand");const se=a?.replaceSelection(W.value.trim(),y.range);console.log("ðŸ“Š ChapterEditor - Expand text replacement result:",{success:se}),se?(console.log("âœ… ChapterEditor - Expand text replacement successful"),setTimeout(()=>{const de=a?.getHTML()||f.value;console.log("ðŸ“„ ChapterEditor - Updated chapter content length after expand:",de.length),f.value=de},100)):(console.warn("âŒ ChapterEditor - Failed to replace expanded text"),w.warning("Please manually replace the selected text",{description:"The expanded text is ready but couldn't be automatically replaced."}))}else console.error("âŒ ChapterEditor - Cannot replace expanded text:",{missingRange:!y.range,missingContent:!W.value.trim()});we(!0),w.success("âœ… Text Expanded Successfully",{description:`Expanded ${y.wordCount} words into ${S.value} words`}),Je(S.value||y.wordCount*2,"Expand text","chapter",n.chapter.id).catch(se=>console.error("Failed to record word usage (expand):",se)),q.value=!1,k.value?.close();break;case"error":console.error("âŒ ChapterEditor - Expand generation error:",H.message),q.value=!1,x.value="Error",_.value="âŒ Text expansion failed",w.error("âŒ Expansion Failed",{description:H.message||"Text expansion encountered an error."}),k.value?.close();break}},k.value.onerror=()=>{console.error("âŒ ChapterEditor - Expand stream error occurred"),q.value=!1,x.value="Error",_.value="âŒ Text expansion failed",w.error("âŒ Expansion Failed",{description:"Unable to expand text. Please check your connection and try again."}),k.value?.close()}}catch(F){console.error("Text expansion failed:",F),q.value=!1,x.value="Error",_.value="âŒ Expansion error",w.error("âŒ Expansion Failed",{description:"Text expansion encountered an error."})}},io=async()=>{Ye.value=!0,ze.value="Starting",Ue.value="Initializing source collection...",l.value=5;try{const t=document.querySelector('meta[name="csrf-token"]')?.content;if(!t)throw new Error("CSRF token not found - please refresh the page");const e=await fetch(Q("api.projects.paper-collection.start",{project:n.project.slug}),{method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json","X-CSRF-TOKEN":t,"X-Requested-With":"XMLHttpRequest"},credentials:"include"});if(!e.ok){const u=await e.text();if(console.error("API Error:",e.status,u),e.status===409)try{const a=JSON.parse(u);throw new Error(a.message||"Source collection is already in progress")}catch{throw new Error("Source collection is already in progress for this project")}throw new Error(`Failed to start source collection: ${e.status}`)}return await co()}catch(t){return console.error("Paper collection failed:",t),ze.value="Error",Ue.value="âŒ Source collection failed",Ye.value=!1,!1}},co=async()=>new Promise(t=>{let e=0;const u=120,a=async()=>{try{const y=await(await fetch(Q("api.projects.paper-collection.status",{project:n.project.slug}))).json();if(y.success&&y.data){Nr.value=y.data;const F=y.data.status,A=y.data.papers_count||y.data.count||0,Y=y.data.message,H=y.data.percentage||0,z=y.data.current_source,se=y.data.sources_completed||[],de=y.data.papers_preview||[];if(Fr.value=A,Lr.value=H,Or.value=z,Wr.value=se,Ir.value=de,F==="completed"){ze.value="Complete",Ue.value=`âœ“ Collected ${A} verified sources from ${se.length} databases`,l.value=50,Ye.value=!1,Te.value&&clearInterval(Te.value),t(!0);return}else if(F==="collecting_papers"||F==="initializing"||F==="processing"||F==="storing"){let Pe="";z&&(Pe={semantic_scholar:"Semantic Scholar",openalex:"OpenAlex",crossref:"CrossRef",pubmed:"PubMed"}[z]||z),ze.value=Pe||"Collecting Sources",Ue.value=Y||"Collecting sources from academic databases...",l.value=Math.min(5+H*.4,45)}else if(F==="collection_failed"){ze.value="Error",Ue.value=Y||"âŒ Source collection failed",Ye.value=!1,Te.value&&clearInterval(Te.value),t(!1);return}}e++,e>=u&&(ze.value="Timeout",Ue.value="â±ï¸ Source collection timed out",Ye.value=!1,Te.value&&clearInterval(Te.value),t(!1))}catch(p){console.error("Error checking paper collection status:",p),e++}};a(),Te.value=setInterval(a,5e3)}),Tt=async t=>{const e=_e.chapter(ce.value||0);if(!Ne(e,"generate this chapter with AI")||!await Rr())return;if(q.value=!0,W.value="",S.value=0,l.value=5,x.value="Papers",_.value="Checking for verified sources...",Ze.value=!0,Gr(),G.value=ce.value,ee.value=!0,!await io()){w.error("Paper Collection Failed",{description:"Unable to collect verified papers. Please try again."}),q.value=!1,ee.value=!1;return}x.value="Initializing",_.value="Starting AI generation with verified sources...",l.value=51;const p=setInterval(()=>{l.value<52&&q.value?l.value+=.2:clearInterval(p)},100),y=Q("chapters.stream",{project:n.project.slug,chapter:n.chapter.chapter_number});k.value=new EventSource(`${y}?generation_type=${t}`),k.value.onmessage=F=>{const A=JSON.parse(F.data);switch(A.type){case"start":x.value="Connecting",l.value=52,_.value="Connecting to AI service...";break;case"content":x.value="Generating",W.value+=A.content,S.value=A.word_count||W.value.split(/\s+/).filter(z=>z.length>0).length;const Y=Date.now();if(Y-Oe.value>200){f.value=W.value,Oe.value=Y;const z=Math.min(S.value/G.value*43,43);l.value=Math.max(52,52+z),_.value=`Generating chapter content... (${S.value} / ${G.value} words)`,Rt()}break;case"heartbeat":l.value<95&&(l.value+=.5);break;case"complete":x.value="Complete",l.value=100,q.value=!1,Ze.value=!1,f.value=W.value;const H=A.final_word_count||S.value;_.value=`âœ“ Generated ${H} words successfully`,ut(),Je(H,`Chapter generation (${n.chapter.chapter_number})`,"chapter",n.chapter.id).catch(z=>console.error("Failed to record word usage (chapter generation):",z)),setTimeout(()=>{Ae()},500),k.value?.close(),k.value=null;break;case"error":x.value="Error",l.value=50,Ze.value=!1,A.partial_saved&&(it.value=!0,ct.value=A.saved_word_count||0),A.code==="OFFLINE_MODE"?(_.value="ðŸ“¡ AI services offline",q.value=!1,w.error("AI Services Offline",{description:"Please check your internet connection and try again."})):A.can_resume?(_.value=`âš ï¸ Generation interrupted (${A.saved_word_count} words saved)`,q.value=!1,Ie.value=!0,w.warning("Generation Interrupted",{description:`${A.saved_word_count} words were saved. You can resume generation.`,duration:8e3})):(_.value="âŒ Generation failed",q.value=!1,w.error("Generation Error",{description:A.message||"Please try again."})),k.value?.close(),k.value=null;break;case"autosave":A.word_count&&(console.log(`ðŸ’¾ Auto-saved: ${A.word_count} words`),A.generation_id&&(lt.value=A.generation_id));break}},k.value.onerror=()=>{if(ie.value<bt){ie.value++,We.value=!0,x.value="Reconnecting",_.value=`ðŸ”„ Connection lost. Reconnecting... (${ie.value}/${bt})`,k.value?.close(),k.value=null;const F=_t.value*Math.pow(2,ie.value-1);console.log(`ðŸ”Œ Attempting reconnection in ${F}ms (attempt ${ie.value})`),setTimeout(()=>{Kt(t)},F)}else x.value="Error",l.value=50,q.value=!1,We.value=!1,_.value="âŒ Connection failed after multiple attempts",S.value>100?(it.value=!0,ct.value=S.value,Ie.value=!0,w.warning("Connection Lost",{description:`${S.value} words may have been saved. Check and resume if needed.`,duration:8e3})):w.error("Connection Error",{description:"Please check your internet connection and try again."}),k.value?.close(),k.value=null,ie.value=0,_t.value=2e3}},Kt=t=>{const e=Q("chapters.stream",{project:n.project.slug,chapter:n.chapter.chapter_number}),u=new URLSearchParams({generation_type:t,resume_from:S.value.toString()});lt.value&&u.set("generation_id",lt.value),console.log(`ðŸ”Œ Reconnecting to stream from ${S.value} words...`),k.value=new EventSource(`${e}?${u}`),k.value.onmessage=a=>{const p=JSON.parse(a.data);switch((p.type==="content"||p.type==="start")&&(We.value=!1,ie.value=0,x.value="Generating"),p.type){case"start":_.value="âœ… Reconnected! Continuing generation...",w.success("Reconnected",{description:"Generation resumed successfully.",duration:3e3});break;case"content":x.value="Generating",W.value+=p.content,S.value=p.word_count||W.value.split(/\s+/).filter(A=>A.length>0).length;const y=Date.now();if(y-Oe.value>150){f.value=W.value,Oe.value=y;const A=Math.min(S.value/G.value*43,43);l.value=Math.max(52,52+A),_.value=`Generating chapter content... (${S.value} / ${G.value} words)`,Rt()}break;case"complete":x.value="Complete",l.value=100,q.value=!1,We.value=!1,f.value=W.value;const F=p.final_word_count||S.value;_.value=`âœ“ Generated ${F} words successfully`,Je(F,`Chapter generation (${n.chapter.chapter_number})`,"chapter",n.chapter.id).catch(A=>console.error("Failed to record word usage:",A)),setTimeout(()=>{Ae()},500),k.value?.close(),k.value=null;break;case"error":x.value="Error",q.value=!1,We.value=!1,_.value="âŒ Generation failed",w.error("Generation Error",{description:p.message||"Please try again."}),k.value?.close(),k.value=null;break;case"autosave":p.generation_id&&(lt.value=p.generation_id);break}},k.value.onerror=()=>{if(ie.value<bt){ie.value++;const a=_t.value*Math.pow(2,ie.value-1);_.value=`ðŸ”„ Reconnecting... (${ie.value}/${bt})`,k.value?.close(),setTimeout(()=>{Kt(t)},a)}else x.value="Error",q.value=!1,We.value=!1,_.value="âŒ Connection failed",S.value>100?(Ie.value=!0,w.warning("Connection Lost",{description:`${S.value} words may be saved. Refresh to recover.`})):w.error("Connection Error",{description:"Please check your connection and try again."}),k.value?.close(),k.value=null,ie.value=0}},uo=()=>{Ie.value=!1,it.value=!1,window.location.reload()},po=()=>{Ie.value=!1,it.value=!1,ct.value=0},At=async()=>{if(!U.value)return;const t=_e.suggestion();if(Ne(t,"get AI suggestions")){Xe.value=!0;try{const u=await(await fetch(Q("chapters.suggestions",{project:n.project.slug,chapter:n.chapter.chapter_number}),{method:"POST",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":document.querySelector('meta[name="csrf-token"]')?.getAttribute("content")||""},body:JSON.stringify({selected_text:U.value,context:f.value})})).json();Ot.value=u.suggestions||[],Ot.value.length&&Je(_e.suggestion(),"AI suggestions","chapter",n.chapter.id).catch(a=>console.error("Failed to record word usage (suggestions):",a))}catch{w.error("Error getting suggestions",{description:"Please try again."})}finally{Xe.value=!1}}},$t=()=>{Ee.value=!0,w.success("Citation Manager opened!",{description:"Review and verify your citations in the panel below."})},Vt=t=>{try{const e=tt.value?.editor||gt.value?.editor;if(!e){w.error("Editor not found");return}const{from:u}=e.state.selection;e.chain().focus().insertContentAt(u,` ${t} `).run(),w.success("Citation inserted successfully")}catch(e){console.error("Failed to insert citation:",e),w.error("Failed to insert citation")}},gt=c(null),tt=c(null),go=async()=>{try{const t=document.documentElement;t.requestFullscreen?await t.requestFullscreen():t.webkitRequestFullscreen?await t.webkitRequestFullscreen():t.msRequestFullscreen&&await t.msRequestFullscreen()}catch(t){console.error("Error entering fullscreen:",t),w.error("Fullscreen Error",{description:"Unable to enter fullscreen mode"})}},vo=async()=>{try{document.exitFullscreen?await document.exitFullscreen():document.webkitExitFullscreen?await document.webkitExitFullscreen():document.msExitFullscreen&&await document.msExitFullscreen()}catch(t){console.error("Error exiting fullscreen:",t),w.error("Fullscreen Error",{description:"Unable to exit fullscreen mode"})}},Qt=async()=>{h.value?await vo():await go()},Ge=()=>{const t=document.fullscreenElement||document.webkitFullscreenElement||document.msFullscreenElement;h.value=!!t},ho=()=>{Z.value=!Z.value,Z.value&&(le.value=!1),me(Z.value)},fo=()=>{Z.value=!1,me(!1)},mo=()=>{le.value=!1},Jt=()=>{ee.value=!ee.value},Xt=()=>{Ke.visit(Q("projects.analysis",{project:n.project.slug}))},Yt=()=>{Xr(f.value),Ae(),ut()},Zt=t=>{(t.ctrlKey||t.metaKey)&&t.key==="s"&&(t.preventDefault(),we(),Vr()),(t.ctrlKey||t.metaKey)&&!t.shiftKey&&t.key==="z"&&(t.preventDefault(),Ht()),(t.ctrlKey||t.metaKey)&&t.shiftKey&&t.key==="z"&&(t.preventDefault(),Bt()),t.key==="F11"&&(t.preventDefault(),Qt())};ht(()=>{const t=()=>{C.value=window.innerWidth<1024};t(),window.addEventListener("resize",t),Z.value=fe(),document.addEventListener("keydown",er),document.addEventListener("keydown",Zt),document.addEventListener("fullscreenchange",Ge),document.addEventListener("webkitfullscreenchange",Ge),document.addEventListener("msfullscreenchange",Ge),ut(),wo()});const Rt=()=>{q.value&&ft(()=>{let t=null;if(h.value){const e=It.value;if(e){const u=e.$el||e;t=u?.querySelector("[data-radix-scroll-area-viewport]")||u?.querySelector("[data-viewport]")||u?.querySelector('[role="region"]')}}else t=document.querySelector(".overflow-y-auto.custom-scrollbar");if(!t){const e=document.querySelector("main");if(e){const u=e.querySelectorAll("div");for(const a of u)if(a.scrollHeight>a.clientHeight&&a.classList.contains("overflow-y-auto")){t=a;break}}}t&&(Ur(t),zr(),requestAnimationFrame(()=>{!Hr.value&&t&&t.scrollTo({top:t.scrollHeight,behavior:"smooth"})}))})},wo=()=>{const t=new URLSearchParams(window.location.search),e=t.get("ai_generate")==="true",u=t.get("generation_type");e&&u&&setTimeout(()=>{if(u==="progressive"){Tt("progressive");const a=new URL(window.location.href);a.searchParams.delete("ai_generate"),a.searchParams.delete("generation_type"),window.history.replaceState({},"",a.toString()),w.success("ðŸš€ AI Generation Started",{description:`Generating ${n.chapter.title} with AI assistance...`})}else if(u==="single"){Tt("progressive");const a=new URL(window.location.href);a.searchParams.delete("ai_generate"),a.searchParams.delete("generation_type"),window.history.replaceState({},"",a.toString()),w.success("ðŸš€ AI Generation Started",{description:`Generating ${n.chapter.title} with AI assistance...`})}},1e3)},er=t=>{if((t.ctrlKey||t.metaKey)&&!["INPUT","TEXTAREA","SELECT"].includes(t.target?.tagName))switch(t.key){case"ArrowLeft":t.preventDefault();const e=n.chapter.chapter_number-1;n.allChapters.find(y=>y.chapter_number===e)&&et(e);break;case"ArrowRight":t.preventDefault();const a=n.chapter.chapter_number+1;n.allChapters.find(y=>y.chapter_number===a)&&et(a);break}};ht(()=>{const t=e=>{const u=a=>{const{scrollTop:p,scrollHeight:y,clientHeight:F}=e,A=a.deltaY,Y=p<=0,H=p+F>=y;A<0&&Y||A>0&&H||a.stopPropagation()};return e.addEventListener("wheel",u,{passive:!0}),()=>e.removeEventListener("wheel",u)};ft(()=>{const e=document.querySelectorAll('[class*="overflow-y-auto"]'),u=[];e.forEach(a=>{if(a instanceof HTMLElement){const p=t(a);u.push(p)}}),window.__scrollChainCleanup=u})}),Ar(()=>{Kr(),k.value&&k.value.close(),document.removeEventListener("keydown",Zt),document.removeEventListener("keydown",er);const t=window.__scrollChainCleanup;t&&Array.isArray(t)&&(t.forEach(e=>e()),delete window.__scrollChainCleanup),document.removeEventListener("fullscreenchange",Ge),document.removeEventListener("webkitfullscreenchange",Ge),document.removeEventListener("msfullscreenchange",Ge)}),ye(()=>n.chapter,async t=>{N.value=t.title||"",f.value=t.content||"",ne.value=[],yo(),nr(),Re.value=rr(),await ot(!1,{skipGeneration:!0}),await ft(()=>{sr(),vt()})},{immediate:!1});const ne=c([]),He=c(!1),Be=c(!1),rt=c(null),Re=c(!1),tr=(t,e)=>`defense_auto_generate_${t}_ch_${e}`,rr=()=>{try{return localStorage.getItem(tr(n.project.id,n.chapter.chapter_number))==="true"}catch(t){return console.warn("Failed to load defense auto-generation preference:",t),!1}},bo=t=>{try{localStorage.setItem(tr(n.project.id,n.chapter.chapter_number),String(t))}catch(e){console.warn("Failed to save defense auto-generation preference:",e)}};Re.value=rr(),ye(f,Yt),ye(N,Ae);const re=M(()=>n.chapter),or=async t=>{ge.value=t,t&&xo()&&await ot(!1,{skipGeneration:!0})},xo=()=>{if(!ne.value.length||!rt.value)return!0;const t=new Date(Date.now()-360*60*1e3);return rt.value<t},ot=async(t=!1,e={})=>{if(He.value)return;const u=e.skipGeneration??!0;He.value=!0;try{console.log("Loading defense questions with params:",{project_id:n.project.id,chapter_number:re.value?.chapter_number,limit:5,force_refresh:t,skip_generation:u});const a=await he.get(`/api/projects/${n.project.id}/defense/questions`,{params:{chapter_number:re.value?.chapter_number||null,limit:5,force_refresh:t?1:0,skip_generation:u?1:0},headers:{Accept:"application/json","X-Requested-With":"XMLHttpRequest"}});if(console.log("Defense questions loaded:",a.data),console.log("Questions array:",a.data.questions),console.log("Questions count:",a.data.questions?a.data.questions.length:0),ne.value=a.data.questions||[],rt.value=new Date,a.data.questions&&a.data.questions.length>0){const p=`defense_questions_${n.project.id}_chapter_${re.value?.chapter_number}`;localStorage.setItem(p,JSON.stringify({questions:a.data.questions,chapter_number:re.value?.chapter_number,loaded_at:new Date().toISOString()}))}else t||(console.log("No existing questions found for this chapter"),console.log(`Current word count: ${X.value}/${dt}`),console.log('User must click "Generate Questions" button to create defense questions'))}catch(a){if(console.error("Failed to load defense questions:",a),a.response)if(console.error("Response status:",a.response.status),console.error("Response data:",a.response.data),a.response.status===422){console.error("Validation errors:",a.response.data.errors);const p=Object.values(a.response.data.errors||{})[0];p&&Array.isArray(p)?w.error(`Validation Error: ${p[0]}`):w.error("Invalid request parameters. Please refresh the page.")}else a.response.status===500?w.error("Server error. Please try again later."):w.error("Failed to load defense questions");else a.request?(console.error("No response received:",a.request),w.error("Network error. Please check your connection.")):(console.error("Error setting up request:",a.message),w.error("An unexpected error occurred"));ne.value=[]}finally{He.value=!1}},vt=async()=>{!Re.value||Be.value||He.value||at.value||!qt.value||ne.value.length>0||await Pt({autoTriggered:!0})},ar=t=>{Re.value=t,bo(t),t&&vt()};ye(f,Yt),ye(N,Ae),ye([X,Re],()=>{vt()});const Pt=async(t={})=>{if(Be.value)return;const e=t.autoTriggered??!1,u=_e.defense();if(Ne(u,"generate defense questions")){Be.value=!0;try{const a=y=>y?y.replace(/<[^>]*>/g," ").trim().split(/\s+/).filter(F=>F.length>0).length:0,p=await he.post(`/api/projects/${n.project.id}/defense/questions/generate`,{chapter_number:re.value.chapter_number},{headers:{"X-CSRF-TOKEN":document.querySelector('meta[name="csrf-token"]')?.getAttribute("content"),Accept:"application/json","Content-Type":"application/json"}});if(p.data&&p.data.questions){ne.value=p.data.questions,rt.value=new Date;const y=p.data.questions.reduce((A,Y)=>{const H=a(Y.question),z=a(Y.suggested_answer),se=(Y.key_points||[]).reduce((de,Pe)=>de+a(Pe),0);return A+H+z+se},0),F=`defense_questions_${n.project.id}_chapter_${re.value?.chapter_number}`;localStorage.setItem(F,JSON.stringify({questions:p.data.questions,chapter_number:re.value?.chapter_number,loaded_at:new Date().toISOString()})),w.success(`Generated ${p.data.questions.length} new questions`),Je(y||_e.defense(),"Defense questions","chapter",n.chapter.id).catch(A=>console.error("Failed to record word usage (defense):",A)),at.value=!0,_o(),e&&console.log("Auto-generated defense questions after meeting threshold.")}}catch(a){console.error("Failed to generate defense questions:",a),w.error("Failed to generate defense questions")}finally{Be.value=!1}}},{hasTriggeredGeneration:at,startWatching:nr,stopWatching:yo,forceCheck:sr,getStatusMessage:lr,markGenerationTriggered:_o}=ba(n.project,n.chapter,f),qt=ro,ir=async()=>{console.log("ðŸ”µ [MARK COMPLETE] Function called"),console.log("ðŸ”µ [MARK COMPLETE] Current word count:",X.value);try{console.log("ðŸ”µ [MARK COMPLETE] Saving chapter..."),await we(!1),console.log("âœ… [MARK COMPLETE] Chapter saved");const t=Q("chapters.mark-complete",{project:n.project.slug,chapter:n.chapter.chapter_number});console.log("ðŸ”µ [MARK COMPLETE] Posting to:",t),Ke.post(t,{},{onSuccess:()=>{console.log("âœ… [MARK COMPLETE] Request successful")},onError:e=>{console.error("âŒ [MARK COMPLETE] Request failed:",e)}})}catch(t){console.error("âŒ [MARK COMPLETE] Error:",t),w.error("Failed to save chapter before marking complete")}},cr=M(()=>{const t=X.value;return t>0&&t<dt&&!at.value}),ur=ao,dr=oo,pr=async(t,e)=>{try{await he.patch(`/api/projects/${n.project.id}/defense/questions/${t}`,{user_marked_helpful:e},{headers:{"X-CSRF-TOKEN":document.querySelector('meta[name="csrf-token"]')?.getAttribute("content"),Accept:"application/json","Content-Type":"application/json"}});const u=ne.value.find(a=>a.id===t);u&&(u.user_marked_helpful=e),w.success(e?"Question marked as helpful":"Removed helpful mark")}catch(u){console.error("Failed to mark question:",u),w.error("Failed to update question")}},gr=async t=>{try{await he.delete(`/api/projects/${n.project.id}/defense/questions/${t}`,{headers:{"X-CSRF-TOKEN":document.querySelector('meta[name="csrf-token"]')?.getAttribute("content"),Accept:"application/json"}}),ne.value=ne.value.filter(e=>e.id!==t),localStorage.setItem(`defense_questions_${n.project.id}`,JSON.stringify({questions:ne.value,loaded_at:new Date().toISOString()})),w.success("Question hidden")}catch(e){console.error("Failed to hide question:",e),w.error("Failed to hide question")}};return ht(async()=>{const t=`defense_questions_${n.project.id}_chapter_${re.value?.chapter_number}`,e=localStorage.getItem(t);let u=!0;if(e){const a=JSON.parse(e),p=new Date(a.loaded_at),y=new Date(Date.now()-360*60*1e3);p>y&&a.chapter_number===re.value?.chapter_number&&(ne.value=a.questions,rt.value=p,u=!1)}u&&await ot(!1,{skipGeneration:!0}),nr(),await ft(()=>{sr(),vt()})}),ht(async()=>{await eo()}),(t,e)=>{const u=Eo("Edit2");return T(),K(r(Po),null,{default:i(()=>[Z.value?(T(),K(r(m),{key:0,project:be.value,chapter:xe.value,"chapter-title":N.value,"chapter-content":f.value,"current-word-count":r(X),"target-word-count":ce.value,"progress-percentage":r(St),"writing-quality-score":r(Se),"is-valid":pt.value,"is-saving":r(Ce),"show-preview":O.value,"is-generating":q.value,"generation-progress":_.value,"history-index":r(Jr),"content-history-length":r(Qr).length,"selected-text":U.value,"onUpdate:chapterTitle":e[0]||(e[0]=a=>N.value=a),"onUpdate:chapterContent":e[1]||(e[1]=a=>f.value=a),"onUpdate:selectedText":e[2]||(e[2]=a=>U.value=a),"onUpdate:showPreview":e[3]||(e[3]=a=>O.value=a),onSave:e[4]||(e[4]=a=>Gt(a)),onUndo:Ht,onRedo:Bt,onExitChatMode:fo},null,8,["project","chapter","chapter-title","chapter-content","current-word-count","target-word-count","progress-percentage","writing-quality-score","is-valid","is-saving","show-preview","is-generating","generation-progress","history-index","content-history-length","selected-text"])):le.value?(T(),K(r(d),{key:1,project:be.value,chapter:xe.value,"chapter-title":N.value,"chapter-content":f.value,"current-word-count":r(X),"target-word-count":ce.value,"progress-percentage":r(St),onExitCitationMode:mo},null,8,["project","chapter","chapter-title","chapter-content","current-word-count","target-word-count","progress-percentage"])):h.value?(T(),V("div",Sa,[e[51]||(e[51]=o("div",{class:"absolute inset-0 z-0 overflow-hidden pointer-events-none"},[o("div",{class:"absolute top-[-20%] left-[-10%] w-[50%] h-[50%] rounded-full bg-blue-500/5 blur-[120px]"}),o("div",{class:"absolute bottom-[-20%] right-[-10%] w-[50%] h-[50%] rounded-full bg-purple-500/5 blur-[120px]"})],-1)),o("div",ka,[o("div",Ea,[s(r(Me),null,{default:i(()=>[s(r(je),{asChild:""},{default:i(()=>[s(r(B),{onClick:e[5]||(e[5]=a=>r(Ke).visit(r(Q)("projects.show",n.project.slug))),variant:"ghost",size:"icon",class:"h-10 w-10 rounded-full hover:bg-primary/10 hover:text-primary transition-all duration-300"},{default:i(()=>[s(r(No),{class:"h-5 w-5"})]),_:1})]),_:1}),s(r(Fe),null,{default:i(()=>[...e[30]||(e[30]=[o("p",null,"Back to Project",-1)])]),_:1})]),_:1}),o("div",Ta,[s(mr,{as:"h1",class:"text-lg font-bold tracking-tight text-foreground/90 font-display",content:n.project.title},null,8,["content"]),o("div",Aa,[s(r(Le),{variant:"outline",class:"h-5 px-2 rounded-full border-primary/20 bg-primary/5 text-primary font-medium"},{default:i(()=>[$(" Chapter "+R(n.chapter.chapter_number),1)]),_:1}),o("span",$a,[e[31]||(e[31]=o("span",{class:"h-1.5 w-1.5 rounded-full bg-green-500 animate-pulse"},null,-1)),$(" "+R(r(X))+" words ",1)])])])]),o("div",Ra,[o("div",Pa,[s(r(B),{onClick:e[6]||(e[6]=a=>ae.value=!ae.value),variant:ae.value?"secondary":"ghost",size:"sm",class:pe(["h-8 px-4 rounded-full text-xs font-medium transition-all duration-300",ae.value?"bg-primary/10 text-primary hover:bg-primary/15":"hover:bg-muted"])},{default:i(()=>[s(r(wr),{class:"mr-2 h-3.5 w-3.5"}),e[32]||(e[32]=$(" Outline ",-1))]),_:1},8,["variant","class"]),e[34]||(e[34]=o("div",{class:"w-px h-4 bg-border/50 mx-1"},null,-1)),s(r(B),{onClick:e[7]||(e[7]=a=>ke.value=!ke.value),variant:ke.value?"secondary":"ghost",size:"sm",class:pe(["h-8 px-4 rounded-full text-xs font-medium transition-all duration-300",ke.value?"bg-primary/10 text-primary hover:bg-primary/15":"hover:bg-muted"])},{default:i(()=>[s(r(nt),{class:"mr-2 h-3.5 w-3.5"}),e[33]||(e[33]=$(" Assistant ",-1))]),_:1},8,["variant","class"])]),o("div",qa,[s(r(Me),null,{default:i(()=>[s(r(je),{asChild:""},{default:i(()=>[s(r(B),{onClick:e[8]||(e[8]=a=>D.value=!D.value),variant:D.value?"secondary":"ghost",size:"icon",class:"h-9 w-9 rounded-full transition-all hover:bg-muted"},{default:i(()=>[s(r(Cr),{class:"h-4.5 w-4.5 text-muted-foreground"})]),_:1},8,["variant"])]),_:1}),s(r(Fe),null,{default:i(()=>[o("p",null,R(D.value?"Hide":"Show")+" Statistics",1)]),_:1})]),_:1}),s(br,{project:be.value,"current-chapter":xe.value,"all-chapters":$e.value,size:"icon",variant:"ghost",class:"h-9 w-9 rounded-full hover:bg-muted"},null,8,["project","current-chapter","all-chapters"])])])]),o("div",Da,[o("div",{class:"absolute top-0 left-0 h-full bg-gradient-to-r from-blue-500 via-purple-500 to-pink-500 transition-all duration-700 ease-out shadow-[0_0_10px_rgba(59,130,246,0.5)]",style:st({width:`${Math.min(r(St),100)}%`})},null,4)]),q.value?(T(),V("div",Ma,[o("div",ja,[e[40]||(e[40]=o("div",{class:"absolute inset-0 -skew-x-12 animate-pulse bg-gradient-to-r from-transparent via-white/10 to-transparent"},null,-1)),o("div",Fa,[o("div",La,[o("div",Oa,[o("div",Wa,[s(r(nt),{class:"h-3 w-3 text-white"})]),e[35]||(e[35]=o("div",{class:"absolute inset-0 h-6 w-6 animate-ping rounded-full bg-gradient-to-br from-blue-500 to-purple-600 opacity-20"},null,-1))]),o("div",null,[e[36]||(e[36]=o("h4",{class:"text-xs font-semibold text-blue-900 dark:text-blue-100"},"AI Generator",-1)),o("p",Ia,R(x.value),1)])]),s(r(Le),{variant:"outline",class:"border-blue-300 text-xs text-blue-700 dark:border-blue-700 dark:text-blue-300"},{default:i(()=>[$(R(Math.round(l.value))+"% ",1)]),_:1})]),o("div",Na,[o("div",Ua,[e[37]||(e[37]=o("span",{class:"text-xs text-blue-800 dark:text-blue-200"},"Generation Progress",-1)),o("span",za,R(S.value)+" / "+R(G.value)+" words",1)]),o("div",Ga,[o("div",{class:"absolute top-0 left-0 h-full rounded-full bg-gradient-to-r from-blue-500 to-purple-500 transition-all duration-500 ease-out",style:st({width:`${l.value}%`})},[...e[38]||(e[38]=[o("div",{class:"absolute inset-0 animate-pulse bg-gradient-to-r from-transparent via-white/30 to-transparent"},null,-1)])],4),o("div",{class:"absolute top-0 left-0 h-full rounded-full bg-gradient-to-r from-blue-400 to-purple-400 opacity-50 blur-sm transition-all duration-500",style:st({width:`${l.value}%`})},null,4)])]),o("div",Ha,[o("div",Ba,[x.value==="Initializing"?(T(),V("div",Ka)):x.value==="Connecting"?(T(),V("div",Va,[...e[39]||(e[39]=[o("div",{class:"h-2 w-0.5 animate-pulse rounded-full bg-blue-500"},null,-1),o("div",{class:"h-2 w-0.5 animate-pulse rounded-full bg-purple-500",style:{"animation-delay":"0.2s"}},null,-1),o("div",{class:"h-2 w-0.5 animate-pulse rounded-full bg-blue-500",style:{"animation-delay":"0.4s"}},null,-1)])])):x.value==="Generating"?(T(),V("div",Qa)):x.value==="Complete"?(T(),V("div",Ja)):(T(),V("div",Xa))]),o("p",Ya,R(_.value),1)])])])):oe("",!0),D.value?(T(),K(Er,{key:1,"show-statistics":D.value,"current-word-count":r(X),"writing-stats":r(Ct),"quality-analysis":r(ve),"is-analyzing":r(Ut),class:"relative z-20 mx-4 mt-2 rounded-lg border border-border/40 bg-background/60 backdrop-blur-md"},null,8,["show-statistics","current-word-count","writing-stats","quality-analysis","is-analyzing"])):oe("",!0),o("div",Za,[s(mt,{"enter-active-class":"transition-all duration-300 ease-in-out","enter-from-class":"-ml-72 opacity-0","enter-to-class":"ml-0 opacity-100","leave-active-class":"transition-all duration-300 ease-in-out","leave-from-class":"ml-0 opacity-100","leave-to-class":"-ml-72 opacity-0"},{default:i(()=>[ae.value?(T(),V("div",en,[o("div",tn,[o("div",rn,[o("div",on,[e[41]||(e[41]=o("h2",{class:"text-sm font-semibold text-foreground mb-1"},"Table of Contents",-1)),o("p",an,R($e.value.length)+" Chapters ",1)]),(T(),K(wt,null,{fallback:i(()=>[...e[42]||(e[42]=[o("div",{class:"flex items-center justify-center p-8"},[o("div",{class:"h-6 w-6 animate-spin rounded-full border-2 border-primary border-t-transparent"})],-1)])]),default:i(()=>[s(r(E),{"all-chapters":$e.value,"current-chapter":xe.value,project:be.value,outlines:t.project.outlines||[],"faculty-chapters":t.facultyChapters||[],"current-word-count":r(X),"target-word-count":ce.value,"writing-quality-score":r(Se),"chapter-content-length":f.value.length,onGoToChapter:et,onGenerateNextChapter:kt},null,8,["all-chapters","current-chapter","project","outlines","faculty-chapters","current-word-count","target-word-count","writing-quality-score","chapter-content-length"])]),_:1}))])])])):oe("",!0)]),_:1}),o("div",nn,[o("div",sn,[o("div",ln,[s(r(jt),{class:"w-full max-w-[850px] min-h-[calc(100vh-180px)] flex flex-col bg-background shadow-xl shadow-black/5 ring-1 ring-black/5 dark:ring-white/10 rounded-xl overflow-hidden transition-all duration-300"},{default:i(()=>[s(r(Lt),{class:"flex-shrink-0 border-b border-border/30 px-8 py-6 bg-background/50 backdrop-blur-sm sticky top-0 z-10"},{default:i(()=>[o("div",cn,[o("div",un,[s(r(Ao),{for:"chapter-title-fs",class:"text-xs font-medium text-muted-foreground uppercase tracking-wider"},{default:i(()=>[...e[43]||(e[43]=[$("Chapter Title",-1)])]),_:1}),s(r(To),{id:"chapter-title-fs",modelValue:N.value,"onUpdate:modelValue":e[9]||(e[9]=a=>N.value=a),placeholder:"Enter chapter title...",class:"h-auto p-0 border-0 bg-transparent text-2xl font-bold placeholder:text-muted-foreground/40 focus-visible:ring-0 px-0"},null,8,["modelValue"])]),o("div",dn,[s(r(Le),{variant:t.chapter.status==="approved"?"default":"secondary",class:"rounded-full px-3"},{default:i(()=>[$(R(t.chapter.status.replace("_"," ")),1)]),_:1},8,["variant"]),s(r(Le),{variant:"outline",class:pe(["rounded-full px-3 transition-colors",{"text-green-600 border-green-200 bg-green-50 dark:bg-green-900/20 dark:border-green-800":(r(ve)?.total_score||0)>=80,"text-yellow-600 border-yellow-200 bg-yellow-50 dark:bg-yellow-900/20 dark:border-yellow-800":(r(ve)?.total_score||0)>=70&&(r(ve)?.total_score||0)<80,"text-orange-600 border-orange-200 bg-orange-50 dark:bg-orange-900/20 dark:border-orange-800":(r(ve)?.total_score||0)>=60&&(r(ve)?.total_score||0)<70,"text-red-600 border-red-200 bg-red-50 dark:bg-red-900/20 dark:border-red-800":(r(ve)?.total_score||0)<60}])},{default:i(()=>[$(R(r(ve)?.total_score?Math.round(r(ve).total_score):r(Se))+"% Quality ",1)]),_:1},8,["class"])])])]),_:1}),s(r(Ft),{class:"flex min-h-0 flex-1 flex-col p-0"},{default:i(()=>[o("div",pn,[o("div",gn,[s(r(B),{onClick:Jt,variant:ee.value?"default":"ghost",size:"sm",class:"h-7 text-xs rounded-full"},{default:i(()=>[s(r(Sr),{class:"mr-1.5 h-3.5 w-3.5"}),$(" "+R(ee.value?"Edit":"Preview"),1)]),_:1},8,["variant"])]),o("div",vn,[o("div",hn,R(t.aiChapterAnalysis?.section.name||t.getSectionInfo(t.nextSection).name),1),o("div",fn,R(t.aiChapterAnalysis?.section.description||t.getSectionInfo(t.nextSection).description),1)])]),o("div",mn,[Ve(s(yr,{modelValue:f.value,"onUpdate:modelValue":e[10]||(e[10]=a=>f.value=a),placeholder:"Start writing your chapter...","min-height":"500px",class:"min-h-[500px] px-8 py-6",ref_key:"richTextEditor",ref:gt,"show-toolbar":!0,"streaming-mode":Ze.value,"is-generating":q.value,"generation-progress":_.value,"generation-percentage":l.value,"generation-phase":x.value,"onUpdate:selectedText":e[11]||(e[11]=a=>{U.value=a})},null,8,["modelValue","streaming-mode","is-generating","generation-progress","generation-percentage","generation-phase"]),[[Qe,!ee.value]]),Ve(o("div",wn,[s(xr,{content:f.value,"show-font-controls":!1,class:"prose-lg mx-auto",style:{"font-family":"'Times New Roman', serif","line-height":"1.8"}},null,8,["content"])],512),[[Qe,ee.value]])])]),_:1}),o("div",bn,[o("div",xn,R(r(Ce)?"Saving...":"All changes saved"),1),o("div",yn,[s(r(B),{onClick:e[12]||(e[12]=a=>r(we)(!1)),disabled:!pt.value||r(Ce),size:"sm",variant:"ghost",class:"h-8 rounded-full"},{default:i(()=>[s(r(kr),{class:"mr-2 h-3.5 w-3.5"}),e[44]||(e[44]=$(" Save Draft ",-1))]),_:1},8,["disabled"]),s(r(B),{onClick:Xt,variant:"outline",size:"sm",class:"h-8 rounded-full"},{default:i(()=>[s(r(xt),{class:"mr-2 h-3.5 w-3.5"}),e[45]||(e[45]=$(" Run Bulk Analysis ",-1))]),_:1}),s(r(B),{onClick:ir,disabled:r(Ce),size:"sm",class:"h-8 rounded-full bg-gradient-to-r from-primary to-primary/90 shadow-sm hover:shadow-md transition-all"},{default:i(()=>[s(r(Dt),{class:"mr-2 h-3.5 w-3.5"}),e[46]||(e[46]=$(" Complete ",-1))]),_:1},8,["disabled"])])])]),_:1}),e[47]||(e[47]=o("div",{class:"h-12"},null,-1))])])]),s(mt,{"enter-active-class":"transition-all duration-300 ease-in-out","enter-from-class":"-mr-72 opacity-0","enter-to-class":"mr-0 opacity-100","leave-active-class":"transition-all duration-300 ease-in-out","leave-from-class":"mr-0 opacity-100","leave-to-class":"-mr-72 opacity-0"},{default:i(()=>[ke.value?(T(),V("div",_n,[o("div",Cn,[o("div",Sn,[(T(),K(wt,null,{fallback:i(()=>[...e[48]||(e[48]=[o("div",{class:"flex items-center justify-center p-8"},[o("div",{class:"h-6 w-6 animate-spin rounded-full border-2 border-primary border-t-transparent"})],-1)])]),default:i(()=>[s(r(v),{project:be.value,chapter:xe.value,"is-generating":q.value,"selected-text":U.value,"is-loading-suggestions":Xe.value,"show-citation-helper":Ee.value,"chapter-content":f.value,"current-word-count":r(X),"target-word-count":ce.value,onStartStreamingGeneration:Et,onGetAiSuggestions:At,"onUpdate:showCitationHelper":e[13]||(e[13]=a=>Ee.value=a),onInsertCitation:Vt,onCheckCitations:$t},null,8,["project","chapter","is-generating","selected-text","is-loading-suggestions","show-citation-helper","chapter-content","current-word-count","target-word-count"])]),_:1})),(T(),K(wt,null,{fallback:i(()=>[...e[49]||(e[49]=[o("div",{class:"flex items-center justify-center p-4"},[o("div",{class:"h-4 w-4 animate-spin rounded-full border-2 border-muted border-t-transparent"})],-1)])]),default:i(()=>[s(r(b),{"show-defense-prep":ge.value,questions:ne.value,"is-loading":He.value,"is-generating":Be.value,"chapter-context":{chapter_number:re.value.chapter_number,chapter_title:re.value.title,word_count:r(X)},"defense-watcher":{meetsThreshold:r(qt),shouldShowProgress:cr.value,progressPercentage:r(ur),wordsRemaining:r(dr),hasTriggeredGeneration:r(at),threshold:r(dt),statusMessage:r(lr)()},"auto-generate-enabled":Re.value,"onUpdate:showDefensePrep":or,onGenerateMore:Pt,onToggleAutoGenerate:ar,onRefresh:e[14]||(e[14]=()=>ot(!0,{skipGeneration:!0})),onMarkHelpful:pr,onHideQuestion:gr},null,8,["show-defense-prep","questions","is-loading","is-generating","chapter-context","defense-watcher","auto-generate-enabled"])]),_:1})),(T(),K(wt,null,{fallback:i(()=>[...e[50]||(e[50]=[o("div",{class:"flex items-center justify-center p-4"},[o("div",{class:"h-4 w-4 animate-spin rounded-full border-2 border-muted border-t-transparent"})],-1)])]),default:i(()=>[s(r(g),{"chapter-id":re.value.id,content:f.value},null,8,["chapter-id","content"])]),_:1}))])])])):oe("",!0)]),_:1})])])):(T(),K(Ro,{key:3,class:"h-screen overflow-hidden bg-zinc-50 dark:bg-zinc-950"},{default:i(()=>[o("div",kn,[e[75]||(e[75]=o("div",{class:"absolute inset-0 z-0 overflow-hidden pointer-events-none"},[o("div",{class:"absolute top-[-10%] left-[-10%] w-[40%] h-[40%] rounded-full bg-blue-500/5 blur-[100px]"}),o("div",{class:"absolute bottom-[-10%] right-[-10%] w-[40%] h-[40%] rounded-full bg-purple-500/5 blur-[100px]"})],-1)),Ve(o("aside",En,[o("div",Tn,[e[52]||(e[52]=o("span",{class:"text-sm font-semibold tracking-tight"},"Navigation",-1)),s(r(Le),{variant:"outline",class:"text-[10px] h-5 px-1.5"},{default:i(()=>[$(R($e.value.length)+" Chapters ",1)]),_:1})]),s(r(fr),{class:"flex-1"},{default:i(()=>[o("div",An,[s(r(E),{"all-chapters":$e.value,"current-chapter":xe.value,project:be.value,outlines:t.project.outlines||[],"faculty-chapters":t.facultyChapters||[],"current-word-count":r(X),"target-word-count":ce.value,"writing-quality-score":r(Se),"chapter-content-length":f.value.length,onGoToChapter:et,onGenerateNextChapter:kt},null,8,["all-chapters","current-chapter","project","outlines","faculty-chapters","current-word-count","target-word-count","writing-quality-score","chapter-content-length"])])]),_:1})],512),[[Qe,!J.value]]),o("main",$n,[o("header",Rn,[o("div",Pn,[o("div",qn,[s(r(B),{variant:"ghost",size:"icon",onClick:e[15]||(e[15]=a=>J.value=!J.value),class:"hidden lg:flex text-muted-foreground hover:text-foreground -ml-2 h-8 w-8"},{default:i(()=>[J.value?(T(),K(r(zo),{key:1,class:"h-4 w-4"})):(T(),K(r(Uo),{key:0,class:"h-4 w-4"}))]),_:1}),s(r(B),{variant:"ghost",size:"icon",onClick:e[16]||(e[16]=a=>ue.value=!0),class:"lg:hidden text-muted-foreground hover:text-foreground -ml-2 h-8 w-8"},{default:i(()=>[s(r(wr),{class:"h-4 w-4"})]),_:1}),e[53]||(e[53]=o("div",{class:"h-8 w-px bg-border/50 hidden lg:block mx-1"},null,-1))]),o("div",Dn,[o("div",Mn,[s(mr,{as:"h1",class:"text-lg font-bold tracking-tight text-foreground leading-tight cursor-pointer hover:text-primary/80 transition-colors break-words line-clamp-2",content:n.project.title,onClick:e[17]||(e[17]=a=>r(Ke).visit(r(Q)("projects.show",n.project.slug)))},null,8,["content"]),s(r(Le),{variant:"secondary",class:"h-5 px-2 text-[10px] font-medium rounded-full bg-secondary/50 border border-border/50 shrink-0 mt-0.5"},{default:i(()=>[$(" Ch "+R(n.chapter.chapter_number),1)]),_:1})]),o("div",jn,[o("div",Fn,[s(r(Me),null,{default:i(()=>[s(r(je),{asChild:""},{default:i(()=>[s(r(B),{onClick:e[18]||(e[18]=a=>D.value=!D.value),variant:D.value?"secondary":"ghost",size:"sm",class:"h-7 px-3 text-xs gap-2"},{default:i(()=>[s(r(Cr),{class:"h-3.5 w-3.5"}),e[54]||(e[54]=$(" Stats ",-1))]),_:1},8,["variant"])]),_:1}),s(r(Fe),null,{default:i(()=>[...e[55]||(e[55]=[$("Toggle Writing Statistics",-1)])]),_:1})]),_:1}),e[60]||(e[60]=o("div",{class:"w-px h-3 bg-border/50 mx-0.5"},null,-1)),s(r(Me),null,{default:i(()=>[s(r(je),{asChild:""},{default:i(()=>[s(r(B),{onClick:Jt,variant:ee.value?"secondary":"ghost",size:"sm",class:"h-7 px-3 text-xs gap-2"},{default:i(()=>[ee.value?(T(),K(u,{key:1,class:"h-3.5 w-3.5"})):(T(),K(r(Sr),{key:0,class:"h-3.5 w-3.5"})),$(" "+R(ee.value?"Edit":"Preview"),1)]),_:1},8,["variant"])]),_:1}),s(r(Fe),null,{default:i(()=>[...e[56]||(e[56]=[$("Toggle Preview Mode",-1)])]),_:1})]),_:1}),e[61]||(e[61]=o("div",{class:"w-px h-3 bg-border/50 mx-0.5"},null,-1)),s(r(Me),null,{default:i(()=>[s(r(je),{asChild:""},{default:i(()=>[s(r(B),{onClick:ho,variant:"ghost",size:"sm",class:"h-7 px-3 text-xs gap-2"},{default:i(()=>[s(r(Go),{class:"h-3.5 w-3.5 text-blue-500"}),e[57]||(e[57]=$(" AI Chat ",-1))]),_:1})]),_:1}),s(r(Fe),null,{default:i(()=>[...e[58]||(e[58]=[$("Open AI Assistant Overlay",-1)])]),_:1})]),_:1}),e[62]||(e[62]=o("div",{class:"w-px h-3 bg-border/50 mx-0.5"},null,-1)),s(r(Me),null,{default:i(()=>[s(r(je),{asChild:""},{default:i(()=>[s(r(B),{onClick:Qt,variant:"ghost",size:"sm",class:"h-7 px-3 text-xs gap-2",title:h.value?"Exit Full Screen":"Enter Full Screen"},{default:i(()=>[h.value?(T(),K(r(jo),{key:0,class:"h-3.5 w-3.5"})):(T(),K(r(Fo),{key:1,class:"h-3.5 w-3.5"}))]),_:1},8,["title"])]),_:1}),s(r(Fe),null,{default:i(()=>[...e[59]||(e[59]=[$("Toggle Full Screen",-1)])]),_:1})]),_:1})]),s(br,{project:be.value,"current-chapter":xe.value,"all-chapters":$e.value,size:"sm",variant:"outline",class:"h-7 hidden md:flex"},null,8,["project","current-chapter","all-chapters"]),s(r(B),{variant:"ghost",size:"sm",class:"hidden md:flex h-7 gap-2",onClick:Xt,title:"Open bulk analysis"},{default:i(()=>[s(r(nt),{class:"w-4 h-4"}),e[63]||(e[63]=o("span",{class:"text-xs font-medium"},"Analyze",-1))]),_:1}),s(r(B),{onClick:e[19]||(e[19]=a=>r(we)(!1)),disabled:r(Ce),variant:pt.value?"default":"secondary",size:"sm",class:"h-7 px-3 text-xs shadow-sm gap-2"},{default:i(()=>[s(r(kr),{class:"h-3.5 w-3.5"}),$(" "+R(r(Ce)?"Saving...":"Save"),1)]),_:1},8,["disabled","variant"]),s(r(B),{onClick:ir,disabled:r(Ce),size:"sm",class:"h-7 px-3 text-xs shadow-sm gap-2"},{default:i(()=>[s(r(Dt),{class:"h-3.5 w-3.5"}),e[64]||(e[64]=$(" Mark Complete ",-1))]),_:1},8,["disabled"])])])]),o("div",Ln,[s(r(B),{variant:"ghost",size:"icon",onClick:e[20]||(e[20]=a=>te.value=!te.value),class:"hidden lg:flex text-muted-foreground hover:text-foreground ml-1 h-8 w-8"},{default:i(()=>[te.value?(T(),K(r(Oo),{key:1,class:"h-4 w-4"})):(T(),K(r(Lo),{key:0,class:"h-4 w-4"}))]),_:1}),s(r(B),{variant:"ghost",size:"icon",onClick:e[21]||(e[21]=a=>I.value=!0),class:"lg:hidden text-muted-foreground hover:text-foreground ml-1 h-8 w-8"},{default:i(()=>[s(r(nt),{class:"h-4 w-4"})]),_:1})])]),o("div",On,[s(mt,{"enter-active-class":"transition-all duration-300 ease-out","enter-from-class":"opacity-0 -translate-y-4","enter-to-class":"opacity-100 translate-y-0","leave-active-class":"transition-all duration-200 ease-in","leave-from-class":"opacity-100 translate-y-0","leave-to-class":"opacity-0 -translate-y-4"},{default:i(()=>[q.value?(T(),V("div",Wn,[o("div",In,[o("div",Nn,[o("div",Un,[o("div",zn,[s(r(nt),{class:"h-4 w-4 text-white animate-pulse"})]),o("div",Gn,[o("div",Hn,[e[65]||(e[65]=o("h4",{class:"text-xs font-semibold text-foreground"},"Generating Content...",-1)),o("span",Bn,R(Math.round(l.value))+"%",1)]),o("div",Kn,[o("div",{class:"h-full bg-gradient-to-r from-blue-500 to-purple-500 transition-all duration-300",style:st({width:`${l.value}%`})},null,4)])])]),o("p",Vn,R(_.value),1)])])])):oe("",!0)]),_:1}),s(r(fr),{ref_key:"editorScrollRef",ref:It,class:"h-full w-full"},{default:i(()=>[o("div",Qn,[s(mt,{"enter-active-class":"transition-all duration-300 ease-out","enter-from-class":"opacity-0 -translate-y-2","enter-to-class":"opacity-100 translate-y-0","leave-active-class":"transition-all duration-200 ease-in","leave-from-class":"opacity-100 translate-y-0","leave-to-class":"opacity-0 -translate-y-2"},{default:i(()=>[D.value?(T(),K(Er,{key:0,"show-statistics":!0,"current-word-count":r(X),"writing-stats":r(Ct),"quality-analysis":r(ve),"is-analyzing":r(Ut),class:"mb-8"},null,8,["current-word-count","writing-stats","quality-analysis","is-analyzing"])):oe("",!0)]),_:1}),Ve(o("div",Jn,[s(yr,{ref_key:"richTextEditorFullscreen",ref:tt,modelValue:f.value,"onUpdate:modelValue":e[22]||(e[22]=a=>f.value=a),placeholder:"Start writing your chapter...",class:"prose prose-slate dark:prose-invert prose-lg max-w-none focus:outline-none min-h-[500px]","streaming-mode":Ze.value,"is-generating":q.value,"generation-progress":_.value,"generation-percentage":l.value,"generation-phase":x.value,"onUpdate:selectedText":e[23]||(e[23]=a=>U.value=a),"min-height":"500px"},null,8,["modelValue","streaming-mode","is-generating","generation-progress","generation-percentage","generation-phase"])],512),[[Qe,!ee.value]]),Ve(o("div",Xn,[s(xr,{content:f.value,class:"prose prose-slate dark:prose-invert prose-lg max-w-none"},null,8,["content"])],512),[[Qe,ee.value]])])]),_:1},512)]),o("div",Yn,[o("div",Zn,[o("span",null,"Words: "+R(r(X))+" / "+R(ce.value),1),o("span",es,"Last saved: "+R(r(Ce)?"Saving...":"Just now"),1)]),o("div",ts,[o("span",null,[e[66]||(e[66]=$("Quality: ",-1)),o("span",{class:pe(r(Se)>70?"text-green-500":"text-amber-500")},R(r(Se))+"%",3)]),pt.value?(T(),V("span",rs,[s(r(Dt),{class:"h-3 w-3"}),e[67]||(e[67]=$(" Ready ",-1))])):oe("",!0)])])]),Ve(o("aside",os,[o("div",as,[e[69]||(e[69]=o("span",{class:"text-sm font-semibold tracking-tight"},"Writing Assistant",-1)),s(r(Me),null,{default:i(()=>[s(r(je),{asChild:""},{default:i(()=>[s(r(B),{variant:"ghost",size:"icon",class:"h-7 w-7"},{default:i(()=>[s(r(xt),{class:"h-3.5 w-3.5"})]),_:1})]),_:1}),s(r(Fe),null,{default:i(()=>[...e[68]||(e[68]=[$("Manage Citations",-1)])]),_:1})]),_:1})]),o("div",ns,[o("div",ss,[s(r(v),{project:be.value,chapter:xe.value,"is-generating":q.value,"selected-text":U.value,"is-loading-suggestions":Xe.value,"show-citation-helper":Ee.value,"chapter-content":f.value,"current-word-count":r(X),"target-word-count":ce.value,onStartStreamingGeneration:Et,onGetAiSuggestions:At,"onUpdate:showCitationHelper":e[24]||(e[24]=a=>Ee.value=a),onInsertCitation:Vt,onCheckCitations:$t},null,8,["project","chapter","is-generating","selected-text","is-loading-suggestions","show-citation-helper","chapter-content","current-word-count","target-word-count"]),s(r(b),{"show-defense-prep":ge.value,questions:ne.value,"is-loading":He.value,"is-generating":Be.value,"chapter-context":{chapter_number:re.value.chapter_number,chapter_title:re.value.title,word_count:r(X)},"defense-watcher":{meetsThreshold:r(qt),shouldShowProgress:cr.value,progressPercentage:r(ur),wordsRemaining:r(dr),hasTriggeredGeneration:r(at),threshold:r(dt),statusMessage:r(lr)()},"auto-generate-enabled":Re.value,"onUpdate:showDefensePrep":or,onGenerateMore:Pt,onToggleAutoGenerate:ar,onRefresh:e[25]||(e[25]=()=>ot(!0,{skipGeneration:!0})),onMarkHelpful:pr,onHideQuestion:gr},null,8,["show-defense-prep","questions","is-loading","is-generating","chapter-context","defense-watcher","auto-generate-enabled"])])])],512),[[Qe,!te.value]]),s(r(j),{"show-left-sidebar":ue.value,"show-right-sidebar":I.value,"is-mobile":C.value,"all-chapters":$e.value,"current-chapter":xe.value,project:be.value,"current-word-count":r(X),"target-word-count":ce.value,"writing-quality-score":r(Se),"chapter-content-length":f.value.length,"is-generating":q.value,"selected-text":U.value,"is-loading-suggestions":Xe.value,"show-citation-helper":Ee.value,"chapter-content":f.value,"onUpdate:showLeftSidebar":e[26]||(e[26]=a=>ue.value=a),"onUpdate:showRightSidebar":e[27]||(e[27]=a=>I.value=a),onGoToChapter:et,onGenerateNextChapter:kt,onStartStreamingGeneration:Et,onGetAiSuggestions:At,"onUpdate:showCitationHelper":e[28]||(e[28]=a=>Ee.value=a),onCheckCitations:$t},null,8,["show-left-sidebar","show-right-sidebar","is-mobile","all-chapters","current-chapter","project","current-word-count","target-word-count","writing-quality-score","chapter-content-length","is-generating","selected-text","is-loading-suggestions","show-citation-helper","chapter-content"]),s(qo,{open:r(Wt),"current-balance":r(Pr),"required-words":r(qr),action:r(Dr),"onUpdate:open":e[29]||(e[29]=a=>Wt.value=a),onClose:r(jr)},null,8,["open","current-balance","required-words","action","onClose"]),Ie.value?(T(),V("div",ls,[s(r(jt),{class:"w-full max-w-md mx-4 bg-white dark:bg-slate-900 border-amber-500/50 shadow-2xl"},{default:i(()=>[s(r(Lt),null,{default:i(()=>[s(r($r),{class:"flex items-center gap-2 text-amber-600 dark:text-amber-400"},{default:i(()=>[...e[70]||(e[70]=[o("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[o("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"})],-1),$(" Generation Interrupted ",-1)])]),_:1})]),_:1}),s(r(Ft),null,{default:i(()=>[o("p",is,[e[71]||(e[71]=$(" Connection lost. ",-1)),o("span",cs,R(ct.value)+" words",1),e[72]||(e[72]=$(" may have been saved. ",-1))]),o("div",us,[s(r(B),{onClick:uo,class:"flex-1 bg-amber-600 hover:bg-amber-700 text-white"},{default:i(()=>[...e[73]||(e[73]=[o("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-4 w-4 mr-2",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[o("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"})],-1),$(" Reload & Recover ",-1)])]),_:1}),s(r(B),{onClick:po,variant:"outline",class:"flex-1"},{default:i(()=>[...e[74]||(e[74]=[$(" Dismiss ",-1)])]),_:1})])]),_:1})]),_:1})])):oe("",!0)])]),_:1}))]),_:1})}}}),_l=Ho(ps,[["__scopeId","data-v-eaddc1ee"]]);export{_l as default};
