const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/ChapterNavigation-KvF70jhW.js","assets/ChapterNavigation.vue_vue_type_script_setup_true_lang-CqXDMWzW.js","assets/index-D4mJyiz8.js","assets/vendor-B5jlBrgV.js","assets/vendor-CzBRREAs.css","assets/ScrollArea.vue_vue_type_script_setup_true_lang-DltzEvp9.js","assets/AlertDialogTitle.vue_vue_type_script_setup_true_lang-C-6bVGLf.js","assets/index-DCGYk7ZE.js","assets/MobileNavOverlay-BSxr3AXw.js","assets/index-DEDCgojD.js","assets/DefensePreparationPanel.vue_vue_type_script_setup_true_lang-CIo7O3gM.js","assets/CardContent.vue_vue_type_script_setup_true_lang-CtTakpSW.js","assets/CardTitle.vue_vue_type_script_setup_true_lang-XJ5or5ZK.js","assets/CollapsibleTrigger.vue_vue_type_script_setup_true_lang-Bov0hrWV.js","assets/Progress.vue_vue_type_script_setup_true_lang-DwlWDfQ5.js","assets/Separator.vue_vue_type_script_setup_true_lang-BvcdIWM_.js","assets/Switch.vue_vue_type_script_setup_true_lang-siBQm0EZ.js","assets/_plugin-vue_export-helper-DlAUqK2U.js","assets/TooltipTrigger.vue_vue_type_script_setup_true_lang-C5iiu9qR.js","assets/WordBalanceDisplay.vue_vue_type_script_setup_true_lang-DBc7hWuL.js","assets/AppLayout.vue_vue_type_script_setup_true_lang-B2pR5-jN.js","assets/UserInfo.vue_vue_type_script_setup_true_lang-w4YHLOMg.js","assets/Sonner.vue_vue_type_script_setup_true_lang-sxjlERgN.js","assets/AppLogo.vue_vue_type_script_setup_true_lang-BodEwO0Z.js","assets/useAppearance-D3We0oPJ.js","assets/useWordBalance-D_NxFp97.js","assets/PWAInstallPrompt.vue_vue_type_script_setup_true_lang-D12IZ_KU.js","assets/AppLayout-Cl1rfX3s.css","assets/PurchaseModal.vue_vue_type_script_setup_true_lang-DMxFPDrF.js","assets/DialogContent.vue_vue_type_script_setup_true_lang-DATQht2f.js","assets/DialogDescription.vue_vue_type_script_setup_true_lang-DsP71UmP.js","assets/DialogFooter.vue_vue_type_script_setup_true_lang-B5lGGt-M.js","assets/DialogTitle.vue_vue_type_script_setup_true_lang-Cb9j7AhV.js","assets/useChapterWordCount-BpyHk_pq.js","assets/Input.vue_vue_type_script_setup_true_lang-xMT9dCF9.js","assets/Label.vue_vue_type_script_setup_true_lang-BlhK8lFl.js","assets/RichTextEditor-CEL0MMIo.js","assets/vendor-tiptap-CeHW2ROA.js","assets/MermaidExtension-LU-z_FW5.js","assets/vendor-mermaid-Cnq-YXE-.js","assets/MermaidExtension-DI7x6sFR.css","assets/RichTextEditor-OopDycFM.css","assets/RichTextViewer-DYTV8h_g.js","assets/RichTextViewer-DtmUEoMb.css","assets/SelectValue.vue_vue_type_script_setup_true_lang-VRoINCin.js","assets/SelectGroup.vue_vue_type_script_setup_true_lang-BZxhET4J.js","assets/useTextHistory-D0JQJQu1.js","assets/Checkbox.vue_vue_type_script_setup_true_lang-jW0orlWc.js","assets/MobileNavOverlay-CiJwra5Q.css","assets/ChatModeLayout-Cz0Asvi_.js","assets/ChatModeLayout-Dr0PWGkM.css","assets/CitationVerificationLayout-Baj3tyZB.js","assets/SafeHtmlText.vue_vue_type_script_setup_true_lang-tt96GLrc.js"])))=>i.map(i=>d[i]);
import{ch as xs,ci as de,cj as z,bt as h,ck as C,cl as X,ce as V,cm as Tr,bE as Me,bB as Pe,cb as ie,bu as Ke,cn as P,co as v,bF as e,cp as n,cq as r,cr as s,cs as l,ct as p,cu as Le,cv as ws,cw as Ne,cx as We,cy as xt,cz as ys,cA as st,cB as Ar,cC as $r,cD as W,cE as Fe,cF as Dr,cG as Ht,cH as Oe,cI as U,cJ as Ut,cK as rt,cL as jr,cM as zr,cN as Rr,cO as Pr,cP as Fr,cQ as Mr,cR as Lr,cS as Nr,cT as Qt,cU as et,cV as ht,cW as Kt,cX as Vt,cY as Xt,cZ as Jt,c_ as Yt,c$ as Zt,d0 as vt,d1 as Wr,d2 as Or,d3 as es,d4 as ts,d5 as ss,d6 as Ir,d7 as qr,d8 as Gr,d9 as Br,da as Hr,db as Ur,dc as Qr,dd as Kr,de as Vr,df as Xr,_ as tt}from"./vendor-B5jlBrgV.js";import{_ as je}from"./index-DCGYk7ZE.js";import{_ as b,c as Jr}from"./index-D4mJyiz8.js";import{_ as oe,a as ae}from"./CardContent.vue_vue_type_script_setup_true_lang-CtTakpSW.js";import{_ as le,a as pe}from"./CardTitle.vue_vue_type_script_setup_true_lang-XJ5or5ZK.js";import{_ as rs}from"./ScrollArea.vue_vue_type_script_setup_true_lang-DltzEvp9.js";import{_ as Qe}from"./Separator.vue_vue_type_script_setup_true_lang-BvcdIWM_.js";import{_ as G,a as B,b as H}from"./TooltipTrigger.vue_vue_type_script_setup_true_lang-C5iiu9qR.js";import{_ as Yr}from"./WordBalanceDisplay.vue_vue_type_script_setup_true_lang-DBc7hWuL.js";import{_ as ns,a as os,b as as,c as ls,d as is,e as ds,f as us,g as cs}from"./AlertDialogTitle.vue_vue_type_script_setup_true_lang-C-6bVGLf.js";import{_ as ps,a as gs}from"./AppLayout.vue_vue_type_script_setup_true_lang-B2pR5-jN.js";import{_ as Zr}from"./PurchaseModal.vue_vue_type_script_setup_true_lang-DMxFPDrF.js";import{r as en,u as tn}from"./useWordBalance-D_NxFp97.js";import{u as _s}from"./useAppearance-D3We0oPJ.js";import{u as sn,a as rn,b as nn}from"./useChapterWordCount-BpyHk_pq.js";import{_ as on}from"./Input.vue_vue_type_script_setup_true_lang-xMT9dCF9.js";import{_ as an}from"./Label.vue_vue_type_script_setup_true_lang-BlhK8lFl.js";import{R as ks}from"./RichTextEditor-CEL0MMIo.js";import{R as Cs}from"./RichTextViewer-DYTV8h_g.js";import{_ as fs,a as ms,b as hs}from"./CollapsibleTrigger.vue_vue_type_script_setup_true_lang-Bov0hrWV.js";import{_ as ln}from"./Progress.vue_vue_type_script_setup_true_lang-DwlWDfQ5.js";import{_ as dn,a as un,b as cn,c as pn,d as Re}from"./SelectValue.vue_vue_type_script_setup_true_lang-VRoINCin.js";import{_ as gn}from"./SelectGroup.vue_vue_type_script_setup_true_lang-BZxhET4J.js";import{_ as fn,u as mn,a as bt}from"./useTextHistory-D0JQJQu1.js";import{_ as Ss}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./UserInfo.vue_vue_type_script_setup_true_lang-w4YHLOMg.js";import"./Sonner.vue_vue_type_script_setup_true_lang-sxjlERgN.js";import"./AppLogo.vue_vue_type_script_setup_true_lang-BodEwO0Z.js";import"./PWAInstallPrompt.vue_vue_type_script_setup_true_lang-D12IZ_KU.js";import"./DialogContent.vue_vue_type_script_setup_true_lang-DATQht2f.js";import"./DialogDescription.vue_vue_type_script_setup_true_lang-DsP71UmP.js";import"./DialogFooter.vue_vue_type_script_setup_true_lang-B5lGGt-M.js";import"./DialogTitle.vue_vue_type_script_setup_true_lang-Cb9j7AhV.js";import"./vendor-tiptap-CeHW2ROA.js";import"./MermaidExtension-LU-z_FW5.js";import"./vendor-mermaid-Cnq-YXE-.js";import"./Checkbox.vue_vue_type_script_setup_true_lang-jW0orlWc.js";function hn(m){const x=xs();de(()=>x.props?.flash,I=>{I&&(I.success&&z.success(I.success),I.error&&z.error(I.error))},{deep:!0,immediate:!0});const i=h(m.chapter.title||""),$=h(m.chapter.content||""),M=h(!0),{isDark:a,toggle:_}=_s(),f=C(()=>a.value),R=()=>{},w=()=>{_()},D=h(!1),k=h(!1),S=h(!1),g=h("write"),F=h(""),N=h(0),te=h(!1),J=h(!1),c=h(!0),d=()=>{try{return localStorage.getItem(`chatMode_${m.project.id}_${m.chapter.chapter_number}`)==="true"}catch(I){return console.warn("Failed to load chat mode from localStorage:",I),!1}},T=I=>{try{localStorage.setItem(`chatMode_${m.project.id}_${m.chapter.chapter_number}`,String(I))}catch(O){console.warn("Failed to save chat mode to localStorage:",O)}},se=h(!1),Y=h(!1),y=h(!1),A=h(!1),re=h(!1),Z=h(!0),ye=h(!0);return{chapterTitle:i,chapterContent:$,showPreview:M,isEditorDark:f,initChapterTheme:R,toggleChapterTheme:w,isNativeFullscreen:D,showAISidebar:k,showStatistics:S,activeTab:g,selectedText:F,cursorPosition:N,showChatMode:te,showCitationMode:J,showDefensePrep:c,loadChatModeFromStorage:d,saveChatModeToStorage:T,showLeftSidebar:se,showRightSidebar:Y,isMobile:y,isLeftSidebarCollapsed:A,isRightSidebarCollapsed:re,showLeftSidebarInFullscreen:Z,showRightSidebarInFullscreen:ye}}function vn({props:m,allChapters:x,targetWordCount:i,estimates:$,ensureBalance:M,save:a}){return{generateNextChapter:async()=>{const f=$.chapter(i.value||0);if(!M(f,"generate the next chapter with AI"))return;await a();const R=x.map(k=>k.chapter_number).sort((k,S)=>k-S),w=R.indexOf(m.chapter.chapter_number);let D;if(w===-1||w===R.length-1)D=Math.max(...R)+1;else{const k=R[w+1];k===m.chapter.chapter_number+1?D=k:D=m.chapter.chapter_number+1}try{const k=X("chapters.write",{project:m.project.slug,chapter:D}),S=new URL(k,window.location.origin);S.searchParams.set("ai_generate","true"),S.searchParams.set("generation_type","progressive"),V.visit(S.toString())}catch(k){console.error("âŒ Error generating next chapter:",k)}}}}function bn(m,x,i,$){const a=h(!1),_=h(0),f=h(!1),R=y=>{if(!y)return 0;const re=y.replace(/<[^>]*>/g,"").trim().replace(/\s+/g," ");if(!re)return 0;const Z=re.match(/\b\w+\b/g);return Z?Z.length:0},w=C(()=>R(i.value)),D=C(()=>w.value>=800),k=()=>`defense_generation_triggered_${m.id}_ch_${x.chapter_number}`,S=()=>{const y=k();return localStorage.getItem(y)==="true"},g=()=>{const y=k();localStorage.setItem(y,"true"),a.value=!0},F=()=>{const y=k();localStorage.removeItem(y),a.value=!1,console.log(`ðŸ”„ DEFENSE WATCHER: Reset generation trigger for Chapter ${x.chapter_number}`)},N=Tr(async()=>{if(!f.value)return;const y=w.value;console.log(`ðŸ“Š DEFENSE WATCHER: Word count check - Chapter ${x.chapter_number}: ${y} words`),y<800*.8&&a.value&&(console.log("â¬‡ï¸ DEFENSE WATCHER: Content dropped below 80% of threshold, resetting trigger"),F()),_.value=y},2e3),te=()=>f.value?void 0:(f.value=!0,a.value=S(),_.value=w.value,console.log(`ðŸ‘€ DEFENSE WATCHER: Started watching Chapter ${x.chapter_number}`),console.log(`   Initial word count: ${_.value}`),console.log(`   Generation already triggered: ${a.value}`),console.log("   Threshold: 800 words"),de(i,(A,re)=>{A!==re&&N()},{immediate:!1})),J=()=>{f.value=!1,N.cancel(),console.log(`ðŸ›‘ DEFENSE WATCHER: Stopped watching Chapter ${x.chapter_number}`)},c=async()=>{console.log(`ðŸ” DEFENSE WATCHER: Force checking Chapter ${x.chapter_number}`),await N(),N.flush()},d=C(()=>{const y=w.value;return y>0&&y<800&&!a.value}),T=C(()=>{const y=w.value/800*100;return Math.min(y,100)}),se=C(()=>{const y=800-w.value;return Math.max(y,0)});return{isWatching:f,hasTriggeredGeneration:a,currentWordCount:w,lastWordCount:_,meetsThreshold:D,shouldShowProgressIndicator:d,progressPercentage:T,wordsRemaining:se,startWatching:te,stopWatching:J,forceCheck:c,resetGenerationTrigger:F,markGenerationTriggered:g,getStatusMessage:()=>{const y=w.value;return a.value?`Defense questions available (${y} words)`:y>=800?`Ready for defense questions (${y} words)`:y>0?`${800-y} more words needed for defense questions`:"Start writing to enable defense questions (800 words needed)"},countWords:R,DEFENSE_WORD_COUNT_THRESHOLD:800}}function xn({props:m,chapterContent:x,currentWordCount:i,ensureBalance:$,estimates:M}){const a=h([]),_=h(!1),f=h(!1),R=h(null),w=h(!1),D=C(()=>m.chapter),{hasTriggeredGeneration:k,startWatching:S,stopWatching:g,forceCheck:F,getStatusMessage:N,markGenerationTriggered:te,meetsThreshold:J,shouldShowProgressIndicator:c,progressPercentage:d,wordsRemaining:T,DEFENSE_WORD_COUNT_THRESHOLD:se}=bn(m.project,m.chapter,x),Y=(j,L)=>`defense_auto_generate_${j}_ch_${L}`,y=()=>{try{return localStorage.getItem(Y(m.project.id,m.chapter.chapter_number))==="true"}catch(j){return console.warn("Failed to load defense auto-generation preference:",j),!1}},A=j=>{try{localStorage.setItem(Y(m.project.id,m.chapter.chapter_number),String(j))}catch(L){console.warn("Failed to save defense auto-generation preference:",L)}};w.value=y();const re=()=>{if(!a.value.length||!R.value)return!0;const j=new Date(Date.now()-360*60*1e3);return R.value<j},Z=async(j=!1,L={})=>{if(_.value)return;const q=L.skipGeneration??!0;_.value=!0;try{console.log("Loading defense questions with params:",{project_id:m.project.id,chapter_number:D.value?.chapter_number,limit:5,force_refresh:j,skip_generation:q});const E=await ie.get(`/api/projects/${m.project.id}/defense/questions`,{params:{chapter_number:D.value?.chapter_number||null,limit:5,force_refresh:j?1:0,skip_generation:q?1:0},headers:{Accept:"application/json","X-Requested-With":"XMLHttpRequest"}});if(console.log("Defense questions loaded:",E.data),a.value=E.data.questions||[],R.value=new Date,E.data.questions&&E.data.questions.length>0){const Q=`defense_questions_${m.project.id}_chapter_${D.value?.chapter_number}`;localStorage.setItem(Q,JSON.stringify({questions:E.data.questions,chapter_number:D.value?.chapter_number,loaded_at:new Date().toISOString()}))}else j||(console.log("No existing questions found for this chapter"),console.log(`Current word count: ${i.value}/${se}`),console.log('User must click "Generate Questions" button to create defense questions'))}catch(E){if(console.error("Failed to load defense questions:",E),E.response)if(console.error("Response status:",E.response.status),console.error("Response data:",E.response.data),E.response.status===422){const Q=Object.values(E.response.data.errors||{})[0];Q&&Array.isArray(Q)?z.error(`Validation Error: ${Q[0]}`):z.error("Invalid request parameters. Please refresh the page.")}else E.response.status===500?z.error("Server error. Please try again later."):z.error("Failed to load defense questions");else E.request?(console.error("No response received:",E.request),z.error("Network error. Please check your connection.")):(console.error("Error setting up request:",E.message),z.error("An unexpected error occurred"));a.value=[]}finally{_.value=!1}},ye=j=>j?j.replace(/<[^>]*>/g," ").trim().split(/\s+/).filter(L=>L.length>0).length:0,I=async(j={})=>{if(f.value)return;const L=j.autoTriggered??!1,q=M.defense();if($(q,"generate defense questions")){f.value=!0;try{const E=await ie.post(`/api/projects/${m.project.id}/defense/questions/generate`,{chapter_number:D.value.chapter_number},{headers:{"X-CSRF-TOKEN":document.querySelector('meta[name="csrf-token"]')?.getAttribute("content"),Accept:"application/json","Content-Type":"application/json"}});if(E.data&&E.data.questions){a.value=E.data.questions,R.value=new Date;const Q=E.data.questions.reduce((me,he)=>{const Te=ye(he.question),nt=ye(he.suggested_answer),Xe=(he.key_points||[]).reduce((ot,at)=>ot+ye(at),0);return me+Te+nt+Xe},0),fe=`defense_questions_${m.project.id}_chapter_${D.value?.chapter_number}`;localStorage.setItem(fe,JSON.stringify({questions:E.data.questions,chapter_number:D.value?.chapter_number,loaded_at:new Date().toISOString()})),z.success(`Generated ${E.data.questions.length} new questions`),en(Q||M.defense(),"Defense questions","chapter",m.chapter.id).catch(me=>console.error("Failed to record word usage (defense):",me)),k.value=!0,te(),L&&console.log("Auto-generated defense questions after meeting threshold.")}}catch(E){console.error("Failed to generate defense questions:",E),z.error("Failed to generate defense questions")}finally{f.value=!1}}},O=async()=>{!w.value||f.value||_.value||k.value||!J.value||a.value.length>0||await I({autoTriggered:!0})},ue=j=>{w.value=j,A(j),j&&O()},ge=async(j,L)=>{try{await ie.patch(`/api/projects/${m.project.id}/defense/questions/${j}`,{user_marked_helpful:L},{headers:{"X-CSRF-TOKEN":document.querySelector('meta[name="csrf-token"]')?.getAttribute("content"),Accept:"application/json","Content-Type":"application/json"}});const q=a.value.find(E=>E.id===j);q&&(q.user_marked_helpful=L),z.success(L?"Question marked as helpful":"Removed helpful mark")}catch(q){console.error("Failed to mark question:",q),z.error("Failed to update question")}},Ie=async j=>{try{await ie.delete(`/api/projects/${m.project.id}/defense/questions/${j}`,{headers:{"X-CSRF-TOKEN":document.querySelector('meta[name="csrf-token"]')?.getAttribute("content"),Accept:"application/json"}}),a.value=a.value.filter(L=>L.id!==j),localStorage.setItem(`defense_questions_${m.project.id}`,JSON.stringify({questions:a.value,loaded_at:new Date().toISOString()})),z.success("Question hidden")}catch(L){console.error("Failed to hide question:",L),z.error("Failed to hide question")}},Ve=async()=>{const j=`defense_questions_${m.project.id}_chapter_${D.value?.chapter_number}`,L=localStorage.getItem(j);let q=!0;if(L){const E=JSON.parse(L),Q=new Date(E.loaded_at),fe=new Date(Date.now()-360*60*1e3);Q>fe&&E.chapter_number===D.value?.chapter_number&&(a.value=E.questions,R.value=Q,q=!1)}q&&await Z(!1,{skipGeneration:!0})};return de(()=>m.chapter,async()=>{a.value=[],g(),S(),w.value=y(),await Z(!1,{skipGeneration:!0}),await Me(()=>{F(),O()})},{immediate:!1}),de([i,w],()=>{O()}),Pe(async()=>{await Ve(),S(),await Me(()=>{F(),O()})}),{defenseQuestions:a,isLoadingDefenseQuestions:_,isGeneratingDefenseQuestions:f,autoGenerateDefense:w,shouldLoadDefenseQuestions:re,loadDefenseQuestions:Z,generateNewDefenseQuestions:I,markQuestionHelpful:ge,hideQuestion:Ie,handleDefenseAutoToggle:ue,attemptAutoGenerateDefense:O,getDefenseStatusMessage:N,shouldShowDefenseProgress:c,defenseProgressPercentage:d,defenseWordsRemaining:T,hasTriggeredGeneration:k,meetsDefenseThreshold:J}}const wn={class:"flex items-center justify-between"},yn={class:"space-y-1 w-full max-w-[520px]"},_n={class:"flex items-center justify-between gap-3"},kn={class:"flex flex-col"},Cn={class:"flex items-center gap-2"},Sn={class:"flex items-center justify-between px-6 py-2 border-b border-border/30 bg-muted/5"},En={class:"flex items-center gap-2"},Tn={class:"space-y-1 relative z-10"},An={class:"text-sm font-medium text-foreground"},$n={class:"text-[10px] text-muted-foreground line-clamp-2 leading-relaxed"},Dn={class:"flex-1 relative bg-background"},jn={class:"px-12 py-10 min-h-[500px]"},zn={class:"sticky bottom-0 z-10 border-t border-border/30 bg-background/80 backdrop-blur-md p-4 flex items-center justify-between"},Rn={class:"text-xs text-muted-foreground"},Pn={class:"flex items-center gap-2"},vs=Ke({__name:"ChapterEditorPaperCard",props:{context:{}},setup(m){const i=m.context,$=C(()=>{const _=i.getSectionInfo(i.nextSection);return i.aiChapterAnalysis?.section||_}),M=C(()=>$.value?.name||""),a=C(()=>$.value?.description||"");return(_,f)=>(v(),P(e(oe),{class:"w-full max-w-[850px] min-h-[calc(100vh-180px)] flex flex-col bg-background shadow-xl shadow-black/5 ring-1 ring-black/5 dark:ring-white/10 rounded-xl overflow-hidden transition-all duration-300"},{default:n(()=>[r(e(le),{class:"flex-shrink-0 border-b border-border/30 px-8 py-6 bg-background/50 backdrop-blur-sm sticky top-0 z-10"},{default:n(()=>[s("div",wn,[s("div",yn,[s("div",_n,[s("div",kn,[r(e(an),{for:"chapter-title",class:"text-xs font-medium text-zinc-500 dark:text-zinc-400 uppercase tracking-wider"},{default:n(()=>[...f[3]||(f[3]=[l("Chapter Title",-1)])]),_:1}),r(e(on),{id:"chapter-title",modelValue:e(i).chapterTitle,"onUpdate:modelValue":f[0]||(f[0]=R=>e(i).chapterTitle=R),placeholder:"Enter chapter title...",class:"h-auto p-0 border-0 bg-transparent text-2xl font-bold placeholder:text-muted-foreground/40 focus-visible:ring-0 px-0 text-foreground"},null,8,["modelValue"])]),s("div",Cn,[r(e(je),{variant:e(i).chapter.status==="approved"?"default":"secondary",class:"rounded-full px-3"},{default:n(()=>[l(p(e(i).chapter.status.replace("_"," ")),1)]),_:1},8,["variant"]),r(e(je),{variant:"outline",class:Le(["rounded-full px-3 transition-colors",{"text-green-600 border-green-200 bg-green-50 dark:bg-green-900/20 dark:border-green-800":(e(i).latestAnalysis?.total_score||0)>=80,"text-yellow-600 border-yellow-200 bg-yellow-50 dark:bg-yellow-900/20 dark:border-yellow-800":(e(i).latestAnalysis?.total_score||0)>=70&&(e(i).latestAnalysis?.total_score||0)<80,"text-orange-600 border-orange-200 bg-orange-50 dark:bg-orange-900/20 dark:border-orange-800":(e(i).latestAnalysis?.total_score||0)>=60&&(e(i).latestAnalysis?.total_score||0)<70,"text-red-600 border-red-200 bg-red-50 dark:bg-red-900/20 dark:border-red-800":(e(i).latestAnalysis?.total_score||0)<60}])},{default:n(()=>[l(p(e(i).latestAnalysis?.total_score?Math.round(e(i).latestAnalysis.total_score):e(i).writingQualityScore)+"% Quality ",1)]),_:1},8,["class"])])])])])]),_:1}),r(e(ae),{class:"flex min-h-0 flex-1 flex-col p-0"},{default:n(()=>[s("div",Sn,[s("div",En,[r(e(b),{onClick:e(i).togglePresentationMode,variant:e(i).showPresentationMode?"default":"ghost",size:"sm",class:"h-7 text-xs rounded-full text-zinc-700 dark:text-zinc-300 hover:text-foreground"},{default:n(()=>[r(e(ws),{class:"mr-1.5 h-3.5 w-3.5"}),l(" "+p(e(i).showPresentationMode?"Edit":"Preview"),1)]),_:1},8,["onClick","variant"])]),s("div",Tn,[s("div",An,p(M.value),1),s("div",$n,p(a.value),1)])]),s("div",Dn,[Ne(r(ks,{modelValue:e(i).chapterContent,"onUpdate:modelValue":f[1]||(f[1]=R=>e(i).chapterContent=R),placeholder:"Start writing your chapter...","min-height":"500px",class:"min-h-[500px] px-8 py-6",ref:e(i).richTextEditor,"show-toolbar":!0,"streaming-mode":e(i).isStreamingMode,"is-generating":e(i).isGenerating,"generation-progress":e(i).generationProgress,"generation-percentage":e(i).generationPercentage,"generation-phase":e(i).generationPhase,"onUpdate:selectedText":e(i).setSelectedText},null,8,["modelValue","streaming-mode","is-generating","generation-progress","generation-percentage","generation-phase","onUpdate:selectedText"]),[[We,!e(i).showPresentationMode]]),Ne(s("div",jn,[r(Cs,{content:e(i).chapterContent,"show-font-controls":!1,class:"prose-lg mx-auto",style:{"font-family":"'Times New Roman', serif","line-height":"1.8"}},null,8,["content"])],512),[[We,e(i).showPresentationMode]])])]),_:1}),s("div",zn,[s("div",Rn,p(e(i).isSaving?"Saving...":"All changes saved"),1),s("div",Pn,[r(e(b),{onClick:f[2]||(f[2]=()=>e(i).save(!1)),disabled:!e(i).isValid||e(i).isSaving,size:"sm",variant:"ghost",class:"h-8 rounded-full text-zinc-700 dark:text-zinc-300 hover:text-foreground"},{default:n(()=>[r(e(xt),{class:"mr-2 h-3.5 w-3.5"}),f[4]||(f[4]=l(" Save Draft ",-1))]),_:1},8,["disabled"]),r(e(b),{onClick:e(i).goToBulkAnalysis,variant:"outline",size:"sm",class:"h-8 rounded-full"},{default:n(()=>[r(e(ys),{class:"mr-2 h-3.5 w-3.5"}),f[5]||(f[5]=l(" Run Bulk Analysis ",-1))]),_:1},8,["onClick"]),r(e(b),{onClick:e(i).markAsComplete,disabled:e(i).isSaving,size:"sm",class:"h-8 rounded-full bg-gradient-to-r from-primary to-primary/90 shadow-sm hover:shadow-md transition-all"},{default:n(()=>[r(e(st),{class:"mr-2 h-3.5 w-3.5"}),f[6]||(f[6]=l(" Complete ",-1))]),_:1},8,["onClick","disabled"])])])]),_:1}))}}),Fn=Ke({__name:"SelectLabel",props:{for:{},asChild:{type:Boolean},as:{},class:{}},setup(m){const x=m;return(i,$)=>(v(),P(e(Ar),{"data-slot":"select-label",class:Le(e(Jr)("px-2 py-1.5 text-sm font-medium",x.class))},{default:n(()=>[$r(i.$slots,"default")]),_:3},8,["class"]))}}),Mn={class:"flex flex-col gap-4 p-1"},Ln={class:"p-1.5 rounded-lg bg-primary/10 text-primary"},Nn={class:"flex items-center gap-2"},Wn={class:"space-y-3"},On={key:0,class:"space-y-2"},In={class:"flex items-center justify-between w-full relative z-10"},qn={class:"flex items-center gap-2 text-primary"},Gn={class:"space-y-1 relative z-10"},Bn={class:"text-sm font-medium text-foreground"},Hn={class:"text-[10px] text-muted-foreground line-clamp-2 leading-relaxed"},Un={key:0,class:"p-4 rounded-xl bg-green-500/10 border border-green-500/20 space-y-3"},Qn={class:"flex items-center gap-2 text-green-600 dark:text-green-400"},Kn={class:"space-y-2"},Vn={class:"flex justify-between text-[10px] font-medium text-muted-foreground"},Xn={class:"grid grid-cols-2 gap-2 mt-2"},Jn={class:"p-1.5 rounded-full bg-blue-500/10 text-blue-500"},Yn={class:"p-1.5 rounded-full bg-purple-500/10 text-purple-500"},Zn={class:"p-1.5 rounded-full bg-orange-500/10 text-orange-500"},eo={class:"p-1.5 rounded-full bg-emerald-500/10 text-emerald-500"},to={class:"p-1.5 rounded-full bg-amber-500/10 text-amber-500"},so={class:"flex items-center gap-2"},ro={class:"p-1"},no=Ke({__name:"AISidebar",props:{project:{},chapter:{},isGenerating:{type:Boolean},selectedText:{},isLoadingSuggestions:{type:Boolean},showCitationHelper:{type:Boolean},chapterContent:{},cursorPosition:{},currentWordCount:{},targetWordCount:{},canUndo:{type:Boolean}},emits:["startStreamingGeneration","getAISuggestions","update:showCitationHelper","insert-citation","checkCitations","undoLastAction"],setup(m,{emit:x}){const i=m,$=x,M=h(i.project.settings?.writing_style||"Auto"),a=h(null),_=h(!1),f=h({expand:!1,improve:!1,rephrase:!1,cite:!1,"generate-full":!1,"generate-section":!1,custom:!1});de(M,async c=>{try{await ie.patch(route("projects.update",i.project.slug),{settings:{...i.project.settings||{},writing_style:c}}),z.success("Writing style saved")}catch(d){console.error("Failed to save writing style:",d),z.error("Failed to save preferences")}});const R=C(()=>!!i.chapter?.id&&!!i.chapter?.chapter_number),w=C(()=>i.chapterContent&&i.chapterContent.trim().length>0);C(()=>!w.value&&R.value),C(()=>!a.value&&R.value);const D=C(()=>!i.isGenerating&&!!i.chapterContent);C(()=>!i.isLoadingSuggestions&&!!i.selectedText);const k=C(()=>a.value&&a.value.section.name!=="NONE"?a.value.section.name.toLowerCase().replace(/\s+/g,"_"):N()),S=C(()=>!i.isGenerating&&!!i.chapter?.id),g=()=>[{id:"introduction",name:"Introduction",description:"Overview and objectives of this chapter"},{id:"content",name:"Main Content",description:"Chapter main content"},{id:"conclusion",name:"Conclusion",description:"Summary and transition to next chapter"}],F=async(c,d)=>{if(Object.values(f.value).some(T=>T)){z("Please wait for the current action to complete");return}try{switch(c in f.value&&(f.value[c]=!0),c){case"expand":i.selectedText?($("startStreamingGeneration","expand",{selectedText:i.selectedText,style:M.value}),z("Expanding selected text...")):z.error("Please select text to expand");break;case"improve":$("startStreamingGeneration","improve",{style:M.value}),z("Improving chapter content...");break;case"rephrase":i.selectedText?($("startStreamingGeneration","rephrase",{selectedText:i.selectedText,style:M.value}),z("Rephrasing selected text...")):z.error("Please select text to rephrase");break;case"cite":$("update:showCitationHelper",!0),z("Opening citation helper...");break;case"generate-full":$("startStreamingGeneration","progressive"),z("Generating complete chapter...");break;case"generate-section":const T=d?.section||k.value;$("startStreamingGeneration","section",{section:T,mode:"progressive"}),z(`Generating ${T} section...`);break;default:throw new Error(`Unknown action: ${c}`)}}catch(T){console.error(`Quick action '${c}' failed:`,T),z.error(`Failed to ${c.replace("-"," ")}. Please try again.`)}finally{setTimeout(()=>{c in f.value&&(f.value[c]=!1)},1e3)}},N=()=>{if(!w.value)return"introduction";const c=i.chapterContent.toLowerCase(),d=g();for(const T of d)if(![T.name.toLowerCase(),T.id.replace("_"," ")].some(y=>c.includes(y)))return T.id;return"conclusion"},te=c=>{const d=g();return d.find(T=>T.id===c)||d[0]},J=c=>{$("insert-citation",c)};return de(()=>i.chapter,c=>{c?.id&&(a.value=null)},{immediate:!1}),de(()=>i.chapterContent,c=>{a.value&&(!c||c.trim().length===0)&&(a.value=null)},{immediate:!1}),(c,d)=>(v(),W("div",Mn,[r(e(oe),{class:"border-none shadow-none bg-transparent"},{default:n(()=>[r(e(le),{class:"px-2 py-3"},{default:n(()=>[r(e(pe),{class:"flex items-center gap-2 text-sm font-semibold text-foreground/80"},{default:n(()=>[s("div",Ln,[r(e(Fe),{class:"h-4 w-4"})]),d[9]||(d[9]=l(" AI Assistant ",-1))]),_:1})]),_:1}),r(e(ae),{class:"px-2 space-y-6"},{default:n(()=>[r(e(fs),{open:!0,class:"space-y-2"},{default:n(()=>[r(e(ms),{class:"flex w-full items-center justify-between text-xs font-medium text-muted-foreground hover:text-foreground transition-colors group"},{default:n(()=>[s("span",Nn,[r(e(Dr),{class:"h-3.5 w-3.5 text-amber-500/70 group-hover:text-amber-500 transition-colors"}),d[10]||(d[10]=l(" QUICK ACTIONS ",-1))]),r(e(Ht),{class:"h-3 w-3 transition-transform duration-200 group-data-[state=open]:rotate-180"})]),_:1}),r(e(hs),{class:"space-y-3 pt-1"},{default:n(()=>[s("div",Wn,[r(Oe,{"enter-active-class":"transition-all duration-300 ease-out","enter-from-class":"opacity-0 scale-95 translate-y-1","enter-to-class":"opacity-100 scale-100 translate-y-0"},{default:n(()=>[a.value&&a.value.show_section_button?(v(),W("div",On,[r(e(b),{onClick:d[0]||(d[0]=T=>F("generate-section")),disabled:!S.value||_.value||c.isGenerating||f.value["generate-section"],variant:"outline",class:"w-full h-auto flex-col items-start gap-2 p-3 rounded-xl border-primary/20 bg-background/50 hover:bg-primary/5 hover:border-primary/40 transition-all duration-300 text-left group relative overflow-hidden"},{default:n(()=>[d[12]||(d[12]=s("div",{class:"absolute inset-0 bg-gradient-to-r from-primary/5 to-transparent opacity-0 group-hover:opacity-100 transition-opacity"},null,-1)),s("div",In,[s("div",qn,[r(e(Ut),{class:"h-3.5 w-3.5"}),d[11]||(d[11]=s("span",{class:"text-xs font-semibold"},"Write Next Section",-1))]),f.value["generate-section"]?(v(),P(e(rt),{key:0,class:"h-3 w-3 animate-spin text-primary"})):U("",!0)]),s("div",Gn,[s("div",Bn,p(a.value?.section.name||te(k.value).name),1),s("div",Hn,p(a.value?.section.description||te(k.value).description),1)])]),_:1},8,["disabled"])])):U("",!0)]),_:1}),r(Oe,{"enter-active-class":"transition-all duration-300 ease-out","enter-from-class":"opacity-0 scale-95 translate-y-1","enter-to-class":"opacity-100 scale-100 translate-y-0"},{default:n(()=>[a.value&&a.value.show_full_chapter_button?(v(),P(e(b),{key:0,onClick:d[1]||(d[1]=T=>F("generate-full")),disabled:c.isGenerating||_.value||f.value["generate-full"],variant:"ghost",class:"w-full h-9 justify-start gap-2 px-3 rounded-lg text-xs text-muted-foreground hover:text-primary hover:bg-primary/5"},{default:n(()=>[r(e(jr),{class:"h-3.5 w-3.5"}),d[13]||(d[13]=s("span",null,"Generate Complete Chapter",-1))]),_:1},8,["disabled"])):U("",!0)]),_:1}),r(Oe,{"enter-active-class":"transition-all duration-500 ease-out","enter-from-class":"opacity-0 scale-95 translate-y-2","enter-to-class":"opacity-100 scale-100 translate-y-0"},{default:n(()=>[a.value&&a.value.status==="COMPLETE"?(v(),W("div",Un,[s("div",Qn,[r(e(zr),{class:"h-4 w-4"}),d[14]||(d[14]=s("span",{class:"text-sm font-semibold"},"Chapter Complete",-1))]),s("div",Kn,[s("div",Vn,[d[15]||(d[15]=s("span",null,"Progress",-1)),s("span",null,p(a.value.completion_percentage)+"%",1)]),r(e(ln),{"model-value":a.value.completion_percentage,class:"h-1.5"},null,8,["model-value"])])])):U("",!0)]),_:1})]),s("div",Xn,[r(e(b),{onClick:d[2]||(d[2]=T=>F("improve")),disabled:!D.value||c.isGenerating||f.value.improve,variant:"outline",class:"h-20 flex-col gap-2 rounded-xl border-border/50 bg-background/50 hover:bg-accent hover:border-accent transition-all duration-300"},{default:n(()=>[s("div",Jn,[r(e(Rr),{class:"h-4 w-4"})]),d[16]||(d[16]=s("span",{class:"text-xs font-medium"},"Improve",-1))]),_:1},8,["disabled"]),r(e(b),{onClick:d[3]||(d[3]=T=>F("expand")),disabled:!c.selectedText||c.isGenerating||f.value.expand,variant:"outline",class:"h-20 flex-col gap-2 rounded-xl border-border/50 bg-background/50 hover:bg-accent hover:border-accent transition-all duration-300"},{default:n(()=>[s("div",Yn,[r(e(Pr),{class:"h-4 w-4"})]),d[17]||(d[17]=s("span",{class:"text-xs font-medium"},"Expand",-1))]),_:1},8,["disabled"]),r(e(b),{onClick:d[4]||(d[4]=T=>F("cite")),disabled:c.isGenerating||f.value.cite,variant:"outline",class:"h-20 flex-col gap-2 rounded-xl border-border/50 bg-background/50 hover:bg-accent hover:border-accent transition-all duration-300"},{default:n(()=>[s("div",Zn,[r(e(Fr),{class:"h-4 w-4"})]),d[18]||(d[18]=s("span",{class:"text-xs font-medium"},"Cite",-1))]),_:1},8,["disabled"]),r(e(b),{onClick:d[5]||(d[5]=T=>F("rephrase")),disabled:!c.selectedText||c.isGenerating||f.value.rephrase,variant:"outline",class:"h-20 flex-col gap-2 rounded-xl border-border/50 bg-background/50 hover:bg-accent hover:border-accent transition-all duration-300"},{default:n(()=>[s("div",eo,[r(e(Mr),{class:"h-4 w-4"})]),d[19]||(d[19]=s("span",{class:"text-xs font-medium"},"Rephrase",-1))]),_:1},8,["disabled"]),c.canUndo?(v(),P(e(b),{key:0,onClick:d[6]||(d[6]=T=>$("undoLastAction")),variant:"outline",class:"h-20 flex-col gap-2 rounded-xl border-border/50 bg-background/50 hover:bg-amber-500/10 hover:border-amber-500/30 transition-all duration-300 col-span-2"},{default:n(()=>[s("div",to,[r(e(Lr),{class:"h-4 w-4"})]),d[20]||(d[20]=s("span",{class:"text-xs font-medium"},"Undo Last AI Change",-1))]),_:1})):U("",!0)])]),_:1})]),_:1}),r(e(Qe),{class:"bg-border/50"}),r(e(fs),{open:!0,class:"space-y-2"},{default:n(()=>[r(e(ms),{class:"flex w-full items-center justify-between text-xs font-medium text-muted-foreground hover:text-foreground transition-colors group"},{default:n(()=>[s("span",so,[r(e(Ut),{class:"h-3.5 w-3.5 text-indigo-500/70 group-hover:text-indigo-500 transition-colors"}),d[21]||(d[21]=l(" WRITING STYLE ",-1))]),r(e(Ht),{class:"h-3 w-3 transition-transform duration-200 group-data-[state=open]:rotate-180"})]),_:1}),r(e(hs),{class:"pt-1"},{default:n(()=>[s("div",ro,[r(e(dn),{modelValue:M.value,"onUpdate:modelValue":d[7]||(d[7]=T=>M.value=T)},{default:n(()=>[r(e(un),{class:"w-full bg-muted/30 border-border/50 text-xs font-medium h-9"},{default:n(()=>[r(e(cn),{placeholder:"Select style"})]),_:1}),r(e(pn),null,{default:n(()=>[r(e(gn),null,{default:n(()=>[r(e(Fn),{class:"text-[10px] text-muted-foreground uppercase tracking-wider"},{default:n(()=>[...d[22]||(d[22]=[l(" Style Preference",-1)])]),_:1}),r(e(Re),{value:"Auto"},{default:n(()=>[...d[23]||(d[23]=[s("div",{class:"flex flex-col gap-0.5"},[s("span",{class:"font-medium"},"Auto (AI Decides)"),s("span",{class:"text-[10px] text-muted-foreground"},"Best fit for the content")],-1)])]),_:1}),r(e(Re),{value:"Academic Formal"},{default:n(()=>[...d[24]||(d[24]=[l("Academic Formal",-1)])]),_:1}),r(e(Re),{value:"Academic Casual"},{default:n(()=>[...d[25]||(d[25]=[l("Academic Casual",-1)])]),_:1}),r(e(Re),{value:"Technical"},{default:n(()=>[...d[26]||(d[26]=[l("Technical",-1)])]),_:1}),r(e(Re),{value:"Analytical"},{default:n(()=>[...d[27]||(d[27]=[l("Analytical",-1)])]),_:1}),r(e(Re),{value:"Research-Heavy"},{default:n(()=>[...d[28]||(d[28]=[l("Research-Heavy",-1)])]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"])])]),_:1})]),_:1})]),_:1})]),_:1}),r(fn,{"show-citation-helper":c.showCitationHelper,"chapter-content":c.chapterContent,"chapter-id":c.chapter?.id||0,"onUpdate:showCitationHelper":d[8]||(d[8]=T=>$("update:showCitationHelper",T)),onInsertCitation:J},null,8,["show-citation-helper","chapter-content","chapter-id"])]))}}),oo=Ss(no,[["__scopeId","data-v-e30bcf5b"]]),ao={class:"h-14 flex items-center justify-between px-4 border-b border-border/40 shrink-0"},lo={class:"flex-1 overflow-y-auto custom-scrollbar"},io={class:"p-4 space-y-6"},bs=Ke({__name:"ChapterEditorRightSidebar",props:{project:{},chapter:{},isGenerating:{type:Boolean},selectedText:{},isLoadingSuggestions:{type:Boolean},showCitationHelper:{type:Boolean},chapterContent:{},currentWordCount:{},targetWordCount:{},handleAIGeneration:{type:Function},getAISuggestions:{type:Function},updateCitationHelper:{type:Function},insertCitation:{type:Function},checkCitations:{type:Function},showDefensePrep:{type:Boolean},defenseQuestions:{},isLoadingDefenseQuestions:{type:Boolean},isGeneratingDefenseQuestions:{type:Boolean},chapterContext:{},defenseWatcher:{},autoGenerateDefense:{type:Boolean},handleDefensePanelToggle:{type:Function},generateNewDefenseQuestions:{type:Function},handleDefenseAutoToggle:{type:Function},refreshDefenseQuestions:{type:Function},markQuestionHelpful:{type:Function},hideQuestion:{type:Function},isCollapsed:{type:Boolean},containerClass:{}},setup(m){const x=m;return(i,$)=>Ne((v(),W("aside",{class:Le(x.containerClass)},[s("div",ao,[$[1]||($[1]=s("span",{class:"text-sm font-semibold tracking-tight text-foreground"},"Writing Assistant",-1)),r(e(H),null,{default:n(()=>[r(e(G),{asChild:""},{default:n(()=>[r(e(b),{variant:"ghost",size:"icon",class:"h-7 w-7"},{default:n(()=>[r(e(ys),{class:"h-3.5 w-3.5"})]),_:1})]),_:1}),r(e(B),null,{default:n(()=>[...$[0]||($[0]=[l("Manage Citations",-1)])]),_:1})]),_:1})]),s("div",lo,[s("div",io,[r(oo,{project:x.project,chapter:x.chapter,"is-generating":x.isGenerating,"selected-text":x.selectedText,"is-loading-suggestions":x.isLoadingSuggestions,"show-citation-helper":x.showCitationHelper,"chapter-content":x.chapterContent,"current-word-count":x.currentWordCount,"target-word-count":x.targetWordCount,onStartStreamingGeneration:x.handleAIGeneration,onGetAiSuggestions:x.getAISuggestions,"onUpdate:showCitationHelper":x.updateCitationHelper,onInsertCitation:x.insertCitation,onCheckCitations:x.checkCitations},null,8,["project","chapter","is-generating","selected-text","is-loading-suggestions","show-citation-helper","chapter-content","current-word-count","target-word-count","onStartStreamingGeneration","onGetAiSuggestions","onUpdate:showCitationHelper","onInsertCitation","onCheckCitations"])])])],2)),[[We,!x.isCollapsed]])}});function uo(m){const x=h({sentences:0,paragraphs:0,readingTime:0,avgWordLength:0,uniqueWords:0,commonWords:[]}),i=C(()=>m.value?m.value.split(/\s+/).filter(a=>a.length>0).length:0),$=()=>{if(!m.value){x.value={sentences:0,paragraphs:0,readingTime:0,avgWordLength:0,uniqueWords:0,commonWords:[]};return}const a=m.value,_=a.split(/\s+/).filter(S=>S.length>0),f=a.split(/[.!?]+/).filter(S=>S.trim().length>0),R=a.split(`

`).filter(S=>S.trim().length>0),w=new Map;_.forEach(S=>{const g=S.toLowerCase().replace(/[^a-z0-9]/g,"");g&&w.set(g,(w.get(g)||0)+1)});const D=new Set(["the","a","an","and","or","but","in","on","at","to","for","of","with","by","is","was","are","were"]),k=Array.from(w.entries()).filter(([S])=>!D.has(S)).sort((S,g)=>g[1]-S[1]).slice(0,5).map(([S])=>S);x.value={sentences:f.length,paragraphs:R.length,readingTime:Math.ceil(_.length/200),avgWordLength:_.reduce((S,g)=>S+g.length,0)/_.length,uniqueWords:w.size,commonWords:k}},M=C(()=>{if(!m.value)return 0;let a=0;const _=m.value;_.includes("##")&&(a+=20),_.length>1e3&&(a+=20),_.match(/\[.*?\]/g)&&(a+=15),(_.includes("**")||_.includes("*"))&&(a+=10);const f=_.split(/[.!?]+/).filter(w=>w.trim().length>0);if(f.length>0){const w=f.reduce((D,k)=>D+k.split(/\s+/).length,0)/f.length;w>10&&w<25&&(a+=20)}return _.split(`

`).filter(w=>w.trim().length>0).length>3&&(a+=15),Math.min(a,100)});return{writingStats:x,currentWordCount:i,writingQualityScore:M,calculateWritingStats:$}}function co(m){const x=h(!1),i=h(null),$=h([]),M=h(null),a=C(()=>{if(!i.value?.quality_level)return"text-muted-foreground";switch(i.value.quality_level){case"Excellent":return"text-green-600";case"Good":return"text-blue-600";case"Satisfactory":return"text-yellow-600";case"Needs Improvement":return"text-orange-600";case"Poor":return"text-red-600";default:return"text-muted-foreground"}}),_=C(()=>i.value?.scores?Object.entries(i.value.scores).sort(([,g],[,F])=>g.percentage-F.percentage).slice(0,3).map(([g,F])=>({category:g.replace(" & "," & "),percentage:Math.round(F.percentage),score:F.score,max:F.max})):[]),f=async()=>{try{x.value=!0,M.value=null,await ie.get("/sanctum/csrf-cookie");const g=await ie.post(X("api.chapters.analysis.analyze",{chapter:m}));if(g.data.success)return i.value=g.data.analysis,g.data.analysis;throw new Error(g.data.error||"Analysis failed")}catch(g){return M.value=g.response?.data?.error||g.message||"Analysis failed",console.error("Chapter analysis failed:",g),null}finally{x.value=!1}};return{isAnalyzing:x,latestAnalysis:i,analysisHistory:$,error:M,qualityLevelColor:a,topImprovementAreas:_,analyzeChapter:f,getLatestAnalysis:async()=>{try{await ie.get("/sanctum/csrf-cookie");const g=await ie.get(X("api.chapters.analysis.latest",{chapter:m}));return g.data.success?(i.value=g.data.analysis,g.data.analysis):(i.value=null,null)}catch(g){return g.response?.status!==404&&(M.value=g.response?.data?.error||g.message||"Failed to get analysis",console.error("Failed to get latest analysis:",g)),null}},getAnalysisHistory:async()=>{try{await ie.get("/sanctum/csrf-cookie");const g=await ie.get(X("api.chapters.analysis.history",{chapter:m}));if(g.data.success)return $.value=g.data.analyses,g.data.analyses;throw new Error(g.data.error||"Failed to get history")}catch(g){return M.value=g.response?.data?.error||g.message||"Failed to get analysis history",console.error("Failed to get analysis history:",g),[]}},autoAnalyze:async(g,F=500)=>{g>=F&&await f()},getScoreColor:(g,F)=>{const N=g/F*100;return N>=80?"text-green-600":N>=70?"text-blue-600":N>=60?"text-yellow-600":N>=40?"text-orange-600":"text-red-600"},getProgressVariant:g=>g>=80?"success":g>=60?"default":"destructive"}}const po={key:0,class:"min-h-screen bg-background text-foreground"},go={class:"mx-auto max-w-5xl p-6"},fo={class:"flex items-center justify-between gap-4"},mo={class:"flex items-center gap-3"},ho={class:"mt-6 grid gap-4"},vo={class:"flex flex-wrap gap-x-6 gap-y-1"},bo={class:"grid gap-1"},xo={class:"grid gap-1"},wo={class:"grid gap-4 md:grid-cols-3"},yo={class:"mx-auto w-full max-w-5xl p-6"},_o={class:"flex items-center justify-between gap-4"},ko={class:"flex items-center gap-3"},Co={class:"mt-6 grid gap-4"},So={class:"flex flex-wrap gap-x-6 gap-y-1"},Eo={class:"grid gap-1"},To={class:"grid gap-1"},Ao={class:"grid gap-4 md:grid-cols-3"},$o={key:0,class:"rounded-xl border border-border bg-card p-4"},Do={key:2,class:"flex h-screen flex-col overflow-hidden bg-background dark:bg-background font-sans selection:bg-primary/20 transition-colors duration-300"},jo={class:"relative z-20 flex flex-shrink-0 items-center justify-between border-b border-border/40 bg-background/60 p-4 backdrop-blur-xl supports-[backdrop-filter]:bg-background/40 transition-all duration-300"},zo={class:"flex items-center gap-5"},Ro={class:"flex flex-col"},Po={class:"text-lg font-bold tracking-tight text-foreground/90 font-display"},Fo={class:"flex items-center gap-3 text-xs text-muted-foreground"},Mo={class:"flex items-center gap-1.5"},Lo={class:"flex items-center gap-4"},No={class:"flex items-center p-1 rounded-full border border-border/40 bg-background/50 backdrop-blur-sm shadow-sm"},Wo={class:"flex items-center gap-2"},Oo={class:"relative z-20 h-[2px] w-full bg-border/20"},Io={key:0,class:"mx-3 my-2"},qo={class:"relative overflow-hidden rounded-xl border border-blue-200 bg-gradient-to-br from-blue-50 to-purple-50 p-3 shadow-sm dark:border-blue-800 dark:from-blue-950/30 dark:to-purple-950/30"},Go={class:"relative z-10 mb-2 flex items-center justify-between"},Bo={class:"flex items-center gap-2"},Ho={class:"relative"},Uo={class:"flex h-6 w-6 items-center justify-center rounded-full bg-gradient-to-br from-blue-500 to-purple-600"},Qo={class:"text-[10px] text-indigo-700 dark:text-indigo-300 font-medium tracking-wide uppercase"},Ko={class:"flex items-center gap-2"},Vo={class:"relative z-10 mb-2"},Xo={class:"mb-1.5 flex items-center justify-between"},Jo={class:"text-[10px] tabular-nums text-indigo-600 dark:text-indigo-400 font-mono"},Yo={class:"relative h-1.5 overflow-hidden rounded-full bg-indigo-100 dark:bg-indigo-950/50"},Zo={class:"relative z-10 flex items-center gap-2.5 bg-indigo-50 dark:bg-indigo-900/20 p-2 rounded-lg border border-indigo-100 dark:border-indigo-800/30"},ea={class:"flex-shrink-0"},ta={key:0,class:"h-2 w-2 animate-bounce rounded-full bg-blue-500"},sa={key:1,class:"flex gap-0.5"},ra={key:2,class:"h-2 w-2 animate-spin rounded-full border-2 border-blue-500 border-t-transparent"},na={key:3,class:"h-2 w-2 rounded-full bg-green-500"},oa={key:4,class:"h-2 w-2 rounded-full bg-red-500"},aa={class:"flex-1 text-xs text-blue-800 dark:text-blue-200"},la={class:"relative z-10 flex flex-1 overflow-hidden"},ia={key:0,class:"w-[320px] flex-shrink-0 border-r border-border/50 bg-background/80 backdrop-blur-xl shadow-xl z-20"},da={class:"h-full overflow-y-auto custom-scrollbar"},ua={class:"p-4"},ca={class:"mb-3"},pa={class:"text-xs text-muted-foreground"},ga={class:"flex min-h-0 flex-1 flex-col bg-transparent relative"},fa={class:"flex-1 overflow-hidden relative"},ma={"data-editor-scroll-container":"",class:"absolute inset-0 overflow-y-auto custom-scrollbar flex flex-col items-center py-8 px-4 sm:px-8"},ha={class:"flex h-full w-full overflow-hidden relative"},va={id:"left-sidebar-panel",class:"hidden lg:flex w-80 flex-col border-r border-border/40 bg-background/60 backdrop-blur-xl z-20 transition-all duration-300"},ba={class:"h-14 flex items-center justify-between px-4 border-b border-border/40 shrink-0"},xa={class:"p-4"},wa={class:"flex-1 flex flex-col relative z-10 min-w-0 bg-background/30 dark:bg-background transition-all duration-300"},ya={class:"md:hidden flex flex-wrap items-start justify-between border-b border-border/40 bg-background/60 backdrop-blur-md px-4 py-3 relative z-30 transition-all duration-300 gap-y-2"},_a={class:"flex items-center gap-2 flex-shrink-0 order-1"},ka={class:"flex items-center order-2"},Ca={class:"order-3 w-full flex flex-col gap-3"},Sa={class:"flex items-start gap-3 w-full min-w-0"},Ea={class:"flex items-center gap-2 justify-between mt-1"},Ta={class:"flex items-center gap-2"},Aa={class:"flex items-center gap-2"},$a={key:0,class:"inline"},Da={class:"hidden md:flex flex-col w-full z-30 bg-background/60 backdrop-blur-md transition-all duration-300 relative"},ja={class:"h-10 border-b border-border/40 flex items-left justify-left px-4 bg-background/40"},za={class:"flex items-left gap-3"},Ra=["innerHTML"],Pa={class:"h-12 border-b border-border/40 flex items-center justify-between px-4 gap-3 bg-muted/10"},Fa={class:"flex items-center gap-1"},Ma={class:"flex items-center gap-3"},La={id:"view-controls",class:"flex items-center bg-background/50 rounded-full border border-border/50 p-1 backdrop-blur-sm shadow-sm"},Na={class:"hidden xl:inline"},Wa={class:"hidden xl:inline"},Oa={class:"flex items-center gap-2"},Ia={class:"flex items-center gap-2 pl-2 border-l border-border/50"},qa={class:"inline"},Ga={class:"flex-1 overflow-hidden relative group bg-background/20"},Ba={key:0,class:"absolute top-8 left-0 right-0 z-40 px-4 flex justify-center pointer-events-none"},Ha={class:"w-full max-w-md pointer-events-auto"},Ua={class:"group relative overflow-hidden rounded-2xl border border-white/20 bg-white/80 dark:bg-zinc-900/80 p-5 shadow-2xl backdrop-blur-xl transition-all duration-300 dark:border-white/10 ring-1 ring-black/5 dark:ring-white/5"},Qa={class:"relative flex items-center gap-4"},Ka={class:"relative flex-shrink-0"},Va={class:"h-10 w-10 rounded-full bg-gradient-to-br from-blue-600 to-purple-600 flex items-center justify-center shadow-lg shadow-blue-500/20 z-10 relative"},Xa={class:"flex-1 min-w-0"},Ja={class:"flex items-center justify-between mb-2"},Ya={class:"text-xs font-mono font-bold text-primary bg-primary/10 px-2 py-0.5 rounded-md border border-primary/20"},Za={class:"h-1.5 w-full bg-zinc-200 dark:bg-zinc-800 rounded-full overflow-hidden backdrop-blur-sm"},el={class:"mt-2.5 flex items-center justify-between"},tl={class:"text-[10px] font-medium text-muted-foreground truncate max-w-[200px] flex items-center gap-1.5"},sl={class:"mx-auto py-12 px-6 sm:px-10 min-h-full"},rl={class:"min-h-[600px] pb-32"},nl={class:"pb-32"},ol={id:"editor-footer",class:"h-10 border-t border-border/30 bg-background/40 backdrop-blur-sm flex items-center justify-between px-4 text-[10px] text-muted-foreground shrink-0 relative"},al={class:"hidden sm:flex items-center gap-3"},ll={class:"hidden md:inline"},il={class:"absolute left-1/2 -translate-x-1/2 flex items-center bg-background/50 rounded-full border border-border/40 p-0.5 shadow-sm"},dl={class:"px-3 font-bold text-[11px] min-w-[80px] text-center border-l border-r border-border/40 text-foreground/80"},ul={class:"hidden sm:flex items-center gap-2"},cl={key:0,class:"text-green-500 flex items-center gap-1 ml-2"},pl={class:"flex items-center gap-3 mb-2"},gl={class:"w-10 h-10 rounded-full bg-amber-500/20 flex items-center justify-center"},fl={class:"list-disc list-inside text-muted-foreground space-y-1 ml-2"},ml={key:0,class:"fixed inset-0 bg-black/50 flex items-center justify-center z-50"},hl={class:"text-slate-600 dark:text-slate-300 mb-4"},vl={class:"font-semibold text-amber-600 dark:text-amber-400"},bl={class:"flex flex-col sm:flex-row gap-3"},xl=1e3,wl=Ke({__name:"ChapterEditor",props:{project:{},chapter:{},allChapters:{},facultyChapters:{},mode:{}},setup(m){const x=et(()=>tt(()=>import("./ChapterNavigation-KvF70jhW.js"),__vite__mapDeps([0,1,2,3,4,5,6,7]))),i=et(()=>tt(()=>import("./MobileNavOverlay-BSxr3AXw.js"),__vite__mapDeps([8,3,4,9,2,1,5,6,7,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48]))),$=et(()=>tt(()=>import("./ChatModeLayout-Cz0Asvi_.js"),__vite__mapDeps([49,3,4,7,2,11,14,5,37,17,42,38,39,40,43,9,34,29,30,31,32,36,35,22,41,50]))),M=et(()=>tt(()=>import("./CitationVerificationLayout-Baj3tyZB.js"),__vite__mapDeps([51,7,3,4,2,11,12,14,5,52,42,37,38,39,17,40,43]))),a=m,_=xs(),f=h(null),R=h(null),w=h(!1),D=h(!1),k=h(null),S=h(!1),g=h(!1),F=h(!1),N=h(0);if(typeof window<"u"){const o=new URLSearchParams(window.location.search);g.value=o.has("theme_sandbox"),F.value=o.get("theme_sandbox")==="nolayout"||o.has("theme_sandbox_nolayout");const t=o.get("theme_sandbox_step"),u=t?Number.parseInt(t,10):0;N.value=Number.isFinite(u)?u:0}const{appearance:te,isDark:J}=_s(),c=h({htmlHasDark:!1,background:"",foreground:"",card:"",sidebarBackground:"",bodyBg:"",insetBg:"",sampleBgBackground:"",sampleBgCard:"",sampleBgMuted:""}),d=h(null),T=h(null),se=h(null);function Y(){if(typeof window>"u")return;const o=document.documentElement,t=window.getComputedStyle(o),u=document.querySelector('[data-slot="sidebar-inset"]'),K=u?window.getComputedStyle(u).backgroundColor:"";c.value={htmlHasDark:o.classList.contains("dark"),background:t.getPropertyValue("--background").trim(),foreground:t.getPropertyValue("--foreground").trim(),card:t.getPropertyValue("--card").trim(),sidebarBackground:t.getPropertyValue("--sidebar-background").trim(),bodyBg:window.getComputedStyle(document.body).backgroundColor,insetBg:K,sampleBgBackground:d.value?window.getComputedStyle(d.value).backgroundColor:"",sampleBgCard:T.value?window.getComputedStyle(T.value).backgroundColor:"",sampleBgMuted:se.value?window.getComputedStyle(se.value).backgroundColor:""}}const{chapterTitle:y,chapterContent:A,showPreview:re,isEditorDark:Z,initChapterTheme:ye,toggleChapterTheme:I,isNativeFullscreen:O,selectedText:ue,showChatMode:ge,showCitationMode:Ie,showDefensePrep:Ve,loadChatModeFromStorage:j,saveChatModeToStorage:L,showLeftSidebar:q,showRightSidebar:E,isMobile:Q,isLeftSidebarCollapsed:fe,isRightSidebarCollapsed:me,showLeftSidebarInFullscreen:he,showRightSidebarInFullscreen:Te}=hn(a),{balance:nt,showPurchaseModal:Xe,requiredWordsForModal:ot,actionDescriptionForModal:at,checkAndPrompt:Es,closePurchaseModal:Ts,estimates:lt}=tn(),it=(o,t)=>Es(Math.max(1,Math.round(o)),t),{hasUnsavedChanges:As,isSaving:ve,triggerAutoSave:qe,save:_e,clearAutoSave:$s}=sn({delay:1e4,onSave:Ft});let wt=0;const Ds=()=>{const o=Date.now();o-wt>xl&&(wt=o,z.success("Saved",{duration:2e3}))},{contentHistory:js,historyIndex:zs,addToHistory:Rs,undo:Ps,redo:Fs}=mn(a.chapter.content||""),{writingStats:yt,writingQualityScore:ke,calculateWritingStats:dt}=uo(A),{isAnalyzing:Ms,latestAnalysis:Ls,getLatestAnalysis:Ns}=co(a.chapter.id),ce=C(()=>{if(a.facultyChapters&&a.facultyChapters.length>0){const t=a.facultyChapters.find(u=>u.number===a.chapter.chapter_number);if(t?.word_count)return t.word_count}if(a.project?.outlines&&a.project.outlines.length>0){const t=a.project.outlines.find(u=>u.chapter_number===a.chapter.chapter_number);if(t?.target_word_count)return t.target_word_count}const o=a.project.type==="undergraduate"?2500:3500;return a.chapter.chapter_number===1||a.chapter.chapter_number===5?Math.round(o*.8):o}),{generateNextChapter:Je}=vn({props:a,allChapters:a.allChapters,targetWordCount:ce,estimates:lt,ensureBalance:it,save:_e}),{currentWordCount:ne,progressPercentage:Ws,DEFENSE_THRESHOLD:Os,countWords:Is}=rn(A,ce),ut=Ws,_t=C(()=>({chapter:a.chapter,chapterTitle:y,chapterContent:A,showPresentationMode:Se,togglePresentationMode:Ot,isStreamingMode:Et,isGenerating:ee,generationProgress:Ge,generationPercentage:ze,generationPhase:Ce,aiChapterAnalysis,nextSection,getSectionInfo,writingStats:yt,latestAnalysis:Ls,isAnalyzing:Ms,writingQualityScore:ke,isSaving:ve,isValid:He,save:_e,goToBulkAnalysis:ft,markAsComplete:mt,richTextEditor:f,richTextEditorFullscreen:R,selectedText:ue,setSelectedText:o=>{ue.value=o}})),qs=C(()=>({chapter_number:zt.value.chapter_number,chapter_title:zt.value.title,word_count:ne.value})),Gs=C(()=>({meetsThreshold:nr.value,shouldShowProgress:er.value,progressPercentage:tr.value,wordsRemaining:sr.value,hasTriggeredGeneration:rr,threshold:Os,statusMessage:Zs()})),kt=C(()=>({project:be.value,chapter:xe.value,isGenerating:ee.value,selectedText:ue.value,isLoadingSuggestions:St.value,showCitationHelper:Ye.value,chapterContent:A.value,currentWordCount:ne.value,targetWordCount:ce.value,handleAIGeneration:At,getAISuggestions:$t,updateCitationHelper:o=>{Ye.value=o},insertCitation:ur,checkCitations:Dt,showDefensePrep:Ve.value,defenseQuestions:Bs.value??[],isLoadingDefenseQuestions:Hs.value,isGeneratingDefenseQuestions:Us.value,chapterContext:qs.value,defenseWatcher:Gs.value,autoGenerateDefense:Qs.value,handleDefensePanelToggle:kr,generateNewDefenseQuestions:Vs,handleDefenseAutoToggle:Ys,refreshDefenseQuestions:()=>Ct(!0,{skipGeneration:!0}),markQuestionHelpful:Xs,hideQuestion:Js})),{defenseQuestions:Bs,isLoadingDefenseQuestions:Hs,isGeneratingDefenseQuestions:Us,autoGenerateDefense:Qs,shouldLoadDefenseQuestions:Ks,loadDefenseQuestions:Ct,generateNewDefenseQuestions:Vs,markQuestionHelpful:Xs,hideQuestion:Js,handleDefenseAutoToggle:Ys,getDefenseStatusMessage:Zs,shouldShowDefenseProgress:er,defenseProgressPercentage:tr,defenseWordsRemaining:sr,hasTriggeredGeneration:rr,meetsDefenseThreshold:nr}=xn({props:a,chapterContent:A,currentWordCount:ne,ensureBalance:it,estimates:lt}),{isGenerating:ee,generationProgress:Ge,generationPercentage:ze,generationPhase:Ce,estimatedTotalWords:or,streamWordCount:ct,streamBuffer:_l,lastStreamUpdate:kl,originalContentForAppend:Cl,aiSuggestions:Sl,isLoadingSuggestions:St,showCitationHelper:Ye,showPresentationMode:Se,isStreamingMode:Et,showRecoveryDialog:ar,partialContentSaved:El,savedWordCountOnError:lr,isCollectingPapers:Tl,paperCollectionProgress:Al,paperCollectionPhase:$l,collectedPapersCount:Dl,paperCollectionPercentage:jl,currentSource:zl,sourcesCompleted:Rl,papersPreview:Pl,paperCollectionData:Fl,paperCollectionInterval:Ml,reconnectAttempts:Ll,reconnectDelay:Nl,isReconnecting:Wl,currentGenerationId:Ol,currentGenerationType:Il,eventSource:Tt,editorScrollRef:ir,attachScroller:ql,smoothScrollToBottom:Gl,forceScrollToBottom:Bl,resetScroller:Hl,isAutoScrollActive:Ul,isUserScrollingScroller:Ql,scrollToBottom:Kl,checkConnectionQuality:Vl,handleAIGeneration:At,handleRegenerateChapter:dr,getAISuggestions:$t,checkCitations:Dt,insertCitation:ur,resumeGeneration:cr,dismissRecovery:pr,checkForAutoGeneration:gr,stopGeneration:Be,cleanupGenerationProtection:jt}=nn({props:a,chapterContent:A,targetWordCount:ce,estimates:lt,ensureBalance:it,save:_e,triggerAutoSave:qe,calculateWritingStats:dt,countWords:Is,selectedText:ue,richTextEditor:f,richTextEditorFullscreen:R,isNativeFullscreen:O}),He=C(()=>{const o=y.value?.trim(),t=A.value?.trim();return o&&o.length>0&&t&&t.length>50}),be=C(()=>a.project),xe=C(()=>a.chapter),Ee=C(()=>a.allChapters),zt=C(()=>a.chapter),Rt=C(()=>a.facultyChapters&&a.facultyChapters.length>0?a.facultyChapters.map(o=>{const t=a.allChapters.find(u=>u.chapter_number===o.number);return{chapter_number:o.number,title:o.title,exists:!!t,content:t?.content||null,status:t?t.status:"not_started"}}):a.project.outlines&&a.project.outlines.length>0?a.project.outlines.map(o=>{const t=a.allChapters.find(u=>u.chapter_number===o.chapter_number);return{chapter_number:o.chapter_number,title:o.chapter_title,exists:!!t,content:t?.content||null,status:t?t.status:"not_started"}}):a.allChapters.map(o=>({chapter_number:o.chapter_number,title:o.title,exists:!0,content:o.content,status:o.status}))),Ae=C(()=>{const o=a.chapter.chapter_number;return Rt.value.find(t=>t.chapter_number===o+1)||null}),Ze=C(()=>{const o=a.chapter.chapter_number;return Rt.value.find(t=>t.chapter_number===o-1)||null}),Pt=C(()=>!Ae.value||ee.value?!1:!Ae.value.content||Ae.value.content.trim().length<10),pt=()=>{Ae.value&&(Ae.value.exists?$e(Ae.value.chapter_number):Je())},fr=()=>{Ze.value&&Ze.value.exists&&$e(Ze.value.chapter_number)};async function Ft(o=!1){try{const t=await fetch(X("chapters.save",{project:a.project.id}),{method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json","X-Requested-With":"XMLHttpRequest","X-CSRF-TOKEN":document.querySelector('meta[name="csrf-token"]')?.getAttribute("content")||""},body:JSON.stringify({project_id:a.project.id,chapter_number:a.chapter.chapter_number,title:y.value,content:A.value,auto_save:o,statistics:yt.value,quality_score:ke.value})});console.log("Response status:",t.status,t.statusText),console.log("Response headers:",t.headers);const u=await t.text();console.log("Raw response:",u);let K;try{K=JSON.parse(u)}catch(we){throw console.error("JSON parse error:",we),console.error("Response was:",u),new Error(`Server returned non-JSON response: ${t.status} ${t.statusText}`)}t.ok}catch(t){throw o||z.error("âŒ Save Failed",{description:"Please try again or check your connection."}),t}}const Mt=()=>{const o=Ps();o!==null&&(A.value=o,qe())},Lt=()=>{const o=Fs();o!==null&&(A.value=o,qe())},mr=async()=>{w.value=!1,await dr(!0)},$e=o=>{!ee.value&&As.value&&confirm("You have unsaved changes. Save before switching chapters?")&&_e();const t=a.allChapters.find(we=>we.chapter_number===o),K=t?.content&&t.content.trim()!==""?"chapters.edit":"chapters.write";V.visit(X(K,{project:a.project.slug,chapter:o}),{only:["chapter","mode","allChapters"],preserveState:!0,preserveScroll:!1})},Nt=()=>document.fullscreenElement||document.webkitFullscreenElement||document.msFullscreenElement||null,hr=async()=>{try{const o=document.documentElement;o.requestFullscreen?await o.requestFullscreen({navigationUI:"hide"}):o.webkitRequestFullscreen?await o.webkitRequestFullscreen():o.msRequestFullscreen&&await o.msRequestFullscreen()}catch(o){console.error("Error entering fullscreen:",o),z.error("Fullscreen Error",{description:"Unable to enter fullscreen mode"})}},vr=async()=>{try{document.exitFullscreen?await document.exitFullscreen():document.webkitExitFullscreen?await document.webkitExitFullscreen():document.msExitFullscreen&&await document.msExitFullscreen()}catch(o){console.error("Error exiting fullscreen:",o),z.error("Fullscreen Error",{description:"Unable to exit fullscreen mode"})}},gt=async()=>{if(Nt()){await vr();return}await hr()},De=()=>{O.value=!!Nt(),Me(()=>{ye(),g.value&&Y()})},Wt=()=>{ge.value=!ge.value,ge.value&&(Ie.value=!1),L(ge.value)},br=()=>{ge.value=!1,L(!1)},xr=()=>{Ie.value=!1},Ot=()=>{Se.value=!Se.value},ft=()=>{V.visit(X("projects.analysis",{project:a.project.slug}))},wr=()=>{Rs(A.value),qe(),dt()},It=o=>{(o.ctrlKey||o.metaKey)&&o.key==="s"&&(o.preventDefault(),_e(),Ds()),(o.ctrlKey||o.metaKey)&&!o.shiftKey&&o.key==="z"&&(o.preventDefault(),Mt()),(o.ctrlKey||o.metaKey)&&o.shiftKey&&o.key==="z"&&(o.preventDefault(),Lt()),(o.ctrlKey||o.metaKey)&&o.shiftKey&&(o.key==="f"||o.key==="F")&&(o.preventDefault(),gt())};Pe(()=>{const o=()=>{Q.value=window.innerWidth<1024};o(),window.addEventListener("resize",o),ge.value=j(),document.addEventListener("keydown",qt),document.addEventListener("keydown",It),document.addEventListener("fullscreenchange",De),document.addEventListener("webkitfullscreenchange",De),document.addEventListener("msfullscreenchange",De),De(),dt(),gr(),ye(),V.on("before",t=>S.value?!0:ee.value&&ct.value>0?(k.value={url:t.detail.visit.url.href,event:t},D.value=!0,!1):!0)});const yr=()=>{D.value=!1,S.value=!0,Be&&Be(),jt(),k.value&&V.visit(k.value.url),k.value=null,setTimeout(()=>{S.value=!1},1e3)},_r=()=>{D.value=!1,k.value=null},qt=o=>{if((o.ctrlKey||o.metaKey)&&!["INPUT","TEXTAREA","SELECT"].includes(o.target?.tagName))switch(o.key){case"ArrowLeft":o.preventDefault();const t=a.chapter.chapter_number-1;a.allChapters.find(Ue=>Ue.chapter_number===t)&&$e(t);break;case"ArrowRight":o.preventDefault();const K=a.chapter.chapter_number+1;a.allChapters.find(Ue=>Ue.chapter_number===K)&&$e(K);break}};Pe(()=>{const o=t=>{const u=K=>{const{scrollTop:we,scrollHeight:Ue,clientHeight:Cr}=t,Bt=K.deltaY,Sr=we<=0,Er=we+Cr>=Ue;Bt<0&&Sr||Bt>0&&Er||K.stopPropagation()};return t.addEventListener("wheel",u,{passive:!0}),()=>t.removeEventListener("wheel",u)};Me(()=>{const t=document.querySelectorAll('[class*="overflow-y-auto"]'),u=[];t.forEach(K=>{if(K instanceof HTMLElement){const we=o(K);u.push(we)}}),window.__scrollChainCleanup=u})}),Nr(()=>{$s(),Tt.value&&Tt.value.close(),jt(),document.removeEventListener("keydown",It),document.removeEventListener("keydown",qt);const o=window.__scrollChainCleanup;o&&Array.isArray(o)&&(o.forEach(t=>t()),delete window.__scrollChainCleanup),document.removeEventListener("fullscreenchange",De),document.removeEventListener("webkitfullscreenchange",De),document.removeEventListener("msfullscreenchange",De)}),de(()=>a.chapter,async o=>{y.value=o.title||"",A.value=o.content||""},{immediate:!1});const kr=async o=>{Ve.value=o,o&&Ks()&&await Ct(!1,{skipGeneration:!0})},Gt=()=>{const o=[{popover:{title:"Welcome to the AI Assisted Editor",description:"Experience a powerful writing environment enhanced by AI. Generate an entire chapter with one click and access a suite of AI tools to refine your content.",popoverClass:"driver-popover-welcome"}},{element:"#back-to-project-btn",popover:{title:"Back to Project",description:"Return to your project dashboard."}},{element:"#left-sidebar-panel",popover:{title:"Chapter Navigation",description:"Use the Table of Contents to switch between chapters."},onHighlightStarted:()=>{fe.value=!1},showOnMobile:!1},{element:"#view-controls",popover:{title:"View Options",description:"Customize your view with Preview, AI Chat, Fullscreen, and Dark Mode."}},{element:"#toggle-chat-mode",popover:{title:"AI Chat Assistant",description:"Open the AI assistant to help you write, brainstorm, or refine your content."}},{element:"#export-menu-container",popover:{title:"Export",description:"Export your chapter or entire project."}},{element:"#analyze-button",popover:{title:"Bulk Analysis",description:"Analyze content across chapters."}},{element:"#save-button",popover:{title:"Save Work",description:"Manually save your chapter. Auto-save is also active!"}},{element:"#mark-complete-btn",popover:{title:"Mark as Complete",description:"Finished writing? Mark the chapter as complete."}},{element:"#toggle-right-sidebar",popover:{title:"AI Tools Sidebar",description:"Toggle the sidebar to access AI tools like Smart Suggestions and Citation Helper."},showOnMobile:!1},{element:"#right-sidebar-panel",popover:{title:"AI Assistant Tools",description:"Access powerful AI features here."},onHighlightStarted:()=>{me.value=!1},showOnMobile:!1},{element:"#editor-footer",popover:{title:"Writing Stats",description:"Track your word count, quality score, and readiness."}},{element:"#reset-tour-button",popover:{title:"Need Help?",description:"Click here anytime to restart this tour."}}];Xr({showProgress:!0,animate:!0,steps:Q.value?o.filter(u=>u.showOnMobile!==!1):o}).drive()};Pe(()=>{if(_.props.auth?.user?.email){const o=`chapter_editor_tour_seen_${_.props.auth.user.email}`;localStorage.getItem(o)||setTimeout(()=>{Gt(),localStorage.setItem(o,"true")},1e3)}}),de(A,wr),de(y,qe);const mt=async()=>{console.log("ðŸ”µ [MARK COMPLETE] Function called"),console.log("ðŸ”µ [MARK COMPLETE] Current word count:",ne.value);try{console.log("ðŸ”µ [MARK COMPLETE] Saving chapter..."),await _e(!1),console.log("âœ… [MARK COMPLETE] Chapter saved");const o=X("chapters.mark-complete",{project:a.project.slug,chapter:a.chapter.chapter_number});console.log("ðŸ”µ [MARK COMPLETE] Posting to:",o),V.post(o,{},{onSuccess:()=>{console.log("âœ… [MARK COMPLETE] Request successful")},onError:t=>{console.error("âŒ [MARK COMPLETE] Request failed:",t)}})}catch(o){console.error("âŒ [MARK COMPLETE] Error:",o),z.error("Failed to save chapter before marking complete")}};return Pe(async()=>{await Ns()}),Pe(()=>{g.value&&Me(()=>Y())}),de(J,()=>{g.value&&Me(()=>Y())},{flush:"post"}),(o,t)=>(v(),P(e(Yr),null,{default:n(()=>[g.value?(v(),W(Qt,{key:0},[F.value?(v(),W("div",po,[s("div",go,[s("div",fo,[t[33]||(t[33]=s("div",null,[s("h1",{class:"text-lg font-semibold"},"ChapterEditor Theme Sandbox"),s("p",{class:"text-sm text-muted-foreground"},"No layout mode. Use `?theme_sandbox=nolayout`.")],-1)),s("div",mo,[r(ps),r(e(b),{variant:"outline",size:"sm",onClick:Y},{default:n(()=>[...t[31]||(t[31]=[l("Refresh",-1)])]),_:1}),r(e(b),{variant:"outline",size:"sm",onClick:t[0]||(t[0]=u=>e(V).visit(o.window.location.pathname))},{default:n(()=>[...t[32]||(t[32]=[l("Exit",-1)])]),_:1})])]),s("div",ho,[r(e(oe),{class:"bg-card text-card-foreground"},{default:n(()=>[r(e(le),null,{default:n(()=>[r(e(pe),{class:"text-base"},{default:n(()=>[...t[34]||(t[34]=[l("Theme State",-1)])]),_:1})]),_:1}),r(e(ae),{class:"space-y-2 text-sm"},{default:n(()=>[s("div",vo,[s("div",null,[t[35]||(t[35]=s("span",{class:"text-muted-foreground"},"appearance:",-1)),l(" "+p(e(te)),1)]),s("div",null,[t[36]||(t[36]=s("span",{class:"text-muted-foreground"},"isDark:",-1)),l(" "+p(e(J)),1)]),s("div",null,[t[37]||(t[37]=s("span",{class:"text-muted-foreground"},"html.dark:",-1)),l(" "+p(c.value.htmlHasDark),1)]),s("div",null,[t[38]||(t[38]=s("span",{class:"text-muted-foreground"},"step:",-1)),l(" "+p(N.value),1)])]),r(e(Qe)),s("div",bo,[s("div",null,[t[39]||(t[39]=s("span",{class:"text-muted-foreground"},"--background:",-1)),l(" "+p(c.value.background),1)]),s("div",null,[t[40]||(t[40]=s("span",{class:"text-muted-foreground"},"--foreground:",-1)),l(" "+p(c.value.foreground),1)]),s("div",null,[t[41]||(t[41]=s("span",{class:"text-muted-foreground"},"--card:",-1)),l(" "+p(c.value.card),1)]),s("div",null,[t[42]||(t[42]=s("span",{class:"text-muted-foreground"},"--sidebar-background:",-1)),l(" "+p(c.value.sidebarBackground),1)])]),r(e(Qe)),s("div",xo,[s("div",null,[t[43]||(t[43]=s("span",{class:"text-muted-foreground"},"body bg:",-1)),l(" "+p(c.value.bodyBg),1)]),s("div",null,[t[44]||(t[44]=s("span",{class:"text-muted-foreground"},"inset bg:",-1)),l(" "+p(c.value.insetBg),1)]),s("div",null,[t[45]||(t[45]=s("span",{class:"text-muted-foreground"},"sample bg-background:",-1)),l(" "+p(c.value.sampleBgBackground),1)]),s("div",null,[t[46]||(t[46]=s("span",{class:"text-muted-foreground"},"sample bg-card:",-1)),l(" "+p(c.value.sampleBgCard),1)]),s("div",null,[t[47]||(t[47]=s("span",{class:"text-muted-foreground"},"sample bg-muted:",-1)),l(" "+p(c.value.sampleBgMuted),1)])])]),_:1})]),_:1}),s("div",wo,[r(e(oe),{ref_key:"sampleBgBackgroundEl",ref:d,class:"bg-background"},{default:n(()=>[r(e(le),null,{default:n(()=>[r(e(pe),{class:"text-base"},{default:n(()=>[...t[48]||(t[48]=[l("bg-background",-1)])]),_:1})]),_:1}),r(e(ae),{class:"text-sm text-muted-foreground"},{default:n(()=>[...t[49]||(t[49]=[l("Should flip with theme.",-1)])]),_:1})]),_:1},512),r(e(oe),{ref_key:"sampleBgCardEl",ref:T,class:"bg-card"},{default:n(()=>[r(e(le),null,{default:n(()=>[r(e(pe),{class:"text-base"},{default:n(()=>[...t[50]||(t[50]=[l("bg-card",-1)])]),_:1})]),_:1}),r(e(ae),{class:"text-sm text-muted-foreground"},{default:n(()=>[...t[51]||(t[51]=[l("Card surface color.",-1)])]),_:1})]),_:1},512),r(e(oe),{ref_key:"sampleBgMutedEl",ref:se,class:"bg-muted"},{default:n(()=>[r(e(le),null,{default:n(()=>[r(e(pe),{class:"text-base"},{default:n(()=>[...t[52]||(t[52]=[l("bg-muted",-1)])]),_:1})]),_:1}),r(e(ae),{class:"text-sm text-muted-foreground"},{default:n(()=>[...t[53]||(t[53]=[l("Muted surface color.",-1)])]),_:1})]),_:1},512)])])])])):(v(),P(gs,{key:1,class:"h-screen overflow-hidden bg-background text-foreground"},{default:n(()=>[s("div",yo,[s("div",_o,[t[56]||(t[56]=s("div",null,[s("h1",{class:"text-lg font-semibold"},"ChapterEditor Theme Sandbox"),s("p",{class:"text-sm text-muted-foreground"}," Use `?theme_sandbox=1` (with layout) or `?theme_sandbox=nolayout`. ")],-1)),s("div",ko,[r(ps),r(e(b),{variant:"outline",size:"sm",onClick:Y},{default:n(()=>[...t[54]||(t[54]=[l("Refresh",-1)])]),_:1}),r(e(b),{variant:"outline",size:"sm",onClick:t[1]||(t[1]=u=>e(V).visit(o.window.location.pathname))},{default:n(()=>[...t[55]||(t[55]=[l("Exit",-1)])]),_:1})])]),s("div",Co,[r(e(oe),{class:"bg-card text-card-foreground"},{default:n(()=>[r(e(le),null,{default:n(()=>[r(e(pe),{class:"text-base"},{default:n(()=>[...t[57]||(t[57]=[l("Theme State",-1)])]),_:1})]),_:1}),r(e(ae),{class:"space-y-2 text-sm"},{default:n(()=>[s("div",So,[s("div",null,[t[58]||(t[58]=s("span",{class:"text-muted-foreground"},"appearance:",-1)),l(" "+p(e(te)),1)]),s("div",null,[t[59]||(t[59]=s("span",{class:"text-muted-foreground"},"isDark:",-1)),l(" "+p(e(J)),1)]),s("div",null,[t[60]||(t[60]=s("span",{class:"text-muted-foreground"},"html.dark:",-1)),l(" "+p(c.value.htmlHasDark),1)]),s("div",null,[t[61]||(t[61]=s("span",{class:"text-muted-foreground"},"step:",-1)),l(" "+p(N.value),1)])]),r(e(Qe)),s("div",Eo,[s("div",null,[t[62]||(t[62]=s("span",{class:"text-muted-foreground"},"--background:",-1)),l(" "+p(c.value.background),1)]),s("div",null,[t[63]||(t[63]=s("span",{class:"text-muted-foreground"},"--foreground:",-1)),l(" "+p(c.value.foreground),1)]),s("div",null,[t[64]||(t[64]=s("span",{class:"text-muted-foreground"},"--card:",-1)),l(" "+p(c.value.card),1)]),s("div",null,[t[65]||(t[65]=s("span",{class:"text-muted-foreground"},"--sidebar-background:",-1)),l(" "+p(c.value.sidebarBackground),1)])]),r(e(Qe)),s("div",To,[s("div",null,[t[66]||(t[66]=s("span",{class:"text-muted-foreground"},"body bg:",-1)),l(" "+p(c.value.bodyBg),1)]),s("div",null,[t[67]||(t[67]=s("span",{class:"text-muted-foreground"},"inset bg:",-1)),l(" "+p(c.value.insetBg),1)]),s("div",null,[t[68]||(t[68]=s("span",{class:"text-muted-foreground"},"sample bg-background:",-1)),l(" "+p(c.value.sampleBgBackground),1)]),s("div",null,[t[69]||(t[69]=s("span",{class:"text-muted-foreground"},"sample bg-card:",-1)),l(" "+p(c.value.sampleBgCard),1)]),s("div",null,[t[70]||(t[70]=s("span",{class:"text-muted-foreground"},"sample bg-muted:",-1)),l(" "+p(c.value.sampleBgMuted),1)])])]),_:1})]),_:1}),s("div",Ao,[r(e(oe),{ref_key:"sampleBgBackgroundEl",ref:d,class:"bg-background"},{default:n(()=>[r(e(le),null,{default:n(()=>[r(e(pe),{class:"text-base"},{default:n(()=>[...t[71]||(t[71]=[l("bg-background",-1)])]),_:1})]),_:1}),r(e(ae),{class:"text-sm text-muted-foreground"},{default:n(()=>[...t[72]||(t[72]=[l("Should flip with theme.",-1)])]),_:1})]),_:1},512),r(e(oe),{ref_key:"sampleBgCardEl",ref:T,class:"bg-card"},{default:n(()=>[r(e(le),null,{default:n(()=>[r(e(pe),{class:"text-base"},{default:n(()=>[...t[73]||(t[73]=[l("bg-card",-1)])]),_:1})]),_:1}),r(e(ae),{class:"text-sm text-muted-foreground"},{default:n(()=>[...t[74]||(t[74]=[l("Card surface color.",-1)])]),_:1})]),_:1},512),r(e(oe),{ref_key:"sampleBgMutedEl",ref:se,class:"bg-muted"},{default:n(()=>[r(e(le),null,{default:n(()=>[r(e(pe),{class:"text-base"},{default:n(()=>[...t[75]||(t[75]=[l("bg-muted",-1)])]),_:1})]),_:1}),r(e(ae),{class:"text-sm text-muted-foreground"},{default:n(()=>[...t[76]||(t[76]=[l("Muted surface color.",-1)])]),_:1})]),_:1},512)]),N.value>=1?(v(),W("div",$o,[t[77]||(t[77]=s("div",{class:"text-sm font-medium"},"Step 1: Paper Card only",-1)),t[78]||(t[78]=s("div",{class:"text-xs text-muted-foreground mb-3"},"Adds `ChapterEditorPaperCard` only.",-1)),r(vs,{context:_t.value},null,8,["context"])])):U("",!0)])])]),_:1}))],64)):(v(),W(Qt,{key:1},[e(ge)?(v(),P(e($),{key:0,project:be.value,chapter:xe.value,"chapter-title":e(y),"chapter-content":e(A),"current-word-count":e(ne),"target-word-count":ce.value,"progress-percentage":e(ut),"writing-quality-score":e(ke),"is-valid":He.value,"is-saving":e(ve),"show-preview":e(re),"is-generating":e(ee),"generation-progress":e(Ge),"history-index":e(zs),"content-history-length":e(js).length,"selected-text":e(ue),"onUpdate:chapterTitle":t[2]||(t[2]=u=>y.value=u),"onUpdate:chapterContent":t[3]||(t[3]=u=>A.value=u),"onUpdate:selectedText":t[4]||(t[4]=u=>ue.value=u),"onUpdate:showPreview":t[5]||(t[5]=u=>re.value=u),onSave:t[6]||(t[6]=u=>Ft(u)),onUndo:Mt,onRedo:Lt,onExitChatMode:br},null,8,["project","chapter","chapter-title","chapter-content","current-word-count","target-word-count","progress-percentage","writing-quality-score","is-valid","is-saving","show-preview","is-generating","generation-progress","history-index","content-history-length","selected-text"])):e(Ie)?(v(),P(e(M),{key:1,project:be.value,chapter:xe.value,"chapter-title":e(y),"chapter-content":e(A),"current-word-count":e(ne),"target-word-count":ce.value,"progress-percentage":e(ut),onExitCitationMode:xr},null,8,["project","chapter","chapter-title","chapter-content","current-word-count","target-word-count","progress-percentage"])):e(O)?(v(),W("div",Do,[t[95]||(t[95]=s("div",{class:"absolute inset-0 z-0 overflow-hidden pointer-events-none"},[s("div",{class:"absolute top-[-20%] left-[-10%] w-[50%] h-[50%] rounded-full bg-blue-500/5 blur-[120px]"}),s("div",{class:"absolute bottom-[-20%] right-[-10%] w-[50%] h-[50%] rounded-full bg-purple-500/5 blur-[120px]"})],-1)),s("div",jo,[s("div",zo,[r(e(H),null,{default:n(()=>[r(e(G),{asChild:""},{default:n(()=>[r(e(b),{onClick:t[7]||(t[7]=u=>e(V).visit(e(X)("projects.show",a.project.slug))),variant:"ghost",size:"icon",class:"h-10 w-10 rounded-full hover:bg-primary/10 hover:text-primary transition-all duration-300"},{default:n(()=>[r(e(ht),{class:"h-5 w-5"})]),_:1})]),_:1}),r(e(B),null,{default:n(()=>[...t[79]||(t[79]=[s("p",null,"Back to Project",-1)])]),_:1})]),_:1}),s("div",Ro,[s("h1",Po,p(a.project.title),1),s("div",Fo,[r(e(je),{variant:"outline",class:"h-5 px-2 rounded-full border-primary/20 bg-primary/5 text-primary font-medium"},{default:n(()=>[l(" Chapter "+p(a.chapter.chapter_number),1)]),_:1}),s("span",Mo,[t[80]||(t[80]=s("span",{class:"h-1.5 w-1.5 rounded-full bg-green-500 animate-pulse"},null,-1)),l(" "+p(e(ne))+" words ",1)])])])]),s("div",Lo,[s("div",No,[r(e(b),{onClick:t[8]||(t[8]=u=>he.value=!e(he)),variant:e(he)?"secondary":"ghost",size:"sm",class:Le(["h-8 px-4 rounded-full text-xs font-medium transition-all duration-300",e(he)?"bg-primary/10 text-primary hover:bg-primary/15":"hover:bg-muted"])},{default:n(()=>[r(e(Kt),{class:"mr-2 h-3.5 w-3.5"}),t[81]||(t[81]=l(" Outline ",-1))]),_:1},8,["variant","class"]),t[83]||(t[83]=s("div",{class:"w-px h-4 bg-border/50 mx-1"},null,-1)),r(e(b),{onClick:t[9]||(t[9]=u=>Te.value=!e(Te)),variant:e(Te)?"secondary":"ghost",size:"sm",class:Le(["h-8 px-4 rounded-full text-xs font-medium transition-all duration-300",e(Te)?"bg-primary/10 text-primary hover:bg-primary/15":"hover:bg-muted"])},{default:n(()=>[r(e(Fe),{class:"mr-2 h-3.5 w-3.5"}),t[82]||(t[82]=l(" Assistant ",-1))]),_:1},8,["variant","class"])]),s("div",Wo,[r(e(H),null,{default:n(()=>[r(e(G),{asChild:""},{default:n(()=>[r(e(b),{onClick:Wt,variant:"ghost",size:"icon",class:"h-9 w-9 rounded-full transition-all hover:bg-muted"},{default:n(()=>[r(e(Vt),{class:"h-4.5 w-4.5 text-blue-500"})]),_:1})]),_:1}),r(e(B),null,{default:n(()=>[...t[84]||(t[84]=[s("p",null,"Open AI Chat",-1)])]),_:1})]),_:1}),r(e(H),null,{default:n(()=>[r(e(G),{asChild:""},{default:n(()=>[r(e(b),{onClick:gt,variant:e(O)?"secondary":"ghost",size:"icon",class:"h-9 w-9 rounded-full transition-all hover:bg-muted"},{default:n(()=>[e(O)?(v(),P(e(Xt),{key:0,class:"h-4.5 w-4.5"})):(v(),P(e(Jt),{key:1,class:"h-4.5 w-4.5"}))]),_:1},8,["variant"])]),_:1}),r(e(B),null,{default:n(()=>[s("p",null,p(e(O)?"Exit fullscreen":"Enter fullscreen"),1)]),_:1})]),_:1}),r(e(H),null,{default:n(()=>[r(e(G),{asChild:""},{default:n(()=>[r(e(b),{onClick:e(I),variant:e(Z)?"secondary":"ghost",size:"icon",class:"h-9 w-9 rounded-full transition-all hover:bg-muted"},{default:n(()=>[e(Z)?(v(),P(e(Yt),{key:0,class:"h-4.5 w-4.5 text-foreground"})):(v(),P(e(Zt),{key:1,class:"h-4.5 w-4.5 text-muted-foreground"}))]),_:1},8,["onClick","variant"])]),_:1}),r(e(B),null,{default:n(()=>[...t[85]||(t[85]=[s("p",null,"Toggle Dark Mode",-1)])]),_:1})]),_:1}),r(bt,{project:be.value,"current-chapter":xe.value,"all-chapters":Ee.value,size:"icon",variant:"ghost",class:"h-9 w-9 rounded-full hover:bg-muted"},null,8,["project","current-chapter","all-chapters"])])])]),s("div",Oo,[s("div",{class:"absolute top-0 left-0 h-full bg-gradient-to-r from-blue-500 via-purple-500 to-pink-500 transition-all duration-700 ease-out shadow-[0_0_10px_rgba(59,130,246,0.5)]",style:vt({width:`${Math.min(e(ut),100)}%`})},null,4)]),e(ee)?(v(),W("div",Io,[s("div",qo,[t[91]||(t[91]=s("div",{class:"absolute inset-0 -skew-x-12 animate-pulse bg-gradient-to-r from-transparent via-white/10 to-transparent"},null,-1)),s("div",Go,[s("div",Bo,[s("div",Ho,[s("div",Uo,[r(e(Fe),{class:"h-3 w-3 text-white"})]),t[86]||(t[86]=s("div",{class:"absolute inset-0 h-6 w-6 animate-ping rounded-full bg-gradient-to-br from-indigo-500 to-purple-600 opacity-20"},null,-1))]),s("div",null,[t[87]||(t[87]=s("h4",{class:"text-xs font-semibold text-indigo-900 dark:text-indigo-100"},"AI Writing Assistant",-1)),s("p",Qo,p(e(Ce)),1)])]),s("div",Ko,[r(e(b),{variant:"ghost",size:"icon",class:"h-7 w-7 rounded-full hover:bg-red-100 dark:hover:bg-red-900/20 transition-colors",onClick:e(Be),title:"Stop writing"},{default:n(()=>[r(e(Wr),{class:"h-4 w-4 text-red-600 dark:text-red-400"})]),_:1},8,["onClick"]),r(e(je),{variant:"secondary",class:"bg-indigo-100 text-indigo-700 dark:bg-indigo-900/40 dark:text-indigo-300 border-0"},{default:n(()=>[l(p(Math.round(e(ze)))+"% ",1)]),_:1})])]),s("div",Vo,[s("div",Xo,[t[88]||(t[88]=s("span",{class:"text-[10px] font-medium text-indigo-800 dark:text-indigo-200 uppercase tracking-wider"},"Writing Progress",-1)),s("span",Jo,p(e(ct))+" / "+p(e(or))+" words",1)]),s("div",Yo,[s("div",{class:"absolute top-0 left-0 h-full rounded-full bg-gradient-to-r from-indigo-500 via-purple-500 to-pink-500 transition-all duration-500 ease-out shadow-[0_0_10px_rgba(99,102,241,0.5)]",style:vt({width:`${e(ze)}%`})},[...t[89]||(t[89]=[s("div",{class:"absolute inset-0 animate-pulse bg-gradient-to-r from-transparent via-white/40 to-transparent"},null,-1)])],4)])]),s("div",Zo,[s("div",ea,[e(Ce)==="Initializing"?(v(),W("div",ta)):e(Ce)==="Connecting"?(v(),W("div",sa,[...t[90]||(t[90]=[s("div",{class:"h-2 w-0.5 animate-pulse rounded-full bg-blue-500"},null,-1),s("div",{class:"h-2 w-0.5 animate-pulse rounded-full bg-purple-500",style:{"animation-delay":"0.2s"}},null,-1),s("div",{class:"h-2 w-0.5 animate-pulse rounded-full bg-blue-500",style:{"animation-delay":"0.4s"}},null,-1)])])):e(Ce)==="Writing"||e(Ce)==="Writing Section"?(v(),W("div",ra)):e(Ce)==="Complete"?(v(),W("div",na)):(v(),W("div",oa))]),s("p",aa,p(e(Ge)),1)])])])):U("",!0),s("div",la,[r(Oe,{"enter-active-class":"transition-all duration-300 ease-in-out","enter-from-class":"-ml-72 opacity-0","enter-to-class":"ml-0 opacity-100","leave-active-class":"transition-all duration-300 ease-in-out","leave-from-class":"ml-0 opacity-100","leave-to-class":"-ml-72 opacity-0"},{default:n(()=>[e(he)?(v(),W("div",ia,[s("div",da,[s("div",ua,[s("div",ca,[t[92]||(t[92]=s("h2",{class:"text-sm font-semibold text-foreground mb-1"},"Table of Contents",-1)),s("p",pa,p(Ee.value.length)+" Chapters ",1)]),(v(),P(Or,null,{fallback:n(()=>[...t[93]||(t[93]=[s("div",{class:"flex items-center justify-center p-8"},[s("div",{class:"h-6 w-6 animate-spin rounded-full border-2 border-primary border-t-transparent"})],-1)])]),default:n(()=>[r(e(x),{"all-chapters":Ee.value,"current-chapter":xe.value,project:be.value,outlines:o.project.outlines||[],"faculty-chapters":o.facultyChapters||[],"current-word-count":e(ne),"target-word-count":ce.value,"writing-quality-score":e(ke),"chapter-content-length":e(A).length,onGoToChapter:$e,onGenerateNextChapter:e(Je)},null,8,["all-chapters","current-chapter","project","outlines","faculty-chapters","current-word-count","target-word-count","writing-quality-score","chapter-content-length","onGenerateNextChapter"])]),_:1}))])])])):U("",!0)]),_:1}),s("div",ga,[s("div",fa,[s("div",ma,[r(vs,{context:_t.value},null,8,["context"]),t[94]||(t[94]=s("div",{class:"h-12"},null,-1))])])]),r(Oe,{"enter-active-class":"transition-all duration-300 ease-in-out","enter-from-class":"-mr-72 opacity-0","enter-to-class":"mr-0 opacity-100","leave-active-class":"transition-all duration-300 ease-in-out","leave-from-class":"mr-0 opacity-100","leave-to-class":"-mr-72 opacity-0"},{default:n(()=>[e(Te)?(v(),P(bs,es({key:0,"container-class":"w-72 flex-shrink-0 border-l border-border/40 bg-background/40 backdrop-blur-md"},kt.value),null,16)):U("",!0)]),_:1})])])):(v(),P(gs,{key:3,class:"h-screen overflow-hidden bg-background dark:bg-background transition-colors duration-300"},{default:n(()=>[s("div",ha,[t[126]||(t[126]=s("div",{class:"absolute inset-0 z-0 overflow-hidden pointer-events-none"},[s("div",{class:"absolute top-[-10%] left-[-10%] w-[40%] h-[40%] rounded-full bg-blue-500/5 blur-[100px]"}),s("div",{class:"absolute bottom-[-10%] right-[-10%] w-[40%] h-[40%] rounded-full bg-purple-500/5 blur-[100px]"})],-1)),Ne(s("aside",va,[s("div",ba,[t[96]||(t[96]=s("span",{class:"text-sm font-semibold tracking-tight text-foreground"},"Navigation",-1)),r(e(je),{variant:"outline",class:"text-[10px] h-5 px-1.5"},{default:n(()=>[l(p(Ee.value.length)+" Chapters ",1)]),_:1})]),r(e(rs),{class:"flex-1"},{default:n(()=>[s("div",xa,[r(e(x),{"all-chapters":Ee.value,"current-chapter":xe.value,project:be.value,outlines:o.project.outlines||[],"faculty-chapters":o.facultyChapters||[],"current-word-count":e(ne),"target-word-count":ce.value,"writing-quality-score":e(ke),"chapter-content-length":e(A).length,onGoToChapter:$e,onGenerateNextChapter:e(Je)},null,8,["all-chapters","current-chapter","project","outlines","faculty-chapters","current-word-count","target-word-count","writing-quality-score","chapter-content-length","onGenerateNextChapter"])])]),_:1})],512),[[We,!e(fe)]]),s("main",wa,[s("header",ya,[s("div",_a,[r(e(H),null,{default:n(()=>[r(e(G),{asChild:""},{default:n(()=>[r(e(b),{id:"back-to-project-btn-mobile",variant:"ghost",size:"icon",class:"h-9 w-9 text-zinc-700 dark:text-zinc-300 hover:text-foreground hover:bg-muted/50 rounded-full",onClick:t[10]||(t[10]=u=>e(V).visit(e(X)("projects.writing",a.project.slug)))},{default:n(()=>[r(e(ht),{class:"w-4 h-4"})]),_:1})]),_:1}),r(e(B),null,{default:n(()=>[...t[97]||(t[97]=[l("Back to Writing",-1)])]),_:1})]),_:1}),t[98]||(t[98]=s("div",{class:"h-6 w-px bg-border/50 mx-1 hidden lg:block"},null,-1)),r(e(b),{variant:"ghost",size:"icon",onClick:t[11]||(t[11]=u=>q.value=!0),class:"lg:hidden text-muted-foreground hover:text-foreground h-9 w-9 hover:bg-muted/50 rounded-full"},{default:n(()=>[r(e(Kt),{class:"h-4.5 w-4.5"})]),_:1})]),s("div",ka,[r(e(b),{variant:"ghost",size:"icon",onClick:t[12]||(t[12]=u=>E.value=!0),class:"text-muted-foreground hover:text-foreground h-9 w-9 hover:bg-muted/50 rounded-full"},{default:n(()=>[r(e(Fe),{class:"h-4.5 w-4.5"})]),_:1})]),s("div",Ca,[s("div",Sa,[s("h1",{class:"text-xl font-bold tracking-tight text-foreground leading-snug cursor-pointer hover:text-primary/80 transition-colors break-words",onClick:t[13]||(t[13]=u=>e(V).visit(e(X)("projects.show",a.project.slug)))},p(a.project.title),1),r(e(je),{variant:"secondary",class:"shrink-0 h-5 px-2 text-[10px] font-medium rounded-full bg-secondary/50 border border-border/50 mt-1"},{default:n(()=>[l(" Ch "+p(a.chapter.chapter_number),1)]),_:1})]),s("div",Ea,[s("div",Ta,[r(bt,{project:be.value,"current-chapter":xe.value,"all-chapters":Ee.value,size:"icon",variant:"outline","trigger-element":"icon","button-class":"h-8 w-8 rounded-full bg-background/50 backdrop-blur-sm",class:"text-zinc-700 dark:text-zinc-300"},null,8,["project","current-chapter","all-chapters"]),r(e(b),{variant:"outline",size:"icon",class:"h-8 w-8 gap-2 text-zinc-700 dark:text-zinc-300 hover:text-foreground bg-background/50 backdrop-blur-sm rounded-full",onClick:ft},{default:n(()=>[r(e(ts),{class:"w-4 h-4"})]),_:1}),r(e(b),{variant:"outline",size:"icon",class:"h-8 w-8 gap-2 text-zinc-700 dark:text-zinc-300 hover:text-foreground bg-background/50 backdrop-blur-sm rounded-full",disabled:e(ee),onClick:t[14]||(t[14]=u=>w.value=!0),title:"Regenerate chapter"},{default:n(()=>[r(e(rt),{class:"w-4 h-4"})]),_:1},8,["disabled"])]),s("div",Aa,[Pt.value?(v(),P(e(H),{key:0},{default:n(()=>[r(e(G),{asChild:""},{default:n(()=>[r(e(b),{onClick:pt,size:"icon",variant:"ghost",class:"h-9 w-9 rounded-full hover:bg-muted/50 transition-all active:scale-90"},{default:n(()=>[r(e(ss),{class:"h-4.5 w-4.5 text-foreground/70"})]),_:1})]),_:1}),r(e(B),null,{default:n(()=>[...t[99]||(t[99]=[l("Start writing next chapter",-1)])]),_:1})]),_:1})):U("",!0),r(e(b),{onClick:t[15]||(t[15]=u=>e(_e)(!1)),disabled:e(ve),variant:He.value?"default":"secondary",size:"sm",class:"h-8 px-3 text-xs shadow-sm gap-2 rounded-full min-w-[32px]"},{default:n(()=>[r(e(xt),{class:"h-3.5 w-3.5"}),e(ve)?(v(),W("span",$a,"Saving")):U("",!0)]),_:1},8,["disabled","variant"]),r(e(b),{onClick:mt,disabled:e(ve),size:"sm",class:"h-8 px-3 text-xs shadow-sm gap-2 rounded-full"},{default:n(()=>[r(e(st),{class:"h-3.5 w-3.5"}),t[100]||(t[100]=s("span",{class:"sm:hidden"},"Done",-1))]),_:1},8,["disabled"])])])])]),s("div",Da,[s("div",ja,[s("div",za,[s("h1",{class:"text-sm font-bold text-foreground cursor-pointer hover:text-primary transition-colors flex items-center",onClick:t[16]||(t[16]=u=>e(V).visit(e(X)("projects.show",a.project.slug)))},[s("div",{innerHTML:a.project.title,class:"inline-block"},null,8,Ra)]),r(e(je),{variant:"secondary",class:"h-5 px-2 text-[10px] font-medium rounded-full bg-secondary/50 border border-border/50"},{default:n(()=>[l(" Ch "+p(a.chapter.chapter_number),1)]),_:1})])]),s("div",Pa,[s("div",Fa,[r(e(H),null,{default:n(()=>[r(e(G),{asChild:""},{default:n(()=>[r(e(b),{id:"back-to-project-btn",variant:"ghost",size:"icon",class:"h-8 w-8 text-zinc-700 dark:text-zinc-300 hover:text-foreground rounded-full",onClick:t[17]||(t[17]=u=>e(V).visit(e(X)("projects.writing",a.project.slug)))},{default:n(()=>[r(e(ht),{class:"w-4 h-4"})]),_:1})]),_:1}),r(e(B),null,{default:n(()=>[...t[101]||(t[101]=[l("Back to Writing",-1)])]),_:1})]),_:1}),t[102]||(t[102]=s("div",{class:"h-4 w-px bg-border/50 mx-1"},null,-1)),r(e(b),{id:"toggle-left-sidebar",variant:"ghost",size:"icon",onClick:t[18]||(t[18]=u=>fe.value=!e(fe)),class:"text-muted-foreground hover:text-foreground h-8 w-8 rounded-full"},{default:n(()=>[e(fe)?(v(),P(e(qr),{key:1,class:"h-4 w-4"})):(v(),P(e(Ir),{key:0,class:"h-4 w-4"}))]),_:1})]),s("div",Ma,[s("div",La,[r(e(H),null,{default:n(()=>[r(e(G),{asChild:""},{default:n(()=>[r(e(b),{onClick:Ot,variant:e(Se)?"secondary":"ghost",size:"sm",class:"h-7 px-3 text-xs gap-2 text-zinc-700 dark:text-zinc-300 hover:text-foreground rounded-full"},{default:n(()=>[e(Se)?(v(),P(e(Gr),{key:1,class:"h-3.5 w-3.5"})):(v(),P(e(ws),{key:0,class:"h-3.5 w-3.5"})),s("span",Na,p(e(Se)?"Edit":"Preview"),1)]),_:1},8,["variant"])]),_:1}),r(e(B),null,{default:n(()=>[...t[103]||(t[103]=[l("Toggle Preview Mode",-1)])]),_:1})]),_:1}),t[107]||(t[107]=s("div",{class:"w-px h-3 bg-border/50 mx-0.5"},null,-1)),r(e(H),null,{default:n(()=>[r(e(G),{asChild:""},{default:n(()=>[r(e(b),{id:"toggle-chat-mode",onClick:Wt,variant:"ghost",size:"sm",class:"h-7 px-3 text-xs gap-2 text-muted-foreground hover:text-foreground rounded-full"},{default:n(()=>[r(e(Vt),{class:"h-3.5 w-3.5 text-blue-500"}),t[104]||(t[104]=s("span",{class:"hidden xl:inline text-foreground"},"AI Chat",-1))]),_:1})]),_:1}),r(e(B),null,{default:n(()=>[...t[105]||(t[105]=[l("Open AI Assistant",-1)])]),_:1})]),_:1}),t[108]||(t[108]=s("div",{class:"w-px h-3 bg-border/50 mx-0.5"},null,-1)),r(e(H),null,{default:n(()=>[r(e(G),{asChild:""},{default:n(()=>[r(e(b),{onClick:gt,variant:"ghost",size:"sm",class:"h-7 px-3 text-xs gap-2 text-muted-foreground hover:text-foreground rounded-full"},{default:n(()=>[e(O)?(v(),P(e(Xt),{key:0,class:"h-3.5 w-3.5"})):(v(),P(e(Jt),{key:1,class:"h-3.5 w-3.5"})),s("span",Wa,p(e(O)?`Exit
                                                        Fullscreen`:"Fullscreen"),1)]),_:1})]),_:1}),r(e(B),null,{default:n(()=>[s("p",null,p(e(O)?"Exit fullscreen":"Enter fullscreen"),1)]),_:1})]),_:1}),t[109]||(t[109]=s("div",{class:"w-px h-3 bg-border/50 mx-0.5"},null,-1)),r(e(H),null,{default:n(()=>[r(e(G),{asChild:""},{default:n(()=>[r(e(b),{onClick:e(I),variant:"ghost",size:"sm",class:"h-7 px-3 text-xs gap-2 text-zinc-700 dark:text-zinc-300 hover:text-foreground rounded-full"},{default:n(()=>[e(Z)?(v(),P(e(Yt),{key:0,class:"h-3.5 w-3.5 text-foreground"})):(v(),P(e(Zt),{key:1,class:"h-3.5 w-3.5"}))]),_:1},8,["onClick"])]),_:1}),r(e(B),null,{default:n(()=>[...t[106]||(t[106]=[l("Toggle Dark Mode",-1)])]),_:1})]),_:1})]),s("div",Oa,[r(bt,{id:"export-menu-container",project:be.value,"current-chapter":xe.value,"all-chapters":Ee.value,size:"sm",variant:"outline","trigger-element":"button","button-class":"h-9 gap-2 px-3 rounded-full bg-background/50 backdrop-blur-sm",class:"text-zinc-700 dark:text-zinc-300"},null,8,["project","current-chapter","all-chapters"]),r(e(b),{id:"analyze-button",variant:"outline",size:"sm",class:"h-9 gap-2 text-zinc-700 dark:text-zinc-300 hover:text-foreground bg-background/50 backdrop-blur-sm rounded-full",onClick:ft,title:"Open bulk analysis"},{default:n(()=>[r(e(ts),{class:"w-4 h-4"}),t[110]||(t[110]=s("span",{class:"text-xs font-medium"},"Analyze",-1))]),_:1}),r(e(H),null,{default:n(()=>[r(e(G),{asChild:""},{default:n(()=>[r(e(b),{id:"regenerate-button",variant:"outline",size:"sm",class:"h-9 gap-2 text-zinc-700 dark:text-zinc-300 hover:text-foreground bg-background/50 backdrop-blur-sm rounded-full",disabled:e(ee),onClick:t[19]||(t[19]=u=>w.value=!0)},{default:n(()=>[r(e(rt),{class:"w-4 h-4"}),t[111]||(t[111]=s("span",{class:"text-xs font-medium"},"Regenerate",-1))]),_:1},8,["disabled"])]),_:1}),r(e(B),null,{default:n(()=>[...t[112]||(t[112]=[l("Regenerate chapter content",-1)])]),_:1})]),_:1})]),s("div",Ia,[Pt.value?(v(),P(e(H),{key:0},{default:n(()=>[r(e(G),{asChild:""},{default:n(()=>[r(e(b),{onClick:pt,size:"icon",variant:"ghost",class:"h-9 w-9 rounded-full hover:bg-muted/50 transition-all active:scale-90"},{default:n(()=>[r(e(ss),{class:"h-5 w-5 text-foreground/70"})]),_:1})]),_:1}),r(e(B),null,{default:n(()=>[...t[113]||(t[113]=[l("Start writing next chapter",-1)])]),_:1})]),_:1})):U("",!0),r(e(b),{id:"save-button",onClick:t[20]||(t[20]=u=>e(_e)(!1)),disabled:e(ve),variant:He.value?"default":"secondary",size:"sm",class:"h-9 px-4 text-xs shadow-sm gap-2 rounded-full min-w-[32px]"},{default:n(()=>[r(e(xt),{class:"h-3.5 w-3.5"}),s("span",qa,p(e(ve)?"Saving":"Save"),1)]),_:1},8,["disabled","variant"]),r(e(b),{id:"mark-complete-btn",onClick:mt,disabled:e(ve),size:"sm",class:"h-9 px-4 text-xs shadow-sm gap-2 rounded-full"},{default:n(()=>[r(e(st),{class:"h-3.5 w-3.5"}),t[114]||(t[114]=s("span",null,"Mark Complete",-1))]),_:1},8,["disabled"]),t[116]||(t[116]=s("div",{class:"w-px h-4 bg-border/50 mx-1"},null,-1)),t[117]||(t[117]=s("div",{class:"w-px h-4 bg-border/50 mx-1"},null,-1)),r(e(H),null,{default:n(()=>[r(e(G),{asChild:""},{default:n(()=>[r(e(b),{id:"reset-tour-button",variant:"ghost",size:"icon",onClick:Gt,class:"text-muted-foreground hover:text-foreground h-9 w-9 hover:bg-muted/50 rounded-full"},{default:n(()=>[r(e(Br),{class:"h-4.5 w-4.5"})]),_:1})]),_:1}),r(e(B),null,{default:n(()=>[...t[115]||(t[115]=[l("Restart Tutorial",-1)])]),_:1})]),_:1}),r(e(b),{id:"toggle-right-sidebar",variant:"ghost",size:"icon",onClick:t[21]||(t[21]=u=>me.value=!e(me)),class:"hidden lg:flex text-muted-foreground hover:text-foreground h-9 w-9 hover:bg-muted/50 rounded-full"},{default:n(()=>[e(me)?(v(),P(e(Ur),{key:1,class:"h-4.5 w-4.5"})):(v(),P(e(Hr),{key:0,class:"h-4.5 w-4.5"}))]),_:1})])])])]),s("div",Ga,[r(Oe,{"enter-active-class":"transition-all duration-300 ease-out","enter-from-class":"opacity-0 -translate-y-4","enter-to-class":"opacity-100 translate-y-0","leave-active-class":"transition-all duration-200 ease-in","leave-from-class":"opacity-100 translate-y-0","leave-to-class":"opacity-0 -translate-y-4"},{default:n(()=>[e(ee)?(v(),W("div",Ba,[s("div",Ha,[s("div",Ua,[t[122]||(t[122]=s("div",{class:"absolute -top-24 -right-24 h-48 w-48 rounded-full bg-blue-500/20 blur-3xl animate-pulse"},null,-1)),t[123]||(t[123]=s("div",{class:"absolute -bottom-24 -left-24 h-48 w-48 rounded-full bg-purple-500/20 blur-3xl animate-pulse delay-1000"},null,-1)),s("div",Qa,[s("div",Ka,[t[118]||(t[118]=s("div",{class:"absolute inset-0 -m-1.5 rounded-full border-2 border-transparent border-t-blue-500 border-r-purple-500 animate-spin [animation-duration:2s]"},null,-1)),s("div",Va,[r(e(Fe),{class:"h-5 w-5 text-white animate-pulse"})])]),s("div",Xa,[s("div",Ja,[t[119]||(t[119]=s("div",{class:"flex flex-col"},[s("h4",{class:"text-sm font-bold text-foreground tracking-tight flex items-center gap-2"},[l(" Writing Chapter "),s("span",{class:"flex h-1.5 w-1.5 rounded-full bg-green-500 animate-pulse shadow-[0_0_8px_rgba(34,197,94,0.6)]"})])],-1)),s("span",Ya,p(Math.round(e(ze)))+"% ",1)]),s("div",Za,[s("div",{class:"h-full bg-gradient-to-r from-blue-500 via-purple-500 to-pink-500 transition-all duration-300 ease-out shadow-[0_0_10px_rgba(59,130,246,0.5)] relative",style:vt({width:`${e(ze)}%`})},[...t[120]||(t[120]=[s("div",{class:"absolute inset-0 bg-white/30 w-full animate-shimmer -skew-x-12 translate-x-[-100%]"},null,-1)])],4)]),s("div",el,[s("p",tl,[t[121]||(t[121]=s("span",{class:"w-1 h-1 rounded-full bg-blue-500"},null,-1)),l(" "+p(e(Ge)||"Initializing writer..."),1)]),s("button",{onClick:t[22]||(t[22]=(...u)=>e(Be)&&e(Be)(...u)),class:"text-[10px] font-semibold text-red-500 hover:text-red-600 dark:text-red-400 dark:hover:text-red-300 transition-colors uppercase tracking-wider flex items-center gap-1 hover:bg-red-50 dark:hover:bg-red-900/10 px-2 py-0.5 rounded-full"}," Stop ")])])])])])])):U("",!0)]),_:1}),r(e(rs),{ref_key:"editorScrollRef",ref:ir,class:"h-full w-full","data-editor-scroll-container":""},{default:n(()=>[s("div",sl,[Ne(s("div",rl,[r(ks,{ref_key:"richTextEditorFullscreen",ref:R,modelValue:e(A),"onUpdate:modelValue":t[23]||(t[23]=u=>Qr(A)?A.value=u:null),placeholder:"Start writing your chapter...",class:"prose prose-slate dark:prose-invert prose-lg max-w-none focus:outline-none min-h-[500px]","streaming-mode":e(Et),"is-generating":e(ee),"generation-progress":e(Ge),"generation-percentage":e(ze),"generation-phase":e(Ce),"onUpdate:selectedText":t[24]||(t[24]=u=>ue.value=u),"min-height":"500px"},null,8,["modelValue","streaming-mode","is-generating","generation-progress","generation-percentage","generation-phase"])],512),[[We,!e(Se)]]),Ne(s("div",nl,[r(Cs,{content:e(A),class:"prose prose-slate dark:prose-invert prose-lg max-w-none"},null,8,["content"])],512),[[We,e(Se)]])])]),_:1},512)]),s("div",ol,[s("div",al,[s("span",null,"Words: "+p(e(ne))+" / "+p(ce.value),1),s("span",ll,"Last saved: "+p(e(ve)?"Saving...":"Just now"),1)]),s("div",il,[r(e(b),{disabled:!Ze.value?.exists,onClick:fr,variant:"ghost",size:"icon",class:"h-8 w-8 rounded-full hover:bg-muted/50 disabled:opacity-30"},{default:n(()=>[r(e(Kr),{class:"h-4 w-4 text-foreground/60"})]),_:1},8,["disabled"]),s("div",dl," Chapter "+p(a.chapter.chapter_number),1),r(e(b),{disabled:!Ae.value,onClick:pt,variant:"ghost",size:"icon",class:"h-8 w-8 rounded-full hover:bg-muted/50 disabled:opacity-30"},{default:n(()=>[r(e(Vr),{class:"h-4 w-4 text-foreground/60"})]),_:1},8,["disabled"])]),s("div",ul,[s("span",null,[t[124]||(t[124]=l("Quality: ",-1)),s("span",{class:Le(e(ke)>70?"text-green-500":"text-amber-500")},p(e(ke))+"%",3)]),He.value?(v(),W("span",cl,[r(e(st),{class:"h-3 w-3"}),t[125]||(t[125]=l(" Ready ",-1))])):U("",!0)])])]),r(bs,es({id:"right-sidebar-panel","is-collapsed":e(me),"container-class":"hidden lg:flex w-96 flex-col border-l border-border/40 bg-background/60 backdrop-blur-xl z-20 transition-all duration-300"},kt.value),null,16,["is-collapsed"])]),r(e(i),{"show-left-sidebar":e(q),"show-right-sidebar":e(E),"is-mobile":e(Q),"all-chapters":Ee.value,"current-chapter":xe.value,project:be.value,"current-word-count":e(ne),"target-word-count":ce.value,"writing-quality-score":e(ke),"chapter-content-length":e(A).length,"is-generating":e(ee),"selected-text":e(ue),"is-loading-suggestions":e(St),"show-citation-helper":e(Ye),"chapter-content":e(A),outlines:o.project.outlines||[],"faculty-chapters":o.facultyChapters||[],"onUpdate:showLeftSidebar":t[25]||(t[25]=u=>q.value=u),"onUpdate:showRightSidebar":t[26]||(t[26]=u=>E.value=u),onGoToChapter:$e,onGenerateNextChapter:e(Je),onStartStreamingGeneration:e(At),onGetAiSuggestions:e($t),"onUpdate:showCitationHelper":t[27]||(t[27]=u=>Ye.value=u),onCheckCitations:e(Dt)},null,8,["show-left-sidebar","show-right-sidebar","is-mobile","all-chapters","current-chapter","project","current-word-count","target-word-count","writing-quality-score","chapter-content-length","is-generating","selected-text","is-loading-suggestions","show-citation-helper","chapter-content","outlines","faculty-chapters","onGenerateNextChapter","onStartStreamingGeneration","onGetAiSuggestions","onCheckCitations"]),r(e(ns),{open:w.value,"onUpdate:open":t[28]||(t[28]=u=>w.value=u)},{default:n(()=>[r(e(os),null,{default:n(()=>[r(e(as),null,{default:n(()=>[r(e(ls),null,{default:n(()=>[...t[127]||(t[127]=[l("Regenerate Chapter?",-1)])]),_:1}),r(e(is),null,{default:n(()=>[...t[128]||(t[128]=[l(" This will replace all existing content with freshly generated content. Your current content will be saved to history, so you can undo if needed. ",-1)])]),_:1})]),_:1}),r(e(ds),null,{default:n(()=>[r(e(us),null,{default:n(()=>[...t[129]||(t[129]=[l("Cancel",-1)])]),_:1}),r(e(cs),{onClick:mr,class:"bg-primary hover:bg-primary/90"},{default:n(()=>[r(e(rt),{class:"w-4 h-4 mr-2"}),t[130]||(t[130]=l(" Regenerate ",-1))]),_:1})]),_:1})]),_:1})]),_:1},8,["open"]),r(e(ns),{open:D.value,"onUpdate:open":t[29]||(t[29]=u=>D.value=u)},{default:n(()=>[r(e(os),{class:"max-w-md"},{default:n(()=>[r(e(as),null,{default:n(()=>[s("div",pl,[s("div",gl,[r(e(Fe),{class:"w-5 h-5 text-amber-500"})]),r(e(ls),{class:"text-lg"},{default:n(()=>[...t[131]||(t[131]=[l("AI is Writing Your Chapter",-1)])]),_:1})]),r(e(is),{class:"text-sm space-y-2"},{default:n(()=>[t[133]||(t[133]=s("p",null,"Your chapter is currently being written by AI. Leaving now will:",-1)),s("ul",fl,[t[132]||(t[132]=s("li",null,"Stop the writing process immediately",-1)),s("li",null,"Lose any unsaved content ("+p(e(ct))+" words written so far)",1)]),t[134]||(t[134]=s("p",{class:"font-medium text-foreground pt-2"},"Are you sure you want to leave?",-1))]),_:1})]),_:1}),r(e(ds),{class:"gap-2 sm:gap-0"},{default:n(()=>[r(e(us),{onClick:_r,class:"flex-1 sm:flex-none"},{default:n(()=>[...t[135]||(t[135]=[l(" Stay on Page ",-1)])]),_:1}),r(e(cs),{onClick:yr,class:"flex-1 sm:flex-none bg-destructive hover:bg-destructive/90 text-destructive-foreground"},{default:n(()=>[...t[136]||(t[136]=[l(" Leave Anyway ",-1)])]),_:1})]),_:1})]),_:1})]),_:1},8,["open"]),r(Zr,{open:e(Xe),"current-balance":e(nt),"required-words":e(ot),action:e(at),"onUpdate:open":t[30]||(t[30]=u=>Xe.value=u),onClose:e(Ts)},null,8,["open","current-balance","required-words","action","onClose"]),e(ar)?(v(),W("div",ml,[r(e(oe),{class:"w-full max-w-md mx-4 bg-white dark:bg-slate-900 border-amber-500/50 shadow-2xl"},{default:n(()=>[r(e(le),null,{default:n(()=>[r(e(pe),{class:"flex items-center gap-2 text-amber-600 dark:text-amber-400"},{default:n(()=>[...t[137]||(t[137]=[s("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[s("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"})],-1),l(" Generation Interrupted ",-1)])]),_:1})]),_:1}),r(e(ae),null,{default:n(()=>[s("p",hl,[t[138]||(t[138]=l(" Connection lost. ",-1)),s("span",vl,p(e(lr))+" words",1),t[139]||(t[139]=l(" may have been saved. ",-1))]),s("div",bl,[r(e(b),{onClick:e(cr),class:"flex-1 bg-amber-600 hover:bg-amber-700 text-white"},{default:n(()=>[...t[140]||(t[140]=[s("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-4 w-4 mr-2",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[s("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"})],-1),l(" Reload & Recover ",-1)])]),_:1},8,["onClick"]),r(e(b),{onClick:e(pr),variant:"outline",class:"flex-1"},{default:n(()=>[...t[141]||(t[141]=[l(" Dismiss ",-1)])]),_:1},8,["onClick"])])]),_:1})]),_:1})])):U("",!0)]),_:1}))],64))]),_:1}))}}),yl=Ss(wl,[["__scopeId","data-v-9d0fe693"]]),Ri=Object.freeze(Object.defineProperty({__proto__:null,default:yl},Symbol.toStringTag,{value:"Module"}));export{oo as A,Ri as C};
