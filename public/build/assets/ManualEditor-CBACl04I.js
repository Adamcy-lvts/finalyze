import{d as Me,i as O,o as l,j as p,c as _,f as z,g as s,k as r,u as e,n as L,aa as Se,b as u,t as ne,q as Ht,z as x,y as H,F as et,h as Gt,ad as ie,U as B,p as he,S as Dt,e as N,T as Xe,a4 as qt,a0 as Nt,X as W}from"./app-Bgp9Ah4M.js";import{t as y}from"./index-BuZzZ-m6.js";import{A as Wt}from"./driver-B4w0q6_T.js";import{_ as f}from"./index-CgLP59YT.js";import{_ as Kt}from"./index-BneSV3ha.js";import{_ as K}from"./Separator.vue_vue_type_script_setup_true_lang-BbDFp8uv.js";import{_ as Vt}from"./Progress.vue_vue_type_script_setup_true_lang-DGihA61_.js";import{aa as Qt}from"./RichTextEditor-BIEhWIVu.js";import{c as Xt,u as Yt,a as Zt,b as Jt,_ as eo,M as to}from"./useManualEditorSuggestions-BOPlWWur.js";import{S as tt}from"./sparkles-BzcWNUl2.js";import{R as oo}from"./refresh-cw-BqYKjBR_.js";import{X as ot}from"./x-BJZchuQz.js";import{_ as st}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{_ as so}from"./Input.vue_vue_type_script_setup_true_lang-DGnGMdUc.js";import{a as ro}from"./ScrollArea.vue_vue_type_script_setup_true_lang-DxrIk156.js";import{B as ao}from"./bot-DFSIxuX-.js";import{L as rt}from"./loader-circle-Chi0vZAo.js";import{S as no}from"./send-BY7S-kDn.js";import{_ as io}from"./ChapterNavigation.vue_vue_type_script_setup_true_lang-D4w6akDh.js";import{u as lo,M as co,a as uo,P as po,_ as mo,b as Ye}from"./useTextHistory-DpIjHyY7.js";import{_ as ho}from"./DropdownMenuTrigger.vue_vue_type_script_setup_true_lang-BLfEqrc4.js";import{e as go}from"./WordBalanceDisplay.vue_vue_type_script_setup_true_lang-CSNTrGY4.js";import{_ as fo}from"./PurchaseModal.vue_vue_type_script_setup_true_lang-BW5gK56Z.js";import{r as at,u as vo}from"./useWordBalance-CHUQ8TYa.js";import{u as bo}from"./index-DfNGxhKz.js";import{A as Ze}from"./arrow-left-DKn8VAIi.js";import{M as xo}from"./menu-CaNx-ax8.js";import{S as Ce}from"./save-BsH-Zzp8.js";import{M as Je}from"./message-square-Be8-CeED.js";import{C as wo}from"./chevron-left-BZsgEzvV.js";import{C as yo}from"./chevron-right-CJhsJ7Lp.js";import{a as _o,P as Co}from"./AlertDialogTitle.vue_vue_type_script_setup_true_lang-B2ZKqQHJ.js";import{M as ko,S as So}from"./sun-BjLx__jj.js";import{M as Mo}from"./minimize-2-ep2zGLJT.js";import{B as To}from"./brain-HetR7HlD.js";import{C as jo}from"./circle-help-DLby68lj.js";import{C as zo}from"./circle-check-big-BwJDm6ET.js";import"./Separator-6UPT1N5E.js";import"./Presence-CxvUdqX-.js";import"./useForwardExpose-CCubejfB.js";import"./nullish-CHIgUVhi.js";import"./purify.es-DxJI3Wx7.js";import"./index-BWEDi_FC.js";import"./step-DrZ9DcYd.js";import"./chart-column-D-g7_Y1u.js";import"./calendar-DjJq-Jcv.js";import"./users-kB5i5IoU.js";import"./circle-alert-DKKGkVZz.js";import"./eye-Bde_bS5a.js";import"./check-GE7eRY7c.js";import"./type-CbQuT-jz.js";import"./download-JX5TQwFT.js";import"./trash-2-v5fRH4M9.js";import"./DialogTitle.vue_vue_type_script_setup_true_lang-Bx9cUe56.js";import"./DialogTitle-VCYIJ3PW.js";import"./DialogDescription.vue_vue_type_script_setup_true_lang-CAnUnvBI.js";import"./DialogFooter.vue_vue_type_script_setup_true_lang-Bbo7H716.js";import"./Label.vue_vue_type_script_setup_true_lang-CPKGhh_h.js";import"./minus-C-98W0B5.js";import"./plus-DG50jX5S.js";import"./list-CQnfqd5K.js";import"./CollapsibleTrigger.vue_vue_type_script_setup_true_lang-BfNSLsfH.js";import"./SafeHtmlText.vue_vue_type_script_setup_true_lang-DOefDurY.js";import"./lightbulb-CHitFxot.js";import"./chevron-down-BrxS-JnU.js";import"./DefensePreparationPanel.vue_vue_type_script_setup_true_lang-DXnVC1gO.js";import"./index-CGxCRlGy.js";import"./CardContent.vue_vue_type_script_setup_true_lang-BzdaijRh.js";import"./CardTitle.vue_vue_type_script_setup_true_lang-DzsLSsD4.js";import"./Switch.vue_vue_type_script_setup_true_lang-nlyxuOza.js";import"./VisuallyHiddenInput-DLf9WDkl.js";import"./VisuallyHidden-CWjcrOI1.js";import"./thumbs-up-YHrzt8xi.js";import"./useNonce-B3K-CMV_.js";import"./DialogTrigger-BWGQ_6jK.js";import"./lock-DfHLDu8Q.js";import"./target-5EpjOSs_.js";import"./book-open-CWJ86bNf.js";import"./search-DeJ4_h6v.js";import"./Checkbox.vue_vue_type_script_setup_true_lang-CnW7GxJj.js";import"./ohash.D__AXeF1-C-E83dC9.js";import"./RovingFocusItem-BRizaEdi.js";import"./file-text-MoFYUjiJ.js";import"./TooltipTrigger.vue_vue_type_script_setup_true_lang-CppFsSbV.js";import"./coins-BCKUMIwG.js";import"./arrow-right-BhOH58WS.js";const Ao={key:0,class:"fixed bottom-20 left-1/2 z-50 -translate-x-1/2 px-3"},$o={class:"flex items-center gap-3 rounded-full border bg-background/95 px-4 py-2 shadow-lg backdrop-blur"},Eo={class:"ml-1 flex items-center gap-1"},Ro=Me({__name:"ChapterStarterOverlay",props:{show:{type:Boolean},isGenerating:{type:Boolean}},emits:["regenerate","dismiss"],setup(C,{emit:a}){const v=a;return(h,i)=>(l(),O(Se,{name:"slide-up"},{default:p(()=>[h.show?(l(),_("div",Ao,[s("div",$o,[r(e(tt),{class:"h-4 w-4 shrink-0 text-primary"}),i[2]||(i[2]=s("span",{class:"text-sm"},"AI suggests an opening",-1)),i[3]||(i[3]=s("kbd",{class:"rounded bg-muted px-1.5 py-0.5 text-xs"},"Tab",-1)),i[4]||(i[4]=s("span",{class:"text-xs text-muted-foreground"},"to accept",-1)),s("div",Eo,[r(e(f),{variant:"ghost",size:"icon",class:"h-6 w-6",disabled:h.isGenerating,title:"Regenerate",onClick:i[0]||(i[0]=w=>v("regenerate"))},{default:p(()=>[r(e(oo),{class:L(["h-3 w-3",{"animate-spin":h.isGenerating}])},null,8,["class"])]),_:1},8,["disabled"]),r(e(f),{variant:"ghost",size:"icon",class:"h-6 w-6",title:"Dismiss",onClick:i[1]||(i[1]=w=>v("dismiss"))},{default:p(()=>[r(e(ot),{class:"h-3 w-3"})]),_:1})])])])):z("",!0)]),_:1}))}}),Oo=st(Ro,[["__scopeId","data-v-d5492de7"]]),Lo={class:"flex flex-col h-full bg-transparent"},Io={class:"p-4 border-b border-border/50 flex justify-between items-start bg-background/50 backdrop-blur-sm"},Po={class:"flex items-center gap-2"},Bo={class:"p-1.5 rounded-md bg-primary/10 text-primary"},Fo={key:0,class:"px-4 py-2 bg-muted/30 border-b border-border/50 text-xs flex gap-3 text-muted-foreground"},Uo={key:0,class:"ml-auto text-amber-600 dark:text-amber-400 font-medium flex items-center gap-1"},Ho={class:"space-y-6"},Go={key:0,class:"flex flex-col items-center justify-center text-center py-12 px-4 space-y-4 opacity-0 animate-in fade-in slide-in-from-bottom-4 duration-700 fill-mode-forwards"},Do={class:"w-12 h-12 rounded-full bg-primary/5 flex items-center justify-center mb-2"},qo={class:"grid grid-cols-1 gap-2 w-full max-w-xs mt-4"},No={class:"space-y-1"},Wo=["innerHTML"],Ko={key:1,class:"flex gap-3"},Vo={class:"w-8 h-8 rounded-full bg-muted flex items-center justify-center shrink-0"},Qo={class:"p-4 border-t border-border/50 bg-background/50 backdrop-blur-sm"},Xo={class:"relative"},Yo=Me({__name:"ManualChatSidebar",props:{messages:{},isLoading:{type:Boolean},analysis:{}},emits:["send","close"],setup(C,{emit:a}){const v=C,h=a,i=u(""),w=u(null),k=()=>{i.value.trim()&&!v.isLoading&&(h("send",i.value),i.value="")},I=c=>{c.key==="Enter"&&!c.shiftKey&&(c.preventDefault(),k())};return ne(()=>v.messages.length,async()=>{if(await Ht(),w.value){const c=w.value.$el.querySelector("[data-radix-scroll-area-viewport]");c&&(c.scrollTop=c.scrollHeight)}}),(c,d)=>(l(),_("div",Lo,[s("div",Io,[s("div",null,[s("div",Po,[s("div",Bo,[r(e(ao),{class:"w-4 h-4"})]),d[4]||(d[4]=s("h3",{class:"font-semibold text-foreground"},"AI Assistant",-1))]),d[5]||(d[5]=s("p",{class:"text-xs text-muted-foreground mt-1 ml-1"},"Context-aware writing companion",-1))]),r(e(f),{variant:"ghost",size:"icon",class:"h-8 w-8 -mr-2",onClick:d[0]||(d[0]=m=>c.$emit("close"))},{default:p(()=>[r(e(ot),{class:"w-4 h-4"})]),_:1})]),c.analysis?(l(),_("div",Fo,[s("span",null,x(c.analysis.word_count)+" words",1),d[6]||(d[6]=s("span",null,"â€¢",-1)),s("span",null,x(c.analysis.citation_count)+" citations",1),c.analysis.detected_issues.length>0?(l(),_("span",Uo,x(c.analysis.detected_issues.length)+" issues ",1)):z("",!0)])):z("",!0),r(e(ro),{ref_key:"messagesContainer",ref:w,class:"flex-1 p-4"},{default:p(()=>[s("div",Ho,[c.messages.length===0?(l(),_("div",Go,[s("div",Do,[r(e(tt),{class:"w-6 h-6 text-primary/60"})]),d[9]||(d[9]=s("div",{class:"space-y-1"},[s("h4",{class:"font-medium text-foreground"},"How can I help?"),s("p",{class:"text-sm text-muted-foreground max-w-[240px]"}," I can help you structure your arguments, find citations, or rephrase complex sentences. ")],-1)),s("div",qo,[r(e(f),{variant:"outline",size:"sm",class:"justify-start h-auto py-2 text-xs font-normal",onClick:d[1]||(d[1]=m=>{i.value="Analyze the structure of this chapter",k()})},{default:p(()=>[...d[7]||(d[7]=[H(' "Analyze the structure of this chapter" ',-1)])]),_:1}),r(e(f),{variant:"outline",size:"sm",class:"justify-start h-auto py-2 text-xs font-normal",onClick:d[2]||(d[2]=m=>{i.value="Suggest some relevant citations",k()})},{default:p(()=>[...d[8]||(d[8]=[H(' "Suggest some relevant citations" ',-1)])]),_:1})])])):z("",!0),(l(!0),_(et,null,Gt(c.messages,(m,g)=>(l(),_("div",{key:g,class:L(["flex gap-3 max-w-[90%]",m.role==="user"?"ml-auto flex-row-reverse":""])},[s("div",{class:L(["w-8 h-8 rounded-full flex items-center justify-center shrink-0 text-xs font-medium",m.role==="user"?"bg-primary text-primary-foreground":"bg-muted text-muted-foreground"])},x(m.role==="user"?"You":"AI"),3),s("div",No,[s("div",{class:L(["p-3 rounded-2xl text-sm shadow-sm",m.role==="user"?"bg-primary text-primary-foreground rounded-tr-sm":"bg-card border text-card-foreground rounded-tl-sm"])},[s("div",{innerHTML:m.content,class:"prose prose-sm dark:prose-invert max-w-none break-words"},null,8,Wo)],2),s("p",{class:L(["text-[10px] text-muted-foreground opacity-70 px-1",m.role==="user"?"text-right":""])},x(new Date(m.timestamp).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})),3)])],2))),128)),c.isLoading?(l(),_("div",Ko,[s("div",Vo,[r(e(rt),{class:"w-4 h-4 animate-spin text-muted-foreground"})]),d[10]||(d[10]=s("div",{class:"bg-card border px-4 py-3 rounded-2xl rounded-tl-sm text-sm text-muted-foreground shadow-sm"}," Thinking... ",-1))])):z("",!0)])]),_:1},512),s("div",Qo,[s("div",Xo,[r(e(so),{modelValue:i.value,"onUpdate:modelValue":d[3]||(d[3]=m=>i.value=m),placeholder:"Ask anything about your chapter...",onKeydown:I,disabled:c.isLoading,class:"pr-10 py-6 bg-background/80 border-border/60 focus-visible:ring-primary/20 shadow-sm"},null,8,["modelValue","disabled"]),r(e(f),{onClick:k,disabled:c.isLoading||!i.value.trim(),size:"icon",class:L(["absolute right-1.5 top-1.5 h-9 w-9 transition-all duration-200",i.value.trim()?"opacity-100 scale-100":"opacity-70 scale-90"])},{default:p(()=>[r(e(no),{class:"w-4 h-4"})]),_:1},8,["disabled","class"])]),d[11]||(d[11]=s("p",{class:"text-[10px] text-center text-muted-foreground mt-2"}," AI can make mistakes. Review generated content. ",-1))])]))}});function Zo(C,a=[]){const v=u(!1),h=u(a),i=u(!1),w=u(null);return{isChatOpen:v,messages:h,isLoading:i,toggleChat:()=>{v.value=!v.value},sendMessage:async c=>{if(c.trim()){h.value.push({role:"user",content:c,timestamp:new Date}),i.value=!0;try{const m=(await ie.post(B("projects.manual-editor.chat",{project:C.project.slug,chapter:C.chapter_number}),{message:c,history:h.value})).data.message;h.value.push({role:"assistant",content:m,timestamp:new Date});const g=Xt(m||"");if(g>0)try{await at(g,"Manual editor: Chat","chapter",C.id),await w.value?.()}catch(M){console.error("Failed to record word usage (manual chat):",M)}}catch(d){console.error("Failed to send chat message:",d),h.value.push({role:"assistant",content:"I'm having trouble responding right now. Please try again.",timestamp:new Date})}finally{i.value=!1}}},setOnUsageRecorded:c=>{w.value=c}}}const Jo=C=>C?C.replace(/<style[\s\S]*?<\/style>/gi,"").replace(/<script[\s\S]*?<\/script>/gi,"").replace(/<[^>]+>/g," ").replace(/&nbsp;/gi," ").replace(/\s+/g," ").trim():"",ke=C=>Jo(C).length===0,es=C=>{const v=C.trim().match(/^```[a-zA-Z0-9_-]*\s*\n([\s\S]*?)\n?```$/);return v?v[1].trim():C};function ts(C,a,v,h){const i=u(null),w=u(!1),k=u(!1),I=async()=>{if(!w.value&&!(h?.canGenerate&&!h.canGenerate())&&ke(v.value)){w.value=!0;try{await ie.get("/sanctum/csrf-cookie");const m=await ie.post(B("api.projects.chapters.generate-starter",{project:C,chapter:a.chapter_number})),g=es(String(m.data?.starter??"")).trim().replace(/^\s*html\s*/i,"");i.value=g||null,k.value=!!i.value}catch(m){throw i.value=null,k.value=!1,m}finally{w.value=!1}}},c=()=>{k.value=!1,i.value=null},d=()=>{k.value=!1,i.value=null};return he(()=>{ke(v.value)&&I().catch(()=>{})}),ne(v,m=>{ke(m)||(k.value=!1,i.value=null)},{flush:"post"}),{starterText:i,isGenerating:w,showStarter:k,generateStarter:I,acceptStarter:c,dismissStarter:d}}function os(C,a,v){const h=u(null),i=u(!1),w=u(0),k=u(null),I=async M=>{k.value=M;const E=++w.value;if(!M.textBefore.trim()){h.value=null;return}i.value=!0;try{await ie.get("/sanctum/csrf-cookie");const Z=await ie.post(B("api.projects.chapters.autocomplete",{project:C,chapter:a}),{text_before:M.textBefore,text_after:M.textAfter,chapter_number:M.chapterNumber,chapter_title:M.chapterTitle,chapter_outline:M.chapterOutline,section_heading:M.sectionHeading,section_outline:M.sectionOutline,project_topic:M.projectTopic});if(E!==w.value)return;const le=String(Z.data?.completion??"").replace(/\s+$/g,"");h.value=le||null}catch(Z){if(E!==w.value)return;throw h.value=null,Z}finally{E===w.value&&(i.value=!1)}},c=bo(I,500);return{ghostText:h,isLoading:i,debouncedRequest:c,requestCompletion:I,acceptSuggestion:()=>{h.value=null},dismissSuggestion:()=>{h.value=null},triggerManually:async()=>{k.value&&await I(k.value)},editorRef:v}}const ss={class:"manual-editor h-screen flex flex-col bg-background dark:bg-background transition-colors duration-300"},rs={class:"md:hidden border-b h-14 px-3 flex justify-between items-center bg-background/80 backdrop-blur-md sticky top-0 z-50 transition-all duration-200"},as={class:"flex items-center gap-2"},ns={class:"flex flex-col justify-center min-w-0 flex-1 mx-2"},is={class:"items-center gap-2 text-xs font-medium text-muted-foreground mb-1 hidden sm:flex"},ls={class:"flex items-center gap-2 -ml-1"},cs={class:"font-bold text-base text-foreground truncate"},ds={class:"truncate"},us={class:"flex gap-2 items-center"},ps={class:"hidden md:flex flex-col w-full z-50 sticky top-0 bg-background/80 backdrop-blur-md transition-all duration-200 border-b"},ms={id:"editor-header",class:"h-10 border-b border-border/40 flex items-center justify-center px-4 bg-background/60 relative"},hs={class:"flex items-center gap-2"},gs={id:"chapter-nav-buttons",class:"flex items-center gap-1 absolute right-4"},fs={class:"h-12 flex items-center justify-between px-4 bg-background/40"},vs={id:"left-controls",class:"flex items-center gap-3"},bs={class:"flex items-center gap-1"},xs={id:"save-status",class:"flex items-center gap-2 px-3 py-1.5 rounded-full bg-muted/30 border border-border/40"},ws={class:"flex items-center gap-1.5"},ys={class:"text-xs font-medium text-muted-foreground"},_s={key:0,class:"flex items-center gap-1.5"},Cs={key:1,class:"text-xs text-muted-foreground"},ks={class:"flex items-center gap-3"},Ss={id:"view-controls",class:"flex items-center gap-1 bg-muted/30 p-1 rounded-full border border-border/40"},Ms={id:"credit-display"},Ts={id:"export-menu-container"},js={class:"text-xs font-medium"},zs={id:"progress-bar-section",class:"w-full bg-background border-b px-3 md:px-6 py-2 flex flex-col gap-1"},As={class:"flex justify-between items-center text-xs text-muted-foreground mb-1"},$s={class:"flex-1 flex overflow-hidden"},Es={key:0,id:"left-sidebar-panel",class:"w-[320px] border-r bg-background/80 backdrop-blur-xl border-border/50 shadow-xl z-20 overflow-y-auto custom-scrollbar"},Rs={class:"p-4"},Os={class:"mb-3"},Ls={class:"text-xs text-muted-foreground"},Is={class:"flex-1 overflow-auto p-2 md:p-6 bg-background"},Ps={key:0,class:"w-1/2 flex flex-col bg-background overflow-hidden"},Bs={class:"flex-1 overflow-y-auto custom-scrollbar"},Fs={key:0,id:"right-sidebar-panel",class:"w-[400px] border-l bg-background/80 backdrop-blur-xl border-border/50 shadow-2xl z-20 overflow-y-auto custom-scrollbar flex flex-col"},Us={key:0,class:"flex-1 overflow-hidden"},Hs={class:"h-full border-b border-border/50"},Gs={key:1,class:"p-4 space-y-6"},Ds={key:0,class:"space-y-2"},qs={key:1,class:"space-y-2"},Ns={class:"flex items-center justify-between"},Ws={class:"text-xs whitespace-pre-wrap rounded-lg border border-border/50 bg-muted/30 p-3"},Ks={class:"space-y-2"},Vs={id:"editor-footer",class:"border-t p-2 md:p-3 flex flex-col gap-3 text-xs md:text-sm bg-muted/30"},Qs={class:"flex flex-col sm:flex-row justify-between gap-3 sm:gap-2 items-start sm:items-center w-full"},Xs={id:"footer-stats",class:"flex gap-2 md:gap-4 flex-wrap items-center"},Ys={class:"text-muted-foreground"},Zs={class:"text-foreground"},Js={key:0,class:"text-muted-foreground hidden sm:inline"},er={class:"text-foreground"},tr={key:1,class:"text-muted-foreground hidden md:inline"},or={class:"text-foreground"},sr={key:2,class:"text-muted-foreground hidden lg:inline"},rr={class:"flex gap-2 items-center w-full sm:w-auto"},ar={class:"text-xs font-medium"},nr=Me({__name:"ManualEditor",props:{project:{},chapter:{},allChapters:{},facultyChapters:{},currentSuggestion:{},contextAnalysis:{},initialProgressGuidance:{},chatHistory:{}},setup(C){const a=C,v=Dt();ne(()=>v.props?.flash,t=>{t&&(t.success&&y.success(t.success),t.error&&y.error(t.error))},{deep:!0,immediate:!0});const{wordBalance:h,balance:i,showPurchaseModal:w,requiredWordsForModal:k,actionDescriptionForModal:I,checkAndPrompt:c,closePurchaseModal:d,refreshBalance:m}=vo(),{content:g,isDirty:M,isSaving:E,lastSaved:Z,updateContent:Te,manualSave:le}=Yt(a.chapter,a.project.slug),{currentSuggestion:ge,currentAnalysis:T,isAnalyzing:fe,saveSuggestion:je,clearSuggestion:ze,applySuggestion:Ae}=Zt(a.chapter,a.project.slug,a.currentSuggestion,g,{onUsageRecorded:()=>m()}),{addToHistory:nt}=lo(a.chapter.content||""),V=u(null),{isChatOpen:$e,messages:it,isLoading:lt,toggleChat:ct,sendMessage:dt,setOnUsageRecorded:ut}=Zo(a.chapter,a.chatHistory||[]);ut(()=>m());const Ee=u(a.chapter.title||"");u(!1),u(!1),u("");const Re=()=>{ee.value&&Oe(),j.value=!0,ct()},J=t=>{Te(t),nt(t),Et()};N(()=>{const t=Ee.value?.trim(),o=g.value?.trim();return!!(t&&t.length>0&&o&&o.length>50)});const pt=()=>typeof window<"u"&&window.innerWidth<1024,ce=(t,o)=>{try{const n=localStorage.getItem(t);return n!==null?n==="true":o}catch{return o}},A=u(pt()),R=u(ce("manualEditor_showLeftSidebar",!A.value)),j=u(ce("manualEditor_showRightSidebar",!A.value)),ve=u(""),be=u(null),oe=u("");u(!1),u([]),u(!1);const G=u(!0),ee=u((()=>{try{return localStorage.getItem("citationOperationMode")==="true"}catch{return!1}})()),mt=()=>{ee.value=!0,j.value=!1;try{localStorage.setItem("citationOperationMode","true")}catch{}},Oe=()=>{ee.value=!1,j.value=!0;try{localStorage.setItem("citationOperationMode","false")}catch{}},Le=u(!1),ht=async()=>{y.info("Fullscreen temporarily disabled")},gt=()=>{W.visit(B("projects.analysis",{project:a.project.slug}))};he(()=>{}),Xe(()=>{});const{isDark:Ie,toggle:ft}=qt(),vt=N(()=>{const t=T.value?.word_count??a.chapter.word_count,o=a.chapter.target_word_count||1e3;return Math.min(t/o*100,100)});N(()=>E.value?"Saving...":Z.value?`Saved ${Z.value}`:"Not saved");const bt=()=>{R.value=!R.value},xt=()=>{j.value=!j.value},wt=()=>c(200,"generate chapter starter"),{starterText:de,isGenerating:yt,showStarter:D,generateStarter:_t,acceptStarter:Ct,dismissStarter:Pe}=ts(a.project.slug,a.chapter,g,{canGenerate:wt}),kt=N(()=>{const t=a.facultyChapters||[],o=t.find(b=>b?.chapter_number===a.chapter.chapter_number)??t.find(b=>b?.number===a.chapter.chapter_number);if(!o)return"";const n=[];if(o.description&&n.push(String(o.description)),Array.isArray(o.sections))for(const b of o.sections){if(!b)continue;const P=(b.title??b.section_title??"").toString().trim(),Q=(b.description??b.section_description??"").toString().trim();P&&Q?n.push(`${P}: ${Q}`):P&&n.push(P)}return n.join(`
`)}),{ghostText:Be,isLoading:St,debouncedRequest:Mt,requestCompletion:Tt,acceptSuggestion:jt,dismissSuggestion:zt}=os(a.project.slug,a.chapter.chapter_number,V),At=N(()=>D.value&&de.value?de.value:Be.value),$t=N(()=>D.value&&de.value?"html":"text");function Fe(){const t=V.value?.editor?.();if(!t)return null;const o=t.state.selection;if(!o.empty||D.value)return null;const n=t.state.doc,b=o.from,P=o.to,Q=Math.max(0,b-2500),me=Math.min(n.content.size,P+500),re=n.textBetween(Q,b,`
`,`
`),Qe=n.textBetween(P,me,`
`,`
`);let U="",te=0;const S=Math.max(0,b-8e3);n.nodesBetween(S,b,($,F)=>{$.type?.name==="heading"&&F<b&&(U=$.textContent||"",te=F)}),U&&b-te>2e3&&(U="");let X="";if(U){const $=(a.facultyChapters||[]).find(q=>q?.chapter_number===a.chapter.chapter_number||q?.number===a.chapter.chapter_number),F=Array.isArray($?.sections)?$.sections:[],_e=U.trim().toLowerCase(),Y=F.find(q=>{const ae=(q?.title??q?.section_title??"").toString().trim().toLowerCase();return ae&&ae===_e});if(Y){const q=(Y.title??Y.section_title??"").toString().trim(),ae=(Y.description??Y.section_description??"").toString().trim();X=ae?`${q}: ${ae}`:q}}return{textBefore:re,textAfter:Qe,chapterNumber:a.chapter.chapter_number,chapterTitle:Ee.value||a.chapter.title||"",chapterOutline:kt.value||"",sectionHeading:U.trim(),sectionOutline:X.trim(),projectTopic:a.project?.topic||""}}function Et(){if(D.value||St.value||Be.value)return;const t=Fe();t&&Mt(t).catch(()=>{})}const Rt=async()=>{try{await _t()}catch(t){console.error("Failed to generate starter:",t),y.error("Failed to generate starter")}};ne(R,t=>{if(!A.value)try{localStorage.setItem("manualEditor_showLeftSidebar",String(t))}catch(o){console.error("Failed to save left sidebar state:",o)}}),ne(j,t=>{if(!A.value)try{localStorage.setItem("manualEditor_showRightSidebar",String(t))}catch(o){console.error("Failed to save right sidebar state:",o)}});const Ue=t=>{(t.ctrlKey||t.metaKey)&&t.key==="s"&&(t.preventDefault(),pe())};he(()=>{A.value=window.innerWidth<1024,A.value&&(R.value=!1,j.value=!1);const t=()=>{const o=A.value;A.value=window.innerWidth<1024,o!==A.value&&(A.value?(R.value=!1,j.value=!1):(R.value=ce("manualEditor_showLeftSidebar",!0),j.value=ce("manualEditor_showRightSidebar",!0)))};window.addEventListener("resize",t),window.addEventListener("keydown",Ue),Xe(()=>{window.removeEventListener("resize",t),window.removeEventListener("keydown",Ue)})});const He=t=>{J(t),y.success("Applied improved text")},Ge=t=>{if(V.value?.replaceSelection(t,be.value||void 0)??!1){y.success("Expanded selection");return}J(`${g.value}

${t}`),y.success("Added expanded text")},De=t=>{oe.value=t,G.value=!0;try{navigator.clipboard?.writeText(t)}catch{}y.success("Citation suggestions ready")},qe=t=>{if(V.value?.replaceSelection(t,be.value||void 0)??!1){y.success("Applied rephrased text");return}J(`${g.value}

${t}`),y.success("Added rephrased text")},Ne=(t,o)=>c(t,o),ue=async(t,o)=>{const n=Math.max(0,Math.round(t||0));n&&(await at(n,o,"chapter",a.chapter.id),await m())},Ot=t=>t.replace(/<[^>]*>/g," "),Lt=t=>Ot(t).split(/\s+/).filter(Boolean).length,It=async t=>{const o=Lt(t);if(D.value){Ct(),await ue(o,"chapter starter accepted");return}jt(),await ue(o,"autocomplete accepted")},Pt=()=>{if(D.value){Pe();return}zt()},Bt=async()=>{if(D.value)return;const t=Fe();if(t)try{await Tt(t)}catch(o){console.error("Failed to autocomplete:",o),y.error("Autocomplete failed")}},Ft=async()=>{if(oe.value)try{await navigator.clipboard.writeText(oe.value),y.success("Copied citation suggestions")}catch{y.error("Could not copy citation suggestions")}},xe=N(()=>a.allChapters.find(t=>t.chapter_number===a.chapter.chapter_number-1)),we=N(()=>a.allChapters.find(t=>t.chapter_number===a.chapter.chapter_number+1)),ye=(t,o)=>{if(o&&g.value){const b=o.trim(),P=document.createElement("div");P.innerHTML=g.value;const Q=P.textContent||P.innerText||"",me=Q.indexOf(b);if(me!==-1){const re=me+b.length,U=Q.substring(re).match(/^[^.!?]*[.!?]/);let te;U?te=re+U[0].length:te=re;let S=0,X=0;const $=g.value;for(;S<$.length&&X<te;)if($[S]==="<"){for(;S<$.length&&$[S]!==">";)S++;S++}else if($[S]==="&"){const F=$.indexOf(";",S);F!==-1&&F-S<10?(S=F+1,X++):(S++,X++)}else S++,X++;if(S>0){const F=$.substring(0,S),_e=$.substring(S),Y=`${F} ${t}${_e}`;J(Y),y.success("Citation inserted at claim location");return}}}const n=V.value?.getCursorPosition?.();if(typeof n=="number"&&(V.value?.replaceTextAt?.({from:n,to:n},` ${t} `)??!1)){y.success("Citation inserted at cursor");return}J(`${g.value} ${t}`),y.success("Citation appended to content")},se=t=>{M.value&&!confirm("You have unsaved changes. Are you sure you want to switch chapters?")||W.visit(B("projects.manual-editor.show",{project:a.project.slug,chapter:t}))},We=()=>{const t=a.chapter.chapter_number+1;a.allChapters.find(n=>n.chapter_number===t)?se(t):y.info("Please create the next chapter from the dashboard first.")},Ke=t=>{confirm("Are you sure you want to delete this chapter?")&&W.delete(B("chapters.destroy",{project:a.project.slug,chapter:a.allChapters.find(o=>o.id===t)?.slug}),{onSuccess:()=>y.success("Chapter deleted")})},pe=async()=>{try{await le(),y.success("Chapter saved successfully")}catch{y.error("Failed to save chapter")}},Ut=async()=>{console.log("ðŸ”µ [MARK COMPLETE] Function called"),console.log("ðŸ”µ [MARK COMPLETE] Current word count:",T.value?.word_count??a.chapter.word_count);try{console.log("ðŸ”µ [MARK COMPLETE] Saving chapter..."),await le(),console.log("âœ… [MARK COMPLETE] Chapter saved");const t=B("projects.manual-editor.mark-complete",{project:a.project.slug,chapter:a.chapter.chapter_number});console.log("ðŸ”µ [MARK COMPLETE] Posting to:",t),W.post(t,{},{onSuccess:()=>{console.log("âœ… [MARK COMPLETE] Request successful")},onError:o=>{console.error("âŒ [MARK COMPLETE] Request failed:",o)}})}catch(t){console.error("âŒ [MARK COMPLETE] Error:",t),y.error("Failed to save chapter before marking complete")}},Ve=()=>{const t=[{popover:{title:"Welcome to the AI Assisted Editor",description:"Experience a powerful writing environment enhanced by AI. Use the Smart Chapter Starter to kickstart your writing, leverage auto-completion for faster drafting, and access a suite of AI tools to refine your content.",popoverClass:"driver-popover-welcome"}},{element:"#back-to-project-btn",popover:{title:"Back to Project",description:"Return to your project dashboard."}},{element:"#left-sidebar-panel",popover:{title:"Chapter Navigation",description:"Use the Table of Contents to switch between chapters."},onHighlightStarted:()=>{R.value=!0},showOnMobile:!1},{element:"#save-status",popover:{title:"Status & Word Count",description:"Check your save status and current word count at a glance."}},{element:"#manual-editor-toolbar",popover:{title:"Formatting Tools",description:"Use these tools to format your text, add links, headings, and lists."}},{element:"#view-controls",popover:{title:"View Options",description:"Customize your writing experience with dark mode, full screen, AI chat, and tool sidebars."}},{element:"#toggle-chat-mode",popover:{title:"AI Chat Assistant",description:"Open the AI assistant to help you write, brainstorm, or refine your content."}},{element:"#toggle-right-sidebar",popover:{title:"Writing Tools Sidebar",description:"Toggle this sidebar to access efficient writing tools."},showOnMobile:!1},{element:"#right-sidebar-panel",popover:{title:"Writing Tools",description:"Access quick tools like Smart Suggestions, Quick Actions (Expand, Rephrase), and more."},onHighlightStarted:()=>{j.value=!0},showOnMobile:!1},{element:"#credit-display",popover:{title:"Credits",description:"Keep track of your AI credits. Remember, using AI tools consumes credits."}},{element:"#top-up-btn",popover:{title:"Top Up",description:"Running low? Click here to purchase more credits."}},{element:"#export-menu-container",popover:{title:"Export",description:"Export your chapter or entire project in various formats."}},{element:"#analyze-button",popover:{title:"Bulk Analysis",description:"Analyze multiple chapters at once for comprehensive insights."}},{element:"#progress-bar-section",popover:{title:"Writing Progress",description:"Track your progress towards the chapter word count goal."}},{element:"#editor-footer",popover:{title:"Footer Controls",description:"View detailed stats like citations and quality metrics, and clear actions."}},{element:"#mark-complete-btn",popover:{title:"Mark as Complete",description:"Finished writing? Mark the chapter as complete to proceed."}},{element:"#save-button",popover:{title:"Save Work",description:"Manually save your chapter. Auto-save is also active!"}},{element:"#reset-tour-button",popover:{title:"Need Help?",description:"Click here anytime to restart this tour."}}];Wt({showProgress:!0,animate:!0,steps:A.value?t.filter(b=>b.showOnMobile!==!1):t}).drive();const n=v.props.auth.user;n?.email&&localStorage.setItem(`manual_editor_tour_seen_${n.email}`,"true")};return he(()=>{const t=v.props.auth.user;t?.email&&(localStorage.getItem(`manual_editor_tour_seen_${t.email}`)||setTimeout(()=>{Ve()},1e3))}),(t,o)=>(l(),_(et,null,[r(e(Nt),{title:`${t.chapter.title} - Manual Editor`},null,8,["title"]),s("div",ss,[s("header",rs,[s("div",as,[r(e(f),{variant:"ghost",size:"icon",class:"h-8 w-8 text-zinc-700 dark:text-zinc-300 hover:text-foreground",onClick:o[0]||(o[0]=n=>e(W).visit(e(B)("projects.show",t.project.slug))),title:"Back to Project"},{default:p(()=>[r(e(Ze),{class:"w-4 h-4"})]),_:1}),r(e(K),{orientation:"vertical",class:"h-6"}),r(e(f),{onClick:o[1]||(o[1]=n=>R.value=!0),variant:"ghost",size:"icon",class:"h-8 w-8 lg:hidden text-muted-foreground hover:text-foreground",title:"Open Chapter Navigation"},{default:p(()=>[r(e(xo),{class:"w-4 h-4"})]),_:1})]),s("div",ns,[s("div",is,[s("span",{class:"hover:text-foreground transition-colors cursor-pointer truncate",onClick:o[2]||(o[2]=n=>e(W).visit(e(B)("projects.show",t.project.slug)))},x(t.project.title),1)]),s("div",ls,[s("div",cs,[s("span",ds,"Ch. "+x(t.chapter.chapter_number),1)])])]),s("div",us,[r(e(f),{variant:"ghost",size:"icon",class:"h-8 w-8",onClick:pe,disabled:e(E),title:"Save"},{default:p(()=>[r(e(Ce),{class:"w-4 h-4"})]),_:1},8,["disabled"]),r(e(K),{orientation:"vertical",class:"h-6 mx-1 opacity-50"}),r(e(f),{onClick:o[3]||(o[3]=n=>j.value=!0),variant:"ghost",size:"icon",class:"h-8 w-8 text-muted-foreground hover:text-foreground",title:"Open Tools"},{default:p(()=>[r(e(Je),{class:"w-4 h-4"})]),_:1})])]),s("div",ps,[s("div",ms,[s("div",hs,[s("h1",{id:"project-title-link",class:"text-sm font-bold text-foreground cursor-pointer hover:text-primary transition-colors",onClick:o[4]||(o[4]=n=>e(W).visit(e(B)("projects.show",t.project.slug)))},x(t.project.title),1),r(e(Kt),{id:"chapter-badge",variant:"secondary",class:"h-5 px-2 text-[10px] rounded-full"},{default:p(()=>[H("Ch "+x(t.chapter.chapter_number),1)]),_:1})]),s("div",gs,[xe.value?(l(),O(e(f),{key:0,variant:"ghost",size:"sm",class:"h-6 px-2 text-zinc-500 hover:text-foreground gap-1 rounded-full text-[10px]",onClick:o[5]||(o[5]=n=>se(xe.value.chapter_number)),title:`Previous: ${xe.value.title}`},{default:p(()=>[r(e(wo),{class:"w-3 h-3"}),o[17]||(o[17]=H(" Prev ",-1))]),_:1},8,["title"])):z("",!0),we.value?(l(),O(e(f),{key:1,variant:"ghost",size:"sm",class:"h-6 px-2 text-zinc-500 hover:text-foreground gap-1 rounded-full text-[10px]",onClick:o[6]||(o[6]=n=>se(we.value.chapter_number)),title:`Next: ${we.value.title}`},{default:p(()=>[o[18]||(o[18]=H(" Next ",-1)),r(e(yo),{class:"w-3 h-3"})]),_:1},8,["title"])):z("",!0)])]),s("div",fs,[s("div",vs,[s("div",bs,[r(e(f),{id:"back-to-project-btn",variant:"ghost",size:"icon",class:"h-8 w-8 text-zinc-700 dark:text-zinc-300 hover:text-foreground rounded-full",onClick:o[7]||(o[7]=n=>e(W).visit(e(B)("projects.show",t.project.slug))),title:"Back to Project"},{default:p(()=>[r(e(Ze),{class:"w-4 h-4"})]),_:1}),o[19]||(o[19]=s("div",{class:"h-4 w-px bg-border/50 mx-1"},null,-1)),r(e(f),{id:"toggle-left-sidebar",onClick:bt,variant:"ghost",size:"icon",class:L(["h-8 w-8 transition-all duration-300 rounded-full",R.value?"text-primary":"text-zinc-700 dark:text-zinc-300 hover:text-foreground"]),title:"Toggle Chapter Navigation"},{default:p(()=>[R.value?(l(),O(e(_o),{key:0,class:"w-4 h-4"})):(l(),O(e(Co),{key:1,class:"w-4 h-4"}))]),_:1},8,["class"])]),o[21]||(o[21]=s("div",{class:"h-4 w-px bg-border/50"},null,-1)),s("div",xs,[s("div",ws,[s("div",{class:L(["w-2 h-2 rounded-full transition-colors duration-300",e(M)?"bg-amber-500 animate-pulse":"bg-emerald-500"])},null,2),s("span",ys,x(e(M)?"Unsaved":"Saved"),1)]),r(e(K),{orientation:"vertical",class:"h-3"}),e(fe)?(l(),_("div",_s,[r(e(rt),{class:"w-3 h-3 animate-spin text-primary"}),o[20]||(o[20]=s("span",{class:"text-xs text-muted-foreground"},"Analyzing",-1))])):(l(),_("div",Cs,x(e(T)?.word_count??t.chapter.word_count)+" words ",1))])]),o[24]||(o[24]=s("div",{class:"flex-1 px-4 min-w-0"},[s("div",{id:"manual-editor-toolbar",class:"mx-auto max-w-[950px]"})],-1)),s("div",ks,[s("div",Ss,[r(e(f),{variant:"ghost",size:"icon",class:"h-7 w-7 rounded-full text-zinc-700 dark:text-zinc-300 hover:text-foreground",onClick:e(ft),title:e(Ie)?"Switch to Light Mode":"Switch to Dark Mode"},{default:p(()=>[e(Ie)?(l(),O(e(ko),{key:0,class:"w-4 h-4"})):(l(),O(e(So),{key:1,class:"w-4 h-4"}))]),_:1},8,["onClick","title"]),r(e(f),{variant:"ghost",size:"icon",class:"h-7 w-7 rounded-full text-zinc-700 dark:text-zinc-300 hover:text-foreground",onClick:ht,title:Le.value?"Exit Full Screen":"Enter Full Screen"},{default:p(()=>[Le.value?(l(),O(e(Mo),{key:0,class:"w-4 h-4"})):(l(),O(e(co),{key:1,class:"w-4 h-4"}))]),_:1},8,["title"]),r(e(f),{id:"toggle-chat-mode",onClick:Re,variant:"ghost",size:"icon",class:L(["h-7 w-7 rounded-full transition-all duration-300",e($e)?"bg-background shadow-sm text-primary":"text-zinc-700 dark:text-zinc-300 hover:text-foreground"]),title:"Toggle AI Chat Mode"},{default:p(()=>[r(e(Je),{class:"w-4 h-4"})]),_:1},8,["class"]),r(e(f),{id:"toggle-right-sidebar",onClick:xt,variant:"ghost",size:"icon",class:L(["h-7 w-7 rounded-full transition-all duration-300",j.value?"bg-background shadow-sm text-primary":"text-zinc-700 dark:text-zinc-300 hover:text-foreground"]),title:"Toggle Tools Sidebar"},{default:p(()=>[j.value?(l(),O(e(uo),{key:0,class:"w-4 h-4"})):(l(),O(e(po),{key:1,class:"w-4 h-4"}))]),_:1},8,["class"])]),o[23]||(o[23]=s("div",{class:"w-px h-4 bg-border/50"},null,-1)),s("div",Ms,[e(h)?(l(),O(go,{key:0,balance:e(h),compact:""},null,8,["balance"])):z("",!0)]),s("div",Ts,[r(mo,{project:t.project,"current-chapter":t.chapter,"all-chapters":t.allChapters,size:"sm",variant:"outline",class:"h-9","button-class":"rounded-full bg-background/50"},null,8,["project","current-chapter","all-chapters"])]),r(e(f),{id:"analyze-button",variant:"ghost",size:"sm",class:"h-9 gap-2 text-zinc-700 dark:text-zinc-300 hover:text-foreground rounded-full bg-background/50 border border-transparent hover:border-border/50",onClick:gt,title:"Open bulk analysis"},{default:p(()=>[r(e(To),{class:"w-4 h-4"}),o[22]||(o[22]=s("span",{class:"text-xs font-medium"},"Analyze",-1))]),_:1}),r(e(f),{id:"save-button",variant:"outline",size:"sm",class:"h-9 gap-2 text-zinc-700 dark:text-zinc-300 hover:text-foreground rounded-full bg-background/50",onClick:pe,disabled:e(E),title:"Save (Ctrl+S)"},{default:p(()=>[r(e(Ce),{class:"w-4 h-4"}),s("span",js,x(e(E)?"Saving...":"Save"),1)]),_:1},8,["disabled"]),r(e(f),{id:"reset-tour-button",variant:"ghost",size:"icon",class:"h-8 w-8 text-muted-foreground",onClick:Ve,title:"Restart Tour"},{default:p(()=>[r(e(jo),{class:"w-4 h-4"})]),_:1})])])]),s("div",zs,[s("div",As,[o[25]||(o[25]=s("span",{class:"font-medium"},"Writing Progress",-1)),s("span",null,x(e(T)?.word_count??t.chapter.word_count)+" / "+x(t.chapter.target_word_count)+" words",1)]),r(e(Vt),{"model-value":vt.value,class:"h-1.5"},null,8,["model-value"])]),s("div",$s,[r(Se,{"enter-active-class":"transition-all duration-500 cubic-bezier(0.4, 0, 0.2, 1)","enter-from-class":"-ml-[320px] opacity-0","enter-to-class":"ml-0 opacity-100","leave-active-class":"transition-all duration-500 cubic-bezier(0.4, 0, 0.2, 1)","leave-from-class":"ml-0 opacity-100","leave-to-class":"-ml-[320px] opacity-0"},{default:p(()=>[R.value&&!A.value?(l(),_("aside",Es,[s("div",Rs,[s("div",Os,[o[26]||(o[26]=s("h2",{class:"text-sm font-semibold text-foreground mb-1"},"Table of Contents",-1)),s("p",Ls,x(t.allChapters.length)+" Chapters",1)]),r(io,{"all-chapters":t.allChapters,"current-chapter":t.chapter,project:t.project,outlines:t.project.outlines||[],"faculty-chapters":t.facultyChapters||[],"current-word-count":e(T)?.word_count||t.chapter.word_count,"target-word-count":t.chapter.target_word_count,"writing-quality-score":0,"chapter-content-length":e(g)?.length||0,onGoToChapter:se,onGenerateNextChapter:We,onDeleteChapter:Ke},null,8,["all-chapters","current-chapter","project","outlines","faculty-chapters","current-word-count","target-word-count","chapter-content-length"])])])):z("",!0)]),_:1}),s("div",{class:L(["flex-1 flex overflow-hidden",ee.value?"flex-row":"flex-col"])},[s("div",{class:L(["flex flex-col overflow-hidden",ee.value?"w-1/2 border-r border-border/50":"flex-1"])},[s("div",Is,[r(Qt,{ref_key:"editorRef",ref:V,modelValue:e(g),"onUpdate:modelValue":J,"onUpdate:selectedText":o[8]||(o[8]=n=>ve.value=n),"onUpdate:selectionRange":o[9]||(o[9]=n=>be.value=n),"ghost-text":At.value,"ghost-text-format":$t.value,onGhostAccepted:It,onGhostDismissed:Pt,onGhostManualTrigger:Bt,"manual-mode":!0,"toolbar-teleport-target":A.value?"":"#manual-editor-toolbar",class:"min-h-full"},null,8,["modelValue","ghost-text","ghost-text-format","toolbar-teleport-target"])])],2),ee.value?(l(),_("div",Ps,[s("div",Bs,[r(Ye,{"show-citation-helper":G.value,"onUpdate:showCitationHelper":o[10]||(o[10]=n=>G.value=n),"chapter-content":e(g),"chapter-id":t.chapter.id,"citation-operation-mode":!0,onInsertCitation:ye,onExitOperationMode:Oe},null,8,["show-citation-helper","chapter-content","chapter-id"])])])):z("",!0)],2),r(Se,{"enter-active-class":"transition-all duration-500 cubic-bezier(0.4, 0, 0.2, 1)","enter-from-class":"-mr-[400px] opacity-0","enter-to-class":"mr-0 opacity-100","leave-active-class":"transition-all duration-500 cubic-bezier(0.4, 0, 0.2, 1)","leave-from-class":"mr-0 opacity-100","leave-to-class":"-mr-[400px] opacity-0"},{default:p(()=>[j.value&&!A.value?(l(),_("aside",Fs,[e($e)?(l(),_("div",Us,[s("div",Hs,[r(Yo,{messages:e(it),"is-loading":e(lt),analysis:e(T),class:"h-full",onSend:e(dt),onClose:Re},null,8,["messages","is-loading","analysis","onSend"])])])):(l(),_("div",Gs,[e(ge)?(l(),_("div",Ds,[r(Jt,{suggestion:e(ge),analysis:e(T),onSave:e(je),onClear:e(ze),onApply:e(Ae)},null,8,["suggestion","analysis","onSave","onClear","onApply"]),r(e(K),{class:"bg-border/50"})])):z("",!0),r(eo,{"project-slug":t.project.slug,"chapter-number":t.chapter.chapter_number,"selected-text":ve.value,"chapter-content":e(g),"is-processing":e(fe)||e(E),"ensure-balance":Ne,"on-usage":ue,onTextImproved:He,onTextExpanded:Ge,onCitationsSuggested:De,onTextRephrased:qe,onOpenCitationHelper:o[11]||(o[11]=n=>G.value=!0)},null,8,["project-slug","chapter-number","selected-text","chapter-content","is-processing"]),r(e(K),{class:"bg-border/50"}),oe.value?(l(),_("div",qs,[s("div",Ns,[o[28]||(o[28]=s("h3",{class:"text-sm font-semibold text-foreground"},"Citation Suggestions",-1)),r(e(f),{size:"sm",variant:"outline",onClick:Ft},{default:p(()=>[...o[27]||(o[27]=[H(" Copy ",-1)])]),_:1})]),s("pre",Ws,x(oe.value),1),r(e(K),{class:"bg-border/50"})])):z("",!0),s("div",Ks,[r(Ye,{"show-citation-helper":G.value,"onUpdate:showCitationHelper":o[12]||(o[12]=n=>G.value=n),"chapter-content":e(g),"chapter-id":t.chapter.id,onInsertCitation:ye,onEnterOperationMode:mt},null,8,["show-citation-helper","chapter-content","chapter-id"])]),r(e(K),{class:"bg-border/50"}),r(e(K),{class:"bg-border/50"})]))])):z("",!0)]),_:1}),r(to,{"show-left-sidebar":R.value,"show-right-sidebar":j.value,"is-mobile":A.value,"all-chapters":t.allChapters,"current-chapter":t.chapter,project:t.project,"faculty-chapters":t.facultyChapters,"current-word-count":e(T)?.word_count||t.chapter.word_count,"target-word-count":t.chapter.target_word_count,"chapter-content-length":e(g)?.length||0,"selected-text":ve.value,"is-analyzing":e(fe),"is-saving":e(E),"current-suggestion":e(ge),"current-analysis":e(T),"chapter-content":e(g),"show-citation-helper":G.value,"ensure-balance":Ne,"on-usage":ue,"onUpdate:showLeftSidebar":o[13]||(o[13]=n=>R.value=n),"onUpdate:showRightSidebar":o[14]||(o[14]=n=>j.value=n),"onUpdate:showCitationHelper":o[15]||(o[15]=n=>G.value=n),onGoToChapter:se,onGenerateNextChapter:We,onDeleteChapter:Ke,onSaveSuggestion:e(je),onClearSuggestion:e(ze),onApplySuggestion:e(Ae),onTextImproved:He,onTextExpanded:Ge,onCitationsSuggested:De,onTextRephrased:qe,onInsertCitation:ye},null,8,["show-left-sidebar","show-right-sidebar","is-mobile","all-chapters","current-chapter","project","faculty-chapters","current-word-count","target-word-count","chapter-content-length","selected-text","is-analyzing","is-saving","current-suggestion","current-analysis","chapter-content","show-citation-helper","onSaveSuggestion","onClearSuggestion","onApplySuggestion"])]),s("footer",Vs,[s("div",Qs,[s("div",Xs,[s("span",Ys,[o[29]||(o[29]=s("span",{class:"hidden sm:inline"},"Words: ",-1)),s("strong",Zs,x(e(T)?.word_count??t.chapter.word_count),1),H(" / "+x(t.chapter.target_word_count),1)]),e(T)?(l(),_("span",Js,[o[30]||(o[30]=H(" Citations: ",-1)),s("strong",er,x(e(T).citation_count),1)])):z("",!0),e(T)?(l(),_("span",tr,[o[31]||(o[31]=H(" Tables: ",-1)),s("strong",or,x(e(T).table_count),1)])):z("",!0),e(T)?(l(),_("span",sr," Quality: "+x(e(T).quality_metrics.reading_level),1)):z("",!0)]),s("div",rr,[r(e(f),{variant:"outline",size:"sm",class:"h-8 md:h-9 gap-2 flex-1 sm:flex-initial",onClick:pe,disabled:e(E),title:"Save chapter"},{default:p(()=>[r(e(Ce),{class:"w-3.5 h-3.5 md:w-4 md:h-4"}),s("span",ar,x(e(E)?"Saving...":"Save"),1)]),_:1},8,["disabled"]),r(e(f),{id:"mark-complete-btn",variant:"default",size:"sm",class:"h-8 md:h-9 gap-2 flex-1 sm:flex-initial",onClick:Ut,disabled:e(E),title:"Save and mark chapter as complete"},{default:p(()=>[r(e(zo),{class:"w-3.5 h-3.5 md:w-4 md:h-4"}),o[32]||(o[32]=s("span",{class:"text-xs font-medium hidden sm:inline"},"Mark Complete",-1)),o[33]||(o[33]=s("span",{class:"text-xs font-medium sm:hidden"},"Complete",-1))]),_:1},8,["disabled"])])])]),r(fo,{open:e(w),"current-balance":e(i),"required-words":e(k),action:e(I),"onUpdate:open":o[16]||(o[16]=n=>w.value=n),onClose:e(d)},null,8,["open","current-balance","required-words","action","onClose"]),r(e(ho),{position:"top-center"})]),r(Oo,{show:e(D)&&!!e(de),"is-generating":e(yt),onRegenerate:Rt,onDismiss:e(Pe)},null,8,["show","is-generating","onDismiss"])],64))}}),Ua=st(nr,[["__scopeId","data-v-e6b99424"]]);export{Ua as default};
