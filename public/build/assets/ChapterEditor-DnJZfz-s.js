const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/ChapterNavigation-CVIDTaVJ.js","assets/ChapterNavigation.vue_vue_type_script_setup_true_lang-BQ4G1ss4.js","assets/index-BNCR1WzN.js","assets/app-DI0P-SCf.js","assets/app-C9nE-dML.css","assets/ScrollArea.vue_vue_type_script_setup_true_lang-CEw2aNhZ.js","assets/Presence-8uqkmKQu.js","assets/useForwardExpose-DExeGtxo.js","assets/index-DF4e6W7v.js","assets/useNonce-CESPcQCj.js","assets/AlertDialogTitle.vue_vue_type_script_setup_true_lang-CyfOzzXw.js","assets/VisuallyHidden-A35wewYD.js","assets/DropdownMenuTrigger.vue_vue_type_script_setup_true_lang-B1iWO8oL.js","assets/index-D1DrIvjI.js","assets/x-D-oiaNfd.js","assets/loader-circle-DYdv4uHQ.js","assets/DialogTrigger-6nR2FGlH.js","assets/index-xJ5Oeg8M.js","assets/plus-CIVqX7tK.js","assets/chevron-right-j5jojjre.js","assets/circle-check-big-BGklqB-Y.js","assets/lock-i5ivpOek.js","assets/target-xT7GGB6D.js","assets/trash-2-ElVY0woU.js","assets/MobileNavOverlay-DwPf0ksD.js","assets/index-BcJ40BIx.js","assets/DefensePreparationPanel.vue_vue_type_script_setup_true_lang-JtlVb70T.js","assets/CardContent.vue_vue_type_script_setup_true_lang-DTMY-zGL.js","assets/CardTitle.vue_vue_type_script_setup_true_lang-DOATAxJL.js","assets/CollapsibleTrigger.vue_vue_type_script_setup_true_lang-9bhIOTpb.js","assets/Progress.vue_vue_type_script_setup_true_lang-CFSS-rqH.js","assets/nullish-CHIgUVhi.js","assets/Separator.vue_vue_type_script_setup_true_lang-ot919cNS.js","assets/Separator-gq4ngjre.js","assets/Switch.vue_vue_type_script_setup_true_lang-ffmk00ZB.js","assets/VisuallyHiddenInput-Y93J-xZK.js","assets/chevron-down-B3OG6J7R.js","assets/lightbulb-C6s4CeYu.js","assets/useTextHistory-BSjNxQhf.js","assets/Input.vue_vue_type_script_setup_true_lang-BYz-tnUZ.js","assets/RichTextEditor-CRRxzHsT.js","assets/_plugin-vue_export-helper-DlAUqK2U.js","assets/purify.es-DxJI3Wx7.js","assets/index-BWEDi_FC.js","assets/step-DrZ9DcYd.js","assets/chart-column-BtxR61Kh.js","assets/calendar-Bt3_5BR9.js","assets/brain-ByUWojbE.js","assets/users-B5iTgH8i.js","assets/circle-alert-CEzmvTvX.js","assets/eye-DP7I6OOL.js","assets/check-COZqqKzN.js","assets/type-CpmBR9ye.js","assets/download-DTOWiIiS.js","assets/DialogTitle.vue_vue_type_script_setup_true_lang-YWUBEI1G.js","assets/DialogFooter.vue_vue_type_script_setup_true_lang-BLye3tDr.js","assets/Label.vue_vue_type_script_setup_true_lang-B3LvKr1h.js","assets/minus-CeI7JzKu.js","assets/list-0gFBJuDF.js","assets/RichTextEditor-Bqo7AGZp.css","assets/book-open-DTt_5lyB.js","assets/search-4V3k0Qxu.js","assets/sparkles-By8c6WbP.js","assets/Checkbox.vue_vue_type_script_setup_true_lang-BywdfT-M.js","assets/ohash.D__AXeF1-C-E83dC9.js","assets/RovingFocusItem-BiOc_AZd.js","assets/file-text-D7hIQVN6.js","assets/refresh-cw-BRDJCU4E.js","assets/UserInfo.vue_vue_type_script_setup_true_lang-DJeZkgOX.js","assets/AppLayout.vue_vue_type_script_setup_true_lang-Bl-UPu6g.js","assets/coins-gNw7Syml.js","assets/log-out-CwEw-MxT.js","assets/AppLogo.vue_vue_type_script_setup_true_lang-CZfY7_Y0.js","assets/library-DFzZ_wcn.js","assets/sun-CN57iDOP.js","assets/useWordBalance-Du-eSUrp.js","assets/PurchaseModal.vue_vue_type_script_setup_true_lang-DU3oLPIq.js","assets/arrow-right-BivZwz2u.js","assets/useChapterWordCount-DFtqa5Yh.js","assets/toNumber-CSt-mx_b.js","assets/save-CAtbi7NL.js","assets/zap-bLiyV1Sm.js","assets/pen-tool-WNzyGWC6.js","assets/arrow-left-DkewZFEB.js","assets/menu-cOaD_zNF.js","assets/minimize-2-DK5_HE-0.js","assets/message-square-DA6NUBYj.js","assets/MobileNavOverlay-CN-XSdXy.css","assets/CitationVerificationLayout-_PnffatD.js","assets/SafeHtmlText.vue_vue_type_script_setup_true_lang-CdcL2AEG.js"])))=>i.map(i=>d[i]);
import{az as Qs,ae as Ks,S as Vs,t as se,b as E,a2 as Qt,e as P,U as K,X as Y,q as je,p as Me,af as ce,d as Oe,s as Xs,c as B,o as T,k as r,u as e,i as q,j as n,g as s,y as g,z as v,n as Be,Q as Te,V as Le,a8 as Fe,f as V,a1 as Js,T as Ys,F as $t,aA as st,l as Ke,aB as Zs,m as At,I as er,aC as rt}from"./app-DI0P-SCf.js";import{_ as Ee}from"./index-xJ5Oeg8M.js";import{c as it,_ as j}from"./index-BNCR1WzN.js";import{_ as Z,a as ee}from"./CardContent.vue_vue_type_script_setup_true_lang-DTMY-zGL.js";import{_ as te,a as le}from"./CardTitle.vue_vue_type_script_setup_true_lang-DOATAxJL.js";import{a as Dt}from"./ScrollArea.vue_vue_type_script_setup_true_lang-CEw2aNhZ.js";import{_ as qe}from"./Separator.vue_vue_type_script_setup_true_lang-ot919cNS.js";import{a as ie,b as de,_ as ue}from"./UserInfo.vue_vue_type_script_setup_true_lang-DJeZkgOX.js";import{a as jt,_ as Mt,b as tr}from"./AppLayout.vue_vue_type_script_setup_true_lang-Bl-UPu6g.js";import{t as W}from"./index-D1DrIvjI.js";import{_ as sr}from"./PurchaseModal.vue_vue_type_script_setup_true_lang-DU3oLPIq.js";import{r as rr,u as nr}from"./useWordBalance-Du-eSUrp.js";import{a as ar,u as or,b as lr}from"./useChapterWordCount-DFtqa5Yh.js";import{t as Lt}from"./toNumber-CSt-mx_b.js";import{_ as ir}from"./Input.vue_vue_type_script_setup_true_lang-BYz-tnUZ.js";import{_ as dr}from"./Label.vue_vue_type_script_setup_true_lang-B3LvKr1h.js";import{ay as ur,az as cr,aA as pr,aB as gr,aC as fr,aD as mr,aE as hr,aF as vr,aG as br,aH as xr,aI as wr,aJ as yr,aK as _r,aL as kr,aa as Kt,au as Cr,at as Sr}from"./RichTextEditor-CRRxzHsT.js";import{_ as dt}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{E as Vt}from"./eye-DP7I6OOL.js";import{S as lt}from"./save-CAtbi7NL.js";import{C as Ve}from"./circle-check-big-BGklqB-Y.js";import{_ as Ft,a as Rt,b as Pt}from"./CollapsibleTrigger.vue_vue_type_script_setup_true_lang-9bhIOTpb.js";import{_ as Er}from"./Progress.vue_vue_type_script_setup_true_lang-CFSS-rqH.js";import{W as Tr,b as $r,u as Ar,M as zt,_ as nt,a as Dr,P as jr}from"./useTextHistory-BSjNxQhf.js";import{B as He}from"./brain-ByUWojbE.js";import{Z as Mr}from"./zap-bLiyV1Sm.js";import{C as Wt}from"./chevron-down-B3OG6J7R.js";import{P as Nt}from"./pen-tool-WNzyGWC6.js";import{R as Lr}from"./refresh-cw-BRDJCU4E.js";import{C as Fr}from"./DropdownMenuTrigger.vue_vue_type_script_setup_true_lang-B1iWO8oL.js";import{S as Rr}from"./sparkles-By8c6WbP.js";import{T as Pr}from"./type-CpmBR9ye.js";import{A as at}from"./arrow-left-DkewZFEB.js";import{M as qt}from"./menu-cOaD_zNF.js";import{M as Ht}from"./minimize-2-DK5_HE-0.js";import{M as Bt,S as Ot}from"./sun-CN57iDOP.js";import{S as Gt}from"./search-4V3k0Qxu.js";import{a as zr,P as Wr}from"./AlertDialogTitle.vue_vue_type_script_setup_true_lang-CyfOzzXw.js";import{M as Nr}from"./message-square-DA6NUBYj.js";var ot=function(){return Qs.Date.now()},qr="Expected a function",Hr=Math.max,Br=Math.min;function Or(b,x,o){var A,p,h,C,f,S,l=0,w=!1,u=!1,c=!0;if(typeof b!="function")throw new TypeError(qr);x=Lt(x)||0,Ks(o)&&(w=!!o.leading,u="maxWait"in o,h=u?Hr(Lt(o.maxWait)||0,x):h,c="trailing"in o?!!o.trailing:c);function i($){var _=A,O=p;return A=p=void 0,l=$,C=b.apply(O,_),C}function y($){return l=$,f=setTimeout(M,x),w?i($):C}function N($){var _=$-S,O=$-l,U=x-_;return u?Br(U,h-O):U}function R($){var _=$-S,O=$-l;return S===void 0||_>=x||_<0||u&&O>=h}function M(){var $=ot();if(R($))return m($);f=setTimeout(M,N($))}function m($){return f=void 0,c&&A?i($):(A=p=void 0,C)}function d(){f!==void 0&&clearTimeout(f),l=0,A=S=p=f=void 0}function D(){return f===void 0?C:m(ot())}function z(){var $=ot(),_=R($);if(A=arguments,p=this,S=$,_){if(f===void 0)return y(S);if(u)return clearTimeout(f),f=setTimeout(M,x),i(S)}return f===void 0&&(f=setTimeout(M,x)),C}return z.cancel=d,z.flush=D,z}/**
 * @license lucide-vue-next v0.468.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Xt=it("BookCheckIcon",[["path",{d:"M4 19.5v-15A2.5 2.5 0 0 1 6.5 2H19a1 1 0 0 1 1 1v18a1 1 0 0 1-1 1H6.5a1 1 0 0 1 0-5H20",key:"k3hazp"}],["path",{d:"m9 9.5 2 2 4-4",key:"1dth82"}]]);/**
 * @license lucide-vue-next v0.468.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Gr=it("PenIcon",[["path",{d:"M21.174 6.812a1 1 0 0 0-3.986-3.987L3.842 16.174a2 2 0 0 0-.5.83l-1.321 4.352a.5.5 0 0 0 .623.622l4.353-1.32a2 2 0 0 0 .83-.497z",key:"1a8usu"}]]);/**
 * @license lucide-vue-next v0.468.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ir=it("Undo2Icon",[["path",{d:"M9 14 4 9l5-5",key:"102s5s"}],["path",{d:"M4 9h10.5a5.5 5.5 0 0 1 5.5 5.5a5.5 5.5 0 0 1-5.5 5.5H11",key:"f3b9sd"}]]);function Ur(b){const x=Vs();se(()=>x.props?.flash,G=>{G&&(G.success&&W.success(G.success),G.error&&W.error(G.error))},{deep:!0,immediate:!0});const o=E(b.chapter.title||""),A=E(b.chapter.content||""),p=E(!0),{isDark:h,toggle:C}=Qt(),f=P(()=>h.value),S=()=>{},l=()=>{C()},w=E(!1),u=E(!1),c=E(!1),i=E("write"),y=E(""),N=E(0),R=E(!1),M=E(!1),m=E(!0),d=()=>{try{return localStorage.getItem(`chatMode_${b.project.id}_${b.chapter.chapter_number}`)==="true"}catch(G){return console.warn("Failed to load chat mode from localStorage:",G),!1}},D=G=>{try{localStorage.setItem(`chatMode_${b.project.id}_${b.chapter.chapter_number}`,String(G))}catch(J){console.warn("Failed to save chat mode to localStorage:",J)}},z=E(!1),$=E(!1),_=E(!1),O=E(!1),U=E(!1),re=E(!0),be=E(!0);return{chapterTitle:o,chapterContent:A,showPreview:p,isEditorDark:f,initChapterTheme:S,toggleChapterTheme:l,isNativeFullscreen:w,showAISidebar:u,showStatistics:c,activeTab:i,selectedText:y,cursorPosition:N,showChatMode:R,showCitationMode:M,showDefensePrep:m,loadChatModeFromStorage:d,saveChatModeToStorage:D,showLeftSidebar:z,showRightSidebar:$,isMobile:_,isLeftSidebarCollapsed:O,isRightSidebarCollapsed:U,showLeftSidebarInFullscreen:re,showRightSidebarInFullscreen:be}}function Qr({props:b,allChapters:x,targetWordCount:o,estimates:A,ensureBalance:p,save:h}){return{generateNextChapter:async()=>{const f=A.chapter(o.value||0);if(!p(f,"generate the next chapter with AI"))return;await h();const S=x.map(u=>u.chapter_number).sort((u,c)=>u-c),l=S.indexOf(b.chapter.chapter_number);let w;if(l===-1||l===S.length-1)w=Math.max(...S)+1;else{const u=S[l+1];u===b.chapter.chapter_number+1?w=u:w=b.chapter.chapter_number+1}try{const u=K("chapters.write",{project:b.project.slug,chapter:w}),c=new URL(u,window.location.origin);c.searchParams.set("ai_generate","true"),c.searchParams.set("generation_type","progressive"),Y.visit(c.toString())}catch(u){console.error("âŒ Error generating next chapter:",u)}}}}function Kr(b,x,o,A){const h=E(!1),C=E(0),f=E(!1),S=_=>{if(!_)return 0;const U=_.replace(/<[^>]*>/g,"").trim().replace(/\s+/g," ");if(!U)return 0;const re=U.match(/\b\w+\b/g);return re?re.length:0},l=P(()=>S(o.value)),w=P(()=>l.value>=800),u=()=>`defense_generation_triggered_${b.id}_ch_${x.chapter_number}`,c=()=>{const _=u();return localStorage.getItem(_)==="true"},i=()=>{const _=u();localStorage.setItem(_,"true"),h.value=!0},y=()=>{const _=u();localStorage.removeItem(_),h.value=!1,console.log(`ðŸ”„ DEFENSE WATCHER: Reset generation trigger for Chapter ${x.chapter_number}`)},N=Or(async()=>{if(!f.value)return;const _=l.value;console.log(`ðŸ“Š DEFENSE WATCHER: Word count check - Chapter ${x.chapter_number}: ${_} words`),_<800*.8&&h.value&&(console.log("â¬‡ï¸ DEFENSE WATCHER: Content dropped below 80% of threshold, resetting trigger"),y()),C.value=_},2e3),R=()=>f.value?void 0:(f.value=!0,h.value=c(),C.value=l.value,console.log(`ðŸ‘€ DEFENSE WATCHER: Started watching Chapter ${x.chapter_number}`),console.log(`   Initial word count: ${C.value}`),console.log(`   Generation already triggered: ${h.value}`),console.log("   Threshold: 800 words"),se(o,(O,U)=>{O!==U&&N()},{immediate:!1})),M=()=>{f.value=!1,N.cancel(),console.log(`ðŸ›‘ DEFENSE WATCHER: Stopped watching Chapter ${x.chapter_number}`)},m=async()=>{console.log(`ðŸ” DEFENSE WATCHER: Force checking Chapter ${x.chapter_number}`),await N(),N.flush()},d=P(()=>{const _=l.value;return _>0&&_<800&&!h.value}),D=P(()=>{const _=l.value/800*100;return Math.min(_,100)}),z=P(()=>{const _=800-l.value;return Math.max(_,0)});return{isWatching:f,hasTriggeredGeneration:h,currentWordCount:l,lastWordCount:C,meetsThreshold:w,shouldShowProgressIndicator:d,progressPercentage:D,wordsRemaining:z,startWatching:R,stopWatching:M,forceCheck:m,resetGenerationTrigger:y,markGenerationTriggered:i,getStatusMessage:()=>{const _=l.value;return h.value?`Defense questions available (${_} words)`:_>=800?`Ready for defense questions (${_} words)`:_>0?`${800-_} more words needed for defense questions`:"Start writing to enable defense questions (800 words needed)"},countWords:S,DEFENSE_WORD_COUNT_THRESHOLD:800}}function Vr({props:b,chapterContent:x,currentWordCount:o,ensureBalance:A,estimates:p}){const h=E([]),C=E(!1),f=E(!1),S=E(null),l=E(!1),w=P(()=>b.chapter),{hasTriggeredGeneration:u,startWatching:c,stopWatching:i,forceCheck:y,getStatusMessage:N,markGenerationTriggered:R,meetsThreshold:M,shouldShowProgressIndicator:m,progressPercentage:d,wordsRemaining:D,DEFENSE_WORD_COUNT_THRESHOLD:z}=Kr(b.project,b.chapter,x),$=(L,H)=>`defense_auto_generate_${L}_ch_${H}`,_=()=>{try{return localStorage.getItem($(b.project.id,b.chapter.chapter_number))==="true"}catch(L){return console.warn("Failed to load defense auto-generation preference:",L),!1}},O=L=>{try{localStorage.setItem($(b.project.id,b.chapter.chapter_number),String(L))}catch(H){console.warn("Failed to save defense auto-generation preference:",H)}};l.value=_();const U=()=>{if(!h.value.length||!S.value)return!0;const L=new Date(Date.now()-360*60*1e3);return S.value<L},re=async(L=!1,H={})=>{if(C.value)return;const I=H.skipGeneration??!0;C.value=!0;try{console.log("Loading defense questions with params:",{project_id:b.project.id,chapter_number:w.value?.chapter_number,limit:5,force_refresh:L,skip_generation:I});const F=await ce.get(`/api/projects/${b.project.id}/defense/questions`,{params:{chapter_number:w.value?.chapter_number||null,limit:5,force_refresh:L?1:0,skip_generation:I?1:0},headers:{Accept:"application/json","X-Requested-With":"XMLHttpRequest"}});if(console.log("Defense questions loaded:",F.data),h.value=F.data.questions||[],S.value=new Date,F.data.questions&&F.data.questions.length>0){const X=`defense_questions_${b.project.id}_chapter_${w.value?.chapter_number}`;localStorage.setItem(X,JSON.stringify({questions:F.data.questions,chapter_number:w.value?.chapter_number,loaded_at:new Date().toISOString()}))}else L||(console.log("No existing questions found for this chapter"),console.log(`Current word count: ${o.value}/${z}`),console.log('User must click "Generate Questions" button to create defense questions'))}catch(F){if(console.error("Failed to load defense questions:",F),F.response)if(console.error("Response status:",F.response.status),console.error("Response data:",F.response.data),F.response.status===422){const X=Object.values(F.response.data.errors||{})[0];X&&Array.isArray(X)?W.error(`Validation Error: ${X[0]}`):W.error("Invalid request parameters. Please refresh the page.")}else F.response.status===500?W.error("Server error. Please try again later."):W.error("Failed to load defense questions");else F.request?(console.error("No response received:",F.request),W.error("Network error. Please check your connection.")):(console.error("Error setting up request:",F.message),W.error("An unexpected error occurred"));h.value=[]}finally{C.value=!1}},be=L=>L?L.replace(/<[^>]*>/g," ").trim().split(/\s+/).filter(H=>H.length>0).length:0,G=async(L={})=>{if(f.value)return;const H=L.autoTriggered??!1,I=p.defense();if(A(I,"generate defense questions")){f.value=!0;try{const F=await ce.post(`/api/projects/${b.project.id}/defense/questions/generate`,{chapter_number:w.value.chapter_number},{headers:{"X-CSRF-TOKEN":document.querySelector('meta[name="csrf-token"]')?.getAttribute("content"),Accept:"application/json","Content-Type":"application/json"}});if(F.data&&F.data.questions){h.value=F.data.questions,S.value=new Date;const X=F.data.questions.reduce((Pe,we)=>{const ze=be(we.question),Xe=be(we.suggested_answer),ne=(we.key_points||[]).reduce((ye,ae)=>ye+be(ae),0);return Pe+ze+Xe+ne},0),Re=`defense_questions_${b.project.id}_chapter_${w.value?.chapter_number}`;localStorage.setItem(Re,JSON.stringify({questions:F.data.questions,chapter_number:w.value?.chapter_number,loaded_at:new Date().toISOString()})),W.success(`Generated ${F.data.questions.length} new questions`),rr(X||p.defense(),"Defense questions","chapter",b.chapter.id).catch(Pe=>console.error("Failed to record word usage (defense):",Pe)),u.value=!0,R(),H&&console.log("Auto-generated defense questions after meeting threshold.")}}catch(F){console.error("Failed to generate defense questions:",F),W.error("Failed to generate defense questions")}finally{f.value=!1}}},J=async()=>{!l.value||f.value||C.value||u.value||!M.value||h.value.length>0||await G({autoTriggered:!0})},Ge=L=>{l.value=L,O(L),L&&J()},$e=async(L,H)=>{try{await ce.patch(`/api/projects/${b.project.id}/defense/questions/${L}`,{user_marked_helpful:H},{headers:{"X-CSRF-TOKEN":document.querySelector('meta[name="csrf-token"]')?.getAttribute("content"),Accept:"application/json","Content-Type":"application/json"}});const I=h.value.find(F=>F.id===L);I&&(I.user_marked_helpful=H),W.success(H?"Question marked as helpful":"Removed helpful mark")}catch(I){console.error("Failed to mark question:",I),W.error("Failed to update question")}},Ae=async L=>{try{await ce.delete(`/api/projects/${b.project.id}/defense/questions/${L}`,{headers:{"X-CSRF-TOKEN":document.querySelector('meta[name="csrf-token"]')?.getAttribute("content"),Accept:"application/json"}}),h.value=h.value.filter(H=>H.id!==L),localStorage.setItem(`defense_questions_${b.project.id}`,JSON.stringify({questions:h.value,loaded_at:new Date().toISOString()})),W.success("Question hidden")}catch(H){console.error("Failed to hide question:",H),W.error("Failed to hide question")}},xe=async()=>{const L=`defense_questions_${b.project.id}_chapter_${w.value?.chapter_number}`,H=localStorage.getItem(L);let I=!0;if(H){const F=JSON.parse(H),X=new Date(F.loaded_at),Re=new Date(Date.now()-360*60*1e3);X>Re&&F.chapter_number===w.value?.chapter_number&&(h.value=F.questions,S.value=X,I=!1)}I&&await re(!1,{skipGeneration:!0})};return se(()=>b.chapter,async()=>{h.value=[],i(),c(),l.value=_(),await re(!1,{skipGeneration:!0}),await je(()=>{y(),J()})},{immediate:!1}),se([o,l],()=>{J()}),Me(async()=>{await xe(),c(),await je(()=>{y(),J()})}),{defenseQuestions:h,isLoadingDefenseQuestions:C,isGeneratingDefenseQuestions:f,autoGenerateDefense:l,shouldLoadDefenseQuestions:U,loadDefenseQuestions:re,generateNewDefenseQuestions:G,markQuestionHelpful:$e,hideQuestion:Ae,handleDefenseAutoToggle:Ge,attemptAutoGenerateDefense:J,getDefenseStatusMessage:N,shouldShowDefenseProgress:m,defenseProgressPercentage:d,defenseWordsRemaining:D,hasTriggeredGeneration:u,meetsDefenseThreshold:M}}const Xr={class:"bg-background"},Jr=Oe({__name:"RichTextViewer",props:{content:{},showFontControls:{type:Boolean,default:!0}},setup(b){const x=ur(kr),o=b,A=l=>l?(l=l.replace(/```mermaid\n?([\s\S]*?)```/g,(w,u)=>{const c=u.trim();return`<div data-mermaid data-mermaid-code="${c.replace(/&/g,"&amp;").replace(/"/g,"&quot;").replace(/</g,"&lt;").replace(/>/g,"&gt;")}" data-view-mode="diagram"><pre><code class="language-mermaid">${c}</code></pre></div>`}),l=l.replace(/``mermaid\n?([\s\S]*?)``/g,(w,u)=>{const c=u.trim();return`<div data-mermaid data-mermaid-code="${c.replace(/&/g,"&amp;").replace(/"/g,"&quot;").replace(/</g,"&lt;").replace(/>/g,"&gt;")}" data-view-mode="diagram"><pre><code class="language-mermaid">${c}</code></pre></div>`}),l=l.replace(/`mermaid\n([\s\S]*?)`/g,(w,u)=>{const c=u.trim();return`<div data-mermaid data-mermaid-code="${c.replace(/&/g,"&amp;").replace(/"/g,"&quot;").replace(/</g,"&lt;").replace(/>/g,"&gt;")}" data-view-mode="diagram"><pre><code class="language-mermaid">${c}</code></pre></div>`}),l):"",p=l=>l?(l=l.replace(/```(\w+)\n?([\s\S]*?)```/g,(w,u,c)=>`<pre><code class="language-${u}">${c.trim()}</code></pre>`),l=l.replace(/```\n?([\s\S]*?)```/g,(w,u)=>`<pre><code>${u.trim()}</code></pre>`),l):"",h=l=>{if(!l)return"";const w=l.split(`
`);let u=[],c=0;for(;c<w.length;){const i=w[c];if(i.includes("|")){const y=C(w,c);if(y.html){u.push(y.html),c=y.nextIndex;continue}}u.push(i),c++}return u.join(`
`)},C=(l,w)=>{let u=l[w];if(!u||!u.includes("|"))return{html:null,nextIndex:w+1};const c=u.split("|").map(M=>M.trim()).filter(M=>M.length>0);if(c.length===0)return{html:null,nextIndex:w+1};const i=l[w+1];if(!i||!i.includes("|")||!i.includes("-"))return{html:null,nextIndex:w+1};let y=[],N=w+2;for(;N<l.length;){const M=l[N];if(!M||!M.includes("|"))break;const m=M.split("|").map(d=>d.trim()).filter(d=>d.length>0);m.length>0&&y.push(m),N++}let R='<div class="tableWrapper"><table>';return R+="<thead><tr>",c.forEach(M=>{R+=`<th>${M}</th>`}),R+="</tr></thead>",y.length>0&&(R+="<tbody>",y.forEach(M=>{R+="<tr>";for(let m=0;m<c.length;m++){const d=M[m]||"";R+=`<td>${d}</td>`}R+="</tr>"}),R+="</tbody>"),R+="</table></div>",{html:R,nextIndex:N}},f=l=>{if(!l)return"";if(l.includes("<p>")||l.includes("<h1>")||l.includes("<h2>")||l.includes("<div>")){let i=A(l);return i=p(i),i}let u=l;return u=A(u),u=p(u),u=u.replace(/^#### (.*$)/gim,"<h4>$1</h4>"),u=u.replace(/^### (.*$)/gim,"<h3>$1</h3>"),u=u.replace(/^## (.*$)/gim,"<h2>$1</h2>"),u=u.replace(/^# (.*$)/gim,"<h1>$1</h1>"),u=u.replace(/\*\*(.*?)\*\*/g,"<strong>$1</strong>"),u=u.replace(new RegExp("(?<!\\*)\\*([^*\\n]+?)\\*(?!\\*)","g"),"<em>$1</em>"),u=u.replace(/`([^`]+)`/g,"<code>$1</code>"),u=h(u),u.split(/\n\s*\n/).filter(i=>i.trim()).map(i=>{const y=i.trim();if(y.startsWith("<h1>")||y.startsWith("<h2>")||y.startsWith("<h3>")||y.startsWith("<h4>"))return y;if(y.includes(`
`)){const R=y.split(`
`).map(d=>d.trim()).filter(d=>d),M=R.some(d=>d.match(/^\d+\.\s/)),m=R.some(d=>d.match(/^[-*]\s/));if(M||m){const d=R.map($=>$.match(/^\d+\.\s/)?`<li>${$.replace(/^\d+\.\s/,"")}</li>`:$.match(/^[-*]\s/)?`<li>${$.replace(/^[-*]\s/,"")}</li>`:$);let D=[],z="";for(const $ of d)$.startsWith("<li>")?(z&&D.push(z),z=$):z&&(z=z.replace("</li>",` ${$}</li>`));return z&&D.push(z),M?`<ol>${D.join("")}</ol>`:`<ul>${D.join("")}</ul>`}}return`<p>${y.replace(/\n/g,"<br>")}</p>`}).join("")},S=cr({content:f(o.content),editable:!1,extensions:[pr.configure({heading:{levels:[1,2,3]},codeBlock:!1}),gr.configure({lowlight:x,HTMLAttributes:{class:"code-block-highlighted"}}),fr,mr,hr,vr.configure({resizable:!0}),br,xr,wr,yr],editorProps:{attributes:{class:"prose prose-sm dark:prose-invert max-w-none focus:outline-none"}}});return E("12"),Me(()=>{setTimeout(()=>{S.value&&S.value.chain().selectAll().setFontSize("12pt").run()},100)}),se(()=>o.content,l=>{if(S.value&&S.value.getHTML()!==l){const w=f(l);S.value.commands.setContent(w)}}),Xs(()=>{S.value&&S.value.destroy()}),(l,w)=>(T(),B("div",Xr,[r(e(_r),{editor:e(S)},null,8,["editor"])]))}}),Jt=dt(Jr,[["__scopeId","data-v-87fd46f8"]]),Yr={class:"flex items-center justify-between"},Zr={class:"space-y-1 w-full max-w-[520px]"},en={class:"flex items-center justify-between gap-3"},tn={class:"flex flex-col"},sn={class:"flex items-center gap-2"},rn={class:"flex items-center justify-between px-6 py-2 border-b border-border/30 bg-muted/5"},nn={class:"flex items-center gap-2"},an={class:"space-y-1 relative z-10"},on={class:"text-sm font-medium text-foreground"},ln={class:"text-[10px] text-muted-foreground line-clamp-2 leading-relaxed"},dn={class:"flex-1 relative bg-background"},un={class:"px-12 py-10 min-h-[500px]"},cn={class:"sticky bottom-0 z-10 border-t border-border/30 bg-background/80 backdrop-blur-md p-4 flex items-center justify-between"},pn={class:"text-xs text-muted-foreground"},gn={class:"flex items-center gap-2"},It=Oe({__name:"ChapterEditorPaperCard",props:{context:{}},setup(b){const o=b.context,A=P(()=>{const C=o.getSectionInfo(o.nextSection);return o.aiChapterAnalysis?.section||C}),p=P(()=>A.value?.name||""),h=P(()=>A.value?.description||"");return(C,f)=>(T(),q(e(Z),{class:"w-full max-w-[850px] min-h-[calc(100vh-180px)] flex flex-col bg-background shadow-xl shadow-black/5 ring-1 ring-black/5 dark:ring-white/10 rounded-xl overflow-hidden transition-all duration-300"},{default:n(()=>[r(e(te),{class:"flex-shrink-0 border-b border-border/30 px-8 py-6 bg-background/50 backdrop-blur-sm sticky top-0 z-10"},{default:n(()=>[s("div",Yr,[s("div",Zr,[s("div",en,[s("div",tn,[r(e(dr),{for:"chapter-title",class:"text-xs font-medium text-zinc-500 dark:text-zinc-400 uppercase tracking-wider"},{default:n(()=>[...f[3]||(f[3]=[g("Chapter Title",-1)])]),_:1}),r(e(ir),{id:"chapter-title",modelValue:e(o).chapterTitle,"onUpdate:modelValue":f[0]||(f[0]=S=>e(o).chapterTitle=S),placeholder:"Enter chapter title...",class:"h-auto p-0 border-0 bg-transparent text-2xl font-bold placeholder:text-muted-foreground/40 focus-visible:ring-0 px-0 text-foreground"},null,8,["modelValue"])]),s("div",sn,[r(e(Ee),{variant:e(o).chapter.status==="approved"?"default":"secondary",class:"rounded-full px-3"},{default:n(()=>[g(v(e(o).chapter.status.replace("_"," ")),1)]),_:1},8,["variant"]),r(e(Ee),{variant:"outline",class:Be(["rounded-full px-3 transition-colors",{"text-green-600 border-green-200 bg-green-50 dark:bg-green-900/20 dark:border-green-800":(e(o).latestAnalysis?.total_score||0)>=80,"text-yellow-600 border-yellow-200 bg-yellow-50 dark:bg-yellow-900/20 dark:border-yellow-800":(e(o).latestAnalysis?.total_score||0)>=70&&(e(o).latestAnalysis?.total_score||0)<80,"text-orange-600 border-orange-200 bg-orange-50 dark:bg-orange-900/20 dark:border-orange-800":(e(o).latestAnalysis?.total_score||0)>=60&&(e(o).latestAnalysis?.total_score||0)<70,"text-red-600 border-red-200 bg-red-50 dark:bg-red-900/20 dark:border-red-800":(e(o).latestAnalysis?.total_score||0)<60}])},{default:n(()=>[g(v(e(o).latestAnalysis?.total_score?Math.round(e(o).latestAnalysis.total_score):e(o).writingQualityScore)+"% Quality ",1)]),_:1},8,["class"])])])])])]),_:1}),r(e(ee),{class:"flex min-h-0 flex-1 flex-col p-0"},{default:n(()=>[s("div",rn,[s("div",nn,[r(e(j),{onClick:e(o).togglePresentationMode,variant:e(o).showPresentationMode?"default":"ghost",size:"sm",class:"h-7 text-xs rounded-full text-zinc-700 dark:text-zinc-300 hover:text-foreground"},{default:n(()=>[r(e(Vt),{class:"mr-1.5 h-3.5 w-3.5"}),g(" "+v(e(o).showPresentationMode?"Edit":"Preview"),1)]),_:1},8,["onClick","variant"])]),s("div",an,[s("div",on,v(p.value),1),s("div",ln,v(h.value),1)])]),s("div",dn,[Te(r(Kt,{modelValue:e(o).chapterContent,"onUpdate:modelValue":f[1]||(f[1]=S=>e(o).chapterContent=S),placeholder:"Start writing your chapter...","min-height":"500px",class:"min-h-[500px] px-8 py-6",ref:e(o).richTextEditor,"show-toolbar":!0,"streaming-mode":e(o).isStreamingMode,"is-generating":e(o).isGenerating,"generation-progress":e(o).generationProgress,"generation-percentage":e(o).generationPercentage,"generation-phase":e(o).generationPhase,"onUpdate:selectedText":e(o).setSelectedText},null,8,["modelValue","streaming-mode","is-generating","generation-progress","generation-percentage","generation-phase","onUpdate:selectedText"]),[[Le,!e(o).showPresentationMode]]),Te(s("div",un,[r(Jt,{content:e(o).chapterContent,"show-font-controls":!1,class:"prose-lg mx-auto",style:{"font-family":"'Times New Roman', serif","line-height":"1.8"}},null,8,["content"])],512),[[Le,e(o).showPresentationMode]])])]),_:1}),s("div",cn,[s("div",pn,v(e(o).isSaving?"Saving...":"All changes saved"),1),s("div",gn,[r(e(j),{onClick:f[2]||(f[2]=()=>e(o).save(!1)),disabled:!e(o).isValid||e(o).isSaving,size:"sm",variant:"ghost",class:"h-8 rounded-full text-zinc-700 dark:text-zinc-300 hover:text-foreground"},{default:n(()=>[r(e(lt),{class:"mr-2 h-3.5 w-3.5"}),f[4]||(f[4]=g(" Save Draft ",-1))]),_:1},8,["disabled"]),r(e(j),{onClick:e(o).goToBulkAnalysis,variant:"outline",size:"sm",class:"h-8 rounded-full"},{default:n(()=>[r(e(Xt),{class:"mr-2 h-3.5 w-3.5"}),f[5]||(f[5]=g(" Run Bulk Analysis ",-1))]),_:1},8,["onClick"]),r(e(j),{onClick:e(o).markAsComplete,disabled:e(o).isSaving,size:"sm",class:"h-8 rounded-full bg-gradient-to-r from-primary to-primary/90 shadow-sm hover:shadow-md transition-all"},{default:n(()=>[r(e(Ve),{class:"mr-2 h-3.5 w-3.5"}),f[6]||(f[6]=g(" Complete ",-1))]),_:1},8,["onClick","disabled"])])])]),_:1}))}}),fn={class:"flex flex-col gap-4 p-1"},mn={class:"p-1.5 rounded-lg bg-primary/10 text-primary"},hn={class:"flex items-center gap-2"},vn={class:"space-y-3"},bn={key:0,class:"space-y-2"},xn={class:"flex items-center justify-between w-full relative z-10"},wn={class:"flex items-center gap-2 text-primary"},yn={class:"space-y-1 relative z-10"},_n={class:"text-sm font-medium text-foreground"},kn={class:"text-[10px] text-muted-foreground line-clamp-2 leading-relaxed"},Cn={key:0,class:"p-4 rounded-xl bg-green-500/10 border border-green-500/20 space-y-3"},Sn={class:"flex items-center gap-2 text-green-600 dark:text-green-400"},En={class:"space-y-2"},Tn={class:"flex justify-between text-[10px] font-medium text-muted-foreground"},$n={class:"grid grid-cols-2 gap-2 mt-2"},An={class:"p-1.5 rounded-full bg-blue-500/10 text-blue-500"},Dn={class:"p-1.5 rounded-full bg-purple-500/10 text-purple-500"},jn={class:"p-1.5 rounded-full bg-orange-500/10 text-orange-500"},Mn={class:"p-1.5 rounded-full bg-emerald-500/10 text-emerald-500"},Ln={class:"p-1.5 rounded-full bg-amber-500/10 text-amber-500"},Fn={class:"flex items-center gap-2"},Rn={class:"p-1 rounded-xl bg-muted/30 border border-border/50"},Pn=Oe({__name:"AISidebar",props:{project:{},chapter:{},isGenerating:{type:Boolean},selectedText:{},isLoadingSuggestions:{type:Boolean},showCitationHelper:{type:Boolean},chapterContent:{},cursorPosition:{},currentWordCount:{},targetWordCount:{},canUndo:{type:Boolean}},emits:["startStreamingGeneration","getAISuggestions","update:showCitationHelper","insert-citation","checkCitations","undoLastAction"],setup(b,{emit:x}){const o=b,A=x,p=E("Academic Formal"),h=E(null),C=E(!1),f=E({expand:!1,improve:!1,rephrase:!1,cite:!1,"generate-full":!1,"generate-section":!1,custom:!1}),S=P(()=>!!o.chapter?.id&&!!o.chapter?.chapter_number),l=P(()=>o.chapterContent&&o.chapterContent.trim().length>0);P(()=>!l.value&&S.value),P(()=>!h.value&&S.value);const w=P(()=>!o.isGenerating&&!!o.chapterContent);P(()=>!o.isLoadingSuggestions&&!!o.selectedText);const u=P(()=>h.value&&h.value.section.name!=="NONE"?h.value.section.name.toLowerCase().replace(/\s+/g,"_"):N()),c=P(()=>!o.isGenerating&&!!o.chapter?.id),i=()=>[{id:"introduction",name:"Introduction",description:"Overview and objectives of this chapter"},{id:"content",name:"Main Content",description:"Chapter main content"},{id:"conclusion",name:"Conclusion",description:"Summary and transition to next chapter"}],y=async(m,d)=>{if(Object.values(f.value).some(D=>D)){W("Please wait for the current action to complete");return}try{switch(m in f.value&&(f.value[m]=!0),m){case"expand":o.selectedText?(A("startStreamingGeneration","expand",{selectedText:o.selectedText}),W("Expanding selected text...")):W.error("Please select text to expand");break;case"improve":A("startStreamingGeneration","improve"),W("Improving chapter content...");break;case"rephrase":o.selectedText?(A("startStreamingGeneration","rephrase",{selectedText:o.selectedText,style:p.value}),W("Rephrasing selected text...")):W.error("Please select text to rephrase");break;case"cite":A("update:showCitationHelper",!0),W("Opening citation helper...");break;case"generate-full":A("startStreamingGeneration","progressive"),W("Generating complete chapter...");break;case"generate-section":const D=d?.section||u.value;A("startStreamingGeneration","section",{section:D,mode:"progressive"}),W(`Generating ${D} section...`);break;default:throw new Error(`Unknown action: ${m}`)}}catch(D){console.error(`Quick action '${m}' failed:`,D),W.error(`Failed to ${m.replace("-"," ")}. Please try again.`)}finally{setTimeout(()=>{m in f.value&&(f.value[m]=!1)},1e3)}},N=()=>{if(!l.value)return"introduction";const m=o.chapterContent.toLowerCase(),d=i();for(const D of d)if(![D.name.toLowerCase(),D.id.replace("_"," ")].some(_=>m.includes(_)))return D.id;return"conclusion"},R=m=>{const d=i();return d.find(D=>D.id===m)||d[0]},M=m=>{A("insert-citation",m)};return se(()=>o.chapter,m=>{m?.id&&(h.value=null)},{immediate:!1}),se(()=>o.chapterContent,m=>{h.value&&(!m||m.trim().length===0)&&(h.value=null)},{immediate:!1}),(m,d)=>(T(),B("div",fn,[r(e(Z),{class:"border-none shadow-none bg-transparent"},{default:n(()=>[r(e(te),{class:"px-2 py-3"},{default:n(()=>[r(e(le),{class:"flex items-center gap-2 text-sm font-semibold text-foreground/80"},{default:n(()=>[s("div",mn,[r(e(He),{class:"h-4 w-4"})]),d[9]||(d[9]=g(" AI Assistant ",-1))]),_:1})]),_:1}),r(e(ee),{class:"px-2 space-y-6"},{default:n(()=>[r(e(Ft),{open:!0,class:"space-y-2"},{default:n(()=>[r(e(Rt),{class:"flex w-full items-center justify-between text-xs font-medium text-muted-foreground hover:text-foreground transition-colors group"},{default:n(()=>[s("span",hn,[r(e(Mr),{class:"h-3.5 w-3.5 text-amber-500/70 group-hover:text-amber-500 transition-colors"}),d[10]||(d[10]=g(" QUICK ACTIONS ",-1))]),r(e(Wt),{class:"h-3 w-3 transition-transform duration-200 group-data-[state=open]:rotate-180"})]),_:1}),r(e(Pt),{class:"space-y-3 pt-1"},{default:n(()=>[s("div",vn,[r(Fe,{"enter-active-class":"transition-all duration-300 ease-out","enter-from-class":"opacity-0 scale-95 translate-y-1","enter-to-class":"opacity-100 scale-100 translate-y-0"},{default:n(()=>[h.value&&h.value.show_section_button?(T(),B("div",bn,[r(e(j),{onClick:d[0]||(d[0]=D=>y("generate-section")),disabled:!c.value||C.value||m.isGenerating||f.value["generate-section"],variant:"outline",class:"w-full h-auto flex-col items-start gap-2 p-3 rounded-xl border-primary/20 bg-background/50 hover:bg-primary/5 hover:border-primary/40 transition-all duration-300 text-left group relative overflow-hidden"},{default:n(()=>[d[12]||(d[12]=s("div",{class:"absolute inset-0 bg-gradient-to-r from-primary/5 to-transparent opacity-0 group-hover:opacity-100 transition-opacity"},null,-1)),s("div",xn,[s("div",wn,[r(e(Nt),{class:"h-3.5 w-3.5"}),d[11]||(d[11]=s("span",{class:"text-xs font-semibold"},"Write Next Section",-1))]),f.value["generate-section"]?(T(),q(e(Lr),{key:0,class:"h-3 w-3 animate-spin text-primary"})):V("",!0)]),s("div",yn,[s("div",_n,v(h.value?.section.name||R(u.value).name),1),s("div",kn,v(h.value?.section.description||R(u.value).description),1)])]),_:1},8,["disabled"])])):V("",!0)]),_:1}),r(Fe,{"enter-active-class":"transition-all duration-300 ease-out","enter-from-class":"opacity-0 scale-95 translate-y-1","enter-to-class":"opacity-100 scale-100 translate-y-0"},{default:n(()=>[h.value&&h.value.show_full_chapter_button?(T(),q(e(j),{key:0,onClick:d[1]||(d[1]=D=>y("generate-full")),disabled:m.isGenerating||C.value||f.value["generate-full"],variant:"ghost",class:"w-full h-9 justify-start gap-2 px-3 rounded-lg text-xs text-muted-foreground hover:text-primary hover:bg-primary/5"},{default:n(()=>[r(e(Tr),{class:"h-3.5 w-3.5"}),d[13]||(d[13]=s("span",null,"Generate Complete Chapter",-1))]),_:1},8,["disabled"])):V("",!0)]),_:1}),r(Fe,{"enter-active-class":"transition-all duration-500 ease-out","enter-from-class":"opacity-0 scale-95 translate-y-2","enter-to-class":"opacity-100 scale-100 translate-y-0"},{default:n(()=>[h.value&&h.value.status==="COMPLETE"?(T(),B("div",Cn,[s("div",Sn,[r(e(Fr),{class:"h-4 w-4"}),d[14]||(d[14]=s("span",{class:"text-sm font-semibold"},"Chapter Complete",-1))]),s("div",En,[s("div",Tn,[d[15]||(d[15]=s("span",null,"Progress",-1)),s("span",null,v(h.value.completion_percentage)+"%",1)]),r(e(Er),{"model-value":h.value.completion_percentage,class:"h-1.5"},null,8,["model-value"])])])):V("",!0)]),_:1})]),s("div",$n,[r(e(j),{onClick:d[2]||(d[2]=D=>y("improve")),disabled:!w.value||m.isGenerating||f.value.improve,variant:"outline",class:"h-20 flex-col gap-2 rounded-xl border-border/50 bg-background/50 hover:bg-accent hover:border-accent transition-all duration-300"},{default:n(()=>[s("div",An,[r(e(Rr),{class:"h-4 w-4"})]),d[16]||(d[16]=s("span",{class:"text-xs font-medium"},"Improve",-1))]),_:1},8,["disabled"]),r(e(j),{onClick:d[3]||(d[3]=D=>y("expand")),disabled:!m.selectedText||m.isGenerating||f.value.expand,variant:"outline",class:"h-20 flex-col gap-2 rounded-xl border-border/50 bg-background/50 hover:bg-accent hover:border-accent transition-all duration-300"},{default:n(()=>[s("div",Dn,[r(e(Cr),{class:"h-4 w-4"})]),d[17]||(d[17]=s("span",{class:"text-xs font-medium"},"Expand",-1))]),_:1},8,["disabled"]),r(e(j),{onClick:d[4]||(d[4]=D=>y("cite")),disabled:m.isGenerating||f.value.cite,variant:"outline",class:"h-20 flex-col gap-2 rounded-xl border-border/50 bg-background/50 hover:bg-accent hover:border-accent transition-all duration-300"},{default:n(()=>[s("div",jn,[r(e(Sr),{class:"h-4 w-4"})]),d[18]||(d[18]=s("span",{class:"text-xs font-medium"},"Cite",-1))]),_:1},8,["disabled"]),r(e(j),{onClick:d[5]||(d[5]=D=>y("rephrase")),disabled:!m.selectedText||m.isGenerating||f.value.rephrase,variant:"outline",class:"h-20 flex-col gap-2 rounded-xl border-border/50 bg-background/50 hover:bg-accent hover:border-accent transition-all duration-300"},{default:n(()=>[s("div",Mn,[r(e(Pr),{class:"h-4 w-4"})]),d[19]||(d[19]=s("span",{class:"text-xs font-medium"},"Rephrase",-1))]),_:1},8,["disabled"]),m.canUndo?(T(),q(e(j),{key:0,onClick:d[6]||(d[6]=D=>A("undoLastAction")),variant:"outline",class:"h-20 flex-col gap-2 rounded-xl border-border/50 bg-background/50 hover:bg-amber-500/10 hover:border-amber-500/30 transition-all duration-300 col-span-2"},{default:n(()=>[s("div",Ln,[r(e(Ir),{class:"h-4 w-4"})]),d[20]||(d[20]=s("span",{class:"text-xs font-medium"},"Undo Last AI Change",-1))]),_:1})):V("",!0)])]),_:1})]),_:1}),r(e(qe),{class:"bg-border/50"}),r(e(Ft),{open:!0,class:"space-y-2"},{default:n(()=>[r(e(Rt),{class:"flex w-full items-center justify-between text-xs font-medium text-muted-foreground hover:text-foreground transition-colors group"},{default:n(()=>[s("span",Fn,[r(e(Nt),{class:"h-3.5 w-3.5 text-indigo-500/70 group-hover:text-indigo-500 transition-colors"}),d[21]||(d[21]=g(" WRITING STYLE ",-1))]),r(e(Wt),{class:"h-3 w-3 transition-transform duration-200 group-data-[state=open]:rotate-180"})]),_:1}),r(e(Pt),{class:"pt-1"},{default:n(()=>[s("div",Rn,[Te(s("select",{"onUpdate:modelValue":d[7]||(d[7]=D=>p.value=D),class:"w-full bg-transparent border-none text-xs font-medium focus:ring-0 cursor-pointer py-1.5 px-2"},[...d[22]||(d[22]=[s("option",{value:"Academic Formal"},"Academic Formal",-1),s("option",{value:"Academic Casual"},"Academic Casual",-1),s("option",{value:"Technical"},"Technical",-1),s("option",{value:"Analytical"},"Analytical",-1),s("option",{value:"Research-Heavy"},"Research-Heavy",-1)])],512),[[Js,p.value]])])]),_:1})]),_:1})]),_:1})]),_:1}),r($r,{"show-citation-helper":m.showCitationHelper,"chapter-content":m.chapterContent,"chapter-id":m.chapter?.id||0,"onUpdate:showCitationHelper":d[8]||(d[8]=D=>A("update:showCitationHelper",D)),onInsertCitation:M},null,8,["show-citation-helper","chapter-content","chapter-id"])]))}}),zn=dt(Pn,[["__scopeId","data-v-8c5c841d"]]),Wn={class:"h-14 flex items-center justify-between px-4 border-b border-border/40 shrink-0"},Nn={class:"flex-1 overflow-y-auto custom-scrollbar"},qn={class:"p-4 space-y-6"},Ut=Oe({__name:"ChapterEditorRightSidebar",props:{project:{},chapter:{},isGenerating:{type:Boolean},selectedText:{},isLoadingSuggestions:{type:Boolean},showCitationHelper:{type:Boolean},chapterContent:{},currentWordCount:{},targetWordCount:{},handleAIGeneration:{type:Function},getAISuggestions:{type:Function},updateCitationHelper:{type:Function},insertCitation:{type:Function},checkCitations:{type:Function},showDefensePrep:{type:Boolean},defenseQuestions:{},isLoadingDefenseQuestions:{type:Boolean},isGeneratingDefenseQuestions:{type:Boolean},chapterContext:{},defenseWatcher:{},autoGenerateDefense:{type:Boolean},handleDefensePanelToggle:{type:Function},generateNewDefenseQuestions:{type:Function},handleDefenseAutoToggle:{type:Function},refreshDefenseQuestions:{type:Function},markQuestionHelpful:{type:Function},hideQuestion:{type:Function},isCollapsed:{type:Boolean},containerClass:{}},setup(b){const x=b;return(o,A)=>Te((T(),B("aside",{class:Be(x.containerClass)},[s("div",Wn,[A[1]||(A[1]=s("span",{class:"text-sm font-semibold tracking-tight text-foreground"},"Writing Assistant",-1)),r(e(ue),null,{default:n(()=>[r(e(ie),{asChild:""},{default:n(()=>[r(e(j),{variant:"ghost",size:"icon",class:"h-7 w-7"},{default:n(()=>[r(e(Xt),{class:"h-3.5 w-3.5"})]),_:1})]),_:1}),r(e(de),null,{default:n(()=>[...A[0]||(A[0]=[g("Manage Citations",-1)])]),_:1})]),_:1})]),s("div",Nn,[s("div",qn,[r(zn,{project:x.project,chapter:x.chapter,"is-generating":x.isGenerating,"selected-text":x.selectedText,"is-loading-suggestions":x.isLoadingSuggestions,"show-citation-helper":x.showCitationHelper,"chapter-content":x.chapterContent,"current-word-count":x.currentWordCount,"target-word-count":x.targetWordCount,onStartStreamingGeneration:x.handleAIGeneration,onGetAiSuggestions:x.getAISuggestions,"onUpdate:showCitationHelper":x.updateCitationHelper,onInsertCitation:x.insertCitation,onCheckCitations:x.checkCitations},null,8,["project","chapter","is-generating","selected-text","is-loading-suggestions","show-citation-helper","chapter-content","current-word-count","target-word-count","onStartStreamingGeneration","onGetAiSuggestions","onUpdate:showCitationHelper","onInsertCitation","onCheckCitations"])])])],2)),[[Le,!x.isCollapsed]])}});function Hn(b){const x=E({sentences:0,paragraphs:0,readingTime:0,avgWordLength:0,uniqueWords:0,commonWords:[]}),o=P(()=>b.value?b.value.split(/\s+/).filter(h=>h.length>0).length:0),A=()=>{if(!b.value){x.value={sentences:0,paragraphs:0,readingTime:0,avgWordLength:0,uniqueWords:0,commonWords:[]};return}const h=b.value,C=h.split(/\s+/).filter(c=>c.length>0),f=h.split(/[.!?]+/).filter(c=>c.trim().length>0),S=h.split(`

`).filter(c=>c.trim().length>0),l=new Map;C.forEach(c=>{const i=c.toLowerCase().replace(/[^a-z0-9]/g,"");i&&l.set(i,(l.get(i)||0)+1)});const w=new Set(["the","a","an","and","or","but","in","on","at","to","for","of","with","by","is","was","are","were"]),u=Array.from(l.entries()).filter(([c])=>!w.has(c)).sort((c,i)=>i[1]-c[1]).slice(0,5).map(([c])=>c);x.value={sentences:f.length,paragraphs:S.length,readingTime:Math.ceil(C.length/200),avgWordLength:C.reduce((c,i)=>c+i.length,0)/C.length,uniqueWords:l.size,commonWords:u}},p=P(()=>{if(!b.value)return 0;let h=0;const C=b.value;C.includes("##")&&(h+=20),C.length>1e3&&(h+=20),C.match(/\[.*?\]/g)&&(h+=15),(C.includes("**")||C.includes("*"))&&(h+=10);const f=C.split(/[.!?]+/).filter(l=>l.trim().length>0);if(f.length>0){const l=f.reduce((w,u)=>w+u.split(/\s+/).length,0)/f.length;l>10&&l<25&&(h+=20)}return C.split(`

`).filter(l=>l.trim().length>0).length>3&&(h+=15),Math.min(h,100)});return{writingStats:x,currentWordCount:o,writingQualityScore:p,calculateWritingStats:A}}function Bn(b){const x=E(!1),o=E(null),A=E([]),p=E(null),h=P(()=>{if(!o.value?.quality_level)return"text-muted-foreground";switch(o.value.quality_level){case"Excellent":return"text-green-600";case"Good":return"text-blue-600";case"Satisfactory":return"text-yellow-600";case"Needs Improvement":return"text-orange-600";case"Poor":return"text-red-600";default:return"text-muted-foreground"}}),C=P(()=>o.value?.scores?Object.entries(o.value.scores).sort(([,i],[,y])=>i.percentage-y.percentage).slice(0,3).map(([i,y])=>({category:i.replace(" & "," & "),percentage:Math.round(y.percentage),score:y.score,max:y.max})):[]),f=async()=>{try{x.value=!0,p.value=null,await ce.get("/sanctum/csrf-cookie");const i=await ce.post(K("api.chapters.analysis.analyze",{chapter:b}));if(i.data.success)return o.value=i.data.analysis,i.data.analysis;throw new Error(i.data.error||"Analysis failed")}catch(i){return p.value=i.response?.data?.error||i.message||"Analysis failed",console.error("Chapter analysis failed:",i),null}finally{x.value=!1}};return{isAnalyzing:x,latestAnalysis:o,analysisHistory:A,error:p,qualityLevelColor:h,topImprovementAreas:C,analyzeChapter:f,getLatestAnalysis:async()=>{try{await ce.get("/sanctum/csrf-cookie");const i=await ce.get(K("api.chapters.analysis.latest",{chapter:b}));return i.data.success?(o.value=i.data.analysis,i.data.analysis):(o.value=null,null)}catch(i){return i.response?.status!==404&&(p.value=i.response?.data?.error||i.message||"Failed to get analysis",console.error("Failed to get latest analysis:",i)),null}},getAnalysisHistory:async()=>{try{await ce.get("/sanctum/csrf-cookie");const i=await ce.get(K("api.chapters.analysis.history",{chapter:b}));if(i.data.success)return A.value=i.data.analyses,i.data.analyses;throw new Error(i.data.error||"Failed to get history")}catch(i){return p.value=i.response?.data?.error||i.message||"Failed to get analysis history",console.error("Failed to get analysis history:",i),[]}},autoAnalyze:async(i,y=500)=>{i>=y&&await f()},getScoreColor:(i,y)=>{const N=i/y*100;return N>=80?"text-green-600":N>=70?"text-blue-600":N>=60?"text-yellow-600":N>=40?"text-orange-600":"text-red-600"},getProgressVariant:i=>i>=80?"success":i>=60?"default":"destructive"}}const On={key:0,class:"min-h-screen bg-background text-foreground"},Gn={class:"mx-auto max-w-5xl p-6"},In={class:"flex items-center justify-between gap-4"},Un={class:"flex items-center gap-3"},Qn={class:"mt-6 grid gap-4"},Kn={class:"flex flex-wrap gap-x-6 gap-y-1"},Vn={class:"grid gap-1"},Xn={class:"grid gap-1"},Jn={class:"grid gap-4 md:grid-cols-3"},Yn={class:"mx-auto w-full max-w-5xl p-6"},Zn={class:"flex items-center justify-between gap-4"},ea={class:"flex items-center gap-3"},ta={class:"mt-6 grid gap-4"},sa={class:"flex flex-wrap gap-x-6 gap-y-1"},ra={class:"grid gap-1"},na={class:"grid gap-1"},aa={class:"grid gap-4 md:grid-cols-3"},oa={key:0,class:"rounded-xl border border-border bg-card p-4"},la={key:1,class:"flex h-screen flex-col overflow-hidden bg-background dark:bg-background font-sans selection:bg-primary/20 transition-colors duration-300"},ia={class:"relative z-20 flex flex-shrink-0 items-center justify-between border-b border-border/40 bg-background/60 p-4 backdrop-blur-xl supports-[backdrop-filter]:bg-background/40 transition-all duration-300"},da={class:"flex items-center gap-5"},ua={class:"flex flex-col"},ca={class:"text-lg font-bold tracking-tight text-foreground/90 font-display"},pa={class:"flex items-center gap-3 text-xs text-muted-foreground"},ga={class:"flex items-center gap-1.5"},fa={class:"flex items-center gap-4"},ma={class:"flex items-center p-1 rounded-full border border-border/40 bg-background/50 backdrop-blur-sm shadow-sm"},ha={class:"flex items-center gap-2"},va={class:"relative z-20 h-[2px] w-full bg-border/20"},ba={key:0,class:"mx-3 my-2"},xa={class:"relative overflow-hidden rounded-xl border border-blue-200 bg-gradient-to-br from-blue-50 to-purple-50 p-3 shadow-sm dark:border-blue-800 dark:from-blue-950/30 dark:to-purple-950/30"},wa={class:"relative z-10 mb-2 flex items-center justify-between"},ya={class:"flex items-center gap-2"},_a={class:"relative"},ka={class:"flex h-6 w-6 items-center justify-center rounded-full bg-gradient-to-br from-blue-500 to-purple-600"},Ca={class:"text-xs text-blue-700 dark:text-blue-300"},Sa={class:"relative z-10 mb-2"},Ea={class:"mb-1 flex items-center justify-between"},Ta={class:"text-xs text-blue-600 dark:text-blue-400"},$a={class:"relative h-2 overflow-hidden rounded-full bg-blue-100 dark:bg-blue-900/50"},Aa={class:"relative z-10 flex items-center gap-2"},Da={class:"flex-shrink-0"},ja={key:0,class:"h-2 w-2 animate-bounce rounded-full bg-blue-500"},Ma={key:1,class:"flex gap-0.5"},La={key:2,class:"h-2 w-2 animate-spin rounded-full border-2 border-blue-500 border-t-transparent"},Fa={key:3,class:"h-2 w-2 rounded-full bg-green-500"},Ra={key:4,class:"h-2 w-2 rounded-full bg-red-500"},Pa={class:"flex-1 text-xs text-blue-800 dark:text-blue-200"},za={class:"relative z-10 flex flex-1 overflow-hidden"},Wa={key:0,class:"w-[320px] flex-shrink-0 border-r border-border/50 bg-background/80 backdrop-blur-xl shadow-xl z-20"},Na={class:"h-full overflow-y-auto custom-scrollbar"},qa={class:"p-4"},Ha={class:"mb-3"},Ba={class:"text-xs text-muted-foreground"},Oa={class:"flex min-h-0 flex-1 flex-col bg-transparent relative"},Ga={class:"flex-1 overflow-hidden relative"},Ia={class:"absolute inset-0 overflow-y-auto custom-scrollbar flex flex-col items-center py-8 px-4 sm:px-8"},Ua={class:"flex h-full w-full overflow-hidden relative"},Qa={class:"hidden lg:flex w-80 flex-col border-r border-border/40 bg-background/60 backdrop-blur-xl z-20 transition-all duration-300"},Ka={class:"h-14 flex items-center justify-between px-4 border-b border-border/40 shrink-0"},Va={class:"p-4"},Xa={class:"flex-1 flex flex-col relative z-10 min-w-0 bg-background/30 dark:bg-background transition-all duration-300"},Ja={class:"md:hidden flex flex-wrap items-start justify-between border-b border-border/40 bg-background/60 backdrop-blur-md px-4 py-3 relative z-30 transition-all duration-300 gap-y-2"},Ya={class:"flex items-center gap-2 flex-shrink-0 order-1"},Za={class:"flex items-center order-2"},eo={class:"order-3 w-full flex flex-col gap-3"},to={class:"flex items-start gap-3 w-full min-w-0"},so={class:"flex items-center gap-2 justify-between mt-1"},ro={class:"flex items-center gap-2"},no={class:"flex items-center gap-2"},ao={key:0,class:"inline"},oo={class:"hidden md:flex flex-col w-full z-30 bg-background/60 backdrop-blur-md transition-all duration-300 relative"},lo={class:"h-10 border-b border-border/40 flex items-left justify-left px-4 bg-background/40"},io={class:"flex items-left gap-3"},uo=["innerHTML"],co={class:"h-12 border-b border-border/40 flex items-center justify-between px-4 gap-3 bg-muted/10"},po={class:"flex items-center gap-1"},go={class:"flex items-center gap-3"},fo={class:"flex items-center bg-background/50 rounded-full border border-border/50 p-1 backdrop-blur-sm shadow-sm"},mo={class:"hidden xl:inline"},ho={class:"hidden xl:inline"},vo={class:"flex items-center gap-2"},bo={class:"flex items-center gap-2 pl-2 border-l border-border/50"},xo={class:"inline"},wo={class:"flex-1 overflow-hidden relative group bg-background/20"},yo={key:0,class:"absolute top-6 left-0 right-0 z-40 px-4 flex justify-center pointer-events-none"},_o={class:"w-full max-w-lg pointer-events-auto"},ko={class:"relative overflow-hidden rounded-xl border border-blue-200 bg-gradient-to-br from-blue-50/95 to-purple-50/95 p-3 shadow-lg backdrop-blur-lg dark:border-blue-800 dark:from-blue-950/90 dark:to-purple-950/90"},Co={class:"flex items-center gap-3"},So={class:"relative flex h-8 w-8 items-center justify-center rounded-full bg-gradient-to-br from-blue-500 to-purple-600 shadow-md"},Eo={class:"flex-1 min-w-0"},To={class:"flex items-center justify-between mb-1"},$o={class:"text-xs font-mono text-muted-foreground"},Ao={class:"h-1.5 w-full bg-blue-100 dark:bg-blue-900/40 rounded-full overflow-hidden"},Do={class:"mt-2 text-xs text-muted-foreground ml-11 truncate"},jo={class:"mx-auto py-12 px-6 sm:px-10 min-h-full"},Mo={class:"min-h-[600px] pb-32"},Lo={class:"pb-32"},Fo={class:"h-7 border-t border-border/30 bg-background/40 backdrop-blur-sm flex items-center justify-between px-4 text-[10px] text-muted-foreground shrink-0"},Ro={class:"flex items-center gap-3"},Po={class:"hidden sm:inline"},zo={class:"flex items-center gap-2"},Wo={key:0,class:"text-green-500 flex items-center gap-1 ml-2"},No={key:0,class:"fixed inset-0 bg-black/50 flex items-center justify-center z-50"},qo={class:"text-slate-600 dark:text-slate-300 mb-4"},Ho={class:"font-semibold text-amber-600 dark:text-amber-400"},Bo={class:"flex flex-col sm:flex-row gap-3"},Oo=1e3,Go=Oe({__name:"ChapterEditor",props:{project:{},chapter:{},allChapters:{},facultyChapters:{},mode:{}},setup(b){const x=st(()=>rt(()=>import("./ChapterNavigation-CVIDTaVJ.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23]))),o=st(()=>rt(()=>import("./MobileNavOverlay-DwPf0ksD.js"),__vite__mapDeps([24,3,4,25,2,1,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,68,69,70,71,72,73,74,75,76,77,78,79,80,81,82,83,84,85,86,87]))),A=st(()=>rt(()=>import("./CitationVerificationLayout-_PnffatD.js"),__vite__mapDeps([88,17,2,3,4,8,27,28,30,6,7,31,5,9,89,42,14,20,12,13,15,11,32,33,68,69,70,71,72,73,18,60,19,74,75,76,54,55,62,77,78,79,39,56,40,41,43,44,45,46,47,48,49,50,51,52,53,23,57,58,59,80,29,38,10,36,61,63,64,35,65,66,81,82,67,83,84,85,86]))),p=b,h=E(null),C=E(null),f=E(!1),S=E(!1),l=E(0);if(typeof window<"u"){const a=new URLSearchParams(window.location.search);f.value=a.has("theme_sandbox"),S.value=a.get("theme_sandbox")==="nolayout"||a.has("theme_sandbox_nolayout");const t=a.get("theme_sandbox_step"),k=t?Number.parseInt(t,10):0;l.value=Number.isFinite(k)?k:0}const{appearance:w,isDark:u}=Qt(),c=E({htmlHasDark:!1,background:"",foreground:"",card:"",sidebarBackground:"",bodyBg:"",insetBg:"",sampleBgBackground:"",sampleBgCard:"",sampleBgMuted:""}),i=E(null),y=E(null),N=E(null);function R(){if(typeof window>"u")return;const a=document.documentElement,t=window.getComputedStyle(a),k=document.querySelector('[data-slot="sidebar-inset"]'),Q=k?window.getComputedStyle(k).backgroundColor:"";c.value={htmlHasDark:a.classList.contains("dark"),background:t.getPropertyValue("--background").trim(),foreground:t.getPropertyValue("--foreground").trim(),card:t.getPropertyValue("--card").trim(),sidebarBackground:t.getPropertyValue("--sidebar-background").trim(),bodyBg:window.getComputedStyle(document.body).backgroundColor,insetBg:Q,sampleBgBackground:i.value?window.getComputedStyle(i.value).backgroundColor:"",sampleBgCard:y.value?window.getComputedStyle(y.value).backgroundColor:"",sampleBgMuted:N.value?window.getComputedStyle(N.value).backgroundColor:""}}const{chapterTitle:M,chapterContent:m,isEditorDark:d,toggleChapterTheme:D,isNativeFullscreen:z,selectedText:$,showChatMode:_,showCitationMode:O,showDefensePrep:U,loadChatModeFromStorage:re,saveChatModeToStorage:be,showLeftSidebar:G,showRightSidebar:J,isMobile:Ge,isLeftSidebarCollapsed:$e,isRightSidebarCollapsed:Ae,showLeftSidebarInFullscreen:xe,showRightSidebarInFullscreen:L}=Ur(p),{balance:H,showPurchaseModal:I,requiredWordsForModal:F,actionDescriptionForModal:X,checkAndPrompt:Re,closePurchaseModal:Pe,estimates:we}=nr(),ze=(a,t)=>Re(Math.max(1,Math.round(a)),t),{hasUnsavedChanges:Xe,isSaving:ne,triggerAutoSave:ye,save:ae,clearAutoSave:Yt}=ar({delay:1e4,onSave:Rs});let ut=0;const Zt=()=>{const a=Date.now();a-ut>Oo&&(ut=a,W.success("Saved",{duration:2e3}))},{addToHistory:es,undo:ts,redo:ss}=Ar(p.chapter.content||""),{writingStats:ct,writingQualityScore:_e,calculateWritingStats:Je}=Hn(m),{isAnalyzing:rs,latestAnalysis:ns,getLatestAnalysis:as}=Bn(p.chapter.id),pe=P(()=>{if(p.facultyChapters&&p.facultyChapters.length>0){const t=p.facultyChapters.find(k=>k.number===p.chapter.chapter_number);if(t?.word_count)return t.word_count}if(p.project?.outlines&&p.project.outlines.length>0){const t=p.project.outlines.find(k=>k.chapter_number===p.chapter.chapter_number);if(t?.target_word_count)return t.target_word_count}const a=p.project.type==="undergraduate"?2500:3500;return p.chapter.chapter_number===1||p.chapter.chapter_number===5?Math.round(a*.8):a}),{generateNextChapter:Ye}=Qr({props:p,allChapters:p.allChapters,targetWordCount:pe,estimates:we,ensureBalance:ze,save:ae}),{currentWordCount:oe,progressPercentage:os,DEFENSE_THRESHOLD:ls,countWords:is}=or(m,pe),pt=os,gt=P(()=>({chapter:p.chapter,chapterTitle:M,chapterContent:m,showPresentationMode:fe,togglePresentationMode:Ct,isStreamingMode:vt,isGenerating:De,generationProgress:Ie,generationPercentage:ke,generationPhase:Ce,aiChapterAnalysis,nextSection,getSectionInfo,writingStats:ct,latestAnalysis:ns,isAnalyzing:rs,writingQualityScore:_e,isSaving:ne,isValid:Qe,save:ae,goToBulkAnalysis:et,markAsComplete:tt,richTextEditor:h,richTextEditorFullscreen:C,selectedText:$,setSelectedText:a=>{$.value=a}})),ds=P(()=>({chapter_number:_t.value.chapter_number,chapter_title:_t.value.title,word_count:oe.value})),us=P(()=>({meetsThreshold:Ss.value,shouldShowProgress:ys.value,progressPercentage:_s.value,wordsRemaining:ks.value,hasTriggeredGeneration:Cs,threshold:ls,statusMessage:ws()})),ft=P(()=>({project:me.value,chapter:he.value,isGenerating:De.value,selectedText:$.value,isLoadingSuggestions:ht.value,showCitationHelper:Ue.value,chapterContent:m.value,currentWordCount:oe.value,targetWordCount:pe.value,handleAIGeneration:xt,getAISuggestions:wt,updateCitationHelper:a=>{Ue.value=a},insertCitation:js,checkCitations:yt,showDefensePrep:U.value,defenseQuestions:cs.value??[],isLoadingDefenseQuestions:ps.value,isGeneratingDefenseQuestions:gs.value,chapterContext:ds.value,defenseWatcher:us.value,autoGenerateDefense:fs.value,handleDefensePanelToggle:Os,generateNewDefenseQuestions:hs,handleDefenseAutoToggle:xs,refreshDefenseQuestions:()=>mt(!0,{skipGeneration:!0}),markQuestionHelpful:vs,hideQuestion:bs})),{defenseQuestions:cs,isLoadingDefenseQuestions:ps,isGeneratingDefenseQuestions:gs,autoGenerateDefense:fs,shouldLoadDefenseQuestions:ms,loadDefenseQuestions:mt,generateNewDefenseQuestions:hs,markQuestionHelpful:vs,hideQuestion:bs,handleDefenseAutoToggle:xs,getDefenseStatusMessage:ws,shouldShowDefenseProgress:ys,defenseProgressPercentage:_s,defenseWordsRemaining:ks,hasTriggeredGeneration:Cs,meetsDefenseThreshold:Ss}=Vr({props:p,chapterContent:m,currentWordCount:oe,ensureBalance:ze,estimates:we}),{isGenerating:De,generationProgress:Ie,generationPercentage:ke,generationPhase:Ce,estimatedTotalWords:Es,streamWordCount:Ts,streamBuffer:Uo,lastStreamUpdate:Qo,originalContentForAppend:Ko,aiSuggestions:Vo,isLoadingSuggestions:ht,showCitationHelper:Ue,showPresentationMode:fe,isStreamingMode:vt,showRecoveryDialog:$s,partialContentSaved:Xo,savedWordCountOnError:As,isCollectingPapers:Jo,paperCollectionProgress:Yo,paperCollectionPhase:Zo,collectedPapersCount:el,paperCollectionPercentage:tl,currentSource:sl,sourcesCompleted:rl,papersPreview:nl,paperCollectionData:al,paperCollectionInterval:ol,reconnectAttempts:ll,reconnectDelay:il,isReconnecting:dl,currentGenerationId:ul,currentGenerationType:cl,eventSource:bt,editorScrollRef:Ds,attachScroller:pl,smoothScrollToBottom:gl,forceScrollToBottom:fl,resetScroller:ml,isAutoScrollActive:hl,isUserScrollingScroller:vl,scrollToBottom:bl,checkConnectionQuality:xl,handleAIGeneration:xt,getAISuggestions:wt,checkCitations:yt,insertCitation:js,resumeGeneration:Ms,dismissRecovery:Ls,checkForAutoGeneration:Fs}=lr({props:p,chapterContent:m,targetWordCount:pe,estimates:we,ensureBalance:ze,save:ae,triggerAutoSave:ye,calculateWritingStats:Je,countWords:is,selectedText:$,richTextEditor:h,richTextEditorFullscreen:C,isNativeFullscreen:z}),Qe=P(()=>{const a=M.value?.trim(),t=m.value?.trim();return a&&a.length>0&&t&&t.length>50}),me=P(()=>p.project),he=P(()=>p.chapter),ve=P(()=>p.allChapters),_t=P(()=>p.chapter);async function Rs(a=!1){try{const t=await fetch(K("chapters.save",{project:p.project.id}),{method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json","X-Requested-With":"XMLHttpRequest","X-CSRF-TOKEN":document.querySelector('meta[name="csrf-token"]')?.getAttribute("content")||""},body:JSON.stringify({project_id:p.project.id,chapter_number:p.chapter.chapter_number,title:M.value,content:m.value,auto_save:a,statistics:ct.value,quality_score:_e.value})});console.log("Response status:",t.status,t.statusText),console.log("Response headers:",t.headers);const k=await t.text();console.log("Raw response:",k);let Q;try{Q=JSON.parse(k)}catch(ge){throw console.error("JSON parse error:",ge),console.error("Response was:",k),new Error(`Server returned non-JSON response: ${t.status} ${t.statusText}`)}t.ok}catch(t){throw a||W.error("âŒ Save Failed",{description:"Please try again or check your connection."}),t}}const Ps=()=>{const a=ts();a!==null&&(m.value=a,ye())},zs=()=>{const a=ss();a!==null&&(m.value=a,ye())},We=a=>{Xe.value&&confirm("You have unsaved changes. Save before switching chapters?")&&ae();const t=p.allChapters.find(ge=>ge.chapter_number===a),Q=t?.content&&t.content.trim()!==""?"chapters.edit":"chapters.write";Y.visit(K(Q,{project:p.project.slug,chapter:a}),{only:["chapter","mode","allChapters"],preserveState:!0,preserveScroll:!1})},kt=()=>document.fullscreenElement||document.webkitFullscreenElement||document.msFullscreenElement||null,Ws=async()=>{try{const a=document.documentElement;a.requestFullscreen?await a.requestFullscreen({navigationUI:"hide"}):a.webkitRequestFullscreen?await a.webkitRequestFullscreen():a.msRequestFullscreen&&await a.msRequestFullscreen()}catch(a){console.error("Error entering fullscreen:",a),W.error("Fullscreen Error",{description:"Unable to enter fullscreen mode"})}},Ns=async()=>{try{document.exitFullscreen?await document.exitFullscreen():document.webkitExitFullscreen?await document.webkitExitFullscreen():document.msExitFullscreen&&await document.msExitFullscreen()}catch(a){console.error("Error exiting fullscreen:",a),W.error("Fullscreen Error",{description:"Unable to exit fullscreen mode"})}},Ze=async()=>{if(kt()){await Ns();return}await Ws()},Se=()=>{z.value=!!kt(),je(()=>{f.value&&R()})},qs=()=>{_.value=!_.value,_.value&&(O.value=!1),be(_.value)},Hs=()=>{O.value=!1},Ct=()=>{fe.value=!fe.value},et=()=>{Y.visit(K("projects.analysis",{project:p.project.slug}))},Bs=()=>{es(m.value),ye(),Je()},St=a=>{(a.ctrlKey||a.metaKey)&&a.key==="s"&&(a.preventDefault(),ae(),Zt()),(a.ctrlKey||a.metaKey)&&!a.shiftKey&&a.key==="z"&&(a.preventDefault(),Ps()),(a.ctrlKey||a.metaKey)&&a.shiftKey&&a.key==="z"&&(a.preventDefault(),zs()),(a.ctrlKey||a.metaKey)&&a.shiftKey&&(a.key==="f"||a.key==="F")&&(a.preventDefault(),Ze())};Me(()=>{const a=()=>{Ge.value=window.innerWidth<1024};a(),window.addEventListener("resize",a),_.value=re(),document.addEventListener("keydown",Et),document.addEventListener("keydown",St),document.addEventListener("fullscreenchange",Se),document.addEventListener("webkitfullscreenchange",Se),document.addEventListener("msfullscreenchange",Se),Se(),Je(),Fs()});const Et=a=>{if((a.ctrlKey||a.metaKey)&&!["INPUT","TEXTAREA","SELECT"].includes(a.target?.tagName))switch(a.key){case"ArrowLeft":a.preventDefault();const t=p.chapter.chapter_number-1;p.allChapters.find(Ne=>Ne.chapter_number===t)&&We(t);break;case"ArrowRight":a.preventDefault();const Q=p.chapter.chapter_number+1;p.allChapters.find(Ne=>Ne.chapter_number===Q)&&We(Q);break}};Me(()=>{const a=t=>{const k=Q=>{const{scrollTop:ge,scrollHeight:Ne,clientHeight:Gs}=t,Tt=Q.deltaY,Is=ge<=0,Us=ge+Gs>=Ne;Tt<0&&Is||Tt>0&&Us||Q.stopPropagation()};return t.addEventListener("wheel",k,{passive:!0}),()=>t.removeEventListener("wheel",k)};je(()=>{const t=document.querySelectorAll('[class*="overflow-y-auto"]'),k=[];t.forEach(Q=>{if(Q instanceof HTMLElement){const ge=a(Q);k.push(ge)}}),window.__scrollChainCleanup=k})}),Ys(()=>{Yt(),bt.value&&bt.value.close(),document.removeEventListener("keydown",St),document.removeEventListener("keydown",Et);const a=window.__scrollChainCleanup;a&&Array.isArray(a)&&(a.forEach(t=>t()),delete window.__scrollChainCleanup),document.removeEventListener("fullscreenchange",Se),document.removeEventListener("webkitfullscreenchange",Se),document.removeEventListener("msfullscreenchange",Se)}),se(()=>p.chapter,async a=>{M.value=a.title||"",m.value=a.content||""},{immediate:!1});const Os=async a=>{U.value=a,a&&ms()&&await mt(!1,{skipGeneration:!0})};se(m,Bs),se(M,ye);const tt=async()=>{console.log("ðŸ”µ [MARK COMPLETE] Function called"),console.log("ðŸ”µ [MARK COMPLETE] Current word count:",oe.value);try{console.log("ðŸ”µ [MARK COMPLETE] Saving chapter..."),await ae(!1),console.log("âœ… [MARK COMPLETE] Chapter saved");const a=K("chapters.mark-complete",{project:p.project.slug,chapter:p.chapter.chapter_number});console.log("ðŸ”µ [MARK COMPLETE] Posting to:",a),Y.post(a,{},{onSuccess:()=>{console.log("âœ… [MARK COMPLETE] Request successful")},onError:t=>{console.error("âŒ [MARK COMPLETE] Request failed:",t)}})}catch(a){console.error("âŒ [MARK COMPLETE] Error:",a),W.error("Failed to save chapter before marking complete")}};return Me(async()=>{await as()}),Me(()=>{f.value&&je(()=>R())}),se(u,()=>{f.value&&je(()=>R())},{flush:"post"}),(a,t)=>(T(),q(e(tr),null,{default:n(()=>[f.value?(T(),B($t,{key:0},[S.value?(T(),B("div",On,[s("div",Gn,[s("div",In,[t[23]||(t[23]=s("div",null,[s("h1",{class:"text-lg font-semibold"},"ChapterEditor Theme Sandbox"),s("p",{class:"text-sm text-muted-foreground"},"No layout mode. Use `?theme_sandbox=nolayout`.")],-1)),s("div",Un,[r(jt),r(e(j),{variant:"outline",size:"sm",onClick:R},{default:n(()=>[...t[21]||(t[21]=[g("Refresh",-1)])]),_:1}),r(e(j),{variant:"outline",size:"sm",onClick:t[0]||(t[0]=k=>e(Y).visit(a.window.location.pathname))},{default:n(()=>[...t[22]||(t[22]=[g("Exit",-1)])]),_:1})])]),s("div",Qn,[r(e(Z),{class:"bg-card text-card-foreground"},{default:n(()=>[r(e(te),null,{default:n(()=>[r(e(le),{class:"text-base"},{default:n(()=>[...t[24]||(t[24]=[g("Theme State",-1)])]),_:1})]),_:1}),r(e(ee),{class:"space-y-2 text-sm"},{default:n(()=>[s("div",Kn,[s("div",null,[t[25]||(t[25]=s("span",{class:"text-muted-foreground"},"appearance:",-1)),g(" "+v(e(w)),1)]),s("div",null,[t[26]||(t[26]=s("span",{class:"text-muted-foreground"},"isDark:",-1)),g(" "+v(e(u)),1)]),s("div",null,[t[27]||(t[27]=s("span",{class:"text-muted-foreground"},"html.dark:",-1)),g(" "+v(c.value.htmlHasDark),1)]),s("div",null,[t[28]||(t[28]=s("span",{class:"text-muted-foreground"},"step:",-1)),g(" "+v(l.value),1)])]),r(e(qe)),s("div",Vn,[s("div",null,[t[29]||(t[29]=s("span",{class:"text-muted-foreground"},"--background:",-1)),g(" "+v(c.value.background),1)]),s("div",null,[t[30]||(t[30]=s("span",{class:"text-muted-foreground"},"--foreground:",-1)),g(" "+v(c.value.foreground),1)]),s("div",null,[t[31]||(t[31]=s("span",{class:"text-muted-foreground"},"--card:",-1)),g(" "+v(c.value.card),1)]),s("div",null,[t[32]||(t[32]=s("span",{class:"text-muted-foreground"},"--sidebar-background:",-1)),g(" "+v(c.value.sidebarBackground),1)])]),r(e(qe)),s("div",Xn,[s("div",null,[t[33]||(t[33]=s("span",{class:"text-muted-foreground"},"body bg:",-1)),g(" "+v(c.value.bodyBg),1)]),s("div",null,[t[34]||(t[34]=s("span",{class:"text-muted-foreground"},"inset bg:",-1)),g(" "+v(c.value.insetBg),1)]),s("div",null,[t[35]||(t[35]=s("span",{class:"text-muted-foreground"},"sample bg-background:",-1)),g(" "+v(c.value.sampleBgBackground),1)]),s("div",null,[t[36]||(t[36]=s("span",{class:"text-muted-foreground"},"sample bg-card:",-1)),g(" "+v(c.value.sampleBgCard),1)]),s("div",null,[t[37]||(t[37]=s("span",{class:"text-muted-foreground"},"sample bg-muted:",-1)),g(" "+v(c.value.sampleBgMuted),1)])])]),_:1})]),_:1}),s("div",Jn,[r(e(Z),{ref_key:"sampleBgBackgroundEl",ref:i,class:"bg-background"},{default:n(()=>[r(e(te),null,{default:n(()=>[r(e(le),{class:"text-base"},{default:n(()=>[...t[38]||(t[38]=[g("bg-background",-1)])]),_:1})]),_:1}),r(e(ee),{class:"text-sm text-muted-foreground"},{default:n(()=>[...t[39]||(t[39]=[g("Should flip with theme.",-1)])]),_:1})]),_:1},512),r(e(Z),{ref_key:"sampleBgCardEl",ref:y,class:"bg-card"},{default:n(()=>[r(e(te),null,{default:n(()=>[r(e(le),{class:"text-base"},{default:n(()=>[...t[40]||(t[40]=[g("bg-card",-1)])]),_:1})]),_:1}),r(e(ee),{class:"text-sm text-muted-foreground"},{default:n(()=>[...t[41]||(t[41]=[g("Card surface color.",-1)])]),_:1})]),_:1},512),r(e(Z),{ref_key:"sampleBgMutedEl",ref:N,class:"bg-muted"},{default:n(()=>[r(e(te),null,{default:n(()=>[r(e(le),{class:"text-base"},{default:n(()=>[...t[42]||(t[42]=[g("bg-muted",-1)])]),_:1})]),_:1}),r(e(ee),{class:"text-sm text-muted-foreground"},{default:n(()=>[...t[43]||(t[43]=[g("Muted surface color.",-1)])]),_:1})]),_:1},512)])])])])):(T(),q(Mt,{key:1,class:"h-screen overflow-hidden bg-background text-foreground"},{default:n(()=>[s("div",Yn,[s("div",Zn,[t[46]||(t[46]=s("div",null,[s("h1",{class:"text-lg font-semibold"},"ChapterEditor Theme Sandbox"),s("p",{class:"text-sm text-muted-foreground"}," Use `?theme_sandbox=1` (with layout) or `?theme_sandbox=nolayout`. ")],-1)),s("div",ea,[r(jt),r(e(j),{variant:"outline",size:"sm",onClick:R},{default:n(()=>[...t[44]||(t[44]=[g("Refresh",-1)])]),_:1}),r(e(j),{variant:"outline",size:"sm",onClick:t[1]||(t[1]=k=>e(Y).visit(a.window.location.pathname))},{default:n(()=>[...t[45]||(t[45]=[g("Exit",-1)])]),_:1})])]),s("div",ta,[r(e(Z),{class:"bg-card text-card-foreground"},{default:n(()=>[r(e(te),null,{default:n(()=>[r(e(le),{class:"text-base"},{default:n(()=>[...t[47]||(t[47]=[g("Theme State",-1)])]),_:1})]),_:1}),r(e(ee),{class:"space-y-2 text-sm"},{default:n(()=>[s("div",sa,[s("div",null,[t[48]||(t[48]=s("span",{class:"text-muted-foreground"},"appearance:",-1)),g(" "+v(e(w)),1)]),s("div",null,[t[49]||(t[49]=s("span",{class:"text-muted-foreground"},"isDark:",-1)),g(" "+v(e(u)),1)]),s("div",null,[t[50]||(t[50]=s("span",{class:"text-muted-foreground"},"html.dark:",-1)),g(" "+v(c.value.htmlHasDark),1)]),s("div",null,[t[51]||(t[51]=s("span",{class:"text-muted-foreground"},"step:",-1)),g(" "+v(l.value),1)])]),r(e(qe)),s("div",ra,[s("div",null,[t[52]||(t[52]=s("span",{class:"text-muted-foreground"},"--background:",-1)),g(" "+v(c.value.background),1)]),s("div",null,[t[53]||(t[53]=s("span",{class:"text-muted-foreground"},"--foreground:",-1)),g(" "+v(c.value.foreground),1)]),s("div",null,[t[54]||(t[54]=s("span",{class:"text-muted-foreground"},"--card:",-1)),g(" "+v(c.value.card),1)]),s("div",null,[t[55]||(t[55]=s("span",{class:"text-muted-foreground"},"--sidebar-background:",-1)),g(" "+v(c.value.sidebarBackground),1)])]),r(e(qe)),s("div",na,[s("div",null,[t[56]||(t[56]=s("span",{class:"text-muted-foreground"},"body bg:",-1)),g(" "+v(c.value.bodyBg),1)]),s("div",null,[t[57]||(t[57]=s("span",{class:"text-muted-foreground"},"inset bg:",-1)),g(" "+v(c.value.insetBg),1)]),s("div",null,[t[58]||(t[58]=s("span",{class:"text-muted-foreground"},"sample bg-background:",-1)),g(" "+v(c.value.sampleBgBackground),1)]),s("div",null,[t[59]||(t[59]=s("span",{class:"text-muted-foreground"},"sample bg-card:",-1)),g(" "+v(c.value.sampleBgCard),1)]),s("div",null,[t[60]||(t[60]=s("span",{class:"text-muted-foreground"},"sample bg-muted:",-1)),g(" "+v(c.value.sampleBgMuted),1)])])]),_:1})]),_:1}),s("div",aa,[r(e(Z),{ref_key:"sampleBgBackgroundEl",ref:i,class:"bg-background"},{default:n(()=>[r(e(te),null,{default:n(()=>[r(e(le),{class:"text-base"},{default:n(()=>[...t[61]||(t[61]=[g("bg-background",-1)])]),_:1})]),_:1}),r(e(ee),{class:"text-sm text-muted-foreground"},{default:n(()=>[...t[62]||(t[62]=[g("Should flip with theme.",-1)])]),_:1})]),_:1},512),r(e(Z),{ref_key:"sampleBgCardEl",ref:y,class:"bg-card"},{default:n(()=>[r(e(te),null,{default:n(()=>[r(e(le),{class:"text-base"},{default:n(()=>[...t[63]||(t[63]=[g("bg-card",-1)])]),_:1})]),_:1}),r(e(ee),{class:"text-sm text-muted-foreground"},{default:n(()=>[...t[64]||(t[64]=[g("Card surface color.",-1)])]),_:1})]),_:1},512),r(e(Z),{ref_key:"sampleBgMutedEl",ref:N,class:"bg-muted"},{default:n(()=>[r(e(te),null,{default:n(()=>[r(e(le),{class:"text-base"},{default:n(()=>[...t[65]||(t[65]=[g("bg-muted",-1)])]),_:1})]),_:1}),r(e(ee),{class:"text-sm text-muted-foreground"},{default:n(()=>[...t[66]||(t[66]=[g("Muted surface color.",-1)])]),_:1})]),_:1},512)]),l.value>=1?(T(),B("div",oa,[t[67]||(t[67]=s("div",{class:"text-sm font-medium"},"Step 1: Paper Card only",-1)),t[68]||(t[68]=s("div",{class:"text-xs text-muted-foreground mb-3"},"Adds `ChapterEditorPaperCard` only.",-1)),r(It,{context:gt.value},null,8,["context"])])):V("",!0)])])]),_:1}))],64)):(T(),B($t,{key:1},[e(O)?(T(),q(e(A),{key:0,project:me.value,chapter:he.value,"chapter-title":e(M),"chapter-content":e(m),"current-word-count":e(oe),"target-word-count":pe.value,"progress-percentage":e(pt),onExitCitationMode:Hs},null,8,["project","chapter","chapter-title","chapter-content","current-word-count","target-word-count","progress-percentage"])):e(z)?(T(),B("div",la,[t[84]||(t[84]=s("div",{class:"absolute inset-0 z-0 overflow-hidden pointer-events-none"},[s("div",{class:"absolute top-[-20%] left-[-10%] w-[50%] h-[50%] rounded-full bg-blue-500/5 blur-[120px]"}),s("div",{class:"absolute bottom-[-20%] right-[-10%] w-[50%] h-[50%] rounded-full bg-purple-500/5 blur-[120px]"})],-1)),s("div",ia,[s("div",da,[r(e(ue),null,{default:n(()=>[r(e(ie),{asChild:""},{default:n(()=>[r(e(j),{onClick:t[2]||(t[2]=k=>e(Y).visit(e(K)("projects.show",p.project.slug))),variant:"ghost",size:"icon",class:"h-10 w-10 rounded-full hover:bg-primary/10 hover:text-primary transition-all duration-300"},{default:n(()=>[r(e(at),{class:"h-5 w-5"})]),_:1})]),_:1}),r(e(de),null,{default:n(()=>[...t[69]||(t[69]=[s("p",null,"Back to Project",-1)])]),_:1})]),_:1}),s("div",ua,[s("h1",ca,v(p.project.title),1),s("div",pa,[r(e(Ee),{variant:"outline",class:"h-5 px-2 rounded-full border-primary/20 bg-primary/5 text-primary font-medium"},{default:n(()=>[g(" Chapter "+v(p.chapter.chapter_number),1)]),_:1}),s("span",ga,[t[70]||(t[70]=s("span",{class:"h-1.5 w-1.5 rounded-full bg-green-500 animate-pulse"},null,-1)),g(" "+v(e(oe))+" words ",1)])])])]),s("div",fa,[s("div",ma,[r(e(j),{onClick:t[3]||(t[3]=k=>xe.value=!e(xe)),variant:e(xe)?"secondary":"ghost",size:"sm",class:Be(["h-8 px-4 rounded-full text-xs font-medium transition-all duration-300",e(xe)?"bg-primary/10 text-primary hover:bg-primary/15":"hover:bg-muted"])},{default:n(()=>[r(e(qt),{class:"mr-2 h-3.5 w-3.5"}),t[71]||(t[71]=g(" Outline ",-1))]),_:1},8,["variant","class"]),t[73]||(t[73]=s("div",{class:"w-px h-4 bg-border/50 mx-1"},null,-1)),r(e(j),{onClick:t[4]||(t[4]=k=>L.value=!e(L)),variant:e(L)?"secondary":"ghost",size:"sm",class:Be(["h-8 px-4 rounded-full text-xs font-medium transition-all duration-300",e(L)?"bg-primary/10 text-primary hover:bg-primary/15":"hover:bg-muted"])},{default:n(()=>[r(e(He),{class:"mr-2 h-3.5 w-3.5"}),t[72]||(t[72]=g(" Assistant ",-1))]),_:1},8,["variant","class"])]),s("div",ha,[r(e(ue),null,{default:n(()=>[r(e(ie),{asChild:""},{default:n(()=>[r(e(j),{onClick:Ze,variant:e(z)?"secondary":"ghost",size:"icon",class:"h-9 w-9 rounded-full transition-all hover:bg-muted"},{default:n(()=>[e(z)?(T(),q(e(Ht),{key:0,class:"h-4.5 w-4.5"})):(T(),q(e(zt),{key:1,class:"h-4.5 w-4.5"}))]),_:1},8,["variant"])]),_:1}),r(e(de),null,{default:n(()=>[s("p",null,v(e(z)?"Exit fullscreen":"Enter fullscreen"),1)]),_:1})]),_:1}),r(e(ue),null,{default:n(()=>[r(e(ie),{asChild:""},{default:n(()=>[r(e(j),{onClick:e(D),variant:e(d)?"secondary":"ghost",size:"icon",class:"h-9 w-9 rounded-full transition-all hover:bg-muted"},{default:n(()=>[e(d)?(T(),q(e(Bt),{key:0,class:"h-4.5 w-4.5 text-foreground"})):(T(),q(e(Ot),{key:1,class:"h-4.5 w-4.5 text-muted-foreground"}))]),_:1},8,["onClick","variant"])]),_:1}),r(e(de),null,{default:n(()=>[...t[74]||(t[74]=[s("p",null,"Toggle Dark Mode",-1)])]),_:1})]),_:1}),r(nt,{project:me.value,"current-chapter":he.value,"all-chapters":ve.value,size:"icon",variant:"ghost",class:"h-9 w-9 rounded-full hover:bg-muted"},null,8,["project","current-chapter","all-chapters"])])])]),s("div",va,[s("div",{class:"absolute top-0 left-0 h-full bg-gradient-to-r from-blue-500 via-purple-500 to-pink-500 transition-all duration-700 ease-out shadow-[0_0_10px_rgba(59,130,246,0.5)]",style:Ke({width:`${Math.min(e(pt),100)}%`})},null,4)]),e(De)?(T(),B("div",ba,[s("div",xa,[t[80]||(t[80]=s("div",{class:"absolute inset-0 -skew-x-12 animate-pulse bg-gradient-to-r from-transparent via-white/10 to-transparent"},null,-1)),s("div",wa,[s("div",ya,[s("div",_a,[s("div",ka,[r(e(He),{class:"h-3 w-3 text-white"})]),t[75]||(t[75]=s("div",{class:"absolute inset-0 h-6 w-6 animate-ping rounded-full bg-gradient-to-br from-blue-500 to-purple-600 opacity-20"},null,-1))]),s("div",null,[t[76]||(t[76]=s("h4",{class:"text-xs font-semibold text-blue-900 dark:text-blue-100"},"AI Generator",-1)),s("p",Ca,v(e(Ce)),1)])]),r(e(Ee),{variant:"outline",class:"border-blue-300 text-xs text-blue-700 dark:border-blue-700 dark:text-blue-300"},{default:n(()=>[g(v(Math.round(e(ke)))+"% ",1)]),_:1})]),s("div",Sa,[s("div",Ea,[t[77]||(t[77]=s("span",{class:"text-xs text-blue-800 dark:text-blue-200"},"Generation Progress",-1)),s("span",Ta,v(e(Ts))+" / "+v(e(Es))+" words",1)]),s("div",$a,[s("div",{class:"absolute top-0 left-0 h-full rounded-full bg-gradient-to-r from-blue-500 to-purple-500 transition-all duration-500 ease-out",style:Ke({width:`${e(ke)}%`})},[...t[78]||(t[78]=[s("div",{class:"absolute inset-0 animate-pulse bg-gradient-to-r from-transparent via-white/30 to-transparent"},null,-1)])],4),s("div",{class:"absolute top-0 left-0 h-full rounded-full bg-gradient-to-r from-blue-400 to-purple-400 opacity-50 blur-sm transition-all duration-500",style:Ke({width:`${e(ke)}%`})},null,4)])]),s("div",Aa,[s("div",Da,[e(Ce)==="Initializing"?(T(),B("div",ja)):e(Ce)==="Connecting"?(T(),B("div",Ma,[...t[79]||(t[79]=[s("div",{class:"h-2 w-0.5 animate-pulse rounded-full bg-blue-500"},null,-1),s("div",{class:"h-2 w-0.5 animate-pulse rounded-full bg-purple-500",style:{"animation-delay":"0.2s"}},null,-1),s("div",{class:"h-2 w-0.5 animate-pulse rounded-full bg-blue-500",style:{"animation-delay":"0.4s"}},null,-1)])])):e(Ce)==="Generating"?(T(),B("div",La)):e(Ce)==="Complete"?(T(),B("div",Fa)):(T(),B("div",Ra))]),s("p",Pa,v(e(Ie)),1)])])])):V("",!0),s("div",za,[r(Fe,{"enter-active-class":"transition-all duration-300 ease-in-out","enter-from-class":"-ml-72 opacity-0","enter-to-class":"ml-0 opacity-100","leave-active-class":"transition-all duration-300 ease-in-out","leave-from-class":"ml-0 opacity-100","leave-to-class":"-ml-72 opacity-0"},{default:n(()=>[e(xe)?(T(),B("div",Wa,[s("div",Na,[s("div",qa,[s("div",Ha,[t[81]||(t[81]=s("h2",{class:"text-sm font-semibold text-foreground mb-1"},"Table of Contents",-1)),s("p",Ba,v(ve.value.length)+" Chapters ",1)]),(T(),q(Zs,null,{fallback:n(()=>[...t[82]||(t[82]=[s("div",{class:"flex items-center justify-center p-8"},[s("div",{class:"h-6 w-6 animate-spin rounded-full border-2 border-primary border-t-transparent"})],-1)])]),default:n(()=>[r(e(x),{"all-chapters":ve.value,"current-chapter":he.value,project:me.value,outlines:a.project.outlines||[],"faculty-chapters":a.facultyChapters||[],"current-word-count":e(oe),"target-word-count":pe.value,"writing-quality-score":e(_e),"chapter-content-length":e(m).length,onGoToChapter:We,onGenerateNextChapter:e(Ye)},null,8,["all-chapters","current-chapter","project","outlines","faculty-chapters","current-word-count","target-word-count","writing-quality-score","chapter-content-length","onGenerateNextChapter"])]),_:1}))])])])):V("",!0)]),_:1}),s("div",Oa,[s("div",Ga,[s("div",Ia,[r(It,{context:gt.value},null,8,["context"]),t[83]||(t[83]=s("div",{class:"h-12"},null,-1))])])]),r(Fe,{"enter-active-class":"transition-all duration-300 ease-in-out","enter-from-class":"-mr-72 opacity-0","enter-to-class":"mr-0 opacity-100","leave-active-class":"transition-all duration-300 ease-in-out","leave-from-class":"mr-0 opacity-100","leave-to-class":"-mr-72 opacity-0"},{default:n(()=>[e(L)?(T(),q(Ut,At({key:0,"container-class":"w-72 flex-shrink-0 border-l border-border/40 bg-background/40 backdrop-blur-md"},ft.value),null,16)):V("",!0)]),_:1})])])):(T(),q(Mt,{key:2,class:"h-screen overflow-hidden bg-background dark:bg-background transition-colors duration-300"},{default:n(()=>[s("div",Ua,[t[104]||(t[104]=s("div",{class:"absolute inset-0 z-0 overflow-hidden pointer-events-none"},[s("div",{class:"absolute top-[-10%] left-[-10%] w-[40%] h-[40%] rounded-full bg-blue-500/5 blur-[100px]"}),s("div",{class:"absolute bottom-[-10%] right-[-10%] w-[40%] h-[40%] rounded-full bg-purple-500/5 blur-[100px]"})],-1)),Te(s("aside",Qa,[s("div",Ka,[t[85]||(t[85]=s("span",{class:"text-sm font-semibold tracking-tight text-foreground"},"Navigation",-1)),r(e(Ee),{variant:"outline",class:"text-[10px] h-5 px-1.5"},{default:n(()=>[g(v(ve.value.length)+" Chapters ",1)]),_:1})]),r(e(Dt),{class:"flex-1"},{default:n(()=>[s("div",Va,[r(e(x),{"all-chapters":ve.value,"current-chapter":he.value,project:me.value,outlines:a.project.outlines||[],"faculty-chapters":a.facultyChapters||[],"current-word-count":e(oe),"target-word-count":pe.value,"writing-quality-score":e(_e),"chapter-content-length":e(m).length,onGoToChapter:We,onGenerateNextChapter:e(Ye)},null,8,["all-chapters","current-chapter","project","outlines","faculty-chapters","current-word-count","target-word-count","writing-quality-score","chapter-content-length","onGenerateNextChapter"])])]),_:1})],512),[[Le,!e($e)]]),s("main",Xa,[s("header",Ja,[s("div",Ya,[r(e(ue),null,{default:n(()=>[r(e(ie),{asChild:""},{default:n(()=>[r(e(j),{variant:"ghost",size:"icon",class:"h-9 w-9 text-zinc-700 dark:text-zinc-300 hover:text-foreground hover:bg-muted/50 rounded-full",onClick:t[5]||(t[5]=k=>e(Y).visit(e(K)("projects.writing",p.project.slug)))},{default:n(()=>[r(e(at),{class:"w-4 h-4"})]),_:1})]),_:1}),r(e(de),null,{default:n(()=>[...t[86]||(t[86]=[g("Back to Writing",-1)])]),_:1})]),_:1}),t[87]||(t[87]=s("div",{class:"h-6 w-px bg-border/50 mx-1 hidden lg:block"},null,-1)),r(e(j),{variant:"ghost",size:"icon",onClick:t[6]||(t[6]=k=>G.value=!0),class:"lg:hidden text-muted-foreground hover:text-foreground h-9 w-9 hover:bg-muted/50 rounded-full"},{default:n(()=>[r(e(qt),{class:"h-4.5 w-4.5"})]),_:1})]),s("div",Za,[r(e(j),{variant:"ghost",size:"icon",onClick:t[7]||(t[7]=k=>J.value=!0),class:"text-muted-foreground hover:text-foreground h-9 w-9 hover:bg-muted/50 rounded-full"},{default:n(()=>[r(e(He),{class:"h-4.5 w-4.5"})]),_:1})]),s("div",eo,[s("div",to,[s("h1",{class:"text-xl font-bold tracking-tight text-foreground leading-snug cursor-pointer hover:text-primary/80 transition-colors break-words",onClick:t[8]||(t[8]=k=>e(Y).visit(e(K)("projects.show",p.project.slug)))},v(p.project.title),1),r(e(Ee),{variant:"secondary",class:"shrink-0 h-5 px-2 text-[10px] font-medium rounded-full bg-secondary/50 border border-border/50 mt-1"},{default:n(()=>[g(" Ch "+v(p.chapter.chapter_number),1)]),_:1})]),s("div",so,[s("div",ro,[r(nt,{project:me.value,"current-chapter":he.value,"all-chapters":ve.value,size:"icon",variant:"outline","trigger-element":"icon","button-class":"h-8 w-8 rounded-full bg-background/50 backdrop-blur-sm",class:"text-zinc-700 dark:text-zinc-300"},null,8,["project","current-chapter","all-chapters"]),r(e(j),{variant:"outline",size:"icon",class:"h-8 w-8 gap-2 text-zinc-700 dark:text-zinc-300 hover:text-foreground bg-background/50 backdrop-blur-sm rounded-full",onClick:et},{default:n(()=>[r(e(Gt),{class:"w-4 h-4"})]),_:1})]),s("div",no,[r(e(j),{onClick:t[9]||(t[9]=k=>e(ae)(!1)),disabled:e(ne),variant:Qe.value?"default":"secondary",size:"sm",class:"h-8 px-3 text-xs shadow-sm gap-2 rounded-full min-w-[32px]"},{default:n(()=>[r(e(lt),{class:"h-3.5 w-3.5"}),e(ne)?(T(),B("span",ao,"Saving")):V("",!0)]),_:1},8,["disabled","variant"]),r(e(j),{onClick:tt,disabled:e(ne),size:"sm",class:"h-8 px-3 text-xs shadow-sm gap-2 rounded-full"},{default:n(()=>[r(e(Ve),{class:"h-3.5 w-3.5"}),t[88]||(t[88]=s("span",{class:"sm:hidden"},"Done",-1))]),_:1},8,["disabled"])])])])]),s("div",oo,[s("div",lo,[s("div",io,[s("h1",{class:"text-sm font-bold text-foreground cursor-pointer hover:text-primary transition-colors flex items-center",onClick:t[10]||(t[10]=k=>e(Y).visit(e(K)("projects.show",p.project.slug)))},[s("div",{innerHTML:p.project.title,class:"inline-block"},null,8,uo)]),r(e(Ee),{variant:"secondary",class:"h-5 px-2 text-[10px] font-medium rounded-full bg-secondary/50 border border-border/50"},{default:n(()=>[g(" Ch "+v(p.chapter.chapter_number),1)]),_:1})])]),s("div",co,[s("div",po,[r(e(ue),null,{default:n(()=>[r(e(ie),{asChild:""},{default:n(()=>[r(e(j),{variant:"ghost",size:"icon",class:"h-8 w-8 text-zinc-700 dark:text-zinc-300 hover:text-foreground rounded-full",onClick:t[11]||(t[11]=k=>e(Y).visit(e(K)("projects.writing",p.project.slug)))},{default:n(()=>[r(e(at),{class:"w-4 h-4"})]),_:1})]),_:1}),r(e(de),null,{default:n(()=>[...t[89]||(t[89]=[g("Back to Writing",-1)])]),_:1})]),_:1}),t[90]||(t[90]=s("div",{class:"h-4 w-px bg-border/50 mx-1"},null,-1)),r(e(j),{variant:"ghost",size:"icon",onClick:t[12]||(t[12]=k=>$e.value=!e($e)),class:"text-muted-foreground hover:text-foreground h-8 w-8 rounded-full"},{default:n(()=>[e($e)?(T(),q(e(Wr),{key:1,class:"h-4 w-4"})):(T(),q(e(zr),{key:0,class:"h-4 w-4"}))]),_:1})]),s("div",go,[s("div",fo,[r(e(ue),null,{default:n(()=>[r(e(ie),{asChild:""},{default:n(()=>[r(e(j),{onClick:Ct,variant:e(fe)?"secondary":"ghost",size:"sm",class:"h-7 px-3 text-xs gap-2 text-zinc-700 dark:text-zinc-300 hover:text-foreground rounded-full"},{default:n(()=>[e(fe)?(T(),q(e(Gr),{key:1,class:"h-3.5 w-3.5"})):(T(),q(e(Vt),{key:0,class:"h-3.5 w-3.5"})),s("span",mo,v(e(fe)?"Edit":"Preview"),1)]),_:1},8,["variant"])]),_:1}),r(e(de),null,{default:n(()=>[...t[91]||(t[91]=[g("Toggle Preview Mode",-1)])]),_:1})]),_:1}),t[95]||(t[95]=s("div",{class:"w-px h-3 bg-border/50 mx-0.5"},null,-1)),r(e(ue),null,{default:n(()=>[r(e(ie),{asChild:""},{default:n(()=>[r(e(j),{onClick:qs,variant:"ghost",size:"sm",class:"h-7 px-3 text-xs gap-2 text-muted-foreground hover:text-foreground rounded-full"},{default:n(()=>[r(e(Nr),{class:"h-3.5 w-3.5 text-blue-500"}),t[92]||(t[92]=s("span",{class:"hidden xl:inline text-foreground"},"AI Chat",-1))]),_:1})]),_:1}),r(e(de),null,{default:n(()=>[...t[93]||(t[93]=[g("Open AI Assistant",-1)])]),_:1})]),_:1}),t[96]||(t[96]=s("div",{class:"w-px h-3 bg-border/50 mx-0.5"},null,-1)),r(e(ue),null,{default:n(()=>[r(e(ie),{asChild:""},{default:n(()=>[r(e(j),{onClick:Ze,variant:"ghost",size:"sm",class:"h-7 px-3 text-xs gap-2 text-muted-foreground hover:text-foreground rounded-full"},{default:n(()=>[e(z)?(T(),q(e(Ht),{key:0,class:"h-3.5 w-3.5"})):(T(),q(e(zt),{key:1,class:"h-3.5 w-3.5"})),s("span",ho,v(e(z)?`Exit
                                                        Fullscreen`:"Fullscreen"),1)]),_:1})]),_:1}),r(e(de),null,{default:n(()=>[s("p",null,v(e(z)?"Exit fullscreen":"Enter fullscreen"),1)]),_:1})]),_:1}),t[97]||(t[97]=s("div",{class:"w-px h-3 bg-border/50 mx-0.5"},null,-1)),r(e(ue),null,{default:n(()=>[r(e(ie),{asChild:""},{default:n(()=>[r(e(j),{onClick:e(D),variant:"ghost",size:"sm",class:"h-7 px-3 text-xs gap-2 text-zinc-700 dark:text-zinc-300 hover:text-foreground rounded-full"},{default:n(()=>[e(d)?(T(),q(e(Bt),{key:0,class:"h-3.5 w-3.5 text-foreground"})):(T(),q(e(Ot),{key:1,class:"h-3.5 w-3.5"}))]),_:1},8,["onClick"])]),_:1}),r(e(de),null,{default:n(()=>[...t[94]||(t[94]=[g("Toggle Dark Mode",-1)])]),_:1})]),_:1})]),s("div",vo,[r(nt,{project:me.value,"current-chapter":he.value,"all-chapters":ve.value,size:"sm",variant:"outline","trigger-element":"button","button-class":"h-9 gap-2 px-3 rounded-full bg-background/50 backdrop-blur-sm",class:"text-zinc-700 dark:text-zinc-300"},null,8,["project","current-chapter","all-chapters"]),r(e(j),{variant:"outline",size:"sm",class:"h-9 gap-2 text-zinc-700 dark:text-zinc-300 hover:text-foreground bg-background/50 backdrop-blur-sm rounded-full",onClick:et,title:"Open bulk analysis"},{default:n(()=>[r(e(Gt),{class:"w-4 h-4"}),t[98]||(t[98]=s("span",{class:"text-xs font-medium"},"Analyze",-1))]),_:1})]),s("div",bo,[r(e(j),{onClick:t[13]||(t[13]=k=>e(ae)(!1)),disabled:e(ne),variant:Qe.value?"default":"secondary",size:"sm",class:"h-9 px-4 text-xs shadow-sm gap-2 rounded-full min-w-[32px]"},{default:n(()=>[r(e(lt),{class:"h-3.5 w-3.5"}),s("span",xo,v(e(ne)?"Saving":"Save"),1)]),_:1},8,["disabled","variant"]),r(e(j),{onClick:tt,disabled:e(ne),size:"sm",class:"h-9 px-4 text-xs shadow-sm gap-2 rounded-full"},{default:n(()=>[r(e(Ve),{class:"h-3.5 w-3.5"}),t[99]||(t[99]=s("span",null,"Mark Complete",-1))]),_:1},8,["disabled"]),t[100]||(t[100]=s("div",{class:"w-px h-4 bg-border/50 mx-1"},null,-1)),r(e(j),{variant:"ghost",size:"icon",onClick:t[14]||(t[14]=k=>Ae.value=!e(Ae)),class:"hidden lg:flex text-muted-foreground hover:text-foreground h-9 w-9 hover:bg-muted/50 rounded-full"},{default:n(()=>[e(Ae)?(T(),q(e(jr),{key:1,class:"h-4.5 w-4.5"})):(T(),q(e(Dr),{key:0,class:"h-4.5 w-4.5"}))]),_:1})])])])]),s("div",wo,[r(Fe,{"enter-active-class":"transition-all duration-300 ease-out","enter-from-class":"opacity-0 -translate-y-4","enter-to-class":"opacity-100 translate-y-0","leave-active-class":"transition-all duration-200 ease-in","leave-from-class":"opacity-100 translate-y-0","leave-to-class":"opacity-0 -translate-y-4"},{default:n(()=>[e(De)?(T(),B("div",yo,[s("div",_o,[s("div",ko,[s("div",Co,[s("div",So,[r(e(He),{class:"h-4 w-4 text-white animate-pulse"})]),s("div",Eo,[s("div",To,[t[101]||(t[101]=s("h4",{class:"text-xs font-semibold text-foreground"}," Generating Content...",-1)),s("span",$o,v(Math.round(e(ke)))+"%",1)]),s("div",Ao,[s("div",{class:"h-full bg-gradient-to-r from-blue-500 to-purple-500 transition-all duration-300",style:Ke({width:`${e(ke)}%`})},null,4)])])]),s("p",Do,v(e(Ie)),1)])])])):V("",!0)]),_:1}),r(e(Dt),{ref_key:"editorScrollRef",ref:Ds,class:"h-full w-full"},{default:n(()=>[s("div",jo,[Te(s("div",Mo,[r(Kt,{ref_key:"richTextEditorFullscreen",ref:C,modelValue:e(m),"onUpdate:modelValue":t[15]||(t[15]=k=>er(m)?m.value=k:null),placeholder:"Start writing your chapter...",class:"prose prose-slate dark:prose-invert prose-lg max-w-none focus:outline-none min-h-[500px]","streaming-mode":e(vt),"is-generating":e(De),"generation-progress":e(Ie),"generation-percentage":e(ke),"generation-phase":e(Ce),"onUpdate:selectedText":t[16]||(t[16]=k=>$.value=k),"min-height":"500px"},null,8,["modelValue","streaming-mode","is-generating","generation-progress","generation-percentage","generation-phase"])],512),[[Le,!e(fe)]]),Te(s("div",Lo,[r(Jt,{content:e(m),class:"prose prose-slate dark:prose-invert prose-lg max-w-none"},null,8,["content"])],512),[[Le,e(fe)]])])]),_:1},512)]),s("div",Fo,[s("div",Ro,[s("span",null,"Words: "+v(e(oe))+" / "+v(pe.value),1),s("span",Po,"Last saved: "+v(e(ne)?"Saving...":`Just
                                    now`),1)]),s("div",zo,[s("span",null,[t[102]||(t[102]=g("Quality: ",-1)),s("span",{class:Be(e(_e)>70?"text-green-500":"text-amber-500")},v(e(_e))+"%",3)]),Qe.value?(T(),B("span",Wo,[r(e(Ve),{class:"h-3 w-3"}),t[103]||(t[103]=g(" Ready ",-1))])):V("",!0)])])]),r(Ut,At({"is-collapsed":e(Ae),"container-class":"hidden lg:flex w-96 flex-col border-l border-border/40 bg-background/60 backdrop-blur-xl z-20 transition-all duration-300"},ft.value),null,16,["is-collapsed"])]),r(e(o),{"show-left-sidebar":e(G),"show-right-sidebar":e(J),"is-mobile":e(Ge),"all-chapters":ve.value,"current-chapter":he.value,project:me.value,"current-word-count":e(oe),"target-word-count":pe.value,"writing-quality-score":e(_e),"chapter-content-length":e(m).length,"is-generating":e(De),"selected-text":e($),"is-loading-suggestions":e(ht),"show-citation-helper":e(Ue),"chapter-content":e(m),"onUpdate:showLeftSidebar":t[17]||(t[17]=k=>G.value=k),"onUpdate:showRightSidebar":t[18]||(t[18]=k=>J.value=k),onGoToChapter:We,onGenerateNextChapter:e(Ye),onStartStreamingGeneration:e(xt),onGetAiSuggestions:e(wt),"onUpdate:showCitationHelper":t[19]||(t[19]=k=>Ue.value=k),onCheckCitations:e(yt)},null,8,["show-left-sidebar","show-right-sidebar","is-mobile","all-chapters","current-chapter","project","current-word-count","target-word-count","writing-quality-score","chapter-content-length","is-generating","selected-text","is-loading-suggestions","show-citation-helper","chapter-content","onGenerateNextChapter","onStartStreamingGeneration","onGetAiSuggestions","onCheckCitations"]),r(sr,{open:e(I),"current-balance":e(H),"required-words":e(F),action:e(X),"onUpdate:open":t[20]||(t[20]=k=>I.value=k),onClose:e(Pe)},null,8,["open","current-balance","required-words","action","onClose"]),e($s)?(T(),B("div",No,[r(e(Z),{class:"w-full max-w-md mx-4 bg-white dark:bg-slate-900 border-amber-500/50 shadow-2xl"},{default:n(()=>[r(e(te),null,{default:n(()=>[r(e(le),{class:"flex items-center gap-2 text-amber-600 dark:text-amber-400"},{default:n(()=>[...t[105]||(t[105]=[s("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[s("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"})],-1),g(" Generation Interrupted ",-1)])]),_:1})]),_:1}),r(e(ee),null,{default:n(()=>[s("p",qo,[t[106]||(t[106]=g(" Connection lost. ",-1)),s("span",Ho,v(e(As))+" words",1),t[107]||(t[107]=g(" may have been saved. ",-1))]),s("div",Bo,[r(e(j),{onClick:e(Ms),class:"flex-1 bg-amber-600 hover:bg-amber-700 text-white"},{default:n(()=>[...t[108]||(t[108]=[s("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-4 w-4 mr-2",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[s("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"})],-1),g(" Reload & Recover ",-1)])]),_:1},8,["onClick"]),r(e(j),{onClick:e(Ls),variant:"outline",class:"flex-1"},{default:n(()=>[...t[109]||(t[109]=[g(" Dismiss ",-1)])]),_:1},8,["onClick"])])]),_:1})]),_:1})])):V("",!0)]),_:1}))],64))]),_:1}))}}),Io=dt(Go,[["__scopeId","data-v-a84415bb"]]),ai=Object.freeze(Object.defineProperty({__proto__:null,default:Io},Symbol.toStringTag,{value:"Module"}));export{zn as A,Xt as B,ai as C,Jt as R};
