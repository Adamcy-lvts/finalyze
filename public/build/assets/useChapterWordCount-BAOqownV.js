import{B as n,J as Pe,f as ke,P as j,i as Me,b as $}from"./app-a7FBVBbM.js";import{t as g}from"./index-xgLvMpbV.js";import{r as le}from"./AppLayout.vue_vue_type_script_setup_true_lang-ZuDbLc5K.js";function We(c){const{delay:a=1e4,onSave:T}=c,y=n(!1),E=n(!1),C=n(null),U=()=>{y.value=!0,C.value&&clearTimeout(C.value),C.value=setTimeout(()=>{m(!0)},a)},m=async(I=!1)=>{if(!E.value){E.value=!0;try{await T(I),y.value=!1,C.value&&(clearTimeout(C.value),C.value=null)}finally{E.value=!1}}};return{hasUnsavedChanges:y,isSaving:E,triggerAutoSave:U,save:m,clearAutoSave:()=>{C.value&&(clearTimeout(C.value),C.value=null)}}}const Re={userScrollTimeout:2e3,scrollBehavior:"smooth",bottomThreshold:100};class Ie{scrollContainer=null;isUserScrolling=!1;userScrollTimeout=null;isEnabled=!0;isDestroyed=!1;config;wasAtBottom=!0;rafId=null;handleWheel;handleTouchStart;handleTouchMove;handleScroll;handleKeydown;constructor(a={}){this.config={...Re,...a},this.handleWheel=this.onUserScroll.bind(this),this.handleTouchStart=this.onUserScroll.bind(this),this.handleTouchMove=this.onUserScroll.bind(this),this.handleScroll=this.onScroll.bind(this),this.handleKeydown=this.onKeydown.bind(this)}attach(a){this.isDestroyed||(this.detach(),this.scrollContainer=a,this.setupEventListeners(),this.wasAtBottom=this.isAtBottom())}detach(){this.scrollContainer&&(this.scrollContainer.removeEventListener("wheel",this.handleWheel),this.scrollContainer.removeEventListener("touchstart",this.handleTouchStart),this.scrollContainer.removeEventListener("touchmove",this.handleTouchMove),this.scrollContainer.removeEventListener("scroll",this.handleScroll),this.scrollContainer.removeEventListener("keydown",this.handleKeydown)),this.userScrollTimeout&&(clearTimeout(this.userScrollTimeout),this.userScrollTimeout=null),this.rafId&&(cancelAnimationFrame(this.rafId),this.rafId=null),this.scrollContainer=null}setupEventListeners(){this.scrollContainer&&(this.scrollContainer.addEventListener("wheel",this.handleWheel,{passive:!0}),this.scrollContainer.addEventListener("touchstart",this.handleTouchStart,{passive:!0}),this.scrollContainer.addEventListener("touchmove",this.handleTouchMove,{passive:!0}),this.scrollContainer.addEventListener("scroll",this.handleScroll,{passive:!0}),this.scrollContainer.addEventListener("keydown",this.handleKeydown))}onUserScroll(){this.isEnabled&&(this.isUserScrolling=!0,this.userScrollTimeout&&clearTimeout(this.userScrollTimeout),this.userScrollTimeout=setTimeout(()=>{this.isUserScrolling=!1,this.isAtBottom()&&(this.wasAtBottom=!0)},this.config.userScrollTimeout))}onScroll(){this.wasAtBottom=this.isAtBottom()}onKeydown(a){["ArrowUp","ArrowDown","PageUp","PageDown","Home","End"].includes(a.key)&&this.onUserScroll()}isAtBottom(){if(!this.scrollContainer)return!0;const{scrollTop:a,scrollHeight:T,clientHeight:y}=this.scrollContainer;return T-a-y<=this.config.bottomThreshold}scrollToBottom(){!this.scrollContainer||!this.isEnabled||this.isDestroyed||this.isUserScrolling||!this.wasAtBottom||(this.rafId&&cancelAnimationFrame(this.rafId),this.rafId=requestAnimationFrame(()=>{if(this.rafId=null,!this.scrollContainer||this.isDestroyed)return;const a=this.scrollContainer.scrollHeight-this.scrollContainer.clientHeight;this.config.scrollBehavior==="instant"?this.scrollContainer.scrollTop=a:this.scrollContainer.scrollTo({top:a,behavior:"smooth"}),this.wasAtBottom=!0}))}forceScrollToBottom(){!this.scrollContainer||this.isDestroyed||(this.isUserScrolling=!1,this.wasAtBottom=!0,this.userScrollTimeout&&(clearTimeout(this.userScrollTimeout),this.userScrollTimeout=null),this.scrollToBottom())}enable(){this.isEnabled=!0}disable(){this.isEnabled=!1}isAutoScrollActive(){return this.isEnabled&&!this.isUserScrolling&&this.wasAtBottom}isUserScrollingNow(){return this.isUserScrolling}reset(){this.isUserScrolling=!1,this.wasAtBottom=!0,this.userScrollTimeout&&(clearTimeout(this.userScrollTimeout),this.userScrollTimeout=null)}destroy(){this.isDestroyed=!0,this.detach()}}function Ge(c={}){const a=new Ie(c),T=n(!0),y=n(!1);let E=null;function C(o){o?(a.attach(o),m()):(a.detach(),M())}function U(o){ke(o,i=>{C(i)},{immediate:!0})}function m(){M(),E=setInterval(()=>{T.value=a.isAutoScrollActive(),y.value=a.isUserScrollingNow()},100)}function M(){E&&(clearInterval(E),E=null)}function I(){a.scrollToBottom()}function O(){a.forceScrollToBottom()}function N(){a.enable()}function J(){a.disable()}function h(){a.reset(),T.value=!0,y.value=!1}return Pe(()=>{M(),a.destroy()}),{attach:C,attachRef:U,scrollToBottom:I,forceScrollToBottom:O,enable:N,disable:J,reset:h,isAutoScrollActive:T,isUserScrolling:y}}function Ke({props:c,chapterContent:a,targetWordCount:T,estimates:y,ensureBalance:E,save:C,triggerAutoSave:U,calculateWritingStats:m,countWords:M,selectedText:I,richTextEditor:O,richTextEditorFullscreen:N,isNativeFullscreen:J}){const h=n(!1),o=n(""),i=n(0),u=n(""),A=n(0),v=n(0),f=n(""),R=n(0),X=n(""),Z=n([]),q=n(!1),ee=n(!1),H=n(!1),G=n(!1),B=n(!1),W=n(!1),Y=n(0),r=n(!1),b=n(""),x=n(""),Q=n(0),te=n(0),de=n(null),he=n([]),ge=n([]),pe=n(null),F=n(null),_=n(0),re=3,ae=n(2e3),K=n(!1),V=n(null),Ee=n("progressive"),l=n(null),fe=n(),{attach:me,scrollToBottom:we,forceScrollToBottom:$e,reset:Se,isAutoScrollActive:xe,isUserScrolling:ye}=Ge({userScrollTimeout:2e3,scrollBehavior:"smooth",bottomThreshold:100}),oe=()=>{h.value&&Me(()=>{let t=null;if(J.value){const e=fe.value;if(e){const d=e.$el||e;t=d?.querySelector("[data-radix-scroll-area-viewport]")||d?.querySelector("[data-viewport]")||d?.querySelector('[role="region"]')}}else t=document.querySelector(".overflow-y-auto.custom-scrollbar");if(!t){const e=document.querySelector("main");if(e){const d=e.querySelectorAll("div");for(const s of d)if(s.scrollHeight>s.clientHeight&&s.classList.contains("overflow-y-auto")){t=s;break}}}t&&(me(t),we(),requestAnimationFrame(()=>{!ye.value&&t&&t.scrollTo({top:t.scrollHeight,behavior:"smooth"})}))})},Ce=async()=>{if(!navigator.onLine)return g.error("No Internet Connection",{description:"Please check your internet connection and try again."}),!1;const t=navigator.connection||navigator.mozConnection||navigator.webkitConnection;if(t){const e=t.effectiveType;(e==="slow-2g"||e==="2g")&&g.warning("Slow Connection Detected",{description:"Your connection is slow. Content will be auto-saved during generation.",duration:4e3})}try{const e=new AbortController,d=setTimeout(()=>e.abort(),5e3),s=performance.now();await fetch(j("api.ping"),{method:"HEAD",cache:"no-cache",signal:e.signal}),clearTimeout(d);const S=performance.now()-s;console.log("üì° Server latency:",S.toFixed(0),"ms"),S>2e3&&g.info("Connection is slow",{description:"Content will be auto-saved during generation to prevent data loss.",duration:3e3})}catch(e){console.warn("Connection check ping failed:",e),g.info("Connection check skipped",{description:"Content will be auto-saved during generation.",duration:2e3})}return!0},Ae=async()=>new Promise(t=>{let e=0;const d=120,s=async()=>{try{const w=await(await fetch(j("api.projects.paper-collection.status",{project:c.project.slug}))).json();if(w.success&&w.data){pe.value=w.data;const P=w.data.status,p=w.data.papers_count||w.data.count||0,D=w.data.message,L=w.data.percentage||0,k=w.data.current_source,ne=w.data.sources_completed||[],z=w.data.papers_preview||[];if(Q.value=p,te.value=L,de.value=k,he.value=ne,ge.value=z,P==="completed"){x.value="Complete",b.value=`‚úì Collected ${p} verified sources from ${ne.length} databases`,i.value=50,r.value=!1,F.value&&clearInterval(F.value),t(!0);return}else if(["collecting_papers","initializing","processing","storing"].includes(P)){let se="";k&&(se={semantic_scholar:"Semantic Scholar",openalex:"OpenAlex",crossref:"CrossRef",pubmed:"PubMed"}[k]||k),x.value=se||"Collecting Sources",b.value=D||"Collecting sources from academic databases...",i.value=Math.min(5+L*.4,45)}else if(P==="collection_failed"){x.value="Error",b.value=D||"‚ùå Source collection failed",r.value=!1,F.value&&clearInterval(F.value),t(!1);return}}e++,e>=d&&(x.value="Timeout",b.value="‚è±Ô∏è Source collection timed out",r.value=!1,F.value&&clearInterval(F.value),t(!1))}catch(S){console.error("Error checking paper collection status:",S),e++}};s(),F.value=setInterval(s,5e3)}),be=async()=>{r.value=!0,x.value="Starting",b.value="Initializing source collection...",i.value=5;try{const t=document.querySelector('meta[name="csrf-token"]')?.content;if(!t)throw new Error("CSRF token not found - please refresh the page");const e=await fetch(j("api.projects.paper-collection.start",{project:c.project.slug}),{method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json","X-CSRF-TOKEN":t,"X-Requested-With":"XMLHttpRequest"},credentials:"include"});if(!e.ok){const d=await e.text();if(console.error("API Error:",e.status,d),e.status===409)try{const s=JSON.parse(d);throw new Error(s.message||"Source collection is already in progress")}catch{throw new Error("Source collection is already in progress for this project")}throw new Error(`Failed to start source collection: ${e.status}`)}return await Ae()}catch(t){return console.error("Paper collection failed:",t),x.value="Error",b.value="‚ùå Source collection failed",r.value=!1,!1}},ie=async t=>{const e=y.chapter(T.value||0);if(!E(e,"generate this chapter with AI")||!await Ce())return;if(h.value=!0,f.value="",v.value=0,i.value=5,u.value="Papers",o.value="Checking for verified sources...",G.value=!0,Se(),A.value=T.value||0,H.value=!0,!await be()){g.error("Paper Collection Failed",{description:"Unable to collect verified papers. Please try again."}),h.value=!1,H.value=!1;return}u.value="Initializing",o.value="Starting AI generation with verified sources...",i.value=51;const S=setInterval(()=>{i.value<52&&h.value?i.value+=.2:clearInterval(S)},100),w=j("chapters.stream",{project:c.project.slug,chapter:c.chapter.chapter_number});l.value=new EventSource(`${w}?generation_type=${t}`),l.value.onmessage=P=>{const p=JSON.parse(P.data);switch(p.type){case"start":u.value="Connecting",i.value=52,o.value="Connecting to AI service...";break;case"content":u.value="Generating",f.value+=p.content,v.value=p.word_count||f.value.split(/\s+/).filter(k=>k.length>0).length;const D=Date.now();if(D-R.value>200){a.value=f.value,R.value=D;const k=Math.min(v.value/Math.max(A.value,1)*43,43);i.value=Math.max(52,52+k),o.value=`Generating chapter content... (${v.value} / ${A.value} words)`,oe()}break;case"heartbeat":i.value<95&&(i.value+=.5);break;case"complete":u.value="Complete",i.value=100,h.value=!1,G.value=!1,a.value=f.value;const L=p.final_word_count||v.value;o.value=`‚úì Generated ${L} words successfully`,m(),le(L,`Chapter generation (${c.chapter.chapter_number})`,"chapter",c.chapter.id).catch(k=>console.error("Failed to record word usage (chapter generation):",k)),setTimeout(()=>{U()},500),l.value?.close(),l.value=null;break;case"error":u.value="Error",i.value=50,G.value=!1,p.partial_saved&&(W.value=!0,Y.value=p.saved_word_count||0),p.code==="OFFLINE_MODE"?(o.value="üì° AI services offline",h.value=!1,g.error("AI Services Offline",{description:"Please check your internet connection and try again."})):p.can_resume?(o.value=`‚ö†Ô∏è Generation interrupted (${p.saved_word_count} words saved)`,h.value=!1,B.value=!0,g.warning("Generation Interrupted",{description:`${p.saved_word_count} words were saved. You can resume generation.`,duration:8e3})):(o.value="‚ùå Generation failed",h.value=!1,g.error("Generation Error",{description:p.message||"Please try again."})),l.value?.close(),l.value=null;break;case"autosave":p.word_count&&p.generation_id&&(V.value=p.generation_id);break}},l.value.onerror=()=>{if(_.value<re){_.value++,K.value=!0,u.value="Reconnecting",o.value=`üîÑ Connection lost. Reconnecting... (${_.value}/${re})`,l.value?.close(),l.value=null;const P=ae.value*Math.pow(2,_.value-1);setTimeout(()=>ce(t),P)}else u.value="Error",i.value=50,h.value=!1,K.value=!1,o.value="‚ùå Connection failed after multiple attempts",v.value>100?(W.value=!0,Y.value=v.value,B.value=!0,g.warning("Connection Lost",{description:`${v.value} words may have been saved. Check and resume if needed.`,duration:8e3})):g.error("Connection Error",{description:"Please check your internet connection and try again."}),l.value?.close(),l.value=null,_.value=0,ae.value=2e3}},ce=t=>{l.value&&(l.value.close(),l.value=null);const e=j("chapters.stream",{project:c.project.slug,chapter:c.chapter.chapter_number}),d=new URLSearchParams({generation_type:t,resume_from:v.value.toString()});V.value&&d.set("generation_id",V.value),l.value=new EventSource(`${e}?${d}`),l.value.onmessage=s=>{const S=JSON.parse(s.data);switch(["content","start"].includes(S.type)&&(K.value=!1,_.value=0,u.value="Generating"),S.type){case"start":o.value="‚úÖ Reconnected! Continuing generation...",g.success("Reconnected",{description:"Generation resumed successfully.",duration:3e3});break;case"content":u.value="Generating",f.value+=S.content,v.value=S.word_count||f.value.split(/\s+/).filter(p=>p.length>0).length;const w=Date.now();if(w-R.value>150){a.value=f.value,R.value=w;const p=Math.min(v.value/Math.max(A.value,1)*43,43);i.value=Math.max(52,52+p),o.value=`Generating chapter content... (${v.value} / ${A.value} words)`,oe()}break;case"complete":u.value="Complete",i.value=100,h.value=!1,K.value=!1,a.value=f.value;const P=S.final_word_count||v.value;o.value=`‚úì Generated ${P} words successfully`,le(P,`Chapter generation (${c.chapter.chapter_number})`,"chapter",c.chapter.id).catch(p=>console.error("Failed to record word usage:",p)),setTimeout(()=>{U()},500),l.value?.close(),l.value=null;break;case"error":u.value="Error",h.value=!1,K.value=!1,o.value="‚ùå Generation failed",g.error("Generation Error",{description:S.message||"Please try again."}),l.value?.close(),l.value=null;break;case"autosave":S.generation_id&&(V.value=S.generation_id);break}},l.value.onerror=()=>{if(_.value<re){_.value++;const s=ae.value*Math.pow(2,_.value-1);o.value=`üîÑ Reconnecting... (${_.value}/${re})`,l.value?.close(),setTimeout(()=>ce(t),s)}else u.value="Error",h.value=!1,K.value=!1,o.value="‚ùå Connection failed",v.value>100?(B.value=!0,g.warning("Connection Lost",{description:`${v.value} words may be saved. Refresh to recover.`})):g.error("Connection Error",{description:"Please check your connection and try again."}),l.value?.close(),l.value=null,_.value=0}},Te=async t=>{h.value=!0,f.value="",v.value=0,i.value=5,u.value="Papers",o.value="Checking for verified sources...",A.value=600,X.value=a.value||c.chapter.content||"",H.value=!0;try{i.value=50,u.value="Papers",o.value="Using existing verified sources...",await new Promise(d=>setTimeout(d,500)),u.value="Section",o.value=`Generating ${t} section with verified sources...`,i.value=51;const e=j("chapters.stream",{project:c.project.slug,chapter:c.chapter.chapter_number});l.value=new EventSource(`${e}?generation_type=section&section_type=${t}`),l.value.onmessage=d=>{const s=JSON.parse(d.data);switch(s.type){case"start":u.value="Generating Section",i.value=52,o.value=`Starting ${t} section generation...`;break;case"content":f.value+=s.content,v.value=s.word_count||M(f.value);const S=Date.now();if(S-R.value>150){a.value=X.value+`

`+f.value,R.value=S;const w=Math.min(v.value/A.value*43,43);i.value=Math.max(52,52+w),o.value=`Generating ${t} section... (${v.value} / ${A.value} words)`,m(),oe()}break;case"complete":i.value=100,u.value="Complete",o.value=`‚úì Generated ${t} section (${v.value} words)`,a.value=X.value+`

`+f.value,C(!0),g.success("‚úÖ Section Generated Successfully",{description:`Added ${t} section with ${v.value} words and verified citations.`,duration:5e3}),h.value=!1,l.value?.close();break;case"error":throw new Error(s.message||"Section generation failed");case"heartbeat":i.value<95&&(i.value+=.5);break}},l.value.onerror=()=>{h.value=!1,u.value="Error",o.value="‚ùå Section generation failed",g.error("‚ùå Generation Failed",{description:"Unable to generate section. Please check your connection and try again."}),l.value?.close()}}catch(e){console.error("Section generation failed:",e),h.value=!1,u.value="Error",o.value="‚ùå Section generation error",g.error("‚ùå Generation Failed",{description:"Section generation encountered an error."})}},ue=async(t,e,d)=>{const s=t.split(/\s+/).length,S=e==="rephrase"?Math.max(s,y.rephrase()):Math.max(s*2,y.expand());if(!E(S,`${e} about ${s} words`))return;h.value=!0,f.value="",v.value=0,i.value=10,u.value=e==="rephrase"?"Rephrasing":"Expanding",o.value=`Preparing to ${e} selected text...`,A.value=Math.max(s*(e==="expand"?2:1),100);const w=N.value||O.value,P=w?.getSelectionRange(),p={originalText:t,range:P,wordCount:s,style:d||"Academic Formal",startTime:Date.now()};H.value=!0;try{const D=e==="rephrase"?"rephrase":"expand",L=j("chapters.stream",{project:c.project.slug,chapter:c.chapter.chapter_number}),k=e==="rephrase"?`${L}?generation_type=rephrase&selected_text=${encodeURIComponent(t)}&style=${encodeURIComponent(d||"Academic Formal")}`:`${L}?generation_type=expand&selected_text=${encodeURIComponent(t)}`;l.value=new EventSource(k),l.value.onmessage=ne=>{const z=JSON.parse(ne.data);switch(z.type){case"start":u.value=e==="rephrase"?"Rephrasing Text":"Expanding Text",i.value=e==="rephrase"?30:20,o.value=`${e==="rephrase"?"Rephrasing":"Expanding"} text...`;break;case"content":f.value+=z.content,v.value=z.word_count||M(f.value);const se=Math.min(v.value/A.value*60,60);i.value=Math.max(e==="rephrase"?30:25,(e==="rephrase"?30:25)+se),o.value=`${e==="rephrase"?"Rephrasing":"Expanding"}... (${v.value} words)`;break;case"complete":i.value=100,u.value="Complete",o.value=`‚úì Text ${e==="rephrase"?"rephrased":"expanded"} successfully (${v.value} words)`,p.range&&f.value.trim()&&(w?.replaceSelection(f.value.trim(),p.range)?setTimeout(()=>{const _e=w?.getHTML()||a.value;a.value=_e},100):g.warning("Please manually replace the selected text",{description:"The generated text is ready but could not be automatically inserted."})),C(!0),g.success(`‚úÖ Text ${e==="rephrase"?"Rephrased":"Expanded"} Successfully`,{description:`${e==="rephrase"?"Rephrased":"Expanded"} ${s} words.`}),le(v.value||(e==="expand"?s*2:s),e==="rephrase"?`Rephrase (${p.style})`:"Expand text","chapter",c.chapter.id).catch(ve=>console.error(`Failed to record word usage (${e}):`,ve)),h.value=!1,l.value?.close();break;case"error":console.error(`${e} generation error:`,z.message),h.value=!1,u.value="Error",o.value=`‚ùå Text ${e==="rephrase"?"rephrasing":"expansion"} failed`,g.error(`‚ùå ${e==="rephrase"?"Rephrasing":"Expansion"} Failed`,{description:z.message||"Please try again."}),l.value?.close();break;case"heartbeat":i.value<95&&(i.value+=.5);break}},l.value.onerror=()=>{h.value=!1,u.value="Error",o.value=`‚ùå Text ${e==="rephrase"?"rephrasing":"expansion"} failed`,g.error(`‚ùå ${e==="rephrase"?"Rephrasing":"Expansion"} Failed`,{description:"Unable to process the request. Please check your connection and try again."}),l.value?.close()}}catch(D){console.error("Selection generation failed:",D),h.value=!1,u.value="Error",o.value=`‚ùå Text ${e==="rephrase"?"rephrasing":"expansion"} error`,g.error(`‚ùå ${e==="rephrase"?"Rephrasing":"Expansion"} Failed`,{description:"Text generation encountered an error."})}};return{isGenerating:h,generationProgress:o,generationPercentage:i,generationPhase:u,estimatedTotalWords:A,streamWordCount:v,streamBuffer:f,lastStreamUpdate:R,originalContentForAppend:X,aiSuggestions:Z,isLoadingSuggestions:q,showCitationHelper:ee,showPresentationMode:H,isStreamingMode:G,showRecoveryDialog:B,partialContentSaved:W,savedWordCountOnError:Y,isCollectingPapers:r,paperCollectionProgress:b,paperCollectionPhase:x,collectedPapersCount:Q,paperCollectionPercentage:te,currentSource:de,sourcesCompleted:he,papersPreview:ge,paperCollectionData:pe,paperCollectionInterval:F,reconnectAttempts:_,reconnectDelay:ae,isReconnecting:K,currentGenerationId:V,currentGenerationType:Ee,eventSource:l,editorScrollRef:fe,attachScroller:me,smoothScrollToBottom:we,forceScrollToBottom:$e,resetScroller:Se,isAutoScrollActive:xe,isUserScrollingScroller:ye,scrollToBottom:oe,checkConnectionQuality:Ce,startPaperCollection:be,startStreamingGeneration:ie,attemptReconnection:ce,startSectionGeneration:Te,handleSelectionGeneration:ue,handleAIGeneration:(t,e)=>{t==="section"&&e?.section?Te(e.section):t==="rephrase"&&e?.selectedText?ue(e.selectedText,"rephrase",e.style):t==="expand"&&e?.selectedText?ue(e.selectedText,"expand"):ie(t)},getAISuggestions:async()=>{if(!I.value)return;const t=y.suggestion();if(E(t,"get AI suggestions")){q.value=!0;try{const d=await(await fetch(j("chapters.suggestions",{project:c.project.slug,chapter:c.chapter.chapter_number}),{method:"POST",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":document.querySelector('meta[name="csrf-token"]')?.getAttribute("content")||""},body:JSON.stringify({selected_text:I.value,context:a.value})})).json();Z.value=d.suggestions||[],Z.value.length&&le(y.suggestion(),"AI suggestions","chapter",c.chapter.id).catch(s=>console.error("Failed to record word usage (suggestions):",s))}catch{g.error("Error getting suggestions",{description:"Please try again."})}finally{q.value=!1}}},checkCitations:()=>{ee.value=!0,g.success("Citation Manager opened!",{description:"Review and verify your citations in the panel below."})},insertCitation:t=>{try{const e=N.value?.editor||O.value?.editor;if(!e){g.error("Editor not found");return}const{from:d}=e.state.selection;e.chain().focus().insertContentAt(d,` ${t} `).run(),g.success("Citation inserted successfully")}catch(e){console.error("Failed to insert citation:",e),g.error("Failed to insert citation")}},resumeGeneration:()=>{B.value=!1,W.value=!1,window.location.reload()},dismissRecovery:()=>{B.value=!1,W.value=!1,Y.value=0},checkForAutoGeneration:()=>{const t=new URLSearchParams(window.location.search),e=t.get("ai_generate")==="true",d=t.get("generation_type");!e||!d||setTimeout(()=>{ie("progressive");const s=new URL(window.location.href);s.searchParams.delete("ai_generate"),s.searchParams.delete("generation_type"),window.history.replaceState({},"",s.toString()),g.success("üöÄ AI Generation Started",{description:`Generating ${c.chapter.title} with AI assistance...`})},1e3)}}}function ze(c,a=n(3e3),T=.8){const y=r=>{if(!r)return 0;const x=r.replace(/<[^>]*>/g,"").trim().replace(/\s+/g," ");if(!x)return 0;const Q=x.match(/\b\w+\b/g);return Q?Q.length:0},E=r=>r?r.replace(/<[^>]*>/g,"").replace(/\r\n|\r/g,`
`).trim().split(/\n\s*\n/).filter(te=>te.trim().length>0).length:0,C=r=>{if(!r)return 0;const x=r.replace(/<[^>]*>/g,"").match(/[.!?]+/g);return x?x.length:0},U=r=>Math.round(r/200*10)/10,m=$(()=>y(c.value)),M=$(()=>c.value.length),I=$(()=>c.value.replace(/\s/g,"").length),O=$(()=>E(c.value)),N=$(()=>C(c.value)),J=$(()=>U(m.value)),h=$(()=>{const r=a.value;return!r||r<=0?0:Math.min(m.value/r*100,100)}),o=$(()=>m.value>=a.value*T),i=$(()=>{const r=a.value-m.value;return Math.max(r,0)}),u=$(()=>{const r=a.value*T-m.value;return Math.max(r,0)}),A=$(()=>({wordCount:m.value,characterCount:M.value,characterCountNoSpaces:I.value,paragraphCount:O.value,sentenceCount:N.value,readingTimeMinutes:J.value})),v=$(()=>({current:m.value,target:a.value,percentage:h.value,isComplete:o.value,completionThreshold:T})),f=r=>r>=1e3?`${Math.round(r/100)/10}k`:r.toString(),R=(r=0)=>`${Math.round(h.value*Math.pow(10,r))/Math.pow(10,r)}%`,X=()=>`${m.value} / ${a.value} words (${R()}%)`,Z=()=>{if(o.value)return`‚úÖ Complete (${f(m.value)} words)`;const r=u.value;return`${f(r)} more words to complete`},q=()=>{const r=m.value,b=a.value;return r===0?"empty":r<b*.25?"started":r<b*.75?"progressing":r<b*T?"near_complete":r<b?"complete":"exceeded"},ee=()=>{const r=q();return{empty:"text-gray-500",started:"text-blue-500",progressing:"text-yellow-500",near_complete:"text-orange-500",complete:"text-green-500",exceeded:"text-emerald-600"}[r]},H=()=>{const r=q();return{empty:"bg-gray-200",started:"bg-blue-200",progressing:"bg-yellow-200",near_complete:"bg-orange-200",complete:"bg-green-200",exceeded:"bg-emerald-200"}[r]},G=800,B=$(()=>m.value>=G),W=$(()=>Math.max(G-m.value,0)),Y=$(()=>Math.min(m.value/G*100,100));return{currentWordCount:m,characterCount:M,characterCountNoSpaces:I,paragraphCount:O,sentenceCount:N,readingTimeMinutes:J,progressPercentage:h,isComplete:o,wordsRemaining:i,wordsToComplete:u,wordCountStats:A,wordCountProgress:v,meetsDefenseThreshold:B,defenseWordsRemaining:W,defenseProgressPercentage:Y,DEFENSE_THRESHOLD:G,formatWordCount:f,formatProgress:R,getProgressDisplay:X,getCompletionDisplay:Z,getWordCountStatus:q,getStatusColor:ee,getProgressBarColor:H,countWords:y}}export{We as a,Ke as b,ze as u};
