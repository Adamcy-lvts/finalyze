import{_ as j}from"./index-DbACZKH5.js";import{_ as T}from"./index-hNHpr7NI.js";import{a as $,_ as P}from"./CardContent.vue_vue_type_script_setup_true_lang-DAfafdR8.js";import{_ as M,a as E}from"./CardTitle.vue_vue_type_script_setup_true_lang-jCIxOk9Z.js";import{_ as I}from"./Progress.vue_vue_type_script_setup_true_lang-CIKUULOB.js";import{a as L}from"./ScrollArea.vue_vue_type_script_setup_true_lang-CNqET2oE.js";import{_ as ee}from"./SafeHtmlText.vue_vue_type_script_setup_true_lang-BR7vHaPi.js";import{d as te,W as se,B as C,J as oe,c as n,o as a,F as t,K as l,w as c,u as i,H as r,M as p,a as h,L as u,N as B,U,P as S,a7 as O}from"./app-B7lfR3N7.js";import{B as V,R as ae}from"./useTextHistory-ANaBG0Vh.js";import{X as N}from"./x-BCLiL62L.js";import{L as ie}from"./loader-yZEpYOSM.js";import{C as A}from"./circle-check-big-CewK6vau.js";import{T as F}from"./triangle-alert-DeMCFjtR.js";import"./index-ChnCwrVw.js";import"./Presence-Xes9kb4r.js";import"./useForwardExpose-CcJBOnXo.js";import"./nullish-CHIgUVhi.js";import"./useNonce-BbDqtnuA.js";import"./RichTextEditor-WAwzvvzE.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";import"./index-BWEDi_FC.js";import"./step-DrZ9DcYd.js";import"./chart-column-DR8ItSTZ.js";import"./calendar-DkPqmXOp.js";import"./brain-Lwwy2GNm.js";import"./users-CMh1J4TY.js";import"./circle-alert-CGSIlvqp.js";import"./eye-Ch6OW4eR.js";import"./check-D-48Men_.js";import"./loader-circle-Dz2exCFl.js";import"./download-BsY-FnB_.js";import"./trash-2-Bhfx4tyy.js";import"./DropdownMenuTrigger.vue_vue_type_script_setup_true_lang-BRhN9x2k.js";import"./VisuallyHidden-YCupBDVe.js";import"./DialogTitle.vue_vue_type_script_setup_true_lang-CCURHRDg.js";import"./DialogFooter.vue_vue_type_script_setup_true_lang-CQK-JmRK.js";import"./Input.vue_vue_type_script_setup_true_lang-B2bUrNCz.js";import"./Label.vue_vue_type_script_setup_true_lang-YvDBBWjH.js";import"./type-BJgX7FQ_.js";import"./minus-B5onMuBC.js";import"./plus-DuYvohtx.js";import"./list-Drcy7_qs.js";import"./CollapsibleTrigger.vue_vue_type_script_setup_true_lang-B4m8NMrt.js";import"./Separator.vue_vue_type_script_setup_true_lang-CZ0GVMao.js";import"./Separator-Dx7o6gtA.js";import"./AlertDialogTitle.vue_vue_type_script_setup_true_lang-BMYPcnK9.js";import"./index-Biby0k-U.js";import"./chevron-down-BPT4WFf6.js";import"./search-D_imah52.js";import"./index-0f1FzGZ_.js";import"./Switch.vue_vue_type_script_setup_true_lang-DpefNTv3.js";import"./VisuallyHiddenInput-Bxa_5vvz.js";import"./lightbulb-DR6-5oN3.js";import"./refresh-cw-BGOjP4Ib.js";import"./Checkbox.vue_vue_type_script_setup_true_lang-BIA06DAf.js";import"./ohash.D__AXeF1-C-E83dC9.js";import"./RovingFocusItem-UiszKYxz.js";import"./file-text-eVYdE6sA.js";const re={class:"flex h-screen flex-col overflow-hidden bg-background"},le={class:"flex flex-shrink-0 items-center justify-between border-b bg-background/95 p-3 backdrop-blur supports-[backdrop-filter]:bg-background/60"},ne={class:"flex items-center gap-4"},de={class:"flex items-center gap-2"},ue={class:"text-sm text-muted-foreground"},ce={class:"flex items-center gap-2"},pe={class:"flex-shrink-0 bg-muted/30 px-3 py-2"},me={class:"mb-1 flex items-center justify-between"},fe={class:"text-xs text-muted-foreground"},ge={class:"flex flex-1 overflow-hidden"},ve={class:"flex min-h-0 flex-1 flex-col border-r"},xe={class:"flex-shrink-0 space-y-2"},he={class:"text-lg font-semibold"},_e={key:1,class:"flex items-center justify-center h-64 text-muted-foreground"},ye={class:"flex min-h-0 flex-1 flex-col bg-muted/20"},be={class:"flex-shrink-0 space-y-2"},ke={key:0,class:"flex gap-2"},Ce={key:0,class:"flex-shrink-0 space-y-2"},we={class:"text-sm text-muted-foreground p-3 bg-muted/50 rounded-md"},Te={key:0,class:"space-y-2"},Re={class:"flex items-center justify-between text-xs text-muted-foreground"},Ve={key:1,class:"flex-shrink-0"},je={class:"flex items-center justify-between"},$e={class:"grid grid-cols-2 gap-3 text-sm"},Pe={class:"flex items-center gap-2 p-2 rounded bg-background/50"},Ie={class:"font-medium"},Se={class:"flex items-center gap-2 p-2 rounded bg-background/50"},Ne={class:"font-medium"},Ae={class:"flex items-center gap-2 p-2 rounded bg-background/50"},Fe={class:"font-medium"},Me={class:"flex items-center gap-2 p-2 rounded bg-background/50"},Ee={class:"font-medium"},Le={key:0,class:"text-xs text-muted-foreground text-center"},Be={class:"space-y-3"},Ue={key:0,class:"font-medium"},Oe={class:"flex items-center gap-2"},We={key:2,class:"h-4 w-4 rounded-full bg-gray-300"},ze={class:"text-sm bg-muted px-1 rounded"},qe={class:"text-xs text-muted-foreground"},De={key:0},Xe={key:1,class:"font-medium pt-4"},He={class:"flex items-center justify-between"},Ye={class:"flex items-center gap-2"},Je={class:"font-medium text-sm"},Ke={class:"space-y-2"},Ge={key:0,class:"text-sm"},Qe={class:"font-medium text-primary"},Ze={class:"flex items-center gap-4 text-xs text-muted-foreground"},et={key:0},tt={key:1},st={key:1,class:"text-xs text-muted-foreground"},ot={key:2,class:"flex items-center gap-4 text-xs"},at={key:0,class:"flex items-center gap-1"},it=["href"],rt={key:1,class:"flex items-center gap-1"},lt=["href"],nt={key:3,class:"space-y-2"},dt={class:"text-xs text-muted-foreground"},ut={key:0,class:"ml-2"},ct={key:0,class:"mt-2 p-2 bg-muted/30 rounded border-l-2 border-green-500"},pt={class:"text-xs text-foreground italic"},mt={key:4,class:"space-y-2"},ft={key:0,class:"text-xs text-red-600"},gt={class:"flex items-center gap-2"},vt={class:"text-xs"},xt={class:"mt-1 p-2 bg-muted/20 rounded text-xs font-mono"},ht={key:2,class:"text-center text-muted-foreground py-8"},Cs=te({__name:"CitationVerificationLayout",props:{project:{},chapter:{},chapterTitle:{},chapterContent:{},currentWordCount:{},targetWordCount:{},progressPercentage:{}},emits:["exitCitationMode"],setup(W,{emit:z}){const k=W,q=z;se();const w=C([]),x=C([]),m=C({total:0,verified:0,failed:0,unverified:0,pending:0}),v=C(!1),_=C(!1),d=C(""),y=C({percentage:0,message:"",completed:!1});let R=null,b=null;const D=o=>{b&&clearInterval(b),b=setInterval(async()=>{try{const e=await O.get(S("api.citation-verification.progress",o));if(e.data.success){const s=e.data.progress;y.value=s,d.value=s.message,(s.completed||s.percentage>=100)&&(clearInterval(b),b=null,setTimeout(()=>X(o),1e3))}}catch(e){console.error("Error fetching progress:",e)}},1e3)},X=async o=>{try{const e=await O.get(S("api.citation-verification.result",o));if(e.data.success){const s=e.data;w.value=s.citations||[],x.value=s.references||[],m.value=s.summary||m.value,d.value=s.message||"Verification completed",_.value=!0}else d.value=e.data.message||"Failed to fetch results"}catch(e){console.error("Error fetching results:",e),d.value="Failed to fetch verification results"}finally{v.value=!1,y.value={percentage:100,message:"Completed",completed:!0},R=null}},H=async()=>{if(!k.chapter?.id){console.error("No chapter ID available"),d.value="No chapter available to verify";return}v.value=!0,_.value=!1,y.value={percentage:0,message:"Initializing...",completed:!1},d.value="Starting async verification process...",console.log("=== ASYNC CITATION VERIFICATION START ==="),console.log("Chapter object:",k.chapter),console.log("Chapter ID:",k.chapter.id);try{const o=document.querySelector('meta[name="csrf-token"]')?.getAttribute("content");console.log("CSRF token found:",!!o);const e=S("api.projects.chapters.verify-citations",{project:k.project.slug,chapter:k.chapter.slug});console.log("Generated URL:",e);const s={method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json","X-CSRF-TOKEN":o||"","X-Requested-With":"XMLHttpRequest"},credentials:"same-origin",body:JSON.stringify({})};console.log("About to make async fetch request to:",e);const f=await fetch(e,s);if(console.log("Response received:",f.status,f.statusText),!f.ok)throw new Error(`HTTP error! status: ${f.status}`);const g=await f.json();console.log("Initial response:",g),g.success&&g.async?(R=g.session_id,d.value=g.message,console.log("Starting progress tracking for session:",R),D(R)):g.success?(w.value=g.citations||[],x.value=g.references||[],m.value=g.summary||m.value,d.value=g.message||"Verification completed",_.value=!0,v.value=!1):(d.value=g.message||"Verification failed",v.value=!1)}catch(o){console.error("Citation verification error:",o),o.message&&o.message.includes("419")?d.value="Session expired. Please refresh the page and try again.":o.message&&o.message.includes("401")?d.value="Unauthorized. Please log in again.":o.message&&o.message.includes("404")?d.value="Chapter not found. Please try again.":o.message&&o.message.includes("500")?d.value="Server error. Please try again.":(console.error("Error:",o.message),d.value="An unexpected error occurred. Please try again."),v.value=!1,y.value={percentage:0,message:"",completed:!1}}},Y=()=>{b&&(clearInterval(b),b=null)},J=async()=>{try{const o=x.value.filter(f=>f.status==="verified"&&f.formatted_citation);let e="";o.length>0?e=o.map(f=>f.formatted_citation).join(`

`):e=x.value.map(f=>{const g=f.authors?f.authors.join(", "):"Unknown",Q=f.year||"n.d.",Z=f.title||"Title not available";return`${g} (${Q}). ${Z}.`}).join(`

`),await navigator.clipboard.writeText(e);const s=d.value;d.value="References copied to clipboard!",setTimeout(()=>{d.value=s},2e3)}catch(o){console.error("Failed to copy references:",o),d.value="Failed to copy references to clipboard"}},K=()=>{console.log("Export references:",x.value),d.value="Export functionality coming soon!",setTimeout(()=>{d.value=_.value?`Verified ${m.value.verified} out of ${m.value.total} references using bibliography parsing`:""},2e3)},G=async o=>{console.log("Retrying reference:",o),d.value=`Retrying verification for reference ${o.id}...`,setTimeout(()=>{d.value='Individual retry functionality coming soon! Use "Verify Sources" to retry all.',setTimeout(()=>{d.value=_.value?`Verified ${m.value.verified} out of ${m.value.total} references using bibliography parsing`:""},2e3)},1e3)};return oe(()=>{Y()}),(o,e)=>(a(),n("div",re,[t("div",le,[t("div",ne,[l(i(T),{onClick:e[0]||(e[0]=s=>q("exitCitationMode")),variant:"ghost",size:"icon"},{default:c(()=>[l(i(N),{class:"h-4 w-4"})]),_:1}),t("div",de,[l(i(V),{class:"h-5 w-5 text-primary"}),t("div",null,[l(ee,{as:"h1",class:"text-lg font-bold",content:k.project.title},null,8,["content"]),t("p",ue," Citation Verification • Chapter "+r(k.chapter.chapter_number)+" • "+r(o.currentWordCount)+" / "+r(o.targetWordCount)+" words ",1)])])]),t("div",ce,[l(i(j),{variant:o.chapter.status==="approved"?"default":"secondary"},{default:c(()=>[p(r(o.chapter.status.replace("_"," ")),1)]),_:1},8,["variant"])])]),t("div",pe,[t("div",me,[e[1]||(e[1]=t("span",{class:"text-xs font-medium"},"Writing Progress",-1)),t("span",fe,r(Math.round(o.progressPercentage))+"%",1)]),l(i(I),{value:o.progressPercentage,class:"h-1"},null,8,["value"])]),t("div",ge,[t("div",ve,[l(i(P),{class:"flex min-h-0 flex-1 flex-col rounded-none border-0 bg-transparent shadow-none"},{default:c(()=>[l(i(M),{class:"flex-shrink-0 border-b px-4 py-3"},{default:c(()=>[l(i(E),{class:"text-base"},{default:c(()=>[p("Chapter "+r(o.chapter.chapter_number)+" - Content",1)]),_:1})]),_:1}),l(i($),{class:"flex min-h-0 flex-1 flex-col space-y-3 p-4"},{default:c(()=>[t("div",xe,[t("h2",he,r(o.chapterTitle||"Untitled Chapter"),1)]),l(i(L),{class:"min-h-0 flex-1"},{default:c(()=>[o.chapterContent?(a(),h(ae,{key:0,content:o.chapterContent,class:"p-4",style:{"font-family":"'Times New Roman', serif","line-height":"1.6"}},null,8,["content"])):(a(),n("div",_e,[...e[2]||(e[2]=[t("p",null,"No content available to verify",-1)])]))]),_:1})]),_:1})]),_:1})]),t("div",ye,[l(i(P),{class:"flex min-h-0 flex-1 flex-col rounded-none border-0 bg-transparent shadow-none"},{default:c(()=>[l(i(M),{class:"flex-shrink-0 border-b px-4 py-3"},{default:c(()=>[l(i(E),{class:"text-base flex items-center gap-2"},{default:c(()=>[l(i(V),{class:"h-4 w-4"}),e[3]||(e[3]=p(" Citation Verification ",-1))]),_:1})]),_:1}),l(i($),{class:"flex min-h-0 flex-1 flex-col space-y-4 p-4"},{default:c(()=>[t("div",be,[l(i(T),{onClick:H,disabled:v.value||!o.chapterContent,class:"w-full"},{default:c(()=>[v.value?(a(),h(i(ie),{key:0,class:"h-4 w-4 mr-2 animate-spin"})):(a(),h(i(V),{key:1,class:"h-4 w-4 mr-2"})),p(" "+r(v.value?"Verifying...":"Verify Sources"),1)]),_:1},8,["disabled"]),_.value&&x.value.length>0?(a(),n("div",ke,[l(i(T),{onClick:J,variant:"outline",size:"sm",class:"flex-1 text-xs"},{default:c(()=>[...e[4]||(e[4]=[p(" Copy References ",-1)])]),_:1}),l(i(T),{onClick:K,variant:"outline",size:"sm",class:"flex-1 text-xs"},{default:c(()=>[...e[5]||(e[5]=[p(" Export ",-1)])]),_:1})])):u("",!0)]),d.value||v.value?(a(),n("div",Ce,[t("div",we,r(d.value),1),v.value&&y.value.percentage>0?(a(),n("div",Te,[t("div",Re,[t("span",null,r(y.value.message),1),t("span",null,r(Math.round(y.value.percentage))+"%",1)]),l(i(I),{value:y.value.percentage,class:"h-2"},null,8,["value"])])):u("",!0)])):u("",!0),_.value?(a(),n("div",Ve,[l(i(P),{class:"bg-muted/30"},{default:c(()=>[l(i($),{class:"p-4 space-y-3"},{default:c(()=>[t("div",je,[e[6]||(e[6]=t("h4",{class:"font-medium text-sm"},"Verification Results",-1)),l(i(j),{variant:"outline",class:"text-xs"},{default:c(()=>[p(r(Math.round(m.value.verified/m.value.total*100))+"% verified ",1)]),_:1})]),l(i(I),{value:m.value.verified/m.value.total*100,class:"h-2"},null,8,["value"]),t("div",$e,[t("div",Pe,[e[7]||(e[7]=t("div",{class:"h-3 w-3 rounded-full bg-blue-500"},null,-1)),t("span",Ie,r(m.value.total),1),e[8]||(e[8]=t("span",{class:"text-muted-foreground text-xs"},"Total",-1))]),t("div",Se,[l(i(A),{class:"h-3 w-3 text-green-500"}),t("span",Ne,r(m.value.verified),1),e[9]||(e[9]=t("span",{class:"text-muted-foreground text-xs"},"Verified",-1))]),t("div",Ae,[l(i(N),{class:"h-3 w-3 text-red-500"}),t("span",Fe,r(m.value.failed||0),1),e[10]||(e[10]=t("span",{class:"text-muted-foreground text-xs"},"Failed",-1))]),t("div",Me,[l(i(F),{class:"h-3 w-3 text-orange-500"}),t("span",Ee,r(m.value.pending||0),1),e[11]||(e[11]=t("span",{class:"text-muted-foreground text-xs"},"Pending",-1))])]),m.value.processing_time_ms||d.value.includes("processing_time_ms")?(a(),n("div",Le,[...e[12]||(e[12]=[t("span",null,"Processing completed",-1)])])):u("",!0)]),_:1})]),_:1})])):u("",!0),_.value?(a(),h(i(L),{key:2,class:"min-h-0 flex-1"},{default:c(()=>[t("div",Be,[w.value.length>0?(a(),n("h3",Ue,"In-text Citations")):u("",!0),(a(!0),n(B,null,U(w.value,s=>(a(),n("div",{key:s.id,class:"border rounded-md p-3 space-y-2"},[t("div",Oe,[s.status==="verified"?(a(),h(i(A),{key:0,class:"h-4 w-4 text-green-500"})):s.status==="unverified"?(a(),h(i(F),{key:1,class:"h-4 w-4 text-orange-500"})):(a(),n("div",We)),t("code",ze,r(s.text),1)]),t("div",qe,[t("p",null,[e[13]||(e[13]=t("strong",null,"Author:",-1)),p(" "+r(s.author),1)]),t("p",null,[e[14]||(e[14]=t("strong",null,"Year:",-1)),p(" "+r(s.year),1)]),s.details?(a(),n("p",De,[e[15]||(e[15]=t("strong",null,"Status:",-1)),p(" "+r(s.details),1)])):u("",!0)])]))),128)),x.value.length>0?(a(),n("h3",Xe,"Reference List")):u("",!0),(a(!0),n(B,null,U(x.value,s=>(a(),n("div",{key:s.id,class:"border rounded-md p-4 space-y-3"},[t("div",He,[t("div",Ye,[s.status==="verified"?(a(),h(i(A),{key:0,class:"h-5 w-5 text-green-500"})):s.status==="failed"?(a(),h(i(N),{key:1,class:"h-5 w-5 text-red-500"})):(a(),h(i(F),{key:2,class:"h-5 w-5 text-orange-500"})),t("span",Je,"Reference "+r(s.id),1)]),l(i(j),{variant:s.status==="verified"?"default":s.status==="failed"?"destructive":"secondary",class:"text-xs"},{default:c(()=>[p(r(s.status||"unverified"),1)]),_:2},1032,["variant"])]),t("div",Ke,[s.title?(a(),n("div",Ge,[t("span",Qe,r(s.title),1)])):u("",!0),t("div",Ze,[s.authors&&s.authors.length>0?(a(),n("div",et,[e[16]||(e[16]=t("strong",null,"Authors:",-1)),p(" "+r(s.authors.join(", ")),1)])):u("",!0),s.year?(a(),n("div",tt,[e[17]||(e[17]=t("strong",null,"Year:",-1)),p(" "+r(s.year),1)])):u("",!0)]),s.journal||s.publisher?(a(),n("div",st,[e[18]||(e[18]=t("strong",null,"Published in:",-1)),p(" "+r(s.journal||s.publisher),1)])):u("",!0),s.doi||s.url?(a(),n("div",ot,[s.doi?(a(),n("div",at,[e[19]||(e[19]=t("strong",null,"DOI:",-1)),t("a",{href:"https://doi.org/"+s.doi,target:"_blank",class:"text-blue-600 hover:underline"},r(s.doi),9,it)])):u("",!0),s.url&&!s.doi?(a(),n("div",rt,[e[20]||(e[20]=t("strong",null,"URL:",-1)),t("a",{href:s.url,target:"_blank",class:"text-blue-600 hover:underline break-all"},r(s.url.length>40?s.url.substring(0,40)+"...":s.url),9,lt)])):u("",!0)])):u("",!0),s.status==="verified"?(a(),n("div",nt,[t("div",dt,[e[23]||(e[23]=t("strong",null,"Verification Method:",-1)),p(" "+r(s.verification_method||"api")+" ",1),s.confidence?(a(),n("span",ut,[e[21]||(e[21]=p(" | ",-1)),e[22]||(e[22]=t("strong",null,"Confidence:",-1)),p(" "+r(Math.round(s.confidence*100))+"% ",1)])):u("",!0)]),s.formatted_citation?(a(),n("div",ct,[e[24]||(e[24]=t("div",{class:"text-xs font-medium text-muted-foreground mb-1"},"Formatted Citation (APA):",-1)),t("div",pt,r(s.formatted_citation),1)])):u("",!0)])):u("",!0),s.status==="failed"?(a(),n("div",mt,[s.failure_reason?(a(),n("div",ft,[e[25]||(e[25]=t("strong",null,"Issue:",-1)),p(" "+r(s.failure_reason),1)])):u("",!0),t("div",gt,[l(i(T),{onClick:f=>G(s),variant:"outline",size:"sm",class:"text-xs h-6 px-2",disabled:v.value},{default:c(()=>[...e[26]||(e[26]=[p(" Retry ",-1)])]),_:2},1032,["onClick","disabled"]),e[27]||(e[27]=t("span",{class:"text-xs text-muted-foreground"}," Try searching with different criteria ",-1))])])):u("",!0),t("details",vt,[e[28]||(e[28]=t("summary",{class:"cursor-pointer text-muted-foreground hover:text-foreground"}," Show raw reference text ",-1)),t("div",xt,r(s.raw_text),1)])])]))),128)),w.value.length===0&&x.value.length===0?(a(),n("div",ht,[l(i(V),{class:"h-12 w-12 mx-auto mb-2 opacity-50"}),e[29]||(e[29]=t("p",null,"No citations found in this chapter",-1)),e[30]||(e[30]=t("p",{class:"text-xs"},"Citations will appear here when detected",-1))])):u("",!0)])]),_:1})):u("",!0)]),_:1})]),_:1})])])]))}});export{Cs as default};
