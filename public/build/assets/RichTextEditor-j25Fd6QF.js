import{bu as We,bt as v,ck as B,bB as Fe,cR as Ot,cn as ie,co as T,cp as i,cr as u,cB as I,cG as P,cu as x,ct as D,bF as t,f9 as Wt,fa as Nt,fb as qt,c$ as ke,ci as ne,bC as at,cq as a,cw as Ke,dT as rt,cx as jt,eE as st,fc as Gt,cS as Oe,cM as ot,fd as nt,fe as lt,cs as b,cO as it,dN as Xt,cb as dt,aP as ut,aQ as ct,bO as Yt,bN as Kt,ff as Qt,bE as Be,fg as Jt,fh as Zt,fi as ea,fj as ta,dE as aa,fk as ra,fl as sa,fm as oa,fn as na,fo as la,em as ia,fp as da,cN as ua,fq as ca,dG as ga,fr as fa,fs as ma,ft as pa,fu as va,de as ha,fv as ba,fw as xa}from"./vendor-BJBNFzu6.js";import{N as gt,a as ft,V as mt,m as pt,E as vt,i as ya,b as wa,c as ka,d as Ca,T as Ta,C as za,H as Aa,L as Ma,e as Sa,f as $a,g as La,h as _a,j as Ea,u as Ra,k as Ha}from"./vendor-tiptap-DuG0yIO_.js";import{_ as Qe}from"./Progress.vue_vue_type_script_setup_true_lang-BJ0VwWi9.js";import{_ as Ne}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{M as Ia}from"./MermaidExtension-C8Xh9spG.js";import{_ as p}from"./index-DKTzjY4t.js";import{_ as le}from"./Input.vue_vue_type_script_setup_true_lang-CB-7LUUJ.js";import{_ as Le,a as _e}from"./DialogContent.vue_vue_type_script_setup_true_lang-C8SicQru.js";import{_ as Ee}from"./DialogDescription.vue_vue_type_script_setup_true_lang-B95wIsmA.js";import{_ as Re}from"./DialogFooter.vue_vue_type_script_setup_true_lang-DsnnuiaB.js";import{_ as He,a as Ie}from"./DialogTitle.vue_vue_type_script_setup_true_lang-vwptL7Il.js";import{_ as fe}from"./Label.vue_vue_type_script_setup_true_lang-YwrTvequ.js";import{_ as Je,a as Ze,c as q,d as $e,e as et}from"./Sonner.vue_vue_type_script_setup_true_lang-C7Uf4kO1.js";const Va={class:"space-y-2"},Da={class:"font-semibold text-sm"},Pa={key:0,class:"text-xs text-gray-600 dark:text-gray-300"},Ua={class:"flex items-center space-x-2 text-xs"},Ba={key:0,class:"text-gray-500"},Fa={key:1,class:"text-xs text-blue-600 dark:text-blue-400"},Oa={class:"flex space-x-2 pt-2 border-t"},Wa=We({__name:"CitationNodeView",props:{node:{type:Object,required:!0},editor:{type:Object,required:!0},getPos:{type:Function,required:!0},updateAttributes:{type:Function,required:!0}},emits:["verify","edit","remove"],setup(l,{emit:n}){const g=l,k=n,f=v(!1),z=v({top:"0px",left:"0px"}),U=B(()=>g.node.attrs.text||"[Citation]"),C=B(()=>g.node.attrs.verified===!1&&g.node.attrs.confidence<.8),M=B(()=>({"citation-verified":g.node.attrs.verified,"citation-unverified":C.value,"citation-pending":!g.node.attrs.verified&&!C.value})),S=B(()=>g.node.attrs.verified?"bg-green-100 dark:bg-green-900 text-green-800 dark:text-green-200 border border-green-300 dark:border-green-700":C.value?"bg-red-100 dark:bg-red-900 text-red-800 dark:text-red-200 border border-red-300 dark:border-red-700":"bg-yellow-100 dark:bg-yellow-900 text-yellow-800 dark:text-yellow-200 border border-yellow-300 dark:border-yellow-700"),F=B(()=>g.node.attrs.verified?"text-green-600 dark:text-green-400":C.value?"text-red-600 dark:text-red-400":"text-yellow-600 dark:text-yellow-400"),O=B(()=>g.node.attrs.verified?"Verified":C.value?"Needs Review":"Pending"),X=B(()=>g.node.attrs.verified?"bg-green-100 dark:bg-green-900 text-green-800 dark:text-green-200":C.value?"bg-red-100 dark:bg-red-900 text-red-800 dark:text-red-200":"bg-yellow-100 dark:bg-yellow-900 text-yellow-800 dark:text-yellow-200"),W=w=>{if(w.stopPropagation(),f.value)L();else{const de=w.target.getBoundingClientRect();z.value={top:`${de.height+5}px`,left:"0px"},f.value=!0}},L=()=>{f.value=!1},ee=async()=>{try{const w=await axios.post("/api/citations/verify",{citation_id:g.node.attrs.id,citation_text:g.node.attrs.text});w.data.verified&&g.updateAttributes({verified:!0,confidence:w.data.confidence,data:w.data.citation,doi:w.data.citation.doi}),k("verify",w.data),L()}catch(w){console.error("Failed to verify citation:",w)}},Y=()=>{k("edit",{id:g.node.attrs.id,text:g.node.attrs.text,attributes:g.node.attrs}),L()},r=()=>{if(confirm("Are you sure you want to remove this citation?")){const w=g.getPos();g.editor.commands.deleteRange({from:w,to:w+1}),k("remove",g.node.attrs.id)}L()},te=w=>{w.key==="Enter"||w.key===" "?(w.preventDefault(),W(w)):w.key==="Escape"&&L()};return Fe(()=>{document.addEventListener("keydown",te)}),Ot(()=>{document.removeEventListener("keydown",te)}),(w,de)=>(T(),ie(t(gt),{class:x(["citation-node inline-block relative cursor-pointer",M.value]),onClick:W},{default:i(()=>[u("span",{class:x(["citation-text px-2 py-1 rounded text-sm font-medium transition-all duration-200",S.value])},D(U.value),3),u("span",{class:x(["verification-indicator ml-1",F.value])},[l.node.attrs.verified?(T(),ie(t(Wt),{key:0,class:"w-3 h-3"})):C.value?(T(),ie(t(Nt),{key:1,class:"w-3 h-3"})):(T(),ie(t(qt),{key:2,class:"w-3 h-3"}))],2),f.value?(T(),I("div",{key:0,class:"citation-popover absolute z-50 mt-2 p-4 bg-white dark:bg-gray-800 rounded-lg shadow-lg border max-w-sm",style:ke(z.value)},[u("div",Va,[u("div",Da,D(l.node.attrs.text||"[Citation]"),1),l.node.attrs.data&&l.node.attrs.data.title?(T(),I("div",Pa,D(l.node.attrs.data.title),1)):P("",!0),u("div",Ua,[u("span",{class:x(["px-2 py-1 rounded",X.value])},D(O.value),3),l.node.attrs.confidence?(T(),I("span",Ba,D(Math.round(l.node.attrs.confidence*100))+"% confidence ",1)):P("",!0)]),l.node.attrs.doi?(T(),I("div",Fa," DOI: "+D(l.node.attrs.doi),1)):P("",!0),u("div",Oa,[l.node.attrs.verified?P("",!0):(T(),I("button",{key:0,onClick:ee,class:"text-xs px-2 py-1 bg-blue-600 text-white rounded hover:bg-blue-700"}," Verify ")),u("button",{onClick:Y,class:"text-xs px-2 py-1 bg-gray-600 text-white rounded hover:bg-gray-700"}," Edit "),u("button",{onClick:r,class:"text-xs px-2 py-1 bg-red-600 text-white rounded hover:bg-red-700"}," Remove ")])])],4)):P("",!0),f.value?(T(),I("div",{key:1,class:"fixed inset-0 z-40",onClick:L})):P("",!0)]),_:1},8,["class"]))}}),Na=Ne(Wa,[["__scopeId","data-v-4fc4981e"]]),qa=ft.create({name:"citation",group:"inline",inline:!0,atom:!0,addAttributes(){return{id:{default:null},text:{default:""},verified:{default:!1},confidence:{default:0},format:{default:"apa"},doi:{default:null},data:{default:{}}}},parseHTML(){return[{tag:"span[data-citation]"}]},renderHTML({HTMLAttributes:l}){return["span",pt(l,{"data-citation":""})]},addNodeView(){return mt(Na)},addCommands(){return{insertCitation:l=>({commands:n})=>n.insertContent({type:this.name,attrs:l}),updateCitation:(l,n)=>({state:g,dispatch:k})=>{const{doc:f,tr:z}=g;let U=!1;return f.descendants((C,M)=>{if(C.type.name===this.name&&C.attrs.id===l)return z.setNodeMarkup(M,null,{...C.attrs,...n}),U=!0,!1}),U?(k(z),!0):!1}}},addKeyboardShortcuts(){return{"Mod-Shift-c":()=>this.editor.commands.insertCitation({text:"[Citation]",verified:!1})}}}),ja={class:"text-muted-foreground text-xs mt-1 truncate max-w-full"},Ga=["src","alt","title"],Xa={key:2,class:"mt-2 w-full"},Ya={key:3,class:"mt-2 text-center text-sm text-muted-foreground italic"},Ka={key:5,class:"absolute -top-12 left-1/2 -translate-x-1/2 flex items-center gap-1.5 px-3 py-1.5 bg-background/95 backdrop-blur-md rounded-lg border border-border shadow-lg z-10 min-w-max"},Qa={class:"text-xs text-muted-foreground whitespace-nowrap"},Ja={class:"grid gap-4 py-4"},Za={class:"grid gap-2"},er={class:"grid gap-2"},tr=We({__name:"ImageNodeView",props:{node:{},updateAttributes:{type:Function},deleteNode:{type:Function},selected:{type:Boolean},editor:{}},setup(l){const n=l,g=v(null),k=v(null),f=v(!1),z=v(null),U=v(0),C=v(0),M=v(0),S=v(0),F=v(n.node.attrs.width||400),O=v(n.node.attrs.height||300),X=v(!0),W=v(!1),L=v(!1),ee=v(""),Y=v(""),r=v(n.node.attrs.caption||""),te=B(()=>{switch(n.node.attrs.alignment){case"left":return"mr-auto";case"right":return"ml-auto";default:return"mx-auto"}}),w=B(()=>({width:`${F.value}px`,height:`${O.value}px`,maxWidth:"100%"})),de=()=>{if(X.value=!1,W.value=!1,g.value&&!n.node.attrs.width){const m=g.value.naturalWidth,o=g.value.naturalHeight,c=600;if(m>c){const N=c/m;F.value=c,O.value=Math.round(o*N)}else F.value=m,O.value=o;n.updateAttributes({width:F.value,height:O.value,aspectRatio:m/o})}},me=()=>{X.value=!1,W.value=!0},$=(m,o)=>{if(!n.selected)return;o.preventDefault(),o.stopPropagation(),f.value=!0,z.value=m;const c="touches"in o?o.touches[0].clientX:o.clientX,N="touches"in o?o.touches[0].clientY:o.clientY;U.value=c,C.value=N,M.value=F.value,S.value=O.value,document.addEventListener("mousemove",K),document.addEventListener("mouseup",Q),document.addEventListener("touchmove",K),document.addEventListener("touchend",Q)},K=m=>{if(!f.value)return;const o="touches"in m?m.touches[0].clientX:m.clientX,c="touches"in m?m.touches[0].clientY:m.clientY,N=o-U.value,ve=c-C.value,he=n.node.attrs.aspectRatio||M.value/S.value,re=z.value;let G=M.value,J=S.value;re?.includes("e")&&(G=Math.max(100,M.value+N)),re?.includes("w")&&(G=Math.max(100,M.value-N)),re?.includes("s")&&(J=Math.max(100,S.value+ve)),re?.includes("n")&&(J=Math.max(100,S.value-ve)),re?.length===2&&(Math.abs(N)>Math.abs(ve)?J=Math.round(G/he):G=Math.round(J*he));const Te=800;G>Te&&(G=Te,J=Math.round(G/he)),F.value=G,O.value=J},Q=()=>{f.value&&(f.value=!1,z.value=null,n.updateAttributes({width:F.value,height:O.value}),document.removeEventListener("mousemove",K),document.removeEventListener("mouseup",Q),document.removeEventListener("touchmove",K),document.removeEventListener("touchend",Q))},pe=m=>{n.updateAttributes({alignment:m})},Ve=()=>{ee.value=n.node.attrs.alt||"",Y.value=n.node.attrs.title||"",L.value=!0},De=()=>{n.updateAttributes({alt:ee.value,title:Y.value}),L.value=!1},Ce=()=>{n.updateAttributes({caption:r.value})},ae=async()=>{const m=n.node.attrs.src;if(m&&m.startsWith("/storage/"))try{await dt.delete("/editor/images",{data:{url:m}})}catch(o){console.warn("Failed to delete image from storage:",o)}n.deleteNode()};return ne(()=>n.node.attrs.caption,m=>{m!==r.value&&(r.value=m||"")}),ne(()=>[n.node.attrs.width,n.node.attrs.height],([m,o])=>{m&&!f.value&&(F.value=m),o&&!f.value&&(O.value=o)},{immediate:!0}),at(()=>{document.removeEventListener("mousemove",K),document.removeEventListener("mouseup",Q),document.removeEventListener("touchmove",K),document.removeEventListener("touchend",Q)}),(m,o)=>(T(),ie(t(gt),{class:"resizable-image-wrapper my-4"},{default:i(()=>[u("figure",{ref_key:"containerRef",ref:k,class:x(["relative inline-block",[te.value,{"ring-2 ring-primary ring-offset-2":m.selected}]])},[X.value?(T(),I("div",{key:0,class:"flex items-center justify-center bg-muted/50 rounded-lg",style:ke(w.value)},[a(t(rt),{class:"w-8 h-8 animate-spin text-muted-foreground"})],4)):W.value?(T(),I("div",{key:1,class:"flex flex-col items-center justify-center bg-destructive/10 border border-destructive/30 rounded-lg p-4",style:ke(w.value)},[o[24]||(o[24]=u("span",{class:"text-destructive text-sm"},"Failed to load image",-1)),u("span",ja,D(m.node.attrs.src),1)],4)):P("",!0),Ke(u("img",{ref_key:"imageRef",ref:g,src:m.node.attrs.src,alt:m.node.attrs.alt,title:m.node.attrs.title,style:ke(w.value),class:x(["block rounded-lg object-contain",{"cursor-move":m.selected}]),onLoad:de,onError:me,draggable:"false"},null,46,Ga),[[jt,!X.value&&!W.value]]),m.selected&&!W.value?(T(),I("div",Xa,[Ke(u("input",{"onUpdate:modelValue":o[0]||(o[0]=c=>r.value=c),type:"text",placeholder:"Add a caption...",class:"w-full text-center text-sm text-muted-foreground bg-transparent border-none focus:outline-none focus:ring-0 placeholder:text-muted-foreground/50",onBlur:Ce,onKeydown:st(Ce,["enter"])},null,544),[[Gt,r.value]])])):m.node.attrs.caption&&!W.value?(T(),I("figcaption",Ya,D(m.node.attrs.caption),1)):P("",!0),m.selected&&!W.value&&!X.value?(T(),I(Oe,{key:4},[u("div",{class:"absolute -top-1.5 -left-1.5 w-3 h-3 bg-primary border-2 border-background rounded-full cursor-nw-resize z-20 hover:scale-125 transition-transform",onMousedown:o[1]||(o[1]=c=>$("nw",c)),onTouchstart:o[2]||(o[2]=c=>$("nw",c))},null,32),u("div",{class:"absolute -top-1.5 -right-1.5 w-3 h-3 bg-primary border-2 border-background rounded-full cursor-ne-resize z-20 hover:scale-125 transition-transform",onMousedown:o[3]||(o[3]=c=>$("ne",c)),onTouchstart:o[4]||(o[4]=c=>$("ne",c))},null,32),u("div",{class:"absolute -bottom-1.5 -left-1.5 w-3 h-3 bg-primary border-2 border-background rounded-full cursor-sw-resize z-20 hover:scale-125 transition-transform",onMousedown:o[5]||(o[5]=c=>$("sw",c)),onTouchstart:o[6]||(o[6]=c=>$("sw",c))},null,32),u("div",{class:"absolute -bottom-1.5 -right-1.5 w-3 h-3 bg-primary border-2 border-background rounded-full cursor-se-resize z-20 hover:scale-125 transition-transform",onMousedown:o[7]||(o[7]=c=>$("se",c)),onTouchstart:o[8]||(o[8]=c=>$("se",c))},null,32),u("div",{class:"absolute top-1/2 -left-1.5 w-3 h-3 bg-primary border-2 border-background rounded-full cursor-w-resize z-20 -translate-y-1/2 hover:scale-125 transition-transform",onMousedown:o[9]||(o[9]=c=>$("w",c)),onTouchstart:o[10]||(o[10]=c=>$("w",c))},null,32),u("div",{class:"absolute top-1/2 -right-1.5 w-3 h-3 bg-primary border-2 border-background rounded-full cursor-e-resize z-20 -translate-y-1/2 hover:scale-125 transition-transform",onMousedown:o[11]||(o[11]=c=>$("e",c)),onTouchstart:o[12]||(o[12]=c=>$("e",c))},null,32),u("div",{class:"absolute -top-1.5 left-1/2 w-3 h-3 bg-primary border-2 border-background rounded-full cursor-n-resize z-20 -translate-x-1/2 hover:scale-125 transition-transform",onMousedown:o[13]||(o[13]=c=>$("n",c)),onTouchstart:o[14]||(o[14]=c=>$("n",c))},null,32),u("div",{class:"absolute -bottom-1.5 left-1/2 w-3 h-3 bg-primary border-2 border-background rounded-full cursor-s-resize z-20 -translate-x-1/2 hover:scale-125 transition-transform",onMousedown:o[15]||(o[15]=c=>$("s",c)),onTouchstart:o[16]||(o[16]=c=>$("s",c))},null,32)],64)):P("",!0),m.selected?(T(),I("div",Ka,[W.value?P("",!0):(T(),I(Oe,{key:0},[a(t(p),{variant:"ghost",size:"sm",class:x(["h-7 w-7 p-0",{"bg-primary/10 text-primary":m.node.attrs.alignment==="left"}]),onClick:o[17]||(o[17]=c=>pe("left"))},{default:i(()=>[a(t(ot),{class:"w-4 h-4"})]),_:1},8,["class"]),a(t(p),{variant:"ghost",size:"sm",class:x(["h-7 w-7 p-0",{"bg-primary/10 text-primary":m.node.attrs.alignment==="center"}]),onClick:o[18]||(o[18]=c=>pe("center"))},{default:i(()=>[a(t(nt),{class:"w-4 h-4"})]),_:1},8,["class"]),a(t(p),{variant:"ghost",size:"sm",class:x(["h-7 w-7 p-0",{"bg-primary/10 text-primary":m.node.attrs.alignment==="right"}]),onClick:o[19]||(o[19]=c=>pe("right"))},{default:i(()=>[a(t(lt),{class:"w-4 h-4"})]),_:1},8,["class"]),o[26]||(o[26]=u("div",{class:"w-px h-5 bg-border mx-1"},null,-1)),a(t(p),{variant:"ghost",size:"sm",class:"h-7 px-2 text-xs gap-1",onClick:Ve},{default:i(()=>[a(t(it),{class:"w-3 h-3"}),o[25]||(o[25]=b(" Alt ",-1))]),_:1}),o[27]||(o[27]=u("div",{class:"w-px h-5 bg-border mx-1"},null,-1)),u("span",Qa,D(Math.round(F.value))+" x "+D(Math.round(O.value)),1),o[28]||(o[28]=u("div",{class:"w-px h-5 bg-border mx-1"},null,-1))],64)),a(t(p),{variant:"ghost",size:"sm",class:"h-7 w-7 p-0 text-destructive hover:text-destructive",onClick:ae},{default:i(()=>[a(t(Xt),{class:"w-4 h-4"})]),_:1})])):P("",!0)],2),a(t(Le),{open:L.value,"onUpdate:open":o[23]||(o[23]=c=>L.value=c)},{default:i(()=>[a(t(_e),null,{default:i(()=>[a(t(He),null,{default:i(()=>[a(t(Ie),null,{default:i(()=>[...o[29]||(o[29]=[b("Image Properties",-1)])]),_:1}),a(t(Ee),null,{default:i(()=>[...o[30]||(o[30]=[b("Edit the alt text and title for this image.",-1)])]),_:1})]),_:1}),u("div",Ja,[u("div",Za,[a(t(fe),{for:"alt-text"},{default:i(()=>[...o[31]||(o[31]=[b("Alt Text",-1)])]),_:1}),a(t(le),{id:"alt-text",modelValue:ee.value,"onUpdate:modelValue":o[20]||(o[20]=c=>ee.value=c),placeholder:"Describe this image for accessibility..."},null,8,["modelValue"]),o[32]||(o[32]=u("p",{class:"text-xs text-muted-foreground"}," Alt text helps screen readers describe the image to visually impaired users. ",-1))]),u("div",er,[a(t(fe),{for:"title-text"},{default:i(()=>[...o[33]||(o[33]=[b("Title",-1)])]),_:1}),a(t(le),{id:"title-text",modelValue:Y.value,"onUpdate:modelValue":o[21]||(o[21]=c=>Y.value=c),placeholder:"Optional title shown on hover..."},null,8,["modelValue"])])]),a(t(Re),null,{default:i(()=>[a(t(p),{variant:"outline",onClick:o[22]||(o[22]=c=>L.value=!1)},{default:i(()=>[...o[34]||(o[34]=[b("Cancel",-1)])]),_:1}),a(t(p),{onClick:De},{default:i(()=>[...o[35]||(o[35]=[b("Save",-1)])]),_:1})]),_:1})]),_:1})]),_:1},8,["open"])]),_:1}))}}),ar=Ne(tr,[["__scopeId","data-v-bc29ad5b"]]),rr=ft.create({name:"resizableImage",group:"block",atom:!0,draggable:!0,addOptions(){return{HTMLAttributes:{class:"resizable-image-block"},maxWidth:800}},addAttributes(){return{src:{default:null,parseHTML:l=>l.querySelector("img")?.getAttribute("src")||l.getAttribute("src")},alt:{default:"",parseHTML:l=>l.querySelector("img")?.getAttribute("alt")||l.getAttribute("alt")||""},title:{default:"",parseHTML:l=>l.querySelector("img")?.getAttribute("title")||l.getAttribute("title")||""},width:{default:null,parseHTML:l=>{const g=l.querySelector("img")?.getAttribute("width")||l.getAttribute("data-width");return g?parseInt(g,10):null}},height:{default:null,parseHTML:l=>{const g=l.querySelector("img")?.getAttribute("height")||l.getAttribute("data-height");return g?parseInt(g,10):null}},alignment:{default:"center",parseHTML:l=>l.getAttribute("data-alignment")||"center"},aspectRatio:{default:null,parseHTML:l=>{const n=l.getAttribute("data-aspect-ratio");return n?parseFloat(n):null}},caption:{default:"",parseHTML:l=>l.querySelector("figcaption")?.textContent||l.getAttribute("data-caption")||""}}},parseHTML(){return[{tag:"figure[data-resizable-image]"},{tag:"div[data-resizable-image]"},{tag:"img[src]",getAttrs:l=>{if(typeof l=="string")return!1;const n=l;return{src:n.getAttribute("src"),alt:n.getAttribute("alt"),title:n.getAttribute("title"),width:n.getAttribute("width")?parseInt(n.getAttribute("width"),10):null,height:n.getAttribute("height")?parseInt(n.getAttribute("height"),10):null}}}]},renderHTML({HTMLAttributes:l,node:n}){const g=pt(this.options.HTMLAttributes,{"data-resizable-image":"","data-alignment":n.attrs.alignment,"data-width":n.attrs.width,"data-height":n.attrs.height,"data-aspect-ratio":n.attrs.aspectRatio,"data-caption":n.attrs.caption||""}),k={src:l.src||n.attrs.src,alt:n.attrs.alt||"",title:n.attrs.title||""};n.attrs.width&&(k.width=n.attrs.width),n.attrs.height&&(k.height=n.attrs.height);const f=[["img",k]];return n.attrs.caption&&f.push(["figcaption",{},n.attrs.caption]),["figure",g,...f]},addNodeView(){return mt(ar)},addCommands(){return{setImage:l=>({commands:n})=>n.insertContent({type:this.name,attrs:{src:l.src,alt:l.alt||"",title:l.title||"",width:l.width||null,height:l.height||null,caption:l.caption||"",aspectRatio:l.width&&l.height?l.width/l.height:null}}),updateImageSize:l=>({commands:n})=>n.updateAttributes(this.name,{width:l.width,height:l.height}),setImageAlignment:l=>({commands:n})=>n.updateAttributes(this.name,{alignment:l})}},addProseMirrorPlugins(){return[new ut({key:new ct("resizableImageDropPaste"),props:{handleDrop:(l,n,g,k)=>{if(k||!n.dataTransfer?.files?.length)return!1;const f=n.dataTransfer.files[0];return f.type.startsWith("image/")?(n.preventDefault(),document.dispatchEvent(new CustomEvent("tiptap-image-drop",{detail:{file:f,view:l,pos:l.posAtCoords({left:n.clientX,top:n.clientY})}})),!0):!1},handlePaste:(l,n)=>{const g=n.clipboardData?.items;if(!g)return!1;for(const k of g)if(k.type.startsWith("image/")){n.preventDefault();const f=k.getAsFile();return f&&document.dispatchEvent(new CustomEvent("tiptap-image-paste",{detail:{file:f,view:l}})),!0}return!1}}})]}}),Z=new ct("ghostText"),sr=vt.create({name:"ghostText",addOptions(){return{onManualTrigger:null,onAccepted:null,onDismissed:null}},addCommands(){return{setGhostText:({text:l,position:n,format:g})=>({tr:k,state:f,dispatch:z})=>{const U=typeof n=="number"?n:f.selection.to;return k.setMeta(Z,{type:"set",text:l,format:g??"text",position:U}),z?.(k),!0},clearGhostText:()=>({tr:l,dispatch:n})=>(l.setMeta(Z,{type:"clear"}),n?.(l),!0)}},addKeyboardShortcuts(){return{Tab:()=>{const l=Z.getState(this.editor.state);if(!l?.isVisible||!l.text||!this.editor.state.selection.empty)return!1;const n=l.position,g=l.text;return this.editor.chain().focus().insertContentAt({from:n,to:n},g).command(({tr:k,dispatch:f})=>(k.setMeta(Z,{type:"clear"}),f?.(k),!0)).run(),this.options.onAccepted?.(g),!0},Escape:()=>Z.getState(this.editor.state)?.isVisible?(this.editor.commands.clearGhostText(),this.options.onDismissed?.(),!0):!1,"Mod-Space":()=>(this.options.onManualTrigger?.(),!0)}},addProseMirrorPlugins(){return[new ut({key:Z,state:{init:()=>({text:null,format:"text",position:0,isVisible:!1}),apply:(l,n)=>{const g=l.getMeta(Z);return g?.type==="clear"?{text:null,format:"text",position:0,isVisible:!1}:g?.type==="set"?{text:g.text,format:g.format,position:g.position,isVisible:!0}:l.docChanged?(n.isVisible&&this.options.onDismissed?.(),{text:null,format:"text",position:0,isVisible:!1}):l.selectionSet&&n.isVisible?(this.options.onDismissed?.(),{text:null,format:"text",position:0,isVisible:!1}):n}},props:{decorations:l=>{const n=Z.getState(l);if(!n?.isVisible||!n.text)return null;const g=Math.min(Math.max(0,n.position),l.doc.content.size),k=Yt.widget(g,()=>{const f=document.createElement("span");if(f.className="tiptap-ghost-text",n.format==="html"&&n.text.includes("<")){const z=document.createElement("div");z.innerHTML=n.text,f.textContent=(z.textContent||"").trim()}else f.textContent=n.text??"";return f},{side:1});return Kt.create(l.doc,[k])}}})]}}),or={class:"relative flex flex-col w-full h-full group bg-background"},nr={class:"flex items-center gap-0.5 border-r border-border/40 pr-1.5 mr-1.5 flex-shrink-0"},lr={class:"flex items-center gap-0.5 border-r border-border/40 pr-1.5 mr-1.5 flex-shrink-0"},ir={class:"text-xs text-zinc-700 dark:text-zinc-100"},dr={class:"flex items-center gap-0.5"},ur={class:"flex h-8 w-9 items-center justify-center border-y border-border/20 bg-muted/20 text-xs font-medium text-foreground"},cr={class:"flex items-center gap-0.5 border-r border-border/40 pr-1.5 mr-1.5 flex-shrink-0"},gr={class:"flex items-center gap-0.5 border-r border-border/40 pr-1.5 mr-1.5 flex-shrink-0"},fr={class:"flex items-center gap-0.5 border-l border-border/20 ml-0.5 pl-0.5"},mr={class:"flex items-center gap-0.5 flex-shrink-0"},pr={class:"relative flex-1 min-h-0"},vr={key:0,class:"absolute inset-0 z-10 flex flex-col items-center justify-center bg-background/50 backdrop-blur-[2px] transition-all duration-500"},hr={class:"flex flex-col items-center gap-4 rounded-2xl border border-border/50 bg-background/90 p-8 shadow-xl backdrop-blur-xl"},br={class:"relative h-16 w-16"},xr={class:"relative flex h-full w-full items-center justify-center rounded-full bg-primary/10 ring-1 ring-primary/20"},yr={class:"text-center"},wr={class:"text-lg font-semibold tracking-tight"},kr={class:"text-sm text-muted-foreground"},Cr={class:"grid gap-4 py-4"},Tr={class:"grid gap-2"},zr={class:"grid gap-2"},Ar={class:"grid gap-4 py-4"},Mr={class:"flex items-center gap-4"},Sr={class:"flex flex-wrap gap-2"},$r=["onClick"],Lr={class:"grid gap-4 py-4"},_r={class:"grid gap-2"},Er={class:"flex items-center gap-2"},Rr={key:1,class:"text-sm text-destructive"},Hr={class:"grid gap-2"},Ir={class:"flex gap-2"},tt=300,Vr=We({__name:"RichTextEditor",props:{modelValue:{},placeholder:{default:"Start writing..."},readonly:{type:Boolean,default:!1},minHeight:{default:"200px"},showToolbar:{type:Boolean,default:!0},toolbarTeleportTarget:{default:""},isGenerating:{type:Boolean,default:!1},generationProgress:{default:""},generationPercentage:{default:0},generationPhase:{default:""},streamingMode:{type:Boolean,default:!1},ghostText:{default:null},ghostTextFormat:{default:"text"},ghostTextPosition:{default:null}},emits:["update:modelValue","update:selectedText","update:selectionRange","ghost-manual-trigger","ghost-accepted","ghost-dismissed"],setup(l,{expose:n,emit:g}){const k=Qt(xa),f=l,z=v(!1),U=v(0),C=v(""),M=v(null),S=g,F=vt.create({name:"fontSize",addOptions(){return{types:["textStyle"]}},addGlobalAttributes(){return[{types:this.options.types,attributes:{fontSize:{default:null,parseHTML:s=>{const e=s.style.fontSize;return e||null},renderHTML:s=>s.fontSize?{style:`font-size: ${s.fontSize}`}:{}}}}]},addCommands(){return{setFontSize:s=>({chain:e})=>e().setMark("textStyle",{fontSize:s}).run(),unsetFontSize:()=>({chain:s})=>s().setMark("textStyle",{fontSize:null}).removeEmptyTextStyle().run()}}}),O=s=>{if(!s)return"";const e=s.split(`
`);let d=[],y=0;for(;y<e.length;){const _=e[y];if(_.includes("|")){const E=X(e,y);if(E.html){d.push(E.html),y=E.nextIndex;continue}}d.push(_),y++}return d.join(`
`)},X=(s,e)=>{let d=s[e];if(!d||!d.includes("|"))return{html:null,nextIndex:e+1};const y=d.split("|").map(R=>R.trim()).filter(R=>R.length>0);if(y.length===0)return{html:null,nextIndex:e+1};const _=s[e+1];if(!_||!_.includes("|")||!_.includes("-"))return{html:null,nextIndex:e+1};let E=[],h=e+2;for(;h<s.length;){const R=s[h];if(!R||!R.includes("|"))break;const V=R.split("|").map(H=>H.trim()).filter(H=>H.length>0);V.length>0&&E.push(V),h++}let A='<div class="tableWrapper"><table>';return A+="<thead><tr>",y.forEach(R=>{A+=`<th>${R}</th>`}),A+="</tr></thead>",E.length>0&&(A+="<tbody>",E.forEach(R=>{A+="<tr>";for(let V=0;V<y.length;V++){const H=R[V]||"";A+=`<td>${H}</td>`}A+="</tr>"}),A+="</tbody>"),A+="</table></div>",{html:A,nextIndex:h}},W=s=>s?(s=s.replace(/```(\w+)\n?([\s\S]*?)```/g,(e,d,y)=>`<pre><code class="language-${d}">${y.trim()}</code></pre>`),s=s.replace(/```\n?([\s\S]*?)```/g,(e,d)=>`<pre><code>${d.trim()}</code></pre>`),s):"",L=s=>{if(!s)return"";if(s.includes("<p>")||s.includes("<h1>")||s.includes("<h2>")||s.includes("<div>")||s.includes("<div "))return s;let e=s;const d=[];e=e.replace(/```mermaid\n?([\s\S]*?)```/g,(E,h)=>{const A=h.trim(),V=`<div data-mermaid data-mermaid-code="${A.replace(/&/g,"&amp;").replace(/"/g,"&quot;").replace(/</g,"&lt;").replace(/>/g,"&gt;")}" data-view-mode="diagram"><pre><code class="language-mermaid">${A}</code></pre></div>`,H=d.length;return d.push(V),`__MERMAID_PLACEHOLDER_${H}__`}),e=e.replace(/``mermaid\n?([\s\S]*?)``/g,(E,h)=>{const A=h.trim(),V=`<div data-mermaid data-mermaid-code="${A.replace(/&/g,"&amp;").replace(/"/g,"&quot;").replace(/</g,"&lt;").replace(/>/g,"&gt;")}" data-view-mode="diagram"><pre><code class="language-mermaid">${A}</code></pre></div>`,H=d.length;return d.push(V),`__MERMAID_PLACEHOLDER_${H}__`}),e=e.replace(/`mermaid\n([\s\S]*?)`/g,(E,h)=>{const A=h.trim(),V=`<div data-mermaid data-mermaid-code="${A.replace(/&/g,"&amp;").replace(/"/g,"&quot;").replace(/</g,"&lt;").replace(/>/g,"&gt;")}" data-view-mode="diagram"><pre><code class="language-mermaid">${A}</code></pre></div>`,H=d.length;return d.push(V),`__MERMAID_PLACEHOLDER_${H}__`}),e=W(e),e=e.replace(/^### (.*$)/gim,"<h3>$1</h3>"),e=e.replace(/^## (.*$)/gim,"<h2>$1</h2>"),e=e.replace(/^# (.*$)/gim,"<h1>$1</h1>"),e=e.replace(/\*\*(.*?)\*\*/g,"<strong>$1</strong>"),e=e.replace(/\*(.*?)\*/g,"<em>$1</em>"),e=e.replace(/`([^`]+)`/g,"<code>$1</code>"),e=O(e);let _=e.split(`

`).filter(E=>E.trim()).map(E=>{const h=E.trim();if(h.startsWith("<h1>")||h.startsWith("<h2>")||h.startsWith("<h3>")||h.startsWith("<div")||h.startsWith("<table")||h.startsWith("<pre")||h.startsWith("<ul")||h.startsWith("<ol")||h.startsWith("<blockquote")||h.startsWith("__MERMAID_PLACEHOLDER_"))return h;if(h.includes(`
`)&&(h.match(/^\d+\./)||h.match(/^-\s/)||h.match(/^\*\s/))){const R=h.split(`
`).map(V=>{const H=V.trim();return H.match(/^\d+\.\s/)?`<li>${H.replace(/^\d+\.\s/,"")}</li>`:H.match(/^[-*]\s/)?`<li>${H.replace(/^[-*]\s/,"")}</li>`:H}).filter(V=>V.startsWith("<li>"));return h.match(/^\d+\./)?`<ol>${R.join("")}</ol>`:`<ul>${R.join("")}</ul>`}return`<p>${h.replace(/\n/g,"<br>")}</p>`}).join("");return d.forEach((E,h)=>{_=_.replace(`__MERMAID_PLACEHOLDER_${h}__`,E)}),_},Y=[ya.configure({heading:{levels:[1,2,3]},codeBlock:!1,link:!1}),wa.configure({lowlight:k,HTMLAttributes:{class:"code-block-highlighted"}}),ka.configure({placeholder:f.placeholder}),Ca,Ta,F,za,Aa.configure({multicolor:!0}),Ma.configure({openOnClick:!1,HTMLAttributes:{class:"prose-link text-primary hover:text-primary/80 underline decoration-primary/50"}}),Sa.configure({resizable:!0}),$a,La,_a,qa,Ia,rr.configure({maxWidth:800}),Ea.configure({types:["heading","paragraph"]}),sr.configure({onManualTrigger:()=>S("ghost-manual-trigger"),onAccepted:s=>S("ghost-accepted",s),onDismissed:()=>S("ghost-dismissed")})].filter((s,e,d)=>e===d.findIndex(y=>y.name===s.name)),r=Ra({content:L(f.modelValue),editable:!f.readonly,extensions:Y,editorProps:{attributes:{class:"prose prose-sm dark:prose-invert max-w-none focus:outline-none",style:`min-height: ${f.minHeight}; padding: 12px;`}},onUpdate:({editor:s})=>{S("update:modelValue",s.getHTML()),we()},onSelectionUpdate:({editor:s})=>{we();const{from:e,to:d,empty:y}=s.state.selection;if(y)S("update:selectedText",""),S("update:selectionRange",null),console.log("ðŸ”„ RichTextEditor - No selection, cleared");else{if(!s.state.doc)return;const _=s.state.doc.textBetween(e,d);_.split(/\s+/).filter(h=>h.length>0).length<=200?(S("update:selectedText",_),S("update:selectionRange",{from:e,to:d}),console.log("âœ… RichTextEditor - Selection emitted to parent")):(S("update:selectedText",""),S("update:selectionRange",null),console.log("âŒ RichTextEditor - Selection too long, cleared"))}}});ne(()=>f.modelValue,s=>{if(r.value){if(f.streamingMode&&z.value){de(s);return}if(r.value.getHTML()!==s){const e=L(s);r.value.commands.setContent(e,{emitUpdate:!1}),Be(()=>{r.value&&S("update:modelValue",r.value.getHTML())})}}}),ne([()=>f.ghostText,()=>f.ghostTextFormat,()=>f.ghostTextPosition],([s,e,d])=>{if(!r.value)return;const y=(s??"").toString();if(!y){r.value.commands.clearGhostText?.();return}r.value.commands.setGhostText?.({text:y,format:e??"text",position:typeof d=="number"?d:void 0})},{immediate:!0}),ne(()=>f.streamingMode,s=>{s?te():w()});function te(){z.value=!0,U.value=0,C.value="",console.log("RichTextEditor: Streaming mode started (throttled)")}function w(){M.value&&(clearTimeout(M.value),M.value=null),C.value&&r.value&&me(C.value),z.value=!1,C.value="",U.value=0,console.log("RichTextEditor: Streaming mode ended")}function de(s){if(!r.value||!z.value)return;C.value=s;const d=Date.now()-U.value;if(d>=tt){me(s);return}if(!M.value){const y=tt-d;M.value=setTimeout(()=>{M.value=null,z.value&&C.value&&me(C.value)},y)}}function me(s){if(!r.value)return;U.value=Date.now();const e=L(s);r.value.getHTML()!==e&&r.value.commands.setContent(e,{emitUpdate:!1})}function $(){if(!r.value)return;const s=C.value||f.modelValue,e=L(s);r.value.commands.setContent(e,{emitUpdate:!1})}function K(){const s=C.value||f.modelValue;return{length:s.length,wordCount:s.split(/\s+/).filter(e=>e.length>0).length}}ne(()=>f.readonly,s=>{r.value&&r.value.setEditable(!s)}),Fe(()=>{setTimeout(()=>{r.value&&we()},100),document.addEventListener("tiptap-image-drop",je),document.addEventListener("tiptap-image-paste",Ge)}),at(()=>{M.value&&(clearTimeout(M.value),M.value=null),r.value&&r.value.destroy(),document.removeEventListener("tiptap-image-drop",je),document.removeEventListener("tiptap-image-paste",Ge),o()});const Q=()=>r.value?.chain().focus().toggleBold().run(),pe=()=>r.value?.chain().focus().toggleItalic().run(),Ve=()=>r.value?.chain().focus().toggleStrike().run(),De=()=>r.value?.chain().focus().toggleCode().run(),Ce=()=>{r.value?.chain().focus().insertMermaid().run()},ae=v(!1);let m=null;const o=()=>{m&&(m.disconnect(),m=null)},c=()=>{if(typeof document>"u"){ae.value=!1;return}ae.value=!!(f.toolbarTeleportTarget&&document.querySelector(f.toolbarTeleportTarget))};typeof document<"u"&&c();const N=B(()=>!f.toolbarTeleportTarget||!ae.value);B(()=>!N.value);const ve=B(()=>N.value?"body":f.toolbarTeleportTarget||"body"),he=B(()=>{const s="z-20 flex items-center gap-1 border-border/40 bg-background/95 p-1.5 shadow-sm backdrop-blur-md transition-all duration-200 supports-[backdrop-filter]:bg-background/80 overflow-x-auto no-scrollbar mask-gradient-right";return N.value?`sticky top-0 mx-0 sm:mx-2 md:mx-4 mt-0 sm:mt-1 md:mt-2 mb-2 md:mb-4 rounded-none sm:rounded-lg md:rounded-xl border-y sm:border ${s}`:`w-full ${s} rounded-lg border`});ne(()=>f.toolbarTeleportTarget,async()=>{await Be(),c()},{flush:"post"}),Fe(async()=>{await Be(),c(),!ae.value&&f.toolbarTeleportTarget&&typeof MutationObserver<"u"&&typeof document<"u"&&document.body&&(o(),m=new MutationObserver(()=>{c(),ae.value&&o()}),m.observe(document.body,{childList:!0,subtree:!0}))});const re=()=>r.value?.chain().focus().toggleUnderline().run(),G=()=>r.value?.chain().focus().toggleHeading({level:1}).run(),J=()=>r.value?.chain().focus().toggleHeading({level:2}).run(),Te=()=>r.value?.chain().focus().toggleHeading({level:3}).run(),ht=()=>r.value?.chain().focus().toggleBulletList().run(),bt=()=>r.value?.chain().focus().toggleOrderedList().run(),xt=()=>r.value?.chain().focus().toggleBlockquote().run(),yt=()=>r.value?.chain().focus().setParagraph().run(),wt=()=>r.value?.chain().focus().undo().run(),kt=()=>r.value?.chain().focus().redo().run(),be=v(!1),ze=v(!1),j=v({url:"",text:""}),se=v({color:"#000000"}),Ct=()=>{const{from:s,to:e}=r.value?.state.selection||{from:0,to:0},d=r.value?.state.doc.textBetween(s,e)||"";r.value?.isActive("link")?r.value.chain().focus().unsetLink().run():(j.value.text=d,j.value.url="",be.value=!0)},Tt=()=>{if(j.value.url){if(j.value.text){const{from:s,to:e}=r.value?.state.selection||{from:0,to:0};r.value?.chain().focus().deleteRange({from:s,to:e}).insertContent(`<a href="${j.value.url}">${j.value.text}</a>`).run()}else r.value?.chain().focus().setLink({href:j.value.url}).run();be.value=!1}},zt=()=>{ze.value=!0},At=()=>{se.value.color&&r.value?.chain().focus().setColor(se.value.color).run(),ze.value=!1},Mt=()=>{r.value?.chain().focus().unsetColor().run()},ue=v(!1),ce=v(""),xe=v(!1),Ae=v(0),ge=v(""),Me=v(null),St=()=>{ce.value="",ge.value="",ue.value=!0},qe=()=>{ce.value&&(r.value?.chain().focus().setImage({src:ce.value}).run(),ue.value=!1)},$t=s=>{const d=s.target.files?.[0];d&&Pe(d)},Pe=async s=>{if(!s.type.startsWith("image/")){ge.value="Please select an image file";return}xe.value=!0,ge.value="",Ae.value=0;try{const e=new FormData;e.append("image",s);const d=await dt.post("/editor/images",e,{headers:{"Content-Type":"multipart/form-data"},onUploadProgress:y=>{y.total&&(Ae.value=Math.round(y.loaded*100/y.total))}});d.data.success&&(r.value?.chain().focus().setImage({src:d.data.url,width:d.data.width,height:d.data.height}).run(),ue.value=!1)}catch(e){ge.value=e.response?.data?.message||"Upload failed"}finally{xe.value=!1,Ae.value=0,Me.value&&(Me.value.value="")}},je=s=>{const{file:e}=s.detail;Pe(e)},Ge=s=>{const{file:e}=s.detail;Pe(e)},Xe=v("#ffff00"),Lt=()=>{if(r.value?.isActive("highlight"))r.value.chain().focus().unsetHighlight().run();else{const s=prompt("Enter highlight color (hex, rgb, or color name):",Xe.value);s?(Xe.value=s,r.value?.chain().focus().setHighlight({color:s}).run()):r.value?.chain().focus().setHighlight().run()}},Se=s=>{r.value?.chain().focus().setTextAlign(s).run()},_t=()=>{r.value?.chain().focus().insertTable({rows:3,cols:3,withHeaderRow:!0}).run()},Et=()=>{r.value?.chain().focus().addColumnBefore().run()},Rt=()=>{r.value?.chain().focus().addColumnAfter().run()},Ht=()=>{r.value?.chain().focus().deleteColumn().run()},It=()=>{r.value?.chain().focus().addRowBefore().run()},Vt=()=>{r.value?.chain().focus().addRowAfter().run()},Dt=()=>{r.value?.chain().focus().deleteRow().run()},Pt=()=>{r.value?.chain().focus().deleteTable().run()},oe=()=>r.value?.isActive("table")??!1,Ye=v("12pt"),ye=["8pt","9pt","10pt","11pt","12pt","14pt","16pt","18pt","20pt","24pt","28pt","36pt","48pt","72pt"],Ut=()=>{const s=Ue(),e=ye.indexOf(s);if(e===-1)r.value?.chain().focus().setFontSize("14pt").run();else if(e<ye.length-1){const d=ye[e+1];r.value?.chain().focus().setFontSize(d).run()}we()},Bt=()=>{const s=Ue(),e=ye.indexOf(s);if(e===-1)r.value?.chain().focus().setFontSize("11pt").run();else if(e>0){const d=ye[e-1];r.value?.chain().focus().setFontSize(d).run()}we()},Ue=()=>{const{from:s,to:e}=r.value?.state.selection||{from:0,to:0};let d="";return r.value?.state.doc.nodesBetween(s,e,y=>{y.marks&&y.marks.forEach(_=>{_.type.name==="textStyle"&&_.attrs.fontSize&&(d=_.attrs.fontSize)})}),d||"12pt"},we=()=>{const s=Ue();Ye.value=s},Ft=B(()=>r.value?r.value.state.doc.textContent.split(/\s+/).filter(e=>e.length>0).length:0);return n({getSelectionRange:()=>{if(!r.value)return null;const{from:s,to:e,empty:d}=r.value.state.selection;return d?null:{from:s,to:e}},getSelectedText:()=>{if(!r.value)return"";const{from:s,to:e}=r.value.state.selection;return r.value.state.doc.textBetween(s,e)},replaceSelection:(s,e)=>{if(!r.value)return console.error("âŒ RichTextEditor - Cannot replace selection: editor not available"),!1;try{const d=e||r.value.state.selection;return console.log("ðŸ”„ RichTextEditor - Starting text replacement:",{range:d,newTextLength:s.length,newTextPreview:s.substring(0,100)+(s.length>100?"...":"")}),r.value.chain().focus().insertContentAt({from:d.from,to:d.to},s,{parseOptions:{preserveWhitespace:"full"}}).run(),console.log("âœ… RichTextEditor - Text replacement successful"),!0}catch(d){return console.error("âŒ RichTextEditor - Error replacing selection:",d),!1}},replaceTextAt:(s,e)=>{if(!r.value)return!1;try{return r.value.chain().focus().insertContentAt(s,e).run(),!0}catch(d){return console.error("Error replacing text at position:",d),!1}},getCursorPosition:()=>r.value?r.value.state.selection.anchor:0,setCursorPosition:s=>{if(!r.value)return!1;try{return r.value.commands.setTextSelection(s),!0}catch(e){return console.error("Error setting cursor position:",e),!1}},focus:()=>r.value?.commands.focus(),blur:()=>r.value?.commands.blur(),getHTML:()=>r.value?.getHTML()||"",getText:()=>r.value?.getText()||"",wordCount:Ft,startStreamingMode:te,endStreamingMode:w,refreshContent:$,getStreamingInfo:K,isStreamingActive:()=>z.value,editor:()=>r.value}),(s,e)=>(T(),I("div",or,[s.showToolbar&&!s.readonly?(T(),ie(Jt,{key:0,to:ve.value,disabled:N.value},[u("div",{class:x(he.value)},[u("div",nr,[a(t(p),{variant:"ghost",size:"icon",class:"h-8 w-8 rounded-lg hover:bg-muted/80 text-zinc-700 dark:text-zinc-300 hover:text-foreground",onClick:wt,disabled:!t(r)?.can().undo()},{default:i(()=>[a(t(Zt),{class:"h-4 w-4"})]),_:1},8,["disabled"]),a(t(p),{variant:"ghost",size:"icon",class:"h-8 w-8 rounded-lg hover:bg-muted/80 text-zinc-700 dark:text-zinc-300 hover:text-foreground",onClick:kt,disabled:!t(r)?.can().redo()},{default:i(()=>[a(t(ea),{class:"h-4 w-4"})]),_:1},8,["disabled"])]),u("div",lr,[a(t(et),null,{default:i(()=>[a(t(Je),{asChild:""},{default:i(()=>[a(t(p),{variant:"ghost",size:"sm",class:"h-8 gap-1 px-2 font-medium text-zinc-700 dark:text-zinc-300 hover:text-foreground hover:bg-muted/80"},{default:i(()=>[u("span",ir,D(t(r)?.isActive("heading",{level:1})?"H1":t(r)?.isActive("heading",{level:2})?"H2":t(r)?.isActive("heading",{level:3})?"H3":"Paragraph"),1),a(t(it),{class:"h-3.5 w-3.5 opacity-70"})]),_:1})]),_:1}),a(t(Ze),{align:"start"},{default:i(()=>[a(t(q),{onClick:yt,class:x({"bg-accent":t(r)?.isActive("paragraph")})},{default:i(()=>[...e[15]||(e[15]=[u("span",{class:"text-sm"},"Paragraph",-1)])]),_:1},8,["class"]),a(t($e)),a(t(q),{onClick:G,class:x({"bg-accent":t(r)?.isActive("heading",{level:1})})},{default:i(()=>[...e[16]||(e[16]=[u("span",{class:"text-lg font-bold"},"Heading 1",-1)])]),_:1},8,["class"]),a(t(q),{onClick:J,class:x({"bg-accent":t(r)?.isActive("heading",{level:2})})},{default:i(()=>[...e[17]||(e[17]=[u("span",{class:"text-base font-bold"},"Heading 2",-1)])]),_:1},8,["class"]),a(t(q),{onClick:Te,class:x({"bg-accent":t(r)?.isActive("heading",{level:3})})},{default:i(()=>[...e[18]||(e[18]=[u("span",{class:"text-sm font-bold"},"Heading 3",-1)])]),_:1},8,["class"])]),_:1})]),_:1}),u("div",dr,[a(t(p),{variant:"ghost",size:"icon",class:"h-8 w-6 rounded-l-lg text-zinc-700 dark:text-zinc-300 hover:text-foreground hover:bg-muted/80",onClick:Bt},{default:i(()=>[a(t(ta),{class:"h-3 w-3"})]),_:1}),u("div",ur,D(Ye.value.replace("pt","")),1),a(t(p),{variant:"ghost",size:"icon",class:"h-8 w-6 rounded-r-lg text-zinc-700 dark:text-zinc-300 hover:text-foreground hover:bg-muted/80",onClick:Ut},{default:i(()=>[a(t(aa),{class:"h-3 w-3"})]),_:1})])]),u("div",cr,[a(t(p),{variant:"ghost",size:"icon",class:x(["h-8 w-8 rounded-lg text-zinc-700 dark:text-zinc-300 hover:text-foreground hover:bg-muted/80",{"bg-primary/10 text-primary":t(r)?.isActive("bold")}]),onClick:Q},{default:i(()=>[a(t(ra),{class:"h-4 w-4"})]),_:1},8,["class"]),a(t(p),{variant:"ghost",size:"icon",class:x(["h-8 w-8 rounded-lg text-zinc-700 dark:text-zinc-300 hover:text-foreground hover:bg-muted/80",{"bg-primary/10 text-primary":t(r)?.isActive("italic")}]),onClick:pe},{default:i(()=>[a(t(sa),{class:"h-4 w-4"})]),_:1},8,["class"]),a(t(p),{variant:"ghost",size:"icon",class:x(["h-8 w-8 rounded-lg text-zinc-700 dark:text-zinc-300 hover:text-foreground hover:bg-muted/80",{"bg-primary/10 text-primary":t(r)?.isActive("underline")}]),onClick:re},{default:i(()=>[a(t(oa),{class:"h-4 w-4"})]),_:1},8,["class"]),a(t(p),{variant:"ghost",size:"icon",class:x(["h-8 w-8 rounded-lg text-zinc-700 dark:text-zinc-300 hover:text-foreground hover:bg-muted/80",{"bg-primary/10 text-primary":t(r)?.isActive("strike")}]),onClick:Ve},{default:i(()=>[a(t(na),{class:"h-4 w-4"})]),_:1},8,["class"]),a(t(p),{variant:"ghost",size:"icon",class:x(["h-8 w-8 rounded-lg text-zinc-700 dark:text-zinc-300 hover:text-foreground hover:bg-muted/80",{"bg-primary/10 text-primary":t(r)?.isActive("code")}]),onClick:De},{default:i(()=>[a(t(la),{class:"h-4 w-4"})]),_:1},8,["class"])]),u("div",gr,[a(t(p),{variant:"ghost",size:"icon",class:x(["h-8 w-8 rounded-lg text-zinc-700 dark:text-zinc-300 hover:text-foreground hover:bg-muted/80",{"bg-primary/10 text-primary":t(r)?.isActive("bulletList")}]),onClick:ht},{default:i(()=>[a(t(ia),{class:"h-4 w-4"})]),_:1},8,["class"]),a(t(p),{variant:"ghost",size:"icon",class:x(["h-8 w-8 rounded-lg text-zinc-700 dark:text-zinc-300 hover:text-foreground hover:bg-muted/80",{"bg-primary/10 text-primary":t(r)?.isActive("orderedList")}]),onClick:bt},{default:i(()=>[a(t(da),{class:"h-4 w-4"})]),_:1},8,["class"]),a(t(p),{variant:"ghost",size:"icon",class:x(["h-8 w-8 rounded-lg text-zinc-700 dark:text-zinc-300 hover:text-foreground hover:bg-muted/80",{"bg-primary/10 text-primary":t(r)?.isActive("blockquote")}]),onClick:xt},{default:i(()=>[a(t(ua),{class:"h-4 w-4"})]),_:1},8,["class"]),u("div",fr,[a(t(p),{variant:"ghost",size:"icon",class:x(["h-8 w-8 rounded-lg text-zinc-700 dark:text-zinc-300 hover:text-foreground hover:bg-muted/80",{"bg-primary/10 text-primary":t(r)?.isActive({textAlign:"left"})}]),onClick:e[0]||(e[0]=d=>Se("left"))},{default:i(()=>[a(t(ot),{class:"h-4 w-4"})]),_:1},8,["class"]),a(t(p),{variant:"ghost",size:"icon",class:x(["h-8 w-8 rounded-lg text-zinc-700 dark:text-zinc-300 hover:text-foreground hover:bg-muted/80",{"bg-primary/10 text-primary":t(r)?.isActive({textAlign:"center"})}]),onClick:e[1]||(e[1]=d=>Se("center"))},{default:i(()=>[a(t(nt),{class:"h-4 w-4"})]),_:1},8,["class"]),a(t(p),{variant:"ghost",size:"icon",class:x(["h-8 w-8 rounded-lg text-zinc-700 dark:text-zinc-300 hover:text-foreground hover:bg-muted/80",{"bg-primary/10 text-primary":t(r)?.isActive({textAlign:"right"})}]),onClick:e[2]||(e[2]=d=>Se("right"))},{default:i(()=>[a(t(lt),{class:"h-4 w-4"})]),_:1},8,["class"]),a(t(p),{variant:"ghost",size:"icon",class:x(["h-8 w-8 rounded-lg text-zinc-700 dark:text-zinc-300 hover:text-foreground hover:bg-muted/80",{"bg-primary/10 text-primary":t(r)?.isActive({textAlign:"justify"})}]),onClick:e[3]||(e[3]=d=>Se("justify"))},{default:i(()=>[a(t(ca),{class:"h-4 w-4"})]),_:1},8,["class"])])]),u("div",mr,[a(t(p),{variant:"ghost",size:"icon",class:"h-8 w-8 rounded-lg text-zinc-700 dark:text-zinc-300 hover:text-foreground hover:bg-muted/80",title:"Insert Mermaid diagram (Ctrl/Cmd+Alt+M)",onClick:Ce},{default:i(()=>[...e[19]||(e[19]=[u("span",{class:"text-[11px] font-semibold"},"M",-1)])]),_:1}),a(t(p),{variant:"ghost",size:"icon",class:x(["h-8 w-8 rounded-lg text-zinc-700 dark:text-zinc-300 hover:text-foreground hover:bg-muted/80",{"bg-primary/10 text-primary":t(r)?.isActive("link")}]),onClick:Ct},{default:i(()=>[a(t(ga),{class:"h-4 w-4"})]),_:1},8,["class"]),a(t(p),{variant:"ghost",size:"icon",class:"h-8 w-8 rounded-lg text-zinc-700 dark:text-zinc-300 hover:text-foreground hover:bg-muted/80",title:"Insert image",onClick:St},{default:i(()=>[a(t(fa),{class:"h-4 w-4"})]),_:1}),a(t(et),null,{default:i(()=>[a(t(Je),{asChild:""},{default:i(()=>[a(t(p),{variant:"ghost",size:"icon",class:x(["h-8 w-8 rounded-lg text-zinc-700 dark:text-zinc-300 hover:text-foreground hover:bg-muted/80",{"bg-primary/10 text-primary":t(r)?.isActive("table")}])},{default:i(()=>[a(t(ma),{class:"h-4 w-4"})]),_:1},8,["class"])]),_:1}),a(t(Ze),null,{default:i(()=>[a(t(q),{onClick:_t},{default:i(()=>[...e[20]||(e[20]=[b("Insert Table (3x3)",-1)])]),_:1}),a(t($e)),a(t(q),{onClick:Et,disabled:!oe()},{default:i(()=>[...e[21]||(e[21]=[b("Add Column Before",-1)])]),_:1},8,["disabled"]),a(t(q),{onClick:Rt,disabled:!oe()},{default:i(()=>[...e[22]||(e[22]=[b("Add Column After",-1)])]),_:1},8,["disabled"]),a(t(q),{onClick:Ht,disabled:!oe()},{default:i(()=>[...e[23]||(e[23]=[b("Delete Column",-1)])]),_:1},8,["disabled"]),a(t($e)),a(t(q),{onClick:It,disabled:!oe()},{default:i(()=>[...e[24]||(e[24]=[b("Add Row Before",-1)])]),_:1},8,["disabled"]),a(t(q),{onClick:Vt,disabled:!oe()},{default:i(()=>[...e[25]||(e[25]=[b("Add Row After",-1)])]),_:1},8,["disabled"]),a(t(q),{onClick:Dt,disabled:!oe()},{default:i(()=>[...e[26]||(e[26]=[b("Delete Row",-1)])]),_:1},8,["disabled"]),a(t($e)),a(t(q),{onClick:Pt,disabled:!oe(),class:"text-destructive"},{default:i(()=>[...e[27]||(e[27]=[b("Delete Table ",-1)])]),_:1},8,["disabled"])]),_:1})]),_:1}),a(t(p),{variant:"ghost",size:"icon",class:x(["h-8 w-8 rounded-lg text-zinc-700 dark:text-zinc-300 hover:text-foreground hover:bg-muted/80",{"bg-primary/10 text-primary":t(r)?.isActive("highlight")}]),onClick:Lt},{default:i(()=>[a(t(pa),{class:"h-4 w-4"})]),_:1},8,["class"]),a(t(p),{variant:"ghost",size:"icon",class:x(["h-8 w-8 rounded-lg text-zinc-700 dark:text-zinc-300 hover:text-foreground hover:bg-muted/80",{"bg-primary/10 text-primary":t(r)?.getAttributes("textStyle").color}]),onClick:zt},{default:i(()=>[a(t(va),{class:"h-4 w-4"})]),_:1},8,["class"])])],2)],8,["to","disabled"])):P("",!0),u("div",pr,[a(t(Ha),{editor:t(r),class:"h-full w-full outline-none"},null,8,["editor"]),s.isGenerating?(T(),I("div",vr,[u("div",hr,[u("div",br,[e[28]||(e[28]=u("div",{class:"absolute inset-0 animate-ping rounded-full bg-primary/20"},null,-1)),u("div",xr,[a(t(rt),{class:"h-8 w-8 animate-spin text-primary"})])]),u("div",yr,[u("h3",wr,D(s.generationPhase||"Generating..."),1),u("p",kr,D(s.generationProgress||"AI is writing your chapter..."),1)]),a(t(Qe),{"model-value":s.generationPercentage,class:"h-2 w-64"},null,8,["model-value"])])])):P("",!0)]),a(t(Le),{open:be.value,"onUpdate:open":e[7]||(e[7]=d=>be.value=d)},{default:i(()=>[a(t(_e),null,{default:i(()=>[a(t(He),null,{default:i(()=>[a(t(Ie),null,{default:i(()=>[...e[29]||(e[29]=[b("Insert Link",-1)])]),_:1}),a(t(Ee),null,{default:i(()=>[...e[30]||(e[30]=[b("Enter the URL for the link.",-1)])]),_:1})]),_:1}),u("div",Cr,[u("div",Tr,[a(t(fe),{htmlFor:"link-text"},{default:i(()=>[...e[31]||(e[31]=[b("Text",-1)])]),_:1}),a(t(le),{id:"link-text",modelValue:j.value.text,"onUpdate:modelValue":e[4]||(e[4]=d=>j.value.text=d),placeholder:"Link text"},null,8,["modelValue"])]),u("div",zr,[a(t(fe),{htmlFor:"link-url"},{default:i(()=>[...e[32]||(e[32]=[b("URL",-1)])]),_:1}),a(t(le),{id:"link-url",modelValue:j.value.url,"onUpdate:modelValue":e[5]||(e[5]=d=>j.value.url=d),placeholder:"https://example.com"},null,8,["modelValue"])])]),a(t(Re),null,{default:i(()=>[a(t(p),{variant:"outline",onClick:e[6]||(e[6]=d=>be.value=!1)},{default:i(()=>[...e[33]||(e[33]=[b("Cancel",-1)])]),_:1}),a(t(p),{onClick:Tt},{default:i(()=>[...e[34]||(e[34]=[b("Insert",-1)])]),_:1})]),_:1})]),_:1})]),_:1},8,["open"]),a(t(Le),{open:ze.value,"onUpdate:open":e[10]||(e[10]=d=>ze.value=d)},{default:i(()=>[a(t(_e),null,{default:i(()=>[a(t(He),null,{default:i(()=>[a(t(Ie),null,{default:i(()=>[...e[35]||(e[35]=[b("Text Color",-1)])]),_:1}),a(t(Ee),null,{default:i(()=>[...e[36]||(e[36]=[b("Choose a color for the selected text.",-1)])]),_:1})]),_:1}),u("div",Ar,[u("div",Mr,[a(t(le),{type:"color",modelValue:se.value.color,"onUpdate:modelValue":e[8]||(e[8]=d=>se.value.color=d),class:"h-12 w-12 p-1"},null,8,["modelValue"]),a(t(le),{modelValue:se.value.color,"onUpdate:modelValue":e[9]||(e[9]=d=>se.value.color=d),placeholder:"#000000",class:"flex-1"},null,8,["modelValue"])]),u("div",Sr,[(T(),I(Oe,null,ha(["#000000","#ef4444","#f97316","#eab308","#22c55e","#3b82f6","#a855f7","#ec4899"],d=>u("button",{key:d,class:"h-8 w-8 rounded-full border border-border shadow-sm transition-transform hover:scale-110 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2",style:ke({backgroundColor:d}),onClick:y=>se.value.color=d},null,12,$r)),64))])]),a(t(Re),null,{default:i(()=>[a(t(p),{variant:"outline",onClick:Mt},{default:i(()=>[...e[37]||(e[37]=[b("Reset",-1)])]),_:1}),a(t(p),{onClick:At},{default:i(()=>[...e[38]||(e[38]=[b("Apply",-1)])]),_:1})]),_:1})]),_:1})]),_:1},8,["open"]),a(t(Le),{open:ue.value,"onUpdate:open":e[14]||(e[14]=d=>ue.value=d)},{default:i(()=>[a(t(_e),{class:"sm:max-w-md"},{default:i(()=>[a(t(He),null,{default:i(()=>[a(t(Ie),null,{default:i(()=>[...e[39]||(e[39]=[b("Insert Image",-1)])]),_:1}),a(t(Ee),null,{default:i(()=>[...e[40]||(e[40]=[b("Upload an image or enter a URL.",-1)])]),_:1})]),_:1}),u("div",Lr,[u("div",_r,[a(t(fe),null,{default:i(()=>[...e[41]||(e[41]=[b("Upload from computer",-1)])]),_:1}),u("div",Er,[u("input",{ref_key:"imageFileInput",ref:Me,type:"file",accept:"image/*",class:"hidden",onChange:$t},null,544),a(t(p),{variant:"outline",class:"w-full",disabled:xe.value,onClick:e[11]||(e[11]=d=>Me.value?.click())},{default:i(()=>[a(t(ba),{class:"w-4 h-4 mr-2"}),b(" "+D(xe.value?"Uploading...":"Choose File"),1)]),_:1},8,["disabled"])]),xe.value?(T(),ie(t(Qe),{key:0,"model-value":Ae.value,class:"h-2"},null,8,["model-value"])):P("",!0),ge.value?(T(),I("p",Rr,D(ge.value),1)):P("",!0)]),e[44]||(e[44]=u("div",{class:"relative"},[u("div",{class:"absolute inset-0 flex items-center"},[u("span",{class:"w-full border-t"})]),u("div",{class:"relative flex justify-center text-xs uppercase"},[u("span",{class:"bg-background px-2 text-muted-foreground"},"Or")])],-1)),u("div",Hr,[a(t(fe),{for:"image-url"},{default:i(()=>[...e[42]||(e[42]=[b("Image URL",-1)])]),_:1}),u("div",Ir,[a(t(le),{id:"image-url",modelValue:ce.value,"onUpdate:modelValue":e[12]||(e[12]=d=>ce.value=d),placeholder:"https://example.com/image.jpg",onKeydown:st(qe,["enter"])},null,8,["modelValue"]),a(t(p),{onClick:qe,disabled:!ce.value},{default:i(()=>[...e[43]||(e[43]=[b(" Insert ",-1)])]),_:1},8,["disabled"])])])]),a(t(Re),null,{default:i(()=>[a(t(p),{variant:"outline",onClick:e[13]||(e[13]=d=>ue.value=!1)},{default:i(()=>[...e[45]||(e[45]=[b("Cancel",-1)])]),_:1})]),_:1})]),_:1})]),_:1},8,["open"])]))}}),as=Ne(Vr,[["__scopeId","data-v-ae75afdc"]]);export{as as R};
