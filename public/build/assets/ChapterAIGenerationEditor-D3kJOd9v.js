import{a as K,_ as Q}from"./AppLayout.vue_vue_type_script_setup_true_lang-DnG8lPXn.js";import{_ as u}from"./index-Cn9MYLLD.js";import{_,a as x}from"./CardContent.vue_vue_type_script_setup_true_lang-LKRtVKVi.js";import{_ as v,a as b}from"./CardTitle.vue_vue_type_script_setup_true_lang-C6oNPW71.js";import{_ as Y}from"./Input.vue_vue_type_script_setup_true_lang-xNcvjKz2.js";import{_ as Z}from"./Label.vue_vue_type_script_setup_true_lang-CDQJdcf8.js";import{_ as ee}from"./Progress.vue_vue_type_script_setup_true_lang-B3NdoYwE.js";import{R as te}from"./RichTextEditor-Db4mg1yL.js";import{u as se,a as ae,b as oe}from"./useChapterWordCount-0z8gqXTM.js";import{d as re,$ as ne,y as c,a as j,C as y,o as f,E as a,K as o,H as s,u as e,R as ie,M as l,P as d,c as w,O as S,Q as le,S as de,J as P}from"./app-Drfb5vhD.js";import{u as ue}from"./useWordBalance-DlwRiA6H.js";import{t as pe}from"./index-D8sJQrjD.js";import{A as me}from"./arrow-left-CHfD7m8C.js";import{S as ce}from"./save-xYcv1HA_.js";import{B as fe}from"./brain-D8XZ_dWQ.js";import"./UserInfo.vue_vue_type_script_setup_true_lang-BLlNb5W3.js";import"./Presence-Cd6ATzLy.js";import"./useForwardExpose-Mg-D3WOz.js";import"./index-BUawP80q.js";import"./DialogTitle-DfpKTmmm.js";import"./TooltipTrigger.vue_vue_type_script_setup_true_lang-D5qL88rB.js";import"./DropdownMenuTrigger.vue_vue_type_script_setup_true_lang-Dv_0pwze.js";import"./loader-circle-BCOmBCcX.js";import"./VisuallyHidden-Ds1ee0_t.js";import"./coins-LEtzH9tW.js";import"./log-out-Dd5j-65E.js";import"./AppLogo.vue_vue_type_script_setup_true_lang-ZdwUt2Op.js";import"./library-BSw0UWSx.js";import"./plus-C5vk0fpa.js";import"./book-open-CioXM-hZ.js";import"./chevron-right-G-7VIrwo.js";import"./WordBalanceDisplay.vue_vue_type_script_setup_true_lang-DsZ5m7ES.js";import"./sun-DZcnMgBc.js";import"./nullish-CHIgUVhi.js";import"./index-CdhztUsa.js";import"./purify.es-DxJI3Wx7.js";import"./index-BWEDi_FC.js";import"./step-DrZ9DcYd.js";import"./chart-column-CjpHg4iR.js";import"./calendar-DY5Njonr.js";import"./users-BGbO8TZC.js";import"./circle-alert-D6iGcZBs.js";import"./eye-Df6YFRnF.js";import"./check-DaYZNDDf.js";import"./copy-BV7AQDwa.js";import"./download-Rmm3aUSK.js";import"./trash-2-DXyinpfS.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";import"./DialogContent.vue_vue_type_script_setup_true_lang-C2z8EtRP.js";import"./DialogDescription.vue_vue_type_script_setup_true_lang-DwOYdecp.js";import"./DialogFooter.vue_vue_type_script_setup_true_lang-Cf2xpk63.js";import"./DialogTitle.vue_vue_type_script_setup_true_lang-CcT6btXg.js";import"./type-DSdf5Qle.js";import"./minus-hbq0HFbt.js";import"./list-BmfygvNF.js";const ge={class:"flex min-h-[calc(100vh-2rem)] flex-col gap-4 bg-background text-foreground"},_e={class:"sticky top-0 z-20 border-b border-border/40 bg-background/80 backdrop-blur supports-[backdrop-filter]:bg-background/60"},xe={class:"mx-auto flex max-w-7xl items-center gap-3 px-4 py-3"},ve={class:"min-w-0 flex-1"},be={class:"truncate text-sm font-semibold"},he={class:"text-xs text-muted-foreground"},Ce={class:"flex items-center gap-2"},ke={class:"text-xs font-medium"},ye={class:"mx-auto grid w-full max-w-7xl flex-1 gap-4 px-4 pb-6 lg:grid-cols-[1fr_380px]"},we={class:"flex min-h-[60vh] flex-col gap-4"},Se={class:"grid gap-2"},$e={class:"flex flex-wrap gap-2"},Ae={key:0,class:"text-xs text-muted-foreground"},Ge={class:"font-medium text-foreground"},Te={class:"flex-1 overflow-y-auto custom-scrollbar"},je={class:"space-y-4"},Pe={class:"flex items-center justify-between"},Be={class:"font-medium"},Ee={class:"flex items-center justify-between"},Ve={class:"font-medium"},ze={class:"list-disc pl-5 space-y-1"},Ie={class:"text-muted-foreground"},Me={class:"text-muted-foreground"},Ne={class:"text-muted-foreground"},Ft=re({__name:"ChapterAIGenerationEditor",props:{project:{},chapter:{},allChapters:{},facultyChapters:{},mode:{}},setup(B){const r=B,{appearance:E,isDark:V}=ne(),h=c(r.chapter.title||""),g=c(r.chapter.content||""),$=c(""),A=c(null),z=c(null),I=c(!1),C=j(()=>{if(r.facultyChapters&&r.facultyChapters.length>0){const t=r.facultyChapters.find(i=>i.number===r.chapter.chapter_number);if(t?.word_count)return t.word_count}const p=r.project?.outlines?.find(t=>t.chapter_number===r.chapter.chapter_number)?.target_word_count;return p||(r.chapter.target_word_count?r.chapter.target_word_count:3e3)}),{currentWordCount:M,progressPercentage:N,countWords:R}=se(g,C);async function G(p=!1){try{const t=await fetch(P("chapters.save",{project:r.project.id}),{method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json","X-Requested-With":"XMLHttpRequest","X-CSRF-TOKEN":document.querySelector('meta[name="csrf-token"]')?.getAttribute("content")||""},body:JSON.stringify({project_id:r.project.id,chapter_number:r.chapter.chapter_number,title:h.value,content:g.value,auto_save:p})});if(!t.ok)throw new Error(`Save failed: ${t.status} ${t.statusText}`)}catch(t){throw p||pe.error("Save failed",{description:"Please try again."}),t}}const{isSaving:k,triggerAutoSave:T,save:W}=ae({delay:8e3,onSave:G}),{balance:F,showPurchaseModal:q,requiredWordsForModal:O,actionDescriptionForModal:U,checkAndPrompt:D,closePurchaseModal:L,estimates:X}=ue(),n=oe({props:r,chapterContent:g,targetWordCount:C,estimates:X,ensureBalance:(p,t)=>D(Math.max(1,Math.round(p)),t),save:G,triggerAutoSave:T,calculateWritingStats:()=>{},countWords:R,selectedText:$,richTextEditor:A,richTextEditorFullscreen:z,isNativeFullscreen:I}),m=j(()=>!n.isGenerating.value&&!k.value),H=()=>ie.visit(P("projects.show",r.project.slug));return(p,t)=>(f(),y(Q,null,{default:a(()=>[o("div",ge,[o("header",_e,[o("div",xe,[s(e(u),{variant:"ghost",size:"icon",class:"h-9 w-9",onClick:H,title:"Back to Project"},{default:a(()=>[s(e(me),{class:"h-4 w-4"})]),_:1}),o("div",ve,[o("div",be,l(r.project.title),1),o("div",he," Chapter "+l(r.chapter.chapter_number)+" · "+l(e(M))+" / "+l(C.value)+" words ",1)]),o("div",Ce,[s(K),s(e(u),{variant:"outline",size:"sm",class:"h-9 gap-2",onClick:t[0]||(t[0]=i=>e(W)(!1)),disabled:e(k)},{default:a(()=>[s(e(ce),{class:"h-4 w-4"}),o("span",ke,l(e(k)?"Saving…":"Save"),1)]),_:1},8,["disabled"])])])]),o("main",ye,[o("section",we,[s(e(_),{class:"bg-card text-card-foreground"},{default:a(()=>[s(e(v),{class:"space-y-2"},{default:a(()=>[s(e(b),{class:"text-base"},{default:a(()=>[...t[10]||(t[10]=[d("AI Generation Editor",-1)])]),_:1}),o("div",Se,[s(e(Z),{for:"chapter-title",class:"text-xs text-muted-foreground"},{default:a(()=>[...t[11]||(t[11]=[d("Title",-1)])]),_:1}),s(e(Y),{id:"chapter-title",modelValue:h.value,"onUpdate:modelValue":t[1]||(t[1]=i=>h.value=i),class:"bg-background"},null,8,["modelValue"])])]),_:1}),s(e(x),{class:"space-y-3"},{default:a(()=>[s(e(ee),{"model-value":e(N)},null,8,["model-value"]),o("div",$e,[s(e(u),{size:"sm",disabled:!m.value,onClick:t[2]||(t[2]=i=>e(n).handleAIGeneration("progressive"))},{default:a(()=>[...t[12]||(t[12]=[d(" Generate Chapter ",-1)])]),_:1},8,["disabled"]),s(e(u),{size:"sm",variant:"outline",disabled:!m.value,onClick:t[3]||(t[3]=i=>e(n).handleAIGeneration("outline"))},{default:a(()=>[...t[13]||(t[13]=[d(" Generate Outline ",-1)])]),_:1},8,["disabled"]),s(e(u),{size:"sm",variant:"outline",disabled:!m.value,onClick:t[4]||(t[4]=i=>e(n).handleAIGeneration("improve"))},{default:a(()=>[...t[14]||(t[14]=[d(" Improve ",-1)])]),_:1},8,["disabled"]),s(e(u),{size:"sm",variant:"outline",disabled:!m.value,onClick:t[5]||(t[5]=i=>e(n).handleAIGeneration("expand"))},{default:a(()=>[...t[15]||(t[15]=[d(" Expand ",-1)])]),_:1},8,["disabled"]),s(e(u),{size:"sm",variant:"outline",disabled:!m.value,onClick:t[6]||(t[6]=i=>e(n).handleAIGeneration("rephrase"))},{default:a(()=>[...t[16]||(t[16]=[d(" Rephrase ",-1)])]),_:1},8,["disabled"]),s(e(u),{size:"sm",variant:"outline",disabled:!m.value,onClick:t[7]||(t[7]=i=>e(n).getAISuggestions())},{default:a(()=>[s(e(fe),{class:"h-4 w-4 mr-2"}),t[17]||(t[17]=d(" Suggestions ",-1))]),_:1},8,["disabled"])]),e(n).isGenerating?(f(),w("div",Ae,[o("div",Ge,l(e(n).generationPhase||"Generating…"),1),o("div",null,l(e(n).generationProgress),1)])):S("",!0)]),_:1})]),_:1}),s(e(_),{class:"flex min-h-[45vh] flex-1 flex-col bg-card text-card-foreground"},{default:a(()=>[s(e(v),null,{default:a(()=>[s(e(b),{class:"text-base"},{default:a(()=>[...t[18]||(t[18]=[d("Content",-1)])]),_:1})]),_:1}),s(e(x),{class:"flex flex-1 flex-col"},{default:a(()=>[o("div",Te,[s(te,{ref_key:"richTextEditor",ref:A,modelValue:g.value,"onUpdate:modelValue":[t[8]||(t[8]=i=>g.value=i),e(T)],"streaming-mode":e(n).isStreamingMode,"is-generating":e(n).isGenerating,"generation-progress":e(n).generationProgress,"generation-percentage":e(n).generationPercentage,"generation-phase":e(n).generationPhase,"onUpdate:selectedText":t[9]||(t[9]=i=>$.value=i)},null,8,["modelValue","streaming-mode","is-generating","generation-progress","generation-percentage","generation-phase","onUpdate:modelValue"])])]),_:1})]),_:1})]),o("aside",je,[s(e(_),{class:"bg-card text-card-foreground"},{default:a(()=>[s(e(v),null,{default:a(()=>[s(e(b),{class:"text-base"},{default:a(()=>[...t[19]||(t[19]=[d("Theme",-1)])]),_:1})]),_:1}),s(e(x),{class:"space-y-2 text-sm"},{default:a(()=>[o("div",Pe,[t[20]||(t[20]=o("span",{class:"text-muted-foreground"},"mode",-1)),o("span",Be,l(e(V)?"dark":"light"),1)]),o("div",Ee,[t[21]||(t[21]=o("span",{class:"text-muted-foreground"},"appearance",-1)),o("span",Ve,l(e(E)),1)])]),_:1})]),_:1}),e(n).aiSuggestions.length?(f(),y(e(_),{key:0,class:"bg-card text-card-foreground"},{default:a(()=>[s(e(v),null,{default:a(()=>[s(e(b),{class:"text-base"},{default:a(()=>[...t[22]||(t[22]=[d("AI Suggestions",-1)])]),_:1})]),_:1}),s(e(x),{class:"space-y-2 text-sm"},{default:a(()=>[o("ul",ze,[(f(!0),w(le,null,de(e(n).aiSuggestions,(i,J)=>(f(),w("li",{key:J},l(i),1))),128))])]),_:1})]),_:1})):S("",!0),e(q)?(f(),y(e(_),{key:1,class:"bg-card text-card-foreground"},{default:a(()=>[s(e(v),null,{default:a(()=>[s(e(b),{class:"text-base"},{default:a(()=>[...t[23]||(t[23]=[d("Credits Required",-1)])]),_:1})]),_:1}),s(e(x),{class:"space-y-2 text-sm"},{default:a(()=>[o("div",Ie,"Balance: "+l(e(F)),1),o("div",Me,"Needed: "+l(e(O)),1),o("div",Ne,l(e(U)),1),s(e(u),{size:"sm",variant:"outline",onClick:e(L)},{default:a(()=>[...t[24]||(t[24]=[d("Close",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1})):S("",!0)])])])]),_:1}))}});export{Ft as default};
