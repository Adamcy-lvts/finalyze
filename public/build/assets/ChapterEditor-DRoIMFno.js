const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/ChapterNavigation-DTbV-eGh.js","assets/ChapterNavigation.vue_vue_type_script_setup_true_lang-D4w6akDh.js","assets/index-CgLP59YT.js","assets/app-Bgp9Ah4M.js","assets/app-DLMxz4xk.css","assets/ScrollArea.vue_vue_type_script_setup_true_lang-DxrIk156.js","assets/Presence-CxvUdqX-.js","assets/useForwardExpose-CCubejfB.js","assets/index-DfNGxhKz.js","assets/useNonce-B3K-CMV_.js","assets/AlertDialogTitle.vue_vue_type_script_setup_true_lang-B2ZKqQHJ.js","assets/DialogTitle-VCYIJ3PW.js","assets/DropdownMenuTrigger.vue_vue_type_script_setup_true_lang-BLfEqrc4.js","assets/index-BuZzZ-m6.js","assets/x-BJZchuQz.js","assets/loader-circle-Chi0vZAo.js","assets/VisuallyHidden-CWjcrOI1.js","assets/DialogTrigger-BWGQ_6jK.js","assets/index-BneSV3ha.js","assets/plus-DG50jX5S.js","assets/chevron-right-CJhsJ7Lp.js","assets/circle-check-big-BwJDm6ET.js","assets/lock-DfHLDu8Q.js","assets/target-5EpjOSs_.js","assets/trash-2-v5fRH4M9.js","assets/MobileNavOverlay-BC9xhwVh.js","assets/index-CGxCRlGy.js","assets/DefensePreparationPanel.vue_vue_type_script_setup_true_lang-DXnVC1gO.js","assets/CardContent.vue_vue_type_script_setup_true_lang-BzdaijRh.js","assets/CardTitle.vue_vue_type_script_setup_true_lang-DzsLSsD4.js","assets/CollapsibleTrigger.vue_vue_type_script_setup_true_lang-BfNSLsfH.js","assets/Progress.vue_vue_type_script_setup_true_lang-DGihA61_.js","assets/nullish-CHIgUVhi.js","assets/Separator.vue_vue_type_script_setup_true_lang-BbDFp8uv.js","assets/Separator-6UPT1N5E.js","assets/Switch.vue_vue_type_script_setup_true_lang-nlyxuOza.js","assets/VisuallyHiddenInput-DLf9WDkl.js","assets/chevron-down-BrxS-JnU.js","assets/circle-help-DLby68lj.js","assets/lightbulb-CHitFxot.js","assets/useTextHistory-DpIjHyY7.js","assets/Input.vue_vue_type_script_setup_true_lang-DGnGMdUc.js","assets/RichTextEditor-BIEhWIVu.js","assets/_plugin-vue_export-helper-DlAUqK2U.js","assets/purify.es-DxJI3Wx7.js","assets/index-BWEDi_FC.js","assets/step-DrZ9DcYd.js","assets/chart-column-D-g7_Y1u.js","assets/calendar-DjJq-Jcv.js","assets/brain-HetR7HlD.js","assets/users-kB5i5IoU.js","assets/circle-alert-DKKGkVZz.js","assets/eye-Bde_bS5a.js","assets/check-GE7eRY7c.js","assets/type-CbQuT-jz.js","assets/download-JX5TQwFT.js","assets/DialogTitle.vue_vue_type_script_setup_true_lang-Bx9cUe56.js","assets/DialogDescription.vue_vue_type_script_setup_true_lang-CAnUnvBI.js","assets/DialogFooter.vue_vue_type_script_setup_true_lang-Bbo7H716.js","assets/Label.vue_vue_type_script_setup_true_lang-CPKGhh_h.js","assets/minus-C-98W0B5.js","assets/list-CQnfqd5K.js","assets/RichTextEditor-DmhamKCY.css","assets/book-open-CWJ86bNf.js","assets/search-DeJ4_h6v.js","assets/sparkles-BzcWNUl2.js","assets/Checkbox.vue_vue_type_script_setup_true_lang-CnW7GxJj.js","assets/ohash.D__AXeF1-C-E83dC9.js","assets/RovingFocusItem-BRizaEdi.js","assets/file-text-MoFYUjiJ.js","assets/refresh-cw-BqYKjBR_.js","assets/thumbs-up-YHrzt8xi.js","assets/TooltipTrigger.vue_vue_type_script_setup_true_lang-CppFsSbV.js","assets/WordBalanceDisplay.vue_vue_type_script_setup_true_lang-CSNTrGY4.js","assets/coins-BCKUMIwG.js","assets/AppLayout.vue_vue_type_script_setup_true_lang-LpAZ_Ivm.js","assets/UserInfo.vue_vue_type_script_setup_true_lang-BBxxp6Qp.js","assets/log-out-oD-JmEo1.js","assets/AppLogo.vue_vue_type_script_setup_true_lang-CrS2M0c1.js","assets/library-Bvyft1u9.js","assets/sun-BjLx__jj.js","assets/useWordBalance-CHUQ8TYa.js","assets/driver-B4w0q6_T.js","assets/driver-DB0Q8XAf.css","assets/PurchaseModal.vue_vue_type_script_setup_true_lang-BW5gK56Z.js","assets/arrow-right-BhOH58WS.js","assets/useChapterWordCount-Bmk7gU2e.js","assets/toNumber-DK1ozgOy.js","assets/save-BsH-Zzp8.js","assets/zap-BXHG9EEh.js","assets/pen-tool-lg2Mk-gM.js","assets/arrow-left-DKn8VAIi.js","assets/menu-CaNx-ax8.js","assets/message-square-Be8-CeED.js","assets/minimize-2-ep2zGLJT.js","assets/MobileNavOverlay-CN-XSdXy.css","assets/ChatModeLayout-CEg_GBZ0.js","assets/send-BY7S-kDn.js","assets/loader-D90moXVZ.js","assets/clock-DRfn1cC_.js","assets/chevron-left-BZsgEzvV.js","assets/bot-DFSIxuX-.js","assets/user-CKWn9Fh-.js","assets/square-eBdZxGKX.js","assets/ChatModeLayout-D4JlvW0D.css","assets/CitationVerificationLayout-aJPEHMi_.js","assets/SafeHtmlText.vue_vue_type_script_setup_true_lang-DOefDurY.js"])))=>i.map(i=>d[i]);
import{aB as sr,af as rr,S as ss,t as ae,b as E,a4 as rs,e as R,U as V,X as se,q as $e,p as Ce,ad as de,d as Ue,s as or,c as q,o as S,k as r,u as e,i as I,j as o,g as s,y as p,z as b,n as Ge,Q as Ee,V as Ae,aa as De,f as X,a1 as nr,T as ar,F as Ft,aC as Ve,l as Xe,aD as lr,m as zt,I as ir,aE as Je}from"./app-Bgp9Ah4M.js";import{_ as Se}from"./index-BneSV3ha.js";import{c as pt,_ as A}from"./index-CgLP59YT.js";import{_ as re,a as oe}from"./CardContent.vue_vue_type_script_setup_true_lang-BzdaijRh.js";import{_ as ne,a as ie}from"./CardTitle.vue_vue_type_script_setup_true_lang-DzsLSsD4.js";import{a as Wt}from"./ScrollArea.vue_vue_type_script_setup_true_lang-DxrIk156.js";import{_ as qe}from"./Separator.vue_vue_type_script_setup_true_lang-BbDFp8uv.js";import{a as Y,b as Z,_ as ee}from"./TooltipTrigger.vue_vue_type_script_setup_true_lang-CppFsSbV.js";import{_ as dr}from"./WordBalanceDisplay.vue_vue_type_script_setup_true_lang-CSNTrGY4.js";import{a as Nt,_ as It}from"./AppLayout.vue_vue_type_script_setup_true_lang-LpAZ_Ivm.js";import{A as ur}from"./driver-B4w0q6_T.js";import{t as z}from"./index-BuZzZ-m6.js";import{_ as cr}from"./PurchaseModal.vue_vue_type_script_setup_true_lang-BW5gK56Z.js";import{r as pr,u as gr}from"./useWordBalance-CHUQ8TYa.js";import{a as fr,u as mr,b as hr}from"./useChapterWordCount-Bmk7gU2e.js";import{t as Ot}from"./toNumber-DK1ozgOy.js";import{_ as vr}from"./Input.vue_vue_type_script_setup_true_lang-DGnGMdUc.js";import{_ as br}from"./Label.vue_vue_type_script_setup_true_lang-CPKGhh_h.js";import{aA as xr,aB as wr,aC as yr,aD as _r,aE as kr,aF as Cr,aG as Sr,aH as Er,aI as Tr,aJ as $r,aK as Ar,aL as Dr,aM as jr,aN as Mr,aa as os,au as Lr,at as Pr}from"./RichTextEditor-BIEhWIVu.js";import{_ as gt}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{E as ns}from"./eye-Bde_bS5a.js";import{S as ct}from"./save-BsH-Zzp8.js";import{C as Ye}from"./circle-check-big-BwJDm6ET.js";import{_ as Ht,a as qt,b as Bt}from"./CollapsibleTrigger.vue_vue_type_script_setup_true_lang-BfNSLsfH.js";import{_ as Rr}from"./Progress.vue_vue_type_script_setup_true_lang-DGihA61_.js";import{W as Fr,b as zr,u as Wr,M as Gt,_ as it,a as Nr,P as Ir}from"./useTextHistory-DpIjHyY7.js";import{B as Be}from"./brain-HetR7HlD.js";import{Z as Or}from"./zap-BXHG9EEh.js";import{C as Ut}from"./chevron-down-BrxS-JnU.js";import{P as Qt}from"./pen-tool-lg2Mk-gM.js";import{R as Hr}from"./refresh-cw-BqYKjBR_.js";import{C as qr}from"./DropdownMenuTrigger.vue_vue_type_script_setup_true_lang-BLfEqrc4.js";import{S as Br}from"./sparkles-BzcWNUl2.js";import{T as Gr}from"./type-CbQuT-jz.js";import{A as dt}from"./arrow-left-DKn8VAIi.js";import{M as Kt}from"./menu-CaNx-ax8.js";import{M as Vt}from"./message-square-Be8-CeED.js";import{M as Xt}from"./minimize-2-ep2zGLJT.js";import{M as Jt,S as Yt}from"./sun-BjLx__jj.js";import{S as Zt}from"./search-DeJ4_h6v.js";import{a as Ur,P as Qr}from"./AlertDialogTitle.vue_vue_type_script_setup_true_lang-B2ZKqQHJ.js";import{C as Kr}from"./circle-help-DLby68lj.js";var ut=function(){return sr.Date.now()},Vr="Expected a function",Xr=Math.max,Jr=Math.min;function Yr(x,y,l){var $,P,n,C,g,k,d=0,_=!1,u=!1,h=!0;if(typeof x!="function")throw new TypeError(Vr);y=Ot(y)||0,rr(l)&&(_=!!l.leading,u="maxWait"in l,n=u?Xr(Ot(l.maxWait)||0,y):n,h="trailing"in l?!!l.trailing:h);function c(D){var T=$,O=P;return $=P=void 0,d=D,C=x.apply(O,T),C}function f(D){return d=D,g=setTimeout(L,y),_?c(D):C}function W(D){var T=D-k,O=D-d,B=y-T;return u?Jr(B,n-O):B}function F(D){var T=D-k,O=D-d;return k===void 0||T>=y||T<0||u&&O>=n}function L(){var D=ut();if(F(D))return w(D);g=setTimeout(L,W(D))}function w(D){return g=void 0,h&&$?c(D):($=P=void 0,C)}function i(){g!==void 0&&clearTimeout(g),d=0,$=k=P=g=void 0}function m(){return g===void 0?C:w(ut())}function H(){var D=ut(),T=F(D);if($=arguments,P=this,k=D,T){if(g===void 0)return f(k);if(u)return clearTimeout(g),g=setTimeout(L,y),c(k)}return g===void 0&&(g=setTimeout(L,y)),C}return H.cancel=i,H.flush=m,H}/**
 * @license lucide-vue-next v0.468.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const as=pt("BookCheckIcon",[["path",{d:"M4 19.5v-15A2.5 2.5 0 0 1 6.5 2H19a1 1 0 0 1 1 1v18a1 1 0 0 1-1 1H6.5a1 1 0 0 1 0-5H20",key:"k3hazp"}],["path",{d:"m9 9.5 2 2 4-4",key:"1dth82"}]]);/**
 * @license lucide-vue-next v0.468.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Zr=pt("PenIcon",[["path",{d:"M21.174 6.812a1 1 0 0 0-3.986-3.987L3.842 16.174a2 2 0 0 0-.5.83l-1.321 4.352a.5.5 0 0 0 .623.622l4.353-1.32a2 2 0 0 0 .83-.497z",key:"1a8usu"}]]);/**
 * @license lucide-vue-next v0.468.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const eo=pt("Undo2Icon",[["path",{d:"M9 14 4 9l5-5",key:"102s5s"}],["path",{d:"M4 9h10.5a5.5 5.5 0 0 1 5.5 5.5a5.5 5.5 0 0 1-5.5 5.5H11",key:"f3b9sd"}]]);function to(x){const y=ss();ae(()=>y.props?.flash,Q=>{Q&&(Q.success&&z.success(Q.success),Q.error&&z.error(Q.error))},{deep:!0,immediate:!0});const l=E(x.chapter.title||""),$=E(x.chapter.content||""),P=E(!0),{isDark:n,toggle:C}=rs(),g=R(()=>n.value),k=()=>{},d=()=>{C()},_=E(!1),u=E(!1),h=E(!1),c=E("write"),f=E(""),W=E(0),F=E(!1),L=E(!1),w=E(!0),i=()=>{try{return localStorage.getItem(`chatMode_${x.project.id}_${x.chapter.chapter_number}`)==="true"}catch(Q){return console.warn("Failed to load chat mode from localStorage:",Q),!1}},m=Q=>{try{localStorage.setItem(`chatMode_${x.project.id}_${x.chapter.chapter_number}`,String(Q))}catch(ce){console.warn("Failed to save chat mode to localStorage:",ce)}},H=E(!1),D=E(!1),T=E(!1),O=E(!1),B=E(!1),U=E(!0),ue=E(!0);return{chapterTitle:l,chapterContent:$,showPreview:P,isEditorDark:g,initChapterTheme:k,toggleChapterTheme:d,isNativeFullscreen:_,showAISidebar:u,showStatistics:h,activeTab:c,selectedText:f,cursorPosition:W,showChatMode:F,showCitationMode:L,showDefensePrep:w,loadChatModeFromStorage:i,saveChatModeToStorage:m,showLeftSidebar:H,showRightSidebar:D,isMobile:T,isLeftSidebarCollapsed:O,isRightSidebarCollapsed:B,showLeftSidebarInFullscreen:U,showRightSidebarInFullscreen:ue}}function so({props:x,allChapters:y,targetWordCount:l,estimates:$,ensureBalance:P,save:n}){return{generateNextChapter:async()=>{const g=$.chapter(l.value||0);if(!P(g,"generate the next chapter with AI"))return;await n();const k=y.map(u=>u.chapter_number).sort((u,h)=>u-h),d=k.indexOf(x.chapter.chapter_number);let _;if(d===-1||d===k.length-1)_=Math.max(...k)+1;else{const u=k[d+1];u===x.chapter.chapter_number+1?_=u:_=x.chapter.chapter_number+1}try{const u=V("chapters.write",{project:x.project.slug,chapter:_}),h=new URL(u,window.location.origin);h.searchParams.set("ai_generate","true"),h.searchParams.set("generation_type","progressive"),se.visit(h.toString())}catch(u){console.error("âŒ Error generating next chapter:",u)}}}}function ro(x,y,l,$){const n=E(!1),C=E(0),g=E(!1),k=T=>{if(!T)return 0;const B=T.replace(/<[^>]*>/g,"").trim().replace(/\s+/g," ");if(!B)return 0;const U=B.match(/\b\w+\b/g);return U?U.length:0},d=R(()=>k(l.value)),_=R(()=>d.value>=800),u=()=>`defense_generation_triggered_${x.id}_ch_${y.chapter_number}`,h=()=>{const T=u();return localStorage.getItem(T)==="true"},c=()=>{const T=u();localStorage.setItem(T,"true"),n.value=!0},f=()=>{const T=u();localStorage.removeItem(T),n.value=!1,console.log(`ðŸ”„ DEFENSE WATCHER: Reset generation trigger for Chapter ${y.chapter_number}`)},W=Yr(async()=>{if(!g.value)return;const T=d.value;console.log(`ðŸ“Š DEFENSE WATCHER: Word count check - Chapter ${y.chapter_number}: ${T} words`),T<800*.8&&n.value&&(console.log("â¬‡ï¸ DEFENSE WATCHER: Content dropped below 80% of threshold, resetting trigger"),f()),C.value=T},2e3),F=()=>g.value?void 0:(g.value=!0,n.value=h(),C.value=d.value,console.log(`ðŸ‘€ DEFENSE WATCHER: Started watching Chapter ${y.chapter_number}`),console.log(`   Initial word count: ${C.value}`),console.log(`   Generation already triggered: ${n.value}`),console.log("   Threshold: 800 words"),ae(l,(O,B)=>{O!==B&&W()},{immediate:!1})),L=()=>{g.value=!1,W.cancel(),console.log(`ðŸ›‘ DEFENSE WATCHER: Stopped watching Chapter ${y.chapter_number}`)},w=async()=>{console.log(`ðŸ” DEFENSE WATCHER: Force checking Chapter ${y.chapter_number}`),await W(),W.flush()},i=R(()=>{const T=d.value;return T>0&&T<800&&!n.value}),m=R(()=>{const T=d.value/800*100;return Math.min(T,100)}),H=R(()=>{const T=800-d.value;return Math.max(T,0)});return{isWatching:g,hasTriggeredGeneration:n,currentWordCount:d,lastWordCount:C,meetsThreshold:_,shouldShowProgressIndicator:i,progressPercentage:m,wordsRemaining:H,startWatching:F,stopWatching:L,forceCheck:w,resetGenerationTrigger:f,markGenerationTriggered:c,getStatusMessage:()=>{const T=d.value;return n.value?`Defense questions available (${T} words)`:T>=800?`Ready for defense questions (${T} words)`:T>0?`${800-T} more words needed for defense questions`:"Start writing to enable defense questions (800 words needed)"},countWords:k,DEFENSE_WORD_COUNT_THRESHOLD:800}}function oo({props:x,chapterContent:y,currentWordCount:l,ensureBalance:$,estimates:P}){const n=E([]),C=E(!1),g=E(!1),k=E(null),d=E(!1),_=R(()=>x.chapter),{hasTriggeredGeneration:u,startWatching:h,stopWatching:c,forceCheck:f,getStatusMessage:W,markGenerationTriggered:F,meetsThreshold:L,shouldShowProgressIndicator:w,progressPercentage:i,wordsRemaining:m,DEFENSE_WORD_COUNT_THRESHOLD:H}=ro(x.project,x.chapter,y),D=(M,N)=>`defense_auto_generate_${M}_ch_${N}`,T=()=>{try{return localStorage.getItem(D(x.project.id,x.chapter.chapter_number))==="true"}catch(M){return console.warn("Failed to load defense auto-generation preference:",M),!1}},O=M=>{try{localStorage.setItem(D(x.project.id,x.chapter.chapter_number),String(M))}catch(N){console.warn("Failed to save defense auto-generation preference:",N)}};d.value=T();const B=()=>{if(!n.value.length||!k.value)return!0;const M=new Date(Date.now()-360*60*1e3);return k.value<M},U=async(M=!1,N={})=>{if(C.value)return;const G=N.skipGeneration??!0;C.value=!0;try{console.log("Loading defense questions with params:",{project_id:x.project.id,chapter_number:_.value?.chapter_number,limit:5,force_refresh:M,skip_generation:G});const j=await de.get(`/api/projects/${x.project.id}/defense/questions`,{params:{chapter_number:_.value?.chapter_number||null,limit:5,force_refresh:M?1:0,skip_generation:G?1:0},headers:{Accept:"application/json","X-Requested-With":"XMLHttpRequest"}});if(console.log("Defense questions loaded:",j.data),n.value=j.data.questions||[],k.value=new Date,j.data.questions&&j.data.questions.length>0){const J=`defense_questions_${x.project.id}_chapter_${_.value?.chapter_number}`;localStorage.setItem(J,JSON.stringify({questions:j.data.questions,chapter_number:_.value?.chapter_number,loaded_at:new Date().toISOString()}))}else M||(console.log("No existing questions found for this chapter"),console.log(`Current word count: ${l.value}/${H}`),console.log('User must click "Generate Questions" button to create defense questions'))}catch(j){if(console.error("Failed to load defense questions:",j),j.response)if(console.error("Response status:",j.response.status),console.error("Response data:",j.response.data),j.response.status===422){const J=Object.values(j.response.data.errors||{})[0];J&&Array.isArray(J)?z.error(`Validation Error: ${J[0]}`):z.error("Invalid request parameters. Please refresh the page.")}else j.response.status===500?z.error("Server error. Please try again later."):z.error("Failed to load defense questions");else j.request?(console.error("No response received:",j.request),z.error("Network error. Please check your connection.")):(console.error("Error setting up request:",j.message),z.error("An unexpected error occurred"));n.value=[]}finally{C.value=!1}},ue=M=>M?M.replace(/<[^>]*>/g," ").trim().split(/\s+/).filter(N=>N.length>0).length:0,Q=async(M={})=>{if(g.value)return;const N=M.autoTriggered??!1,G=P.defense();if($(G,"generate defense questions")){g.value=!0;try{const j=await de.post(`/api/projects/${x.project.id}/defense/questions/generate`,{chapter_number:_.value.chapter_number},{headers:{"X-CSRF-TOKEN":document.querySelector('meta[name="csrf-token"]')?.getAttribute("content"),Accept:"application/json","Content-Type":"application/json"}});if(j.data&&j.data.questions){n.value=j.data.questions,k.value=new Date;const J=j.data.questions.reduce((Pe,Re)=>{const Ze=ue(Re.question),et=ue(Re.suggested_answer),Fe=(Re.key_points||[]).reduce((ze,tt)=>ze+ue(tt),0);return Pe+Ze+et+Fe},0),Te=`defense_questions_${x.project.id}_chapter_${_.value?.chapter_number}`;localStorage.setItem(Te,JSON.stringify({questions:j.data.questions,chapter_number:_.value?.chapter_number,loaded_at:new Date().toISOString()})),z.success(`Generated ${j.data.questions.length} new questions`),pr(J||P.defense(),"Defense questions","chapter",x.chapter.id).catch(Pe=>console.error("Failed to record word usage (defense):",Pe)),u.value=!0,F(),N&&console.log("Auto-generated defense questions after meeting threshold.")}}catch(j){console.error("Failed to generate defense questions:",j),z.error("Failed to generate defense questions")}finally{g.value=!1}}},ce=async()=>{!d.value||g.value||C.value||u.value||!L.value||n.value.length>0||await Q({autoTriggered:!0})},Qe=M=>{d.value=M,O(M),M&&ce()},je=async(M,N)=>{try{await de.patch(`/api/projects/${x.project.id}/defense/questions/${M}`,{user_marked_helpful:N},{headers:{"X-CSRF-TOKEN":document.querySelector('meta[name="csrf-token"]')?.getAttribute("content"),Accept:"application/json","Content-Type":"application/json"}});const G=n.value.find(j=>j.id===M);G&&(G.user_marked_helpful=N),z.success(N?"Question marked as helpful":"Removed helpful mark")}catch(G){console.error("Failed to mark question:",G),z.error("Failed to update question")}},Me=async M=>{try{await de.delete(`/api/projects/${x.project.id}/defense/questions/${M}`,{headers:{"X-CSRF-TOKEN":document.querySelector('meta[name="csrf-token"]')?.getAttribute("content"),Accept:"application/json"}}),n.value=n.value.filter(N=>N.id!==M),localStorage.setItem(`defense_questions_${x.project.id}`,JSON.stringify({questions:n.value,loaded_at:new Date().toISOString()})),z.success("Question hidden")}catch(N){console.error("Failed to hide question:",N),z.error("Failed to hide question")}},Le=async()=>{const M=`defense_questions_${x.project.id}_chapter_${_.value?.chapter_number}`,N=localStorage.getItem(M);let G=!0;if(N){const j=JSON.parse(N),J=new Date(j.loaded_at),Te=new Date(Date.now()-360*60*1e3);J>Te&&j.chapter_number===_.value?.chapter_number&&(n.value=j.questions,k.value=J,G=!1)}G&&await U(!1,{skipGeneration:!0})};return ae(()=>x.chapter,async()=>{n.value=[],c(),h(),d.value=T(),await U(!1,{skipGeneration:!0}),await $e(()=>{f(),ce()})},{immediate:!1}),ae([l,d],()=>{ce()}),Ce(async()=>{await Le(),h(),await $e(()=>{f(),ce()})}),{defenseQuestions:n,isLoadingDefenseQuestions:C,isGeneratingDefenseQuestions:g,autoGenerateDefense:d,shouldLoadDefenseQuestions:B,loadDefenseQuestions:U,generateNewDefenseQuestions:Q,markQuestionHelpful:je,hideQuestion:Me,handleDefenseAutoToggle:Qe,attemptAutoGenerateDefense:ce,getDefenseStatusMessage:W,shouldShowDefenseProgress:w,defenseProgressPercentage:i,defenseWordsRemaining:m,hasTriggeredGeneration:u,meetsDefenseThreshold:L}}const no={class:"bg-background"},ao=Ue({__name:"RichTextViewer",props:{content:{},showFontControls:{type:Boolean,default:!0}},setup(x){const y=xr(Mr),l=x,$=d=>d?(d=d.replace(/```mermaid\n?([\s\S]*?)```/g,(_,u)=>{const h=u.trim();return`<div data-mermaid data-mermaid-code="${h.replace(/&/g,"&amp;").replace(/"/g,"&quot;").replace(/</g,"&lt;").replace(/>/g,"&gt;")}" data-view-mode="diagram"><pre><code class="language-mermaid">${h}</code></pre></div>`}),d=d.replace(/``mermaid\n?([\s\S]*?)``/g,(_,u)=>{const h=u.trim();return`<div data-mermaid data-mermaid-code="${h.replace(/&/g,"&amp;").replace(/"/g,"&quot;").replace(/</g,"&lt;").replace(/>/g,"&gt;")}" data-view-mode="diagram"><pre><code class="language-mermaid">${h}</code></pre></div>`}),d=d.replace(/`mermaid\n([\s\S]*?)`/g,(_,u)=>{const h=u.trim();return`<div data-mermaid data-mermaid-code="${h.replace(/&/g,"&amp;").replace(/"/g,"&quot;").replace(/</g,"&lt;").replace(/>/g,"&gt;")}" data-view-mode="diagram"><pre><code class="language-mermaid">${h}</code></pre></div>`}),d):"",P=d=>d?(d=d.replace(/```(\w+)\n?([\s\S]*?)```/g,(_,u,h)=>`<pre><code class="language-${u}">${h.trim()}</code></pre>`),d=d.replace(/```\n?([\s\S]*?)```/g,(_,u)=>`<pre><code>${u.trim()}</code></pre>`),d):"",n=d=>{if(!d)return"";const _=d.split(`
`);let u=[],h=0;for(;h<_.length;){const c=_[h];if(c.includes("|")){const f=C(_,h);if(f.html){u.push(f.html),h=f.nextIndex;continue}}u.push(c),h++}return u.join(`
`)},C=(d,_)=>{let u=d[_];if(!u||!u.includes("|"))return{html:null,nextIndex:_+1};const h=u.split("|").map(L=>L.trim()).filter(L=>L.length>0);if(h.length===0)return{html:null,nextIndex:_+1};const c=d[_+1];if(!c||!c.includes("|")||!c.includes("-"))return{html:null,nextIndex:_+1};let f=[],W=_+2;for(;W<d.length;){const L=d[W];if(!L||!L.includes("|"))break;const w=L.split("|").map(i=>i.trim()).filter(i=>i.length>0);w.length>0&&f.push(w),W++}let F='<div class="tableWrapper"><table>';return F+="<thead><tr>",h.forEach(L=>{F+=`<th>${L}</th>`}),F+="</tr></thead>",f.length>0&&(F+="<tbody>",f.forEach(L=>{F+="<tr>";for(let w=0;w<h.length;w++){const i=L[w]||"";F+=`<td>${i}</td>`}F+="</tr>"}),F+="</tbody>"),F+="</table></div>",{html:F,nextIndex:W}},g=d=>{if(!d)return"";if(d.includes("<p>")||d.includes("<h1>")||d.includes("<h2>")||d.includes("<div>")){let c=$(d);return c=P(c),c}let u=d;return u=$(u),u=P(u),u=u.replace(/^#### (.*$)/gim,"<h4>$1</h4>"),u=u.replace(/^### (.*$)/gim,"<h3>$1</h3>"),u=u.replace(/^## (.*$)/gim,"<h2>$1</h2>"),u=u.replace(/^# (.*$)/gim,"<h1>$1</h1>"),u=u.replace(/\*\*(.*?)\*\*/g,"<strong>$1</strong>"),u=u.replace(new RegExp("(?<!\\*)\\*([^*\\n]+?)\\*(?!\\*)","g"),"<em>$1</em>"),u=u.replace(/`([^`]+)`/g,"<code>$1</code>"),u=n(u),u.split(/\n\s*\n/).filter(c=>c.trim()).map(c=>{const f=c.trim();if(f.startsWith("<h1>")||f.startsWith("<h2>")||f.startsWith("<h3>")||f.startsWith("<h4>"))return f;if(f.includes(`
`)){const F=f.split(`
`).map(i=>i.trim()).filter(i=>i),L=F.some(i=>i.match(/^\d+\.\s/)),w=F.some(i=>i.match(/^[-*]\s/));if(L||w){const i=F.map(D=>D.match(/^\d+\.\s/)?`<li>${D.replace(/^\d+\.\s/,"")}</li>`:D.match(/^[-*]\s/)?`<li>${D.replace(/^[-*]\s/,"")}</li>`:D);let m=[],H="";for(const D of i)D.startsWith("<li>")?(H&&m.push(H),H=D):H&&(H=H.replace("</li>",` ${D}</li>`));return H&&m.push(H),L?`<ol>${m.join("")}</ol>`:`<ul>${m.join("")}</ul>`}}return`<p>${f.replace(/\n/g,"<br>")}</p>`}).join("")},k=wr({content:g(l.content),editable:!1,extensions:[yr.configure({heading:{levels:[1,2,3]},codeBlock:!1}),_r.configure({lowlight:y,HTMLAttributes:{class:"code-block-highlighted"}}),kr,Cr,Sr,Er.configure({resizable:!0}),Tr,$r,Ar,Dr],editorProps:{attributes:{class:"prose prose-sm dark:prose-invert max-w-none focus:outline-none"}}});return E("12"),Ce(()=>{setTimeout(()=>{k.value&&k.value.chain().selectAll().setFontSize("12pt").run()},100)}),ae(()=>l.content,d=>{if(k.value&&k.value.getHTML()!==d){const _=g(d);k.value.commands.setContent(_)}}),or(()=>{k.value&&k.value.destroy()}),(d,_)=>(S(),q("div",no,[r(e(jr),{editor:e(k)},null,8,["editor"])]))}}),ls=gt(ao,[["__scopeId","data-v-87fd46f8"]]),lo={class:"flex items-center justify-between"},io={class:"space-y-1 w-full max-w-[520px]"},uo={class:"flex items-center justify-between gap-3"},co={class:"flex flex-col"},po={class:"flex items-center gap-2"},go={class:"flex items-center justify-between px-6 py-2 border-b border-border/30 bg-muted/5"},fo={class:"flex items-center gap-2"},mo={class:"space-y-1 relative z-10"},ho={class:"text-sm font-medium text-foreground"},vo={class:"text-[10px] text-muted-foreground line-clamp-2 leading-relaxed"},bo={class:"flex-1 relative bg-background"},xo={class:"px-12 py-10 min-h-[500px]"},wo={class:"sticky bottom-0 z-10 border-t border-border/30 bg-background/80 backdrop-blur-md p-4 flex items-center justify-between"},yo={class:"text-xs text-muted-foreground"},_o={class:"flex items-center gap-2"},es=Ue({__name:"ChapterEditorPaperCard",props:{context:{}},setup(x){const l=x.context,$=R(()=>{const C=l.getSectionInfo(l.nextSection);return l.aiChapterAnalysis?.section||C}),P=R(()=>$.value?.name||""),n=R(()=>$.value?.description||"");return(C,g)=>(S(),I(e(re),{class:"w-full max-w-[850px] min-h-[calc(100vh-180px)] flex flex-col bg-background shadow-xl shadow-black/5 ring-1 ring-black/5 dark:ring-white/10 rounded-xl overflow-hidden transition-all duration-300"},{default:o(()=>[r(e(ne),{class:"flex-shrink-0 border-b border-border/30 px-8 py-6 bg-background/50 backdrop-blur-sm sticky top-0 z-10"},{default:o(()=>[s("div",lo,[s("div",io,[s("div",uo,[s("div",co,[r(e(br),{for:"chapter-title",class:"text-xs font-medium text-zinc-500 dark:text-zinc-400 uppercase tracking-wider"},{default:o(()=>[...g[3]||(g[3]=[p("Chapter Title",-1)])]),_:1}),r(e(vr),{id:"chapter-title",modelValue:e(l).chapterTitle,"onUpdate:modelValue":g[0]||(g[0]=k=>e(l).chapterTitle=k),placeholder:"Enter chapter title...",class:"h-auto p-0 border-0 bg-transparent text-2xl font-bold placeholder:text-muted-foreground/40 focus-visible:ring-0 px-0 text-foreground"},null,8,["modelValue"])]),s("div",po,[r(e(Se),{variant:e(l).chapter.status==="approved"?"default":"secondary",class:"rounded-full px-3"},{default:o(()=>[p(b(e(l).chapter.status.replace("_"," ")),1)]),_:1},8,["variant"]),r(e(Se),{variant:"outline",class:Ge(["rounded-full px-3 transition-colors",{"text-green-600 border-green-200 bg-green-50 dark:bg-green-900/20 dark:border-green-800":(e(l).latestAnalysis?.total_score||0)>=80,"text-yellow-600 border-yellow-200 bg-yellow-50 dark:bg-yellow-900/20 dark:border-yellow-800":(e(l).latestAnalysis?.total_score||0)>=70&&(e(l).latestAnalysis?.total_score||0)<80,"text-orange-600 border-orange-200 bg-orange-50 dark:bg-orange-900/20 dark:border-orange-800":(e(l).latestAnalysis?.total_score||0)>=60&&(e(l).latestAnalysis?.total_score||0)<70,"text-red-600 border-red-200 bg-red-50 dark:bg-red-900/20 dark:border-red-800":(e(l).latestAnalysis?.total_score||0)<60}])},{default:o(()=>[p(b(e(l).latestAnalysis?.total_score?Math.round(e(l).latestAnalysis.total_score):e(l).writingQualityScore)+"% Quality ",1)]),_:1},8,["class"])])])])])]),_:1}),r(e(oe),{class:"flex min-h-0 flex-1 flex-col p-0"},{default:o(()=>[s("div",go,[s("div",fo,[r(e(A),{onClick:e(l).togglePresentationMode,variant:e(l).showPresentationMode?"default":"ghost",size:"sm",class:"h-7 text-xs rounded-full text-zinc-700 dark:text-zinc-300 hover:text-foreground"},{default:o(()=>[r(e(ns),{class:"mr-1.5 h-3.5 w-3.5"}),p(" "+b(e(l).showPresentationMode?"Edit":"Preview"),1)]),_:1},8,["onClick","variant"])]),s("div",mo,[s("div",ho,b(P.value),1),s("div",vo,b(n.value),1)])]),s("div",bo,[Ee(r(os,{modelValue:e(l).chapterContent,"onUpdate:modelValue":g[1]||(g[1]=k=>e(l).chapterContent=k),placeholder:"Start writing your chapter...","min-height":"500px",class:"min-h-[500px] px-8 py-6",ref:e(l).richTextEditor,"show-toolbar":!0,"streaming-mode":e(l).isStreamingMode,"is-generating":e(l).isGenerating,"generation-progress":e(l).generationProgress,"generation-percentage":e(l).generationPercentage,"generation-phase":e(l).generationPhase,"onUpdate:selectedText":e(l).setSelectedText},null,8,["modelValue","streaming-mode","is-generating","generation-progress","generation-percentage","generation-phase","onUpdate:selectedText"]),[[Ae,!e(l).showPresentationMode]]),Ee(s("div",xo,[r(ls,{content:e(l).chapterContent,"show-font-controls":!1,class:"prose-lg mx-auto",style:{"font-family":"'Times New Roman', serif","line-height":"1.8"}},null,8,["content"])],512),[[Ae,e(l).showPresentationMode]])])]),_:1}),s("div",wo,[s("div",yo,b(e(l).isSaving?"Saving...":"All changes saved"),1),s("div",_o,[r(e(A),{onClick:g[2]||(g[2]=()=>e(l).save(!1)),disabled:!e(l).isValid||e(l).isSaving,size:"sm",variant:"ghost",class:"h-8 rounded-full text-zinc-700 dark:text-zinc-300 hover:text-foreground"},{default:o(()=>[r(e(ct),{class:"mr-2 h-3.5 w-3.5"}),g[4]||(g[4]=p(" Save Draft ",-1))]),_:1},8,["disabled"]),r(e(A),{onClick:e(l).goToBulkAnalysis,variant:"outline",size:"sm",class:"h-8 rounded-full"},{default:o(()=>[r(e(as),{class:"mr-2 h-3.5 w-3.5"}),g[5]||(g[5]=p(" Run Bulk Analysis ",-1))]),_:1},8,["onClick"]),r(e(A),{onClick:e(l).markAsComplete,disabled:e(l).isSaving,size:"sm",class:"h-8 rounded-full bg-gradient-to-r from-primary to-primary/90 shadow-sm hover:shadow-md transition-all"},{default:o(()=>[r(e(Ye),{class:"mr-2 h-3.5 w-3.5"}),g[6]||(g[6]=p(" Complete ",-1))]),_:1},8,["onClick","disabled"])])])]),_:1}))}}),ko={class:"flex flex-col gap-4 p-1"},Co={class:"p-1.5 rounded-lg bg-primary/10 text-primary"},So={class:"flex items-center gap-2"},Eo={class:"space-y-3"},To={key:0,class:"space-y-2"},$o={class:"flex items-center justify-between w-full relative z-10"},Ao={class:"flex items-center gap-2 text-primary"},Do={class:"space-y-1 relative z-10"},jo={class:"text-sm font-medium text-foreground"},Mo={class:"text-[10px] text-muted-foreground line-clamp-2 leading-relaxed"},Lo={key:0,class:"p-4 rounded-xl bg-green-500/10 border border-green-500/20 space-y-3"},Po={class:"flex items-center gap-2 text-green-600 dark:text-green-400"},Ro={class:"space-y-2"},Fo={class:"flex justify-between text-[10px] font-medium text-muted-foreground"},zo={class:"grid grid-cols-2 gap-2 mt-2"},Wo={class:"p-1.5 rounded-full bg-blue-500/10 text-blue-500"},No={class:"p-1.5 rounded-full bg-purple-500/10 text-purple-500"},Io={class:"p-1.5 rounded-full bg-orange-500/10 text-orange-500"},Oo={class:"p-1.5 rounded-full bg-emerald-500/10 text-emerald-500"},Ho={class:"p-1.5 rounded-full bg-amber-500/10 text-amber-500"},qo={class:"flex items-center gap-2"},Bo={class:"p-1 rounded-xl bg-muted/30 border border-border/50"},Go=Ue({__name:"AISidebar",props:{project:{},chapter:{},isGenerating:{type:Boolean},selectedText:{},isLoadingSuggestions:{type:Boolean},showCitationHelper:{type:Boolean},chapterContent:{},cursorPosition:{},currentWordCount:{},targetWordCount:{},canUndo:{type:Boolean}},emits:["startStreamingGeneration","getAISuggestions","update:showCitationHelper","insert-citation","checkCitations","undoLastAction"],setup(x,{emit:y}){const l=x,$=y,P=E("Academic Formal"),n=E(null),C=E(!1),g=E({expand:!1,improve:!1,rephrase:!1,cite:!1,"generate-full":!1,"generate-section":!1,custom:!1}),k=R(()=>!!l.chapter?.id&&!!l.chapter?.chapter_number),d=R(()=>l.chapterContent&&l.chapterContent.trim().length>0);R(()=>!d.value&&k.value),R(()=>!n.value&&k.value);const _=R(()=>!l.isGenerating&&!!l.chapterContent);R(()=>!l.isLoadingSuggestions&&!!l.selectedText);const u=R(()=>n.value&&n.value.section.name!=="NONE"?n.value.section.name.toLowerCase().replace(/\s+/g,"_"):W()),h=R(()=>!l.isGenerating&&!!l.chapter?.id),c=()=>[{id:"introduction",name:"Introduction",description:"Overview and objectives of this chapter"},{id:"content",name:"Main Content",description:"Chapter main content"},{id:"conclusion",name:"Conclusion",description:"Summary and transition to next chapter"}],f=async(w,i)=>{if(Object.values(g.value).some(m=>m)){z("Please wait for the current action to complete");return}try{switch(w in g.value&&(g.value[w]=!0),w){case"expand":l.selectedText?($("startStreamingGeneration","expand",{selectedText:l.selectedText}),z("Expanding selected text...")):z.error("Please select text to expand");break;case"improve":$("startStreamingGeneration","improve"),z("Improving chapter content...");break;case"rephrase":l.selectedText?($("startStreamingGeneration","rephrase",{selectedText:l.selectedText,style:P.value}),z("Rephrasing selected text...")):z.error("Please select text to rephrase");break;case"cite":$("update:showCitationHelper",!0),z("Opening citation helper...");break;case"generate-full":$("startStreamingGeneration","progressive"),z("Generating complete chapter...");break;case"generate-section":const m=i?.section||u.value;$("startStreamingGeneration","section",{section:m,mode:"progressive"}),z(`Generating ${m} section...`);break;default:throw new Error(`Unknown action: ${w}`)}}catch(m){console.error(`Quick action '${w}' failed:`,m),z.error(`Failed to ${w.replace("-"," ")}. Please try again.`)}finally{setTimeout(()=>{w in g.value&&(g.value[w]=!1)},1e3)}},W=()=>{if(!d.value)return"introduction";const w=l.chapterContent.toLowerCase(),i=c();for(const m of i)if(![m.name.toLowerCase(),m.id.replace("_"," ")].some(T=>w.includes(T)))return m.id;return"conclusion"},F=w=>{const i=c();return i.find(m=>m.id===w)||i[0]},L=w=>{$("insert-citation",w)};return ae(()=>l.chapter,w=>{w?.id&&(n.value=null)},{immediate:!1}),ae(()=>l.chapterContent,w=>{n.value&&(!w||w.trim().length===0)&&(n.value=null)},{immediate:!1}),(w,i)=>(S(),q("div",ko,[r(e(re),{class:"border-none shadow-none bg-transparent"},{default:o(()=>[r(e(ne),{class:"px-2 py-3"},{default:o(()=>[r(e(ie),{class:"flex items-center gap-2 text-sm font-semibold text-foreground/80"},{default:o(()=>[s("div",Co,[r(e(Be),{class:"h-4 w-4"})]),i[9]||(i[9]=p(" AI Assistant ",-1))]),_:1})]),_:1}),r(e(oe),{class:"px-2 space-y-6"},{default:o(()=>[r(e(Ht),{open:!0,class:"space-y-2"},{default:o(()=>[r(e(qt),{class:"flex w-full items-center justify-between text-xs font-medium text-muted-foreground hover:text-foreground transition-colors group"},{default:o(()=>[s("span",So,[r(e(Or),{class:"h-3.5 w-3.5 text-amber-500/70 group-hover:text-amber-500 transition-colors"}),i[10]||(i[10]=p(" QUICK ACTIONS ",-1))]),r(e(Ut),{class:"h-3 w-3 transition-transform duration-200 group-data-[state=open]:rotate-180"})]),_:1}),r(e(Bt),{class:"space-y-3 pt-1"},{default:o(()=>[s("div",Eo,[r(De,{"enter-active-class":"transition-all duration-300 ease-out","enter-from-class":"opacity-0 scale-95 translate-y-1","enter-to-class":"opacity-100 scale-100 translate-y-0"},{default:o(()=>[n.value&&n.value.show_section_button?(S(),q("div",To,[r(e(A),{onClick:i[0]||(i[0]=m=>f("generate-section")),disabled:!h.value||C.value||w.isGenerating||g.value["generate-section"],variant:"outline",class:"w-full h-auto flex-col items-start gap-2 p-3 rounded-xl border-primary/20 bg-background/50 hover:bg-primary/5 hover:border-primary/40 transition-all duration-300 text-left group relative overflow-hidden"},{default:o(()=>[i[12]||(i[12]=s("div",{class:"absolute inset-0 bg-gradient-to-r from-primary/5 to-transparent opacity-0 group-hover:opacity-100 transition-opacity"},null,-1)),s("div",$o,[s("div",Ao,[r(e(Qt),{class:"h-3.5 w-3.5"}),i[11]||(i[11]=s("span",{class:"text-xs font-semibold"},"Write Next Section",-1))]),g.value["generate-section"]?(S(),I(e(Hr),{key:0,class:"h-3 w-3 animate-spin text-primary"})):X("",!0)]),s("div",Do,[s("div",jo,b(n.value?.section.name||F(u.value).name),1),s("div",Mo,b(n.value?.section.description||F(u.value).description),1)])]),_:1},8,["disabled"])])):X("",!0)]),_:1}),r(De,{"enter-active-class":"transition-all duration-300 ease-out","enter-from-class":"opacity-0 scale-95 translate-y-1","enter-to-class":"opacity-100 scale-100 translate-y-0"},{default:o(()=>[n.value&&n.value.show_full_chapter_button?(S(),I(e(A),{key:0,onClick:i[1]||(i[1]=m=>f("generate-full")),disabled:w.isGenerating||C.value||g.value["generate-full"],variant:"ghost",class:"w-full h-9 justify-start gap-2 px-3 rounded-lg text-xs text-muted-foreground hover:text-primary hover:bg-primary/5"},{default:o(()=>[r(e(Fr),{class:"h-3.5 w-3.5"}),i[13]||(i[13]=s("span",null,"Generate Complete Chapter",-1))]),_:1},8,["disabled"])):X("",!0)]),_:1}),r(De,{"enter-active-class":"transition-all duration-500 ease-out","enter-from-class":"opacity-0 scale-95 translate-y-2","enter-to-class":"opacity-100 scale-100 translate-y-0"},{default:o(()=>[n.value&&n.value.status==="COMPLETE"?(S(),q("div",Lo,[s("div",Po,[r(e(qr),{class:"h-4 w-4"}),i[14]||(i[14]=s("span",{class:"text-sm font-semibold"},"Chapter Complete",-1))]),s("div",Ro,[s("div",Fo,[i[15]||(i[15]=s("span",null,"Progress",-1)),s("span",null,b(n.value.completion_percentage)+"%",1)]),r(e(Rr),{"model-value":n.value.completion_percentage,class:"h-1.5"},null,8,["model-value"])])])):X("",!0)]),_:1})]),s("div",zo,[r(e(A),{onClick:i[2]||(i[2]=m=>f("improve")),disabled:!_.value||w.isGenerating||g.value.improve,variant:"outline",class:"h-20 flex-col gap-2 rounded-xl border-border/50 bg-background/50 hover:bg-accent hover:border-accent transition-all duration-300"},{default:o(()=>[s("div",Wo,[r(e(Br),{class:"h-4 w-4"})]),i[16]||(i[16]=s("span",{class:"text-xs font-medium"},"Improve",-1))]),_:1},8,["disabled"]),r(e(A),{onClick:i[3]||(i[3]=m=>f("expand")),disabled:!w.selectedText||w.isGenerating||g.value.expand,variant:"outline",class:"h-20 flex-col gap-2 rounded-xl border-border/50 bg-background/50 hover:bg-accent hover:border-accent transition-all duration-300"},{default:o(()=>[s("div",No,[r(e(Lr),{class:"h-4 w-4"})]),i[17]||(i[17]=s("span",{class:"text-xs font-medium"},"Expand",-1))]),_:1},8,["disabled"]),r(e(A),{onClick:i[4]||(i[4]=m=>f("cite")),disabled:w.isGenerating||g.value.cite,variant:"outline",class:"h-20 flex-col gap-2 rounded-xl border-border/50 bg-background/50 hover:bg-accent hover:border-accent transition-all duration-300"},{default:o(()=>[s("div",Io,[r(e(Pr),{class:"h-4 w-4"})]),i[18]||(i[18]=s("span",{class:"text-xs font-medium"},"Cite",-1))]),_:1},8,["disabled"]),r(e(A),{onClick:i[5]||(i[5]=m=>f("rephrase")),disabled:!w.selectedText||w.isGenerating||g.value.rephrase,variant:"outline",class:"h-20 flex-col gap-2 rounded-xl border-border/50 bg-background/50 hover:bg-accent hover:border-accent transition-all duration-300"},{default:o(()=>[s("div",Oo,[r(e(Gr),{class:"h-4 w-4"})]),i[19]||(i[19]=s("span",{class:"text-xs font-medium"},"Rephrase",-1))]),_:1},8,["disabled"]),w.canUndo?(S(),I(e(A),{key:0,onClick:i[6]||(i[6]=m=>$("undoLastAction")),variant:"outline",class:"h-20 flex-col gap-2 rounded-xl border-border/50 bg-background/50 hover:bg-amber-500/10 hover:border-amber-500/30 transition-all duration-300 col-span-2"},{default:o(()=>[s("div",Ho,[r(e(eo),{class:"h-4 w-4"})]),i[20]||(i[20]=s("span",{class:"text-xs font-medium"},"Undo Last AI Change",-1))]),_:1})):X("",!0)])]),_:1})]),_:1}),r(e(qe),{class:"bg-border/50"}),r(e(Ht),{open:!0,class:"space-y-2"},{default:o(()=>[r(e(qt),{class:"flex w-full items-center justify-between text-xs font-medium text-muted-foreground hover:text-foreground transition-colors group"},{default:o(()=>[s("span",qo,[r(e(Qt),{class:"h-3.5 w-3.5 text-indigo-500/70 group-hover:text-indigo-500 transition-colors"}),i[21]||(i[21]=p(" WRITING STYLE ",-1))]),r(e(Ut),{class:"h-3 w-3 transition-transform duration-200 group-data-[state=open]:rotate-180"})]),_:1}),r(e(Bt),{class:"pt-1"},{default:o(()=>[s("div",Bo,[Ee(s("select",{"onUpdate:modelValue":i[7]||(i[7]=m=>P.value=m),class:"w-full bg-transparent border-none text-xs font-medium focus:ring-0 cursor-pointer py-1.5 px-2"},[...i[22]||(i[22]=[s("option",{value:"Academic Formal"},"Academic Formal",-1),s("option",{value:"Academic Casual"},"Academic Casual",-1),s("option",{value:"Technical"},"Technical",-1),s("option",{value:"Analytical"},"Analytical",-1),s("option",{value:"Research-Heavy"},"Research-Heavy",-1)])],512),[[nr,P.value]])])]),_:1})]),_:1})]),_:1})]),_:1}),r(zr,{"show-citation-helper":w.showCitationHelper,"chapter-content":w.chapterContent,"chapter-id":w.chapter?.id||0,"onUpdate:showCitationHelper":i[8]||(i[8]=m=>$("update:showCitationHelper",m)),onInsertCitation:L},null,8,["show-citation-helper","chapter-content","chapter-id"])]))}}),Uo=gt(Go,[["__scopeId","data-v-8c5c841d"]]),Qo={class:"h-14 flex items-center justify-between px-4 border-b border-border/40 shrink-0"},Ko={class:"flex-1 overflow-y-auto custom-scrollbar"},Vo={class:"p-4 space-y-6"},ts=Ue({__name:"ChapterEditorRightSidebar",props:{project:{},chapter:{},isGenerating:{type:Boolean},selectedText:{},isLoadingSuggestions:{type:Boolean},showCitationHelper:{type:Boolean},chapterContent:{},currentWordCount:{},targetWordCount:{},handleAIGeneration:{type:Function},getAISuggestions:{type:Function},updateCitationHelper:{type:Function},insertCitation:{type:Function},checkCitations:{type:Function},showDefensePrep:{type:Boolean},defenseQuestions:{},isLoadingDefenseQuestions:{type:Boolean},isGeneratingDefenseQuestions:{type:Boolean},chapterContext:{},defenseWatcher:{},autoGenerateDefense:{type:Boolean},handleDefensePanelToggle:{type:Function},generateNewDefenseQuestions:{type:Function},handleDefenseAutoToggle:{type:Function},refreshDefenseQuestions:{type:Function},markQuestionHelpful:{type:Function},hideQuestion:{type:Function},isCollapsed:{type:Boolean},containerClass:{}},setup(x){const y=x;return(l,$)=>Ee((S(),q("aside",{class:Ge(y.containerClass)},[s("div",Qo,[$[1]||($[1]=s("span",{class:"text-sm font-semibold tracking-tight text-foreground"},"Writing Assistant",-1)),r(e(ee),null,{default:o(()=>[r(e(Y),{asChild:""},{default:o(()=>[r(e(A),{variant:"ghost",size:"icon",class:"h-7 w-7"},{default:o(()=>[r(e(as),{class:"h-3.5 w-3.5"})]),_:1})]),_:1}),r(e(Z),null,{default:o(()=>[...$[0]||($[0]=[p("Manage Citations",-1)])]),_:1})]),_:1})]),s("div",Ko,[s("div",Vo,[r(Uo,{project:y.project,chapter:y.chapter,"is-generating":y.isGenerating,"selected-text":y.selectedText,"is-loading-suggestions":y.isLoadingSuggestions,"show-citation-helper":y.showCitationHelper,"chapter-content":y.chapterContent,"current-word-count":y.currentWordCount,"target-word-count":y.targetWordCount,onStartStreamingGeneration:y.handleAIGeneration,onGetAiSuggestions:y.getAISuggestions,"onUpdate:showCitationHelper":y.updateCitationHelper,onInsertCitation:y.insertCitation,onCheckCitations:y.checkCitations},null,8,["project","chapter","is-generating","selected-text","is-loading-suggestions","show-citation-helper","chapter-content","current-word-count","target-word-count","onStartStreamingGeneration","onGetAiSuggestions","onUpdate:showCitationHelper","onInsertCitation","onCheckCitations"])])])],2)),[[Ae,!y.isCollapsed]])}});function Xo(x){const y=E({sentences:0,paragraphs:0,readingTime:0,avgWordLength:0,uniqueWords:0,commonWords:[]}),l=R(()=>x.value?x.value.split(/\s+/).filter(n=>n.length>0).length:0),$=()=>{if(!x.value){y.value={sentences:0,paragraphs:0,readingTime:0,avgWordLength:0,uniqueWords:0,commonWords:[]};return}const n=x.value,C=n.split(/\s+/).filter(h=>h.length>0),g=n.split(/[.!?]+/).filter(h=>h.trim().length>0),k=n.split(`

`).filter(h=>h.trim().length>0),d=new Map;C.forEach(h=>{const c=h.toLowerCase().replace(/[^a-z0-9]/g,"");c&&d.set(c,(d.get(c)||0)+1)});const _=new Set(["the","a","an","and","or","but","in","on","at","to","for","of","with","by","is","was","are","were"]),u=Array.from(d.entries()).filter(([h])=>!_.has(h)).sort((h,c)=>c[1]-h[1]).slice(0,5).map(([h])=>h);y.value={sentences:g.length,paragraphs:k.length,readingTime:Math.ceil(C.length/200),avgWordLength:C.reduce((h,c)=>h+c.length,0)/C.length,uniqueWords:d.size,commonWords:u}},P=R(()=>{if(!x.value)return 0;let n=0;const C=x.value;C.includes("##")&&(n+=20),C.length>1e3&&(n+=20),C.match(/\[.*?\]/g)&&(n+=15),(C.includes("**")||C.includes("*"))&&(n+=10);const g=C.split(/[.!?]+/).filter(d=>d.trim().length>0);if(g.length>0){const d=g.reduce((_,u)=>_+u.split(/\s+/).length,0)/g.length;d>10&&d<25&&(n+=20)}return C.split(`

`).filter(d=>d.trim().length>0).length>3&&(n+=15),Math.min(n,100)});return{writingStats:y,currentWordCount:l,writingQualityScore:P,calculateWritingStats:$}}function Jo(x){const y=E(!1),l=E(null),$=E([]),P=E(null),n=R(()=>{if(!l.value?.quality_level)return"text-muted-foreground";switch(l.value.quality_level){case"Excellent":return"text-green-600";case"Good":return"text-blue-600";case"Satisfactory":return"text-yellow-600";case"Needs Improvement":return"text-orange-600";case"Poor":return"text-red-600";default:return"text-muted-foreground"}}),C=R(()=>l.value?.scores?Object.entries(l.value.scores).sort(([,c],[,f])=>c.percentage-f.percentage).slice(0,3).map(([c,f])=>({category:c.replace(" & "," & "),percentage:Math.round(f.percentage),score:f.score,max:f.max})):[]),g=async()=>{try{y.value=!0,P.value=null,await de.get("/sanctum/csrf-cookie");const c=await de.post(V("api.chapters.analysis.analyze",{chapter:x}));if(c.data.success)return l.value=c.data.analysis,c.data.analysis;throw new Error(c.data.error||"Analysis failed")}catch(c){return P.value=c.response?.data?.error||c.message||"Analysis failed",console.error("Chapter analysis failed:",c),null}finally{y.value=!1}};return{isAnalyzing:y,latestAnalysis:l,analysisHistory:$,error:P,qualityLevelColor:n,topImprovementAreas:C,analyzeChapter:g,getLatestAnalysis:async()=>{try{await de.get("/sanctum/csrf-cookie");const c=await de.get(V("api.chapters.analysis.latest",{chapter:x}));return c.data.success?(l.value=c.data.analysis,c.data.analysis):(l.value=null,null)}catch(c){return c.response?.status!==404&&(P.value=c.response?.data?.error||c.message||"Failed to get analysis",console.error("Failed to get latest analysis:",c)),null}},getAnalysisHistory:async()=>{try{await de.get("/sanctum/csrf-cookie");const c=await de.get(V("api.chapters.analysis.history",{chapter:x}));if(c.data.success)return $.value=c.data.analyses,c.data.analyses;throw new Error(c.data.error||"Failed to get history")}catch(c){return P.value=c.response?.data?.error||c.message||"Failed to get analysis history",console.error("Failed to get analysis history:",c),[]}},autoAnalyze:async(c,f=500)=>{c>=f&&await g()},getScoreColor:(c,f)=>{const W=c/f*100;return W>=80?"text-green-600":W>=70?"text-blue-600":W>=60?"text-yellow-600":W>=40?"text-orange-600":"text-red-600"},getProgressVariant:c=>c>=80?"success":c>=60?"default":"destructive"}}const Yo={key:0,class:"min-h-screen bg-background text-foreground"},Zo={class:"mx-auto max-w-5xl p-6"},en={class:"flex items-center justify-between gap-4"},tn={class:"flex items-center gap-3"},sn={class:"mt-6 grid gap-4"},rn={class:"flex flex-wrap gap-x-6 gap-y-1"},on={class:"grid gap-1"},nn={class:"grid gap-1"},an={class:"grid gap-4 md:grid-cols-3"},ln={class:"mx-auto w-full max-w-5xl p-6"},dn={class:"flex items-center justify-between gap-4"},un={class:"flex items-center gap-3"},cn={class:"mt-6 grid gap-4"},pn={class:"flex flex-wrap gap-x-6 gap-y-1"},gn={class:"grid gap-1"},fn={class:"grid gap-1"},mn={class:"grid gap-4 md:grid-cols-3"},hn={key:0,class:"rounded-xl border border-border bg-card p-4"},vn={key:2,class:"flex h-screen flex-col overflow-hidden bg-background dark:bg-background font-sans selection:bg-primary/20 transition-colors duration-300"},bn={class:"relative z-20 flex flex-shrink-0 items-center justify-between border-b border-border/40 bg-background/60 p-4 backdrop-blur-xl supports-[backdrop-filter]:bg-background/40 transition-all duration-300"},xn={class:"flex items-center gap-5"},wn={class:"flex flex-col"},yn={class:"text-lg font-bold tracking-tight text-foreground/90 font-display"},_n={class:"flex items-center gap-3 text-xs text-muted-foreground"},kn={class:"flex items-center gap-1.5"},Cn={class:"flex items-center gap-4"},Sn={class:"flex items-center p-1 rounded-full border border-border/40 bg-background/50 backdrop-blur-sm shadow-sm"},En={class:"flex items-center gap-2"},Tn={class:"relative z-20 h-[2px] w-full bg-border/20"},$n={key:0,class:"mx-3 my-2"},An={class:"relative overflow-hidden rounded-xl border border-blue-200 bg-gradient-to-br from-blue-50 to-purple-50 p-3 shadow-sm dark:border-blue-800 dark:from-blue-950/30 dark:to-purple-950/30"},Dn={class:"relative z-10 mb-2 flex items-center justify-between"},jn={class:"flex items-center gap-2"},Mn={class:"relative"},Ln={class:"flex h-6 w-6 items-center justify-center rounded-full bg-gradient-to-br from-blue-500 to-purple-600"},Pn={class:"text-xs text-blue-700 dark:text-blue-300"},Rn={class:"relative z-10 mb-2"},Fn={class:"mb-1 flex items-center justify-between"},zn={class:"text-xs text-blue-600 dark:text-blue-400"},Wn={class:"relative h-2 overflow-hidden rounded-full bg-blue-100 dark:bg-blue-900/50"},Nn={class:"relative z-10 flex items-center gap-2"},In={class:"flex-shrink-0"},On={key:0,class:"h-2 w-2 animate-bounce rounded-full bg-blue-500"},Hn={key:1,class:"flex gap-0.5"},qn={key:2,class:"h-2 w-2 animate-spin rounded-full border-2 border-blue-500 border-t-transparent"},Bn={key:3,class:"h-2 w-2 rounded-full bg-green-500"},Gn={key:4,class:"h-2 w-2 rounded-full bg-red-500"},Un={class:"flex-1 text-xs text-blue-800 dark:text-blue-200"},Qn={class:"relative z-10 flex flex-1 overflow-hidden"},Kn={key:0,class:"w-[320px] flex-shrink-0 border-r border-border/50 bg-background/80 backdrop-blur-xl shadow-xl z-20"},Vn={class:"h-full overflow-y-auto custom-scrollbar"},Xn={class:"p-4"},Jn={class:"mb-3"},Yn={class:"text-xs text-muted-foreground"},Zn={class:"flex min-h-0 flex-1 flex-col bg-transparent relative"},ea={class:"flex-1 overflow-hidden relative"},ta={class:"absolute inset-0 overflow-y-auto custom-scrollbar flex flex-col items-center py-8 px-4 sm:px-8"},sa={class:"flex h-full w-full overflow-hidden relative"},ra={id:"left-sidebar-panel",class:"hidden lg:flex w-80 flex-col border-r border-border/40 bg-background/60 backdrop-blur-xl z-20 transition-all duration-300"},oa={class:"h-14 flex items-center justify-between px-4 border-b border-border/40 shrink-0"},na={class:"p-4"},aa={class:"flex-1 flex flex-col relative z-10 min-w-0 bg-background/30 dark:bg-background transition-all duration-300"},la={class:"md:hidden flex flex-wrap items-start justify-between border-b border-border/40 bg-background/60 backdrop-blur-md px-4 py-3 relative z-30 transition-all duration-300 gap-y-2"},ia={class:"flex items-center gap-2 flex-shrink-0 order-1"},da={class:"flex items-center order-2"},ua={class:"order-3 w-full flex flex-col gap-3"},ca={class:"flex items-start gap-3 w-full min-w-0"},pa={class:"flex items-center gap-2 justify-between mt-1"},ga={class:"flex items-center gap-2"},fa={class:"flex items-center gap-2"},ma={key:0,class:"inline"},ha={class:"hidden md:flex flex-col w-full z-30 bg-background/60 backdrop-blur-md transition-all duration-300 relative"},va={class:"h-10 border-b border-border/40 flex items-left justify-left px-4 bg-background/40"},ba={class:"flex items-left gap-3"},xa=["innerHTML"],wa={class:"h-12 border-b border-border/40 flex items-center justify-between px-4 gap-3 bg-muted/10"},ya={class:"flex items-center gap-1"},_a={class:"flex items-center gap-3"},ka={id:"view-controls",class:"flex items-center bg-background/50 rounded-full border border-border/50 p-1 backdrop-blur-sm shadow-sm"},Ca={class:"hidden xl:inline"},Sa={class:"hidden xl:inline"},Ea={class:"flex items-center gap-2"},Ta={class:"flex items-center gap-2 pl-2 border-l border-border/50"},$a={class:"inline"},Aa={class:"flex-1 overflow-hidden relative group bg-background/20"},Da={key:0,class:"absolute top-6 left-0 right-0 z-40 px-4 flex justify-center pointer-events-none"},ja={class:"w-full max-w-lg pointer-events-auto"},Ma={class:"relative overflow-hidden rounded-xl border border-blue-200 bg-gradient-to-br from-blue-50/95 to-purple-50/95 p-3 shadow-lg backdrop-blur-lg dark:border-blue-800 dark:from-blue-950/90 dark:to-purple-950/90"},La={class:"flex items-center gap-3"},Pa={class:"relative flex h-8 w-8 items-center justify-center rounded-full bg-gradient-to-br from-blue-500 to-purple-600 shadow-md"},Ra={class:"flex-1 min-w-0"},Fa={class:"flex items-center justify-between mb-1"},za={class:"text-xs font-mono text-muted-foreground"},Wa={class:"h-1.5 w-full bg-blue-100 dark:bg-blue-900/40 rounded-full overflow-hidden"},Na={class:"mt-2 text-xs text-muted-foreground ml-11 truncate"},Ia={class:"mx-auto py-12 px-6 sm:px-10 min-h-full"},Oa={class:"min-h-[600px] pb-32"},Ha={class:"pb-32"},qa={id:"editor-footer",class:"h-7 border-t border-border/30 bg-background/40 backdrop-blur-sm flex items-center justify-between px-4 text-[10px] text-muted-foreground shrink-0"},Ba={class:"flex items-center gap-3"},Ga={class:"hidden sm:inline"},Ua={class:"flex items-center gap-2"},Qa={key:0,class:"text-green-500 flex items-center gap-1 ml-2"},Ka={key:0,class:"fixed inset-0 bg-black/50 flex items-center justify-center z-50"},Va={class:"text-slate-600 dark:text-slate-300 mb-4"},Xa={class:"font-semibold text-amber-600 dark:text-amber-400"},Ja={class:"flex flex-col sm:flex-row gap-3"},Ya=1e3,Za=Ue({__name:"ChapterEditor",props:{project:{},chapter:{},allChapters:{},facultyChapters:{},mode:{}},setup(x){const y=Ve(()=>Je(()=>import("./ChapterNavigation-DTbV-eGh.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24]))),l=Ve(()=>Je(()=>import("./MobileNavOverlay-BC9xhwVh.js"),__vite__mapDeps([25,3,4,26,2,1,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,68,69,70,71,72,73,74,75,76,77,78,79,80,81,82,83,84,85,86,87,88,89,90,91,92,93,94,95]))),$=Ve(()=>Je(()=>import("./ChatModeLayout-CEg_GBZ0.js"),__vite__mapDeps([96,3,4,18,2,8,28,31,6,7,32,5,9,42,43,44,45,46,47,48,49,50,51,52,53,54,15,55,24,41,56,11,14,57,12,13,16,58,59,60,19,61,62,97,26,98,69,64,93,99,100,20,37,90,94,40,29,30,33,34,10,63,65,66,67,36,68,38,23,89,101,21,71,102,103,88,72,73,74,75,76,77,78,79,80,81,82,83,84,85,86,87,70,91,92,104]))),P=Ve(()=>Je(()=>import("./CitationVerificationLayout-aJPEHMi_.js"),__vite__mapDeps([105,18,2,3,4,8,28,29,31,6,7,32,5,9,106,44,14,98,21,12,13,15,11,16,33,34,72,73,74,19,75,76,77,78,79,63,20,80,81,82,83,84,56,57,58,65,85,86,87,41,59,42,43,45,46,47,48,49,50,51,52,53,54,55,24,60,61,62,88,30,40,10,37,64,66,67,36,68,69,89,90,70,91,92,93,94,38]))),n=x,C=ss(),g=E(null),k=E(null),d=E(!1),_=E(!1),u=E(0);if(typeof window<"u"){const a=new URLSearchParams(window.location.search);d.value=a.has("theme_sandbox"),_.value=a.get("theme_sandbox")==="nolayout"||a.has("theme_sandbox_nolayout");const t=a.get("theme_sandbox_step"),v=t?Number.parseInt(t,10):0;u.value=Number.isFinite(v)?v:0}const{appearance:h,isDark:c}=rs(),f=E({htmlHasDark:!1,background:"",foreground:"",card:"",sidebarBackground:"",bodyBg:"",insetBg:"",sampleBgBackground:"",sampleBgCard:"",sampleBgMuted:""}),W=E(null),F=E(null),L=E(null);function w(){if(typeof window>"u")return;const a=document.documentElement,t=window.getComputedStyle(a),v=document.querySelector('[data-slot="sidebar-inset"]'),K=v?window.getComputedStyle(v).backgroundColor:"";f.value={htmlHasDark:a.classList.contains("dark"),background:t.getPropertyValue("--background").trim(),foreground:t.getPropertyValue("--foreground").trim(),card:t.getPropertyValue("--card").trim(),sidebarBackground:t.getPropertyValue("--sidebar-background").trim(),bodyBg:window.getComputedStyle(document.body).backgroundColor,insetBg:K,sampleBgBackground:W.value?window.getComputedStyle(W.value).backgroundColor:"",sampleBgCard:F.value?window.getComputedStyle(F.value).backgroundColor:"",sampleBgMuted:L.value?window.getComputedStyle(L.value).backgroundColor:""}}const{chapterTitle:i,chapterContent:m,showPreview:H,isEditorDark:D,toggleChapterTheme:T,isNativeFullscreen:O,selectedText:B,showChatMode:U,showCitationMode:ue,showDefensePrep:Q,loadChatModeFromStorage:ce,saveChatModeToStorage:Qe,showLeftSidebar:je,showRightSidebar:Me,isMobile:Le,isLeftSidebarCollapsed:M,isRightSidebarCollapsed:N,showLeftSidebarInFullscreen:G,showRightSidebarInFullscreen:j}=to(n),{balance:J,showPurchaseModal:Te,requiredWordsForModal:Pe,actionDescriptionForModal:Re,checkAndPrompt:Ze,closePurchaseModal:et,estimates:Fe}=gr(),ze=(a,t)=>Ze(Math.max(1,Math.round(a)),t),{hasUnsavedChanges:tt,isSaving:pe,triggerAutoSave:We,save:he,clearAutoSave:is}=fr({delay:1e4,onSave:Et});let ft=0;const ds=()=>{const a=Date.now();a-ft>Ya&&(ft=a,z.success("Saved",{duration:2e3}))},{contentHistory:us,historyIndex:cs,addToHistory:ps,undo:gs,redo:fs}=Wr(n.chapter.content||""),{writingStats:mt,writingQualityScore:ve,calculateWritingStats:st}=Xo(m),{isAnalyzing:ms,latestAnalysis:hs,getLatestAnalysis:vs}=Jo(n.chapter.id),le=R(()=>{if(n.facultyChapters&&n.facultyChapters.length>0){const t=n.facultyChapters.find(v=>v.number===n.chapter.chapter_number);if(t?.word_count)return t.word_count}if(n.project?.outlines&&n.project.outlines.length>0){const t=n.project.outlines.find(v=>v.chapter_number===n.chapter.chapter_number);if(t?.target_word_count)return t.target_word_count}const a=n.project.type==="undergraduate"?2500:3500;return n.chapter.chapter_number===1||n.chapter.chapter_number===5?Math.round(a*.8):a}),{generateNextChapter:rt}=so({props:n,allChapters:n.allChapters,targetWordCount:le,estimates:Fe,ensureBalance:ze,save:he}),{currentWordCount:te,progressPercentage:bs,DEFENSE_THRESHOLD:xs,countWords:ws}=mr(m,le),ot=bs,ht=R(()=>({chapter:n.chapter,chapterTitle:i,chapterContent:m,showPresentationMode:be,togglePresentationMode:jt,isStreamingMode:wt,isGenerating:we,generationProgress:Ne,generationPercentage:ye,generationPhase:_e,aiChapterAnalysis,nextSection,getSectionInfo,writingStats:mt,latestAnalysis:hs,isAnalyzing:ms,writingQualityScore:ve,isSaving:pe,isValid:Ie,save:he,goToBulkAnalysis:at,markAsComplete:lt,richTextEditor:g,richTextEditorFullscreen:k,selectedText:B,setSelectedText:a=>{B.value=a}})),ys=R(()=>({chapter_number:St.value.chapter_number,chapter_title:St.value.title,word_count:te.value})),_s=R(()=>({meetsThreshold:zs.value,shouldShowProgress:Ls.value,progressPercentage:Ps.value,wordsRemaining:Rs.value,hasTriggeredGeneration:Fs,threshold:xs,statusMessage:Ms()})),vt=R(()=>({project:ge.value,chapter:fe.value,isGenerating:we.value,selectedText:B.value,isLoadingSuggestions:xt.value,showCitationHelper:Ke.value,chapterContent:m.value,currentWordCount:te.value,targetWordCount:le.value,handleAIGeneration:_t,getAISuggestions:kt,updateCitationHelper:a=>{Ke.value=a},insertCitation:qs,checkCitations:Ct,showDefensePrep:Q.value,defenseQuestions:ks.value??[],isLoadingDefenseQuestions:Cs.value,isGeneratingDefenseQuestions:Ss.value,chapterContext:ys.value,defenseWatcher:_s.value,autoGenerateDefense:Es.value,handleDefensePanelToggle:Ys,generateNewDefenseQuestions:$s,handleDefenseAutoToggle:js,refreshDefenseQuestions:()=>bt(!0,{skipGeneration:!0}),markQuestionHelpful:As,hideQuestion:Ds})),{defenseQuestions:ks,isLoadingDefenseQuestions:Cs,isGeneratingDefenseQuestions:Ss,autoGenerateDefense:Es,shouldLoadDefenseQuestions:Ts,loadDefenseQuestions:bt,generateNewDefenseQuestions:$s,markQuestionHelpful:As,hideQuestion:Ds,handleDefenseAutoToggle:js,getDefenseStatusMessage:Ms,shouldShowDefenseProgress:Ls,defenseProgressPercentage:Ps,defenseWordsRemaining:Rs,hasTriggeredGeneration:Fs,meetsDefenseThreshold:zs}=oo({props:n,chapterContent:m,currentWordCount:te,ensureBalance:ze,estimates:Fe}),{isGenerating:we,generationProgress:Ne,generationPercentage:ye,generationPhase:_e,estimatedTotalWords:Ws,streamWordCount:Ns,streamBuffer:tl,lastStreamUpdate:sl,originalContentForAppend:rl,aiSuggestions:ol,isLoadingSuggestions:xt,showCitationHelper:Ke,showPresentationMode:be,isStreamingMode:wt,showRecoveryDialog:Is,partialContentSaved:nl,savedWordCountOnError:Os,isCollectingPapers:al,paperCollectionProgress:ll,paperCollectionPhase:il,collectedPapersCount:dl,paperCollectionPercentage:ul,currentSource:cl,sourcesCompleted:pl,papersPreview:gl,paperCollectionData:fl,paperCollectionInterval:ml,reconnectAttempts:hl,reconnectDelay:vl,isReconnecting:bl,currentGenerationId:xl,currentGenerationType:wl,eventSource:yt,editorScrollRef:Hs,attachScroller:yl,smoothScrollToBottom:_l,forceScrollToBottom:kl,resetScroller:Cl,isAutoScrollActive:Sl,isUserScrollingScroller:El,scrollToBottom:Tl,checkConnectionQuality:$l,handleAIGeneration:_t,getAISuggestions:kt,checkCitations:Ct,insertCitation:qs,resumeGeneration:Bs,dismissRecovery:Gs,checkForAutoGeneration:Us}=hr({props:n,chapterContent:m,targetWordCount:le,estimates:Fe,ensureBalance:ze,save:he,triggerAutoSave:We,calculateWritingStats:st,countWords:ws,selectedText:B,richTextEditor:g,richTextEditorFullscreen:k,isNativeFullscreen:O}),Ie=R(()=>{const a=i.value?.trim(),t=m.value?.trim();return a&&a.length>0&&t&&t.length>50}),ge=R(()=>n.project),fe=R(()=>n.chapter),xe=R(()=>n.allChapters),St=R(()=>n.chapter);async function Et(a=!1){try{const t=await fetch(V("chapters.save",{project:n.project.id}),{method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json","X-Requested-With":"XMLHttpRequest","X-CSRF-TOKEN":document.querySelector('meta[name="csrf-token"]')?.getAttribute("content")||""},body:JSON.stringify({project_id:n.project.id,chapter_number:n.chapter.chapter_number,title:i.value,content:m.value,auto_save:a,statistics:mt.value,quality_score:ve.value})});console.log("Response status:",t.status,t.statusText),console.log("Response headers:",t.headers);const v=await t.text();console.log("Raw response:",v);let K;try{K=JSON.parse(v)}catch(me){throw console.error("JSON parse error:",me),console.error("Response was:",v),new Error(`Server returned non-JSON response: ${t.status} ${t.statusText}`)}t.ok}catch(t){throw a||z.error("âŒ Save Failed",{description:"Please try again or check your connection."}),t}}const Tt=()=>{const a=gs();a!==null&&(m.value=a,We())},$t=()=>{const a=fs();a!==null&&(m.value=a,We())},Oe=a=>{tt.value&&confirm("You have unsaved changes. Save before switching chapters?")&&he();const t=n.allChapters.find(me=>me.chapter_number===a),K=t?.content&&t.content.trim()!==""?"chapters.edit":"chapters.write";se.visit(V(K,{project:n.project.slug,chapter:a}),{only:["chapter","mode","allChapters"],preserveState:!0,preserveScroll:!1})},At=()=>document.fullscreenElement||document.webkitFullscreenElement||document.msFullscreenElement||null,Qs=async()=>{try{const a=document.documentElement;a.requestFullscreen?await a.requestFullscreen({navigationUI:"hide"}):a.webkitRequestFullscreen?await a.webkitRequestFullscreen():a.msRequestFullscreen&&await a.msRequestFullscreen()}catch(a){console.error("Error entering fullscreen:",a),z.error("Fullscreen Error",{description:"Unable to enter fullscreen mode"})}},Ks=async()=>{try{document.exitFullscreen?await document.exitFullscreen():document.webkitExitFullscreen?await document.webkitExitFullscreen():document.msExitFullscreen&&await document.msExitFullscreen()}catch(a){console.error("Error exiting fullscreen:",a),z.error("Fullscreen Error",{description:"Unable to exit fullscreen mode"})}},nt=async()=>{if(At()){await Ks();return}await Qs()},ke=()=>{O.value=!!At(),$e(()=>{d.value&&w()})},Dt=()=>{U.value=!U.value,U.value&&(ue.value=!1),Qe(U.value)},Vs=()=>{U.value=!1,Qe(!1)},Xs=()=>{ue.value=!1},jt=()=>{be.value=!be.value},at=()=>{se.visit(V("projects.analysis",{project:n.project.slug}))},Js=()=>{ps(m.value),We(),st()},Mt=a=>{(a.ctrlKey||a.metaKey)&&a.key==="s"&&(a.preventDefault(),he(),ds()),(a.ctrlKey||a.metaKey)&&!a.shiftKey&&a.key==="z"&&(a.preventDefault(),Tt()),(a.ctrlKey||a.metaKey)&&a.shiftKey&&a.key==="z"&&(a.preventDefault(),$t()),(a.ctrlKey||a.metaKey)&&a.shiftKey&&(a.key==="f"||a.key==="F")&&(a.preventDefault(),nt())};Ce(()=>{const a=()=>{Le.value=window.innerWidth<1024};a(),window.addEventListener("resize",a),U.value=ce(),document.addEventListener("keydown",Lt),document.addEventListener("keydown",Mt),document.addEventListener("fullscreenchange",ke),document.addEventListener("webkitfullscreenchange",ke),document.addEventListener("msfullscreenchange",ke),ke(),st(),Us()});const Lt=a=>{if((a.ctrlKey||a.metaKey)&&!["INPUT","TEXTAREA","SELECT"].includes(a.target?.tagName))switch(a.key){case"ArrowLeft":a.preventDefault();const t=n.chapter.chapter_number-1;n.allChapters.find(He=>He.chapter_number===t)&&Oe(t);break;case"ArrowRight":a.preventDefault();const K=n.chapter.chapter_number+1;n.allChapters.find(He=>He.chapter_number===K)&&Oe(K);break}};Ce(()=>{const a=t=>{const v=K=>{const{scrollTop:me,scrollHeight:He,clientHeight:Zs}=t,Rt=K.deltaY,er=me<=0,tr=me+Zs>=He;Rt<0&&er||Rt>0&&tr||K.stopPropagation()};return t.addEventListener("wheel",v,{passive:!0}),()=>t.removeEventListener("wheel",v)};$e(()=>{const t=document.querySelectorAll('[class*="overflow-y-auto"]'),v=[];t.forEach(K=>{if(K instanceof HTMLElement){const me=a(K);v.push(me)}}),window.__scrollChainCleanup=v})}),ar(()=>{is(),yt.value&&yt.value.close(),document.removeEventListener("keydown",Mt),document.removeEventListener("keydown",Lt);const a=window.__scrollChainCleanup;a&&Array.isArray(a)&&(a.forEach(t=>t()),delete window.__scrollChainCleanup),document.removeEventListener("fullscreenchange",ke),document.removeEventListener("webkitfullscreenchange",ke),document.removeEventListener("msfullscreenchange",ke)}),ae(()=>n.chapter,async a=>{i.value=a.title||"",m.value=a.content||""},{immediate:!1});const Ys=async a=>{Q.value=a,a&&Ts()&&await bt(!1,{skipGeneration:!0})},Pt=()=>{const a=[{popover:{title:"Welcome to the AI Assisted Editor",description:"Experience a powerful writing environment enhanced by AI. Generate an entire chapter with one click and access a suite of AI tools to refine your content.",popoverClass:"driver-popover-welcome"}},{element:"#back-to-project-btn",popover:{title:"Back to Project",description:"Return to your project dashboard."}},{element:"#left-sidebar-panel",popover:{title:"Chapter Navigation",description:"Use the Table of Contents to switch between chapters."},onHighlightStarted:()=>{M.value=!1},showOnMobile:!1},{element:"#manual-editor-toolbar",element:"#view-controls",popover:{title:"View Options",description:"Customize your view with Preview, AI Chat, Fullscreen, and Dark Mode."}},{element:"#toggle-chat-mode",popover:{title:"AI Chat Assistant",description:"Open the AI assistant to help you write, brainstorm, or refine your content."}},{element:"#export-menu-container",popover:{title:"Export",description:"Export your chapter or entire project."}},{element:"#analyze-button",popover:{title:"Bulk Analysis",description:"Analyze content across chapters."}},{element:"#save-button",popover:{title:"Save Work",description:"Manually save your chapter. Auto-save is also active!"}},{element:"#mark-complete-btn",popover:{title:"Mark as Complete",description:"Finished writing? Mark the chapter as complete."}},{element:"#toggle-right-sidebar",popover:{title:"AI Tools Sidebar",description:"Toggle the sidebar to access AI tools like Smart Suggestions and Citation Helper."},showOnMobile:!1},{element:"#right-sidebar-panel",popover:{title:"AI Assistant Tools",description:"Access powerful AI features here."},onHighlightStarted:()=>{N.value=!1},showOnMobile:!1},{element:"#editor-footer",popover:{title:"Writing Stats",description:"Track your word count, quality score, and readiness."}},{element:"#reset-tour-button",popover:{title:"Need Help?",description:"Click here anytime to restart this tour."}}];ur({showProgress:!0,animate:!0,steps:Le.value?a.filter(v=>v.showOnMobile!==!1):a}).drive()};Ce(()=>{if(C.props.auth?.user?.email){const a=`chapter_editor_tour_seen_${C.props.auth.user.email}`;localStorage.getItem(a)||setTimeout(()=>{Pt(),localStorage.setItem(a,"true")},1e3)}}),ae(m,Js),ae(i,We);const lt=async()=>{console.log("ðŸ”µ [MARK COMPLETE] Function called"),console.log("ðŸ”µ [MARK COMPLETE] Current word count:",te.value);try{console.log("ðŸ”µ [MARK COMPLETE] Saving chapter..."),await he(!1),console.log("âœ… [MARK COMPLETE] Chapter saved");const a=V("chapters.mark-complete",{project:n.project.slug,chapter:n.chapter.chapter_number});console.log("ðŸ”µ [MARK COMPLETE] Posting to:",a),se.post(a,{},{onSuccess:()=>{console.log("âœ… [MARK COMPLETE] Request successful")},onError:t=>{console.error("âŒ [MARK COMPLETE] Request failed:",t)}})}catch(a){console.error("âŒ [MARK COMPLETE] Error:",a),z.error("Failed to save chapter before marking complete")}};return Ce(async()=>{await vs()}),Ce(()=>{d.value&&$e(()=>w())}),ae(c,()=>{d.value&&$e(()=>w())},{flush:"post"}),(a,t)=>(S(),I(e(dr),null,{default:o(()=>[d.value?(S(),q(Ft,{key:0},[_.value?(S(),q("div",Yo,[s("div",Zo,[s("div",en,[t[28]||(t[28]=s("div",null,[s("h1",{class:"text-lg font-semibold"},"ChapterEditor Theme Sandbox"),s("p",{class:"text-sm text-muted-foreground"},"No layout mode. Use `?theme_sandbox=nolayout`.")],-1)),s("div",tn,[r(Nt),r(e(A),{variant:"outline",size:"sm",onClick:w},{default:o(()=>[...t[26]||(t[26]=[p("Refresh",-1)])]),_:1}),r(e(A),{variant:"outline",size:"sm",onClick:t[0]||(t[0]=v=>e(se).visit(a.window.location.pathname))},{default:o(()=>[...t[27]||(t[27]=[p("Exit",-1)])]),_:1})])]),s("div",sn,[r(e(re),{class:"bg-card text-card-foreground"},{default:o(()=>[r(e(ne),null,{default:o(()=>[r(e(ie),{class:"text-base"},{default:o(()=>[...t[29]||(t[29]=[p("Theme State",-1)])]),_:1})]),_:1}),r(e(oe),{class:"space-y-2 text-sm"},{default:o(()=>[s("div",rn,[s("div",null,[t[30]||(t[30]=s("span",{class:"text-muted-foreground"},"appearance:",-1)),p(" "+b(e(h)),1)]),s("div",null,[t[31]||(t[31]=s("span",{class:"text-muted-foreground"},"isDark:",-1)),p(" "+b(e(c)),1)]),s("div",null,[t[32]||(t[32]=s("span",{class:"text-muted-foreground"},"html.dark:",-1)),p(" "+b(f.value.htmlHasDark),1)]),s("div",null,[t[33]||(t[33]=s("span",{class:"text-muted-foreground"},"step:",-1)),p(" "+b(u.value),1)])]),r(e(qe)),s("div",on,[s("div",null,[t[34]||(t[34]=s("span",{class:"text-muted-foreground"},"--background:",-1)),p(" "+b(f.value.background),1)]),s("div",null,[t[35]||(t[35]=s("span",{class:"text-muted-foreground"},"--foreground:",-1)),p(" "+b(f.value.foreground),1)]),s("div",null,[t[36]||(t[36]=s("span",{class:"text-muted-foreground"},"--card:",-1)),p(" "+b(f.value.card),1)]),s("div",null,[t[37]||(t[37]=s("span",{class:"text-muted-foreground"},"--sidebar-background:",-1)),p(" "+b(f.value.sidebarBackground),1)])]),r(e(qe)),s("div",nn,[s("div",null,[t[38]||(t[38]=s("span",{class:"text-muted-foreground"},"body bg:",-1)),p(" "+b(f.value.bodyBg),1)]),s("div",null,[t[39]||(t[39]=s("span",{class:"text-muted-foreground"},"inset bg:",-1)),p(" "+b(f.value.insetBg),1)]),s("div",null,[t[40]||(t[40]=s("span",{class:"text-muted-foreground"},"sample bg-background:",-1)),p(" "+b(f.value.sampleBgBackground),1)]),s("div",null,[t[41]||(t[41]=s("span",{class:"text-muted-foreground"},"sample bg-card:",-1)),p(" "+b(f.value.sampleBgCard),1)]),s("div",null,[t[42]||(t[42]=s("span",{class:"text-muted-foreground"},"sample bg-muted:",-1)),p(" "+b(f.value.sampleBgMuted),1)])])]),_:1})]),_:1}),s("div",an,[r(e(re),{ref_key:"sampleBgBackgroundEl",ref:W,class:"bg-background"},{default:o(()=>[r(e(ne),null,{default:o(()=>[r(e(ie),{class:"text-base"},{default:o(()=>[...t[43]||(t[43]=[p("bg-background",-1)])]),_:1})]),_:1}),r(e(oe),{class:"text-sm text-muted-foreground"},{default:o(()=>[...t[44]||(t[44]=[p("Should flip with theme.",-1)])]),_:1})]),_:1},512),r(e(re),{ref_key:"sampleBgCardEl",ref:F,class:"bg-card"},{default:o(()=>[r(e(ne),null,{default:o(()=>[r(e(ie),{class:"text-base"},{default:o(()=>[...t[45]||(t[45]=[p("bg-card",-1)])]),_:1})]),_:1}),r(e(oe),{class:"text-sm text-muted-foreground"},{default:o(()=>[...t[46]||(t[46]=[p("Card surface color.",-1)])]),_:1})]),_:1},512),r(e(re),{ref_key:"sampleBgMutedEl",ref:L,class:"bg-muted"},{default:o(()=>[r(e(ne),null,{default:o(()=>[r(e(ie),{class:"text-base"},{default:o(()=>[...t[47]||(t[47]=[p("bg-muted",-1)])]),_:1})]),_:1}),r(e(oe),{class:"text-sm text-muted-foreground"},{default:o(()=>[...t[48]||(t[48]=[p("Muted surface color.",-1)])]),_:1})]),_:1},512)])])])])):(S(),I(It,{key:1,class:"h-screen overflow-hidden bg-background text-foreground"},{default:o(()=>[s("div",ln,[s("div",dn,[t[51]||(t[51]=s("div",null,[s("h1",{class:"text-lg font-semibold"},"ChapterEditor Theme Sandbox"),s("p",{class:"text-sm text-muted-foreground"}," Use `?theme_sandbox=1` (with layout) or `?theme_sandbox=nolayout`. ")],-1)),s("div",un,[r(Nt),r(e(A),{variant:"outline",size:"sm",onClick:w},{default:o(()=>[...t[49]||(t[49]=[p("Refresh",-1)])]),_:1}),r(e(A),{variant:"outline",size:"sm",onClick:t[1]||(t[1]=v=>e(se).visit(a.window.location.pathname))},{default:o(()=>[...t[50]||(t[50]=[p("Exit",-1)])]),_:1})])]),s("div",cn,[r(e(re),{class:"bg-card text-card-foreground"},{default:o(()=>[r(e(ne),null,{default:o(()=>[r(e(ie),{class:"text-base"},{default:o(()=>[...t[52]||(t[52]=[p("Theme State",-1)])]),_:1})]),_:1}),r(e(oe),{class:"space-y-2 text-sm"},{default:o(()=>[s("div",pn,[s("div",null,[t[53]||(t[53]=s("span",{class:"text-muted-foreground"},"appearance:",-1)),p(" "+b(e(h)),1)]),s("div",null,[t[54]||(t[54]=s("span",{class:"text-muted-foreground"},"isDark:",-1)),p(" "+b(e(c)),1)]),s("div",null,[t[55]||(t[55]=s("span",{class:"text-muted-foreground"},"html.dark:",-1)),p(" "+b(f.value.htmlHasDark),1)]),s("div",null,[t[56]||(t[56]=s("span",{class:"text-muted-foreground"},"step:",-1)),p(" "+b(u.value),1)])]),r(e(qe)),s("div",gn,[s("div",null,[t[57]||(t[57]=s("span",{class:"text-muted-foreground"},"--background:",-1)),p(" "+b(f.value.background),1)]),s("div",null,[t[58]||(t[58]=s("span",{class:"text-muted-foreground"},"--foreground:",-1)),p(" "+b(f.value.foreground),1)]),s("div",null,[t[59]||(t[59]=s("span",{class:"text-muted-foreground"},"--card:",-1)),p(" "+b(f.value.card),1)]),s("div",null,[t[60]||(t[60]=s("span",{class:"text-muted-foreground"},"--sidebar-background:",-1)),p(" "+b(f.value.sidebarBackground),1)])]),r(e(qe)),s("div",fn,[s("div",null,[t[61]||(t[61]=s("span",{class:"text-muted-foreground"},"body bg:",-1)),p(" "+b(f.value.bodyBg),1)]),s("div",null,[t[62]||(t[62]=s("span",{class:"text-muted-foreground"},"inset bg:",-1)),p(" "+b(f.value.insetBg),1)]),s("div",null,[t[63]||(t[63]=s("span",{class:"text-muted-foreground"},"sample bg-background:",-1)),p(" "+b(f.value.sampleBgBackground),1)]),s("div",null,[t[64]||(t[64]=s("span",{class:"text-muted-foreground"},"sample bg-card:",-1)),p(" "+b(f.value.sampleBgCard),1)]),s("div",null,[t[65]||(t[65]=s("span",{class:"text-muted-foreground"},"sample bg-muted:",-1)),p(" "+b(f.value.sampleBgMuted),1)])])]),_:1})]),_:1}),s("div",mn,[r(e(re),{ref_key:"sampleBgBackgroundEl",ref:W,class:"bg-background"},{default:o(()=>[r(e(ne),null,{default:o(()=>[r(e(ie),{class:"text-base"},{default:o(()=>[...t[66]||(t[66]=[p("bg-background",-1)])]),_:1})]),_:1}),r(e(oe),{class:"text-sm text-muted-foreground"},{default:o(()=>[...t[67]||(t[67]=[p("Should flip with theme.",-1)])]),_:1})]),_:1},512),r(e(re),{ref_key:"sampleBgCardEl",ref:F,class:"bg-card"},{default:o(()=>[r(e(ne),null,{default:o(()=>[r(e(ie),{class:"text-base"},{default:o(()=>[...t[68]||(t[68]=[p("bg-card",-1)])]),_:1})]),_:1}),r(e(oe),{class:"text-sm text-muted-foreground"},{default:o(()=>[...t[69]||(t[69]=[p("Card surface color.",-1)])]),_:1})]),_:1},512),r(e(re),{ref_key:"sampleBgMutedEl",ref:L,class:"bg-muted"},{default:o(()=>[r(e(ne),null,{default:o(()=>[r(e(ie),{class:"text-base"},{default:o(()=>[...t[70]||(t[70]=[p("bg-muted",-1)])]),_:1})]),_:1}),r(e(oe),{class:"text-sm text-muted-foreground"},{default:o(()=>[...t[71]||(t[71]=[p("Muted surface color.",-1)])]),_:1})]),_:1},512)]),u.value>=1?(S(),q("div",hn,[t[72]||(t[72]=s("div",{class:"text-sm font-medium"},"Step 1: Paper Card only",-1)),t[73]||(t[73]=s("div",{class:"text-xs text-muted-foreground mb-3"},"Adds `ChapterEditorPaperCard` only.",-1)),r(es,{context:ht.value},null,8,["context"])])):X("",!0)])])]),_:1}))],64)):(S(),q(Ft,{key:1},[e(U)?(S(),I(e($),{key:0,project:ge.value,chapter:fe.value,"chapter-title":e(i),"chapter-content":e(m),"current-word-count":e(te),"target-word-count":le.value,"progress-percentage":e(ot),"writing-quality-score":e(ve),"is-valid":Ie.value,"is-saving":e(pe),"show-preview":e(H),"is-generating":e(we),"generation-progress":e(Ne),"history-index":e(cs),"content-history-length":e(us).length,"selected-text":e(B),"onUpdate:chapterTitle":t[2]||(t[2]=v=>i.value=v),"onUpdate:chapterContent":t[3]||(t[3]=v=>m.value=v),"onUpdate:selectedText":t[4]||(t[4]=v=>B.value=v),"onUpdate:showPreview":t[5]||(t[5]=v=>H.value=v),onSave:t[6]||(t[6]=v=>Et(v)),onUndo:Tt,onRedo:$t,onExitChatMode:Vs},null,8,["project","chapter","chapter-title","chapter-content","current-word-count","target-word-count","progress-percentage","writing-quality-score","is-valid","is-saving","show-preview","is-generating","generation-progress","history-index","content-history-length","selected-text"])):e(ue)?(S(),I(e(P),{key:1,project:ge.value,chapter:fe.value,"chapter-title":e(i),"chapter-content":e(m),"current-word-count":e(te),"target-word-count":le.value,"progress-percentage":e(ot),onExitCitationMode:Xs},null,8,["project","chapter","chapter-title","chapter-content","current-word-count","target-word-count","progress-percentage"])):e(O)?(S(),q("div",vn,[t[90]||(t[90]=s("div",{class:"absolute inset-0 z-0 overflow-hidden pointer-events-none"},[s("div",{class:"absolute top-[-20%] left-[-10%] w-[50%] h-[50%] rounded-full bg-blue-500/5 blur-[120px]"}),s("div",{class:"absolute bottom-[-20%] right-[-10%] w-[50%] h-[50%] rounded-full bg-purple-500/5 blur-[120px]"})],-1)),s("div",bn,[s("div",xn,[r(e(ee),null,{default:o(()=>[r(e(Y),{asChild:""},{default:o(()=>[r(e(A),{onClick:t[7]||(t[7]=v=>e(se).visit(e(V)("projects.show",n.project.slug))),variant:"ghost",size:"icon",class:"h-10 w-10 rounded-full hover:bg-primary/10 hover:text-primary transition-all duration-300"},{default:o(()=>[r(e(dt),{class:"h-5 w-5"})]),_:1})]),_:1}),r(e(Z),null,{default:o(()=>[...t[74]||(t[74]=[s("p",null,"Back to Project",-1)])]),_:1})]),_:1}),s("div",wn,[s("h1",yn,b(n.project.title),1),s("div",_n,[r(e(Se),{variant:"outline",class:"h-5 px-2 rounded-full border-primary/20 bg-primary/5 text-primary font-medium"},{default:o(()=>[p(" Chapter "+b(n.chapter.chapter_number),1)]),_:1}),s("span",kn,[t[75]||(t[75]=s("span",{class:"h-1.5 w-1.5 rounded-full bg-green-500 animate-pulse"},null,-1)),p(" "+b(e(te))+" words ",1)])])])]),s("div",Cn,[s("div",Sn,[r(e(A),{onClick:t[8]||(t[8]=v=>G.value=!e(G)),variant:e(G)?"secondary":"ghost",size:"sm",class:Ge(["h-8 px-4 rounded-full text-xs font-medium transition-all duration-300",e(G)?"bg-primary/10 text-primary hover:bg-primary/15":"hover:bg-muted"])},{default:o(()=>[r(e(Kt),{class:"mr-2 h-3.5 w-3.5"}),t[76]||(t[76]=p(" Outline ",-1))]),_:1},8,["variant","class"]),t[78]||(t[78]=s("div",{class:"w-px h-4 bg-border/50 mx-1"},null,-1)),r(e(A),{onClick:t[9]||(t[9]=v=>j.value=!e(j)),variant:e(j)?"secondary":"ghost",size:"sm",class:Ge(["h-8 px-4 rounded-full text-xs font-medium transition-all duration-300",e(j)?"bg-primary/10 text-primary hover:bg-primary/15":"hover:bg-muted"])},{default:o(()=>[r(e(Be),{class:"mr-2 h-3.5 w-3.5"}),t[77]||(t[77]=p(" Assistant ",-1))]),_:1},8,["variant","class"])]),s("div",En,[r(e(ee),null,{default:o(()=>[r(e(Y),{asChild:""},{default:o(()=>[r(e(A),{onClick:Dt,variant:"ghost",size:"icon",class:"h-9 w-9 rounded-full transition-all hover:bg-muted"},{default:o(()=>[r(e(Vt),{class:"h-4.5 w-4.5 text-blue-500"})]),_:1})]),_:1}),r(e(Z),null,{default:o(()=>[...t[79]||(t[79]=[s("p",null,"Open AI Chat",-1)])]),_:1})]),_:1}),r(e(ee),null,{default:o(()=>[r(e(Y),{asChild:""},{default:o(()=>[r(e(A),{onClick:nt,variant:e(O)?"secondary":"ghost",size:"icon",class:"h-9 w-9 rounded-full transition-all hover:bg-muted"},{default:o(()=>[e(O)?(S(),I(e(Xt),{key:0,class:"h-4.5 w-4.5"})):(S(),I(e(Gt),{key:1,class:"h-4.5 w-4.5"}))]),_:1},8,["variant"])]),_:1}),r(e(Z),null,{default:o(()=>[s("p",null,b(e(O)?"Exit fullscreen":"Enter fullscreen"),1)]),_:1})]),_:1}),r(e(ee),null,{default:o(()=>[r(e(Y),{asChild:""},{default:o(()=>[r(e(A),{onClick:e(T),variant:e(D)?"secondary":"ghost",size:"icon",class:"h-9 w-9 rounded-full transition-all hover:bg-muted"},{default:o(()=>[e(D)?(S(),I(e(Jt),{key:0,class:"h-4.5 w-4.5 text-foreground"})):(S(),I(e(Yt),{key:1,class:"h-4.5 w-4.5 text-muted-foreground"}))]),_:1},8,["onClick","variant"])]),_:1}),r(e(Z),null,{default:o(()=>[...t[80]||(t[80]=[s("p",null,"Toggle Dark Mode",-1)])]),_:1})]),_:1}),r(it,{project:ge.value,"current-chapter":fe.value,"all-chapters":xe.value,size:"icon",variant:"ghost",class:"h-9 w-9 rounded-full hover:bg-muted"},null,8,["project","current-chapter","all-chapters"])])])]),s("div",Tn,[s("div",{class:"absolute top-0 left-0 h-full bg-gradient-to-r from-blue-500 via-purple-500 to-pink-500 transition-all duration-700 ease-out shadow-[0_0_10px_rgba(59,130,246,0.5)]",style:Xe({width:`${Math.min(e(ot),100)}%`})},null,4)]),e(we)?(S(),q("div",$n,[s("div",An,[t[86]||(t[86]=s("div",{class:"absolute inset-0 -skew-x-12 animate-pulse bg-gradient-to-r from-transparent via-white/10 to-transparent"},null,-1)),s("div",Dn,[s("div",jn,[s("div",Mn,[s("div",Ln,[r(e(Be),{class:"h-3 w-3 text-white"})]),t[81]||(t[81]=s("div",{class:"absolute inset-0 h-6 w-6 animate-ping rounded-full bg-gradient-to-br from-blue-500 to-purple-600 opacity-20"},null,-1))]),s("div",null,[t[82]||(t[82]=s("h4",{class:"text-xs font-semibold text-blue-900 dark:text-blue-100"},"AI Generator",-1)),s("p",Pn,b(e(_e)),1)])]),r(e(Se),{variant:"outline",class:"border-blue-300 text-xs text-blue-700 dark:border-blue-700 dark:text-blue-300"},{default:o(()=>[p(b(Math.round(e(ye)))+"% ",1)]),_:1})]),s("div",Rn,[s("div",Fn,[t[83]||(t[83]=s("span",{class:"text-xs text-blue-800 dark:text-blue-200"},"Generation Progress",-1)),s("span",zn,b(e(Ns))+" / "+b(e(Ws))+" words",1)]),s("div",Wn,[s("div",{class:"absolute top-0 left-0 h-full rounded-full bg-gradient-to-r from-blue-500 to-purple-500 transition-all duration-500 ease-out",style:Xe({width:`${e(ye)}%`})},[...t[84]||(t[84]=[s("div",{class:"absolute inset-0 animate-pulse bg-gradient-to-r from-transparent via-white/30 to-transparent"},null,-1)])],4),s("div",{class:"absolute top-0 left-0 h-full rounded-full bg-gradient-to-r from-blue-400 to-purple-400 opacity-50 blur-sm transition-all duration-500",style:Xe({width:`${e(ye)}%`})},null,4)])]),s("div",Nn,[s("div",In,[e(_e)==="Initializing"?(S(),q("div",On)):e(_e)==="Connecting"?(S(),q("div",Hn,[...t[85]||(t[85]=[s("div",{class:"h-2 w-0.5 animate-pulse rounded-full bg-blue-500"},null,-1),s("div",{class:"h-2 w-0.5 animate-pulse rounded-full bg-purple-500",style:{"animation-delay":"0.2s"}},null,-1),s("div",{class:"h-2 w-0.5 animate-pulse rounded-full bg-blue-500",style:{"animation-delay":"0.4s"}},null,-1)])])):e(_e)==="Generating"?(S(),q("div",qn)):e(_e)==="Complete"?(S(),q("div",Bn)):(S(),q("div",Gn))]),s("p",Un,b(e(Ne)),1)])])])):X("",!0),s("div",Qn,[r(De,{"enter-active-class":"transition-all duration-300 ease-in-out","enter-from-class":"-ml-72 opacity-0","enter-to-class":"ml-0 opacity-100","leave-active-class":"transition-all duration-300 ease-in-out","leave-from-class":"ml-0 opacity-100","leave-to-class":"-ml-72 opacity-0"},{default:o(()=>[e(G)?(S(),q("div",Kn,[s("div",Vn,[s("div",Xn,[s("div",Jn,[t[87]||(t[87]=s("h2",{class:"text-sm font-semibold text-foreground mb-1"},"Table of Contents",-1)),s("p",Yn,b(xe.value.length)+" Chapters ",1)]),(S(),I(lr,null,{fallback:o(()=>[...t[88]||(t[88]=[s("div",{class:"flex items-center justify-center p-8"},[s("div",{class:"h-6 w-6 animate-spin rounded-full border-2 border-primary border-t-transparent"})],-1)])]),default:o(()=>[r(e(y),{"all-chapters":xe.value,"current-chapter":fe.value,project:ge.value,outlines:a.project.outlines||[],"faculty-chapters":a.facultyChapters||[],"current-word-count":e(te),"target-word-count":le.value,"writing-quality-score":e(ve),"chapter-content-length":e(m).length,onGoToChapter:Oe,onGenerateNextChapter:e(rt)},null,8,["all-chapters","current-chapter","project","outlines","faculty-chapters","current-word-count","target-word-count","writing-quality-score","chapter-content-length","onGenerateNextChapter"])]),_:1}))])])])):X("",!0)]),_:1}),s("div",Zn,[s("div",ea,[s("div",ta,[r(es,{context:ht.value},null,8,["context"]),t[89]||(t[89]=s("div",{class:"h-12"},null,-1))])])]),r(De,{"enter-active-class":"transition-all duration-300 ease-in-out","enter-from-class":"-mr-72 opacity-0","enter-to-class":"mr-0 opacity-100","leave-active-class":"transition-all duration-300 ease-in-out","leave-from-class":"mr-0 opacity-100","leave-to-class":"-mr-72 opacity-0"},{default:o(()=>[e(j)?(S(),I(ts,zt({key:0,"container-class":"w-72 flex-shrink-0 border-l border-border/40 bg-background/40 backdrop-blur-md"},vt.value),null,16)):X("",!0)]),_:1})])])):(S(),I(It,{key:3,class:"h-screen overflow-hidden bg-background dark:bg-background transition-colors duration-300"},{default:o(()=>[s("div",sa,[t[112]||(t[112]=s("div",{class:"absolute inset-0 z-0 overflow-hidden pointer-events-none"},[s("div",{class:"absolute top-[-10%] left-[-10%] w-[40%] h-[40%] rounded-full bg-blue-500/5 blur-[100px]"}),s("div",{class:"absolute bottom-[-10%] right-[-10%] w-[40%] h-[40%] rounded-full bg-purple-500/5 blur-[100px]"})],-1)),Ee(s("aside",ra,[s("div",oa,[t[91]||(t[91]=s("span",{class:"text-sm font-semibold tracking-tight text-foreground"},"Navigation",-1)),r(e(Se),{variant:"outline",class:"text-[10px] h-5 px-1.5"},{default:o(()=>[p(b(xe.value.length)+" Chapters ",1)]),_:1})]),r(e(Wt),{class:"flex-1"},{default:o(()=>[s("div",na,[r(e(y),{"all-chapters":xe.value,"current-chapter":fe.value,project:ge.value,outlines:a.project.outlines||[],"faculty-chapters":a.facultyChapters||[],"current-word-count":e(te),"target-word-count":le.value,"writing-quality-score":e(ve),"chapter-content-length":e(m).length,onGoToChapter:Oe,onGenerateNextChapter:e(rt)},null,8,["all-chapters","current-chapter","project","outlines","faculty-chapters","current-word-count","target-word-count","writing-quality-score","chapter-content-length","onGenerateNextChapter"])])]),_:1})],512),[[Ae,!e(M)]]),s("main",aa,[s("header",la,[s("div",ia,[r(e(ee),null,{default:o(()=>[r(e(Y),{asChild:""},{default:o(()=>[r(e(A),{id:"back-to-project-btn-mobile",variant:"ghost",size:"icon",class:"h-9 w-9 text-zinc-700 dark:text-zinc-300 hover:text-foreground hover:bg-muted/50 rounded-full",onClick:t[10]||(t[10]=v=>e(se).visit(e(V)("projects.writing",n.project.slug)))},{default:o(()=>[r(e(dt),{class:"w-4 h-4"})]),_:1})]),_:1}),r(e(Z),null,{default:o(()=>[...t[92]||(t[92]=[p("Back to Writing",-1)])]),_:1})]),_:1}),t[93]||(t[93]=s("div",{class:"h-6 w-px bg-border/50 mx-1 hidden lg:block"},null,-1)),r(e(A),{variant:"ghost",size:"icon",onClick:t[11]||(t[11]=v=>je.value=!0),class:"lg:hidden text-muted-foreground hover:text-foreground h-9 w-9 hover:bg-muted/50 rounded-full"},{default:o(()=>[r(e(Kt),{class:"h-4.5 w-4.5"})]),_:1})]),s("div",da,[r(e(A),{variant:"ghost",size:"icon",onClick:t[12]||(t[12]=v=>Me.value=!0),class:"text-muted-foreground hover:text-foreground h-9 w-9 hover:bg-muted/50 rounded-full"},{default:o(()=>[r(e(Be),{class:"h-4.5 w-4.5"})]),_:1})]),s("div",ua,[s("div",ca,[s("h1",{class:"text-xl font-bold tracking-tight text-foreground leading-snug cursor-pointer hover:text-primary/80 transition-colors break-words",onClick:t[13]||(t[13]=v=>e(se).visit(e(V)("projects.show",n.project.slug)))},b(n.project.title),1),r(e(Se),{variant:"secondary",class:"shrink-0 h-5 px-2 text-[10px] font-medium rounded-full bg-secondary/50 border border-border/50 mt-1"},{default:o(()=>[p(" Ch "+b(n.chapter.chapter_number),1)]),_:1})]),s("div",pa,[s("div",ga,[r(it,{project:ge.value,"current-chapter":fe.value,"all-chapters":xe.value,size:"icon",variant:"outline","trigger-element":"icon","button-class":"h-8 w-8 rounded-full bg-background/50 backdrop-blur-sm",class:"text-zinc-700 dark:text-zinc-300"},null,8,["project","current-chapter","all-chapters"]),r(e(A),{variant:"outline",size:"icon",class:"h-8 w-8 gap-2 text-zinc-700 dark:text-zinc-300 hover:text-foreground bg-background/50 backdrop-blur-sm rounded-full",onClick:at},{default:o(()=>[r(e(Zt),{class:"w-4 h-4"})]),_:1})]),s("div",fa,[r(e(A),{onClick:t[14]||(t[14]=v=>e(he)(!1)),disabled:e(pe),variant:Ie.value?"default":"secondary",size:"sm",class:"h-8 px-3 text-xs shadow-sm gap-2 rounded-full min-w-[32px]"},{default:o(()=>[r(e(ct),{class:"h-3.5 w-3.5"}),e(pe)?(S(),q("span",ma,"Saving")):X("",!0)]),_:1},8,["disabled","variant"]),r(e(A),{onClick:lt,disabled:e(pe),size:"sm",class:"h-8 px-3 text-xs shadow-sm gap-2 rounded-full"},{default:o(()=>[r(e(Ye),{class:"h-3.5 w-3.5"}),t[94]||(t[94]=s("span",{class:"sm:hidden"},"Done",-1))]),_:1},8,["disabled"])])])])]),s("div",ha,[s("div",va,[s("div",ba,[s("h1",{class:"text-sm font-bold text-foreground cursor-pointer hover:text-primary transition-colors flex items-center",onClick:t[15]||(t[15]=v=>e(se).visit(e(V)("projects.show",n.project.slug)))},[s("div",{innerHTML:n.project.title,class:"inline-block"},null,8,xa)]),r(e(Se),{variant:"secondary",class:"h-5 px-2 text-[10px] font-medium rounded-full bg-secondary/50 border border-border/50"},{default:o(()=>[p(" Ch "+b(n.chapter.chapter_number),1)]),_:1})])]),s("div",wa,[s("div",ya,[r(e(ee),null,{default:o(()=>[r(e(Y),{asChild:""},{default:o(()=>[r(e(A),{id:"back-to-project-btn",variant:"ghost",size:"icon",class:"h-8 w-8 text-zinc-700 dark:text-zinc-300 hover:text-foreground rounded-full",onClick:t[16]||(t[16]=v=>e(se).visit(e(V)("projects.writing",n.project.slug)))},{default:o(()=>[r(e(dt),{class:"w-4 h-4"})]),_:1})]),_:1}),r(e(Z),null,{default:o(()=>[...t[95]||(t[95]=[p("Back to Writing",-1)])]),_:1})]),_:1}),t[96]||(t[96]=s("div",{class:"h-4 w-px bg-border/50 mx-1"},null,-1)),r(e(A),{id:"toggle-left-sidebar",variant:"ghost",size:"icon",onClick:t[17]||(t[17]=v=>M.value=!e(M)),class:"text-muted-foreground hover:text-foreground h-8 w-8 rounded-full"},{default:o(()=>[e(M)?(S(),I(e(Qr),{key:1,class:"h-4 w-4"})):(S(),I(e(Ur),{key:0,class:"h-4 w-4"}))]),_:1})]),s("div",_a,[s("div",ka,[r(e(ee),null,{default:o(()=>[r(e(Y),{asChild:""},{default:o(()=>[r(e(A),{onClick:jt,variant:e(be)?"secondary":"ghost",size:"sm",class:"h-7 px-3 text-xs gap-2 text-zinc-700 dark:text-zinc-300 hover:text-foreground rounded-full"},{default:o(()=>[e(be)?(S(),I(e(Zr),{key:1,class:"h-3.5 w-3.5"})):(S(),I(e(ns),{key:0,class:"h-3.5 w-3.5"})),s("span",Ca,b(e(be)?"Edit":"Preview"),1)]),_:1},8,["variant"])]),_:1}),r(e(Z),null,{default:o(()=>[...t[97]||(t[97]=[p("Toggle Preview Mode",-1)])]),_:1})]),_:1}),t[101]||(t[101]=s("div",{class:"w-px h-3 bg-border/50 mx-0.5"},null,-1)),r(e(ee),null,{default:o(()=>[r(e(Y),{asChild:""},{default:o(()=>[r(e(A),{id:"toggle-chat-mode",onClick:Dt,variant:"ghost",size:"sm",class:"h-7 px-3 text-xs gap-2 text-muted-foreground hover:text-foreground rounded-full"},{default:o(()=>[r(e(Vt),{class:"h-3.5 w-3.5 text-blue-500"}),t[98]||(t[98]=s("span",{class:"hidden xl:inline text-foreground"},"AI Chat",-1))]),_:1})]),_:1}),r(e(Z),null,{default:o(()=>[...t[99]||(t[99]=[p("Open AI Assistant",-1)])]),_:1})]),_:1}),t[102]||(t[102]=s("div",{class:"w-px h-3 bg-border/50 mx-0.5"},null,-1)),r(e(ee),null,{default:o(()=>[r(e(Y),{asChild:""},{default:o(()=>[r(e(A),{onClick:nt,variant:"ghost",size:"sm",class:"h-7 px-3 text-xs gap-2 text-muted-foreground hover:text-foreground rounded-full"},{default:o(()=>[e(O)?(S(),I(e(Xt),{key:0,class:"h-3.5 w-3.5"})):(S(),I(e(Gt),{key:1,class:"h-3.5 w-3.5"})),s("span",Sa,b(e(O)?`Exit
                                                        Fullscreen`:"Fullscreen"),1)]),_:1})]),_:1}),r(e(Z),null,{default:o(()=>[s("p",null,b(e(O)?"Exit fullscreen":"Enter fullscreen"),1)]),_:1})]),_:1}),t[103]||(t[103]=s("div",{class:"w-px h-3 bg-border/50 mx-0.5"},null,-1)),r(e(ee),null,{default:o(()=>[r(e(Y),{asChild:""},{default:o(()=>[r(e(A),{onClick:e(T),variant:"ghost",size:"sm",class:"h-7 px-3 text-xs gap-2 text-zinc-700 dark:text-zinc-300 hover:text-foreground rounded-full"},{default:o(()=>[e(D)?(S(),I(e(Jt),{key:0,class:"h-3.5 w-3.5 text-foreground"})):(S(),I(e(Yt),{key:1,class:"h-3.5 w-3.5"}))]),_:1},8,["onClick"])]),_:1}),r(e(Z),null,{default:o(()=>[...t[100]||(t[100]=[p("Toggle Dark Mode",-1)])]),_:1})]),_:1})]),s("div",Ea,[r(it,{id:"export-menu-container",project:ge.value,"current-chapter":fe.value,"all-chapters":xe.value,size:"sm",variant:"outline","trigger-element":"button","button-class":"h-9 gap-2 px-3 rounded-full bg-background/50 backdrop-blur-sm",class:"text-zinc-700 dark:text-zinc-300"},null,8,["project","current-chapter","all-chapters"]),r(e(A),{id:"analyze-button",variant:"outline",size:"sm",class:"h-9 gap-2 text-zinc-700 dark:text-zinc-300 hover:text-foreground bg-background/50 backdrop-blur-sm rounded-full",onClick:at,title:"Open bulk analysis"},{default:o(()=>[r(e(Zt),{class:"w-4 h-4"}),t[104]||(t[104]=s("span",{class:"text-xs font-medium"},"Analyze",-1))]),_:1})]),s("div",Ta,[r(e(A),{id:"save-button",onClick:t[18]||(t[18]=v=>e(he)(!1)),disabled:e(pe),variant:Ie.value?"default":"secondary",size:"sm",class:"h-9 px-4 text-xs shadow-sm gap-2 rounded-full min-w-[32px]"},{default:o(()=>[r(e(ct),{class:"h-3.5 w-3.5"}),s("span",$a,b(e(pe)?"Saving":"Save"),1)]),_:1},8,["disabled","variant"]),r(e(A),{id:"mark-complete-btn",onClick:lt,disabled:e(pe),size:"sm",class:"h-9 px-4 text-xs shadow-sm gap-2 rounded-full"},{default:o(()=>[r(e(Ye),{class:"h-3.5 w-3.5"}),t[105]||(t[105]=s("span",null,"Mark Complete",-1))]),_:1},8,["disabled"]),t[107]||(t[107]=s("div",{class:"w-px h-4 bg-border/50 mx-1"},null,-1)),t[108]||(t[108]=s("div",{class:"w-px h-4 bg-border/50 mx-1"},null,-1)),r(e(ee),null,{default:o(()=>[r(e(Y),{asChild:""},{default:o(()=>[r(e(A),{id:"reset-tour-button",variant:"ghost",size:"icon",onClick:Pt,class:"text-muted-foreground hover:text-foreground h-9 w-9 hover:bg-muted/50 rounded-full"},{default:o(()=>[r(e(Kr),{class:"h-4.5 w-4.5"})]),_:1})]),_:1}),r(e(Z),null,{default:o(()=>[...t[106]||(t[106]=[p("Restart Tutorial",-1)])]),_:1})]),_:1}),r(e(A),{id:"toggle-right-sidebar",variant:"ghost",size:"icon",onClick:t[19]||(t[19]=v=>N.value=!e(N)),class:"hidden lg:flex text-muted-foreground hover:text-foreground h-9 w-9 hover:bg-muted/50 rounded-full"},{default:o(()=>[e(N)?(S(),I(e(Ir),{key:1,class:"h-4.5 w-4.5"})):(S(),I(e(Nr),{key:0,class:"h-4.5 w-4.5"}))]),_:1})])])])]),s("div",Aa,[r(De,{"enter-active-class":"transition-all duration-300 ease-out","enter-from-class":"opacity-0 -translate-y-4","enter-to-class":"opacity-100 translate-y-0","leave-active-class":"transition-all duration-200 ease-in","leave-from-class":"opacity-100 translate-y-0","leave-to-class":"opacity-0 -translate-y-4"},{default:o(()=>[e(we)?(S(),q("div",Da,[s("div",ja,[s("div",Ma,[s("div",La,[s("div",Pa,[r(e(Be),{class:"h-4 w-4 text-white animate-pulse"})]),s("div",Ra,[s("div",Fa,[t[109]||(t[109]=s("h4",{class:"text-xs font-semibold text-foreground"}," Generating Content...",-1)),s("span",za,b(Math.round(e(ye)))+"%",1)]),s("div",Wa,[s("div",{class:"h-full bg-gradient-to-r from-blue-500 to-purple-500 transition-all duration-300",style:Xe({width:`${e(ye)}%`})},null,4)])])]),s("p",Na,b(e(Ne)),1)])])])):X("",!0)]),_:1}),r(e(Wt),{ref_key:"editorScrollRef",ref:Hs,class:"h-full w-full"},{default:o(()=>[s("div",Ia,[Ee(s("div",Oa,[r(os,{ref_key:"richTextEditorFullscreen",ref:k,modelValue:e(m),"onUpdate:modelValue":t[20]||(t[20]=v=>ir(m)?m.value=v:null),placeholder:"Start writing your chapter...",class:"prose prose-slate dark:prose-invert prose-lg max-w-none focus:outline-none min-h-[500px]","streaming-mode":e(wt),"is-generating":e(we),"generation-progress":e(Ne),"generation-percentage":e(ye),"generation-phase":e(_e),"onUpdate:selectedText":t[21]||(t[21]=v=>B.value=v),"min-height":"500px"},null,8,["modelValue","streaming-mode","is-generating","generation-progress","generation-percentage","generation-phase"])],512),[[Ae,!e(be)]]),Ee(s("div",Ha,[r(ls,{content:e(m),class:"prose prose-slate dark:prose-invert prose-lg max-w-none"},null,8,["content"])],512),[[Ae,e(be)]])])]),_:1},512)]),s("div",qa,[s("div",Ba,[s("span",null,"Words: "+b(e(te))+" / "+b(le.value),1),s("span",Ga,"Last saved: "+b(e(pe)?"Saving...":`Just
                                    now`),1)]),s("div",Ua,[s("span",null,[t[110]||(t[110]=p("Quality: ",-1)),s("span",{class:Ge(e(ve)>70?"text-green-500":"text-amber-500")},b(e(ve))+"%",3)]),Ie.value?(S(),q("span",Qa,[r(e(Ye),{class:"h-3 w-3"}),t[111]||(t[111]=p(" Ready ",-1))])):X("",!0)])])]),r(ts,zt({id:"right-sidebar-panel","is-collapsed":e(N),"container-class":"hidden lg:flex w-96 flex-col border-l border-border/40 bg-background/60 backdrop-blur-xl z-20 transition-all duration-300"},vt.value),null,16,["is-collapsed"])]),r(e(l),{"show-left-sidebar":e(je),"show-right-sidebar":e(Me),"is-mobile":e(Le),"all-chapters":xe.value,"current-chapter":fe.value,project:ge.value,"current-word-count":e(te),"target-word-count":le.value,"writing-quality-score":e(ve),"chapter-content-length":e(m).length,"is-generating":e(we),"selected-text":e(B),"is-loading-suggestions":e(xt),"show-citation-helper":e(Ke),"chapter-content":e(m),"onUpdate:showLeftSidebar":t[22]||(t[22]=v=>je.value=v),"onUpdate:showRightSidebar":t[23]||(t[23]=v=>Me.value=v),onGoToChapter:Oe,onGenerateNextChapter:e(rt),onStartStreamingGeneration:e(_t),onGetAiSuggestions:e(kt),"onUpdate:showCitationHelper":t[24]||(t[24]=v=>Ke.value=v),onCheckCitations:e(Ct)},null,8,["show-left-sidebar","show-right-sidebar","is-mobile","all-chapters","current-chapter","project","current-word-count","target-word-count","writing-quality-score","chapter-content-length","is-generating","selected-text","is-loading-suggestions","show-citation-helper","chapter-content","onGenerateNextChapter","onStartStreamingGeneration","onGetAiSuggestions","onCheckCitations"]),r(cr,{open:e(Te),"current-balance":e(J),"required-words":e(Pe),action:e(Re),"onUpdate:open":t[25]||(t[25]=v=>Te.value=v),onClose:e(et)},null,8,["open","current-balance","required-words","action","onClose"]),e(Is)?(S(),q("div",Ka,[r(e(re),{class:"w-full max-w-md mx-4 bg-white dark:bg-slate-900 border-amber-500/50 shadow-2xl"},{default:o(()=>[r(e(ne),null,{default:o(()=>[r(e(ie),{class:"flex items-center gap-2 text-amber-600 dark:text-amber-400"},{default:o(()=>[...t[113]||(t[113]=[s("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[s("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"})],-1),p(" Generation Interrupted ",-1)])]),_:1})]),_:1}),r(e(oe),null,{default:o(()=>[s("p",Va,[t[114]||(t[114]=p(" Connection lost. ",-1)),s("span",Xa,b(e(Os))+" words",1),t[115]||(t[115]=p(" may have been saved. ",-1))]),s("div",Ja,[r(e(A),{onClick:e(Bs),class:"flex-1 bg-amber-600 hover:bg-amber-700 text-white"},{default:o(()=>[...t[116]||(t[116]=[s("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-4 w-4 mr-2",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[s("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"})],-1),p(" Reload & Recover ",-1)])]),_:1},8,["onClick"]),r(e(A),{onClick:e(Gs),variant:"outline",class:"flex-1"},{default:o(()=>[...t[117]||(t[117]=[p(" Dismiss ",-1)])]),_:1},8,["onClick"])])]),_:1})]),_:1})])):X("",!0)]),_:1}))],64))]),_:1}))}}),el=gt(Za,[["__scopeId","data-v-50511006"]]),vi=Object.freeze(Object.defineProperty({__proto__:null,default:el},Symbol.toStringTag,{value:"Module"}));export{Uo as A,as as B,vi as C,ls as R};
