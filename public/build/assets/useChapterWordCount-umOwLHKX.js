import{b as o,T as je,t as Le,U as B,q as Be,e as A}from"./app-TT48nyjp.js";import{t as v}from"./index-CEXqyF32.js";import{r as ve}from"./useWordBalance-CSMNLoiy.js";function Ze(l){const{delay:a=1e4,onSave:T}=l,b=o(!1),E=o(!1),y=o(null),F=()=>{b.value=!0,y.value&&clearTimeout(y.value),y.value=setTimeout(()=>{p(!0)},a)},p=async(U=!1)=>{if(!E.value){E.value=!0;try{await T(U),b.value=!1,y.value&&(clearTimeout(y.value),y.value=null)}finally{E.value=!1}}};return{hasUnsavedChanges:b,isSaving:E,triggerAutoSave:F,save:p,clearAutoSave:()=>{y.value&&(clearTimeout(y.value),y.value=null)}}}const Fe={userScrollTimeout:2e3,scrollBehavior:"smooth",bottomThreshold:100};class De{scrollContainer=null;isUserScrolling=!1;userScrollTimeout=null;isEnabled=!0;isDestroyed=!1;config;wasAtBottom=!0;rafId=null;handleWheel;handleTouchStart;handleTouchMove;handleScroll;handleKeydown;constructor(a={}){this.config={...Fe,...a},this.handleWheel=this.onUserScroll.bind(this),this.handleTouchStart=this.onUserScroll.bind(this),this.handleTouchMove=this.onUserScroll.bind(this),this.handleScroll=this.onScroll.bind(this),this.handleKeydown=this.onKeydown.bind(this)}attach(a){this.isDestroyed||(this.detach(),this.scrollContainer=a,this.setupEventListeners(),this.wasAtBottom=this.isAtBottom())}detach(){this.scrollContainer&&(this.scrollContainer.removeEventListener("wheel",this.handleWheel),this.scrollContainer.removeEventListener("touchstart",this.handleTouchStart),this.scrollContainer.removeEventListener("touchmove",this.handleTouchMove),this.scrollContainer.removeEventListener("scroll",this.handleScroll),this.scrollContainer.removeEventListener("keydown",this.handleKeydown)),this.userScrollTimeout&&(clearTimeout(this.userScrollTimeout),this.userScrollTimeout=null),this.rafId&&(cancelAnimationFrame(this.rafId),this.rafId=null),this.scrollContainer=null}setupEventListeners(){this.scrollContainer&&(this.scrollContainer.addEventListener("wheel",this.handleWheel,{passive:!0}),this.scrollContainer.addEventListener("touchstart",this.handleTouchStart,{passive:!0}),this.scrollContainer.addEventListener("touchmove",this.handleTouchMove,{passive:!0}),this.scrollContainer.addEventListener("scroll",this.handleScroll,{passive:!0}),this.scrollContainer.addEventListener("keydown",this.handleKeydown))}onUserScroll(){this.isEnabled&&(this.isUserScrolling=!0,this.userScrollTimeout&&clearTimeout(this.userScrollTimeout),this.userScrollTimeout=setTimeout(()=>{this.isUserScrolling=!1,this.isAtBottom()&&(this.wasAtBottom=!0)},this.config.userScrollTimeout))}onScroll(){this.wasAtBottom=this.isAtBottom()}onKeydown(a){["ArrowUp","ArrowDown","PageUp","PageDown","Home","End"].includes(a.key)&&this.onUserScroll()}isAtBottom(){if(!this.scrollContainer)return!0;const{scrollTop:a,scrollHeight:T,clientHeight:b}=this.scrollContainer;return T-a-b<=this.config.bottomThreshold}scrollToBottom(){!this.scrollContainer||!this.isEnabled||this.isDestroyed||this.isUserScrolling||!this.wasAtBottom||(this.rafId&&cancelAnimationFrame(this.rafId),this.rafId=requestAnimationFrame(()=>{if(this.rafId=null,!this.scrollContainer||this.isDestroyed)return;const a=this.scrollContainer.scrollHeight-this.scrollContainer.clientHeight;this.config.scrollBehavior==="instant"?this.scrollContainer.scrollTop=a:this.scrollContainer.scrollTo({top:a,behavior:"smooth"}),this.wasAtBottom=!0}))}forceScrollToBottom(){!this.scrollContainer||this.isDestroyed||(this.isUserScrolling=!1,this.wasAtBottom=!0,this.userScrollTimeout&&(clearTimeout(this.userScrollTimeout),this.userScrollTimeout=null),this.scrollToBottom())}enable(){this.isEnabled=!0}disable(){this.isEnabled=!1}isAutoScrollActive(){return this.isEnabled&&!this.isUserScrolling&&this.wasAtBottom}isUserScrollingNow(){return this.isUserScrolling}reset(){this.isUserScrolling=!1,this.wasAtBottom=!0,this.userScrollTimeout&&(clearTimeout(this.userScrollTimeout),this.userScrollTimeout=null)}destroy(){this.isDestroyed=!0,this.detach()}}function qe(l={}){const a=new De(l),T=o(!0),b=o(!1);let E=null;function y(n){n?(a.attach(n),p()):(a.detach(),M())}function F(n){Le(n,i=>{y(i)},{immediate:!0})}function p(){M(),E=setInterval(()=>{T.value=a.isAutoScrollActive(),b.value=a.isUserScrollingNow()},100)}function M(){E&&(clearInterval(E),E=null)}function U(){a.scrollToBottom()}function O(){a.forceScrollToBottom()}function H(){a.enable()}function V(){a.disable()}function h(){a.reset(),T.value=!0,b.value=!1}return je(()=>{M(),a.destroy()}),{attach:y,attachRef:F,scrollToBottom:U,forceScrollToBottom:O,enable:H,disable:V,reset:h,isAutoScrollActive:T,isUserScrolling:b}}function Ve({props:l,chapterContent:a,targetWordCount:T,estimates:b,ensureBalance:E,save:y,triggerAutoSave:F,calculateWritingStats:p,countWords:M,selectedText:U,richTextEditor:O,richTextEditorFullscreen:H,isNativeFullscreen:V}){const h=o(!1),n=o(""),i=o(0),d=o(""),$=o(0),f=o(0),w=o(""),I=o(0),ee=o(""),re=o([]),W=o(!1),se=o(!1),K=o(!1),j=o(!1),D=o(!1),z=o(!1),te=o(0),r=o([]),k=10,P=o(!1),L=o(null),q=o(!1),X=o(""),J=o(""),ge=o(0),pe=o(0),me=o(null),we=o([]),Se=o([]),ye=o(null),N=o(null),x=o(0),le=3,ie=o(2e3),Y=o(!1),ae=o(null),Pe=o("progressive"),c=o(null),Ce=o(),{attach:Te,scrollToBottom:be,forceScrollToBottom:Re,reset:Ee,isAutoScrollActive:Me,isUserScrolling:Ae}=qe({userScrollTimeout:2e3,scrollBehavior:"smooth",bottomThreshold:100}),ce=()=>{h.value&&Be(()=>{let t=null;if(V.value){const e=Ce.value;if(e){const u=e.$el||e;t=u?.querySelector("[data-radix-scroll-area-viewport]")||u?.querySelector("[data-viewport]")||u?.querySelector('[role="region"]')}}else t=document.querySelector(".overflow-y-auto.custom-scrollbar");if(!t){const e=document.querySelector("main");if(e){const u=e.querySelectorAll("div");for(const s of u)if(s.scrollHeight>s.clientHeight&&s.classList.contains("overflow-y-auto")){t=s;break}}}t&&(Te(t),be(),requestAnimationFrame(()=>{!Ae.value&&t&&t.scrollTo({top:t.scrollHeight,behavior:"smooth"})}))})},$e=async()=>{if(!navigator.onLine)return v.error("No Internet Connection",{description:"Please check your internet connection and try again."}),!1;const t=navigator.connection||navigator.mozConnection||navigator.webkitConnection;if(t){const e=t.effectiveType;(e==="slow-2g"||e==="2g")&&v.warning("Slow Connection Detected",{description:"Your connection is slow. Content will be auto-saved during generation.",duration:4e3})}try{const e=new AbortController,u=setTimeout(()=>e.abort(),5e3),s=performance.now();await fetch(B("api.ping"),{method:"HEAD",cache:"no-cache",signal:e.signal}),clearTimeout(u);const S=performance.now()-s;console.log("ðŸ“¡ Server latency:",S.toFixed(0),"ms"),S>2e3&&v.info("Connection is slow",{description:"Content will be auto-saved during generation to prevent data loss.",duration:3e3})}catch(e){console.warn("Connection check ping failed:",e),v.info("Connection check skipped",{description:"Content will be auto-saved during generation.",duration:2e3})}return!0},xe=t=>{const e=a.value;e&&(r.value.length>0&&r.value[r.value.length-1].content===e||(r.value.push({content:e,action:t,timestamp:Date.now()}),r.value.length>k&&r.value.shift(),P.value=r.value.length>0))},Ie=()=>{if(r.value.length===0)return v.error("Nothing to undo"),!1;const t=r.value.pop();return t?(L.value=a.value,a.value=t.content,P.value=r.value.length>0,v.success("Undone",{description:`Reverted "${t.action}" action`,action:{label:"Redo",onClick:()=>{L.value&&(xe("Redo"),a.value=L.value,L.value=null)}}}),!0):!1},Ge=()=>{r.value=[],P.value=!1,L.value=null},Ue=async()=>new Promise(t=>{let e=0;const u=120,s=async()=>{try{const m=await(await fetch(B("api.projects.paper-collection.status",{project:l.project.slug}))).json();if(m.success&&m.data){ye.value=m.data;const G=m.data.status,C=m.data.papers_count||m.data.count||0,g=m.data.message,Q=m.data.percentage||0,_=m.data.current_source,R=m.data.sources_completed||[],oe=m.data.papers_preview||[];if(ge.value=C,pe.value=Q,me.value=_,we.value=R,Se.value=oe,G==="completed"){J.value="Complete",X.value=`âœ“ Collected ${C} verified sources from ${R.length} databases`,i.value=50,q.value=!1,N.value&&clearInterval(N.value),t(!0);return}else if(["collecting_papers","initializing","processing","storing"].includes(G)){let ue="";_&&(ue={semantic_scholar:"Semantic Scholar",openalex:"OpenAlex",crossref:"CrossRef",pubmed:"PubMed"}[_]||_),J.value=ue||"Collecting Sources",X.value=g||"Collecting sources from academic databases...",i.value=Math.min(5+Q*.4,45)}else if(G==="collection_failed"){J.value="Error",X.value=g||"âŒ Source collection failed",q.value=!1,N.value&&clearInterval(N.value),t(!1);return}}e++,e>=u&&(J.value="Timeout",X.value="â±ï¸ Source collection timed out",q.value=!1,N.value&&clearInterval(N.value),t(!1))}catch(S){console.error("Error checking paper collection status:",S),e++}};s(),N.value=setInterval(s,5e3)}),_e=async()=>{q.value=!0,J.value="Starting",X.value="Initializing source collection...",i.value=5;try{const t=document.querySelector('meta[name="csrf-token"]')?.content;if(!t)throw new Error("CSRF token not found - please refresh the page");const e=await fetch(B("api.projects.paper-collection.start",{project:l.project.slug}),{method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json","X-CSRF-TOKEN":t,"X-Requested-With":"XMLHttpRequest"},credentials:"include"});if(!e.ok){const u=await e.text();if(console.error("API Error:",e.status,u),e.status===409)try{const s=JSON.parse(u);throw new Error(s.message||"Source collection is already in progress")}catch{throw new Error("Source collection is already in progress for this project")}throw new Error(`Failed to start source collection: ${e.status}`)}return await Ue()}catch(t){return console.error("Paper collection failed:",t),J.value="Error",X.value="âŒ Source collection failed",q.value=!1,!1}},de=async t=>{const e=t==="improve"?300:b.chapter(T.value||0);if(!E(e,t==="improve"?"improve this chapter":"generate this chapter with AI")||!await $e())return;if(h.value=!0,w.value="",f.value=0,i.value=5,d.value="Papers",n.value="Checking for verified sources...",j.value=!0,Ee(),$.value=T.value||0,K.value=!0,!await _e()){v.error("Paper Collection Failed",{description:"Unable to collect verified papers. Please try again."}),h.value=!1,K.value=!1;return}d.value="Initializing",n.value="Starting AI generation with verified sources...",i.value=51;const m=setInterval(()=>{i.value<52&&h.value?i.value+=.2:clearInterval(m)},100),G=B("chapters.stream",{project:l.project.slug,chapter:l.chapter.chapter_number});c.value=new EventSource(`${G}?generation_type=${t}`),c.value.onmessage=C=>{const g=JSON.parse(C.data);switch(g.type){case"start":d.value="Connecting",i.value=52,n.value="Connecting to AI service...";break;case"content":d.value="Generating",w.value+=g.content,f.value=g.word_count||w.value.split(/\s+/).filter(R=>R.length>0).length;const Q=Date.now();if(Q-I.value>200){a.value=w.value,I.value=Q;const R=Math.min(f.value/Math.max($.value,1)*43,43);i.value=Math.max(52,52+R),n.value=`Generating chapter content... (${f.value} / ${$.value} words)`,ce()}break;case"heartbeat":i.value<95&&(i.value+=.5);break;case"complete":d.value="Complete",i.value=100,h.value=!1,j.value=!1,a.value=w.value;const _=g.final_word_count||f.value;n.value=`âœ“ Generated ${_} words successfully`,p(),ve(_,`Chapter generation (${l.chapter.chapter_number})`,"chapter",l.chapter.id).catch(R=>console.error("Failed to record word usage (chapter generation):",R)),setTimeout(()=>{F()},500),c.value?.close(),c.value=null;break;case"error":d.value="Error",i.value=50,j.value=!1,g.partial_saved&&(z.value=!0,te.value=g.saved_word_count||0),g.code==="OFFLINE_MODE"?(n.value="ðŸ“¡ AI services offline",h.value=!1,v.error("AI Services Offline",{description:"Please check your internet connection and try again."})):g.can_resume?(n.value=`âš ï¸ Generation interrupted (${g.saved_word_count} words saved)`,h.value=!1,D.value=!0,v.warning("Generation Interrupted",{description:`${g.saved_word_count} words were saved. You can resume generation.`,duration:8e3})):(n.value="âŒ Generation failed",h.value=!1,v.error("Generation Error",{description:g.message||"Please try again."})),c.value?.close(),c.value=null;break;case"autosave":g.word_count&&g.generation_id&&(ae.value=g.generation_id);break}},c.value.onerror=()=>{if(x.value<le){x.value++,Y.value=!0,d.value="Reconnecting",n.value=`ðŸ”„ Connection lost. Reconnecting... (${x.value}/${le})`,c.value?.close(),c.value=null;const C=ie.value*Math.pow(2,x.value-1);setTimeout(()=>he(t),C)}else d.value="Error",i.value=50,h.value=!1,Y.value=!1,n.value="âŒ Connection failed after multiple attempts",f.value>100?(z.value=!0,te.value=f.value,D.value=!0,v.warning("Connection Lost",{description:`${f.value} words may have been saved. Check and resume if needed.`,duration:8e3})):v.error("Connection Error",{description:"Please check your internet connection and try again."}),c.value?.close(),c.value=null,x.value=0,ie.value=2e3}},he=t=>{c.value&&(c.value.close(),c.value=null);const e=B("chapters.stream",{project:l.project.slug,chapter:l.chapter.chapter_number}),u=new URLSearchParams({generation_type:t,resume_from:f.value.toString()});ae.value&&u.set("generation_id",ae.value),c.value=new EventSource(`${e}?${u}`),c.value.onmessage=s=>{const S=JSON.parse(s.data);switch(["content","start"].includes(S.type)&&(Y.value=!1,x.value=0,d.value="Generating"),S.type){case"start":n.value="âœ… Reconnected! Continuing generation...",v.success("Reconnected",{description:"Generation resumed successfully.",duration:3e3});break;case"content":d.value="Generating",w.value+=S.content,f.value=S.word_count||w.value.split(/\s+/).filter(C=>C.length>0).length;const m=Date.now();if(m-I.value>150){a.value=w.value,I.value=m;const C=Math.min(f.value/Math.max($.value,1)*43,43);i.value=Math.max(52,52+C),n.value=`Generating chapter content... (${f.value} / ${$.value} words)`,ce()}break;case"complete":d.value="Complete",i.value=100,h.value=!1,Y.value=!1,a.value=w.value;const G=S.final_word_count||f.value;n.value=`âœ“ Generated ${G} words successfully`,ve(G,`Chapter generation (${l.chapter.chapter_number})`,"chapter",l.chapter.id).catch(C=>console.error("Failed to record word usage:",C)),setTimeout(()=>{F()},500),c.value?.close(),c.value=null;break;case"error":d.value="Error",h.value=!1,Y.value=!1,n.value="âŒ Generation failed",v.error("Generation Error",{description:S.message||"Please try again."}),c.value?.close(),c.value=null;break;case"autosave":S.generation_id&&(ae.value=S.generation_id);break}},c.value.onerror=()=>{if(x.value<le){x.value++;const s=ie.value*Math.pow(2,x.value-1);n.value=`ðŸ”„ Reconnecting... (${x.value}/${le})`,c.value?.close(),setTimeout(()=>he(t),s)}else d.value="Error",h.value=!1,Y.value=!1,n.value="âŒ Connection failed",f.value>100?(D.value=!0,v.warning("Connection Lost",{description:`${f.value} words may be saved. Refresh to recover.`})):v.error("Connection Error",{description:"Please check your connection and try again."}),c.value?.close(),c.value=null,x.value=0}},ke=async t=>{h.value=!0,w.value="",f.value=0,i.value=5,d.value="Papers",n.value="Checking for verified sources...",$.value=600,ee.value=a.value||l.chapter.content||"",K.value=!0;try{i.value=50,d.value="Papers",n.value="Using existing verified sources...",await new Promise(u=>setTimeout(u,500)),d.value="Section",n.value=`Generating ${t} section with verified sources...`,i.value=51;const e=B("chapters.stream",{project:l.project.slug,chapter:l.chapter.chapter_number});c.value=new EventSource(`${e}?generation_type=section&section_type=${t}`),c.value.onmessage=u=>{const s=JSON.parse(u.data);switch(s.type){case"start":d.value="Generating Section",i.value=52,n.value=`Starting ${t} section generation...`;break;case"content":w.value+=s.content,f.value=s.word_count||M(w.value);const S=Date.now();if(S-I.value>150){a.value=ee.value+`

`+w.value,I.value=S;const m=Math.min(f.value/$.value*43,43);i.value=Math.max(52,52+m),n.value=`Generating ${t} section... (${f.value} / ${$.value} words)`,p(),ce()}break;case"complete":i.value=100,d.value="Complete",n.value=`âœ“ Generated ${t} section (${f.value} words)`,a.value=ee.value+`

`+w.value,y(!0),v.success("âœ… Section Generated Successfully",{description:`Added ${t} section with ${f.value} words and verified citations.`,duration:5e3}),h.value=!1,c.value?.close();break;case"error":throw new Error(s.message||"Section generation failed");case"heartbeat":i.value<95&&(i.value+=.5);break}},c.value.onerror=()=>{h.value=!1,d.value="Error",n.value="âŒ Section generation failed",v.error("âŒ Generation Failed",{description:"Unable to generate section. Please check your connection and try again."}),c.value?.close()}}catch(e){console.error("Section generation failed:",e),h.value=!1,d.value="Error",n.value="âŒ Section generation error",v.error("âŒ Generation Failed",{description:"Section generation encountered an error."})}},fe=async(t,e,u)=>{const s=t.split(/\s+/).length;if(!E(300,`${e} selected text`))return;h.value=!0,w.value="",f.value=0,i.value=10,d.value=e==="rephrase"?"Rephrasing":"Expanding",n.value=`${e==="rephrase"?"Rephrasing":"Expanding"} selected text...`,$.value=Math.max(s*(e==="expand"?2:1),100);const m=H.value||O.value,G=m?.getSelectionRange(),C={originalText:t,range:G,wordCount:s,style:u||"Academic Formal",startTime:Date.now()};K.value=!0;try{const g=document.querySelector('meta[name="csrf-token"]')?.content;if(!g)throw new Error("CSRF token not found - please refresh the page");const Q=e==="rephrase"?B("chapters.quick-actions.rephrase",{project:l.project.slug,chapter:l.chapter.chapter_number}):B("chapters.quick-actions.expand",{project:l.project.slug,chapter:l.chapter.chapter_number});i.value=35;const _=await fetch(Q,{method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json","X-CSRF-TOKEN":g,"X-Requested-With":"XMLHttpRequest"},credentials:"include",body:JSON.stringify({text:t,...e==="rephrase"?{style:C.style}:{}})});if(!_.ok){let Z=`Request failed (${_.status})`;try{const ne=await _.json();Z=ne?.message||ne?.error||ne?.data?.message||Z}catch{}throw new Error(Z)}const R=await _.json(),oe=String(R?.text||"").trim();if(!oe)throw new Error("Empty response from AI service");i.value=100,d.value="Complete",n.value=`âœ“ Text ${e==="rephrase"?"rephrased":"expanded"} successfully`,C.range&&(m?.replaceSelection(oe,C.range)?setTimeout(()=>{const ne=m?.getHTML()||a.value;a.value=ne},50):v.warning("Please manually replace the selected text",{description:"The generated text is ready but could not be automatically inserted."})),y(!0),v.success(`âœ… Text ${e==="rephrase"?"Rephrased":"Expanded"} Successfully`,{description:`${e==="rephrase"?"Rephrased":"Expanded"} selection (${s} words).`});const ue=Number(R?.word_count)||M(oe)||(e==="expand"?s*2:s);ve(ue,e==="rephrase"?`Rephrase (${C.style})`:"Expand text","chapter",l.chapter.id).catch(Z=>console.error(`Failed to record word usage (${e}):`,Z)),h.value=!1}catch(g){console.error("Selection generation failed:",g),h.value=!1,d.value="Error",n.value=`âŒ Text ${e==="rephrase"?"rephrasing":"expansion"} error`,v.error(`âŒ ${e==="rephrase"?"Rephrasing":"Expansion"} Failed`,{description:g instanceof Error?g.message:"Text generation encountered an error."})}};return{isGenerating:h,generationProgress:n,generationPercentage:i,generationPhase:d,estimatedTotalWords:$,streamWordCount:f,streamBuffer:w,lastStreamUpdate:I,originalContentForAppend:ee,aiSuggestions:re,isLoadingSuggestions:W,showCitationHelper:se,showPresentationMode:K,isStreamingMode:j,showRecoveryDialog:D,partialContentSaved:z,savedWordCountOnError:te,isCollectingPapers:q,paperCollectionProgress:X,paperCollectionPhase:J,collectedPapersCount:ge,paperCollectionPercentage:pe,currentSource:me,sourcesCompleted:we,papersPreview:Se,paperCollectionData:ye,paperCollectionInterval:N,reconnectAttempts:x,reconnectDelay:ie,isReconnecting:Y,currentGenerationId:ae,currentGenerationType:Pe,eventSource:c,editorScrollRef:Ce,attachScroller:Te,smoothScrollToBottom:be,forceScrollToBottom:Re,resetScroller:Ee,isAutoScrollActive:Me,isUserScrollingScroller:Ae,scrollToBottom:ce,checkConnectionQuality:$e,startPaperCollection:_e,startStreamingGeneration:de,attemptReconnection:he,startSectionGeneration:ke,handleSelectionGeneration:fe,handleAIGeneration:(t,e)=>{t==="section"&&e?.section?ke(e.section):t==="rephrase"&&e?.selectedText?fe(e.selectedText,"rephrase",e.style):t==="expand"&&e?.selectedText?fe(e.selectedText,"expand"):de(t)},getAISuggestions:async()=>{if(!U.value)return;const t=b.suggestion();if(E(t,"get AI suggestions")){W.value=!0;try{const u=await(await fetch(B("chapters.suggestions",{project:l.project.slug,chapter:l.chapter.chapter_number}),{method:"POST",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":document.querySelector('meta[name="csrf-token"]')?.getAttribute("content")||""},body:JSON.stringify({selected_text:U.value,context:a.value})})).json();re.value=u.suggestions||[],re.value.length&&ve(b.suggestion(),"AI suggestions","chapter",l.chapter.id).catch(s=>console.error("Failed to record word usage (suggestions):",s))}catch{v.error("Error getting suggestions",{description:"Please try again."})}finally{W.value=!1}}},checkCitations:()=>{se.value=!0,v.success("Citation Manager opened!",{description:"Review and verify your citations in the panel below."})},insertCitation:t=>{try{const e=H.value?.editor||O.value?.editor;if(!e){v.error("Editor not found");return}const{from:u}=e.state.selection;e.chain().focus().insertContentAt(u,` ${t} `).run(),v.success("Citation inserted successfully")}catch(e){console.error("Failed to insert citation:",e),v.error("Failed to insert citation")}},resumeGeneration:()=>{D.value=!1,z.value=!1,window.location.reload()},dismissRecovery:()=>{D.value=!1,z.value=!1,te.value=0},checkForAutoGeneration:()=>{const t=new URLSearchParams(window.location.search),e=t.get("ai_generate")==="true",u=t.get("generation_type");!e||!u||setTimeout(()=>{de("progressive");const s=new URL(window.location.href);s.searchParams.delete("ai_generate"),s.searchParams.delete("generation_type"),window.history.replaceState({},"",s.toString()),v.success("ðŸš€ AI Generation Started",{description:`Generating ${l.chapter.title} with AI assistance...`})},1e3)},contentHistory:r,canUndo:P,pushToHistory:xe,undoLastAction:Ie,clearHistory:Ge}}function et(l,a=o(3e3),T=.8){const b=r=>{if(!r)return 0;const P=r.replace(/<[^>]*>/g,"").trim().replace(/\s+/g," ");if(!P)return 0;const L=P.match(/\b\w+\b/g);return L?L.length:0},E=r=>r?r.replace(/<[^>]*>/g,"").replace(/\r\n|\r/g,`
`).trim().split(/\n\s*\n/).filter(q=>q.trim().length>0).length:0,y=r=>{if(!r)return 0;const P=r.replace(/<[^>]*>/g,"").match(/[.!?]+/g);return P?P.length:0},F=r=>Math.round(r/200*10)/10,p=A(()=>b(l.value)),M=A(()=>l.value.length),U=A(()=>l.value.replace(/\s/g,"").length),O=A(()=>E(l.value)),H=A(()=>y(l.value)),V=A(()=>F(p.value)),h=A(()=>{const r=a.value;return!r||r<=0?0:Math.min(p.value/r*100,100)}),n=A(()=>p.value>=a.value*T),i=A(()=>{const r=a.value-p.value;return Math.max(r,0)}),d=A(()=>{const r=a.value*T-p.value;return Math.max(r,0)}),$=A(()=>({wordCount:p.value,characterCount:M.value,characterCountNoSpaces:U.value,paragraphCount:O.value,sentenceCount:H.value,readingTimeMinutes:V.value})),f=A(()=>({current:p.value,target:a.value,percentage:h.value,isComplete:n.value,completionThreshold:T})),w=r=>r>=1e3?`${Math.round(r/100)/10}k`:r.toString(),I=(r=0)=>`${Math.round(h.value*Math.pow(10,r))/Math.pow(10,r)}%`,ee=()=>`${p.value} / ${a.value} words (${I()}%)`,re=()=>{if(n.value)return`âœ… Complete (${w(p.value)} words)`;const r=d.value;return`${w(r)} more words to complete`},W=()=>{const r=p.value,k=a.value;return r===0?"empty":r<k*.25?"started":r<k*.75?"progressing":r<k*T?"near_complete":r<k?"complete":"exceeded"},se=()=>{const r=W();return{empty:"text-gray-500",started:"text-blue-500",progressing:"text-yellow-500",near_complete:"text-orange-500",complete:"text-green-500",exceeded:"text-emerald-600"}[r]},K=()=>{const r=W();return{empty:"bg-gray-200",started:"bg-blue-200",progressing:"bg-yellow-200",near_complete:"bg-orange-200",complete:"bg-green-200",exceeded:"bg-emerald-200"}[r]},j=800,D=A(()=>p.value>=j),z=A(()=>Math.max(j-p.value,0)),te=A(()=>Math.min(p.value/j*100,100));return{currentWordCount:p,characterCount:M,characterCountNoSpaces:U,paragraphCount:O,sentenceCount:H,readingTimeMinutes:V,progressPercentage:h,isComplete:n,wordsRemaining:i,wordsToComplete:d,wordCountStats:$,wordCountProgress:f,meetsDefenseThreshold:D,defenseWordsRemaining:z,defenseProgressPercentage:te,DEFENSE_THRESHOLD:j,formatWordCount:w,formatProgress:I,getProgressDisplay:ee,getCompletionDisplay:re,getWordCountStatus:W,getStatusColor:se,getProgressBarColor:K,countWords:b}}export{Ze as a,Ve as b,et as u};
