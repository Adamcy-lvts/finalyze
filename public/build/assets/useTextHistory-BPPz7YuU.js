import{c as P,_ as L}from"./index-Bupl7fKY.js";import{aw as V,ax as G,ay as J,az as Q,aA as Z,aB as K,aC as X,aD as Y,aE as ee,aF as te,aG as re,aH as ae,aI as oe,aJ as se}from"./RichTextEditor-DnPpxxFI.js";import{d as q,z as R,h as ne,Q as le,G as ce,a as M,o as $,k as l,u as s,g as U,w as p,c as z,F as H,s as y,f as v,q as I,t as b,A as ie,n as de,y as S}from"./app-Ny7D0hgf.js";import{_ as pe}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{_ as B}from"./index-Bz77OLxf.js";import{_ as ue,a as me}from"./CardContent.vue_vue_type_script_setup_true_lang-DbElbaMI.js";import{_ as he}from"./Checkbox.vue_vue_type_script_setup_true_lang-DATP6oSV.js";import{_ as fe,d as ge,a as ve,b as xe,c as _e}from"./DialogTitle.vue_vue_type_script_setup_true_lang-C80_BKsw.js";import{_ as ye}from"./DialogFooter.vue_vue_type_script_setup_true_lang-DdeSjYSa.js";import{e as ke,_ as we,a as be,b as O,c as N,d as Ce}from"./DropdownMenuTrigger.vue_vue_type_script_setup_true_lang-D3hJer-Q.js";import{_ as $e}from"./ScrollArea.vue_vue_type_script_setup_true_lang-B0S9Ql21.js";import{_ as je}from"./Separator.vue_vue_type_script_setup_true_lang-BpuKr2xG.js";import{t as g}from"./Sonner.vue_vue_type_script_setup_true_lang-DGsYSM7L.js";import{D as A}from"./download-DnJOy4aC.js";import{C as Fe}from"./chevron-down-DV2jaFc6.js";import{F as W}from"./file-text-DywEfGwH.js";/**
 * @license lucide-vue-next v0.468.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ot=P("BookCheckIcon",[["path",{d:"M4 19.5v-15A2.5 2.5 0 0 1 6.5 2H19a1 1 0 0 1 1 1v18a1 1 0 0 1-1 1H6.5a1 1 0 0 1 0-5H20",key:"k3hazp"}],["path",{d:"m9 9.5 2 2 4-4",key:"1dth82"}]]);/**
 * @license lucide-vue-next v0.468.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Pe=P("FileDownIcon",[["path",{d:"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z",key:"1rqfz7"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}],["path",{d:"M12 18v-6",key:"17g6i2"}],["path",{d:"m9 15 3 3 3-3",key:"1npd3o"}]]);/**
 * @license lucide-vue-next v0.468.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const st=P("Maximize2Icon",[["polyline",{points:"15 3 21 3 21 9",key:"mznyad"}],["polyline",{points:"9 21 3 21 3 15",key:"1avn1i"}],["line",{x1:"21",x2:"14",y1:"3",y2:"10",key:"ota7mn"}],["line",{x1:"3",x2:"10",y1:"21",y2:"14",key:"1atl0r"}]]);/**
 * @license lucide-vue-next v0.468.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const nt=P("MenuIcon",[["line",{x1:"4",x2:"20",y1:"12",y2:"12",key:"1e0a9i"}],["line",{x1:"4",x2:"20",y1:"6",y2:"6",key:"1owob3"}],["line",{x1:"4",x2:"20",y1:"18",y2:"18",key:"yk5zj1"}]]);/**
 * @license lucide-vue-next v0.468.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const lt=P("Minimize2Icon",[["polyline",{points:"4 14 10 14 10 20",key:"11kfnr"}],["polyline",{points:"20 10 14 10 14 4",key:"rlmsce"}],["line",{x1:"14",x2:"21",y1:"10",y2:"3",key:"o5lafz"}],["line",{x1:"3",x2:"10",y1:"21",y2:"14",key:"1atl0r"}]]);/**
 * @license lucide-vue-next v0.468.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ct=P("PanelRightCloseIcon",[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",key:"afitv7"}],["path",{d:"M15 3v18",key:"14nvp0"}],["path",{d:"m8 9 3 3-3 3",key:"12hl5m"}]]);/**
 * @license lucide-vue-next v0.468.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const it=P("PanelRightOpenIcon",[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",key:"afitv7"}],["path",{d:"M15 3v18",key:"14nvp0"}],["path",{d:"m10 15-3-3 3-3",key:"1pgupc"}]]),Ee=q({__name:"RichTextViewer",props:{content:{},showFontControls:{type:Boolean,default:!0}},setup(E){const x=V(se),f=E,n=t=>t?(t=t.replace(/```mermaid\n?([\s\S]*?)```/g,(h,r)=>{const d=r.trim();return`<div data-mermaid data-mermaid-code="${d.replace(/&/g,"&amp;").replace(/"/g,"&quot;").replace(/</g,"&lt;").replace(/>/g,"&gt;")}" data-view-mode="diagram"><pre><code class="language-mermaid">${d}</code></pre></div>`}),t=t.replace(/``mermaid\n?([\s\S]*?)``/g,(h,r)=>{const d=r.trim();return`<div data-mermaid data-mermaid-code="${d.replace(/&/g,"&amp;").replace(/"/g,"&quot;").replace(/</g,"&lt;").replace(/>/g,"&gt;")}" data-view-mode="diagram"><pre><code class="language-mermaid">${d}</code></pre></div>`}),t=t.replace(/`mermaid\n([\s\S]*?)`/g,(h,r)=>{const d=r.trim();return`<div data-mermaid data-mermaid-code="${d.replace(/&/g,"&amp;").replace(/"/g,"&quot;").replace(/</g,"&lt;").replace(/>/g,"&gt;")}" data-view-mode="diagram"><pre><code class="language-mermaid">${d}</code></pre></div>`}),t):"",j=t=>t?(t=t.replace(/```(\w+)\n?([\s\S]*?)```/g,(h,r,d)=>`<pre><code class="language-${r}">${d.trim()}</code></pre>`),t=t.replace(/```\n?([\s\S]*?)```/g,(h,r)=>`<pre><code>${r.trim()}</code></pre>`),t):"",F=t=>{if(!t)return"";const h=t.split(`
`);let r=[],d=0;for(;d<h.length;){const a=h[d];if(a.includes("|")){const e=T(h,d);if(e.html){r.push(e.html),d=e.nextIndex;continue}}r.push(a),d++}return r.join(`
`)},T=(t,h)=>{let r=t[h];if(!r||!r.includes("|"))return{html:null,nextIndex:h+1};const d=r.split("|").map(c=>c.trim()).filter(c=>c.length>0);if(d.length===0)return{html:null,nextIndex:h+1};const a=t[h+1];if(!a||!a.includes("|")||!a.includes("-"))return{html:null,nextIndex:h+1};let e=[],o=h+2;for(;o<t.length;){const c=t[o];if(!c||!c.includes("|"))break;const u=c.split("|").map(m=>m.trim()).filter(m=>m.length>0);u.length>0&&e.push(u),o++}let i='<div class="tableWrapper"><table>';return i+="<thead><tr>",d.forEach(c=>{i+=`<th>${c}</th>`}),i+="</tr></thead>",e.length>0&&(i+="<tbody>",e.forEach(c=>{i+="<tr>";for(let u=0;u<d.length;u++){const m=c[u]||"";i+=`<td>${m}</td>`}i+="</tr>"}),i+="</tbody>"),i+="</table></div>",{html:i,nextIndex:o}},D=t=>{if(!t)return"";if(t.includes("<p>")||t.includes("<h1>")||t.includes("<h2>")||t.includes("<div>")){let a=n(t);return a=j(a),a}let r=t;return r=n(r),r=j(r),r=r.replace(/^#### (.*$)/gim,"<h4>$1</h4>"),r=r.replace(/^### (.*$)/gim,"<h3>$1</h3>"),r=r.replace(/^## (.*$)/gim,"<h2>$1</h2>"),r=r.replace(/^# (.*$)/gim,"<h1>$1</h1>"),r=r.replace(/\*\*(.*?)\*\*/g,"<strong>$1</strong>"),r=r.replace(new RegExp("(?<!\\*)\\*([^*\\n]+?)\\*(?!\\*)","g"),"<em>$1</em>"),r=r.replace(/`([^`]+)`/g,"<code>$1</code>"),r=F(r),r.split(/\n\s*\n/).filter(a=>a.trim()).map(a=>{const e=a.trim();if(e.startsWith("<h1>")||e.startsWith("<h2>")||e.startsWith("<h3>")||e.startsWith("<h4>"))return e;if(e.includes(`
`)){const i=e.split(`
`).map(m=>m.trim()).filter(m=>m),c=i.some(m=>m.match(/^\d+\.\s/)),u=i.some(m=>m.match(/^[-*]\s/));if(c||u){const m=i.map(C=>C.match(/^\d+\.\s/)?`<li>${C.replace(/^\d+\.\s/,"")}</li>`:C.match(/^[-*]\s/)?`<li>${C.replace(/^[-*]\s/,"")}</li>`:C);let k=[],w="";for(const C of m)C.startsWith("<li>")?(w&&k.push(w),w=C):w&&(w=w.replace("</li>",` ${C}</li>`));return w&&k.push(w),c?`<ol>${k.join("")}</ol>`:`<ul>${k.join("")}</ul>`}}return`<p>${e.replace(/\n/g,"<br>")}</p>`}).join("")},_=G({content:D(f.content),editable:!1,extensions:[J.configure({heading:{levels:[1,2,3]},codeBlock:!1}),Q.configure({lowlight:x,HTMLAttributes:{class:"code-block-highlighted"}}),Z,K,X,Y.configure({resizable:!0}),ee,te,re,ae],editorProps:{attributes:{class:"prose prose-sm dark:prose-invert max-w-none focus:outline-none"}}});return R("12"),ne(()=>{setTimeout(()=>{_.value&&_.value.chain().selectAll().setFontSize("12pt").run()},100)}),le(()=>f.content,t=>{if(_.value&&_.value.getHTML()!==t){const h=D(t);_.value.commands.setContent(h)}}),ce(()=>{_.value&&_.value.destroy()}),(t,h)=>($(),M("div",null,[l(s(oe),{editor:s(_)},null,8,["editor"])]))}}),dt=pe(Ee,[["__scopeId","data-v-3b560c28"]]),Te={class:"inline-flex"},De={class:"space-y-4"},Le={class:"flex items-center justify-between"},Me={class:"flex items-center gap-2 text-sm text-muted-foreground"},Re={class:"flex items-center gap-2"},Ue={class:"space-y-2"},ze={class:"flex items-start gap-3"},Se={class:"flex-1 min-w-0"},Ae={class:"flex items-center gap-2 mb-1"},He={class:"font-medium truncate"},Ie={class:"flex items-center gap-4 text-sm text-muted-foreground"},Be={key:0},pt=q({__name:"ExportMenu",props:{project:{},currentChapter:{},allChapters:{},triggerElement:{default:"button"},size:{default:"default"},variant:{default:"outline"}},setup(E){const x=E,f=R(!1),n=R([]),j=U(()=>x.allChapters.filter(a=>a.content&&a.content.trim().length>0)),F=U(()=>n.value.length),T=U(()=>x.allChapters.filter(a=>n.value.includes(a.chapter_number)).reduce((a,e)=>a+e.word_count,0)),D=async()=>{g.loading("Generating project PDF...",{id:"export-project-pdf"});const a=S("export.project.pdf",{project:x.project.slug});try{const e=await fetch(a,{method:"GET",headers:{Accept:"application/pdf"}});if(e.ok){const o=e.headers.get("content-type");if(o&&o.includes("application/json")){const m=await e.json();g.error("Export Failed",{id:"export-project-pdf",description:m.message||"An error occurred during PDF export."});return}const i=await e.blob(),c=window.URL.createObjectURL(i),u=document.createElement("a");u.href=c,u.download=`${x.project.slug}_full_project.pdf`,document.body.appendChild(u),u.click(),document.body.removeChild(u),window.URL.revokeObjectURL(c),g.success("Project PDF exported successfully!",{id:"export-project-pdf",description:`${x.project.title} has been downloaded as PDF.`})}else try{const o=await e.json();g.error("Export Failed",{id:"export-project-pdf",description:o.message||"An error occurred during PDF export."})}catch{g.error("Export Failed",{id:"export-project-pdf",description:"Unable to export project as PDF. Please try again."})}}catch{g.error("Export Failed",{id:"export-project-pdf",description:"Network error occurred. Please check your connection and try again."})}},_=async()=>{if(n.value.length===0){g.error("No chapters selected",{description:"Please select at least one chapter to export."});return}try{g.loading(`Exporting ${n.value.length} chapters...`,{id:"export-chapters"});const a=S("export.chapters.word",{project:x.project.slug}),e=new FormData;n.value.forEach(c=>{e.append("chapters[]",c.toString())});const o=document.querySelector('meta[name="csrf-token"]')?.getAttribute("content");o&&e.append("_token",o);const i=await fetch(a,{method:"POST",body:e,headers:{Accept:"application/json"}});if(i.ok){const c=i.headers.get("content-type");if(c&&c.includes("application/json")){const w=await i.json();g.error("Export Failed",{id:"export-chapters",description:w.message||"An error occurred during export."});return}const u=await i.blob(),m=window.URL.createObjectURL(u),k=document.createElement("a");k.href=m,k.download=`${x.project.slug}-chapters-${n.value.join("-")}.docx`,document.body.appendChild(k),k.click(),document.body.removeChild(k),window.URL.revokeObjectURL(m),g.success("Selected chapters exported successfully!",{id:"export-chapters",description:`${n.value.length} chapters exported to Word.`}),n.value=[],f.value=!1}else try{const c=await i.json();g.error("Export Failed",{id:"export-chapters",description:c.message||"An error occurred during export."})}catch{g.error("Export Failed",{id:"export-chapters",description:"Unable to export selected chapters. Please try again."})}}catch{g.error("Export Failed",{id:"export-chapters",description:"Network error occurred. Please check your connection and try again."})}},t=a=>{const e=n.value.indexOf(a);e>-1?n.value.splice(e,1):n.value.push(a)},h=()=>{n.value=j.value.map(a=>a.chapter_number)},r=()=>{n.value=[]},d=async()=>{g.loading("Generating PDF...",{id:"export-chapter-pdf"});const a=S("export.chapter.pdf",{project:x.project.slug,chapterNumber:x.currentChapter.chapter_number});try{const e=await fetch(a,{method:"GET",headers:{Accept:"application/pdf"}});if(e.ok){const o=e.headers.get("content-type");if(o&&o.includes("application/json")){const m=await e.json();g.error("Export Failed",{id:"export-chapter-pdf",description:m.message||"An error occurred during PDF export."});return}const i=await e.blob(),c=window.URL.createObjectURL(i),u=document.createElement("a");u.href=c,u.download=`chapter_${x.currentChapter.chapter_number}_${x.currentChapter.title.toLowerCase().replace(/\s+/g,"_")}.pdf`,document.body.appendChild(u),u.click(),document.body.removeChild(u),window.URL.revokeObjectURL(c),g.success("PDF exported successfully!",{id:"export-chapter-pdf",description:`${x.currentChapter.title} has been downloaded as PDF.`})}else try{const o=await e.json();g.error("Export Failed",{id:"export-chapter-pdf",description:o.message||"An error occurred during PDF export."})}catch{g.error("Export Failed",{id:"export-chapter-pdf",description:"Unable to export chapter as PDF. Please try again."})}}catch{g.error("Export Failed",{id:"export-chapter-pdf",description:"Network error occurred. Please check your connection and try again."})}};return(a,e)=>($(),M("div",Te,[l(s(ke),null,{default:p(()=>[l(s(we),{asChild:""},{default:p(()=>[l(s(L),{variant:a.variant,size:a.size,class:"gap-2"},{default:p(()=>[a.triggerElement==="button"?($(),M(H,{key:0},[l(s(A),{class:"h-4 w-4"}),e[2]||(e[2]=y(" Export ",-1)),l(s(Fe),{class:"h-3 w-3"})],64)):($(),z(s(A),{key:1,class:"h-4 w-4"}))]),_:1},8,["variant","size"])]),_:1}),l(s(be),{align:"end",class:"w-64"},{default:p(()=>[l(s(O),null,{default:p(()=>[...e[3]||(e[3]=[y("Current Chapter",-1)])]),_:1}),l(s(N),{onClick:d,class:"gap-2"},{default:p(()=>[l(s(W),{class:"h-4 w-4"}),e[4]||(e[4]=v("div",{class:"flex flex-col"},[v("span",{class:"font-medium"},"Export as PDF"),v("span",{class:"text-xs text-muted-foreground"}," Professional academic format ")],-1))]),_:1}),l(s(Ce)),l(s(O),null,{default:p(()=>[...e[5]||(e[5]=[y("Full Project",-1)])]),_:1}),l(s(N),{onClick:D,class:"gap-2"},{default:p(()=>[l(s(W),{class:"h-4 w-4"}),e[6]||(e[6]=v("div",{class:"flex flex-col"},[v("span",{class:"font-medium"},"Export as PDF"),v("span",{class:"text-xs text-muted-foreground"}," Professional academic format with cover page ")],-1))]),_:1})]),_:1})]),_:1}),l(s(fe),{open:f.value,"onUpdate:open":e[1]||(e[1]=o=>f.value=o)},{default:p(()=>[l(s(ge),{class:"max-w-2xl"},{default:p(()=>[l(s(ve),null,{default:p(()=>[l(s(xe),{class:"flex items-center gap-2"},{default:p(()=>[l(s(Pe),{class:"h-5 w-5"}),e[7]||(e[7]=y(" Select Chapters to Export ",-1))]),_:1}),l(s(_e),null,{default:p(()=>[...e[8]||(e[8]=[y(" Choose which chapters you want to include in your Word export. Only chapters with content can be exported. ",-1)])]),_:1})]),_:1}),v("div",De,[v("div",Le,[v("div",Me,[v("span",null,b(F.value)+" of "+b(j.value.length)+" chapters selected",1),T.value>0?($(),z(s(B),{key:0,variant:"outline",class:"text-xs"},{default:p(()=>[y(b(T.value.toLocaleString())+" words ",1)]),_:1})):I("",!0)]),v("div",Re,[l(s(L),{onClick:h,variant:"ghost",size:"sm"},{default:p(()=>[...e[9]||(e[9]=[y(" Select All ",-1)])]),_:1}),l(s(L),{onClick:r,variant:"ghost",size:"sm"},{default:p(()=>[...e[10]||(e[10]=[y(" Clear ",-1)])]),_:1})])]),l(s(je)),l(s($e),{class:"h-[300px]"},{default:p(()=>[v("div",Ue,[($(!0),M(H,null,ie(j.value,o=>($(),z(s(ue),{key:o.id,class:de(["cursor-pointer transition-colors hover:bg-muted/50",{"ring-2 ring-primary":n.value.includes(o.chapter_number),"bg-muted/30":n.value.includes(o.chapter_number)}]),onClick:i=>t(o.chapter_number)},{default:p(()=>[l(s(me),{class:"p-4"},{default:p(()=>[v("div",ze,[l(s(he),{checked:n.value.includes(o.chapter_number),"onUpdate:checked":i=>t(o.chapter_number),class:"mt-1"},null,8,["checked","onUpdate:checked"]),v("div",Se,[v("div",Ae,[v("h4",He," Chapter "+b(o.chapter_number)+": "+b(o.title),1),l(s(B),{variant:o.status==="approved"?"default":"secondary",class:"text-xs"},{default:p(()=>[y(b(o.status.replace("_"," ")),1)]),_:2},1032,["variant"])]),v("div",Ie,[v("span",null,b(o.word_count.toLocaleString())+" words",1),o.word_count>0?($(),M("span",Be,b(Math.ceil(o.word_count/250))+" pages approx. ",1)):I("",!0)])])])]),_:2},1024)]),_:2},1032,["class","onClick"]))),128))])]),_:1})]),l(s(ye),null,{default:p(()=>[l(s(L),{onClick:e[0]||(e[0]=o=>f.value=!1),variant:"outline"},{default:p(()=>[...e[11]||(e[11]=[y(" Cancel ",-1)])]),_:1}),l(s(L),{onClick:_,disabled:F.value===0,class:"gap-2"},{default:p(()=>[l(s(A),{class:"h-4 w-4"}),y(" Export "+b(F.value)+" Chapter"+b(F.value===1?"":"s"),1)]),_:1},8,["disabled"])]),_:1})]),_:1})]),_:1},8,["open"])]))}});function ut(E="",x=50){const f=R([E]),n=R(0);return{contentHistory:f,historyIndex:n,addToHistory:t=>{f.value[n.value]!==t&&(f.value=f.value.slice(0,n.value+1),f.value.push(t),f.value.length>x?f.value.shift():n.value++)},undo:()=>n.value>0?(n.value--,f.value[n.value]):null,redo:()=>n.value<f.value.length-1?(n.value++,f.value[n.value]):null,canUndo:()=>n.value>0,canRedo:()=>n.value<f.value.length-1}}export{ot as B,nt as M,ct as P,dt as R,pt as _,lt as a,st as b,it as c,ut as u};
