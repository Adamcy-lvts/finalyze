const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/ChapterNavigation-gfT-8s8o.js","assets/ChapterNavigation.vue_vue_type_script_setup_true_lang-DabULv8i.js","assets/index-hNHpr7NI.js","assets/app-B7lfR3N7.js","assets/app-CTi_wKgb.css","assets/ScrollArea.vue_vue_type_script_setup_true_lang-CNqET2oE.js","assets/Presence-Xes9kb4r.js","assets/useForwardExpose-CcJBOnXo.js","assets/index-ChnCwrVw.js","assets/useNonce-BbDqtnuA.js","assets/AlertDialogTitle.vue_vue_type_script_setup_true_lang-BMYPcnK9.js","assets/VisuallyHidden-YCupBDVe.js","assets/DropdownMenuTrigger.vue_vue_type_script_setup_true_lang-BRhN9x2k.js","assets/DialogTrigger-1sj_qXhl.js","assets/index-DbACZKH5.js","assets/index-Biby0k-U.js","assets/plus-DuYvohtx.js","assets/chevron-right-Bi_w7rq3.js","assets/circle-check-big-CewK6vau.js","assets/lock-DZVUgX4F.js","assets/target-BGnvPRSC.js","assets/trash-2-Bhfx4tyy.js","assets/MobileNavOverlay-DOIm1HBD.js","assets/index-0f1FzGZ_.js","assets/useTextHistory-ANaBG0Vh.js","assets/RichTextEditor-WAwzvvzE.js","assets/Progress.vue_vue_type_script_setup_true_lang-CIKUULOB.js","assets/nullish-CHIgUVhi.js","assets/_plugin-vue_export-helper-DlAUqK2U.js","assets/SafeHtmlText.vue_vue_type_script_setup_true_lang-BR7vHaPi.js","assets/index-BWEDi_FC.js","assets/step-DrZ9DcYd.js","assets/chart-column-DR8ItSTZ.js","assets/calendar-DkPqmXOp.js","assets/brain-Lwwy2GNm.js","assets/users-CMh1J4TY.js","assets/circle-alert-CGSIlvqp.js","assets/eye-Ch6OW4eR.js","assets/check-D-48Men_.js","assets/loader-circle-Dz2exCFl.js","assets/download-BsY-FnB_.js","assets/DialogTitle.vue_vue_type_script_setup_true_lang-CCURHRDg.js","assets/x-BCLiL62L.js","assets/DialogFooter.vue_vue_type_script_setup_true_lang-CQK-JmRK.js","assets/Input.vue_vue_type_script_setup_true_lang-B2bUrNCz.js","assets/Label.vue_vue_type_script_setup_true_lang-YvDBBWjH.js","assets/type-BJgX7FQ_.js","assets/minus-B5onMuBC.js","assets/list-Drcy7_qs.js","assets/RichTextEditor-CCE2WhCi.css","assets/CardContent.vue_vue_type_script_setup_true_lang-DAfafdR8.js","assets/CardTitle.vue_vue_type_script_setup_true_lang-jCIxOk9Z.js","assets/CollapsibleTrigger.vue_vue_type_script_setup_true_lang-B4m8NMrt.js","assets/Separator.vue_vue_type_script_setup_true_lang-CZ0GVMao.js","assets/Separator-Dx7o6gtA.js","assets/chevron-down-BPT4WFf6.js","assets/search-D_imah52.js","assets/Switch.vue_vue_type_script_setup_true_lang-DpefNTv3.js","assets/VisuallyHiddenInput-Bxa_5vvz.js","assets/lightbulb-DR6-5oN3.js","assets/refresh-cw-BGOjP4Ib.js","assets/Checkbox.vue_vue_type_script_setup_true_lang-BIA06DAf.js","assets/ohash.D__AXeF1-C-E83dC9.js","assets/RovingFocusItem-UiszKYxz.js","assets/file-text-eVYdE6sA.js","assets/useTextHistory-BLZ3MaDD.css","assets/UserInfo.vue_vue_type_script_setup_true_lang-DMl_TfB-.js","assets/AppLayout.vue_vue_type_script_setup_true_lang-D57nUYv3.js","assets/coins-DtFfA_de.js","assets/log-out-B7ctpmA2.js","assets/AppLogo.vue_vue_type_script_setup_true_lang-ChWXSVJx.js","assets/library-CJCk9N7v.js","assets/Sonner.vue_vue_type_script_setup_true_lang-D8Je-AN2.js","assets/triangle-alert-DeMCFjtR.js","assets/circle-check-D3z0ejyY.js","assets/PurchaseModal.vue_vue_type_script_setup_true_lang-Coe4tjY7.js","assets/sparkles-UfD3YtsS.js","assets/arrow-right-BY9vc9Ah.js","assets/toNumber-D3u5D8AP.js","assets/save-DuY50GJS.js","assets/zap-yLPmPjHP.js","assets/pen-tool-BE5Q-ls6.js","assets/trending-up-BzDMW7FE.js","assets/arrow-left-B54VtZc0.js","assets/menu-sMC8UGM1.js","assets/message-square-CwgOWobh.js","assets/MobileNavOverlay-CN-XSdXy.css","assets/ChatModeLayout-Bnpas01Y.js","assets/ChatModeLayout.vue_vue_type_script_setup_true_lang-BR9frSGv.js","assets/square-lF2_LnK9.js","assets/loader-yZEpYOSM.js","assets/chevron-left-DGa-C6LD.js","assets/clock-DEIkcSQF.js","assets/bot-CQvSquBZ.js","assets/user-D0ylDUhy.js","assets/ChatModeLayout-wjQGykpm.css","assets/CitationVerificationLayout-_B7MRkr1.js"])))=>i.map(i=>d[i]);
import{aB as Wr,ad as Or,W as Hr,f as we,B as f,ae as Ur,J as vr,P as le,i as yt,O as Oe,b as M,I as pt,a7 as ye,d as rt,a as Y,o as _,u as e,w as u,K as a,F as t,M as G,H as D,n as de,D as Be,G as tt,c as L,L as ee,a6 as He,Y as Br,N as Ye,U as Ze,a0 as ut,aC as xt,aD as Qr,Q as Yt,k as Kr,aE as bt}from"./app-B7lfR3N7.js";import{_ as Ue}from"./index-DbACZKH5.js";import{c as Xr,_ as K}from"./index-hNHpr7NI.js";import{_ as _t,a as Ct}from"./CardContent.vue_vue_type_script_setup_true_lang-DAfafdR8.js";import{_ as kt,a as $t}from"./CardTitle.vue_vue_type_script_setup_true_lang-jCIxOk9Z.js";import{a as Zt}from"./ScrollArea.vue_vue_type_script_setup_true_lang-CNqET2oE.js";import{a as Ee,b as $e,_ as Ae}from"./UserInfo.vue_vue_type_script_setup_true_lang-DMl_TfB-.js";import{r as dt,u as Vr,_ as Jr,a as Yr}from"./AppLayout.vue_vue_type_script_setup_true_lang-D57nUYv3.js";import{_ as er}from"./SafeHtmlText.vue_vue_type_script_setup_true_lang-BR7vHaPi.js";import{t as S}from"./index-Biby0k-U.js";import{_ as Zr}from"./PurchaseModal.vue_vue_type_script_setup_true_lang-Coe4tjY7.js";import{t as tr}from"./toNumber-D3u5D8AP.js";import{_ as es}from"./Input.vue_vue_type_script_setup_true_lang-B2bUrNCz.js";import{_ as ts}from"./Label.vue_vue_type_script_setup_true_lang-YvDBBWjH.js";import{an as mr,aw as rs,ax as ss}from"./RichTextEditor-WAwzvvzE.js";import{R as xr,B as wt,W as as,a as ns,_ as os,u as ls,b as rr,M as is,c as cs,P as us,d as ds}from"./useTextHistory-ANaBG0Vh.js";import{E as br}from"./eye-Ch6OW4eR.js";import{S as yr}from"./save-DuY50GJS.js";import{C as Et}from"./circle-check-big-CewK6vau.js";import{_ as sr,a as ar,b as nr}from"./CollapsibleTrigger.vue_vue_type_script_setup_true_lang-B4m8NMrt.js";import{_ as ps}from"./Separator.vue_vue_type_script_setup_true_lang-CZ0GVMao.js";import{_ as wr}from"./Progress.vue_vue_type_script_setup_true_lang-CIKUULOB.js";import{B as et}from"./brain-Lwwy2GNm.js";import{Z as gs}from"./zap-yLPmPjHP.js";import{C as or}from"./chevron-down-BPT4WFf6.js";import{P as lr}from"./pen-tool-BE5Q-ls6.js";import{R as hs}from"./refresh-cw-BGOjP4Ib.js";import{C as fs}from"./circle-check-D3z0ejyY.js";import{S as vs}from"./sparkles-UfD3YtsS.js";import{T as ms}from"./type-BJgX7FQ_.js";import{_ as _r}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{T as xs}from"./trending-up-BzDMW7FE.js";import{C as bs}from"./circle-alert-CGSIlvqp.js";import{A as ir}from"./arrow-left-B54VtZc0.js";import{M as cr}from"./menu-sMC8UGM1.js";import{T as ur}from"./target-BGnvPRSC.js";import{M as dr,S as pr}from"./Sonner.vue_vue_type_script_setup_true_lang-D8Je-AN2.js";import{P as ys,h as ws}from"./AlertDialogTitle.vue_vue_type_script_setup_true_lang-BMYPcnK9.js";import{M as _s}from"./message-square-CwgOWobh.js";import{S as Cs}from"./search-D_imah52.js";var Tt=function(){return Wr.Date.now()},ks="Expected a function",Ss=Math.max,Ts=Math.min;function Es(c,n,l){var y,m,r,v,i,T,x=0,q=!1,A=!1,R=!0;if(typeof c!="function")throw new TypeError(ks);n=tr(n)||0,Or(l)&&(q=!!l.leading,A="maxWait"in l,r=A?Ss(tr(l.maxWait)||0,n):r,R="trailing"in l?!!l.trailing:R);function d(o){var h=y,O=m;return y=m=void 0,x=o,v=c.apply(O,h),v}function w(o){return x=o,i=setTimeout(I,n),q?d(o):v}function C(o){var h=o-T,O=o-x,X=n-h;return A?Ts(X,r-O):X}function E(o){var h=o-T,O=o-x;return T===void 0||h>=n||h<0||A&&O>=r}function I(){var o=Tt();if(E(o))return $(o);i=setTimeout(I,C(o))}function $(o){return i=void 0,R&&y?d(o):(y=m=void 0,v)}function k(){i!==void 0&&clearTimeout(i),x=0,y=T=m=i=void 0}function N(){return i===void 0?v:$(Tt())}function p(){var o=Tt(),h=E(o);if(y=arguments,m=this,T=o,h){if(i===void 0)return w(T);if(A)return clearTimeout(i),i=setTimeout(I,n),d(T)}return i===void 0&&(i=setTimeout(I,n)),v}return p.cancel=k,p.flush=N,p}/**
 * @license lucide-vue-next v0.468.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const $s=Xr("PenIcon",[["path",{d:"M21.174 6.812a1 1 0 0 0-3.986-3.987L3.842 16.174a2 2 0 0 0-.5.83l-1.321 4.352a.5.5 0 0 0 .623.622l4.353-1.32a2 2 0 0 0 .83-.497z",key:"1a8usu"}]]);function As(c){const n=Hr();we(()=>n.props?.flash,B=>{B&&(B.success&&S.success(B.success),B.error&&S.error(B.error))},{deep:!0,immediate:!0});const l=f(c.chapter.title||""),y=f(c.chapter.content||""),m=f(!0),{isDark:r}=Ur(),v=f(!1),i=()=>{const B=localStorage.getItem(`chapter_theme_${c.project.id}`);B?v.value=B==="dark":v.value=r.value},T=()=>{v.value=!v.value;const B=v.value?"dark":"light";localStorage.setItem(`chapter_theme_${c.project.id}`,B),S.success(`Switched to ${v.value?"Dark":"Light"} Mode`)},x=f(!1),q=f(!1),A=f(!1),R=f("write"),d=f(""),w=f(0),C=f(!1),E=f(!1),I=f(!0),$=()=>{try{return localStorage.getItem(`chatMode_${c.project.id}_${c.chapter.chapter_number}`)==="true"}catch(B){return console.warn("Failed to load chat mode from localStorage:",B),!1}},k=B=>{try{localStorage.setItem(`chatMode_${c.project.id}_${c.chapter.chapter_number}`,String(B))}catch(ie){console.warn("Failed to save chat mode to localStorage:",ie)}},N=f(!1),p=f(!1),o=f(!1),h=f(!1),O=f(!1),X=f(!0),Z=f(!0);return{chapterTitle:l,chapterContent:y,showPreview:m,isEditorDark:v,initChapterTheme:i,toggleChapterTheme:T,isNativeFullscreen:x,showAISidebar:q,showStatistics:A,activeTab:R,selectedText:d,cursorPosition:w,showChatMode:C,showCitationMode:E,showDefensePrep:I,loadChatModeFromStorage:$,saveChatModeToStorage:k,showLeftSidebar:N,showRightSidebar:p,isMobile:o,isLeftSidebarCollapsed:h,isRightSidebarCollapsed:O,showLeftSidebarInFullscreen:X,showRightSidebarInFullscreen:Z}}const Ds={userScrollTimeout:2e3,scrollBehavior:"smooth",bottomThreshold:100};class Ps{scrollContainer=null;isUserScrolling=!1;userScrollTimeout=null;isEnabled=!0;isDestroyed=!1;config;wasAtBottom=!0;rafId=null;handleWheel;handleTouchStart;handleTouchMove;handleScroll;handleKeydown;constructor(n={}){this.config={...Ds,...n},this.handleWheel=this.onUserScroll.bind(this),this.handleTouchStart=this.onUserScroll.bind(this),this.handleTouchMove=this.onUserScroll.bind(this),this.handleScroll=this.onScroll.bind(this),this.handleKeydown=this.onKeydown.bind(this)}attach(n){this.isDestroyed||(this.detach(),this.scrollContainer=n,this.setupEventListeners(),this.wasAtBottom=this.isAtBottom())}detach(){this.scrollContainer&&(this.scrollContainer.removeEventListener("wheel",this.handleWheel),this.scrollContainer.removeEventListener("touchstart",this.handleTouchStart),this.scrollContainer.removeEventListener("touchmove",this.handleTouchMove),this.scrollContainer.removeEventListener("scroll",this.handleScroll),this.scrollContainer.removeEventListener("keydown",this.handleKeydown)),this.userScrollTimeout&&(clearTimeout(this.userScrollTimeout),this.userScrollTimeout=null),this.rafId&&(cancelAnimationFrame(this.rafId),this.rafId=null),this.scrollContainer=null}setupEventListeners(){this.scrollContainer&&(this.scrollContainer.addEventListener("wheel",this.handleWheel,{passive:!0}),this.scrollContainer.addEventListener("touchstart",this.handleTouchStart,{passive:!0}),this.scrollContainer.addEventListener("touchmove",this.handleTouchMove,{passive:!0}),this.scrollContainer.addEventListener("scroll",this.handleScroll,{passive:!0}),this.scrollContainer.addEventListener("keydown",this.handleKeydown))}onUserScroll(){this.isEnabled&&(this.isUserScrolling=!0,this.userScrollTimeout&&clearTimeout(this.userScrollTimeout),this.userScrollTimeout=setTimeout(()=>{this.isUserScrolling=!1,this.isAtBottom()&&(this.wasAtBottom=!0)},this.config.userScrollTimeout))}onScroll(){this.wasAtBottom=this.isAtBottom()}onKeydown(n){["ArrowUp","ArrowDown","PageUp","PageDown","Home","End"].includes(n.key)&&this.onUserScroll()}isAtBottom(){if(!this.scrollContainer)return!0;const{scrollTop:n,scrollHeight:l,clientHeight:y}=this.scrollContainer;return l-n-y<=this.config.bottomThreshold}scrollToBottom(){!this.scrollContainer||!this.isEnabled||this.isDestroyed||this.isUserScrolling||!this.wasAtBottom||(this.rafId&&cancelAnimationFrame(this.rafId),this.rafId=requestAnimationFrame(()=>{if(this.rafId=null,!this.scrollContainer||this.isDestroyed)return;const n=this.scrollContainer.scrollHeight-this.scrollContainer.clientHeight;this.config.scrollBehavior==="instant"?this.scrollContainer.scrollTop=n:this.scrollContainer.scrollTo({top:n,behavior:"smooth"}),this.wasAtBottom=!0}))}forceScrollToBottom(){!this.scrollContainer||this.isDestroyed||(this.isUserScrolling=!1,this.wasAtBottom=!0,this.userScrollTimeout&&(clearTimeout(this.userScrollTimeout),this.userScrollTimeout=null),this.scrollToBottom())}enable(){this.isEnabled=!0}disable(){this.isEnabled=!1}isAutoScrollActive(){return this.isEnabled&&!this.isUserScrolling&&this.wasAtBottom}isUserScrollingNow(){return this.isUserScrolling}reset(){this.isUserScrolling=!1,this.wasAtBottom=!0,this.userScrollTimeout&&(clearTimeout(this.userScrollTimeout),this.userScrollTimeout=null)}destroy(){this.isDestroyed=!0,this.detach()}}function Ms(c={}){const n=new Ps(c),l=f(!0),y=f(!1);let m=null;function r(w){w?(n.attach(w),i()):(n.detach(),T())}function v(w){we(w,C=>{r(C)},{immediate:!0})}function i(){T(),m=setInterval(()=>{l.value=n.isAutoScrollActive(),y.value=n.isUserScrollingNow()},100)}function T(){m&&(clearInterval(m),m=null)}function x(){n.scrollToBottom()}function q(){n.forceScrollToBottom()}function A(){n.enable()}function R(){n.disable()}function d(){n.reset(),l.value=!0,y.value=!1}return vr(()=>{T(),n.destroy()}),{attach:r,attachRef:v,scrollToBottom:x,forceScrollToBottom:q,enable:A,disable:R,reset:d,isAutoScrollActive:l,isUserScrolling:y}}function Rs({props:c,chapterContent:n,targetWordCount:l,estimates:y,ensureBalance:m,save:r,triggerAutoSave:v,calculateWritingStats:i,countWords:T,selectedText:x,richTextEditor:q,richTextEditorFullscreen:A,isNativeFullscreen:R}){const d=f(!1),w=f(""),C=f(0),E=f(""),I=f(0),$=f(0),k=f(""),N=f(0),p=f(""),o=f([]),h=f(!1),O=f(!1),X=f(!1),Z=f(!1),B=f(!1),ie=f(!1),ge=f(0),j=f(!1),ae=f(""),ce=f(""),_e=f(0),H=f(0),J=f(null),oe=f([]),U=f([]),ne=f(null),ue=f(null),te=f(0),Ce=3,De=f(2e3),be=f(!1),Pe=f(null),st=f("progressive"),z=f(null),gt=f(),{attach:ht,scrollToBottom:Ie,forceScrollToBottom:ke,reset:Qe,isAutoScrollActive:at,isUserScrolling:Ke}=Ms({userScrollTimeout:2e3,scrollBehavior:"smooth",bottomThreshold:100}),Xe=()=>{d.value&&yt(()=>{let P=null;if(R.value){const b=gt.value;if(b){const Q=b.$el||b;P=Q?.querySelector("[data-radix-scroll-area-viewport]")||Q?.querySelector("[data-viewport]")||Q?.querySelector('[role="region"]')}}else P=document.querySelector(".overflow-y-auto.custom-scrollbar");if(!P){const b=document.querySelector("main");if(b){const Q=b.querySelectorAll("div");for(const W of Q)if(W.scrollHeight>W.clientHeight&&W.classList.contains("overflow-y-auto")){P=W;break}}}P&&(ht(P),Ie(),requestAnimationFrame(()=>{!Ke.value&&P&&P.scrollTo({top:P.scrollHeight,behavior:"smooth"})}))})},ve=async()=>{if(!navigator.onLine)return S.error("No Internet Connection",{description:"Please check your internet connection and try again."}),!1;const P=navigator.connection||navigator.mozConnection||navigator.webkitConnection;if(P){const b=P.effectiveType;(b==="slow-2g"||b==="2g")&&S.warning("Slow Connection Detected",{description:"Your connection is slow. Content will be auto-saved during generation.",duration:4e3})}try{const b=new AbortController,Q=setTimeout(()=>b.abort(),5e3),W=performance.now();await fetch(le("api.ping"),{method:"HEAD",cache:"no-cache",signal:b.signal}),clearTimeout(Q);const se=performance.now()-W;console.log("üì° Server latency:",se.toFixed(0),"ms"),se>2e3&&S.info("Connection is slow",{description:"Content will be auto-saved during generation to prevent data loss.",duration:3e3})}catch(b){console.warn("Connection check ping failed:",b),S.info("Connection check skipped",{description:"Content will be auto-saved during generation.",duration:2e3})}return!0},nt=async()=>new Promise(P=>{let b=0;const Q=120,W=async()=>{try{const re=await(await fetch(le("api.projects.paper-collection.status",{project:c.project.slug}))).json();if(re.success&&re.data){ne.value=re.data;const he=re.data.status,V=re.data.papers_count||re.data.count||0,Se=re.data.message,Te=re.data.percentage||0,fe=re.data.current_source,Ve=re.data.sources_completed||[],Me=re.data.papers_preview||[];if(_e.value=V,H.value=Te,J.value=fe,oe.value=Ve,U.value=Me,he==="completed"){ce.value="Complete",ae.value=`‚úì Collected ${V} verified sources from ${Ve.length} databases`,C.value=50,j.value=!1,ue.value&&clearInterval(ue.value),P(!0);return}else if(["collecting_papers","initializing","processing","storing"].includes(he)){let me="";fe&&(me={semantic_scholar:"Semantic Scholar",openalex:"OpenAlex",crossref:"CrossRef",pubmed:"PubMed"}[fe]||fe),ce.value=me||"Collecting Sources",ae.value=Se||"Collecting sources from academic databases...",C.value=Math.min(5+Te*.4,45)}else if(he==="collection_failed"){ce.value="Error",ae.value=Se||"‚ùå Source collection failed",j.value=!1,ue.value&&clearInterval(ue.value),P(!1);return}}b++,b>=Q&&(ce.value="Timeout",ae.value="‚è±Ô∏è Source collection timed out",j.value=!1,ue.value&&clearInterval(ue.value),P(!1))}catch(se){console.error("Error checking paper collection status:",se),b++}};W(),ue.value=setInterval(W,5e3)}),pe=async()=>{j.value=!0,ce.value="Starting",ae.value="Initializing source collection...",C.value=5;try{const P=document.querySelector('meta[name="csrf-token"]')?.content;if(!P)throw new Error("CSRF token not found - please refresh the page");const b=await fetch(le("api.projects.paper-collection.start",{project:c.project.slug}),{method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json","X-CSRF-TOKEN":P,"X-Requested-With":"XMLHttpRequest"},credentials:"include"});if(!b.ok){const Q=await b.text();if(console.error("API Error:",b.status,Q),b.status===409)try{const W=JSON.parse(Q);throw new Error(W.message||"Source collection is already in progress")}catch{throw new Error("Source collection is already in progress for this project")}throw new Error(`Failed to start source collection: ${b.status}`)}return await nt()}catch(P){return console.error("Paper collection failed:",P),ce.value="Error",ae.value="‚ùå Source collection failed",j.value=!1,!1}},ot=async P=>{const b=y.chapter(l.value||0);if(!m(b,"generate this chapter with AI")||!await ve())return;if(d.value=!0,k.value="",$.value=0,C.value=5,E.value="Papers",w.value="Checking for verified sources...",Z.value=!0,Qe(),I.value=l.value||0,X.value=!0,!await pe()){S.error("Paper Collection Failed",{description:"Unable to collect verified papers. Please try again."}),d.value=!1,X.value=!1;return}E.value="Initializing",w.value="Starting AI generation with verified sources...",C.value=51;const se=setInterval(()=>{C.value<52&&d.value?C.value+=.2:clearInterval(se)},100),re=le("chapters.stream",{project:c.project.slug,chapter:c.chapter.chapter_number});z.value=new EventSource(`${re}?generation_type=${P}`),z.value.onmessage=he=>{const V=JSON.parse(he.data);switch(V.type){case"start":E.value="Connecting",C.value=52,w.value="Connecting to AI service...";break;case"content":E.value="Generating",k.value+=V.content,$.value=V.word_count||k.value.split(/\s+/).filter(fe=>fe.length>0).length;const Se=Date.now();if(Se-N.value>200){n.value=k.value,N.value=Se;const fe=Math.min($.value/Math.max(I.value,1)*43,43);C.value=Math.max(52,52+fe),w.value=`Generating chapter content... (${$.value} / ${I.value} words)`,Xe()}break;case"heartbeat":C.value<95&&(C.value+=.5);break;case"complete":E.value="Complete",C.value=100,d.value=!1,Z.value=!1,n.value=k.value;const Te=V.final_word_count||$.value;w.value=`‚úì Generated ${Te} words successfully`,i(),dt(Te,`Chapter generation (${c.chapter.chapter_number})`,"chapter",c.chapter.id).catch(fe=>console.error("Failed to record word usage (chapter generation):",fe)),setTimeout(()=>{v()},500),z.value?.close(),z.value=null;break;case"error":E.value="Error",C.value=50,Z.value=!1,V.partial_saved&&(ie.value=!0,ge.value=V.saved_word_count||0),V.code==="OFFLINE_MODE"?(w.value="üì° AI services offline",d.value=!1,S.error("AI Services Offline",{description:"Please check your internet connection and try again."})):V.can_resume?(w.value=`‚ö†Ô∏è Generation interrupted (${V.saved_word_count} words saved)`,d.value=!1,B.value=!0,S.warning("Generation Interrupted",{description:`${V.saved_word_count} words were saved. You can resume generation.`,duration:8e3})):(w.value="‚ùå Generation failed",d.value=!1,S.error("Generation Error",{description:V.message||"Please try again."})),z.value?.close(),z.value=null;break;case"autosave":V.word_count&&V.generation_id&&(Pe.value=V.generation_id);break}},z.value.onerror=()=>{if(te.value<Ce){te.value++,be.value=!0,E.value="Reconnecting",w.value=`üîÑ Connection lost. Reconnecting... (${te.value}/${Ce})`,z.value?.close(),z.value=null;const he=De.value*Math.pow(2,te.value-1);setTimeout(()=>lt(P),he)}else E.value="Error",C.value=50,d.value=!1,be.value=!1,w.value="‚ùå Connection failed after multiple attempts",$.value>100?(ie.value=!0,ge.value=$.value,B.value=!0,S.warning("Connection Lost",{description:`${$.value} words may have been saved. Check and resume if needed.`,duration:8e3})):S.error("Connection Error",{description:"Please check your internet connection and try again."}),z.value?.close(),z.value=null,te.value=0,De.value=2e3}},lt=P=>{z.value&&(z.value.close(),z.value=null);const b=le("chapters.stream",{project:c.project.slug,chapter:c.chapter.chapter_number}),Q=new URLSearchParams({generation_type:P,resume_from:$.value.toString()});Pe.value&&Q.set("generation_id",Pe.value),z.value=new EventSource(`${b}?${Q}`),z.value.onmessage=W=>{const se=JSON.parse(W.data);switch(["content","start"].includes(se.type)&&(be.value=!1,te.value=0,E.value="Generating"),se.type){case"start":w.value="‚úÖ Reconnected! Continuing generation...",S.success("Reconnected",{description:"Generation resumed successfully.",duration:3e3});break;case"content":E.value="Generating",k.value+=se.content,$.value=se.word_count||k.value.split(/\s+/).filter(V=>V.length>0).length;const re=Date.now();if(re-N.value>150){n.value=k.value,N.value=re;const V=Math.min($.value/Math.max(I.value,1)*43,43);C.value=Math.max(52,52+V),w.value=`Generating chapter content... (${$.value} / ${I.value} words)`,Xe()}break;case"complete":E.value="Complete",C.value=100,d.value=!1,be.value=!1,n.value=k.value;const he=se.final_word_count||$.value;w.value=`‚úì Generated ${he} words successfully`,dt(he,`Chapter generation (${c.chapter.chapter_number})`,"chapter",c.chapter.id).catch(V=>console.error("Failed to record word usage:",V)),setTimeout(()=>{v()},500),z.value?.close(),z.value=null;break;case"error":E.value="Error",d.value=!1,be.value=!1,w.value="‚ùå Generation failed",S.error("Generation Error",{description:se.message||"Please try again."}),z.value?.close(),z.value=null;break;case"autosave":se.generation_id&&(Pe.value=se.generation_id);break}},z.value.onerror=()=>{if(te.value<Ce){te.value++;const W=De.value*Math.pow(2,te.value-1);w.value=`üîÑ Reconnecting... (${te.value}/${Ce})`,z.value?.close(),setTimeout(()=>lt(P),W)}else E.value="Error",d.value=!1,be.value=!1,w.value="‚ùå Connection failed",$.value>100?(B.value=!0,S.warning("Connection Lost",{description:`${$.value} words may be saved. Refresh to recover.`})):S.error("Connection Error",{description:"Please check your connection and try again."}),z.value?.close(),z.value=null,te.value=0}},ft=async P=>{d.value=!0,k.value="",$.value=0,C.value=5,E.value="Papers",w.value="Checking for verified sources...",I.value=600,p.value=n.value||c.chapter.content||"",X.value=!0;try{C.value=50,E.value="Papers",w.value="Using existing verified sources...",await new Promise(Q=>setTimeout(Q,500)),E.value="Section",w.value=`Generating ${P} section with verified sources...`,C.value=51;const b=le("chapters.stream",{project:c.project.slug,chapter:c.chapter.chapter_number});z.value=new EventSource(`${b}?generation_type=section&section_type=${P}`),z.value.onmessage=Q=>{const W=JSON.parse(Q.data);switch(W.type){case"start":E.value="Generating Section",C.value=52,w.value=`Starting ${P} section generation...`;break;case"content":k.value+=W.content,$.value=W.word_count||T(k.value);const se=Date.now();if(se-N.value>150){n.value=p.value+`

`+k.value,N.value=se;const re=Math.min($.value/I.value*43,43);C.value=Math.max(52,52+re),w.value=`Generating ${P} section... (${$.value} / ${I.value} words)`,i(),Xe()}break;case"complete":C.value=100,E.value="Complete",w.value=`‚úì Generated ${P} section (${$.value} words)`,n.value=p.value+`

`+k.value,r(!0),S.success("‚úÖ Section Generated Successfully",{description:`Added ${P} section with ${$.value} words and verified citations.`,duration:5e3}),d.value=!1,z.value?.close();break;case"error":throw new Error(W.message||"Section generation failed");case"heartbeat":C.value<95&&(C.value+=.5);break}},z.value.onerror=()=>{d.value=!1,E.value="Error",w.value="‚ùå Section generation failed",S.error("‚ùå Generation Failed",{description:"Unable to generate section. Please check your connection and try again."}),z.value?.close()}}catch(b){console.error("Section generation failed:",b),d.value=!1,E.value="Error",w.value="‚ùå Section generation error",S.error("‚ùå Generation Failed",{description:"Section generation encountered an error."})}},Ne=async(P,b,Q)=>{const W=P.split(/\s+/).length,se=b==="rephrase"?Math.max(W,y.rephrase()):Math.max(W*2,y.expand());if(!m(se,`${b} about ${W} words`))return;d.value=!0,k.value="",$.value=0,C.value=10,E.value=b==="rephrase"?"Rephrasing":"Expanding",w.value=`Preparing to ${b} selected text...`,I.value=Math.max(W*(b==="expand"?2:1),100);const re=A.value||q.value,he=re?.getSelectionRange(),V={originalText:P,range:he,wordCount:W,style:Q||"Academic Formal",startTime:Date.now()};X.value=!0;try{const Se=b==="rephrase"?"rephrase":"expand",Te=le("chapters.stream",{project:c.project.slug,chapter:c.chapter.chapter_number}),fe=b==="rephrase"?`${Te}?generation_type=rephrase&selected_text=${encodeURIComponent(P)}&style=${encodeURIComponent(Q||"Academic Formal")}`:`${Te}?generation_type=expand&selected_text=${encodeURIComponent(P)}`;z.value=new EventSource(fe),z.value.onmessage=Ve=>{const Me=JSON.parse(Ve.data);switch(Me.type){case"start":E.value=b==="rephrase"?"Rephrasing Text":"Expanding Text",C.value=b==="rephrase"?30:20,w.value=`${b==="rephrase"?"Rephrasing":"Expanding"} text...`;break;case"content":k.value+=Me.content,$.value=Me.word_count||T(k.value);const me=Math.min($.value/I.value*60,60);C.value=Math.max(b==="rephrase"?30:25,(b==="rephrase"?30:25)+me),w.value=`${b==="rephrase"?"Rephrasing":"Expanding"}... (${$.value} words)`;break;case"complete":C.value=100,E.value="Complete",w.value=`‚úì Text ${b==="rephrase"?"rephrased":"expanded"} successfully (${$.value} words)`,V.range&&k.value.trim()&&(re?.replaceSelection(k.value.trim(),V.range)?setTimeout(()=>{const je=re?.getHTML()||n.value;n.value=je},100):S.warning("Please manually replace the selected text",{description:"The generated text is ready but could not be automatically inserted."})),r(!0),S.success(`‚úÖ Text ${b==="rephrase"?"Rephrased":"Expanded"} Successfully`,{description:`${b==="rephrase"?"Rephrased":"Expanded"} ${W} words.`}),dt($.value||(b==="expand"?W*2:W),b==="rephrase"?`Rephrase (${V.style})`:"Expand text","chapter",c.chapter.id).catch(Re=>console.error(`Failed to record word usage (${b}):`,Re)),d.value=!1,z.value?.close();break;case"error":console.error(`${b} generation error:`,Me.message),d.value=!1,E.value="Error",w.value=`‚ùå Text ${b==="rephrase"?"rephrasing":"expansion"} failed`,S.error(`‚ùå ${b==="rephrase"?"Rephrasing":"Expansion"} Failed`,{description:Me.message||"Please try again."}),z.value?.close();break;case"heartbeat":C.value<95&&(C.value+=.5);break}},z.value.onerror=()=>{d.value=!1,E.value="Error",w.value=`‚ùå Text ${b==="rephrase"?"rephrasing":"expansion"} failed`,S.error(`‚ùå ${b==="rephrase"?"Rephrasing":"Expansion"} Failed`,{description:"Unable to process the request. Please check your connection and try again."}),z.value?.close()}}catch(Se){console.error("Selection generation failed:",Se),d.value=!1,E.value="Error",w.value=`‚ùå Text ${b==="rephrase"?"rephrasing":"expansion"} error`,S.error(`‚ùå ${b==="rephrase"?"Rephrasing":"Expansion"} Failed`,{description:"Text generation encountered an error."})}};return{isGenerating:d,generationProgress:w,generationPercentage:C,generationPhase:E,estimatedTotalWords:I,streamWordCount:$,streamBuffer:k,lastStreamUpdate:N,originalContentForAppend:p,aiSuggestions:o,isLoadingSuggestions:h,showCitationHelper:O,showPresentationMode:X,isStreamingMode:Z,showRecoveryDialog:B,partialContentSaved:ie,savedWordCountOnError:ge,isCollectingPapers:j,paperCollectionProgress:ae,paperCollectionPhase:ce,collectedPapersCount:_e,paperCollectionPercentage:H,currentSource:J,sourcesCompleted:oe,papersPreview:U,paperCollectionData:ne,paperCollectionInterval:ue,reconnectAttempts:te,reconnectDelay:De,isReconnecting:be,currentGenerationId:Pe,currentGenerationType:st,eventSource:z,editorScrollRef:gt,attachScroller:ht,smoothScrollToBottom:Ie,forceScrollToBottom:ke,resetScroller:Qe,isAutoScrollActive:at,isUserScrollingScroller:Ke,scrollToBottom:Xe,checkConnectionQuality:ve,startPaperCollection:pe,startStreamingGeneration:ot,attemptReconnection:lt,startSectionGeneration:ft,handleSelectionGeneration:Ne,handleAIGeneration:(P,b)=>{P==="section"&&b?.section?ft(b.section):P==="rephrase"&&b?.selectedText?Ne(b.selectedText,"rephrase",b.style):P==="expand"&&b?.selectedText?Ne(b.selectedText,"expand"):ot(P)},getAISuggestions:async()=>{if(!x.value)return;const P=y.suggestion();if(m(P,"get AI suggestions")){h.value=!0;try{const Q=await(await fetch(le("chapters.suggestions",{project:c.project.slug,chapter:c.chapter.chapter_number}),{method:"POST",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":document.querySelector('meta[name="csrf-token"]')?.getAttribute("content")||""},body:JSON.stringify({selected_text:x.value,context:n.value})})).json();o.value=Q.suggestions||[],o.value.length&&dt(y.suggestion(),"AI suggestions","chapter",c.chapter.id).catch(W=>console.error("Failed to record word usage (suggestions):",W))}catch{S.error("Error getting suggestions",{description:"Please try again."})}finally{h.value=!1}}},checkCitations:()=>{O.value=!0,S.success("Citation Manager opened!",{description:"Review and verify your citations in the panel below."})},insertCitation:P=>{try{const b=A.value?.editor||q.value?.editor;if(!b){S.error("Editor not found");return}const{from:Q}=b.state.selection;b.chain().focus().insertContentAt(Q,` ${P} `).run(),S.success("Citation inserted successfully")}catch(b){console.error("Failed to insert citation:",b),S.error("Failed to insert citation")}},resumeGeneration:()=>{B.value=!1,ie.value=!1,window.location.reload()},dismissRecovery:()=>{B.value=!1,ie.value=!1,ge.value=0},checkForAutoGeneration:()=>{const P=new URLSearchParams(window.location.search),b=P.get("ai_generate")==="true",Q=P.get("generation_type");!b||!Q||setTimeout(()=>{ot("progressive");const W=new URL(window.location.href);W.searchParams.delete("ai_generate"),W.searchParams.delete("generation_type"),window.history.replaceState({},"",W.toString()),S.success("üöÄ AI Generation Started",{description:`Generating ${c.chapter.title} with AI assistance...`})},1e3)}}}function js({props:c,allChapters:n,targetWordCount:l,estimates:y,ensureBalance:m,save:r}){return{generateNextChapter:async()=>{const i=y.chapter(l.value||0);if(!m(i,"generate the next chapter with AI"))return;await r();const T=n.map(A=>A.chapter_number).sort((A,R)=>A-R),x=T.indexOf(c.chapter.chapter_number);let q;if(x===-1||x===T.length-1)q=Math.max(...T)+1;else{const A=T[x+1];A===c.chapter.chapter_number+1?q=A:q=c.chapter.chapter_number+1}try{const A=le("chapters.write",{project:c.project.slug,chapter:q}),R=new URL(A,window.location.origin);R.searchParams.set("ai_generate","true"),R.searchParams.set("generation_type","progressive"),Oe.visit(R.toString())}catch(A){console.error("‚ùå Error generating next chapter:",A)}}}}function Fs(c,n,l,y){const r=f(!1),v=f(0),i=f(!1),T=h=>{if(!h)return 0;const X=h.replace(/<[^>]*>/g,"").trim().replace(/\s+/g," ");if(!X)return 0;const Z=X.match(/\b\w+\b/g);return Z?Z.length:0},x=M(()=>T(l.value)),q=M(()=>x.value>=800),A=()=>`defense_generation_triggered_${c.id}_ch_${n.chapter_number}`,R=()=>{const h=A();return localStorage.getItem(h)==="true"},d=()=>{const h=A();localStorage.setItem(h,"true"),r.value=!0},w=()=>{const h=A();localStorage.removeItem(h),r.value=!1,console.log(`üîÑ DEFENSE WATCHER: Reset generation trigger for Chapter ${n.chapter_number}`)},C=Es(async()=>{if(!i.value)return;const h=x.value;console.log(`üìä DEFENSE WATCHER: Word count check - Chapter ${n.chapter_number}: ${h} words`),h<800*.8&&r.value&&(console.log("‚¨áÔ∏è DEFENSE WATCHER: Content dropped below 80% of threshold, resetting trigger"),w()),v.value=h},2e3),E=()=>i.value?void 0:(i.value=!0,r.value=R(),v.value=x.value,console.log(`üëÄ DEFENSE WATCHER: Started watching Chapter ${n.chapter_number}`),console.log(`   Initial word count: ${v.value}`),console.log(`   Generation already triggered: ${r.value}`),console.log("   Threshold: 800 words"),we(l,(O,X)=>{O!==X&&C()},{immediate:!1})),I=()=>{i.value=!1,C.cancel(),console.log(`üõë DEFENSE WATCHER: Stopped watching Chapter ${n.chapter_number}`)},$=async()=>{console.log(`üîç DEFENSE WATCHER: Force checking Chapter ${n.chapter_number}`),await C(),C.flush()},k=M(()=>{const h=x.value;return h>0&&h<800&&!r.value}),N=M(()=>{const h=x.value/800*100;return Math.min(h,100)}),p=M(()=>{const h=800-x.value;return Math.max(h,0)});return{isWatching:i,hasTriggeredGeneration:r,currentWordCount:x,lastWordCount:v,meetsThreshold:q,shouldShowProgressIndicator:k,progressPercentage:N,wordsRemaining:p,startWatching:E,stopWatching:I,forceCheck:$,resetGenerationTrigger:w,markGenerationTriggered:d,getStatusMessage:()=>{const h=x.value;return r.value?`Defense questions available (${h} words)`:h>=800?`Ready for defense questions (${h} words)`:h>0?`${800-h} more words needed for defense questions`:"Start writing to enable defense questions (800 words needed)"},countWords:T,DEFENSE_WORD_COUNT_THRESHOLD:800}}function qs({props:c,chapterContent:n,currentWordCount:l,ensureBalance:y,estimates:m}){const r=f([]),v=f(!1),i=f(!1),T=f(null),x=f(!1),q=M(()=>c.chapter),{hasTriggeredGeneration:A,startWatching:R,stopWatching:d,forceCheck:w,getStatusMessage:C,markGenerationTriggered:E,meetsThreshold:I,shouldShowProgressIndicator:$,progressPercentage:k,wordsRemaining:N,DEFENSE_WORD_COUNT_THRESHOLD:p}=Fs(c.project,c.chapter,n),o=(H,J)=>`defense_auto_generate_${H}_ch_${J}`,h=()=>{try{return localStorage.getItem(o(c.project.id,c.chapter.chapter_number))==="true"}catch(H){return console.warn("Failed to load defense auto-generation preference:",H),!1}},O=H=>{try{localStorage.setItem(o(c.project.id,c.chapter.chapter_number),String(H))}catch(J){console.warn("Failed to save defense auto-generation preference:",J)}};x.value=h();const X=()=>{if(!r.value.length||!T.value)return!0;const H=new Date(Date.now()-360*60*1e3);return T.value<H},Z=async(H=!1,J={})=>{if(v.value)return;const oe=J.skipGeneration??!0;v.value=!0;try{console.log("Loading defense questions with params:",{project_id:c.project.id,chapter_number:q.value?.chapter_number,limit:5,force_refresh:H,skip_generation:oe});const U=await ye.get(`/api/projects/${c.project.id}/defense/questions`,{params:{chapter_number:q.value?.chapter_number||null,limit:5,force_refresh:H?1:0,skip_generation:oe?1:0},headers:{Accept:"application/json","X-Requested-With":"XMLHttpRequest"}});if(console.log("Defense questions loaded:",U.data),r.value=U.data.questions||[],T.value=new Date,U.data.questions&&U.data.questions.length>0){const ne=`defense_questions_${c.project.id}_chapter_${q.value?.chapter_number}`;localStorage.setItem(ne,JSON.stringify({questions:U.data.questions,chapter_number:q.value?.chapter_number,loaded_at:new Date().toISOString()}))}else H||(console.log("No existing questions found for this chapter"),console.log(`Current word count: ${l.value}/${p}`),console.log('User must click "Generate Questions" button to create defense questions'))}catch(U){if(console.error("Failed to load defense questions:",U),U.response)if(console.error("Response status:",U.response.status),console.error("Response data:",U.response.data),U.response.status===422){const ne=Object.values(U.response.data.errors||{})[0];ne&&Array.isArray(ne)?S.error(`Validation Error: ${ne[0]}`):S.error("Invalid request parameters. Please refresh the page.")}else U.response.status===500?S.error("Server error. Please try again later."):S.error("Failed to load defense questions");else U.request?(console.error("No response received:",U.request),S.error("Network error. Please check your connection.")):(console.error("Error setting up request:",U.message),S.error("An unexpected error occurred"));r.value=[]}finally{v.value=!1}},B=H=>H?H.replace(/<[^>]*>/g," ").trim().split(/\s+/).filter(J=>J.length>0).length:0,ie=async(H={})=>{if(i.value)return;const J=H.autoTriggered??!1,oe=m.defense();if(y(oe,"generate defense questions")){i.value=!0;try{const U=await ye.post(`/api/projects/${c.project.id}/defense/questions/generate`,{chapter_number:q.value.chapter_number},{headers:{"X-CSRF-TOKEN":document.querySelector('meta[name="csrf-token"]')?.getAttribute("content"),Accept:"application/json","Content-Type":"application/json"}});if(U.data&&U.data.questions){r.value=U.data.questions,T.value=new Date;const ne=U.data.questions.reduce((te,Ce)=>{const De=B(Ce.question),be=B(Ce.suggested_answer),Pe=(Ce.key_points||[]).reduce((st,z)=>st+B(z),0);return te+De+be+Pe},0),ue=`defense_questions_${c.project.id}_chapter_${q.value?.chapter_number}`;localStorage.setItem(ue,JSON.stringify({questions:U.data.questions,chapter_number:q.value?.chapter_number,loaded_at:new Date().toISOString()})),S.success(`Generated ${U.data.questions.length} new questions`),dt(ne||m.defense(),"Defense questions","chapter",c.chapter.id).catch(te=>console.error("Failed to record word usage (defense):",te)),A.value=!0,E(),J&&console.log("Auto-generated defense questions after meeting threshold.")}}catch(U){console.error("Failed to generate defense questions:",U),S.error("Failed to generate defense questions")}finally{i.value=!1}}},ge=async()=>{!x.value||i.value||v.value||A.value||!I.value||r.value.length>0||await ie({autoTriggered:!0})},j=H=>{x.value=H,O(H),H&&ge()},ae=async(H,J)=>{try{await ye.patch(`/api/projects/${c.project.id}/defense/questions/${H}`,{user_marked_helpful:J},{headers:{"X-CSRF-TOKEN":document.querySelector('meta[name="csrf-token"]')?.getAttribute("content"),Accept:"application/json","Content-Type":"application/json"}});const oe=r.value.find(U=>U.id===H);oe&&(oe.user_marked_helpful=J),S.success(J?"Question marked as helpful":"Removed helpful mark")}catch(oe){console.error("Failed to mark question:",oe),S.error("Failed to update question")}},ce=async H=>{try{await ye.delete(`/api/projects/${c.project.id}/defense/questions/${H}`,{headers:{"X-CSRF-TOKEN":document.querySelector('meta[name="csrf-token"]')?.getAttribute("content"),Accept:"application/json"}}),r.value=r.value.filter(J=>J.id!==H),localStorage.setItem(`defense_questions_${c.project.id}`,JSON.stringify({questions:r.value,loaded_at:new Date().toISOString()})),S.success("Question hidden")}catch(J){console.error("Failed to hide question:",J),S.error("Failed to hide question")}},_e=async()=>{const H=`defense_questions_${c.project.id}_chapter_${q.value?.chapter_number}`,J=localStorage.getItem(H);let oe=!0;if(J){const U=JSON.parse(J),ne=new Date(U.loaded_at),ue=new Date(Date.now()-360*60*1e3);ne>ue&&U.chapter_number===q.value?.chapter_number&&(r.value=U.questions,T.value=ne,oe=!1)}oe&&await Z(!1,{skipGeneration:!0})};return we(()=>c.chapter,async()=>{r.value=[],d(),R(),x.value=h(),await Z(!1,{skipGeneration:!0}),await yt(()=>{w(),ge()})},{immediate:!1}),we([l,x],()=>{ge()}),pt(async()=>{await _e(),R(),await yt(()=>{w(),ge()})}),{defenseQuestions:r,isLoadingDefenseQuestions:v,isGeneratingDefenseQuestions:i,autoGenerateDefense:x,shouldLoadDefenseQuestions:X,loadDefenseQuestions:Z,generateNewDefenseQuestions:ie,markQuestionHelpful:ae,hideQuestion:ce,handleDefenseAutoToggle:j,attemptAutoGenerateDefense:ge,getDefenseStatusMessage:C,shouldShowDefenseProgress:$,defenseProgressPercentage:k,defenseWordsRemaining:N,hasTriggeredGeneration:A,meetsDefenseThreshold:I}}const Ls={class:"flex items-center justify-between"},Gs={class:"space-y-1 w-full max-w-[520px]"},Is={class:"flex items-center justify-between gap-3"},Ns={class:"flex flex-col"},zs={class:"flex items-center gap-2"},Ws={class:"flex items-center justify-between px-6 py-2 border-b border-border/30 bg-muted/5"},Os={class:"flex items-center gap-2"},Hs={class:"space-y-1 relative z-10"},Us={class:"text-sm font-medium text-foreground"},Bs={class:"text-[10px] text-muted-foreground line-clamp-2 leading-relaxed"},Qs={class:"flex-1 relative bg-background"},Ks={class:"px-12 py-10 min-h-[500px]"},Xs={class:"sticky bottom-0 z-10 border-t border-border/30 bg-background/80 backdrop-blur-md p-4 flex items-center justify-between"},Vs={class:"text-xs text-muted-foreground"},Js={class:"flex items-center gap-2"},Ys=rt({__name:"ChapterEditorPaperCard",props:{context:{}},setup(c){const l=c.context,y=M(()=>{const v=l.getSectionInfo(l.nextSection);return l.aiChapterAnalysis?.section||v}),m=M(()=>y.value?.name||""),r=M(()=>y.value?.description||"");return(v,i)=>(_(),Y(e(_t),{class:"w-full max-w-[850px] min-h-[calc(100vh-180px)] flex flex-col bg-background shadow-xl shadow-black/5 ring-1 ring-black/5 dark:ring-white/10 rounded-xl overflow-hidden transition-all duration-300"},{default:u(()=>[a(e(kt),{class:"flex-shrink-0 border-b border-border/30 px-8 py-6 bg-background/50 backdrop-blur-sm sticky top-0 z-10"},{default:u(()=>[t("div",Ls,[t("div",Gs,[t("div",Is,[t("div",Ns,[a(e(ts),{for:"chapter-title",class:"text-xs font-medium text-zinc-500 dark:text-zinc-400 uppercase tracking-wider"},{default:u(()=>[...i[3]||(i[3]=[G("Chapter Title",-1)])]),_:1}),a(e(es),{id:"chapter-title",modelValue:e(l).chapterTitle,"onUpdate:modelValue":i[0]||(i[0]=T=>e(l).chapterTitle=T),placeholder:"Enter chapter title...",class:"h-auto p-0 border-0 bg-transparent text-2xl font-bold placeholder:text-muted-foreground/40 focus-visible:ring-0 px-0 text-foreground"},null,8,["modelValue"])]),t("div",zs,[a(e(Ue),{variant:e(l).chapter.status==="approved"?"default":"secondary",class:"rounded-full px-3"},{default:u(()=>[G(D(e(l).chapter.status.replace("_"," ")),1)]),_:1},8,["variant"]),a(e(Ue),{variant:"outline",class:de(["rounded-full px-3 transition-colors",{"text-green-600 border-green-200 bg-green-50 dark:bg-green-900/20 dark:border-green-800":(e(l).latestAnalysis?.total_score||0)>=80,"text-yellow-600 border-yellow-200 bg-yellow-50 dark:bg-yellow-900/20 dark:border-yellow-800":(e(l).latestAnalysis?.total_score||0)>=70&&(e(l).latestAnalysis?.total_score||0)<80,"text-orange-600 border-orange-200 bg-orange-50 dark:bg-orange-900/20 dark:border-orange-800":(e(l).latestAnalysis?.total_score||0)>=60&&(e(l).latestAnalysis?.total_score||0)<70,"text-red-600 border-red-200 bg-red-50 dark:bg-red-900/20 dark:border-red-800":(e(l).latestAnalysis?.total_score||0)<60}])},{default:u(()=>[G(D(e(l).latestAnalysis?.total_score?Math.round(e(l).latestAnalysis.total_score):e(l).writingQualityScore)+"% Quality ",1)]),_:1},8,["class"])])])])])]),_:1}),a(e(Ct),{class:"flex min-h-0 flex-1 flex-col p-0"},{default:u(()=>[t("div",Ws,[t("div",Os,[a(e(K),{onClick:e(l).togglePresentationMode,variant:e(l).showPresentationMode?"default":"ghost",size:"sm",class:"h-7 text-xs rounded-full text-zinc-700 dark:text-zinc-300 hover:text-foreground"},{default:u(()=>[a(e(br),{class:"mr-1.5 h-3.5 w-3.5"}),G(" "+D(e(l).showPresentationMode?"Edit":"Preview"),1)]),_:1},8,["onClick","variant"])]),t("div",Hs,[t("div",Us,D(m.value),1),t("div",Bs,D(r.value),1)])]),t("div",Qs,[Be(a(mr,{modelValue:e(l).chapterContent,"onUpdate:modelValue":i[1]||(i[1]=T=>e(l).chapterContent=T),placeholder:"Start writing your chapter...","min-height":"500px",class:"min-h-[500px] px-8 py-6",ref:e(l).richTextEditor,"show-toolbar":!0,"streaming-mode":e(l).isStreamingMode,"is-generating":e(l).isGenerating,"generation-progress":e(l).generationProgress,"generation-percentage":e(l).generationPercentage,"generation-phase":e(l).generationPhase,"onUpdate:selectedText":e(l).setSelectedText},null,8,["modelValue","streaming-mode","is-generating","generation-progress","generation-percentage","generation-phase","onUpdate:selectedText"]),[[tt,!e(l).showPresentationMode]]),Be(t("div",Ks,[a(xr,{content:e(l).chapterContent,"show-font-controls":!1,class:"prose-lg mx-auto",style:{"font-family":"'Times New Roman', serif","line-height":"1.8"}},null,8,["content"])],512),[[tt,e(l).showPresentationMode]])])]),_:1}),t("div",Xs,[t("div",Vs,D(e(l).isSaving?"Saving...":"All changes saved"),1),t("div",Js,[a(e(K),{onClick:i[2]||(i[2]=()=>e(l).save(!1)),disabled:!e(l).isValid||e(l).isSaving,size:"sm",variant:"ghost",class:"h-8 rounded-full text-zinc-700 dark:text-zinc-300 hover:text-foreground"},{default:u(()=>[a(e(yr),{class:"mr-2 h-3.5 w-3.5"}),i[4]||(i[4]=G(" Save Draft ",-1))]),_:1},8,["disabled"]),a(e(K),{onClick:e(l).goToBulkAnalysis,variant:"outline",size:"sm",class:"h-8 rounded-full"},{default:u(()=>[a(e(wt),{class:"mr-2 h-3.5 w-3.5"}),i[5]||(i[5]=G(" Run Bulk Analysis ",-1))]),_:1},8,["onClick"]),a(e(K),{onClick:e(l).markAsComplete,disabled:e(l).isSaving,size:"sm",class:"h-8 rounded-full bg-gradient-to-r from-primary to-primary/90 shadow-sm hover:shadow-md transition-all"},{default:u(()=>[a(e(Et),{class:"mr-2 h-3.5 w-3.5"}),i[6]||(i[6]=G(" Complete ",-1))]),_:1},8,["onClick","disabled"])])])]),_:1}))}}),Zs={class:"flex flex-col gap-4 p-1"},ea={class:"p-1.5 rounded-lg bg-primary/10 text-primary"},ta={class:"flex items-center gap-2"},ra={class:"space-y-3"},sa={class:"flex items-center gap-2"},aa={class:"font-semibold"},na={class:"text-[10px] opacity-70 font-normal"},oa={key:0,class:"space-y-2"},la={class:"flex items-center justify-between w-full relative z-10"},ia={class:"flex items-center gap-2 text-primary"},ca={class:"space-y-1 relative z-10"},ua={class:"text-sm font-medium text-foreground"},da={class:"text-[10px] text-muted-foreground line-clamp-2 leading-relaxed"},pa={key:0,class:"p-4 rounded-xl bg-green-500/10 border border-green-500/20 space-y-3"},ga={class:"flex items-center gap-2 text-green-600 dark:text-green-400"},ha={class:"space-y-2"},fa={class:"flex justify-between text-[10px] font-medium text-muted-foreground"},va={class:"grid grid-cols-2 gap-2 mt-2"},ma={class:"p-1.5 rounded-full bg-blue-500/10 text-blue-500"},xa={class:"p-1.5 rounded-full bg-purple-500/10 text-purple-500"},ba={class:"p-1.5 rounded-full bg-orange-500/10 text-orange-500"},ya={class:"p-1.5 rounded-full bg-emerald-500/10 text-emerald-500"},wa={class:"flex items-center gap-2"},_a={class:"p-1 rounded-xl bg-muted/30 border border-border/50"},Ca=rt({__name:"AISidebar",props:{project:{},chapter:{},isGenerating:{type:Boolean},selectedText:{},isLoadingSuggestions:{type:Boolean},showCitationHelper:{type:Boolean},chapterContent:{},cursorPosition:{},currentWordCount:{},targetWordCount:{}},emits:["startStreamingGeneration","getAISuggestions","update:showCitationHelper","insert-citation","checkCitations"],setup(c,{emit:n}){const l=c,y=n,m=f("Academic Formal"),r=f(null),v=f(!1),i=f({expand:!1,improve:!1,rephrase:!1,cite:!1,"generate-full":!1,"generate-section":!1}),T=M(()=>!!l.chapter?.id&&!!l.chapter?.chapter_number),x=M(()=>l.chapterContent&&l.chapterContent.trim().length>0),q=M(()=>!x.value&&T.value),A=M(()=>!r.value&&T.value),R=M(()=>!l.isGenerating&&!!l.chapterContent);M(()=>!l.isLoadingSuggestions&&!!l.selectedText);const d=M(()=>r.value&&r.value.section.name!=="NONE"?r.value.section.name.toLowerCase().replace(/\s+/g,"_"):I()),w=M(()=>!l.isGenerating&&!!l.chapter?.id),C=()=>[{id:"introduction",name:"Introduction",description:"Overview and objectives of this chapter"},{id:"content",name:"Main Content",description:"Chapter main content"},{id:"conclusion",name:"Conclusion",description:"Summary and transition to next chapter"}],E=async(p,o)=>{if(Object.values(i.value).some(h=>h)){S("Please wait for the current action to complete");return}try{switch(p in i.value&&(i.value[p]=!0),p){case"expand":l.selectedText?(y("startStreamingGeneration","expand",{selectedText:l.selectedText}),S("Expanding selected text...")):S.error("Please select text to expand");break;case"improve":y("startStreamingGeneration","improve"),S("Improving chapter content...");break;case"rephrase":l.selectedText?(y("startStreamingGeneration","rephrase",{selectedText:l.selectedText,style:m.value}),S("Rephrasing selected text...")):S.error("Please select text to rephrase");break;case"cite":y("update:showCitationHelper",!0),S("Opening citation helper...");break;case"generate-full":y("startStreamingGeneration","progressive"),S("Generating complete chapter...");break;case"generate-section":const h=o?.section||d.value;y("startStreamingGeneration","section",{section:h,mode:"progressive"}),S(`Generating ${h} section...`);break;default:throw new Error(`Unknown action: ${p}`)}}catch(h){console.error(`Quick action '${p}' failed:`,h),S.error(`Failed to ${p.replace("-"," ")}. Please try again.`)}finally{setTimeout(()=>{p in i.value&&(i.value[p]=!1)},1e3)}},I=()=>{if(!x.value)return"introduction";const p=l.chapterContent.toLowerCase(),o=C();for(const h of o)if(![h.name.toLowerCase(),h.id.replace("_"," ")].some(Z=>p.includes(Z)))return h.id;return"conclusion"},$=p=>{const o=C();return o.find(h=>h.id===p)||o[0]},k=async()=>{if(v.value||!T.value)return;v.value=!0;const p=Date.now();try{const{data:o}=await ye.post(`/api/projects/${l.project.id}/chapters/${l.chapter.id}/suggest-section?t=${Date.now()}`,{current_content:l.chapterContent||""}),h=Date.now()-p,O=Math.max(0,800-h);if(O>0&&await new Promise(X=>setTimeout(X,O)),o.success&&o.analysis){if(r.value=o.analysis,r.value.word_count_progress&&l.currentWordCount!==void 0){const X=l.targetWordCount||r.value.word_count_progress.target;r.value.word_count_progress.current=l.currentWordCount,r.value.word_count_progress.percentage=X>0?Math.round(l.currentWordCount/X*100*100)/100:0}console.log("‚úÖ Fresh chapter analysis complete:",{status:o.analysis.status,completion:o.analysis.completion_percentage,wordProgress:r.value.word_count_progress,usingLiveWordCount:l.currentWordCount!==void 0,usingStructuredData:o.structured||!0,cached:!1}),S.success("Chapter analyzed successfully")}else S.error("Failed to analyze chapter")}catch(o){console.error("Chapter analysis failed:",o),S.error("Failed to analyze chapter. Please try again.")}finally{v.value=!1}},N=p=>{y("insert-citation",p)};return we(()=>l.chapter,p=>{p?.id&&(r.value=null)},{immediate:!1}),we(()=>l.chapterContent,p=>{r.value&&(!p||p.trim().length===0)&&(r.value=null)},{immediate:!1}),(p,o)=>(_(),L("div",Zs,[a(e(_t),{class:"border-none shadow-none bg-transparent"},{default:u(()=>[a(e(kt),{class:"px-2 py-3"},{default:u(()=>[a(e($t),{class:"flex items-center gap-2 text-sm font-semibold text-foreground/80"},{default:u(()=>[t("div",ea,[a(e(et),{class:"h-4 w-4"})]),o[8]||(o[8]=G(" AI Assistant ",-1))]),_:1})]),_:1}),a(e(Ct),{class:"px-2 space-y-6"},{default:u(()=>[a(e(sr),{open:!0,class:"space-y-2"},{default:u(()=>[a(e(ar),{class:"flex w-full items-center justify-between text-xs font-medium text-muted-foreground hover:text-foreground transition-colors group"},{default:u(()=>[t("span",ta,[a(e(gs),{class:"h-3.5 w-3.5 text-amber-500/70 group-hover:text-amber-500 transition-colors"}),o[9]||(o[9]=G(" QUICK ACTIONS ",-1))]),a(e(or),{class:"h-3 w-3 transition-transform duration-200 group-data-[state=open]:rotate-180"})]),_:1}),a(e(nr),{class:"space-y-3 pt-1"},{default:u(()=>[t("div",ra,[A.value?(_(),Y(e(K),{key:0,onClick:k,disabled:p.isGenerating||v.value,class:"w-full h-auto flex-col gap-1.5 p-4 rounded-xl bg-gradient-to-br from-primary/10 via-primary/5 to-transparent border border-primary/10 hover:border-primary/30 text-primary hover:from-primary/15 transition-all duration-300 shadow-sm"},{default:u(()=>[t("div",sa,[a(e(et),{class:"h-4 w-4"}),t("span",aa,D(v.value?"Analyzing...":q.value?"Start Writing":"Analyze Chapter"),1)]),t("span",na,D(q.value?"Get AI suggestions to begin":"Generate next steps & suggestions"),1)]),_:1},8,["disabled"])):ee("",!0),a(He,{"enter-active-class":"transition-all duration-300 ease-out","enter-from-class":"opacity-0 scale-95 translate-y-1","enter-to-class":"opacity-100 scale-100 translate-y-0"},{default:u(()=>[r.value&&r.value.show_section_button?(_(),L("div",oa,[a(e(K),{onClick:o[0]||(o[0]=h=>E("generate-section")),disabled:!w.value||v.value||p.isGenerating||i.value["generate-section"],variant:"outline",class:"w-full h-auto flex-col items-start gap-2 p-3 rounded-xl border-primary/20 bg-background/50 hover:bg-primary/5 hover:border-primary/40 transition-all duration-300 text-left group relative overflow-hidden"},{default:u(()=>[o[11]||(o[11]=t("div",{class:"absolute inset-0 bg-gradient-to-r from-primary/5 to-transparent opacity-0 group-hover:opacity-100 transition-opacity"},null,-1)),t("div",la,[t("div",ia,[a(e(lr),{class:"h-3.5 w-3.5"}),o[10]||(o[10]=t("span",{class:"text-xs font-semibold"},"Write Next Section",-1))]),i.value["generate-section"]?(_(),Y(e(hs),{key:0,class:"h-3 w-3 animate-spin text-primary"})):ee("",!0)]),t("div",ca,[t("div",ua,D(r.value?.section.name||$(d.value).name),1),t("div",da,D(r.value?.section.description||$(d.value).description),1)])]),_:1},8,["disabled"])])):ee("",!0)]),_:1}),a(He,{"enter-active-class":"transition-all duration-300 ease-out","enter-from-class":"opacity-0 scale-95 translate-y-1","enter-to-class":"opacity-100 scale-100 translate-y-0"},{default:u(()=>[r.value&&r.value.show_full_chapter_button?(_(),Y(e(K),{key:0,onClick:o[1]||(o[1]=h=>E("generate-full")),disabled:p.isGenerating||v.value||i.value["generate-full"],variant:"ghost",class:"w-full h-9 justify-start gap-2 px-3 rounded-lg text-xs text-muted-foreground hover:text-primary hover:bg-primary/5"},{default:u(()=>[a(e(as),{class:"h-3.5 w-3.5"}),o[12]||(o[12]=t("span",null,"Generate Complete Chapter",-1))]),_:1},8,["disabled"])):ee("",!0)]),_:1}),a(He,{"enter-active-class":"transition-all duration-500 ease-out","enter-from-class":"opacity-0 scale-95 translate-y-2","enter-to-class":"opacity-100 scale-100 translate-y-0"},{default:u(()=>[r.value&&r.value.status==="COMPLETE"?(_(),L("div",pa,[t("div",ga,[a(e(fs),{class:"h-4 w-4"}),o[13]||(o[13]=t("span",{class:"text-sm font-semibold"},"Chapter Complete",-1))]),t("div",ha,[t("div",fa,[o[14]||(o[14]=t("span",null,"Progress",-1)),t("span",null,D(r.value.completion_percentage)+"%",1)]),a(e(wr),{"model-value":r.value.completion_percentage,class:"h-1.5"},null,8,["model-value"])])])):ee("",!0)]),_:1})]),t("div",va,[a(e(K),{onClick:o[2]||(o[2]=h=>E("improve")),disabled:!R.value||p.isGenerating||i.value.improve,variant:"outline",class:"h-20 flex-col gap-2 rounded-xl border-border/50 bg-background/50 hover:bg-accent hover:border-accent transition-all duration-300"},{default:u(()=>[t("div",ma,[a(e(vs),{class:"h-4 w-4"})]),o[15]||(o[15]=t("span",{class:"text-xs font-medium"},"Improve",-1))]),_:1},8,["disabled"]),a(e(K),{onClick:o[3]||(o[3]=h=>E("expand")),disabled:!p.selectedText||p.isGenerating||i.value.expand,variant:"outline",class:"h-20 flex-col gap-2 rounded-xl border-border/50 bg-background/50 hover:bg-accent hover:border-accent transition-all duration-300"},{default:u(()=>[t("div",xa,[a(e(rs),{class:"h-4 w-4"})]),o[16]||(o[16]=t("span",{class:"text-xs font-medium"},"Expand",-1))]),_:1},8,["disabled"]),a(e(K),{onClick:o[4]||(o[4]=h=>E("cite")),disabled:p.isGenerating||i.value.cite,variant:"outline",class:"h-20 flex-col gap-2 rounded-xl border-border/50 bg-background/50 hover:bg-accent hover:border-accent transition-all duration-300"},{default:u(()=>[t("div",ba,[a(e(ss),{class:"h-4 w-4"})]),o[17]||(o[17]=t("span",{class:"text-xs font-medium"},"Cite",-1))]),_:1},8,["disabled"]),a(e(K),{onClick:o[5]||(o[5]=h=>E("rephrase")),disabled:!p.selectedText||p.isGenerating||i.value.rephrase,variant:"outline",class:"h-20 flex-col gap-2 rounded-xl border-border/50 bg-background/50 hover:bg-accent hover:border-accent transition-all duration-300"},{default:u(()=>[t("div",ya,[a(e(ms),{class:"h-4 w-4"})]),o[18]||(o[18]=t("span",{class:"text-xs font-medium"},"Rephrase",-1))]),_:1},8,["disabled"])])]),_:1})]),_:1}),a(e(ps),{class:"bg-border/50"}),a(e(sr),{open:!0,class:"space-y-2"},{default:u(()=>[a(e(ar),{class:"flex w-full items-center justify-between text-xs font-medium text-muted-foreground hover:text-foreground transition-colors group"},{default:u(()=>[t("span",wa,[a(e(lr),{class:"h-3.5 w-3.5 text-indigo-500/70 group-hover:text-indigo-500 transition-colors"}),o[19]||(o[19]=G(" WRITING STYLE ",-1))]),a(e(or),{class:"h-3 w-3 transition-transform duration-200 group-data-[state=open]:rotate-180"})]),_:1}),a(e(nr),{class:"pt-1"},{default:u(()=>[t("div",_a,[Be(t("select",{"onUpdate:modelValue":o[6]||(o[6]=h=>m.value=h),class:"w-full bg-transparent border-none text-xs font-medium focus:ring-0 cursor-pointer py-1.5 px-2"},[...o[20]||(o[20]=[t("option",{value:"Academic Formal"},"Academic Formal",-1),t("option",{value:"Academic Casual"},"Academic Casual",-1),t("option",{value:"Technical"},"Technical",-1),t("option",{value:"Analytical"},"Analytical",-1),t("option",{value:"Research-Heavy"},"Research-Heavy",-1)])],512),[[Br,m.value]])])]),_:1})]),_:1})]),_:1})]),_:1}),a(ns,{"show-citation-helper":p.showCitationHelper,"chapter-content":p.chapterContent,"onUpdate:showCitationHelper":o[7]||(o[7]=h=>y("update:showCitationHelper",h)),onInsertCitation:N},null,8,["show-citation-helper","chapter-content"])]))}}),ka=_r(Ca,[["__scopeId","data-v-03da2601"]]);function Sa(c,n){return _(),L("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor","aria-hidden":"true","data-slot":"icon"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M9.75 3.104v5.714a2.25 2.25 0 0 1-.659 1.591L5 14.5M9.75 3.104c-.251.023-.501.05-.75.082m.75-.082a24.301 24.301 0 0 1 4.5 0m0 0v5.714c0 .597.237 1.17.659 1.591L19.8 15.3M14.25 3.104c.251.023.501.05.75.082M19.8 15.3l-1.57.393A9.065 9.065 0 0 1 12 15a9.065 9.065 0 0 0-6.23-.693L5 14.5m14.8.8 1.402 1.402c1.232 1.232.65 3.318-1.067 3.611A48.309 48.309 0 0 1 12 21c-2.773 0-5.491-.235-8.135-.687-1.718-.293-2.3-2.379-1.067-3.61L5 14.5"})])}function Ta(c,n){return _(),L("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor","aria-hidden":"true","data-slot":"icon"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"m4.5 12.75 6 6 9-13.5"})])}function Ea(c,n){return _(),L("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor","aria-hidden":"true","data-slot":"icon"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M19.5 14.25v-2.625a3.375 3.375 0 0 0-3.375-3.375h-1.5A1.125 1.125 0 0 1 13.5 7.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H8.25m0 12.75h7.5m-7.5 3H12M10.5 2.25H5.625c-.621 0-1.125.504-1.125 1.125v17.25c0 .621.504 1.125 1.125 1.125h12.75c.621 0 1.125-.504 1.125-1.125V11.25a9 9 0 0 0-9-9Z"})])}function gr(c,n){return _(),L("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor","aria-hidden":"true","data-slot":"icon"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M12 9v3.75m-9.303 3.376c-.866 1.5.217 3.374 1.948 3.374h14.71c1.73 0 2.813-1.874 1.948-3.374L13.949 3.378c-.866-1.5-3.032-1.5-3.898 0L2.697 16.126ZM12 15.75h.007v.008H12v-.008Z"})])}function $a(){const c=f(!1),n=f(null),l=f(null),y=f(null),m=f([]),r=f({}),v=M(()=>l.value?.hasDataCollectionNeeds??!1),i=M(()=>l.value?.types??[]),T=M(()=>y.value?.hasPlaceholder?y.value.detectedType:null),x=M(()=>y.value?.hasPlaceholder?y.value.confidence??0:0);async function q(p){c.value=!0,n.value=null;try{const o=await fetch(`/api/chapters/${p}/detect`,{headers:{Accept:"application/json","X-Requested-With":"XMLHttpRequest"}});if(!o.ok)throw new Error("Failed to detect data collection needs");const h=await o.json();l.value=h.detection}catch(o){n.value=o instanceof Error?o.message:"An error occurred",console.error("Error detecting data collection needs:",o)}finally{c.value=!1}}async function A(p){c.value=!0,n.value=null;try{const o=await fetch(`/api/chapters/${p}/placeholder`,{headers:{Accept:"application/json","X-Requested-With":"XMLHttpRequest"}});if(!o.ok)throw new Error("Failed to generate placeholder");const h=await o.json();y.value=h.placeholder}catch(o){n.value=o instanceof Error?o.message:"An error occurred",console.error("Error generating placeholder:",o)}finally{c.value=!1}}async function R(p){c.value=!0,n.value=null;try{const o=await fetch(`/api/chapters/${p}/suggestions`,{headers:{Accept:"application/json","X-Requested-With":"XMLHttpRequest"}});if(!o.ok)throw new Error("Failed to get suggestions");const h=await o.json();m.value=h.suggestions}catch(o){n.value=o instanceof Error?o.message:"An error occurred",console.error("Error getting suggestions:",o)}finally{c.value=!1}}async function d(){c.value=!0,n.value=null;try{const p=await fetch("/api/data-collection/templates",{headers:{Accept:"application/json","X-Requested-With":"XMLHttpRequest"}});if(!p.ok)throw new Error("Failed to get templates");const o=await p.json();r.value=o.templates}catch(p){n.value=p instanceof Error?p.message:"An error occurred",console.error("Error getting templates:",p)}finally{c.value=!1}}async function w(p){c.value=!0,n.value=null;try{const o=await fetch(`/api/data-collection/template?type=${encodeURIComponent(p)}`,{headers:{Accept:"application/json","X-Requested-With":"XMLHttpRequest"}});if(!o.ok)throw new Error("Failed to get template");return(await o.json()).template}catch(o){return n.value=o instanceof Error?o.message:"An error occurred",console.error("Error getting template:",o),null}finally{c.value=!1}}async function C(p,o,h="append"){c.value=!0,n.value=null;try{if(!(await fetch(`/api/chapters/${p}/insert-template`,{method:"POST",headers:{Accept:"application/json","Content-Type":"application/json","X-Requested-With":"XMLHttpRequest"},body:JSON.stringify({type:o,position:h})})).ok)throw new Error("Failed to insert template");return!0}catch(O){return n.value=O instanceof Error?O.message:"An error occurred",console.error("Error inserting template:",O),!1}finally{c.value=!1}}async function E(p){await Promise.all([q(p),A(p),R(p)])}function I(p){return{survey:"Survey/Questionnaire",experiment:"Laboratory Experiment",engineering:"Engineering Design",statistical:"Statistical Analysis",construction:"Construction Project"}[p]||p.charAt(0).toUpperCase()+p.slice(1)}function $(p){return p>=50?"High":p>=25?"Medium":"Low"}function k(p){return p>=50?"text-green-600 dark:text-green-400":p>=25?"text-yellow-600 dark:text-yellow-400":"text-red-600 dark:text-red-400"}function N(){l.value=null,y.value=null,m.value=[],n.value=null}return{isLoading:c,error:n,detection:l,placeholder:y,suggestions:m,templates:r,hasDataCollectionNeeds:v,detectedTypes:i,primaryType:T,primaryConfidence:x,detectDataCollectionNeeds:q,generatePlaceholder:A,getSuggestions:R,getAllTemplates:d,getTemplate:w,insertTemplate:C,analyzeChapter:E,getTypeName:I,getConfidenceLevel:$,getConfidenceColor:k,clearData:N}}const Aa={class:"space-y-4"},Da={class:"flex items-center justify-between"},Pa={class:"flex items-center gap-2"},Ma=["disabled"],Ra={key:0,class:"text-center py-4"},ja={key:1,class:"text-center py-4"},Fa={key:2},qa={class:"bg-blue-50 dark:bg-blue-900/20 rounded-lg p-3"},La={class:"flex items-start gap-2"},Ga={class:"min-w-0 flex-1"},Ia={class:"mt-2 space-y-1"},Na={class:"text-xs text-blue-700 dark:text-blue-300"},za={key:0,class:"border border-gray-200 dark:border-gray-700 rounded-lg p-3"},Wa={class:"flex items-center justify-between mb-2"},Oa={class:"text-xs px-2 py-1 bg-green-100 text-green-700 rounded dark:bg-green-900/20 dark:text-green-400"},Ha={class:"text-xs text-gray-600 dark:text-gray-400 mb-3"},Ua={class:"flex gap-2"},Ba=["disabled"],Qa={key:0,class:"mt-3 p-2 bg-gray-50 dark:bg-gray-800 rounded text-xs"},Ka={class:"whitespace-pre-wrap text-gray-700 dark:text-gray-300 overflow-auto max-h-32"},Xa={key:1,class:"space-y-2"},Va={class:"text-xs font-medium text-gray-700 dark:text-gray-300 mb-2"},Ja={class:"space-y-1"},Ya={class:"border border-gray-200 dark:border-gray-700 rounded-lg"},Za={class:"p-3 pt-0 space-y-2"},en={class:"text-xs font-medium text-gray-900 dark:text-gray-100"},tn={class:"text-xs text-gray-600 dark:text-gray-400"},rn=["onClick","disabled"],sn={key:3,class:"bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 rounded-lg p-3"},an={class:"flex items-start gap-2"},nn={class:"text-xs text-red-600 dark:text-red-400 mt-1"},on=rt({__name:"DataCollectionPanel",props:{chapterId:{},content:{}},setup(c){const n=c,l=f(!1),{isLoading:y,error:m,placeholder:r,suggestions:v,templates:i,hasDataCollectionNeeds:T,detectedTypes:x,primaryType:q,analyzeChapter:A,insertTemplate:R,getAllTemplates:d,getTypeName:w,getConfidenceColor:C}=$a();let E=null;we(()=>n.content,($,k)=>{!$||$===k||(E&&clearTimeout(E),E=setTimeout(()=>{$&&$.length>500&&A(n.chapterId)},3e3))},{immediate:!1});async function I($,k,N="append"){await R($,k,N)?(S.success("Template added successfully"),l.value=!1,setTimeout(()=>{A($)},1e3)):S.error(m.value||"Failed to insert template")}return pt(async()=>{await d(),n.content&&n.content.length>500&&await A(n.chapterId)}),($,k)=>(_(),L("div",Aa,[t("div",Da,[t("div",Pa,[a(e(Sa),{class:"h-5 w-5 text-blue-600 dark:text-blue-400"}),k[3]||(k[3]=t("h3",{class:"text-sm font-semibold text-gray-900 dark:text-gray-100"}," Data Collection Assistant ",-1))]),e(T)?ee("",!0):(_(),L("button",{key:0,onClick:k[0]||(k[0]=N=>e(A)($.chapterId)),disabled:e(y),class:"text-xs px-2 py-1 bg-blue-50 text-blue-600 rounded hover:bg-blue-100 disabled:opacity-50 dark:bg-blue-900/20 dark:text-blue-400 dark:hover:bg-blue-900/30"},D(e(y)?"Analyzing...":"Scan for Data Needs"),9,Ma))]),e(y)&&!e(T)?(_(),L("div",Ra,[...k[4]||(k[4]=[t("div",{class:"animate-spin rounded-full h-6 w-6 border-b-2 border-blue-600 mx-auto"},null,-1),t("p",{class:"text-xs text-gray-500 mt-2"},"Analyzing chapter content...",-1)])])):!e(T)&&!e(y)?(_(),L("div",ja,[a(e(Ea),{class:"h-8 w-8 text-gray-400 mx-auto mb-2"}),k[5]||(k[5]=t("p",{class:"text-sm text-gray-500 dark:text-gray-400"}," No data collection requirements detected in this chapter. ",-1)),k[6]||(k[6]=t("p",{class:"text-xs text-gray-400 mt-1"},' Add keywords like "survey", "experiment", or "statistical analysis" to get assistance. ',-1))])):e(T)?(_(),L("div",Fa,[t("div",qa,[t("div",La,[a(e(gr),{class:"h-4 w-4 text-blue-600 dark:text-blue-400 mt-0.5 flex-shrink-0"}),t("div",Ga,[k[7]||(k[7]=t("p",{class:"text-sm font-medium text-blue-900 dark:text-blue-100"}," Data Collection Requirements Detected ",-1)),t("div",Ia,[(_(!0),L(Ye,null,Ze(e(x),N=>(_(),L("div",{key:N,class:"flex items-center justify-between"},[t("span",Na,D(e(w)(N)),1),t("span",{class:de(["text-xs font-medium",e(C)(e(r)?.allConfidence?.[N]||0)])},D(e(r)?.allConfidence?.[N]?.toFixed(1))+"% confidence ",3)]))),128))])])])]),e(q)&&e(r)?.template?(_(),L("div",za,[t("div",Wa,[k[8]||(k[8]=t("h4",{class:"text-sm font-medium text-gray-900 dark:text-gray-100"}," Recommended Template ",-1)),t("span",Oa,D(e(w)(e(q))),1)]),t("p",Ha,D(e(r).template.title),1),t("div",Ua,[t("button",{onClick:k[1]||(k[1]=N=>I($.chapterId,e(q),"append")),disabled:e(y),class:"flex-1 text-xs px-3 py-1.5 bg-blue-600 text-white rounded hover:bg-blue-700 disabled:opacity-50"},D(e(y)?"Inserting...":"Add Template"),9,Ba),t("button",{onClick:k[2]||(k[2]=N=>l.value=!l.value),class:"text-xs px-2 py-1.5 border border-gray-200 text-gray-600 rounded hover:bg-gray-50 dark:border-gray-600 dark:text-gray-400 dark:hover:bg-gray-800"},D(l.value?"Hide":"Preview"),1)]),l.value?(_(),L("div",Qa,[t("pre",Ka,D(e(r).template.content.trim()),1)])):ee("",!0)])):ee("",!0),e(v).length>0?(_(),L("div",Xa,[k[9]||(k[9]=t("h4",{class:"text-sm font-medium text-gray-900 dark:text-gray-100"}," Research Guidelines ",-1)),(_(!0),L(Ye,null,Ze(e(v),N=>(_(),L("div",{key:N.type,class:"border border-gray-200 dark:border-gray-700 rounded-lg p-3"},[t("h5",Va,D(N.title),1),t("ul",Ja,[(_(!0),L(Ye,null,Ze(N.suggestions,(p,o)=>(_(),L("li",{key:o,class:"flex items-start gap-1.5 text-xs text-gray-600 dark:text-gray-400"},[a(e(Ta),{class:"h-3 w-3 text-green-500 mt-0.5 flex-shrink-0"}),t("span",null,D(p),1)]))),128))])]))),128))])):ee("",!0),t("details",Ya,[k[10]||(k[10]=t("summary",{class:"p-3 cursor-pointer text-sm font-medium text-gray-700 dark:text-gray-300 hover:bg-gray-50 dark:hover:bg-gray-800"}," Browse All Templates ",-1)),t("div",Za,[(_(!0),L(Ye,null,Ze(e(i),(N,p)=>(_(),L("div",{key:p,class:"flex items-center justify-between p-2 bg-gray-50 dark:bg-gray-800 rounded"},[t("div",null,[t("span",en,D(e(w)(p)),1),t("p",tn,D(N.title),1)]),t("button",{onClick:o=>I($.chapterId,p,"append"),disabled:e(y),class:"text-xs px-2 py-1 bg-blue-600 text-white rounded hover:bg-blue-700 disabled:opacity-50"}," Add ",8,rn)]))),128))])])])):ee("",!0),e(m)?(_(),L("div",sn,[t("div",an,[a(e(gr),{class:"h-4 w-4 text-red-500 mt-0.5 flex-shrink-0"}),t("div",null,[k[11]||(k[11]=t("p",{class:"text-sm font-medium text-red-800 dark:text-red-200"}," Analysis Error ",-1)),t("p",nn,D(e(m)),1)])])])):ee("",!0)]))}}),ln={class:"h-14 flex items-center justify-between px-4 border-b border-border/40 shrink-0"},cn={class:"flex-1 overflow-y-auto custom-scrollbar"},un={class:"p-4 space-y-6"},hr=rt({__name:"ChapterEditorRightSidebar",props:{project:{},chapter:{},isGenerating:{type:Boolean},selectedText:{},isLoadingSuggestions:{type:Boolean},showCitationHelper:{type:Boolean},chapterContent:{},currentWordCount:{},targetWordCount:{},handleAIGeneration:{type:Function},getAISuggestions:{type:Function},updateCitationHelper:{type:Function},insertCitation:{type:Function},checkCitations:{type:Function},showDefensePrep:{type:Boolean},defenseQuestions:{},isLoadingDefenseQuestions:{type:Boolean},isGeneratingDefenseQuestions:{type:Boolean},chapterContext:{},defenseWatcher:{},autoGenerateDefense:{type:Boolean},handleDefensePanelToggle:{type:Function},generateNewDefenseQuestions:{type:Function},handleDefenseAutoToggle:{type:Function},refreshDefenseQuestions:{type:Function},markQuestionHelpful:{type:Function},hideQuestion:{type:Function},isCollapsed:{type:Boolean},containerClass:{}},setup(c){const n=c;return(l,y)=>Be((_(),L("aside",{class:de(n.containerClass)},[t("div",ln,[y[1]||(y[1]=t("span",{class:"text-sm font-semibold tracking-tight text-foreground"},"Writing Assistant",-1)),a(e(Ae),null,{default:u(()=>[a(e(Ee),{asChild:""},{default:u(()=>[a(e(K),{variant:"ghost",size:"icon",class:"h-7 w-7"},{default:u(()=>[a(e(wt),{class:"h-3.5 w-3.5"})]),_:1})]),_:1}),a(e($e),null,{default:u(()=>[...y[0]||(y[0]=[G("Manage Citations",-1)])]),_:1})]),_:1})]),t("div",cn,[t("div",un,[a(ka,{project:n.project,chapter:n.chapter,"is-generating":n.isGenerating,"selected-text":n.selectedText,"is-loading-suggestions":n.isLoadingSuggestions,"show-citation-helper":n.showCitationHelper,"chapter-content":n.chapterContent,"current-word-count":n.currentWordCount,"target-word-count":n.targetWordCount,onStartStreamingGeneration:n.handleAIGeneration,onGetAiSuggestions:n.getAISuggestions,"onUpdate:showCitationHelper":n.updateCitationHelper,onInsertCitation:n.insertCitation,onCheckCitations:n.checkCitations},null,8,["project","chapter","is-generating","selected-text","is-loading-suggestions","show-citation-helper","chapter-content","current-word-count","target-word-count","onStartStreamingGeneration","onGetAiSuggestions","onUpdate:showCitationHelper","onInsertCitation","onCheckCitations"]),a(os,{"show-defense-prep":n.showDefensePrep,questions:n.defenseQuestions,"is-loading":n.isLoadingDefenseQuestions,"is-generating":n.isGeneratingDefenseQuestions,"chapter-context":n.chapterContext,"defense-watcher":n.defenseWatcher,"auto-generate-enabled":n.autoGenerateDefense,"onUpdate:showDefensePrep":n.handleDefensePanelToggle,onGenerateMore:n.generateNewDefenseQuestions,onToggleAutoGenerate:n.handleDefenseAutoToggle,onRefresh:n.refreshDefenseQuestions,onMarkHelpful:n.markQuestionHelpful,onHideQuestion:n.hideQuestion},null,8,["show-defense-prep","questions","is-loading","is-generating","chapter-context","defense-watcher","auto-generate-enabled","onUpdate:showDefensePrep","onGenerateMore","onToggleAutoGenerate","onRefresh","onMarkHelpful","onHideQuestion"]),a(on,{"chapter-id":n.chapter.id,content:n.chapterContent},null,8,["chapter-id","content"])])])],2)),[[tt,!n.isCollapsed]])}}),dn={class:"flex items-center justify-between mb-3"},pn={class:"flex items-center gap-3"},gn={class:"p-2 rounded-lg bg-blue-500/10"},hn={class:"text-right"},fn={class:"space-y-2"},vn={class:"flex justify-between items-center text-xs"},mn={class:"relative"},xn={key:0},bn={class:"space-y-3"},yn={class:"flex-1"},wn={class:"text-sm font-medium"},_n={class:"text-xs text-muted-foreground"},Cn={class:"w-20 h-2 bg-muted rounded-full overflow-hidden ml-3"},kn={key:1},Sn={class:"space-y-2"},Tn={class:"flex-1"},En={class:"text-sm font-medium"},$n={class:"text-xs text-muted-foreground"},An={key:2,class:"flex items-center justify-center gap-3 p-4 rounded-lg bg-blue-50/50 border border-blue-200/50"},Dn={key:3,class:"text-center p-4 rounded-lg bg-muted/30"},fr=rt({__name:"WritingStatistics",props:{showStatistics:{type:Boolean},currentWordCount:{},writingStats:{},qualityAnalysis:{},isAnalyzing:{type:Boolean}},setup(c){const n=c;M(()=>{if(!n.qualityAnalysis?.quality_level)return"text-muted-foreground";switch(n.qualityAnalysis.quality_level){case"Excellent":return"text-green-600";case"Good":return"text-blue-600";case"Satisfactory":return"text-yellow-600";case"Needs Improvement":return"text-orange-600";case"Poor":return"text-red-600";default:return"text-muted-foreground"}});const l=M(()=>n.qualityAnalysis?.scores?Object.entries(n.qualityAnalysis.scores).filter(([,m])=>m.max>0).filter(([,m])=>m.percentage<75).sort(([,m],[,r])=>m.percentage-r.percentage).map(([m,r])=>({category:m.replace(" & "," & "),percentage:Math.round(r.percentage),score:r.score,max:r.max,status:r.percentage<40?"poor":r.percentage<60?"needs-work":"fair"})):[]),y=M(()=>{const m=n.qualityAnalysis?.total_score||0;return m>=80?{text:"Excellent",color:"text-green-600",bgColor:"bg-green-50"}:m>=70?{text:"Satisfactory",color:"text-yellow-600",bgColor:"bg-yellow-50"}:m>=60?{text:"Needs Work",color:"text-orange-600",bgColor:"bg-orange-50"}:{text:"Poor",color:"text-red-600",bgColor:"bg-red-50"}});return(m,r)=>m.showStatistics?(_(),Y(e(_t),{key:0,class:"border border-border/50 bg-gradient-to-br from-card/80 to-card/60 backdrop-blur-sm shadow-lg"},{default:u(()=>[m.qualityAnalysis?(_(),Y(e(kt),{key:0,class:"pb-4 border-b border-border/50"},{default:u(()=>[t("div",dn,[t("div",pn,[t("div",gn,[a(e(wt),{class:"h-4 w-4 text-blue-600"})]),t("div",null,[a(e($t),{class:"text-sm font-semibold"},{default:u(()=>[...r[0]||(r[0]=[G("Academic Quality",-1)])]),_:1}),r[1]||(r[1]=t("p",{class:"text-xs text-muted-foreground"},"AI-powered analysis",-1))])]),t("div",hn,[t("div",{class:de(["text-2xl font-bold",y.value.color])},[G(D(m.qualityAnalysis.total_score),1),r[2]||(r[2]=t("span",{class:"text-sm text-muted-foreground"},"/100",-1))],2),a(e(Ue),{class:de([[y.value.color,y.value.bgColor],"text-xs font-medium"]),variant:"outline"},{default:u(()=>[G(D(y.value.text),1)]),_:1},8,["class"])])]),t("div",fn,[t("div",vn,[r[3]||(r[3]=t("span",{class:"text-muted-foreground"},"Overall Score",-1)),t("span",{class:de(["font-medium",m.qualityAnalysis.meets_threshold?"text-green-600":"text-orange-600"])},D(m.qualityAnalysis.meets_threshold?"Meets threshold ‚úì":"Below 80% threshold"),3)]),t("div",mn,[a(e(wr),{"model-value":Math.round(m.qualityAnalysis.total_score||0),class:de(["h-2",{"[&>[data-slot=progress-indicator]]:bg-green-500":(m.qualityAnalysis.total_score||0)>=80,"[&>[data-slot=progress-indicator]]:bg-yellow-500":(m.qualityAnalysis.total_score||0)>=70&&(m.qualityAnalysis.total_score||0)<80,"[&>[data-slot=progress-indicator]]:bg-orange-500":(m.qualityAnalysis.total_score||0)>=60&&(m.qualityAnalysis.total_score||0)<70,"[&>[data-slot=progress-indicator]]:bg-red-500":(m.qualityAnalysis.total_score||0)<60}])},null,8,["model-value","class"]),r[4]||(r[4]=t("div",{class:"absolute inset-0 flex items-center justify-center"},[t("div",{class:"w-0.5 h-4 bg-orange-400/60 rounded-full",style:{"margin-left":"80%"}})],-1))])])]),_:1})):ee("",!0),a(e(Ct),{class:"p-4 space-y-4"},{default:u(()=>[m.qualityAnalysis?.scores?(_(),L("div",xn,[r[5]||(r[5]=t("h4",{class:"text-xs font-semibold text-muted-foreground mb-3 flex items-center gap-2"},[t("div",{class:"w-1 h-4 bg-green-500 rounded-full"}),G(" Analysis Results ")],-1)),t("div",bn,[(_(!0),L(Ye,null,Ze(Object.entries(m.qualityAnalysis.scores).filter(([,v])=>v.max>0),([v,i])=>(_(),L("div",{key:v,class:"flex items-center justify-between p-3 rounded-lg bg-muted/30 hover:bg-muted/40 transition-colors"},[t("div",yn,[t("div",wn,D(v),1),t("div",_n,[G(D(i.score)+"/"+D(i.max)+" points ",1),t("span",{class:de(["ml-1",{"text-red-500":i.percentage<50,"text-orange-500":i.percentage>=50&&i.percentage<75,"text-blue-500":i.percentage>=75&&i.percentage<90,"text-green-500":i.percentage>=90}])}," ("+D(Math.round(i.percentage))+"%) ",3)])]),t("div",Cn,[t("div",{class:de(["h-full transition-all duration-500 rounded-full",{"bg-red-500":i.percentage<50,"bg-orange-500":i.percentage>=50&&i.percentage<75,"bg-blue-500":i.percentage>=75&&i.percentage<90,"bg-green-500":i.percentage>=90}]),style:ut({width:`${i.percentage}%`})},null,6)])]))),128))])])):ee("",!0),l.value.length>0?(_(),L("div",kn,[r[6]||(r[6]=t("h4",{class:"text-xs font-semibold text-muted-foreground mb-3 flex items-center gap-2"},[t("div",{class:"w-1 h-4 bg-orange-500 rounded-full"}),G(" Focus Areas ")],-1)),t("div",Sn,[(_(!0),L(Ye,null,Ze(l.value,v=>(_(),L("div",{key:v.category,class:"flex items-center gap-3 p-3 rounded-lg border border-orange-200/50 bg-orange-50/30"},[a(e(bs),{class:"h-4 w-4 text-orange-500 flex-shrink-0"}),t("div",Tn,[t("div",En,D(v.category),1),t("div",$n,[G(D(v.score)+"/"+D(v.max)+" points - ",1),t("span",{class:de({"text-red-600":v.status==="poor","text-orange-600":v.status==="needs-work","text-yellow-600":v.status==="fair"})},D(v.status==="poor"?"needs significant improvement":v.status==="needs-work"?"needs improvement":"fair, could be better"),3)])])]))),128))])])):ee("",!0),m.isAnalyzing?(_(),L("div",An,[a(e(xs),{class:"h-4 w-4 text-blue-500 animate-pulse"}),r[7]||(r[7]=t("span",{class:"text-sm text-blue-700 font-medium"},"Analyzing academic quality with AI...",-1))])):ee("",!0),!m.qualityAnalysis&&!m.isAnalyzing?(_(),L("div",Dn,[a(e(wt),{class:"h-8 w-8 text-muted-foreground mx-auto mb-2"}),r[8]||(r[8]=t("p",{class:"text-sm text-muted-foreground"},'Click "Analyze" to get AI-powered quality insights',-1))])):ee("",!0)]),_:1})]),_:1})):ee("",!0)}});function Pn(c){const{delay:n=1e4,onSave:l}=c,y=f(!1),m=f(!1),r=f(null),v=()=>{y.value=!0,r.value&&clearTimeout(r.value),r.value=setTimeout(()=>{i(!0)},n)},i=async(x=!1)=>{if(!m.value){m.value=!0;try{await l(x),y.value=!1,r.value&&(clearTimeout(r.value),r.value=null)}finally{m.value=!1}}};return{hasUnsavedChanges:y,isSaving:m,triggerAutoSave:v,save:i,clearAutoSave:()=>{r.value&&(clearTimeout(r.value),r.value=null)}}}function Mn(c){const n=f({sentences:0,paragraphs:0,readingTime:0,avgWordLength:0,uniqueWords:0,commonWords:[]}),l=M(()=>c.value?c.value.split(/\s+/).filter(r=>r.length>0).length:0),y=()=>{if(!c.value){n.value={sentences:0,paragraphs:0,readingTime:0,avgWordLength:0,uniqueWords:0,commonWords:[]};return}const r=c.value,v=r.split(/\s+/).filter(R=>R.length>0),i=r.split(/[.!?]+/).filter(R=>R.trim().length>0),T=r.split(`

`).filter(R=>R.trim().length>0),x=new Map;v.forEach(R=>{const d=R.toLowerCase().replace(/[^a-z0-9]/g,"");d&&x.set(d,(x.get(d)||0)+1)});const q=new Set(["the","a","an","and","or","but","in","on","at","to","for","of","with","by","is","was","are","were"]),A=Array.from(x.entries()).filter(([R])=>!q.has(R)).sort((R,d)=>d[1]-R[1]).slice(0,5).map(([R])=>R);n.value={sentences:i.length,paragraphs:T.length,readingTime:Math.ceil(v.length/200),avgWordLength:v.reduce((R,d)=>R+d.length,0)/v.length,uniqueWords:x.size,commonWords:A}},m=M(()=>{if(!c.value)return 0;let r=0;const v=c.value;v.includes("##")&&(r+=20),v.length>1e3&&(r+=20),v.match(/\[.*?\]/g)&&(r+=15),(v.includes("**")||v.includes("*"))&&(r+=10);const i=v.split(/[.!?]+/).filter(x=>x.trim().length>0);if(i.length>0){const x=i.reduce((q,A)=>q+A.split(/\s+/).length,0)/i.length;x>10&&x<25&&(r+=20)}return v.split(`

`).filter(x=>x.trim().length>0).length>3&&(r+=15),Math.min(r,100)});return{writingStats:n,currentWordCount:l,writingQualityScore:m,calculateWritingStats:y}}function Rn(c,n=f(3e3),l=.8){const y=j=>{if(!j)return 0;const ce=j.replace(/<[^>]*>/g,"").trim().replace(/\s+/g," ");if(!ce)return 0;const _e=ce.match(/\b\w+\b/g);return _e?_e.length:0},m=j=>j?j.replace(/<[^>]*>/g,"").replace(/\r\n|\r/g,`
`).trim().split(/\n\s*\n/).filter(H=>H.trim().length>0).length:0,r=j=>{if(!j)return 0;const ce=j.replace(/<[^>]*>/g,"").match(/[.!?]+/g);return ce?ce.length:0},v=j=>Math.round(j/200*10)/10,i=M(()=>y(c.value)),T=M(()=>c.value.length),x=M(()=>c.value.replace(/\s/g,"").length),q=M(()=>m(c.value)),A=M(()=>r(c.value)),R=M(()=>v(i.value)),d=M(()=>{const j=n.value;return!j||j<=0?0:Math.min(i.value/j*100,100)}),w=M(()=>i.value>=n.value*l),C=M(()=>{const j=n.value-i.value;return Math.max(j,0)}),E=M(()=>{const j=n.value*l-i.value;return Math.max(j,0)}),I=M(()=>({wordCount:i.value,characterCount:T.value,characterCountNoSpaces:x.value,paragraphCount:q.value,sentenceCount:A.value,readingTimeMinutes:R.value})),$=M(()=>({current:i.value,target:n.value,percentage:d.value,isComplete:w.value,completionThreshold:l})),k=j=>j>=1e3?`${Math.round(j/100)/10}k`:j.toString(),N=(j=0)=>`${Math.round(d.value*Math.pow(10,j))/Math.pow(10,j)}%`,p=()=>`${i.value} / ${n.value} words (${N()}%)`,o=()=>{if(w.value)return`‚úÖ Complete (${k(i.value)} words)`;const j=E.value;return`${k(j)} more words to complete`},h=()=>{const j=i.value,ae=n.value;return j===0?"empty":j<ae*.25?"started":j<ae*.75?"progressing":j<ae*l?"near_complete":j<ae?"complete":"exceeded"},O=()=>{const j=h();return{empty:"text-gray-500",started:"text-blue-500",progressing:"text-yellow-500",near_complete:"text-orange-500",complete:"text-green-500",exceeded:"text-emerald-600"}[j]},X=()=>{const j=h();return{empty:"bg-gray-200",started:"bg-blue-200",progressing:"bg-yellow-200",near_complete:"bg-orange-200",complete:"bg-green-200",exceeded:"bg-emerald-200"}[j]},Z=800,B=M(()=>i.value>=Z),ie=M(()=>Math.max(Z-i.value,0)),ge=M(()=>Math.min(i.value/Z*100,100));return{currentWordCount:i,characterCount:T,characterCountNoSpaces:x,paragraphCount:q,sentenceCount:A,readingTimeMinutes:R,progressPercentage:d,isComplete:w,wordsRemaining:C,wordsToComplete:E,wordCountStats:I,wordCountProgress:$,meetsDefenseThreshold:B,defenseWordsRemaining:ie,defenseProgressPercentage:ge,DEFENSE_THRESHOLD:Z,formatWordCount:k,formatProgress:N,getProgressDisplay:p,getCompletionDisplay:o,getWordCountStatus:h,getStatusColor:O,getProgressBarColor:X,countWords:y}}function jn(c){const n=f(!1),l=f(null),y=f([]),m=f(null),r=M(()=>{if(!l.value?.quality_level)return"text-muted-foreground";switch(l.value.quality_level){case"Excellent":return"text-green-600";case"Good":return"text-blue-600";case"Satisfactory":return"text-yellow-600";case"Needs Improvement":return"text-orange-600";case"Poor":return"text-red-600";default:return"text-muted-foreground"}}),v=M(()=>l.value?.scores?Object.entries(l.value.scores).sort(([,d],[,w])=>d.percentage-w.percentage).slice(0,3).map(([d,w])=>({category:d.replace(" & "," & "),percentage:Math.round(w.percentage),score:w.score,max:w.max})):[]),i=async()=>{try{n.value=!0,m.value=null,await ye.get("/sanctum/csrf-cookie");const d=await ye.post(le("api.chapters.analysis.analyze",{chapter:c}));if(d.data.success)return l.value=d.data.analysis,d.data.analysis;throw new Error(d.data.error||"Analysis failed")}catch(d){return m.value=d.response?.data?.error||d.message||"Analysis failed",console.error("Chapter analysis failed:",d),null}finally{n.value=!1}};return{isAnalyzing:n,latestAnalysis:l,analysisHistory:y,error:m,qualityLevelColor:r,topImprovementAreas:v,analyzeChapter:i,getLatestAnalysis:async()=>{try{await ye.get("/sanctum/csrf-cookie");const d=await ye.get(le("api.chapters.analysis.latest",{chapter:c}));return d.data.success?(l.value=d.data.analysis,d.data.analysis):(l.value=null,null)}catch(d){return d.response?.status!==404&&(m.value=d.response?.data?.error||d.message||"Failed to get analysis",console.error("Failed to get latest analysis:",d)),null}},getAnalysisHistory:async()=>{try{await ye.get("/sanctum/csrf-cookie");const d=await ye.get(le("api.chapters.analysis.history",{chapter:c}));if(d.data.success)return y.value=d.data.analyses,d.data.analyses;throw new Error(d.data.error||"Failed to get history")}catch(d){return m.value=d.response?.data?.error||d.message||"Failed to get analysis history",console.error("Failed to get analysis history:",d),[]}},autoAnalyze:async(d,w=500)=>{d>=w&&await i()},getScoreColor:(d,w)=>{const C=d/w*100;return C>=80?"text-green-600":C>=70?"text-blue-600":C>=60?"text-yellow-600":C>=40?"text-orange-600":"text-red-600"},getProgressVariant:d=>d>=80?"success":d>=60?"default":"destructive"}}const Fn={class:"relative z-20 flex flex-shrink-0 items-center justify-between border-b border-border/40 bg-background/60 p-4 backdrop-blur-xl supports-[backdrop-filter]:bg-background/40 transition-all duration-300"},qn={class:"flex items-center gap-5"},Ln={class:"flex flex-col"},Gn={class:"flex items-center gap-3 text-xs text-muted-foreground"},In={class:"flex items-center gap-1.5"},Nn={class:"flex items-center gap-4"},zn={class:"flex items-center p-1 rounded-full border border-border/40 bg-background/50 backdrop-blur-sm shadow-sm"},Wn={class:"flex items-center gap-2"},On={class:"relative z-20 h-[2px] w-full bg-border/20"},Hn={key:0,class:"mx-3 my-2"},Un={class:"relative overflow-hidden rounded-xl border border-blue-200 bg-gradient-to-br from-blue-50 to-purple-50 p-3 shadow-sm dark:border-blue-800 dark:from-blue-950/30 dark:to-purple-950/30"},Bn={class:"relative z-10 mb-2 flex items-center justify-between"},Qn={class:"flex items-center gap-2"},Kn={class:"relative"},Xn={class:"flex h-6 w-6 items-center justify-center rounded-full bg-gradient-to-br from-blue-500 to-purple-600"},Vn={class:"text-xs text-blue-700 dark:text-blue-300"},Jn={class:"relative z-10 mb-2"},Yn={class:"mb-1 flex items-center justify-between"},Zn={class:"text-xs text-blue-600 dark:text-blue-400"},eo={class:"relative h-2 overflow-hidden rounded-full bg-blue-100 dark:bg-blue-900/50"},to={class:"relative z-10 flex items-center gap-2"},ro={class:"flex-shrink-0"},so={key:0,class:"h-2 w-2 animate-bounce rounded-full bg-blue-500"},ao={key:1,class:"flex gap-0.5"},no={key:2,class:"h-2 w-2 animate-spin rounded-full border-2 border-blue-500 border-t-transparent"},oo={key:3,class:"h-2 w-2 rounded-full bg-green-500"},lo={key:4,class:"h-2 w-2 rounded-full bg-red-500"},io={class:"flex-1 text-xs text-blue-800 dark:text-blue-200"},co={class:"relative z-10 flex flex-1 overflow-hidden"},uo={key:0,class:"w-[320px] flex-shrink-0 border-r border-border/50 bg-background/80 backdrop-blur-xl shadow-xl z-20"},po={class:"h-full overflow-y-auto custom-scrollbar"},go={class:"p-4"},ho={class:"mb-3"},fo={class:"text-xs text-muted-foreground"},vo={class:"flex min-h-0 flex-1 flex-col bg-transparent relative"},mo={class:"flex-1 overflow-hidden relative"},xo={class:"absolute inset-0 overflow-y-auto custom-scrollbar flex flex-col items-center py-8 px-4 sm:px-8"},bo={class:"flex h-full w-full overflow-hidden relative"},yo={class:"hidden lg:flex w-80 flex-col border-r border-border/40 bg-background/60 backdrop-blur-xl z-20 transition-all duration-300"},wo={class:"h-14 flex items-center justify-between px-4 border-b border-border/40 shrink-0"},_o={class:"p-4"},Co={class:"flex-1 flex flex-col relative z-10 min-w-0 bg-background/30 dark:bg-background transition-all duration-300"},ko={class:"min-h-[5.5rem] flex flex-wrap flex-shrink-0 items-start md:items-center justify-between border-b border-border/40 bg-background/60 backdrop-blur-md px-4 py-2 relative z-30 transition-all duration-300"},So={class:"contents md:flex items-center gap-4 flex-1"},To={class:"flex items-center gap-2 flex-shrink-0 h-full self-start mt-1 order-1"},Eo={class:"flex flex-col gap-1.5 min-w-0 order-3 w-full md:w-auto md:flex-1 md:order-none mt-2 md:mt-0"},$o={class:"flex items-start gap-3 w-full"},Ao={class:"flex items-center gap-2 flex-wrap"},Do={class:"flex items-center bg-background/50 rounded-md border border-border/50 p-0.5 mr-2 backdrop-blur-sm hidden sm:flex"},Po={class:"hidden sm:inline"},Mo={class:"flex items-center self-start mt-1 ml-auto md:ml-2 order-2 md:order-none"},Ro={class:"flex-1 overflow-hidden relative group bg-background/20"},jo={key:0,class:"absolute top-6 left-0 right-0 z-40 px-4 flex justify-center pointer-events-none"},Fo={class:"w-full max-w-lg pointer-events-auto"},qo={class:"relative overflow-hidden rounded-xl border border-blue-200 bg-gradient-to-br from-blue-50/95 to-purple-50/95 p-3 shadow-lg backdrop-blur-lg dark:border-blue-800 dark:from-blue-950/90 dark:to-purple-950/90"},Lo={class:"flex items-center gap-3"},Go={class:"relative flex h-8 w-8 items-center justify-center rounded-full bg-gradient-to-br from-blue-500 to-purple-600 shadow-md"},Io={class:"flex-1 min-w-0"},No={class:"flex items-center justify-between mb-1"},zo={class:"text-xs font-mono text-muted-foreground"},Wo={class:"h-1.5 w-full bg-blue-100 dark:bg-blue-900/40 rounded-full overflow-hidden"},Oo={class:"mt-2 text-xs text-muted-foreground ml-11 truncate"},Ho={class:"max-w-[850px] mx-auto py-12 px-6 sm:px-10 min-h-full"},Uo={class:"min-h-[600px] pb-32"},Bo={class:"pb-32"},Qo={class:"h-7 border-t border-border/30 bg-background/40 backdrop-blur-sm flex items-center justify-between px-4 text-[10px] text-muted-foreground shrink-0"},Ko={class:"flex items-center gap-3"},Xo={class:"hidden sm:inline"},Vo={class:"flex items-center gap-2"},Jo={key:0,class:"text-green-500 flex items-center gap-1 ml-2"},Yo={key:0,class:"fixed inset-0 bg-black/50 flex items-center justify-center z-50"},Zo={class:"text-slate-600 dark:text-slate-300 mb-4"},el={class:"font-semibold text-amber-600 dark:text-amber-400"},tl={class:"flex flex-col sm:flex-row gap-3"},rl=1e3,sl=rt({__name:"ChapterEditor",props:{project:{},chapter:{},allChapters:{},facultyChapters:{},mode:{}},setup(c){const n=xt(()=>bt(()=>import("./ChapterNavigation-gfT-8s8o.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21]))),l=xt(()=>bt(()=>import("./MobileNavOverlay-DOIm1HBD.js"),__vite__mapDeps([22,3,4,23,2,1,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,68,69,70,71,72,73,74,75,76,77,78,79,80,81,82,83,84,85,86]))),y=xt(()=>bt(()=>import("./ChatModeLayout-Bnpas01Y.js"),__vite__mapDeps([87,88,3,4,14,2,8,50,26,6,7,27,5,9,25,28,29,30,31,32,33,34,35,36,37,38,39,40,21,12,11,41,42,43,44,45,46,47,16,48,49,89,24,51,52,53,54,10,15,55,56,23,57,58,59,60,61,62,63,64,65,90,85,91,17,92,81,20,80,76,93,18,94,79,95]))),m=xt(()=>bt(()=>import("./CitationVerificationLayout-_B7MRkr1.js"),__vite__mapDeps([96,14,2,3,4,8,50,51,26,6,7,27,5,9,29,24,25,28,30,31,32,33,34,35,36,37,38,39,40,21,12,11,41,42,43,44,45,46,47,16,48,49,52,53,54,10,15,55,56,23,57,58,59,60,61,62,63,64,65,90,18,73]))),r=c,v=f(null),i=f(null),{chapterTitle:T,chapterContent:x,showPreview:q,isEditorDark:A,initChapterTheme:R,toggleChapterTheme:d,isNativeFullscreen:w,showStatistics:C,selectedText:E,showChatMode:I,showCitationMode:$,showDefensePrep:k,loadChatModeFromStorage:N,saveChatModeToStorage:p,showLeftSidebar:o,showRightSidebar:h,isMobile:O,isLeftSidebarCollapsed:X,isRightSidebarCollapsed:Z,showLeftSidebarInFullscreen:B,showRightSidebarInFullscreen:ie}=As(r),{balance:ge,showPurchaseModal:j,requiredWordsForModal:ae,actionDescriptionForModal:ce,checkAndPrompt:_e,closePurchaseModal:H,estimates:J}=Vr(),oe=(g,s)=>_e(Math.max(1,Math.round(g)),s),{hasUnsavedChanges:U,isSaving:ne,triggerAutoSave:ue,save:te,clearAutoSave:Ce}=Pn({delay:1e4,onSave:Wt});let De=0;const be=()=>{const g=Date.now();g-De>rl&&(De=g,S.success("Saved",{duration:2e3}))},{contentHistory:Pe,historyIndex:st,addToHistory:z,undo:gt,redo:ht}=ls(r.chapter.content||""),{writingStats:Ie,writingQualityScore:ke,calculateWritingStats:Qe}=Mn(x),{isAnalyzing:at,latestAnalysis:Ke,getLatestAnalysis:Xe}=jn(r.chapter.id),ve=M(()=>{if(r.facultyChapters&&r.facultyChapters.length>0){const s=r.facultyChapters.find(F=>F.number===r.chapter.chapter_number);if(s?.word_count)return s.word_count}if(r.project?.outlines&&r.project.outlines.length>0){const s=r.project.outlines.find(F=>F.chapter_number===r.chapter.chapter_number);if(s?.target_word_count)return s.target_word_count}const g=r.project.type==="undergraduate"?2500:3500;return r.chapter.chapter_number===1||r.chapter.chapter_number===5?Math.round(g*.8):g}),{generateNextChapter:nt}=js({props:r,allChapters:r.allChapters,targetWordCount:ve,estimates:J,ensureBalance:oe,save:te}),{currentWordCount:pe,progressPercentage:ot,DEFENSE_THRESHOLD:lt,countWords:ft}=Rn(x,ve),Ne=ot,At=M(()=>({chapter:r.chapter,chapterTitle:T,chapterContent:x,showPresentationMode:qe,togglePresentationMode:Bt,isStreamingMode:qt,isGenerating:me,generationProgress:Re,generationPercentage:je,generationPhase:ze,aiChapterAnalysis,nextSection,getSectionInfo,writingStats:Ie,latestAnalysis:Ke,isAnalyzing:at,writingQualityScore:ke,isSaving:ne,isValid:mt,save:te,goToBulkAnalysis:Qt,markAsComplete:Vt,richTextEditor:v,richTextEditorFullscreen:i,selectedText:E,setSelectedText:g=>{E.value=g}})),Dt=M(()=>({chapter_number:zt.value.chapter_number,chapter_title:zt.value.title,word_count:pe.value})),Pt=M(()=>({meetsThreshold:Me.value,shouldShowProgress:Se.value,progressPercentage:Te.value,wordsRemaining:fe.value,hasTriggeredGeneration:Ve,threshold:lt,statusMessage:V()})),St=M(()=>({project:Le.value,chapter:Ge.value,isGenerating:me.value,selectedText:E.value,isLoadingSuggestions:Ft.value,showCitationHelper:vt.value,chapterContent:x.value,currentWordCount:pe.value,targetWordCount:ve.value,handleAIGeneration:Gt,getAISuggestions:It,updateCitationHelper:g=>{vt.value=g},insertCitation:$r,checkCitations:Nt,showDefensePrep:k.value,defenseQuestions:Mt.value??[],isLoadingDefenseQuestions:Rt.value,isGeneratingDefenseQuestions:jt.value,chapterContext:Dt.value,defenseWatcher:Pt.value,autoGenerateDefense:P.value,handleDefensePanelToggle:Gr,generateNewDefenseQuestions:W,handleDefenseAutoToggle:he,refreshDefenseQuestions:()=>Q(!0,{skipGeneration:!0}),markQuestionHelpful:se,hideQuestion:re})),{defenseQuestions:Mt,isLoadingDefenseQuestions:Rt,isGeneratingDefenseQuestions:jt,autoGenerateDefense:P,shouldLoadDefenseQuestions:b,loadDefenseQuestions:Q,generateNewDefenseQuestions:W,markQuestionHelpful:se,hideQuestion:re,handleDefenseAutoToggle:he,getDefenseStatusMessage:V,shouldShowDefenseProgress:Se,defenseProgressPercentage:Te,defenseWordsRemaining:fe,hasTriggeredGeneration:Ve,meetsDefenseThreshold:Me}=qs({props:r,chapterContent:x,currentWordCount:pe,ensureBalance:oe,estimates:J}),{isGenerating:me,generationProgress:Re,generationPercentage:je,generationPhase:ze,estimatedTotalWords:Cr,streamWordCount:kr,isLoadingSuggestions:Ft,showCitationHelper:vt,showPresentationMode:qe,isStreamingMode:qt,showRecoveryDialog:Sr,savedWordCountOnError:Tr,eventSource:Lt,editorScrollRef:Er,handleAIGeneration:Gt,getAISuggestions:It,checkCitations:Nt,insertCitation:$r,resumeGeneration:Ar,dismissRecovery:Dr,checkForAutoGeneration:Pr}=Rs({props:r,chapterContent:x,targetWordCount:ve,estimates:J,ensureBalance:oe,save:te,triggerAutoSave:ue,calculateWritingStats:Qe,countWords:ft,selectedText:E,richTextEditor:v,richTextEditorFullscreen:i,isNativeFullscreen:w}),mt=M(()=>{const g=T.value?.trim(),s=x.value?.trim();return g&&g.length>0&&s&&s.length>50}),Le=M(()=>r.project),Ge=M(()=>r.chapter),We=M(()=>r.allChapters),zt=M(()=>r.chapter);async function Wt(g=!1){try{const s=await fetch(le("chapters.save",{project:r.project.id}),{method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json","X-Requested-With":"XMLHttpRequest","X-CSRF-TOKEN":document.querySelector('meta[name="csrf-token"]')?.getAttribute("content")||""},body:JSON.stringify({project_id:r.project.id,chapter_number:r.chapter.chapter_number,title:T.value,content:x.value,auto_save:g,statistics:Ie.value,quality_score:ke.value})});console.log("Response status:",s.status,s.statusText),console.log("Response headers:",s.headers);const F=await s.text();console.log("Raw response:",F);let xe;try{xe=JSON.parse(F)}catch(Fe){throw console.error("JSON parse error:",Fe),console.error("Response was:",F),new Error(`Server returned non-JSON response: ${s.status} ${s.statusText}`)}s.ok}catch(s){throw g||S.error("‚ùå Save Failed",{description:"Please try again or check your connection."}),s}}const Ot=()=>{const g=gt();g!==null&&(x.value=g,ue())},Ht=()=>{const g=ht();g!==null&&(x.value=g,ue())},it=g=>{U.value&&confirm("You have unsaved changes. Save before switching chapters?")&&te();const s=r.allChapters.find(Fe=>Fe.chapter_number===g),xe=s?.content&&s.content.trim()!==""?"chapters.edit":"chapters.write";Oe.visit(le(xe,{project:r.project.slug,chapter:g}),{only:["chapter","mode","allChapters"],preserveState:!0,preserveScroll:!1})},Mr=async()=>{try{const g=document.documentElement;g.requestFullscreen?await g.requestFullscreen():g.webkitRequestFullscreen?await g.webkitRequestFullscreen():g.msRequestFullscreen&&await g.msRequestFullscreen()}catch(g){console.error("Error entering fullscreen:",g),S.error("Fullscreen Error",{description:"Unable to enter fullscreen mode"})}},Rr=async()=>{try{document.exitFullscreen?await document.exitFullscreen():document.webkitExitFullscreen?await document.webkitExitFullscreen():document.msExitFullscreen&&await document.msExitFullscreen()}catch(g){console.error("Error exiting fullscreen:",g),S.error("Fullscreen Error",{description:"Unable to exit fullscreen mode"})}},Ut=async()=>{w.value?await Rr():await Mr()},Je=()=>{const g=document.fullscreenElement||document.webkitFullscreenElement||document.msFullscreenElement;w.value=!!g},jr=()=>{I.value=!I.value,I.value&&($.value=!1),p(I.value)},Fr=()=>{I.value=!1,p(!1)},qr=()=>{$.value=!1},Bt=()=>{qe.value=!qe.value},Qt=()=>{Oe.visit(le("projects.analysis",{project:r.project.slug}))},Lr=()=>{z(x.value),ue(),Qe()},Kt=g=>{(g.ctrlKey||g.metaKey)&&g.key==="s"&&(g.preventDefault(),te(),be()),(g.ctrlKey||g.metaKey)&&!g.shiftKey&&g.key==="z"&&(g.preventDefault(),Ot()),(g.ctrlKey||g.metaKey)&&g.shiftKey&&g.key==="z"&&(g.preventDefault(),Ht()),g.key==="F11"&&(g.preventDefault(),Ut())};pt(()=>{const g=()=>{O.value=window.innerWidth<1024};g(),window.addEventListener("resize",g),I.value=N(),document.addEventListener("keydown",Xt),document.addEventListener("keydown",Kt),document.addEventListener("fullscreenchange",Je),document.addEventListener("webkitfullscreenchange",Je),document.addEventListener("msfullscreenchange",Je),Qe(),Pr(),R()});const Xt=g=>{if((g.ctrlKey||g.metaKey)&&!["INPUT","TEXTAREA","SELECT"].includes(g.target?.tagName))switch(g.key){case"ArrowLeft":g.preventDefault();const s=r.chapter.chapter_number-1;r.allChapters.find(ct=>ct.chapter_number===s)&&it(s);break;case"ArrowRight":g.preventDefault();const xe=r.chapter.chapter_number+1;r.allChapters.find(ct=>ct.chapter_number===xe)&&it(xe);break}};pt(()=>{const g=s=>{const F=xe=>{const{scrollTop:Fe,scrollHeight:ct,clientHeight:Ir}=s,Jt=xe.deltaY,Nr=Fe<=0,zr=Fe+Ir>=ct;Jt<0&&Nr||Jt>0&&zr||xe.stopPropagation()};return s.addEventListener("wheel",F,{passive:!0}),()=>s.removeEventListener("wheel",F)};yt(()=>{const s=document.querySelectorAll('[class*="overflow-y-auto"]'),F=[];s.forEach(xe=>{if(xe instanceof HTMLElement){const Fe=g(xe);F.push(Fe)}}),window.__scrollChainCleanup=F})}),vr(()=>{Ce(),Lt.value&&Lt.value.close(),document.removeEventListener("keydown",Kt),document.removeEventListener("keydown",Xt);const g=window.__scrollChainCleanup;g&&Array.isArray(g)&&(g.forEach(s=>s()),delete window.__scrollChainCleanup),document.removeEventListener("fullscreenchange",Je),document.removeEventListener("webkitfullscreenchange",Je),document.removeEventListener("msfullscreenchange",Je)}),we(()=>r.chapter,async g=>{T.value=g.title||"",x.value=g.content||""},{immediate:!1});const Gr=async g=>{k.value=g,g&&b()&&await Q(!1,{skipGeneration:!0})};we(x,Lr),we(T,ue);const Vt=async()=>{console.log("üîµ [MARK COMPLETE] Function called"),console.log("üîµ [MARK COMPLETE] Current word count:",pe.value);try{console.log("üîµ [MARK COMPLETE] Saving chapter..."),await te(!1),console.log("‚úÖ [MARK COMPLETE] Chapter saved");const g=le("chapters.mark-complete",{project:r.project.slug,chapter:r.chapter.chapter_number});console.log("üîµ [MARK COMPLETE] Posting to:",g),Oe.post(g,{},{onSuccess:()=>{console.log("‚úÖ [MARK COMPLETE] Request successful")},onError:s=>{console.error("‚ùå [MARK COMPLETE] Request failed:",s)}})}catch(g){console.error("‚ùå [MARK COMPLETE] Error:",g),S.error("Failed to save chapter before marking complete")}};return pt(async()=>{await Xe()}),(g,s)=>(_(),Y(e(Yr),null,{default:u(()=>[e(I)?(_(),Y(e(y),{key:0,project:Le.value,chapter:Ge.value,class:de({dark:e(A)}),"chapter-title":e(T),"chapter-content":e(x),"current-word-count":e(pe),"target-word-count":ve.value,"progress-percentage":e(Ne),"writing-quality-score":e(ke),"is-valid":mt.value,"is-saving":e(ne),"show-preview":e(q),"is-generating":e(me),"generation-progress":e(Re),"history-index":e(st),"content-history-length":e(Pe).length,"selected-text":e(E),"onUpdate:chapterTitle":s[0]||(s[0]=F=>T.value=F),"onUpdate:chapterContent":s[1]||(s[1]=F=>x.value=F),"onUpdate:selectedText":s[2]||(s[2]=F=>E.value=F),"onUpdate:showPreview":s[3]||(s[3]=F=>q.value=F),onSave:s[4]||(s[4]=F=>Wt(F)),onUndo:Ot,onRedo:Ht,onExitChatMode:Fr},null,8,["project","chapter","class","chapter-title","chapter-content","current-word-count","target-word-count","progress-percentage","writing-quality-score","is-valid","is-saving","show-preview","is-generating","generation-progress","history-index","content-history-length","selected-text"])):e($)?(_(),Y(e(m),{key:1,project:Le.value,chapter:Ge.value,class:de({dark:e(A)}),"chapter-title":e(T),"chapter-content":e(x),"current-word-count":e(pe),"target-word-count":ve.value,"progress-percentage":e(Ne),onExitCitationMode:qr},null,8,["project","chapter","class","chapter-title","chapter-content","current-word-count","target-word-count","progress-percentage"])):e(w)?(_(),L("div",{key:2,class:de(["flex h-screen flex-col overflow-hidden bg-background dark:bg-background font-sans selection:bg-primary/20 transition-colors duration-300",{dark:e(A)}])},[s[38]||(s[38]=t("div",{class:"absolute inset-0 z-0 overflow-hidden pointer-events-none"},[t("div",{class:"absolute top-[-20%] left-[-10%] w-[50%] h-[50%] rounded-full bg-blue-500/5 blur-[120px]"}),t("div",{class:"absolute bottom-[-20%] right-[-10%] w-[50%] h-[50%] rounded-full bg-purple-500/5 blur-[120px]"})],-1)),t("div",Fn,[t("div",qn,[a(e(Ae),null,{default:u(()=>[a(e(Ee),{asChild:""},{default:u(()=>[a(e(K),{onClick:s[5]||(s[5]=F=>e(Oe).visit(e(le)("projects.show",r.project.slug))),variant:"ghost",size:"icon",class:"h-10 w-10 rounded-full hover:bg-primary/10 hover:text-primary transition-all duration-300"},{default:u(()=>[a(e(ir),{class:"h-5 w-5"})]),_:1})]),_:1}),a(e($e),null,{default:u(()=>[...s[23]||(s[23]=[t("p",null,"Back to Project",-1)])]),_:1})]),_:1}),t("div",Ln,[a(er,{as:"h1",class:"text-lg font-bold tracking-tight text-foreground/90 font-display",content:r.project.title},null,8,["content"]),t("div",Gn,[a(e(Ue),{variant:"outline",class:"h-5 px-2 rounded-full border-primary/20 bg-primary/5 text-primary font-medium"},{default:u(()=>[G(" Chapter "+D(r.chapter.chapter_number),1)]),_:1}),t("span",In,[s[24]||(s[24]=t("span",{class:"h-1.5 w-1.5 rounded-full bg-green-500 animate-pulse"},null,-1)),G(" "+D(e(pe))+" words ",1)])])])]),t("div",Nn,[t("div",zn,[a(e(K),{onClick:s[6]||(s[6]=F=>B.value=!e(B)),variant:e(B)?"secondary":"ghost",size:"sm",class:de(["h-8 px-4 rounded-full text-xs font-medium transition-all duration-300",e(B)?"bg-primary/10 text-primary hover:bg-primary/15":"hover:bg-muted"])},{default:u(()=>[a(e(cr),{class:"mr-2 h-3.5 w-3.5"}),s[25]||(s[25]=G(" Outline ",-1))]),_:1},8,["variant","class"]),s[27]||(s[27]=t("div",{class:"w-px h-4 bg-border/50 mx-1"},null,-1)),a(e(K),{onClick:s[7]||(s[7]=F=>ie.value=!e(ie)),variant:e(ie)?"secondary":"ghost",size:"sm",class:de(["h-8 px-4 rounded-full text-xs font-medium transition-all duration-300",e(ie)?"bg-primary/10 text-primary hover:bg-primary/15":"hover:bg-muted"])},{default:u(()=>[a(e(et),{class:"mr-2 h-3.5 w-3.5"}),s[26]||(s[26]=G(" Assistant ",-1))]),_:1},8,["variant","class"])]),t("div",Wn,[a(e(Ae),null,{default:u(()=>[a(e(Ee),{asChild:""},{default:u(()=>[a(e(K),{onClick:s[8]||(s[8]=F=>C.value=!e(C)),variant:e(C)?"secondary":"ghost",size:"icon",class:"h-9 w-9 rounded-full transition-all hover:bg-muted"},{default:u(()=>[a(e(ur),{class:"h-4.5 w-4.5 text-muted-foreground"})]),_:1},8,["variant"])]),_:1}),a(e($e),null,{default:u(()=>[t("p",null,D(e(C)?"Hide":"Show")+" Statistics",1)]),_:1})]),_:1}),a(e(Ae),null,{default:u(()=>[a(e(Ee),{asChild:""},{default:u(()=>[a(e(K),{onClick:e(d),variant:e(A)?"secondary":"ghost",size:"icon",class:"h-9 w-9 rounded-full transition-all hover:bg-muted"},{default:u(()=>[e(A)?(_(),Y(e(dr),{key:0,class:"h-4.5 w-4.5 text-foreground"})):(_(),Y(e(pr),{key:1,class:"h-4.5 w-4.5 text-muted-foreground"}))]),_:1},8,["onClick","variant"])]),_:1}),a(e($e),null,{default:u(()=>[...s[28]||(s[28]=[t("p",null,"Toggle Dark Mode",-1)])]),_:1})]),_:1}),a(rr,{project:Le.value,"current-chapter":Ge.value,"all-chapters":We.value,size:"icon",variant:"ghost",class:"h-9 w-9 rounded-full hover:bg-muted"},null,8,["project","current-chapter","all-chapters"])])])]),t("div",On,[t("div",{class:"absolute top-0 left-0 h-full bg-gradient-to-r from-blue-500 via-purple-500 to-pink-500 transition-all duration-700 ease-out shadow-[0_0_10px_rgba(59,130,246,0.5)]",style:ut({width:`${Math.min(e(Ne),100)}%`})},null,4)]),e(me)?(_(),L("div",Hn,[t("div",Un,[s[34]||(s[34]=t("div",{class:"absolute inset-0 -skew-x-12 animate-pulse bg-gradient-to-r from-transparent via-white/10 to-transparent"},null,-1)),t("div",Bn,[t("div",Qn,[t("div",Kn,[t("div",Xn,[a(e(et),{class:"h-3 w-3 text-white"})]),s[29]||(s[29]=t("div",{class:"absolute inset-0 h-6 w-6 animate-ping rounded-full bg-gradient-to-br from-blue-500 to-purple-600 opacity-20"},null,-1))]),t("div",null,[s[30]||(s[30]=t("h4",{class:"text-xs font-semibold text-blue-900 dark:text-blue-100"},"AI Generator",-1)),t("p",Vn,D(e(ze)),1)])]),a(e(Ue),{variant:"outline",class:"border-blue-300 text-xs text-blue-700 dark:border-blue-700 dark:text-blue-300"},{default:u(()=>[G(D(Math.round(e(je)))+"% ",1)]),_:1})]),t("div",Jn,[t("div",Yn,[s[31]||(s[31]=t("span",{class:"text-xs text-blue-800 dark:text-blue-200"},"Generation Progress",-1)),t("span",Zn,D(e(kr))+" / "+D(e(Cr))+" words",1)]),t("div",eo,[t("div",{class:"absolute top-0 left-0 h-full rounded-full bg-gradient-to-r from-blue-500 to-purple-500 transition-all duration-500 ease-out",style:ut({width:`${e(je)}%`})},[...s[32]||(s[32]=[t("div",{class:"absolute inset-0 animate-pulse bg-gradient-to-r from-transparent via-white/30 to-transparent"},null,-1)])],4),t("div",{class:"absolute top-0 left-0 h-full rounded-full bg-gradient-to-r from-blue-400 to-purple-400 opacity-50 blur-sm transition-all duration-500",style:ut({width:`${e(je)}%`})},null,4)])]),t("div",to,[t("div",ro,[e(ze)==="Initializing"?(_(),L("div",so)):e(ze)==="Connecting"?(_(),L("div",ao,[...s[33]||(s[33]=[t("div",{class:"h-2 w-0.5 animate-pulse rounded-full bg-blue-500"},null,-1),t("div",{class:"h-2 w-0.5 animate-pulse rounded-full bg-purple-500",style:{"animation-delay":"0.2s"}},null,-1),t("div",{class:"h-2 w-0.5 animate-pulse rounded-full bg-blue-500",style:{"animation-delay":"0.4s"}},null,-1)])])):e(ze)==="Generating"?(_(),L("div",no)):e(ze)==="Complete"?(_(),L("div",oo)):(_(),L("div",lo))]),t("p",io,D(e(Re)),1)])])])):ee("",!0),e(C)?(_(),Y(fr,{key:1,"show-statistics":e(C),"current-word-count":e(pe),"writing-stats":e(Ie),"quality-analysis":e(Ke),"is-analyzing":e(at),class:"relative z-20 mx-4 mt-2 rounded-lg border border-border/40 bg-background/60 backdrop-blur-md"},null,8,["show-statistics","current-word-count","writing-stats","quality-analysis","is-analyzing"])):ee("",!0),t("div",co,[a(He,{"enter-active-class":"transition-all duration-300 ease-in-out","enter-from-class":"-ml-72 opacity-0","enter-to-class":"ml-0 opacity-100","leave-active-class":"transition-all duration-300 ease-in-out","leave-from-class":"ml-0 opacity-100","leave-to-class":"-ml-72 opacity-0"},{default:u(()=>[e(B)?(_(),L("div",uo,[t("div",po,[t("div",go,[t("div",ho,[s[35]||(s[35]=t("h2",{class:"text-sm font-semibold text-foreground mb-1"},"Table of Contents",-1)),t("p",fo,D(We.value.length)+" Chapters ",1)]),(_(),Y(Qr,null,{fallback:u(()=>[...s[36]||(s[36]=[t("div",{class:"flex items-center justify-center p-8"},[t("div",{class:"h-6 w-6 animate-spin rounded-full border-2 border-primary border-t-transparent"})],-1)])]),default:u(()=>[a(e(n),{"all-chapters":We.value,"current-chapter":Ge.value,project:Le.value,outlines:g.project.outlines||[],"faculty-chapters":g.facultyChapters||[],"current-word-count":e(pe),"target-word-count":ve.value,"writing-quality-score":e(ke),"chapter-content-length":e(x).length,onGoToChapter:it,onGenerateNextChapter:e(nt)},null,8,["all-chapters","current-chapter","project","outlines","faculty-chapters","current-word-count","target-word-count","writing-quality-score","chapter-content-length","onGenerateNextChapter"])]),_:1}))])])])):ee("",!0)]),_:1}),t("div",vo,[t("div",mo,[t("div",xo,[a(Ys,{context:At.value},null,8,["context"]),s[37]||(s[37]=t("div",{class:"h-12"},null,-1))])])]),a(He,{"enter-active-class":"transition-all duration-300 ease-in-out","enter-from-class":"-mr-72 opacity-0","enter-to-class":"mr-0 opacity-100","leave-active-class":"transition-all duration-300 ease-in-out","leave-from-class":"mr-0 opacity-100","leave-to-class":"-mr-72 opacity-0"},{default:u(()=>[e(ie)?(_(),Y(hr,Yt({key:0,"container-class":"w-72 flex-shrink-0 border-l border-border/40 bg-background/40 backdrop-blur-md"},St.value),null,16)):ee("",!0)]),_:1})])],2)):(_(),Y(Jr,{key:3,class:de(["h-screen overflow-hidden bg-background dark:bg-background transition-colors duration-300",{dark:e(A)}])},{default:u(()=>[t("div",bo,[s[64]||(s[64]=t("div",{class:"absolute inset-0 z-0 overflow-hidden pointer-events-none"},[t("div",{class:"absolute top-[-10%] left-[-10%] w-[40%] h-[40%] rounded-full bg-blue-500/5 blur-[100px]"}),t("div",{class:"absolute bottom-[-10%] right-[-10%] w-[40%] h-[40%] rounded-full bg-purple-500/5 blur-[100px]"})],-1)),Be(t("aside",yo,[t("div",wo,[s[39]||(s[39]=t("span",{class:"text-sm font-semibold tracking-tight text-foreground"},"Navigation",-1)),a(e(Ue),{variant:"outline",class:"text-[10px] h-5 px-1.5"},{default:u(()=>[G(D(We.value.length)+" Chapters ",1)]),_:1})]),a(e(Zt),{class:"flex-1"},{default:u(()=>[t("div",_o,[a(e(n),{"all-chapters":We.value,"current-chapter":Ge.value,project:Le.value,outlines:g.project.outlines||[],"faculty-chapters":g.facultyChapters||[],"current-word-count":e(pe),"target-word-count":ve.value,"writing-quality-score":e(ke),"chapter-content-length":e(x).length,onGoToChapter:it,onGenerateNextChapter:e(nt)},null,8,["all-chapters","current-chapter","project","outlines","faculty-chapters","current-word-count","target-word-count","writing-quality-score","chapter-content-length","onGenerateNextChapter"])])]),_:1})],512),[[tt,!e(X)]]),t("main",Co,[t("header",ko,[t("div",So,[t("div",To,[a(e(Ae),null,{default:u(()=>[a(e(Ee),{asChild:""},{default:u(()=>[a(e(K),{variant:"ghost",size:"icon",class:"h-8 w-8 text-zinc-700 dark:text-zinc-300 hover:text-foreground",onClick:s[9]||(s[9]=F=>e(Oe).visit(e(le)("projects.writing",r.project.slug)))},{default:u(()=>[a(e(ir),{class:"w-4 h-4"})]),_:1})]),_:1}),a(e($e),null,{default:u(()=>[...s[40]||(s[40]=[G("Back to Writing",-1)])]),_:1})]),_:1}),s[41]||(s[41]=t("div",{class:"h-8 w-px bg-border/50 mx-1"},null,-1)),a(e(K),{variant:"ghost",size:"icon",onClick:s[10]||(s[10]=F=>X.value=!e(X)),class:"hidden lg:flex text-muted-foreground hover:text-foreground -ml-2 h-8 w-8"},{default:u(()=>[e(X)?(_(),Y(e(ws),{key:1,class:"h-4 w-4"})):(_(),Y(e(ys),{key:0,class:"h-4 w-4"}))]),_:1}),a(e(K),{variant:"ghost",size:"icon",onClick:s[11]||(s[11]=F=>o.value=!0),class:"lg:hidden text-muted-foreground hover:text-foreground -ml-2 h-8 w-8"},{default:u(()=>[a(e(cr),{class:"h-4 w-4"})]),_:1}),s[42]||(s[42]=t("div",{class:"h-8 w-px bg-border/50 hidden lg:block mx-1"},null,-1))]),t("div",Eo,[t("div",$o,[a(er,{as:"h1",class:"text-lg font-bold tracking-tight text-foreground leading-tight cursor-pointer hover:text-primary/80 transition-colors break-words",content:r.project.title,onClick:s[12]||(s[12]=F=>e(Oe).visit(e(le)("projects.show",r.project.slug)))},null,8,["content"]),a(e(Ue),{variant:"secondary",class:"h-5 px-2 text-[10px] font-medium rounded-full bg-secondary/50 border border-border/50 shrink-0 mt-0.5"},{default:u(()=>[G(" Ch "+D(r.chapter.chapter_number),1)]),_:1})]),t("div",Ao,[t("div",Do,[a(e(Ae),null,{default:u(()=>[a(e(Ee),{asChild:""},{default:u(()=>[a(e(K),{onClick:s[13]||(s[13]=F=>C.value=!e(C)),variant:e(C)?"secondary":"ghost",size:"sm",class:"h-7 px-3 text-xs gap-2 text-zinc-700 dark:text-zinc-300 hover:text-foreground"},{default:u(()=>[a(e(ur),{class:"h-3.5 w-3.5"}),s[43]||(s[43]=G(" Stats ",-1))]),_:1},8,["variant"])]),_:1}),a(e($e),null,{default:u(()=>[...s[44]||(s[44]=[G("Toggle Writing Statistics",-1)])]),_:1})]),_:1}),s[50]||(s[50]=t("div",{class:"w-px h-3 bg-border/50 mx-0.5"},null,-1)),a(e(Ae),null,{default:u(()=>[a(e(Ee),{asChild:""},{default:u(()=>[a(e(K),{onClick:Bt,variant:e(qe)?"secondary":"ghost",size:"sm",class:"h-7 px-3 text-xs gap-2 text-zinc-700 dark:text-zinc-300 hover:text-foreground"},{default:u(()=>[e(qe)?(_(),Y(e($s),{key:1,class:"h-3.5 w-3.5"})):(_(),Y(e(br),{key:0,class:"h-3.5 w-3.5"})),G(" "+D(e(qe)?"Edit":"Preview"),1)]),_:1},8,["variant"])]),_:1}),a(e($e),null,{default:u(()=>[...s[45]||(s[45]=[G("Toggle Preview Mode",-1)])]),_:1})]),_:1}),s[51]||(s[51]=t("div",{class:"w-px h-3 bg-border/50 mx-0.5"},null,-1)),a(e(Ae),null,{default:u(()=>[a(e(Ee),{asChild:""},{default:u(()=>[a(e(K),{onClick:jr,variant:"ghost",size:"sm",class:"h-7 px-3 text-xs gap-2 text-muted-foreground hover:text-foreground"},{default:u(()=>[a(e(_s),{class:"h-3.5 w-3.5 text-blue-500"}),s[46]||(s[46]=t("span",{class:"text-foreground"},"AI Chat",-1))]),_:1})]),_:1}),a(e($e),null,{default:u(()=>[...s[47]||(s[47]=[G("Open AI Assistant Overlay",-1)])]),_:1})]),_:1}),s[52]||(s[52]=t("div",{class:"w-px h-3 bg-border/50 mx-0.5"},null,-1)),a(e(Ae),null,{default:u(()=>[a(e(Ee),{asChild:""},{default:u(()=>[a(e(K),{onClick:Ut,variant:"ghost",size:"sm",class:"h-7 px-3 text-xs gap-2 text-zinc-700 dark:text-zinc-300 hover:text-foreground",title:e(w)?"Exit Full Screen":"Enter Full Screen"},{default:u(()=>[e(w)?(_(),Y(e(is),{key:0,class:"h-3.5 w-3.5"})):(_(),Y(e(cs),{key:1,class:"h-3.5 w-3.5"}))]),_:1},8,["title"])]),_:1}),a(e($e),null,{default:u(()=>[...s[48]||(s[48]=[G("Toggle Full Screen",-1)])]),_:1})]),_:1}),s[53]||(s[53]=t("div",{class:"w-px h-3 bg-border/50 mx-0.5"},null,-1)),a(e(Ae),null,{default:u(()=>[a(e(Ee),{asChild:""},{default:u(()=>[a(e(K),{onClick:e(d),variant:"ghost",size:"sm",class:"h-7 px-3 text-xs gap-2 text-zinc-700 dark:text-zinc-300 hover:text-foreground"},{default:u(()=>[e(A)?(_(),Y(e(dr),{key:0,class:"h-3.5 w-3.5 text-foreground"})):(_(),Y(e(pr),{key:1,class:"h-3.5 w-3.5"})),G(" "+D(e(A)?"Dark":"Light"),1)]),_:1},8,["onClick"])]),_:1}),a(e($e),null,{default:u(()=>[...s[49]||(s[49]=[G("Toggle Dark Mode",-1)])]),_:1})]),_:1})]),a(rr,{project:Le.value,"current-chapter":Ge.value,"all-chapters":We.value,size:e(O)?"icon":"sm",variant:e(O)?"ghost":"outline","trigger-element":e(O)?"icon":"button","button-class":"h-7 w-7 sm:w-auto",class:"h-7 text-zinc-700 dark:text-zinc-300"},null,8,["project","current-chapter","all-chapters","size","variant","trigger-element"]),a(e(K),{variant:"ghost",size:e(O)?"icon":"sm",class:"flex h-7 gap-2 text-zinc-700 dark:text-zinc-300 hover:text-foreground",onClick:Qt,title:"Open bulk analysis"},{default:u(()=>[a(e(Cs),{class:"w-4 h-4"}),s[54]||(s[54]=t("span",{class:"text-xs font-medium hidden md:inline"},"Analyze",-1))]),_:1},8,["size"]),a(e(K),{onClick:s[14]||(s[14]=F=>e(te)(!1)),disabled:e(ne),variant:mt.value?"default":"secondary",size:e(O)?"icon":"sm",class:"h-7 px-3 text-xs shadow-sm gap-2"},{default:u(()=>[a(e(yr),{class:"h-3.5 w-3.5"}),t("span",Po,D(e(ne)?"Saving...":"Save"),1)]),_:1},8,["disabled","variant","size"]),a(e(K),{onClick:Vt,disabled:e(ne),size:e(O)?"icon":"sm",class:"h-7 px-3 text-xs shadow-sm gap-2"},{default:u(()=>[a(e(Et),{class:"h-3.5 w-3.5"}),s[55]||(s[55]=t("span",{class:"hidden sm:inline"},"Mark Complete",-1))]),_:1},8,["disabled","size"])])])]),t("div",Mo,[a(e(K),{variant:"ghost",size:"icon",onClick:s[15]||(s[15]=F=>Z.value=!e(Z)),class:"hidden lg:flex text-muted-foreground hover:text-foreground ml-1 h-8 w-8"},{default:u(()=>[e(Z)?(_(),Y(e(ds),{key:1,class:"h-4 w-4"})):(_(),Y(e(us),{key:0,class:"h-4 w-4"}))]),_:1}),a(e(K),{variant:"ghost",size:"icon",onClick:s[16]||(s[16]=F=>h.value=!0),class:"lg:hidden text-muted-foreground hover:text-foreground ml-1 h-8 w-8"},{default:u(()=>[a(e(et),{class:"h-4 w-4"})]),_:1})])]),t("div",Ro,[a(He,{"enter-active-class":"transition-all duration-300 ease-out","enter-from-class":"opacity-0 -translate-y-4","enter-to-class":"opacity-100 translate-y-0","leave-active-class":"transition-all duration-200 ease-in","leave-from-class":"opacity-100 translate-y-0","leave-to-class":"opacity-0 -translate-y-4"},{default:u(()=>[e(me)?(_(),L("div",jo,[t("div",Fo,[t("div",qo,[t("div",Lo,[t("div",Go,[a(e(et),{class:"h-4 w-4 text-white animate-pulse"})]),t("div",Io,[t("div",No,[s[56]||(s[56]=t("h4",{class:"text-xs font-semibold text-foreground"},"Generating Content...",-1)),t("span",zo,D(Math.round(e(je)))+"%",1)]),t("div",Wo,[t("div",{class:"h-full bg-gradient-to-r from-blue-500 to-purple-500 transition-all duration-300",style:ut({width:`${e(je)}%`})},null,4)])])]),t("p",Oo,D(e(Re)),1)])])])):ee("",!0)]),_:1}),a(e(Zt),{ref_key:"editorScrollRef",ref:Er,class:"h-full w-full"},{default:u(()=>[t("div",Ho,[a(He,{"enter-active-class":"transition-all duration-300 ease-out","enter-from-class":"opacity-0 -translate-y-2","enter-to-class":"opacity-100 translate-y-0","leave-active-class":"transition-all duration-200 ease-in","leave-from-class":"opacity-100 translate-y-0","leave-to-class":"opacity-0 -translate-y-2"},{default:u(()=>[e(C)?(_(),Y(fr,{key:0,"show-statistics":!0,"current-word-count":e(pe),"writing-stats":e(Ie),"quality-analysis":e(Ke),"is-analyzing":e(at),class:"mb-8"},null,8,["current-word-count","writing-stats","quality-analysis","is-analyzing"])):ee("",!0)]),_:1}),Be(t("div",Uo,[a(mr,{ref_key:"richTextEditorFullscreen",ref:i,modelValue:e(x),"onUpdate:modelValue":s[17]||(s[17]=F=>Kr(x)?x.value=F:null),placeholder:"Start writing your chapter...",class:"prose prose-slate dark:prose-invert prose-lg max-w-none focus:outline-none min-h-[500px]","streaming-mode":e(qt),"is-generating":e(me),"generation-progress":e(Re),"generation-percentage":e(je),"generation-phase":e(ze),"onUpdate:selectedText":s[18]||(s[18]=F=>E.value=F),"min-height":"500px"},null,8,["modelValue","streaming-mode","is-generating","generation-progress","generation-percentage","generation-phase"])],512),[[tt,!e(qe)]]),Be(t("div",Bo,[a(xr,{content:e(x),class:"prose prose-slate dark:prose-invert prose-lg max-w-none"},null,8,["content"])],512),[[tt,e(qe)]])])]),_:1},512)]),t("div",Qo,[t("div",Ko,[t("span",null,"Words: "+D(e(pe))+" / "+D(ve.value),1),t("span",Xo,"Last saved: "+D(e(ne)?"Saving...":"Just now"),1)]),t("div",Vo,[t("span",null,[s[57]||(s[57]=G("Quality: ",-1)),t("span",{class:de(e(ke)>70?"text-green-500":"text-amber-500")},D(e(ke))+"%",3)]),mt.value?(_(),L("span",Jo,[a(e(Et),{class:"h-3 w-3"}),s[58]||(s[58]=G(" Ready ",-1))])):ee("",!0)])])]),a(hr,Yt({"is-collapsed":e(Z),"container-class":"hidden lg:flex w-96 flex-col border-l border-border/40 bg-background/60 backdrop-blur-xl z-20 transition-all duration-300"},St.value),null,16,["is-collapsed"]),a(e(l),{"show-left-sidebar":e(o),"show-right-sidebar":e(h),"is-mobile":e(O),"all-chapters":We.value,"current-chapter":Ge.value,project:Le.value,"current-word-count":e(pe),"target-word-count":ve.value,"writing-quality-score":e(ke),"chapter-content-length":e(x).length,"is-generating":e(me),"selected-text":e(E),"is-loading-suggestions":e(Ft),"show-citation-helper":e(vt),"chapter-content":e(x),"onUpdate:showLeftSidebar":s[19]||(s[19]=F=>o.value=F),"onUpdate:showRightSidebar":s[20]||(s[20]=F=>h.value=F),onGoToChapter:it,onGenerateNextChapter:e(nt),onStartStreamingGeneration:e(Gt),onGetAiSuggestions:e(It),"onUpdate:showCitationHelper":s[21]||(s[21]=F=>vt.value=F),onCheckCitations:e(Nt)},null,8,["show-left-sidebar","show-right-sidebar","is-mobile","all-chapters","current-chapter","project","current-word-count","target-word-count","writing-quality-score","chapter-content-length","is-generating","selected-text","is-loading-suggestions","show-citation-helper","chapter-content","onGenerateNextChapter","onStartStreamingGeneration","onGetAiSuggestions","onCheckCitations"]),a(Zr,{open:e(j),"current-balance":e(ge),"required-words":e(ae),action:e(ce),"onUpdate:open":s[22]||(s[22]=F=>j.value=F),onClose:e(H)},null,8,["open","current-balance","required-words","action","onClose"]),e(Sr)?(_(),L("div",Yo,[a(e(_t),{class:"w-full max-w-md mx-4 bg-white dark:bg-slate-900 border-amber-500/50 shadow-2xl"},{default:u(()=>[a(e(kt),null,{default:u(()=>[a(e($t),{class:"flex items-center gap-2 text-amber-600 dark:text-amber-400"},{default:u(()=>[...s[59]||(s[59]=[t("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"})],-1),G(" Generation Interrupted ",-1)])]),_:1})]),_:1}),a(e(Ct),null,{default:u(()=>[t("p",Zo,[s[60]||(s[60]=G(" Connection lost. ",-1)),t("span",el,D(e(Tr))+" words",1),s[61]||(s[61]=G(" may have been saved. ",-1))]),t("div",tl,[a(e(K),{onClick:e(Ar),class:"flex-1 bg-amber-600 hover:bg-amber-700 text-white"},{default:u(()=>[...s[62]||(s[62]=[t("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-4 w-4 mr-2",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"})],-1),G(" Reload & Recover ",-1)])]),_:1},8,["onClick"]),a(e(K),{onClick:e(Dr),variant:"outline",class:"flex-1"},{default:u(()=>[...s[63]||(s[63]=[G(" Dismiss ",-1)])]),_:1},8,["onClick"])])]),_:1})]),_:1})])):ee("",!0)])]),_:1},8,["class"]))]),_:1}))}}),al=_r(sl,[["__scopeId","data-v-c33fc959"]]),Ul=Object.freeze(Object.defineProperty({__proto__:null,default:al},Symbol.toStringTag,{value:"Module"}));export{ka as A,Ul as C,on as _};
