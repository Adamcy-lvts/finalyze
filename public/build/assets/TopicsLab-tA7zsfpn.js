import{d as Ke,r as v,Q as He,R as Ue,q as be,y as ye,c,o as d,e as r,w as l,b as s,a as y,n as w,g as F,aA as he,u as o,Y as J,bR as ae,t as k,br as xe,h as m,F as W,f as Y,aD as Xe,a7 as q,O as Ge,a_ as Z,P as Ye,aP as Ze,aa as Qe,aq as et,bo as _e,by as tt,b9 as we,bq as st,be as ke,bX as ot,bY as Ce,bg as Se,aZ as rt,bZ as nt,b_ as it,_ as S,aI as p}from"./vendor-Bi-OfESq.js";import{_ as at}from"./AppLayout.vue_vue_type_script_setup_true_lang-C9tHO2FJ.js";import{_ as h}from"./index-Bt90G_JS.js";import{_ as lt}from"./Input.vue_vue_type_script_setup_true_lang-DQnvOcR-.js";import{_ as Te}from"./index-Isya7Tix.js";import{_ as $e}from"./Textarea.vue_vue_type_script_setup_true_lang-B1KXkKg2.js";import{_ as dt}from"./ScrollArea.vue_vue_type_script_setup_true_lang-urQ3TKNg.js";import{_ as ct,a as ut}from"./DialogContent.vue_vue_type_script_setup_true_lang-BgoeTIye.js";import{_ as pt}from"./DialogDescription.vue_vue_type_script_setup_true_lang-oSz0MzUo.js";import{_ as ft}from"./DialogFooter.vue_vue_type_script_setup_true_lang-W_UkA0Wa.js";import{_ as mt,a as vt}from"./DialogTitle.vue_vue_type_script_setup_true_lang-BzYxERPb.js";import{a as gt,b as bt,c as yt,d as ht,e as xt,f as _t,g as wt,_ as kt}from"./AlertDialogTitle.vue_vue_type_script_setup_true_lang-MTAubbHS.js";import{_ as Ct,a as St,b as Tt}from"./TooltipTrigger.vue_vue_type_script_setup_true_lang-DDlQqk4-.js";import{_ as $t}from"./WordBalanceDisplay.vue_vue_type_script_setup_true_lang-Bffg505Y.js";import{_ as le}from"./SafeHtmlText.vue_vue_type_script_setup_true_lang-BnlncFSx.js";import{s as x}from"./app-BXCYb-rZ.js";import{u as jt}from"./useWordBalance-0vIkLXfD.js";import{_ as It}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./UserInfo.vue_vue_type_script_setup_true_lang-DcY1sPuq.js";import"./Presence-CF0v4nrQ.js";import"./useForwardExpose-RFhk291K.js";import"./index-CAP3Ft32.js";import"./DialogTitle-DkxZZug9.js";import"./DropdownMenuTrigger.vue_vue_type_script_setup_true_lang-BzGYI4X_.js";import"./VisuallyHidden-CHAFMzXk.js";import"./AppLogo.vue_vue_type_script_setup_true_lang-BNV-YijK.js";import"./PWAInstallPrompt.vue_vue_type_script_setup_true_lang-CKHmQqcC.js";import"./useNonce-CZgK5reV.js";import"./CardContent.vue_vue_type_script_setup_true_lang-hI6CIJ8Y.js";import"./purify.es-DxJI3Wx7.js";const Nt={class:"flex h-[calc(100vh-4rem)] min-h-0 overflow-hidden relative bg-background w-full"},Ot={class:"min-w-[20rem] h-full flex flex-col"},Dt={class:"p-4 border-b border-border/50"},Et={class:"flex items-center justify-between mb-4"},Rt={class:"flex items-center gap-2"},Ft={class:"p-1.5 bg-primary/10 rounded-md"},Mt={class:"font-semibold text-foreground tracking-tight"},Pt={class:"flex bg-muted rounded-lg p-1"},Lt={key:0,class:"p-3 space-y-2"},zt={key:0,class:"text-center py-10 text-muted-foreground text-sm flex flex-col items-center"},Vt=["onClick"],At={class:"flex items-center gap-2"},Jt={key:0,class:"text-[10px] text-muted-foreground font-medium"},Wt={key:1,class:"p-3 space-y-2"},qt={key:0,class:"text-center py-10 text-muted-foreground text-sm flex flex-col items-center"},Bt=["onClick"],Kt=["onKeydown"],Ht=["onClick"],Ut={key:1,class:"flex flex-col gap-1"},Xt={class:"flex items-start justify-between"},Gt={key:0,class:"flex items-center opacity-0 group-hover:opacity-100 transition-opacity absolute right-2 top-2 bg-card/80 backdrop-blur-sm rounded shadow-sm border border-border/50 p-0.5"},Yt=["onClick"],Zt=["onClick"],Qt={class:"flex items-center justify-between text-[10px] text-muted-foreground"},es={class:"flex items-center gap-1"},ts={class:"p-4 border-t border-border/50 bg-background/50 backdrop-blur-sm mt-auto"},ss={class:"flex-1 flex flex-col min-w-0 bg-background h-full relative z-0"},os={class:"h-16 flex-none border-b border-border/50 flex items-center justify-between px-4 sticky top-0 bg-background/80 backdrop-blur-md z-10 transition-all"},rs={class:"flex items-center gap-3 min-w-0"},ns={class:"flex flex-col min-w-0"},is={class:"flex items-center gap-2"},as={class:"text-[10px] text-muted-foreground truncate hidden sm:block"},ls={class:"flex items-center gap-2"},ds={class:"hidden md:flex flex-col items-end mr-2 cursor-help"},cs={class:"max-w-3xl mx-auto space-y-6 pb-4"},us={key:0,class:"mb-8 animate-in fade-in slide-in-from-top-4 duration-700"},ps={class:"rounded-xl border border-primary/20 bg-gradient-to-br from-primary/5 via-background to-background p-4 md:p-6 shadow-sm relative overflow-hidden group"},fs={class:"absolute top-0 right-0 p-3 opacity-10 group-hover:opacity-20 transition-opacity"},ms={class:"flex items-start gap-4 relative z-10"},vs={class:"p-2 bg-primary/10 rounded-lg text-primary mt-1 shrink-0"},gs={class:"min-w-0 flex-1 space-y-2"},bs={key:0,class:"h-8 w-8 rounded-full bg-primary/10 flex items-center justify-center shrink-0 border border-primary/20 self-start mt-1"},ys={class:"flex flex-col gap-1 max-w-[85%] md:max-w-[80%] min-w-0"},hs={key:0,class:"flex gap-1 items-center h-5 px-1"},xs={key:1,class:"markdown-body"},_s={key:0,class:"mt-4 pt-3 border-t border-border/30"},ws={class:"text-[10px] uppercase tracking-wider text-muted-foreground mb-2 flex items-center gap-1 font-semibold opacity-70"},ks={class:"flex flex-wrap gap-2"},Cs=["onClick"],Ss={class:"truncate"},Ts={key:1,class:"mt-4 pt-3 border-t border-border/30"},$s={class:"text-[10px] uppercase tracking-wider text-muted-foreground mb-2 flex items-center gap-1 font-semibold opacity-70"},js={class:"flex flex-wrap gap-2"},Is=["onClick"],Ns=["disabled"],Os={key:1,class:"h-8 w-8 rounded-full bg-muted flex items-center justify-center shrink-0 border border-border self-start mt-1"},Ds={class:"p-3 md:p-4 border-t border-border/50 bg-background/80 backdrop-blur-md sticky bottom-0 z-20"},Es={class:"max-w-3xl mx-auto relative flex flex-col gap-2"},Rs={class:"relative w-full"},Fs={class:"p-2 bg-primary/10 rounded-lg"},Ms={class:"space-y-4"},Ps={class:"space-y-2"},Ls={class:"space-y-2"},zs=Ke({__name:"TopicsLab",props:{project:{},topics:{},sessionId:{},returnToSelection:{type:Boolean},historySessions:{},initialMessages:{},initialTopic:{}},setup(je){const u=je,g=v(u.initialTopic||(u.topics&&u.topics.length>0?u.topics[0]:null)),a=v(u.initialMessages||[]),I=v(""),T=v(!1),B=v(null),N=v(!1),_=v(!0),{formattedBalance:Ie,hasWords:Ne}=jt(),Q=v(!1),ee=()=>{typeof window>"u"||(N.value=window.innerWidth<1024,N.value=window.innerWidth<1024,window.innerWidth<1024||(_.value=!0))};He(()=>{ee(),window.addEventListener("resize",ee),M()}),Ue(()=>{window.removeEventListener("resize",ee)});const $=v((()=>{if(typeof window<"u"){const n=localStorage.getItem("topicsLab_sidebarMode");if(n==="topics"||n==="history")return n}return"topics"})());be($,n=>{typeof window<"u"&&localStorage.setItem("topicsLab_sidebarMode",n)});const Oe=n=>{S.visit(x("topics.lab",{project:u.project.slug,session_id:n}))},de=()=>{S.visit(x("topics.lab",{project:u.project.slug,new:"true"}))},De=()=>{S.visit(x("projects.topics.index"))},Ee=()=>{S.visit(x("projects.topic-selection",u.project.slug))},Re=n=>{const e=P(n.title||"").trim();S.visit(x("projects.topic-selection",{project:u.project.slug,prefill_topic:e,prefill_title:e.substring(0,100),prefill_description:n.description||""}))},K=v(null),D=v(""),Fe=(n,e)=>{e.stopPropagation(),K.value=n.id,D.value=n.title},H=()=>{K.value=null,D.value=""},ce=async n=>{if(!D.value.trim()){H();return}try{(await fetch(x("topics.chat.rename",u.project.slug),{method:"POST",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":document.querySelector('meta[name="csrf-token"]')?.getAttribute("content")||""},body:JSON.stringify({session_id:n,name:D.value.trim()})})).ok?(p.success("Session renamed!"),S.reload()):p.error("Failed to rename session")}catch{p.error("Failed to rename session")}finally{H()}},te=v(!1),U=v(null),se=v(!1),Me=n=>{U.value=n,se.value=!0},oe=()=>{se.value=!1,U.value=null},Pe=async()=>{if(te.value||!U.value)return;const n=U.value;te.value=!0;try{(await fetch(x("topics.chat.delete-session",u.project.slug),{method:"DELETE",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":document.querySelector('meta[name="csrf-token"]')?.getAttribute("content")||""},body:JSON.stringify({session_id:n})})).ok?(p.success("Conversation deleted"),oe(),n===u.sessionId?de():S.reload()):p.error("Failed to delete conversation")}catch{p.error("Failed to delete conversation")}finally{te.value=!1}},Le=async n=>{try{const e=n.replace(/<[^>]*>/g,"").replace(/&nbsp;/g," ").trim();await navigator.clipboard.writeText(e),p.success("Copied to clipboard")}catch{p.error("Failed to copy")}},X=v(!1),ze=async()=>{if(X.value||!g.value)return;const n=a.value.filter(i=>i.role==="user");if(n.length===0){p.error("No message to regenerate");return}const e=a.value.findIndex(i=>i.id===n[n.length-1].id);e>=0&&e<a.value.length-1&&(a.value=a.value.slice(0,e+1)),X.value=!0;const t=Date.now().toString();a.value.push({id:t,role:"assistant",content:"",isTyping:!0}),M();try{const i=await fetch(x("topics.chat",u.project.slug),{method:"POST",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":document.querySelector('meta[name="csrf-token"]')?.getAttribute("content")||""},body:JSON.stringify({messages:a.value.filter(b=>!b.isTyping).map(b=>({role:b.role,content:b.content})),topic_context:g.value,session_id:u.sessionId})});if(!i.ok)throw new Error(`Server error: ${i.status}`);if(!i.body)throw new Error("No response body");const f=i.body.getReader(),j=new TextDecoder;let R="";for(;;){const{done:b,value:z}=await f.read();if(b)break;const ne=j.decode(z).split(`

`);for(const V of ne)if(V.startsWith("data: "))try{const A=JSON.parse(V.slice(6));if(A.content){R+=A.content;const O=a.value.findIndex(ie=>ie.id===t);O!==-1&&(a.value[O].content=R,a.value[O].isTyping=!1),M()}}catch{}}}catch(i){console.error("Regenerate error:",i),p.error("Failed to regenerate response"),a.value=a.value.filter(f=>f.id!==t)}finally{X.value=!1;const i=a.value.findIndex(f=>f.id===t);i!==-1&&(a.value[i].isTyping=!1)}};let E=null;const Ve=()=>{E&&(E.abort(),E=null,T.value=!1,p.info("Generation stopped"))},M=async()=>{await ye(),B.value&&(B.value.scrollTop=B.value.scrollHeight)},ue=async()=>{if(!I.value.trim()||!g.value||T.value)return;const n={id:Date.now().toString(),role:"user",content:I.value.trim()};a.value.push(n),I.value="",T.value=!0,M();const e=(Date.now()+1).toString();a.value.push({id:e,role:"assistant",content:"",isTyping:!0}),E=new AbortController;try{const t=await fetch(x("topics.chat",u.project.slug),{method:"POST",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":document.querySelector('meta[name="csrf-token"]')?.getAttribute("content")||""},body:JSON.stringify({messages:a.value.filter(b=>!b.isTyping).map(b=>({role:b.role,content:b.content})),topic_context:g.value,session_id:u.sessionId}),signal:E.signal});if(t.status===402){const b=await t.json();p.error(b.message||"Insufficient word balance"),a.value=a.value.filter(z=>z.id!==e),T.value=!1;return}if(!t.ok)throw new Error(`Server error: ${t.status}`);if(!t.body)throw new Error("No response body");const i=t.body.getReader(),f=new TextDecoder;let j="";for(;;){const{done:b,value:z}=await i.read();if(b)break;const ne=f.decode(z).split(`

`);for(const V of ne)if(V.startsWith("data: "))try{const A=JSON.parse(V.slice(6));if(A.content){j+=A.content;const O=a.value.findIndex(ie=>ie.id===e);O!==-1&&(a.value[O].content=j,a.value[O].isTyping=!1),M()}}catch{}}const R=re(j);R&&(me.value=R,ve(R),p.success("Refined topic detected",{description:"The refined topic is ready to select."}))}catch(t){if(t.name==="AbortError"){const i=a.value.findIndex(f=>f.id===e);i!==-1&&(a.value[i].content?a.value[i].isTyping=!1:a.value.splice(i,1))}else console.error("Chat error:",t),p.error("Failed to get response")}finally{T.value=!1,E=null;const t=a.value.findIndex(i=>i.id===e);t!==-1&&(a.value[t].isTyping=!1)}},P=n=>{const e=document.createElement("DIV");return e.innerHTML=n,e.textContent||e.innerText||""};let pe=!0;be(g,n=>{if(n&&!Q.value){if(pe){pe=!1,a.value.length===0&&(a.value=[{id:"system-welcome",role:"assistant",content:`Hi! I see you're interested in **${P(n.title||"")}**. How can I help you refine or understand this topic better?`}]);return}a.value=[{id:"system-welcome-"+Date.now(),role:"assistant",content:`Hi! I see you're interested in **${P(n.title||"")}**. How can I help you refine or understand this topic better?`}]}},{immediate:!0});const L=v(!1),C=v({title:"",description:""}),G=v(!1),fe=n=>{const e=[],t=/"([^"]{20,200})"/g;let i;for(;(i=t.exec(n))!==null;){const f=i[1].trim();!f.toLowerCase().startsWith("how ")&&!f.toLowerCase().startsWith("what ")&&!f.toLowerCase().startsWith("why ")&&f.length>30&&e.push(f)}return e},me=v(null),ve=n=>{Q.value=!0,g.value=n,ye(()=>{Q.value=!1})},re=n=>{if(!n)return null;const e=n.match(/<REFINED_TOPIC_JSON>\s*([\s\S]*?)\s*<\/REFINED_TOPIC_JSON>/i);if(!e)return null;const t=e[1].trim();try{const i=JSON.parse(t),f=typeof i?.title=="string"?i.title.trim():"",j=typeof i?.description=="string"?i.description.trim():"";return f?{id:0,title:f,description:j,difficulty:"Intermediate",resource_level:"Medium",feasibility_score:75}:null}catch{return null}},ge=async(n,e=!1)=>{const t=re(n);if(!t){p.error("No refined topic found in this message");return}me.value=t,ve(t),e&&Re(t)},Ae=n=>{C.value={title:n,description:""},L.value=!0},Je=async()=>{if(!C.value.title.trim()){p.error("Please enter a topic title");return}G.value=!0;try{(await fetch(x("topics.chat.save-topic",u.project.slug),{method:"POST",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":document.querySelector('meta[name="csrf-token"]')?.getAttribute("content")||""},body:JSON.stringify({title:C.value.title.trim(),description:C.value.description.trim(),session_id:u.sessionId})})).ok?(p.success("Topic saved successfully!"),L.value=!1,S.reload()):p.error("Failed to save topic")}catch{p.error("Failed to save topic")}finally{G.value=!1}},We=async()=>{if(!g.value)return;const n=p.loading("Setting topic...");try{const e=P(g.value.title);if((await fetch(x("topics.select",u.project.slug),{method:"POST",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":document.querySelector('meta[name="csrf-token"]')?.getAttribute("content")||""},body:JSON.stringify({topic:e,title:e.substring(0,100),description:g.value.description})})).ok)p.dismiss(n),p.success("Topic selected successfully!"),S.visit(x("projects.topic-approval",u.project.slug));else throw new Error("Failed")}catch{p.dismiss(n),p.error("Failed to select topic")}},qe=n=>{if(!n)return"";n=n.replace(/<REFINED_TOPIC_JSON>[\s\S]*?<\/REFINED_TOPIC_JSON>/gi,"").trim();let e=n.replace(/^### (.*$)/gim,"<strong>$1</strong>").replace(/^## (.*$)/gim,'<strong class="text-lg">$1</strong>').replace(/^# (.*$)/gim,'<strong class="text-xl">$1</strong>');return e=e.replace(/\*\*(.*?)\*\*/g,"<strong>$1</strong>"),e=e.replace(/^\s*-\s+(.*$)/gim,'<li class="ml-4 list-disc">$1</li>'),e=e.replace(/^\s*\d+\.\s+(.*$)/gim,'<li class="ml-4 list-decimal">$1</li>'),e=e.replace(/\n/g,"<br>"),e};return(n,e)=>(d(),c(W,null,[r(at,{title:"Topic Lab"},{default:l(()=>[s("div",Nt,[_.value&&N.value?(d(),c("div",{key:0,class:"absolute inset-0 bg-background/80 backdrop-blur-sm z-30 animate-in fade-in duration-200 lg:hidden",onClick:e[0]||(e[0]=t=>_.value=!1)})):y("",!0),s("aside",{class:w(["flex flex-col border-r border-border/50 bg-muted/10 transition-all duration-300 ease-in-out z-40 h-full","lg:relative absolute inset-y-0 left-0",_.value?"translate-x-0 w-80 shadow-2xl lg:shadow-none":"-translate-x-full lg:translate-x-0 lg:w-0 lg:border-none lg:overflow-hidden"])},[s("div",Ot,[s("div",Dt,[s("div",Et,[s("div",Rt,[s("div",Ft,[(d(),F(he($.value==="topics"?o(J):o(ae)),{class:"h-4 w-4 text-primary"}))]),s("h2",Mt,k($.value==="topics"?"Generated Topics":"History"),1)]),N.value?(d(),F(o(h),{key:0,variant:"ghost",size:"icon",onClick:e[1]||(e[1]=t=>_.value=!1),class:"h-8 w-8 lg:hidden"},{default:l(()=>[r(o(xe),{class:"h-4 w-4"})]),_:1})):y("",!0)]),s("div",Pt,[s("button",{onClick:e[2]||(e[2]=t=>$.value="topics"),class:w(["flex-1 flex items-center justify-center gap-2 text-xs font-medium py-1.5 rounded-md transition-all",$.value==="topics"?"bg-background shadow-sm text-foreground":"text-muted-foreground hover:text-foreground"])},[r(o(J),{class:"h-3 w-3"}),e[14]||(e[14]=m(" Topics ",-1))],2),s("button",{onClick:e[3]||(e[3]=t=>$.value="history"),class:w(["flex-1 flex items-center justify-center gap-2 text-xs font-medium py-1.5 rounded-md transition-all",$.value==="history"?"bg-background shadow-sm text-foreground":"text-muted-foreground hover:text-foreground"])},[r(o(ae),{class:"h-3 w-3"}),e[15]||(e[15]=m(" History ",-1))],2)])]),r(o(dt),{class:"flex-1 min-h-0"},{default:l(()=>[$.value==="topics"?(d(),c("div",Lt,[n.topics.length===0?(d(),c("div",zt,[r(o(J),{class:"h-8 w-8 mb-3 opacity-20"}),e[16]||(e[16]=s("p",null,"No topics available",-1))])):y("",!0),(d(!0),c(W,null,Y(n.topics,t=>(d(),c("div",{key:t.id,onClick:i=>{g.value=t,N.value&&(_.value=!1)},class:w(["p-3 rounded-lg cursor-pointer border transition-all text-left hover:border-primary/30 active:scale-[0.98]",g.value?.id===t.id?"bg-primary/5 border-primary/50 shadow-sm":"bg-card border-transparent hover:bg-card/80"])},[s("h3",{class:w(["text-sm font-medium mb-1.5 line-clamp-2 leading-snug",g.value?.id===t.id?"text-primary":"text-foreground"])},k(P(t.title)),3),s("div",At,[r(o(Te),{variant:"outline",class:"text-[10px] h-5 px-1.5 bg-background/50 font-normal border-primary/20"},{default:l(()=>[m(k(t.difficulty||"Intermediate"),1)]),_:2},1024),t.feasibility_score?(d(),c("span",Jt,k(t.feasibility_score)+"% match ",1)):y("",!0)])],10,Vt))),128))])):(d(),c("div",Wt,[r(o(h),{variant:"outline",class:"w-full mb-3 justify-start overflow-hidden bg-background/50 hover:bg-background border-dashed",onClick:de},{default:l(()=>[r(o(Xe),{class:"h-4 w-4 mr-2"}),e[17]||(e[17]=m(" New Conversation ",-1))]),_:1}),n.historySessions.length===0?(d(),c("div",qt,[r(o(ae),{class:"h-8 w-8 mb-3 opacity-20"}),e[18]||(e[18]=s("p",null,"No previous conversations",-1))])):y("",!0),(d(!0),c(W,null,Y(n.historySessions,t=>(d(),c("div",{key:t.id,onClick:i=>K.value!==t.id&&(Oe(t.id),N.value?_.value=!1:null),class:w(["p-3 rounded-lg cursor-pointer border transition-all text-left hover:border-primary/30 group relative",u.sessionId===t.id?"bg-primary/5 border-primary/50 shadow-sm":"bg-card border-transparent hover:bg-card/80"])},[K.value===t.id?(d(),c("div",{key:0,class:"flex items-center gap-1",onClick:e[5]||(e[5]=q(()=>{},["stop"]))},[Ge(s("input",{"onUpdate:modelValue":e[4]||(e[4]=i=>D.value=i),class:"flex-1 text-sm px-2 py-1 h-7 bg-background border border-primary/50 rounded focus:outline-none focus:ring-1 focus:ring-primary w-full",onKeydown:[Z(i=>ce(t.id),["enter"]),Z(H,["escape"])],autofocus:""},null,40,Kt),[[Ye,D.value]]),s("button",{onClick:i=>ce(t.id),class:"p-1 hover:bg-green-500/20 rounded text-green-500 shrink-0"},[r(o(Ze),{class:"h-3.5 w-3.5"})],8,Ht),s("button",{onClick:H,class:"p-1 hover:bg-red-500/20 rounded text-red-500 shrink-0"},[r(o(Qe),{class:"h-3.5 w-3.5"})])])):(d(),c("div",Ut,[s("div",Xt,[s("h3",{class:w(["text-sm font-medium line-clamp-1 break-all",u.sessionId===t.id?"text-primary":"text-foreground"])},k(t.title),3),u.sessionId===t.id||!N.value?(d(),c("div",Gt,[s("button",{onClick:q(i=>Fe(t,i),["stop"]),class:"p-1.5 hover:bg-muted rounded text-muted-foreground hover:text-primary transition-colors"},[r(o(et),{class:"h-3 w-3"})],8,Yt),s("button",{onClick:q(i=>Me(t.id),["stop"]),class:"p-1.5 hover:bg-red-500/10 rounded text-muted-foreground hover:text-red-500 transition-colors"},[r(o(_e),{class:"h-3 w-3"})],8,Zt)])):y("",!0)]),s("div",Qt,[s("span",es,[r(o(tt),{class:"h-3 w-3 opacity-70"}),m(" "+k(t.message_count),1)]),s("span",null,k(t.date),1)])]))],10,Bt))),128))]))]),_:1}),s("div",ts,[u.returnToSelection?(d(),F(o(h),{key:0,variant:"outline",class:"w-full justify-start overflow-hidden bg-background/50 hover:bg-background border-border/60 mb-2",onClick:Ee},{default:l(()=>[r(o(we),{class:"mr-2 h-4 w-4"}),e[19]||(e[19]=m(" Back to Topic Selection ",-1))]),_:1})):y("",!0),r(o(h),{variant:"ghost",class:"w-full justify-start text-muted-foreground hover:text-foreground",onClick:De},{default:l(()=>[r(o(we),{class:"mr-2 h-4 w-4"}),e[20]||(e[20]=m(" Back to Library ",-1))]),_:1})])])],2),s("main",ss,[s("header",os,[s("div",rs,[r(o(h),{variant:"ghost",size:"icon",class:"shrink-0 -ml-2",onClick:e[6]||(e[6]=t=>_.value=!_.value),title:_.value?"Close sidebar":"Open sidebar"},{default:l(()=>[(d(),F(he(_.value?o(xe):o(st)),{class:"h-5 w-5 text-muted-foreground"}))]),_:1},8,["title"]),s("div",ns,[s("div",is,[e[22]||(e[22]=s("h1",{class:"font-semibold text-foreground truncate text-sm md:text-base"}," Topic Laboratory ",-1)),r(o(Te),{variant:"secondary",class:"font-normal text-[10px] hidden sm:inline-flex bg-primary/10 text-primary border-transparent"},{default:l(()=>[...e[21]||(e[21]=[m(" AI Assistant ",-1)])]),_:1})]),s("span",as,k(n.project.title),1)])]),s("div",ls,[r(o($t),null,{default:l(()=>[r(o(Ct),null,{default:l(()=>[r(o(St),{"as-child":""},{default:l(()=>[s("div",ds,[e[23]||(e[23]=s("span",{class:"text-[10px] font-medium uppercase tracking-wider text-muted-foreground"},"Credits",-1)),s("span",{class:w(["text-xs font-bold",o(Ne)?"text-primary":"text-red-500"])},k(o(Ie)),3)])]),_:1}),r(o(Tt),null,{default:l(()=>[...e[24]||(e[24]=[s("p",null,"Your word balance",-1)])]),_:1})]),_:1})]),_:1}),r(o(h),{disabled:!g.value||T.value,onClick:We,class:"shadow-lg shadow-primary/20 h-9 px-4 text-xs md:text-sm"},{default:l(()=>[r(o(ke),{class:"h-4 w-4 mr-2"}),e[25]||(e[25]=s("span",{class:"hidden sm:inline"},"Select Topic",-1)),e[26]||(e[26]=s("span",{class:"sm:hidden"},"Select",-1))]),_:1},8,["disabled"])])]),s("div",{class:"flex-1 overflow-y-auto px-4 py-6 scroll-smooth w-full",ref_key:"chatContainer",ref:B},[s("div",cs,[g.value?(d(),c("div",us,[s("div",ps,[s("div",fs,[r(o(J),{class:"w-12 h-12 text-primary rotate-12"})]),s("div",ms,[s("div",vs,[r(o(J),{class:"h-5 w-5"})]),s("div",gs,[r(le,{content:g.value.title,as:"h3",class:"text-base md:text-lg font-bold text-foreground leading-tight"},null,8,["content"]),r(le,{content:g.value.description,as:"div",class:"text-xs md:text-sm text-muted-foreground leading-relaxed pl-3 border-l-2 border-primary/20"},null,8,["content"])])])])])):y("",!0),a.value.length?(d(!0),c(W,{key:1},Y(a.value,t=>(d(),c("div",{key:t.id,class:w(["flex gap-3 animate-in fade-in slide-in-from-bottom-2",t.role==="user"?"justify-end":"justify-start"])},[t.role==="assistant"?(d(),c("div",bs,[r(o(ot),{class:"h-4 w-4 text-primary"})])):y("",!0),s("div",ys,[s("div",{class:w(["rounded-2xl px-4 md:px-5 py-3 shadow-sm text-sm leading-relaxed overflow-hidden break-words",t.role==="user"?"bg-primary text-primary-foreground rounded-tr-none":"bg-muted/50 border border-border/50 text-foreground rounded-tl-none"])},[t.isTyping?(d(),c("div",hs,[...e[27]||(e[27]=[s("span",{class:"w-1.5 h-1.5 bg-current rounded-full animate-bounce",style:{"animation-delay":"0ms"}},null,-1),s("span",{class:"w-1.5 h-1.5 bg-current rounded-full animate-bounce",style:{"animation-delay":"150ms"}},null,-1),s("span",{class:"w-1.5 h-1.5 bg-current rounded-full animate-bounce",style:{"animation-delay":"300ms"}},null,-1)])])):(d(),c("div",xs,[r(le,{content:qe(t.content)},null,8,["content"]),t.role==="assistant"&&fe(t.content).length>0?(d(),c("div",_s,[s("div",ws,[r(o(Ce),{class:"h-3 w-3"}),e[28]||(e[28]=m(" Suggested Topics ",-1))]),s("div",ks,[(d(!0),c(W,null,Y(fe(t.content),(i,f)=>(d(),c("button",{key:f,onClick:j=>Ae(i),class:"text-xs px-3 py-1.5 bg-background hover:bg-primary/10 text-primary border border-primary/20 hover:border-primary/50 rounded-full transition-all flex items-center gap-1.5 shadow-sm active:scale-95 text-left max-w-full"},[r(o(Se),{class:"h-3 w-3 shrink-0"}),s("span",Ss,k(i),1)],8,Cs))),128))])])):y("",!0),t.role==="assistant"&&re(t.content)?(d(),c("div",Ts,[s("div",$s,[r(o(ke),{class:"h-3 w-3"}),e[29]||(e[29]=m(" Refined Topic ",-1))]),s("div",js,[r(o(h),{size:"sm",variant:"outline",class:"h-8",onClick:i=>ge(t.content,!1)},{default:l(()=>[...e[30]||(e[30]=[m(" Use refined topic ",-1)])]),_:2},1032,["onClick"]),r(o(h),{size:"sm",class:"h-8",onClick:i=>ge(t.content,!0)},{default:l(()=>[...e[31]||(e[31]=[m(" Select refined topic ",-1)])]),_:2},1032,["onClick"])])])):y("",!0)]))],2),t.isTyping?y("",!0):(d(),c("div",{key:0,class:w(["flex items-center gap-1 opacity-0 group-hover:opacity-100 transition-opacity",t.role==="user"?"justify-end":"justify-start ml-1"])},[s("button",{onClick:i=>Le(t.content),class:"text-[10px] text-muted-foreground hover:text-foreground p-1 transition-colors",title:"Copy"}," Copy ",8,Is),t.role==="assistant"&&t.id===a.value.filter(i=>i.role==="assistant"&&!i.isTyping).slice(-1)[0]?.id?(d(),c("button",{key:0,onClick:ze,disabled:X.value||T.value,class:"text-[10px] text-muted-foreground hover:text-foreground p-1 transition-colors flex items-center gap-1 disabled:opacity-50",title:"Regenerate"}," Regenerate ",8,Ns)):y("",!0)],2))]),t.role==="user"?(d(),c("div",Os,[r(o(rt),{class:"h-4 w-4 text-muted-foreground"})])):y("",!0)],2))),128)):y("",!0)])],512),s("div",Ds,[s("div",Es,[s("div",Rs,[r(o($e),{modelValue:I.value,"onUpdate:modelValue":e[7]||(e[7]=t=>I.value=t),placeholder:"Refine this topic, ask about methodologies, or check feasibility...",class:"min-h-[3rem] md:min-h-[3.5rem] max-h-32 pr-12 pl-4 py-3 bg-muted/40 hover:bg-muted/60 focus:bg-background focus:ring-1 focus:ring-primary/50 resize-none rounded-xl border-border/50 shadow-sm transition-all",onKeydown:[Z(q(ue,["exact","prevent"]),["enter"]),e[8]||(e[8]=Z(q(t=>I.value+=`
`,["shift","prevent"]),["enter"]))]},null,8,["modelValue","onKeydown"]),T.value?(d(),F(o(h),{key:0,class:"absolute right-2 bottom-2 h-8 w-8 rounded-lg bg-red-500 hover:bg-red-600 shadow-sm transition-transform hover:scale-105",size:"icon",onClick:Ve,title:"Stop"},{default:l(()=>[r(o(nt),{class:"h-4 w-4 fill-current text-white"})]),_:1})):(d(),F(o(h),{key:1,class:"absolute right-2 bottom-2 h-8 w-8 rounded-lg shadow-sm transition-transform hover:scale-105",size:"icon",disabled:!I.value.trim()||!g.value,onClick:ue},{default:l(()=>[r(o(it),{class:"h-4 w-4"})]),_:1},8,["disabled"]))]),e[32]||(e[32]=s("p",{class:"text-center text-[10px] text-muted-foreground/70 select-none"}," AI may display inaccurate info. ",-1))])])])])]),_:1}),r(o(ut),{open:L.value,"onUpdate:open":e[12]||(e[12]=t=>L.value=t)},{default:l(()=>[r(o(ct),{class:"sm:max-w-[500px] gap-6"},{default:l(()=>[r(o(mt),null,{default:l(()=>[r(o(vt),{class:"flex items-center gap-2"},{default:l(()=>[s("div",Fs,[r(o(Ce),{class:"h-5 w-5 text-primary"})]),e[33]||(e[33]=m(" Save Refined Topic ",-1))]),_:1}),r(o(pt),null,{default:l(()=>[...e[34]||(e[34]=[m(" Save this topic to your project's library. ",-1)])]),_:1})]),_:1}),s("div",Ms,[s("div",Ps,[e[35]||(e[35]=s("label",{class:"text-sm font-medium"},"Title",-1)),r(o(lt),{modelValue:C.value.title,"onUpdate:modelValue":e[9]||(e[9]=t=>C.value.title=t),placeholder:"Topic title...",class:"w-full"},null,8,["modelValue"])]),s("div",Ls,[e[36]||(e[36]=s("label",{class:"text-sm font-medium"},"Description",-1)),r(o($e),{modelValue:C.value.description,"onUpdate:modelValue":e[10]||(e[10]=t=>C.value.description=t),placeholder:"Optional description...",class:"resize-none",rows:"4"},null,8,["modelValue"])])]),r(o(ft),null,{default:l(()=>[r(o(h),{variant:"outline",onClick:e[11]||(e[11]=t=>L.value=!1)},{default:l(()=>[...e[37]||(e[37]=[m("Cancel",-1)])]),_:1}),r(o(h),{onClick:Je,disabled:!C.value.title.trim()||G.value},{default:l(()=>[r(o(Se),{class:"h-4 w-4 mr-2"}),m(" "+k(G.value?"Saving...":"Save"),1)]),_:1},8,["disabled"])]),_:1})]),_:1})]),_:1},8,["open"]),r(o(kt),{open:se.value,"onUpdate:open":e[13]||(e[13]=t=>{t||oe()})},{default:l(()=>[r(o(gt),null,{default:l(()=>[r(o(bt),null,{default:l(()=>[r(o(yt),{class:"flex items-center gap-2 text-destructive"},{default:l(()=>[r(o(_e),{class:"h-5 w-5"}),e[38]||(e[38]=m(" Delete Conversation ",-1))]),_:1}),r(o(ht),null,{default:l(()=>[...e[39]||(e[39]=[m(" Permanent action. Cannot be undone. ",-1)])]),_:1})]),_:1}),r(o(xt),null,{default:l(()=>[r(o(_t),{onClick:oe},{default:l(()=>[...e[40]||(e[40]=[m("Cancel",-1)])]),_:1}),r(o(wt),{onClick:Pe,class:"bg-destructive hover:bg-destructive/90 text-destructive-foreground"},{default:l(()=>[...e[41]||(e[41]=[m(" Delete ",-1)])]),_:1})]),_:1})]),_:1})]),_:1},8,["open"])],64))}}),yo=It(zs,[["__scopeId","data-v-569fba90"]]);export{yo as default};
