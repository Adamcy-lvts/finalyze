import{_ as j}from"./index-Ci289g20.js";import{_ as T}from"./index-B2Jp-AbD.js";import{a as $,_ as I}from"./CardContent.vue_vue_type_script_setup_true_lang-BU1G6cs-.js";import{_ as E,a as M}from"./CardTitle.vue_vue_type_script_setup_true_lang-B6ojriqM.js";import{_ as P}from"./Progress.vue_vue_type_script_setup_true_lang-Def6NCmv.js";import{_ as L}from"./ScrollArea.vue_vue_type_script_setup_true_lang-B_LK5Yf7.js";import{_ as ee}from"./SafeHtmlText.vue_vue_type_script_setup_true_lang-5KGWwieD.js";import{d as te,U as se,z as C,j as oe,a as n,o as a,e as t,k as r,w as c,u as i,t as l,s as p,c as h,q as u,F as U,A as z,y as S,C as B}from"./app-CvqzSedG.js";import{B as V,R as ae}from"./useTextHistory-CPsDgHzq.js";import{X as A}from"./DropdownMenuTrigger.vue_vue_type_script_setup_true_lang-BISjo1U_.js";import{L as ie}from"./loader-BDpF-rm2.js";import{C as N}from"./circle-check-big-D2NTCx1j.js";import{T as F}from"./triangle-alert-895uXHmW.js";import"./useForwardExpose-wU1_jECe.js";import"./VisuallyHidden-DB_fmpkP.js";import"./nullish-CHIgUVhi.js";import"./useNonce-BIszhcxR.js";import"./RichTextEditor-BbILrHI8.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";import"./index-BWEDi_FC.js";import"./step-DrZ9DcYd.js";import"./DialogTitle.vue_vue_type_script_setup_true_lang-CFDaVwlw.js";import"./DialogFooter.vue_vue_type_script_setup_true_lang-BdhAhxCn.js";import"./Input.vue_vue_type_script_setup_true_lang-V7CUwJBK.js";import"./Label.vue_vue_type_script_setup_true_lang-B3G1qrOi.js";import"./type-DDl5gjgp.js";import"./minus-uGYVm6s0.js";import"./plus-B-lH923P.js";import"./list-Ce3ZmywA.js";import"./Checkbox.vue_vue_type_script_setup_true_lang-C0d9c34p.js";import"./ohash.D__AXeF1-C-E83dC9.js";import"./VisuallyHiddenInput-C7KK0QYX.js";import"./RovingFocusItem-aDfMhCq7.js";import"./check-8sNs_Wsb.js";import"./Separator.vue_vue_type_script_setup_true_lang-BDxbsbiC.js";import"./Separator-w_CRNjwk.js";import"./Sonner.vue_vue_type_script_setup_true_lang-C3qX8evA.js";import"./circle-check-C6hWbJjC.js";import"./download-CCm3v19k.js";import"./chevron-down-Dx-f3oY2.js";import"./file-text-0_JBq4ld.js";const le={class:"flex h-screen flex-col overflow-hidden bg-background"},re={class:"flex flex-shrink-0 items-center justify-between border-b bg-background/95 p-3 backdrop-blur supports-[backdrop-filter]:bg-background/60"},ne={class:"flex items-center gap-4"},de={class:"flex items-center gap-2"},ue={class:"text-sm text-muted-foreground"},ce={class:"flex items-center gap-2"},pe={class:"flex-shrink-0 bg-muted/30 px-3 py-2"},me={class:"mb-1 flex items-center justify-between"},fe={class:"text-xs text-muted-foreground"},ge={class:"flex flex-1 overflow-hidden"},ve={class:"flex min-h-0 flex-1 flex-col border-r"},xe={class:"flex-shrink-0 space-y-2"},he={class:"text-lg font-semibold"},_e={key:1,class:"flex items-center justify-center h-64 text-muted-foreground"},ye={class:"flex min-h-0 flex-1 flex-col bg-muted/20"},be={class:"flex-shrink-0 space-y-2"},ke={key:0,class:"flex gap-2"},Ce={key:0,class:"flex-shrink-0 space-y-2"},we={class:"text-sm text-muted-foreground p-3 bg-muted/50 rounded-md"},Te={key:0,class:"space-y-2"},Re={class:"flex items-center justify-between text-xs text-muted-foreground"},Ve={key:1,class:"flex-shrink-0"},je={class:"flex items-center justify-between"},$e={class:"grid grid-cols-2 gap-3 text-sm"},Ie={class:"flex items-center gap-2 p-2 rounded bg-background/50"},Pe={class:"font-medium"},Se={class:"flex items-center gap-2 p-2 rounded bg-background/50"},Ae={class:"font-medium"},Ne={class:"flex items-center gap-2 p-2 rounded bg-background/50"},Fe={class:"font-medium"},Ee={class:"flex items-center gap-2 p-2 rounded bg-background/50"},Me={class:"font-medium"},Le={key:0,class:"text-xs text-muted-foreground text-center"},Ue={class:"space-y-3"},ze={key:0,class:"font-medium"},Be={class:"flex items-center gap-2"},Oe={key:2,class:"h-4 w-4 rounded-full bg-gray-300"},qe={class:"text-sm bg-muted px-1 rounded"},We={class:"text-xs text-muted-foreground"},De={key:0},Xe={key:1,class:"font-medium pt-4"},Ye={class:"flex items-center justify-between"},He={class:"flex items-center gap-2"},Ge={class:"font-medium text-sm"},Je={class:"space-y-2"},Ke={key:0,class:"text-sm"},Qe={class:"font-medium text-primary"},Ze={class:"flex items-center gap-4 text-xs text-muted-foreground"},et={key:0},tt={key:1},st={key:1,class:"text-xs text-muted-foreground"},ot={key:2,class:"flex items-center gap-4 text-xs"},at={key:0,class:"flex items-center gap-1"},it=["href"],lt={key:1,class:"flex items-center gap-1"},rt=["href"],nt={key:3,class:"space-y-2"},dt={class:"text-xs text-muted-foreground"},ut={key:0,class:"ml-2"},ct={key:0,class:"mt-2 p-2 bg-muted/30 rounded border-l-2 border-green-500"},pt={class:"text-xs text-foreground italic"},mt={key:4,class:"space-y-2"},ft={key:0,class:"text-xs text-red-600"},gt={class:"flex items-center gap-2"},vt={class:"text-xs"},xt={class:"mt-1 p-2 bg-muted/20 rounded text-xs font-mono"},ht={key:2,class:"text-center text-muted-foreground py-8"},ls=te({__name:"CitationVerificationLayout",props:{project:{},chapter:{},chapterTitle:{},chapterContent:{},currentWordCount:{},targetWordCount:{},progressPercentage:{}},emits:["exitCitationMode"],setup(O,{emit:q}){const k=O,W=q;se();const w=C([]),x=C([]),m=C({total:0,verified:0,failed:0,unverified:0,pending:0}),v=C(!1),_=C(!1),d=C(""),y=C({percentage:0,message:"",completed:!1});let R=null,b=null;const D=o=>{b&&clearInterval(b),b=setInterval(async()=>{try{const e=await B.get(S("api.citation-verification.progress",o));if(e.data.success){const s=e.data.progress;y.value=s,d.value=s.message,(s.completed||s.percentage>=100)&&(clearInterval(b),b=null,setTimeout(()=>X(o),1e3))}}catch(e){console.error("Error fetching progress:",e)}},1e3)},X=async o=>{try{const e=await B.get(S("api.citation-verification.result",o));if(e.data.success){const s=e.data;w.value=s.citations||[],x.value=s.references||[],m.value=s.summary||m.value,d.value=s.message||"Verification completed",_.value=!0}else d.value=e.data.message||"Failed to fetch results"}catch(e){console.error("Error fetching results:",e),d.value="Failed to fetch verification results"}finally{v.value=!1,y.value={percentage:100,message:"Completed",completed:!0},R=null}},Y=async()=>{if(!k.chapter?.id){console.error("No chapter ID available"),d.value="No chapter available to verify";return}v.value=!0,_.value=!1,y.value={percentage:0,message:"Initializing...",completed:!1},d.value="Starting async verification process...",console.log("=== ASYNC CITATION VERIFICATION START ==="),console.log("Chapter object:",k.chapter),console.log("Chapter ID:",k.chapter.id);try{const o=document.querySelector('meta[name="csrf-token"]')?.getAttribute("content");console.log("CSRF token found:",!!o);const e=S("api.projects.chapters.verify-citations",{project:k.project.slug,chapter:k.chapter.slug});console.log("Generated URL:",e);const s={method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json","X-CSRF-TOKEN":o||"","X-Requested-With":"XMLHttpRequest"},credentials:"same-origin",body:JSON.stringify({})};console.log("About to make async fetch request to:",e);const f=await fetch(e,s);if(console.log("Response received:",f.status,f.statusText),!f.ok)throw new Error(`HTTP error! status: ${f.status}`);const g=await f.json();console.log("Initial response:",g),g.success&&g.async?(R=g.session_id,d.value=g.message,console.log("Starting progress tracking for session:",R),D(R)):g.success?(w.value=g.citations||[],x.value=g.references||[],m.value=g.summary||m.value,d.value=g.message||"Verification completed",_.value=!0,v.value=!1):(d.value=g.message||"Verification failed",v.value=!1)}catch(o){console.error("Citation verification error:",o),o.message&&o.message.includes("419")?d.value="Session expired. Please refresh the page and try again.":o.message&&o.message.includes("401")?d.value="Unauthorized. Please log in again.":o.message&&o.message.includes("404")?d.value="Chapter not found. Please try again.":o.message&&o.message.includes("500")?d.value="Server error. Please try again.":(console.error("Error:",o.message),d.value="An unexpected error occurred. Please try again."),v.value=!1,y.value={percentage:0,message:"",completed:!1}}},H=()=>{b&&(clearInterval(b),b=null)},G=async()=>{try{const o=x.value.filter(f=>f.status==="verified"&&f.formatted_citation);let e="";o.length>0?e=o.map(f=>f.formatted_citation).join(`

`):e=x.value.map(f=>{const g=f.authors?f.authors.join(", "):"Unknown",Q=f.year||"n.d.",Z=f.title||"Title not available";return`${g} (${Q}). ${Z}.`}).join(`

`),await navigator.clipboard.writeText(e);const s=d.value;d.value="References copied to clipboard!",setTimeout(()=>{d.value=s},2e3)}catch(o){console.error("Failed to copy references:",o),d.value="Failed to copy references to clipboard"}},J=()=>{console.log("Export references:",x.value),d.value="Export functionality coming soon!",setTimeout(()=>{d.value=_.value?`Verified ${m.value.verified} out of ${m.value.total} references using bibliography parsing`:""},2e3)},K=async o=>{console.log("Retrying reference:",o),d.value=`Retrying verification for reference ${o.id}...`,setTimeout(()=>{d.value='Individual retry functionality coming soon! Use "Verify Sources" to retry all.',setTimeout(()=>{d.value=_.value?`Verified ${m.value.verified} out of ${m.value.total} references using bibliography parsing`:""},2e3)},1e3)};return oe(()=>{H()}),(o,e)=>(a(),n("div",le,[t("div",re,[t("div",ne,[r(i(T),{onClick:e[0]||(e[0]=s=>W("exitCitationMode")),variant:"ghost",size:"icon"},{default:c(()=>[r(i(A),{class:"h-4 w-4"})]),_:1}),t("div",de,[r(i(V),{class:"h-5 w-5 text-primary"}),t("div",null,[r(ee,{as:"h1",class:"text-lg font-bold",content:k.project.title},null,8,["content"]),t("p",ue," Citation Verification • Chapter "+l(k.chapter.chapter_number)+" • "+l(o.currentWordCount)+" / "+l(o.targetWordCount)+" words ",1)])])]),t("div",ce,[r(i(j),{variant:o.chapter.status==="approved"?"default":"secondary"},{default:c(()=>[p(l(o.chapter.status.replace("_"," ")),1)]),_:1},8,["variant"])])]),t("div",pe,[t("div",me,[e[1]||(e[1]=t("span",{class:"text-xs font-medium"},"Writing Progress",-1)),t("span",fe,l(Math.round(o.progressPercentage))+"%",1)]),r(i(P),{value:o.progressPercentage,class:"h-1"},null,8,["value"])]),t("div",ge,[t("div",ve,[r(i(I),{class:"flex min-h-0 flex-1 flex-col rounded-none border-0 bg-transparent shadow-none"},{default:c(()=>[r(i(E),{class:"flex-shrink-0 border-b px-4 py-3"},{default:c(()=>[r(i(M),{class:"text-base"},{default:c(()=>[p("Chapter "+l(o.chapter.chapter_number)+" - Content",1)]),_:1})]),_:1}),r(i($),{class:"flex min-h-0 flex-1 flex-col space-y-3 p-4"},{default:c(()=>[t("div",xe,[t("h2",he,l(o.chapterTitle||"Untitled Chapter"),1)]),r(i(L),{class:"min-h-0 flex-1"},{default:c(()=>[o.chapterContent?(a(),h(ae,{key:0,content:o.chapterContent,class:"p-4",style:{"font-family":"'Times New Roman', serif","line-height":"1.6"}},null,8,["content"])):(a(),n("div",_e,[...e[2]||(e[2]=[t("p",null,"No content available to verify",-1)])]))]),_:1})]),_:1})]),_:1})]),t("div",ye,[r(i(I),{class:"flex min-h-0 flex-1 flex-col rounded-none border-0 bg-transparent shadow-none"},{default:c(()=>[r(i(E),{class:"flex-shrink-0 border-b px-4 py-3"},{default:c(()=>[r(i(M),{class:"text-base flex items-center gap-2"},{default:c(()=>[r(i(V),{class:"h-4 w-4"}),e[3]||(e[3]=p(" Citation Verification ",-1))]),_:1})]),_:1}),r(i($),{class:"flex min-h-0 flex-1 flex-col space-y-4 p-4"},{default:c(()=>[t("div",be,[r(i(T),{onClick:Y,disabled:v.value||!o.chapterContent,class:"w-full"},{default:c(()=>[v.value?(a(),h(i(ie),{key:0,class:"h-4 w-4 mr-2 animate-spin"})):(a(),h(i(V),{key:1,class:"h-4 w-4 mr-2"})),p(" "+l(v.value?"Verifying...":"Verify Sources"),1)]),_:1},8,["disabled"]),_.value&&x.value.length>0?(a(),n("div",ke,[r(i(T),{onClick:G,variant:"outline",size:"sm",class:"flex-1 text-xs"},{default:c(()=>[...e[4]||(e[4]=[p(" Copy References ",-1)])]),_:1}),r(i(T),{onClick:J,variant:"outline",size:"sm",class:"flex-1 text-xs"},{default:c(()=>[...e[5]||(e[5]=[p(" Export ",-1)])]),_:1})])):u("",!0)]),d.value||v.value?(a(),n("div",Ce,[t("div",we,l(d.value),1),v.value&&y.value.percentage>0?(a(),n("div",Te,[t("div",Re,[t("span",null,l(y.value.message),1),t("span",null,l(Math.round(y.value.percentage))+"%",1)]),r(i(P),{value:y.value.percentage,class:"h-2"},null,8,["value"])])):u("",!0)])):u("",!0),_.value?(a(),n("div",Ve,[r(i(I),{class:"bg-muted/30"},{default:c(()=>[r(i($),{class:"p-4 space-y-3"},{default:c(()=>[t("div",je,[e[6]||(e[6]=t("h4",{class:"font-medium text-sm"},"Verification Results",-1)),r(i(j),{variant:"outline",class:"text-xs"},{default:c(()=>[p(l(Math.round(m.value.verified/m.value.total*100))+"% verified ",1)]),_:1})]),r(i(P),{value:m.value.verified/m.value.total*100,class:"h-2"},null,8,["value"]),t("div",$e,[t("div",Ie,[e[7]||(e[7]=t("div",{class:"h-3 w-3 rounded-full bg-blue-500"},null,-1)),t("span",Pe,l(m.value.total),1),e[8]||(e[8]=t("span",{class:"text-muted-foreground text-xs"},"Total",-1))]),t("div",Se,[r(i(N),{class:"h-3 w-3 text-green-500"}),t("span",Ae,l(m.value.verified),1),e[9]||(e[9]=t("span",{class:"text-muted-foreground text-xs"},"Verified",-1))]),t("div",Ne,[r(i(A),{class:"h-3 w-3 text-red-500"}),t("span",Fe,l(m.value.failed||0),1),e[10]||(e[10]=t("span",{class:"text-muted-foreground text-xs"},"Failed",-1))]),t("div",Ee,[r(i(F),{class:"h-3 w-3 text-orange-500"}),t("span",Me,l(m.value.pending||0),1),e[11]||(e[11]=t("span",{class:"text-muted-foreground text-xs"},"Pending",-1))])]),m.value.processing_time_ms||d.value.includes("processing_time_ms")?(a(),n("div",Le,[...e[12]||(e[12]=[t("span",null,"Processing completed",-1)])])):u("",!0)]),_:1})]),_:1})])):u("",!0),_.value?(a(),h(i(L),{key:2,class:"min-h-0 flex-1"},{default:c(()=>[t("div",Ue,[w.value.length>0?(a(),n("h3",ze,"In-text Citations")):u("",!0),(a(!0),n(U,null,z(w.value,s=>(a(),n("div",{key:s.id,class:"border rounded-md p-3 space-y-2"},[t("div",Be,[s.status==="verified"?(a(),h(i(N),{key:0,class:"h-4 w-4 text-green-500"})):s.status==="unverified"?(a(),h(i(F),{key:1,class:"h-4 w-4 text-orange-500"})):(a(),n("div",Oe)),t("code",qe,l(s.text),1)]),t("div",We,[t("p",null,[e[13]||(e[13]=t("strong",null,"Author:",-1)),p(" "+l(s.author),1)]),t("p",null,[e[14]||(e[14]=t("strong",null,"Year:",-1)),p(" "+l(s.year),1)]),s.details?(a(),n("p",De,[e[15]||(e[15]=t("strong",null,"Status:",-1)),p(" "+l(s.details),1)])):u("",!0)])]))),128)),x.value.length>0?(a(),n("h3",Xe,"Reference List")):u("",!0),(a(!0),n(U,null,z(x.value,s=>(a(),n("div",{key:s.id,class:"border rounded-md p-4 space-y-3"},[t("div",Ye,[t("div",He,[s.status==="verified"?(a(),h(i(N),{key:0,class:"h-5 w-5 text-green-500"})):s.status==="failed"?(a(),h(i(A),{key:1,class:"h-5 w-5 text-red-500"})):(a(),h(i(F),{key:2,class:"h-5 w-5 text-orange-500"})),t("span",Ge,"Reference "+l(s.id),1)]),r(i(j),{variant:s.status==="verified"?"default":s.status==="failed"?"destructive":"secondary",class:"text-xs"},{default:c(()=>[p(l(s.status||"unverified"),1)]),_:2},1032,["variant"])]),t("div",Je,[s.title?(a(),n("div",Ke,[t("span",Qe,l(s.title),1)])):u("",!0),t("div",Ze,[s.authors&&s.authors.length>0?(a(),n("div",et,[e[16]||(e[16]=t("strong",null,"Authors:",-1)),p(" "+l(s.authors.join(", ")),1)])):u("",!0),s.year?(a(),n("div",tt,[e[17]||(e[17]=t("strong",null,"Year:",-1)),p(" "+l(s.year),1)])):u("",!0)]),s.journal||s.publisher?(a(),n("div",st,[e[18]||(e[18]=t("strong",null,"Published in:",-1)),p(" "+l(s.journal||s.publisher),1)])):u("",!0),s.doi||s.url?(a(),n("div",ot,[s.doi?(a(),n("div",at,[e[19]||(e[19]=t("strong",null,"DOI:",-1)),t("a",{href:"https://doi.org/"+s.doi,target:"_blank",class:"text-blue-600 hover:underline"},l(s.doi),9,it)])):u("",!0),s.url&&!s.doi?(a(),n("div",lt,[e[20]||(e[20]=t("strong",null,"URL:",-1)),t("a",{href:s.url,target:"_blank",class:"text-blue-600 hover:underline break-all"},l(s.url.length>40?s.url.substring(0,40)+"...":s.url),9,rt)])):u("",!0)])):u("",!0),s.status==="verified"?(a(),n("div",nt,[t("div",dt,[e[23]||(e[23]=t("strong",null,"Verification Method:",-1)),p(" "+l(s.verification_method||"api")+" ",1),s.confidence?(a(),n("span",ut,[e[21]||(e[21]=p(" | ",-1)),e[22]||(e[22]=t("strong",null,"Confidence:",-1)),p(" "+l(Math.round(s.confidence*100))+"% ",1)])):u("",!0)]),s.formatted_citation?(a(),n("div",ct,[e[24]||(e[24]=t("div",{class:"text-xs font-medium text-muted-foreground mb-1"},"Formatted Citation (APA):",-1)),t("div",pt,l(s.formatted_citation),1)])):u("",!0)])):u("",!0),s.status==="failed"?(a(),n("div",mt,[s.failure_reason?(a(),n("div",ft,[e[25]||(e[25]=t("strong",null,"Issue:",-1)),p(" "+l(s.failure_reason),1)])):u("",!0),t("div",gt,[r(i(T),{onClick:f=>K(s),variant:"outline",size:"sm",class:"text-xs h-6 px-2",disabled:v.value},{default:c(()=>[...e[26]||(e[26]=[p(" Retry ",-1)])]),_:2},1032,["onClick","disabled"]),e[27]||(e[27]=t("span",{class:"text-xs text-muted-foreground"}," Try searching with different criteria ",-1))])])):u("",!0),t("details",vt,[e[28]||(e[28]=t("summary",{class:"cursor-pointer text-muted-foreground hover:text-foreground"}," Show raw reference text ",-1)),t("div",xt,l(s.raw_text),1)])])]))),128)),w.value.length===0&&x.value.length===0?(a(),n("div",ht,[r(i(V),{class:"h-12 w-12 mx-auto mb-2 opacity-50"}),e[29]||(e[29]=t("p",null,"No citations found in this chapter",-1)),e[30]||(e[30]=t("p",{class:"text-xs"},"Citations will appear here when detected",-1))])):u("",!0)])]),_:1})):u("",!0)]),_:1})]),_:1})])])]))}});export{ls as default};
