import{d as He,b as v,p as Ke,T as Xe,t as ye,q as he,c,o as d,k as r,j as l,g as s,f as y,n as w,i as F,v as xe,u as o,z as k,y as m,F as A,h as Q,a3 as J,Q as Ge,a2 as Y,R as Qe,X as S,U as h}from"./app-D3Iw_Thj.js";import{b as Ye,_ as Ze}from"./AppLayout.vue_vue_type_script_setup_true_lang-Be9icpdJ.js";import{c as de,_ as x}from"./index-B7c5vKLT.js";import{_ as et}from"./Input.vue_vue_type_script_setup_true_lang-CTarQ5lh.js";import{_ as _e}from"./index-Cc1-jBcm.js";import{_ as we}from"./Textarea.vue_vue_type_script_setup_true_lang-Dutp4WfC.js";import{a as tt}from"./ScrollArea.vue_vue_type_script_setup_true_lang-P0bxdymo.js";import{c as st,a as ot,b as rt,_ as it}from"./DialogTitle.vue_vue_type_script_setup_true_lang-Q-UNwfM7.js";import{_ as nt}from"./DialogDescription.vue_vue_type_script_setup_true_lang-nIqXnI_w.js";import{_ as at}from"./DialogFooter.vue_vue_type_script_setup_true_lang-DRnCzXqi.js";import{H as ae,a as ke,P as lt,b as dt,c as ct,d as ut,e as pt,f as ft,g as mt,h as vt,_ as gt}from"./AlertDialogTitle.vue_vue_type_script_setup_true_lang-CLrZQHCI.js";import{_ as bt,a as yt,b as ht}from"./UserInfo.vue_vue_type_script_setup_true_lang-xSQ9zadf.js";import{_ as le}from"./SafeHtmlText.vue_vue_type_script_setup_true_lang-CdKk3Twn.js";import{t as p}from"./index-DdfCIJN-.js";import{u as xt}from"./useWordBalance-DC-G7dlY.js";import{S as W}from"./sparkles-Bd45qqfs.js";import{P as _t}from"./plus-B6ooFbkt.js";import{C as wt}from"./check-DztHtWQE.js";import{X as kt}from"./x-DMUlV3SA.js";import{P as Ct}from"./pencil-DbSddSY4.js";import{T as Ce}from"./trash-2-D6eP36bE.js";import{M as St}from"./message-square-DwjnNMQ9.js";import{A as Se}from"./arrow-left-CuVUnyux.js";import{C as Te}from"./DropdownMenuTrigger.vue_vue_type_script_setup_true_lang-DUFsz-Xr.js";import{B as Tt}from"./bot-B_GgNCt-.js";import{S as $e}from"./save-BP7xsGgN.js";import{U as $t}from"./user-CQlYIHdq.js";import{_ as jt}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./useForwardExpose-DZg9gJcs.js";import"./index-KzQTrjr0.js";import"./coins-Cv_rez8v.js";import"./log-out-LWFNNZIM.js";import"./AppLogo.vue_vue_type_script_setup_true_lang-Cgwt42cW.js";import"./library-CxSmAN0u.js";import"./book-open-Chn35HW5.js";import"./chevron-right-BskpXW8s.js";import"./Presence-Ch24oj1g.js";import"./DialogTitle-BrQpvWmL.js";import"./CardContent.vue_vue_type_script_setup_true_lang-BhNvESjn.js";import"./sun-DaoHdcO4.js";import"./useNonce-lpG41Z0o.js";import"./VisuallyHidden-D9gWnJzL.js";import"./purify.es-DxJI3Wx7.js";import"./loader-circle-QScJRSgB.js";/**
 * @license lucide-vue-next v0.468.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const je=de("BookmarkPlusIcon",[["path",{d:"m19 21-7-4-7 4V5a2 2 0 0 1 2-2h10a2 2 0 0 1 2 2v16z",key:"1fy3hk"}],["line",{x1:"12",x2:"12",y1:"7",y2:"13",key:"1cppfj"}],["line",{x1:"15",x2:"9",y1:"10",y2:"10",key:"1gty7f"}]]);/**
 * @license lucide-vue-next v0.468.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const It=de("SendIcon",[["path",{d:"M14.536 21.686a.5.5 0 0 0 .937-.024l6.5-19a.496.496 0 0 0-.635-.635l-19 6.5a.5.5 0 0 0-.024.937l7.93 3.18a2 2 0 0 1 1.112 1.11z",key:"1ffxy3"}],["path",{d:"m21.854 2.147-10.94 10.939",key:"12cjpa"}]]);/**
 * @license lucide-vue-next v0.468.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Nt=de("SquareIcon",[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",key:"afitv7"}]]),Ot={class:"flex h-[calc(100vh-4rem)] min-h-0 overflow-hidden relative bg-background w-full"},Dt={class:"min-w-[20rem] h-full flex flex-col"},Et={class:"p-4 border-b border-border/50"},Rt={class:"flex items-center justify-between mb-4"},Ft={class:"flex items-center gap-2"},Mt={class:"p-1.5 bg-primary/10 rounded-md"},Pt={class:"font-semibold text-foreground tracking-tight"},Lt={class:"flex bg-muted rounded-lg p-1"},zt={key:0,class:"p-3 space-y-2"},Vt={key:0,class:"text-center py-10 text-muted-foreground text-sm flex flex-col items-center"},Bt=["onClick"],At={class:"flex items-center gap-2"},Jt={key:0,class:"text-[10px] text-muted-foreground font-medium"},Wt={key:1,class:"p-3 space-y-2"},Ut={key:0,class:"text-center py-10 text-muted-foreground text-sm flex flex-col items-center"},qt=["onClick"],Ht=["onKeydown"],Kt=["onClick"],Xt={key:1,class:"flex flex-col gap-1"},Gt={class:"flex items-start justify-between"},Qt={key:0,class:"flex items-center opacity-0 group-hover:opacity-100 transition-opacity absolute right-2 top-2 bg-card/80 backdrop-blur-sm rounded shadow-sm border border-border/50 p-0.5"},Yt=["onClick"],Zt=["onClick"],es={class:"flex items-center justify-between text-[10px] text-muted-foreground"},ts={class:"flex items-center gap-1"},ss={class:"p-4 border-t border-border/50 bg-background/50 backdrop-blur-sm mt-auto"},os={class:"flex-1 flex flex-col min-w-0 bg-background h-full relative z-0"},rs={class:"h-16 flex-none border-b border-border/50 flex items-center justify-between px-4 sticky top-0 bg-background/80 backdrop-blur-md z-10 transition-all"},is={class:"flex items-center gap-3 min-w-0"},ns={class:"flex flex-col min-w-0"},as={class:"flex items-center gap-2"},ls={class:"text-[10px] text-muted-foreground truncate hidden sm:block"},ds={class:"flex items-center gap-2"},cs={class:"hidden md:flex flex-col items-end mr-2 cursor-help"},us={class:"max-w-3xl mx-auto space-y-6 pb-4"},ps={key:0,class:"mb-8 animate-in fade-in slide-in-from-top-4 duration-700"},fs={class:"rounded-xl border border-primary/20 bg-gradient-to-br from-primary/5 via-background to-background p-4 md:p-6 shadow-sm relative overflow-hidden group"},ms={class:"absolute top-0 right-0 p-3 opacity-10 group-hover:opacity-20 transition-opacity"},vs={class:"flex items-start gap-4 relative z-10"},gs={class:"p-2 bg-primary/10 rounded-lg text-primary mt-1 shrink-0"},bs={class:"min-w-0 flex-1 space-y-2"},ys={key:0,class:"h-8 w-8 rounded-full bg-primary/10 flex items-center justify-center shrink-0 border border-primary/20 self-start mt-1"},hs={class:"flex flex-col gap-1 max-w-[85%] md:max-w-[80%] min-w-0"},xs={key:0,class:"flex gap-1 items-center h-5 px-1"},_s={key:1,class:"markdown-body"},ws={key:0,class:"mt-4 pt-3 border-t border-border/30"},ks={class:"text-[10px] uppercase tracking-wider text-muted-foreground mb-2 flex items-center gap-1 font-semibold opacity-70"},Cs={class:"flex flex-wrap gap-2"},Ss=["onClick"],Ts={class:"truncate"},$s={key:1,class:"mt-4 pt-3 border-t border-border/30"},js={class:"text-[10px] uppercase tracking-wider text-muted-foreground mb-2 flex items-center gap-1 font-semibold opacity-70"},Is={class:"flex flex-wrap gap-2"},Ns=["onClick"],Os=["disabled"],Ds={key:1,class:"h-8 w-8 rounded-full bg-muted flex items-center justify-center shrink-0 border border-border self-start mt-1"},Es={class:"p-3 md:p-4 border-t border-border/50 bg-background/80 backdrop-blur-md sticky bottom-0 z-20"},Rs={class:"max-w-3xl mx-auto relative flex flex-col gap-2"},Fs={class:"relative w-full"},Ms={class:"p-2 bg-primary/10 rounded-lg"},Ps={class:"space-y-4"},Ls={class:"space-y-2"},zs={class:"space-y-2"},Vs=He({__name:"TopicsLab",props:{project:{},topics:{},sessionId:{},returnToSelection:{type:Boolean},historySessions:{},initialMessages:{},initialTopic:{}},setup(Ie){const u=Ie,g=v(u.initialTopic||(u.topics&&u.topics.length>0?u.topics[0]:null)),a=v(u.initialMessages||[]),I=v(""),T=v(!1),U=v(null),N=v(!1),_=v(!0),{formattedBalance:Ne,hasWords:Oe}=xt(),Z=v(!1),ee=()=>{typeof window>"u"||(N.value=window.innerWidth<1024,N.value=window.innerWidth<1024,window.innerWidth<1024||(_.value=!0))};Ke(()=>{ee(),window.addEventListener("resize",ee),M()}),Xe(()=>{window.removeEventListener("resize",ee)});const $=v((()=>{if(typeof window<"u"){const i=localStorage.getItem("topicsLab_sidebarMode");if(i==="topics"||i==="history")return i}return"topics"})());ye($,i=>{typeof window<"u"&&localStorage.setItem("topicsLab_sidebarMode",i)});const De=i=>{S.visit(h("topics.lab",{project:u.project.slug,session_id:i}))},ce=()=>{S.visit(h("topics.lab",{project:u.project.slug,new:"true"}))},Ee=()=>{S.visit(h("projects.topics.index"))},Re=()=>{S.visit(h("projects.topic-selection",u.project.slug))},Fe=i=>{const e=P(i.title||"").trim();S.visit(h("projects.topic-selection",{project:u.project.slug,prefill_topic:e,prefill_title:e.substring(0,100),prefill_description:i.description||""}))},q=v(null),D=v(""),Me=(i,e)=>{e.stopPropagation(),q.value=i.id,D.value=i.title},H=()=>{q.value=null,D.value=""},ue=async i=>{if(!D.value.trim()){H();return}try{(await fetch(h("topics.chat.rename",u.project.slug),{method:"POST",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":document.querySelector('meta[name="csrf-token"]')?.getAttribute("content")||""},body:JSON.stringify({session_id:i,name:D.value.trim()})})).ok?(p.success("Session renamed!"),S.reload()):p.error("Failed to rename session")}catch{p.error("Failed to rename session")}finally{H()}},te=v(!1),K=v(null),se=v(!1),Pe=i=>{K.value=i,se.value=!0},oe=()=>{se.value=!1,K.value=null},Le=async()=>{if(te.value||!K.value)return;const i=K.value;te.value=!0;try{(await fetch(h("topics.chat.delete-session",u.project.slug),{method:"DELETE",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":document.querySelector('meta[name="csrf-token"]')?.getAttribute("content")||""},body:JSON.stringify({session_id:i})})).ok?(p.success("Conversation deleted"),oe(),i===u.sessionId?ce():S.reload()):p.error("Failed to delete conversation")}catch{p.error("Failed to delete conversation")}finally{te.value=!1}},ze=async i=>{try{const e=i.replace(/<[^>]*>/g,"").replace(/&nbsp;/g," ").trim();await navigator.clipboard.writeText(e),p.success("Copied to clipboard")}catch{p.error("Failed to copy")}},X=v(!1),Ve=async()=>{if(X.value||!g.value)return;const i=a.value.filter(n=>n.role==="user");if(i.length===0){p.error("No message to regenerate");return}const e=a.value.findIndex(n=>n.id===i[i.length-1].id);e>=0&&e<a.value.length-1&&(a.value=a.value.slice(0,e+1)),X.value=!0;const t=Date.now().toString();a.value.push({id:t,role:"assistant",content:"",isTyping:!0}),M();try{const n=await fetch(h("topics.chat",u.project.slug),{method:"POST",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":document.querySelector('meta[name="csrf-token"]')?.getAttribute("content")||""},body:JSON.stringify({messages:a.value.filter(b=>!b.isTyping).map(b=>({role:b.role,content:b.content})),topic_context:g.value,session_id:u.sessionId})});if(!n.ok)throw new Error(`Server error: ${n.status}`);if(!n.body)throw new Error("No response body");const f=n.body.getReader(),j=new TextDecoder;let R="";for(;;){const{done:b,value:z}=await f.read();if(b)break;const ie=j.decode(z).split(`

`);for(const V of ie)if(V.startsWith("data: "))try{const B=JSON.parse(V.slice(6));if(B.content){R+=B.content;const O=a.value.findIndex(ne=>ne.id===t);O!==-1&&(a.value[O].content=R,a.value[O].isTyping=!1),M()}}catch{}}}catch(n){console.error("Regenerate error:",n),p.error("Failed to regenerate response"),a.value=a.value.filter(f=>f.id!==t)}finally{X.value=!1;const n=a.value.findIndex(f=>f.id===t);n!==-1&&(a.value[n].isTyping=!1)}};let E=null;const Be=()=>{E&&(E.abort(),E=null,T.value=!1,p.info("Generation stopped"))},M=async()=>{await he(),U.value&&(U.value.scrollTop=U.value.scrollHeight)},pe=async()=>{if(!I.value.trim()||!g.value||T.value)return;const i={id:Date.now().toString(),role:"user",content:I.value.trim()};a.value.push(i),I.value="",T.value=!0,M();const e=(Date.now()+1).toString();a.value.push({id:e,role:"assistant",content:"",isTyping:!0}),E=new AbortController;try{const t=await fetch(h("topics.chat",u.project.slug),{method:"POST",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":document.querySelector('meta[name="csrf-token"]')?.getAttribute("content")||""},body:JSON.stringify({messages:a.value.filter(b=>!b.isTyping).map(b=>({role:b.role,content:b.content})),topic_context:g.value,session_id:u.sessionId}),signal:E.signal});if(t.status===402){const b=await t.json();p.error(b.message||"Insufficient word balance"),a.value=a.value.filter(z=>z.id!==e),T.value=!1;return}if(!t.ok)throw new Error(`Server error: ${t.status}`);if(!t.body)throw new Error("No response body");const n=t.body.getReader(),f=new TextDecoder;let j="";for(;;){const{done:b,value:z}=await n.read();if(b)break;const ie=f.decode(z).split(`

`);for(const V of ie)if(V.startsWith("data: "))try{const B=JSON.parse(V.slice(6));if(B.content){j+=B.content;const O=a.value.findIndex(ne=>ne.id===e);O!==-1&&(a.value[O].content=j,a.value[O].isTyping=!1),M()}}catch{}}const R=re(j);R&&(ve.value=R,ge(R),p.success("Refined topic detected",{description:"The refined topic is ready to select."}))}catch(t){if(t.name==="AbortError"){const n=a.value.findIndex(f=>f.id===e);n!==-1&&(a.value[n].content?a.value[n].isTyping=!1:a.value.splice(n,1))}else console.error("Chat error:",t),p.error("Failed to get response")}finally{T.value=!1,E=null;const t=a.value.findIndex(n=>n.id===e);t!==-1&&(a.value[t].isTyping=!1)}},P=i=>{const e=document.createElement("DIV");return e.innerHTML=i,e.textContent||e.innerText||""};let fe=!0;ye(g,i=>{if(i&&!Z.value){if(fe){fe=!1,a.value.length===0&&(a.value=[{id:"system-welcome",role:"assistant",content:`Hi! I see you're interested in **${P(i.title||"")}**. How can I help you refine or understand this topic better?`}]);return}a.value=[{id:"system-welcome-"+Date.now(),role:"assistant",content:`Hi! I see you're interested in **${P(i.title||"")}**. How can I help you refine or understand this topic better?`}]}},{immediate:!0});const L=v(!1),C=v({title:"",description:""}),G=v(!1),me=i=>{const e=[],t=/"([^"]{20,200})"/g;let n;for(;(n=t.exec(i))!==null;){const f=n[1].trim();!f.toLowerCase().startsWith("how ")&&!f.toLowerCase().startsWith("what ")&&!f.toLowerCase().startsWith("why ")&&f.length>30&&e.push(f)}return e},ve=v(null),ge=i=>{Z.value=!0,g.value=i,he(()=>{Z.value=!1})},re=i=>{if(!i)return null;const e=i.match(/<REFINED_TOPIC_JSON>\s*([\s\S]*?)\s*<\/REFINED_TOPIC_JSON>/i);if(!e)return null;const t=e[1].trim();try{const n=JSON.parse(t),f=typeof n?.title=="string"?n.title.trim():"",j=typeof n?.description=="string"?n.description.trim():"";return f?{id:0,title:f,description:j,difficulty:"Intermediate",resource_level:"Medium",feasibility_score:75}:null}catch{return null}},be=async(i,e=!1)=>{const t=re(i);if(!t){p.error("No refined topic found in this message");return}ve.value=t,ge(t),e&&Fe(t)},Ae=i=>{C.value={title:i,description:""},L.value=!0},Je=async()=>{if(!C.value.title.trim()){p.error("Please enter a topic title");return}G.value=!0;try{(await fetch(h("topics.chat.save-topic",u.project.slug),{method:"POST",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":document.querySelector('meta[name="csrf-token"]')?.getAttribute("content")||""},body:JSON.stringify({title:C.value.title.trim(),description:C.value.description.trim(),session_id:u.sessionId})})).ok?(p.success("Topic saved successfully!"),L.value=!1,S.reload()):p.error("Failed to save topic")}catch{p.error("Failed to save topic")}finally{G.value=!1}},We=async()=>{if(!g.value)return;const i=p.loading("Setting topic...");try{const e=P(g.value.title);if((await fetch(h("topics.select",u.project.slug),{method:"POST",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":document.querySelector('meta[name="csrf-token"]')?.getAttribute("content")||""},body:JSON.stringify({topic:e,title:e.substring(0,100),description:g.value.description})})).ok)p.dismiss(i),p.success("Topic selected successfully!"),S.visit(h("projects.topic-approval",u.project.slug));else throw new Error("Failed")}catch{p.dismiss(i),p.error("Failed to select topic")}},Ue=i=>{if(!i)return"";i=i.replace(/<REFINED_TOPIC_JSON>[\s\S]*?<\/REFINED_TOPIC_JSON>/gi,"").trim();let e=i.replace(/^### (.*$)/gim,"<strong>$1</strong>").replace(/^## (.*$)/gim,'<strong class="text-lg">$1</strong>').replace(/^# (.*$)/gim,'<strong class="text-xl">$1</strong>');return e=e.replace(/\*\*(.*?)\*\*/g,"<strong>$1</strong>"),e=e.replace(/^\s*-\s+(.*$)/gim,'<li class="ml-4 list-disc">$1</li>'),e=e.replace(/^\s*\d+\.\s+(.*$)/gim,'<li class="ml-4 list-decimal">$1</li>'),e=e.replace(/\n/g,"<br>"),e};return(i,e)=>(d(),c(A,null,[r(Ze,{title:"Topic Lab"},{default:l(()=>[s("div",Ot,[_.value&&N.value?(d(),c("div",{key:0,class:"absolute inset-0 bg-background/80 backdrop-blur-sm z-30 animate-in fade-in duration-200 lg:hidden",onClick:e[0]||(e[0]=t=>_.value=!1)})):y("",!0),s("aside",{class:w(["flex flex-col border-r border-border/50 bg-muted/10 transition-all duration-300 ease-in-out z-40 h-full","lg:relative absolute inset-y-0 left-0",_.value?"translate-x-0 w-80 shadow-2xl lg:shadow-none":"-translate-x-full lg:translate-x-0 lg:w-0 lg:border-none lg:overflow-hidden"])},[s("div",Dt,[s("div",Et,[s("div",Rt,[s("div",Ft,[s("div",Mt,[(d(),F(xe($.value==="topics"?o(W):o(ae)),{class:"h-4 w-4 text-primary"}))]),s("h2",Pt,k($.value==="topics"?"Generated Topics":"History"),1)]),N.value?(d(),F(o(x),{key:0,variant:"ghost",size:"icon",onClick:e[1]||(e[1]=t=>_.value=!1),class:"h-8 w-8 lg:hidden"},{default:l(()=>[r(o(ke),{class:"h-4 w-4"})]),_:1})):y("",!0)]),s("div",Lt,[s("button",{onClick:e[2]||(e[2]=t=>$.value="topics"),class:w(["flex-1 flex items-center justify-center gap-2 text-xs font-medium py-1.5 rounded-md transition-all",$.value==="topics"?"bg-background shadow-sm text-foreground":"text-muted-foreground hover:text-foreground"])},[r(o(W),{class:"h-3 w-3"}),e[14]||(e[14]=m(" Topics ",-1))],2),s("button",{onClick:e[3]||(e[3]=t=>$.value="history"),class:w(["flex-1 flex items-center justify-center gap-2 text-xs font-medium py-1.5 rounded-md transition-all",$.value==="history"?"bg-background shadow-sm text-foreground":"text-muted-foreground hover:text-foreground"])},[r(o(ae),{class:"h-3 w-3"}),e[15]||(e[15]=m(" History ",-1))],2)])]),r(o(tt),{class:"flex-1 min-h-0"},{default:l(()=>[$.value==="topics"?(d(),c("div",zt,[i.topics.length===0?(d(),c("div",Vt,[r(o(W),{class:"h-8 w-8 mb-3 opacity-20"}),e[16]||(e[16]=s("p",null,"No topics available",-1))])):y("",!0),(d(!0),c(A,null,Q(i.topics,t=>(d(),c("div",{key:t.id,onClick:n=>{g.value=t,N.value&&(_.value=!1)},class:w(["p-3 rounded-lg cursor-pointer border transition-all text-left hover:border-primary/30 active:scale-[0.98]",g.value?.id===t.id?"bg-primary/5 border-primary/50 shadow-sm":"bg-card border-transparent hover:bg-card/80"])},[s("h3",{class:w(["text-sm font-medium mb-1.5 line-clamp-2 leading-snug",g.value?.id===t.id?"text-primary":"text-foreground"])},k(P(t.title)),3),s("div",At,[r(o(_e),{variant:"outline",class:"text-[10px] h-5 px-1.5 bg-background/50 font-normal border-primary/20"},{default:l(()=>[m(k(t.difficulty||"Intermediate"),1)]),_:2},1024),t.feasibility_score?(d(),c("span",Jt,k(t.feasibility_score)+"% match ",1)):y("",!0)])],10,Bt))),128))])):(d(),c("div",Wt,[r(o(x),{variant:"outline",class:"w-full mb-3 justify-start overflow-hidden bg-background/50 hover:bg-background border-dashed",onClick:ce},{default:l(()=>[r(o(_t),{class:"h-4 w-4 mr-2"}),e[17]||(e[17]=m(" New Conversation ",-1))]),_:1}),i.historySessions.length===0?(d(),c("div",Ut,[r(o(ae),{class:"h-8 w-8 mb-3 opacity-20"}),e[18]||(e[18]=s("p",null,"No previous conversations",-1))])):y("",!0),(d(!0),c(A,null,Q(i.historySessions,t=>(d(),c("div",{key:t.id,onClick:n=>q.value!==t.id&&(De(t.id),N.value?_.value=!1:null),class:w(["p-3 rounded-lg cursor-pointer border transition-all text-left hover:border-primary/30 group relative",u.sessionId===t.id?"bg-primary/5 border-primary/50 shadow-sm":"bg-card border-transparent hover:bg-card/80"])},[q.value===t.id?(d(),c("div",{key:0,class:"flex items-center gap-1",onClick:e[5]||(e[5]=J(()=>{},["stop"]))},[Ge(s("input",{"onUpdate:modelValue":e[4]||(e[4]=n=>D.value=n),class:"flex-1 text-sm px-2 py-1 h-7 bg-background border border-primary/50 rounded focus:outline-none focus:ring-1 focus:ring-primary w-full",onKeydown:[Y(n=>ue(t.id),["enter"]),Y(H,["escape"])],autofocus:""},null,40,Ht),[[Qe,D.value]]),s("button",{onClick:n=>ue(t.id),class:"p-1 hover:bg-green-500/20 rounded text-green-500 shrink-0"},[r(o(wt),{class:"h-3.5 w-3.5"})],8,Kt),s("button",{onClick:H,class:"p-1 hover:bg-red-500/20 rounded text-red-500 shrink-0"},[r(o(kt),{class:"h-3.5 w-3.5"})])])):(d(),c("div",Xt,[s("div",Gt,[s("h3",{class:w(["text-sm font-medium line-clamp-1 break-all",u.sessionId===t.id?"text-primary":"text-foreground"])},k(t.title),3),u.sessionId===t.id||!N.value?(d(),c("div",Qt,[s("button",{onClick:J(n=>Me(t,n),["stop"]),class:"p-1.5 hover:bg-muted rounded text-muted-foreground hover:text-primary transition-colors"},[r(o(Ct),{class:"h-3 w-3"})],8,Yt),s("button",{onClick:J(n=>Pe(t.id),["stop"]),class:"p-1.5 hover:bg-red-500/10 rounded text-muted-foreground hover:text-red-500 transition-colors"},[r(o(Ce),{class:"h-3 w-3"})],8,Zt)])):y("",!0)]),s("div",es,[s("span",ts,[r(o(St),{class:"h-3 w-3 opacity-70"}),m(" "+k(t.message_count),1)]),s("span",null,k(t.date),1)])]))],10,qt))),128))]))]),_:1}),s("div",ss,[u.returnToSelection?(d(),F(o(x),{key:0,variant:"outline",class:"w-full justify-start overflow-hidden bg-background/50 hover:bg-background border-border/60 mb-2",onClick:Re},{default:l(()=>[r(o(Se),{class:"mr-2 h-4 w-4"}),e[19]||(e[19]=m(" Back to Topic Selection ",-1))]),_:1})):y("",!0),r(o(x),{variant:"ghost",class:"w-full justify-start text-muted-foreground hover:text-foreground",onClick:Ee},{default:l(()=>[r(o(Se),{class:"mr-2 h-4 w-4"}),e[20]||(e[20]=m(" Back to Library ",-1))]),_:1})])])],2),s("main",os,[s("header",rs,[s("div",is,[r(o(x),{variant:"ghost",size:"icon",class:"shrink-0 -ml-2",onClick:e[6]||(e[6]=t=>_.value=!_.value),title:_.value?"Close sidebar":"Open sidebar"},{default:l(()=>[(d(),F(xe(_.value?o(ke):o(lt)),{class:"h-5 w-5 text-muted-foreground"}))]),_:1},8,["title"]),s("div",ns,[s("div",as,[e[22]||(e[22]=s("h1",{class:"font-semibold text-foreground truncate text-sm md:text-base"}," Topic Laboratory ",-1)),r(o(_e),{variant:"secondary",class:"font-normal text-[10px] hidden sm:inline-flex bg-primary/10 text-primary border-transparent"},{default:l(()=>[...e[21]||(e[21]=[m(" AI Assistant ",-1)])]),_:1})]),s("span",ls,k(i.project.title),1)])]),s("div",ds,[r(o(Ye),null,{default:l(()=>[r(o(bt),null,{default:l(()=>[r(o(yt),{"as-child":""},{default:l(()=>[s("div",cs,[e[23]||(e[23]=s("span",{class:"text-[10px] font-medium uppercase tracking-wider text-muted-foreground"},"Credits",-1)),s("span",{class:w(["text-xs font-bold",o(Oe)?"text-primary":"text-red-500"])},k(o(Ne)),3)])]),_:1}),r(o(ht),null,{default:l(()=>[...e[24]||(e[24]=[s("p",null,"Your word balance",-1)])]),_:1})]),_:1})]),_:1}),r(o(x),{disabled:!g.value||T.value,onClick:We,class:"shadow-lg shadow-primary/20 h-9 px-4 text-xs md:text-sm"},{default:l(()=>[r(o(Te),{class:"h-4 w-4 mr-2"}),e[25]||(e[25]=s("span",{class:"hidden sm:inline"},"Select Topic",-1)),e[26]||(e[26]=s("span",{class:"sm:hidden"},"Select",-1))]),_:1},8,["disabled"])])]),s("div",{class:"flex-1 overflow-y-auto px-4 py-6 scroll-smooth w-full",ref_key:"chatContainer",ref:U},[s("div",us,[g.value?(d(),c("div",ps,[s("div",fs,[s("div",ms,[r(o(W),{class:"w-12 h-12 text-primary rotate-12"})]),s("div",vs,[s("div",gs,[r(o(W),{class:"h-5 w-5"})]),s("div",bs,[r(le,{content:g.value.title,as:"h3",class:"text-base md:text-lg font-bold text-foreground leading-tight"},null,8,["content"]),r(le,{content:g.value.description,as:"div",class:"text-xs md:text-sm text-muted-foreground leading-relaxed pl-3 border-l-2 border-primary/20"},null,8,["content"])])])])])):y("",!0),a.value.length?(d(!0),c(A,{key:1},Q(a.value,t=>(d(),c("div",{key:t.id,class:w(["flex gap-3 animate-in fade-in slide-in-from-bottom-2",t.role==="user"?"justify-end":"justify-start"])},[t.role==="assistant"?(d(),c("div",ys,[r(o(Tt),{class:"h-4 w-4 text-primary"})])):y("",!0),s("div",hs,[s("div",{class:w(["rounded-2xl px-4 md:px-5 py-3 shadow-sm text-sm leading-relaxed overflow-hidden break-words",t.role==="user"?"bg-primary text-primary-foreground rounded-tr-none":"bg-muted/50 border border-border/50 text-foreground rounded-tl-none"])},[t.isTyping?(d(),c("div",xs,[...e[27]||(e[27]=[s("span",{class:"w-1.5 h-1.5 bg-current rounded-full animate-bounce",style:{"animation-delay":"0ms"}},null,-1),s("span",{class:"w-1.5 h-1.5 bg-current rounded-full animate-bounce",style:{"animation-delay":"150ms"}},null,-1),s("span",{class:"w-1.5 h-1.5 bg-current rounded-full animate-bounce",style:{"animation-delay":"300ms"}},null,-1)])])):(d(),c("div",_s,[r(le,{content:Ue(t.content)},null,8,["content"]),t.role==="assistant"&&me(t.content).length>0?(d(),c("div",ws,[s("div",ks,[r(o(je),{class:"h-3 w-3"}),e[28]||(e[28]=m(" Suggested Topics ",-1))]),s("div",Cs,[(d(!0),c(A,null,Q(me(t.content),(n,f)=>(d(),c("button",{key:f,onClick:j=>Ae(n),class:"text-xs px-3 py-1.5 bg-background hover:bg-primary/10 text-primary border border-primary/20 hover:border-primary/50 rounded-full transition-all flex items-center gap-1.5 shadow-sm active:scale-95 text-left max-w-full"},[r(o($e),{class:"h-3 w-3 shrink-0"}),s("span",Ts,k(n),1)],8,Ss))),128))])])):y("",!0),t.role==="assistant"&&re(t.content)?(d(),c("div",$s,[s("div",js,[r(o(Te),{class:"h-3 w-3"}),e[29]||(e[29]=m(" Refined Topic ",-1))]),s("div",Is,[r(o(x),{size:"sm",variant:"outline",class:"h-8",onClick:n=>be(t.content,!1)},{default:l(()=>[...e[30]||(e[30]=[m(" Use refined topic ",-1)])]),_:2},1032,["onClick"]),r(o(x),{size:"sm",class:"h-8",onClick:n=>be(t.content,!0)},{default:l(()=>[...e[31]||(e[31]=[m(" Select refined topic ",-1)])]),_:2},1032,["onClick"])])])):y("",!0)]))],2),t.isTyping?y("",!0):(d(),c("div",{key:0,class:w(["flex items-center gap-1 opacity-0 group-hover:opacity-100 transition-opacity",t.role==="user"?"justify-end":"justify-start ml-1"])},[s("button",{onClick:n=>ze(t.content),class:"text-[10px] text-muted-foreground hover:text-foreground p-1 transition-colors",title:"Copy"}," Copy ",8,Ns),t.role==="assistant"&&t.id===a.value.filter(n=>n.role==="assistant"&&!n.isTyping).slice(-1)[0]?.id?(d(),c("button",{key:0,onClick:Ve,disabled:X.value||T.value,class:"text-[10px] text-muted-foreground hover:text-foreground p-1 transition-colors flex items-center gap-1 disabled:opacity-50",title:"Regenerate"}," Regenerate ",8,Os)):y("",!0)],2))]),t.role==="user"?(d(),c("div",Ds,[r(o($t),{class:"h-4 w-4 text-muted-foreground"})])):y("",!0)],2))),128)):y("",!0)])],512),s("div",Es,[s("div",Rs,[s("div",Fs,[r(o(we),{modelValue:I.value,"onUpdate:modelValue":e[7]||(e[7]=t=>I.value=t),placeholder:"Refine this topic, ask about methodologies, or check feasibility...",class:"min-h-[3rem] md:min-h-[3.5rem] max-h-32 pr-12 pl-4 py-3 bg-muted/40 hover:bg-muted/60 focus:bg-background focus:ring-1 focus:ring-primary/50 resize-none rounded-xl border-border/50 shadow-sm transition-all",onKeydown:[Y(J(pe,["exact","prevent"]),["enter"]),e[8]||(e[8]=Y(J(t=>I.value+=`
`,["shift","prevent"]),["enter"]))]},null,8,["modelValue","onKeydown"]),T.value?(d(),F(o(x),{key:0,class:"absolute right-2 bottom-2 h-8 w-8 rounded-lg bg-red-500 hover:bg-red-600 shadow-sm transition-transform hover:scale-105",size:"icon",onClick:Be,title:"Stop"},{default:l(()=>[r(o(Nt),{class:"h-4 w-4 fill-current text-white"})]),_:1})):(d(),F(o(x),{key:1,class:"absolute right-2 bottom-2 h-8 w-8 rounded-lg shadow-sm transition-transform hover:scale-105",size:"icon",disabled:!I.value.trim()||!g.value,onClick:pe},{default:l(()=>[r(o(It),{class:"h-4 w-4"})]),_:1},8,["disabled"]))]),e[32]||(e[32]=s("p",{class:"text-center text-[10px] text-muted-foreground/70 select-none"}," AI may display inaccurate info. ",-1))])])])])]),_:1}),r(o(it),{open:L.value,"onUpdate:open":e[12]||(e[12]=t=>L.value=t)},{default:l(()=>[r(o(st),{class:"sm:max-w-[500px] gap-6"},{default:l(()=>[r(o(ot),null,{default:l(()=>[r(o(rt),{class:"flex items-center gap-2"},{default:l(()=>[s("div",Ms,[r(o(je),{class:"h-5 w-5 text-primary"})]),e[33]||(e[33]=m(" Save Refined Topic ",-1))]),_:1}),r(o(nt),null,{default:l(()=>[...e[34]||(e[34]=[m(" Save this topic to your project's library. ",-1)])]),_:1})]),_:1}),s("div",Ps,[s("div",Ls,[e[35]||(e[35]=s("label",{class:"text-sm font-medium"},"Title",-1)),r(o(et),{modelValue:C.value.title,"onUpdate:modelValue":e[9]||(e[9]=t=>C.value.title=t),placeholder:"Topic title...",class:"w-full"},null,8,["modelValue"])]),s("div",zs,[e[36]||(e[36]=s("label",{class:"text-sm font-medium"},"Description",-1)),r(o(we),{modelValue:C.value.description,"onUpdate:modelValue":e[10]||(e[10]=t=>C.value.description=t),placeholder:"Optional description...",class:"resize-none",rows:"4"},null,8,["modelValue"])])]),r(o(at),null,{default:l(()=>[r(o(x),{variant:"outline",onClick:e[11]||(e[11]=t=>L.value=!1)},{default:l(()=>[...e[37]||(e[37]=[m("Cancel",-1)])]),_:1}),r(o(x),{onClick:Je,disabled:!C.value.title.trim()||G.value},{default:l(()=>[r(o($e),{class:"h-4 w-4 mr-2"}),m(" "+k(G.value?"Saving...":"Save"),1)]),_:1},8,["disabled"])]),_:1})]),_:1})]),_:1},8,["open"]),r(o(gt),{open:se.value,"onUpdate:open":e[13]||(e[13]=t=>{t||oe()})},{default:l(()=>[r(o(dt),null,{default:l(()=>[r(o(ct),null,{default:l(()=>[r(o(ut),{class:"flex items-center gap-2 text-destructive"},{default:l(()=>[r(o(Ce),{class:"h-5 w-5"}),e[38]||(e[38]=m(" Delete Conversation ",-1))]),_:1}),r(o(pt),null,{default:l(()=>[...e[39]||(e[39]=[m(" Permanent action. Cannot be undone. ",-1)])]),_:1})]),_:1}),r(o(ft),null,{default:l(()=>[r(o(mt),{onClick:oe},{default:l(()=>[...e[40]||(e[40]=[m("Cancel",-1)])]),_:1}),r(o(vt),{onClick:Le,class:"bg-destructive hover:bg-destructive/90 text-destructive-foreground"},{default:l(()=>[...e[41]||(e[41]=[m(" Delete ",-1)])]),_:1})]),_:1})]),_:1})]),_:1},8,["open"])],64))}}),Eo=jt(Vs,[["__scopeId","data-v-569fba90"]]);export{Eo as default};
