import{d as ke,r as w,p as Y,y as Ue,c as m,o as n,F as U,a as y,g,e as a,b as s,u as e,bQ as W,w as r,h as p,t as i,aa as Pe,aM as ae,a0 as Z,n as P,f as R,a4 as me,a_ as fe,a1 as M,S as ve,s as K,T as xe,bR as he,bo as _e,a7 as oe,bS as Ae,bh as V,aI as f,aD as Q,aE as X,bT as ge,j as ze,a6 as re,ay as ye,bU as Re}from"./vendor-Bd-YbXdQ.js";import{_ as A}from"./index-CPLcYuC3.js";import{_ as x}from"./index-DhgXNBxs.js";import{_ as $e,a as je}from"./CardContent.vue_vue_type_script_setup_true_lang-BpnkKGTV.js";import{_ as Le,a as Te}from"./CardTitle.vue_vue_type_script_setup_true_lang-D5t81t7T.js";import{_ as Ie,a as Oe,b as He}from"./CollapsibleTrigger.vue_vue_type_script_setup_true_lang-NWNti-QO.js";import{_ as be}from"./Input.vue_vue_type_script_setup_true_lang-Bhu57pIq.js";import{_ as le}from"./ScrollArea.vue_vue_type_script_setup_true_lang-lhCXI5ih.js";import{_ as H}from"./Separator.vue_vue_type_script_setup_true_lang-CS0WyLW5.js";import{_ as Me,a as Ne,b as Ve,c as Ge,d as Be,e as qe,f as Je,g as We}from"./AlertDialogTitle.vue_vue_type_script_setup_true_lang-dmYoWzKa.js";import{_ as Ke}from"./Checkbox.vue_vue_type_script_setup_true_lang-XdGS0DyO.js";import{_ as Qe,a as Xe}from"./DialogContent.vue_vue_type_script_setup_true_lang-B0_mTwB9.js";import{_ as Ye}from"./DialogDescription.vue_vue_type_script_setup_true_lang-o698b8xn.js";import{_ as Ze}from"./DialogFooter.vue_vue_type_script_setup_true_lang-CWpuYIJK.js";import{_ as et,a as tt}from"./DialogTitle.vue_vue_type_script_setup_true_lang-DzEVjang.js";import{_ as st,a as at,b as ot,e as we,c as Ce,f as rt}from"./Sonner.vue_vue_type_script_setup_true_lang-aZGMRizj.js";import{s as ne}from"./useAppearance-Y8PyvRNY.js";const nt={key:0,class:"sticky top-0 z-10 bg-background border-b border-border/60"},lt={class:"flex items-center justify-between p-4"},it={class:"flex items-center gap-3"},dt={key:1,class:"p-6 space-y-4"},ct={class:"space-y-2"},ut={class:"flex items-center gap-2"},pt={key:0,class:"space-y-2 pl-6"},mt={class:"flex gap-2"},ft={class:"text-xs text-muted-foreground"},vt={class:"space-y-2"},xt={class:"flex items-center gap-2"},ht={key:0,class:"pl-6"},_t={class:"flex gap-2"},gt={class:"space-y-4"},yt={class:"text-sm font-semibold text-foreground flex items-center gap-2"},bt={class:"font-medium"},wt={key:0,class:"space-y-3 mt-4"},Ct={class:"flex items-center justify-between"},kt={class:"text-sm font-medium text-amber-600 dark:text-amber-400 flex items-center gap-2"},$t={class:"flex gap-4 max-h-[500px]"},jt={class:"w-1/2 overflow-y-auto pr-2 custom-scrollbar space-y-2"},St=["onClick"],Ft={class:"text-sm font-medium text-foreground leading-snug line-clamp-3"},Dt={class:"flex items-center gap-2 mt-2"},Et={key:0,class:"text-xs text-muted-foreground"},Ut={class:"w-1/2 overflow-y-auto pl-2 custom-scrollbar"},Pt={key:0,class:"space-y-3"},At={class:"text-xs text-muted-foreground mb-2"},zt={class:"text-sm font-medium text-foreground leading-snug"},Rt={class:"text-xs text-muted-foreground"},Lt={class:"flex items-center gap-2"},Tt={key:0,class:"text-xs text-muted-foreground"},It={class:"flex gap-2 mt-2"},Ot={key:0,class:"text-sm text-muted-foreground text-center py-4"},Ht={key:1,class:"flex items-center justify-center h-full text-muted-foreground"},Mt={class:"text-center py-8"},Nt={key:1,class:"text-center py-6"},Vt={key:0,class:"space-y-3"},Gt={class:"flex items-center justify-between"},Bt={class:"text-sm font-semibold text-foreground flex items-center gap-2"},qt={class:"space-y-2 max-h-[200px] overflow-y-auto pr-2 custom-scrollbar"},Jt=["onClick"],Wt={class:"text-sm font-medium text-foreground truncate"},Kt={class:"text-xs text-muted-foreground"},Qt={class:"flex items-center gap-2"},Xt={class:"flex items-center gap-1"},Yt={class:"rounded-lg bg-gradient-to-r from-amber-50 to-indigo-50 dark:from-amber-950/20 dark:to-indigo-950/20 border border-amber-200/50 dark:border-amber-800/50 p-3"},Zt={class:"flex items-start gap-2"},es={class:"space-y-3"},ts={class:"space-y-2"},ss={class:"text-xs font-medium text-muted-foreground flex items-center gap-1"},as={class:"flex gap-1"},os={class:"rounded-lg bg-muted/30 p-2"},rs={class:"text-xs font-medium text-foreground mb-1"},ns={class:"text-xs text-muted-foreground mb-2"},ls={class:"text-xs text-muted-foreground font-mono bg-background p-2 rounded border"},is={class:"space-y-3"},ds={class:"text-xs font-medium text-muted-foreground flex items-center gap-1"},cs={class:"flex gap-2"},us={class:"space-y-3"},ps={class:"flex items-center justify-between"},ms={class:"text-xs font-medium text-muted-foreground flex items-center gap-1"},fs={class:"text-xs font-medium"},vs={key:0,class:"space-y-2 mt-3"},xs={class:"flex items-center justify-between"},hs={class:"text-xs font-medium text-amber-600 dark:text-amber-400 flex items-center gap-1"},_s={class:"space-y-2 pr-2"},gs=["onClick"],ys={class:"flex items-start gap-2"},bs={class:"flex-1 min-w-0"},ws={class:"text-xs font-medium text-foreground line-clamp-2"},Cs={class:"text-[10px] text-muted-foreground mt-1"},ks={class:"flex items-center gap-2 mt-1"},$s={class:"text-[10px] text-muted-foreground"},js={key:0,class:"border-t bg-muted/10 p-3 space-y-2"},Ss={class:"text-xs font-medium text-foreground line-clamp-2"},Fs={class:"text-[10px] text-muted-foreground"},Ds={class:"flex items-center gap-2 mt-1"},Es={key:0,class:"text-[9px] text-muted-foreground"},Us={class:"flex gap-1 mt-2"},Ps={key:1,class:"border-t bg-muted/10 p-3"},As={class:"text-xs text-muted-foreground text-center py-2"},zs={class:"font-medium"},Rs={key:1,class:"text-center py-4"},Ls={key:0,class:"space-y-3"},Ts={class:"flex items-center justify-between"},Is={class:"text-xs font-medium text-muted-foreground flex items-center gap-1"},Os={class:"space-y-2 pr-2"},Hs=["onClick"],Ms={class:"flex items-start justify-between gap-2"},Ns={class:"flex-1 min-w-0"},Vs={class:"text-xs font-medium text-foreground truncate"},Gs={class:"text-xs text-muted-foreground mt-1"},Bs={class:"flex items-center gap-2 mt-1"},qs={class:"text-xs text-muted-foreground"},Js={class:"flex items-center gap-1 opacity-0 group-hover:opacity-100 transition-opacity"},Ws={key:0,class:"mt-3 pt-3 border-t"},Ks={class:"bg-muted/30 rounded p-2"},Qs={class:"text-xs font-medium text-foreground mb-1"},Xs={class:"text-xs text-muted-foreground font-mono leading-relaxed"},Ys={class:"flex gap-2 mt-3"},Zs={key:1,class:"py-8 text-center"},Da=ke({__name:"CitationHelper",props:{showCitationHelper:{type:Boolean},chapterContent:{},chapterId:{},citationOperationMode:{type:Boolean,default:!1}},emits:["update:showCitationHelper","insert-citation","enter-operation-mode","exit-operation-mode"],setup(N,{emit:j}){const h=N,v=j,b=w("apa"),S=w(""),D=w(!1),z=w(!1),L=w(!1),k=w([]),O=w(null),E=w(!1),G=w(!1),c=w([]),l=w(!1),u=w(null),F=w(null),$=w(!0),C=w(!0),T=async()=>{if(h.chapterId){G.value=!0;try{const d=await V.get("/api/citations/detected-claims",{params:{chapter_id:h.chapterId}});d.data.success&&d.data.has_detection&&(c.value=d.data.claims||[],F.value=d.data.detected_at,l.value=c.value.length>0)}catch(d){console.error("Failed to load saved detections:",d)}finally{G.value=!1}}},I=async()=>{if(!h.chapterContent||h.chapterContent.trim().length<100){f.error("Please add more content before detecting citations (minimum 100 characters)");return}if(!h.chapterId){f.error("Chapter ID is required for detection");return}E.value=!0,c.value=[],l.value=!0;try{const d=await V.post("/api/citations/detect-claims",{content:h.chapterContent,chapter_id:h.chapterId});d.data.success?(c.value=d.data.claims||[],F.value=d.data.detected_at,c.value.length===0?f.info("No claims requiring citations were detected"):f.success(`Found ${c.value.length} claims that may need citations`)):f.error("Failed to detect claims")}catch(d){console.error("Failed to detect claims:",d),f.error("Failed to analyze content for citations")}finally{E.value=!1}},ee=d=>{u.value=u.value===d?null:d},ie=(d,t)=>{const o=d.style[b.value];v("insert-citation",o,t),f.success("Citation inserted into document")},de=d=>{const t=d.style[b.value];navigator.clipboard.writeText(t),f.success("Citation copied to clipboard")},ce=d=>{d&&window.open(d,"_blank")},te={apa:{name:"APA Style",description:"American Psychological Association",example:"Smith, J. (2023). Research methods. Journal of Science, 15(3), 123-145."},harvard:{name:"Harvard Style",description:"Author-date referencing system",example:'Smith, J. (2023) "Research methods", Journal of Science, 15(3), pp. 123-145.'},ieee:{name:"IEEE Style",description:"Institute of Electrical and Electronics Engineers",example:'J. Smith, "Research methods," Journal of Science, vol. 15, no. 3, pp. 123-145, 2023.'}},B=Y(()=>te[b.value]),Se=d=>{v("update:showCitationHelper",d)},Fe=d=>{O.value=O.value===d?null:d},q=async()=>{if(!S.value.trim()){f.error("Please enter a URL, DOI, or search term");return}D.value=!0;try{const d=await V.post("/api/citations/generate",{input:S.value.trim()});if(d.data.success){const t=d.data.citation,o={id:t.id.toString(),title:t.title,authors:t.authors,year:t.year,journal:t.journal,url:t.url,doi:t.doi,type:t.type,style:{apa:t.style.apa,harvard:t.style.harvard,ieee:t.style.ieee},createdAt:new Date(t.created_at)};k.value.unshift(o),S.value="",f.success("Citation generated successfully!")}else f.error("Failed to generate citation")}catch(d){console.error("Failed to search citation:",d),d.response?.status===422?f.error("Invalid input format"):f.error("Failed to generate citation")}finally{D.value=!1}},se=d=>{const t=d.style[b.value];v("insert-citation",t),f.success("Citation inserted into document")},ue=d=>{const t=d.style[b.value];navigator.clipboard.writeText(t),f.success("Citation copied to clipboard")},pe=()=>{if(!k.value.length){f.error("No citations to clear");return}L.value=!0},De=async()=>{z.value=!0,L.value=!1;try{(await V.delete("/api/citations/clear")).data.success?(k.value=[],O.value=null,f.success("All citations cleared successfully")):f.error("Failed to clear citations")}catch(d){console.error("Failed to clear citations:",d),f.error("Failed to clear citations")}finally{z.value=!1}},Ee=async()=>{try{const d=await V.get("/api/citations/recent",{params:{limit:10}});d.data.success&&(k.value=d.data.citations.map(t=>({id:t.id.toString(),title:t.title,authors:t.authors,year:t.year,journal:t.journal,url:t.url,doi:t.doi,type:t.type,style:{apa:t.style.apa,harvard:t.style.harvard,ieee:t.style.ieee},createdAt:new Date(t.created_at)})))}catch(d){console.error("Failed to load recent citations:",d)}};return Ue(()=>{Ee(),T()}),(d,t)=>(n(),m(U,null,[d.citationOperationMode?(n(),m("div",nt,[s("div",lt,[s("div",it,[a(e(W),{class:"h-5 w-5 text-primary"}),t[10]||(t[10]=s("h2",{class:"text-lg font-semibold text-foreground"},"Citation Helper",-1)),a(e(A),{variant:"secondary",class:"ml-1"},{default:r(()=>[p(i(b.value.toUpperCase()),1)]),_:1})]),a(e(x),{onClick:t[0]||(t[0]=o=>v("exit-operation-mode")),variant:"ghost",size:"sm",class:"gap-2 text-muted-foreground hover:text-foreground"},{default:r(()=>[a(e(Pe),{class:"h-4 w-4"}),t[11]||(t[11]=p(" Close ",-1))]),_:1})])])):y("",!0),d.citationOperationMode?(n(),m("div",dt,[s("div",ct,[s("button",{onClick:t[1]||(t[1]=o=>$.value=!$.value),class:"w-full flex items-center justify-between text-sm font-semibold text-foreground hover:text-primary transition-colors"},[s("span",ut,[a(e(ae),{class:"h-4 w-4"}),t[12]||(t[12]=p(" Citation Style ",-1)),a(e(A),{variant:"outline",class:"text-xs"},{default:r(()=>[p(i(b.value.toUpperCase()),1)]),_:1})]),a(e(Z),{class:P(["h-4 w-4 transition-transform",$.value?"rotate-180":""])},null,8,["class"])]),$.value?(n(),m("div",pt,[s("div",mt,[(n(!0),m(U,null,R(Object.keys(te),o=>(n(),g(e(x),{key:o,onClick:_=>b.value=o,variant:b.value===o?"default":"outline",size:"sm",class:"flex-1"},{default:r(()=>[p(i(o.toUpperCase()),1)]),_:2},1032,["onClick","variant"]))),128))]),s("p",ft,i(B.value.description),1)])):y("",!0)]),a(e(H)),s("div",vt,[s("button",{onClick:t[2]||(t[2]=o=>C.value=!C.value),class:"w-full flex items-center justify-between text-sm font-semibold text-foreground hover:text-primary transition-colors"},[s("span",xt,[a(e(me),{class:"h-4 w-4"}),t[13]||(t[13]=p(" Generate Citation ",-1))]),a(e(Z),{class:P(["h-4 w-4 transition-transform",C.value?"rotate-180":""])},null,8,["class"])]),C.value?(n(),m("div",ht,[s("div",_t,[a(e(be),{modelValue:S.value,"onUpdate:modelValue":t[3]||(t[3]=o=>S.value=o),placeholder:"URL, DOI, or search...",class:"flex-1",onKeyup:fe(q,["enter"]),disabled:D.value},null,8,["modelValue","disabled"]),a(e(x),{onClick:q,disabled:D.value||!S.value.trim(),size:"sm"},{default:r(()=>[D.value?(n(),g(e(M),{key:0,class:"h-4 w-4 animate-spin"})):(n(),g(e(ve),{key:1,class:"h-4 w-4"}))]),_:1},8,["disabled"])])])):y("",!0)]),a(e(H)),s("div",gt,[s("h3",yt,[a(e(K),{class:"h-4 w-4 text-purple-500"}),t[14]||(t[14]=p(" Auto-Detect Citations ",-1))]),a(e(x),{onClick:I,disabled:E.value,class:"w-full gap-2 h-12 text-base bg-gradient-to-r from-purple-500 to-indigo-500 hover:from-purple-600 hover:to-indigo-600 text-white"},{default:r(()=>[E.value?(n(),g(e(M),{key:0,class:"h-5 w-5 animate-spin"})):(n(),g(e(K),{key:1,class:"h-5 w-5"})),s("span",bt,i(E.value?"Scanning content for claims...":"Scan for Missing Citations"),1)]),_:1},8,["disabled"]),t[20]||(t[20]=s("p",{class:"text-sm text-muted-foreground"}," ðŸ” AI analyzes your chapter content to find claims that need academic references, then searches multiple databases for relevant papers. ",-1)),l.value&&c.value.length>0?(n(),m("div",wt,[s("div",Ct,[s("span",kt,[a(e(xe),{class:"h-4 w-4"}),p(" "+i(c.value.length)+" claims need citations ",1)]),a(e(x),{variant:"outline",size:"sm",onClick:t[4]||(t[4]=o=>{l.value=!1,c.value=[]})},{default:r(()=>[...t[15]||(t[15]=[p(" Clear Results ",-1)])]),_:1})]),s("div",$t,[s("div",jt,[(n(!0),m(U,null,R(c.value,o=>(n(),m("div",{key:o.id,onClick:_=>u.value=u.value===o.id?null:o.id,class:P(["rounded-lg border p-3 cursor-pointer transition-all",u.value===o.id?"bg-primary/10 border-primary":"bg-card hover:bg-muted/50 border-border"])},[s("p",Ft,' "'+i(o.text)+'" ',1),s("div",Dt,[a(e(A),{variant:"outline",class:P([o.confidence>.8?"border-red-300 text-red-600":o.confidence>.6?"border-amber-300 text-amber-600":"border-gray-300 text-gray-600","text-xs"])},{default:r(()=>[p(i(Math.round(o.confidence*100))+"% ",1)]),_:2},1032,["class"]),o.suggestions?.length?(n(),m("span",Et,i(o.suggestions.length)+" suggestions ",1)):y("",!0)])],10,St))),128))]),s("div",Ut,[u.value&&c.value.find(o=>o.id===u.value)?(n(),m("div",Pt,[s("div",At,i(c.value.find(o=>o.id===u.value)?.reason),1),t[17]||(t[17]=s("p",{class:"text-xs font-medium text-foreground"},"Suggested Citations:",-1)),(n(!0),m(U,null,R(c.value.find(o=>o.id===u.value)?.suggestions,o=>(n(),m("div",{key:o.id,class:"rounded-lg border bg-card p-3 space-y-2"},[s("p",zt,i(o.title),1),s("p",Rt,i(o.authors?.join(", "))+" ("+i(o.year)+") ",1),s("div",Lt,[a(e(A),{variant:"secondary",class:"text-xs"},{default:r(()=>[p(i(o.source),1)]),_:2},1024),o.citation_count?(n(),m("span",Tt,i(o.citation_count)+" citations ",1)):y("",!0)]),s("div",It,[a(e(x),{onClick:_=>ie(o,c.value.find(J=>J.id===u.value)?.text),size:"sm",class:"flex-1"},{default:r(()=>[a(e(Q),{class:"h-4 w-4 mr-1"}),t[16]||(t[16]=p(" Insert ",-1))]),_:2},1032,["onClick"]),a(e(x),{onClick:_=>de(o),size:"sm",variant:"outline"},{default:r(()=>[a(e(X),{class:"h-4 w-4"})]),_:2},1032,["onClick"]),o.url?(n(),g(e(x),{key:0,onClick:_=>ce(o.url),size:"sm",variant:"outline"},{default:r(()=>[a(e(ge),{class:"h-4 w-4"})]),_:2},1032,["onClick"])):y("",!0)])]))),128)),c.value.find(o=>o.id===u.value)?.suggestions?.length?y("",!0):(n(),m("div",Ot," No matching papers found. Try manual search. "))])):(n(),m("div",Ht,[s("div",Mt,[a(e(W),{class:"h-8 w-8 mx-auto mb-2 opacity-30"}),t[18]||(t[18]=s("p",{class:"text-sm"},"Select a claim to view suggestions",-1))])]))])])])):l.value&&c.value.length===0&&!E.value?(n(),m("div",Nt,[...t[19]||(t[19]=[s("p",{class:"text-sm text-green-600 dark:text-green-400"}," âœ… No claims requiring citations were detected in your content! ",-1)])])):y("",!0)]),a(e(H)),k.value.length?(n(),m("div",Vt,[s("div",Gt,[s("h3",Bt,[a(e(he),{class:"h-4 w-4"}),p(" Recent Citations ("+i(k.value.length)+") ",1)]),a(e(x),{onClick:pe,disabled:z.value,variant:"ghost",size:"sm"},{default:r(()=>[z.value?(n(),g(e(M),{key:0,class:"h-4 w-4 animate-spin"})):(n(),g(e(_e),{key:1,class:"h-4 w-4 mr-1"})),t[21]||(t[21]=p(" Clear All ",-1))]),_:1},8,["disabled"])]),s("div",qt,[(n(!0),m(U,null,R(k.value,o=>(n(),m("div",{key:o.id,class:"rounded border bg-muted/30 p-3 cursor-pointer hover:bg-muted/50 transition-colors",onClick:_=>se(o)},[s("p",Wt,i(o.title),1),s("p",Kt,i(o.authors.join(", "))+" ("+i(o.year)+") ",1)],8,Jt))),128))])])):y("",!0)])):y("",!0),d.citationOperationMode?y("",!0):(n(),g(e($e),{key:2,class:"border border-border/60 shadow-sm dark:border-border/50 dark:shadow-none transition-all duration-300 hover:shadow-md"},{default:r(()=>[a(e(Ie),{open:d.showCitationHelper,"onUpdate:open":Se},{default:r(()=>[a(e(Oe),{class:"w-full"},{default:r(()=>[a(e(Le),{class:"pb-3 transition-colors bg-muted/40 hover:bg-muted/60 dark:bg-transparent dark:hover:bg-muted/30"},{default:r(()=>[a(e(Te),{class:"flex items-center justify-between text-sm"},{default:r(()=>[s("span",Qt,[a(e(W),{class:"h-4 w-4 text-muted-foreground"}),t[22]||(t[22]=p(" Citation Helper ",-1)),a(e(A),{variant:"secondary",class:"ml-1 text-xs"},{default:r(()=>[p(i(b.value.toUpperCase()),1)]),_:1})]),s("div",Xt,[d.showCitationHelper?(n(),g(e(x),{key:0,onClick:t[5]||(t[5]=oe(o=>v("enter-operation-mode"),["stop"])),variant:"ghost",size:"icon",class:"h-6 w-6 text-muted-foreground hover:text-primary",title:"Expand to Split View"},{default:r(()=>[a(e(Ae),{class:"h-3 w-3"})]),_:1})):y("",!0),a(e(Z),{class:P(["h-4 w-4 text-muted-foreground transition-transform",d.showCitationHelper?"rotate-180":""])},null,8,["class"])])]),_:1})]),_:1})]),_:1}),a(e(He),null,{default:r(()=>[a(e(je),{class:"space-y-4 pt-0"},{default:r(()=>[s("div",Yt,[s("div",Zt,[a(e(ae),{class:"h-4 w-4 text-amber-600 dark:text-amber-400 mt-0.5 flex-shrink-0"}),t[23]||(t[23]=s("div",{class:"text-xs leading-relaxed"},[s("p",{class:"font-medium text-amber-900 dark:text-amber-100 mb-1"},"Smart Citation Assistant "),s("p",{class:"text-amber-700 dark:text-amber-300"},"Automatically formats citations in your preferred academic style."),s("p",{class:"mt-1 text-amber-600 dark:text-amber-400"},"ðŸ’¡ Click citations to insert them directly into your document.")],-1))])]),s("div",es,[s("div",ts,[s("h4",ss,[a(e(ae),{class:"h-3 w-3"}),t[24]||(t[24]=p(" Citation Style ",-1))]),s("div",as,[(n(!0),m(U,null,R(Object.keys(te),o=>(n(),g(e(x),{key:o,onClick:_=>b.value=o,variant:b.value===o?"default":"outline",size:"sm",class:"text-xs flex-1"},{default:r(()=>[p(i(o.toUpperCase()),1)]),_:2},1032,["onClick","variant"]))),128))])]),s("div",os,[s("p",rs,i(B.value.name),1),s("p",ns,i(B.value.description),1),s("p",ls,i(B.value.example),1)])]),a(e(H)),s("div",is,[s("h4",ds,[a(e(me),{class:"h-3 w-3"}),t[25]||(t[25]=p(" Generate Citation ",-1))]),s("div",cs,[a(e(be),{modelValue:S.value,"onUpdate:modelValue":t[6]||(t[6]=o=>S.value=o),placeholder:"Enter URL, DOI, or search term...",class:"text-xs",onKeyup:fe(q,["enter"]),disabled:D.value},null,8,["modelValue","disabled"]),a(e(x),{onClick:q,size:"sm",disabled:D.value||!S.value.trim()},{default:r(()=>[D.value?(n(),g(e(M),{key:0,class:"h-3 w-3 animate-spin"})):(n(),g(e(ve),{key:1,class:"h-3 w-3"}))]),_:1},8,["disabled"])]),t[26]||(t[26]=s("p",{class:"text-xs text-muted-foreground"}," ðŸ’¡ Paste a journal URL, DOI, or search for papers by keywords ",-1))]),a(e(H)),s("div",us,[s("div",ps,[s("h4",ms,[a(e(K),{class:"h-3 w-3"}),t[27]||(t[27]=p(" Auto-Detect Citations ",-1))])]),a(e(x),{onClick:I,disabled:E.value,variant:"outline",class:"w-full gap-2 bg-gradient-to-r from-purple-500/10 to-indigo-500/10 border-purple-200/50 dark:border-purple-800/50 hover:from-purple-500/20 hover:to-indigo-500/20"},{default:r(()=>[E.value?(n(),g(e(M),{key:0,class:"h-4 w-4 animate-spin"})):(n(),g(e(K),{key:1,class:"h-4 w-4 text-purple-500"})),s("span",fs,i(E.value?"Scanning content...":"Scan for Missing Citations"),1)]),_:1},8,["disabled"]),t[33]||(t[33]=s("p",{class:"text-xs text-muted-foreground"}," ðŸ” AI analyzes your content to find claims that need academic references ",-1)),l.value&&c.value.length>0?(n(),m("div",vs,[s("div",xs,[s("span",hs,[a(e(xe),{class:"h-3 w-3"}),p(" "+i(c.value.length)+" claims need citations ",1)]),a(e(x),{variant:"ghost",size:"sm",class:"h-6 text-xs",onClick:t[7]||(t[7]=o=>{l.value=!1,c.value=[]})},{default:r(()=>[...t[28]||(t[28]=[p(" Clear ",-1)])]),_:1})]),a(e(le),{class:"h-[280px]"},{default:r(()=>[s("div",_s,[(n(!0),m(U,null,R(c.value,o=>(n(),m("div",{key:o.id,class:"rounded-lg border bg-background overflow-hidden"},[s("div",{onClick:_=>ee(o.id),class:P(["cursor-pointer p-3 hover:bg-muted/30 transition-colors",u.value===o.id?"bg-muted/20":""])},[s("div",ys,[a(e(ze),{class:P(["h-4 w-4 mt-0.5 text-muted-foreground transition-transform flex-shrink-0",u.value===o.id?"rotate-90":""])},null,8,["class"]),s("div",bs,[s("p",ws,' "'+i(o.text)+'" ',1),s("p",Cs,i(o.reason),1),s("div",ks,[a(e(A),{variant:"outline",class:P(["text-[10px] h-4",o.confidence>.8?"border-red-300 text-red-600":o.confidence>.6?"border-amber-300 text-amber-600":"border-gray-300 text-gray-600"])},{default:r(()=>[p(i(Math.round(o.confidence*100))+"% confidence ",1)]),_:2},1032,["class"]),s("span",$s,i(o.suggestions?.length||0)+" suggestions ",1)])])])],10,gs),u.value===o.id&&o.suggestions?.length>0?(n(),m("div",js,[t[30]||(t[30]=s("p",{class:"text-[10px] font-medium text-muted-foreground mb-2"}," Suggested Citations: ",-1)),(n(!0),m(U,null,R(o.suggestions,_=>(n(),m("div",{key:_.id,class:"rounded border bg-background p-2 space-y-1"},[s("p",Ss,i(_.title),1),s("p",Fs,i(_.authors?.join(", "))+" ("+i(_.year)+") ",1),s("div",Ds,[a(e(A),{variant:"secondary",class:"text-[9px] h-4"},{default:r(()=>[p(i(_.source),1)]),_:2},1024),_.citation_count?(n(),m("span",Es,i(_.citation_count)+" citations ",1)):y("",!0)]),s("div",Us,[a(e(x),{onClick:J=>ie(_,o.text),size:"sm",class:"flex-1 h-7 text-xs"},{default:r(()=>[a(e(Q),{class:"h-3 w-3 mr-1"}),t[29]||(t[29]=p(" Insert ",-1))]),_:2},1032,["onClick"]),a(e(x),{onClick:J=>de(_),size:"sm",variant:"outline",class:"h-7 text-xs"},{default:r(()=>[a(e(X),{class:"h-3 w-3"})]),_:2},1032,["onClick"]),_.url?(n(),g(e(x),{key:0,onClick:J=>ce(_.url),size:"sm",variant:"outline",class:"h-7 text-xs"},{default:r(()=>[a(e(ge),{class:"h-3 w-3"})]),_:2},1032,["onClick"])):y("",!0)])]))),128))])):y("",!0),u.value===o.id&&(!o.suggestions||o.suggestions.length===0)?(n(),m("div",Ps,[s("p",As,[t[31]||(t[31]=p(" No suggestions found. Try searching manually with keywords: ",-1)),s("span",zs,i(o.search_keywords?.join(", ")),1)])])):y("",!0)]))),128))])]),_:1})])):l.value&&c.value.length===0&&!E.value?(n(),m("div",Rs,[...t[32]||(t[32]=[s("p",{class:"text-xs text-green-600 dark:text-green-400"}," âœ… No claims requiring citations were detected! ",-1)])])):y("",!0)]),k.value.length?(n(),m("div",Ls,[a(e(H)),s("div",Ts,[s("h4",Is,[a(e(he),{class:"h-3 w-3"}),p(" Recent Citations ("+i(k.value.length)+") ",1)]),a(e(x),{onClick:pe,disabled:z.value,variant:"ghost",size:"icon",class:"h-6 w-6 hover:bg-destructive/10 hover:text-destructive"},{default:r(()=>[z.value?(n(),g(e(M),{key:0,class:"h-3 w-3 animate-spin"})):(n(),g(e(_e),{key:1,class:"h-3 w-3"}))]),_:1},8,["disabled"])]),a(e(le),{class:"h-[300px]"},{default:r(()=>[s("div",Os,[(n(!0),m(U,null,R(k.value,o=>(n(),m("div",{key:o.id,class:"group"},[s("div",{onClick:_=>Fe(o.id),class:P(["cursor-pointer rounded-lg border bg-background p-3 hover:bg-muted/30 transition-colors",O.value===o.id?"ring-2 ring-primary":""])},[s("div",Ms,[s("div",Ns,[s("p",Vs,i(o.title),1),s("p",Gs,i(o.authors.join(", "))+" ("+i(o.year)+") ",1),s("div",Bs,[a(e(A),{variant:"outline",class:"text-xs"},{default:r(()=>[p(i(o.type),1)]),_:2},1024),s("span",qs,i(o.createdAt.toLocaleDateString()),1)])]),s("div",Js,[a(e(x),{onClick:oe(_=>se(o),["stop"]),variant:"ghost",size:"icon",class:"h-6 w-6"},{default:r(()=>[a(e(Q),{class:"h-3 w-3"})]),_:2},1032,["onClick"]),a(e(x),{onClick:oe(_=>ue(o),["stop"]),variant:"ghost",size:"icon",class:"h-6 w-6"},{default:r(()=>[a(e(X),{class:"h-3 w-3"})]),_:2},1032,["onClick"])])]),O.value===o.id?(n(),m("div",Ws,[s("div",Ks,[s("p",Qs,i(b.value.toUpperCase())+" Format: ",1),s("p",Xs,i(o.style[b.value]),1)]),s("div",Ys,[a(e(x),{onClick:_=>se(o),size:"sm",class:"flex-1 text-xs"},{default:r(()=>[a(e(Q),{class:"mr-1 h-3 w-3"}),t[34]||(t[34]=p(" Insert ",-1))]),_:2},1032,["onClick"]),a(e(x),{onClick:_=>ue(o),size:"sm",variant:"outline",class:"flex-1 text-xs"},{default:r(()=>[a(e(X),{class:"mr-1 h-3 w-3"}),t[35]||(t[35]=p(" Copy ",-1))]),_:2},1032,["onClick"])])])):y("",!0)],10,Hs)]))),128))])]),_:1})])):(n(),m("div",Zs,[a(e(W),{class:"mx-auto h-12 w-12 text-muted-foreground/30 mb-3"}),t[36]||(t[36]=s("p",{class:"text-xs text-muted-foreground mb-1"}," No citations yet ",-1)),t[37]||(t[37]=s("p",{class:"text-xs text-muted-foreground/80"}," Generate your first citation using the search above ",-1))]))]),_:1})]),_:1})]),_:1},8,["open"])]),_:1})),a(e(Me),{open:L.value,"onUpdate:open":t[9]||(t[9]=o=>L.value=o)},{default:r(()=>[a(e(Ne),null,{default:r(()=>[a(e(Ve),null,{default:r(()=>[a(e(Ge),null,{default:r(()=>[...t[38]||(t[38]=[p("Clear All Citations",-1)])]),_:1}),a(e(Be),null,{default:r(()=>[p(" Are you sure you want to clear all "+i(k.value.length)+" citations? This action cannot be undone and will permanently remove all citations from your library. ",1)]),_:1})]),_:1}),a(e(qe),null,{default:r(()=>[a(e(Je),{onClick:t[8]||(t[8]=o=>L.value=!1)},{default:r(()=>[...t[39]||(t[39]=[p("Cancel",-1)])]),_:1}),a(e(We),{onClick:De,class:"bg-destructive text-destructive-foreground hover:bg-destructive/90"},{default:r(()=>[...t[40]||(t[40]=[p(" Clear All Citations ",-1)])]),_:1})]),_:1})]),_:1})]),_:1},8,["open"])],64))}}),ea={class:"inline-flex"},ta={class:"space-y-4"},sa={class:"flex items-center justify-between"},aa={class:"flex items-center gap-2 text-sm text-muted-foreground"},oa={class:"flex items-center gap-2"},ra={class:"space-y-2"},na={class:"flex items-start gap-3"},la={class:"flex-1 min-w-0"},ia={class:"flex items-center gap-2 mb-1"},da={class:"font-medium truncate"},ca={class:"flex items-center gap-4 text-sm text-muted-foreground"},ua={key:0},Ea=ke({__name:"ExportMenu",props:{project:{},currentChapter:{},allChapters:{},triggerElement:{default:"button"},size:{default:"default"},variant:{default:"outline"},buttonClass:{default:""}},setup(N){const j=N,h=w(!1),v=w([]),b=Y(()=>j.allChapters.filter(c=>c.content&&c.content.trim().length>0)),S=Y(()=>v.value.length),D=Y(()=>j.allChapters.filter(c=>v.value.includes(c.chapter_number)).reduce((c,l)=>c+l.word_count,0)),z=async()=>{f.loading("Generating project PDF...",{id:"export-project-pdf"});const c=ne("export.project.pdf",{project:j.project.slug});try{const l=await fetch(c,{method:"GET",headers:{Accept:"application/pdf"}});if(l.ok){const u=l.headers.get("content-type");if(u&&u.includes("application/json")){const T=await l.json();f.error("Export Failed",{id:"export-project-pdf",description:T.message||"An error occurred during PDF export."});return}const F=await l.blob(),$=window.URL.createObjectURL(F),C=document.createElement("a");C.href=$,C.download=`${j.project.slug}_full_project.pdf`,document.body.appendChild(C),C.click(),document.body.removeChild(C),window.URL.revokeObjectURL($),f.success("Project PDF exported successfully!",{id:"export-project-pdf",description:`${j.project.title} has been downloaded as PDF.`})}else try{const u=await l.json();f.error("Export Failed",{id:"export-project-pdf",description:u.message||"An error occurred during PDF export."})}catch{f.error("Export Failed",{id:"export-project-pdf",description:"Unable to export project as PDF. Please try again."})}}catch{f.error("Export Failed",{id:"export-project-pdf",description:"Network error occurred. Please check your connection and try again."})}},L=async()=>{if(v.value.length===0){f.error("No chapters selected",{description:"Please select at least one chapter to export."});return}try{f.loading(`Exporting ${v.value.length} chapters...`,{id:"export-chapters"});const c=ne("export.chapters.word",{project:j.project.slug}),l=new FormData;v.value.forEach($=>{l.append("chapters[]",$.toString())});const u=document.querySelector('meta[name="csrf-token"]')?.getAttribute("content");u&&l.append("_token",u);const F=await fetch(c,{method:"POST",body:l,headers:{Accept:"application/json"}});if(F.ok){const $=F.headers.get("content-type");if($&&$.includes("application/json")){const ee=await F.json();f.error("Export Failed",{id:"export-chapters",description:ee.message||"An error occurred during export."});return}const C=await F.blob(),T=window.URL.createObjectURL(C),I=document.createElement("a");I.href=T,I.download=`${j.project.slug}-chapters-${v.value.join("-")}.docx`,document.body.appendChild(I),I.click(),document.body.removeChild(I),window.URL.revokeObjectURL(T),f.success("Selected chapters exported successfully!",{id:"export-chapters",description:`${v.value.length} chapters exported to Word.`}),v.value=[],h.value=!1}else try{const $=await F.json();f.error("Export Failed",{id:"export-chapters",description:$.message||"An error occurred during export."})}catch{f.error("Export Failed",{id:"export-chapters",description:"Unable to export selected chapters. Please try again."})}}catch{f.error("Export Failed",{id:"export-chapters",description:"Network error occurred. Please check your connection and try again."})}},k=c=>{const l=v.value.indexOf(c);l>-1?v.value.splice(l,1):v.value.push(c)},O=()=>{v.value=b.value.map(c=>c.chapter_number)},E=()=>{v.value=[]},G=async()=>{f.loading("Generating PDF...",{id:"export-chapter-pdf"});const c=ne("export.chapter.pdf",{project:j.project.slug,chapterNumber:j.currentChapter.chapter_number});try{const l=await fetch(c,{method:"GET",headers:{Accept:"application/pdf"}});if(l.ok){const u=l.headers.get("content-type");if(u&&u.includes("application/json")){const T=await l.json();f.error("Export Failed",{id:"export-chapter-pdf",description:T.message||"An error occurred during PDF export."});return}const F=await l.blob(),$=window.URL.createObjectURL(F),C=document.createElement("a");C.href=$,C.download=`chapter_${j.currentChapter.chapter_number}_${j.currentChapter.title.toLowerCase().replace(/\s+/g,"_")}.pdf`,document.body.appendChild(C),C.click(),document.body.removeChild(C),window.URL.revokeObjectURL($),f.success("PDF exported successfully!",{id:"export-chapter-pdf",description:`${j.currentChapter.title} has been downloaded as PDF.`})}else try{const u=await l.json();f.error("Export Failed",{id:"export-chapter-pdf",description:u.message||"An error occurred during PDF export."})}catch{f.error("Export Failed",{id:"export-chapter-pdf",description:"Unable to export chapter as PDF. Please try again."})}}catch{f.error("Export Failed",{id:"export-chapter-pdf",description:"Network error occurred. Please check your connection and try again."})}};return(c,l)=>(n(),m("div",ea,[a(e(st),null,{default:r(()=>[a(e(at),{asChild:""},{default:r(()=>[a(e(x),{variant:c.variant,size:c.size,class:P(["gap-2",c.buttonClass])},{default:r(()=>[c.triggerElement==="button"?(n(),m(U,{key:0},[a(e(re),{class:"h-4 w-4"}),l[2]||(l[2]=p(" Export ",-1)),a(e(Z),{class:"h-3 w-3"})],64)):(n(),g(e(re),{key:1,class:"h-4 w-4"}))]),_:1},8,["variant","size","class"])]),_:1}),a(e(ot),{align:"end",class:"w-64"},{default:r(()=>[a(e(we),null,{default:r(()=>[...l[3]||(l[3]=[p("Current Chapter",-1)])]),_:1}),a(e(Ce),{onClick:G,class:"gap-2"},{default:r(()=>[a(e(ye),{class:"h-4 w-4"}),l[4]||(l[4]=s("div",{class:"flex flex-col"},[s("span",{class:"font-medium"},"Export as PDF"),s("span",{class:"text-xs text-muted-foreground"}," Professional academic format ")],-1))]),_:1}),a(e(rt)),a(e(we),null,{default:r(()=>[...l[5]||(l[5]=[p("Full Project",-1)])]),_:1}),a(e(Ce),{onClick:z,class:"gap-2"},{default:r(()=>[a(e(ye),{class:"h-4 w-4"}),l[6]||(l[6]=s("div",{class:"flex flex-col"},[s("span",{class:"font-medium"},"Export as PDF"),s("span",{class:"text-xs text-muted-foreground"}," Professional academic format with cover page ")],-1))]),_:1})]),_:1})]),_:1}),a(e(Qe),{open:h.value,"onUpdate:open":l[1]||(l[1]=u=>h.value=u)},{default:r(()=>[a(e(Xe),{class:"max-w-2xl"},{default:r(()=>[a(e(et),null,{default:r(()=>[a(e(tt),{class:"flex items-center gap-2"},{default:r(()=>[a(e(Re),{class:"h-5 w-5"}),l[7]||(l[7]=p(" Select Chapters to Export ",-1))]),_:1}),a(e(Ye),null,{default:r(()=>[...l[8]||(l[8]=[p(" Choose which chapters you want to include in your Word export. Only chapters with content can be exported. ",-1)])]),_:1})]),_:1}),s("div",ta,[s("div",sa,[s("div",aa,[s("span",null,i(S.value)+" of "+i(b.value.length)+" chapters selected",1),D.value>0?(n(),g(e(A),{key:0,variant:"outline",class:"text-xs"},{default:r(()=>[p(i(D.value.toLocaleString())+" words ",1)]),_:1})):y("",!0)]),s("div",oa,[a(e(x),{onClick:O,variant:"ghost",size:"sm"},{default:r(()=>[...l[9]||(l[9]=[p(" Select All ",-1)])]),_:1}),a(e(x),{onClick:E,variant:"ghost",size:"sm"},{default:r(()=>[...l[10]||(l[10]=[p(" Clear ",-1)])]),_:1})])]),a(e(H)),a(e(le),{class:"h-[300px]"},{default:r(()=>[s("div",ra,[(n(!0),m(U,null,R(b.value,u=>(n(),g(e($e),{key:u.id,class:P(["cursor-pointer transition-colors hover:bg-muted/50",{"ring-2 ring-primary":v.value.includes(u.chapter_number),"bg-muted/30":v.value.includes(u.chapter_number)}]),onClick:F=>k(u.chapter_number)},{default:r(()=>[a(e(je),{class:"p-4"},{default:r(()=>[s("div",na,[a(e(Ke),{checked:v.value.includes(u.chapter_number),"onUpdate:checked":F=>k(u.chapter_number),class:"mt-1"},null,8,["checked","onUpdate:checked"]),s("div",la,[s("div",ia,[s("h4",da," Chapter "+i(u.chapter_number)+": "+i(u.title),1),a(e(A),{variant:u.status==="approved"?"default":"secondary",class:"text-xs"},{default:r(()=>[p(i(u.status.replace("_"," ")),1)]),_:2},1032,["variant"])]),s("div",ca,[s("span",null,i(u.word_count.toLocaleString())+" words",1),u.word_count>0?(n(),m("span",ua,i(Math.ceil(u.word_count/250))+" pages approx. ",1)):y("",!0)])])])]),_:2},1024)]),_:2},1032,["class","onClick"]))),128))])]),_:1})]),a(e(Ze),null,{default:r(()=>[a(e(x),{onClick:l[0]||(l[0]=u=>h.value=!1),variant:"outline"},{default:r(()=>[...l[11]||(l[11]=[p(" Cancel ",-1)])]),_:1}),a(e(x),{onClick:L,disabled:S.value===0,class:"gap-2"},{default:r(()=>[a(e(re),{class:"h-4 w-4"}),p(" Export "+i(S.value)+" Chapter"+i(S.value===1?"":"s"),1)]),_:1},8,["disabled"])]),_:1})]),_:1})]),_:1},8,["open"])]))}});function Ua(N="",j=50){const h=w([N]),v=w(0);return{contentHistory:h,historyIndex:v,addToHistory:k=>{h.value[v.value]!==k&&(h.value=h.value.slice(0,v.value+1),h.value.push(k),h.value.length>j?h.value.shift():v.value++)},undo:()=>v.value>0?(v.value--,h.value[v.value]):null,redo:()=>v.value<h.value.length-1?(v.value++,h.value[v.value]):null,canUndo:()=>v.value>0,canRedo:()=>v.value<h.value.length-1}}export{Ea as _,Da as a,Ua as u};
