import{d as ge,w as ue,q as it,c as _,o as c,O as L,K as n,H as s,u as t,E as l,y as D,a as ie,f as ke,n as Q,C as G,M as j,P as C,Q as be,S as xe,a4 as lt,ad as he,J as pe,ak as dt,j as ut,F as Ne,aa as ce,ai as ct,G as ft,A as He,L as Fe}from"./app-B0kF8k29.js";import{_ as me}from"./index-BX_nQR4F.js";import{c as Ke,_ as k}from"./index-C0SLUj2i.js";import{a as pt,_ as mt}from"./CardContent.vue_vue_type_script_setup_true_lang-C0hLN4X4.js";import{_ as Ze}from"./Progress.vue_vue_type_script_setup_true_lang-O0DgtSJf.js";import{_ as Ce}from"./ScrollArea.vue_vue_type_script_setup_true_lang-B0iY8FQX.js";import{ao as gt,ap as vt,az as ht,aC as Je}from"./index-vlwp6iYW.js";import{i as yt,B as bt,I as xt,C as wt,U as _t,R as kt}from"./RichTextEditor-DUlSTHoY.js";import{S as et}from"./send-D5CPARvH.js";import{_ as _e}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{R as we}from"./RichTextViewer-gPMrGwCC.js";import{_ as Le,a as Ue}from"./index-DIANSpr-.js";import{L as Ct}from"./loader-DD6CfXTT.js";import{C as Ae}from"./circle-alert-BwjkwzqK.js";import{C as St}from"./check-CEt2jqUz.js";import{T as Tt}from"./trash-2-C_2x5g2e.js";import{F as tt}from"./file-text-Br9UtEh4.js";import{_ as $t}from"./Input.vue_vue_type_script_setup_true_lang-CBax_5wo.js";import{S as ye}from"./search-DO7AXH_O.js";import{X as Se}from"./index-BoeZbtgA.js";import{M as st}from"./message-square-CcMkN-m5.js";import{C as Ie}from"./clock-C_L0mzp0.js";import{C as at}from"./chevron-left-B2yXjIQu.js";import{C as ot}from"./chevron-right-DXpi25t3.js";import{_ as Te,a as $e}from"./DialogContent.vue_vue_type_script_setup_true_lang-DzWVUis5.js";import{_ as Ee}from"./DialogDescription.vue_vue_type_script_setup_true_lang-BhxzrhH5.js";import{_ as Re}from"./DialogFooter.vue_vue_type_script_setup_true_lang-TTx3NMsS.js";import{_ as je,a as Me}from"./DialogTitle.vue_vue_type_script_setup_true_lang-CDS6yRqv.js";import{C as Et}from"./chevron-down-Cpe4VrIV.js";import{P as Pe}from"./pen-tool-C58U7H78.js";import{P as Ye}from"./plus-DdJuN8aN.js";import{M as Rt}from"./minimize-2-bgWisnaC.js";import{M as jt}from"./maximize-2-DUbg-OU_.js";import{C as Mt}from"./chart-column-jiIwqF9L.js";import{C as Dt}from"./circle-help-49c5suVN.js";import{T as zt}from"./target-DibfvKqo.js";import{B as At}from"./ChapterEditor-CjgubRZq.js";import{B as Pt}from"./building-2-BkbFRIrg.js";import{Z as Ot}from"./zap-B_SH-bQR.js";import{T as Nt}from"./type-BlYTrrB6.js";import{B as It}from"./brain-B4SqKrkT.js";import{S as Ht}from"./sparkles-BbsS5jnr.js";import{B as Be}from"./bot-BKMCJ9AB.js";import{C as Ft}from"./copy-sRcEYFf3.js";import{C as rt}from"./circle-check-big-zUgF5Q0Z.js";import{T as Lt,a as Ut}from"./thumbs-up-8bg24yWI.js";import{U as Yt}from"./user-DJi72la4.js";import{S as Bt}from"./square-DnT-XjJs.js";import{E as Vt}from"./eye-CDSozEHG.js";import{S as qt}from"./save-upIqHtyS.js";import"./index-DsHxzjCZ.js";import"./Presence-Bj9mfJQy.js";import"./useForwardExpose-DvsR2gOR.js";import"./nullish-CHIgUVhi.js";import"./useNonce-Ce1s_r-5.js";import"./purify.es-DxJI3Wx7.js";import"./index-BWEDi_FC.js";import"./step-DrZ9DcYd.js";import"./calendar-CxZFsUC5.js";import"./users-DwY9oT1f.js";import"./loader-circle-BBhT74IN.js";import"./download-B8yCtgBP.js";import"./Label.vue_vue_type_script_setup_true_lang-C_PKKfey.js";import"./DropdownMenuTrigger.vue_vue_type_script_setup_true_lang-CBBrHpG-.js";import"./triangle-alert-DuP5arm-.js";import"./DialogTitle-kUDE-DWA.js";import"./VisuallyHidden-KLLlvcL-.js";import"./minus-D-MVpDlp.js";import"./list-WiHRhoPT.js";import"./CardTitle.vue_vue_type_script_setup_true_lang-CAnl3p65.js";import"./Separator.vue_vue_type_script_setup_true_lang-Dm9tOUZx.js";import"./Separator-B-XPM9Qq.js";import"./TooltipTrigger.vue_vue_type_script_setup_true_lang-BnyjwDqu.js";import"./WordBalanceDisplay.vue_vue_type_script_setup_true_lang-D7NVm75V.js";import"./coins-B6BEFjYp.js";import"./AppLayout.vue_vue_type_script_setup_true_lang-BWmiPav5.js";import"./UserInfo.vue_vue_type_script_setup_true_lang-DnzsZePu.js";import"./log-out-CHUAohWC.js";import"./AppLogo.vue_vue_type_script_setup_true_lang-2j9PBaRI.js";import"./library-Bk_rqwxG.js";import"./sun-nzcdUt0o.js";import"./useWordBalance-D2Uha6ZQ.js";import"./driver-B4w0q6_T.js";import"./PurchaseModal.vue_vue_type_script_setup_true_lang-DPeZaGQy.js";import"./arrow-right-C9mGfiUk.js";import"./useChapterWordCount-CQftCKf_.js";import"./toNumber-Cz-hzWmK.js";import"./CollapsibleTrigger.vue_vue_type_script_setup_true_lang-DIKarZxf.js";import"./CollapsibleTrigger-DBSMDONG.js";import"./useTextHistory-BaSAZvUW.js";import"./AlertDialogTitle.vue_vue_type_script_setup_true_lang-BSJDvUny.js";import"./history-ClbTeQZr.js";import"./Checkbox.vue_vue_type_script_setup_true_lang-CFvAb-XN.js";import"./isValueEqualOrExist-DSClXoPv.js";import"./ohash.D__AXeF1-C-E83dC9.js";import"./useFormControl-DMTNplH2.js";import"./RovingFocusItem-ggaQs033.js";import"./VisuallyHiddenInput-BpJTHr4g.js";import"./refresh-cw-pI8Rxd4x.js";import"./arrow-left-BtCM5dlY.js";import"./menu-DafbKKMY.js";/**
 * @license lucide-vue-next v0.468.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Gt=Ke("MessageCircleIcon",[["path",{d:"M7.9 20A9 9 0 1 0 4 16.1L2 22Z",key:"vv11sd"}]]);/**
 * @license lucide-vue-next v0.468.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const fe=Ke("TrashIcon",[["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6",key:"4alrt4"}],["path",{d:"M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2",key:"v07s0e"}]]),Qt={class:"w-full border rounded-md bg-background"},Wt={key:0,class:"flex items-center gap-1 p-1 border-b bg-muted/20"},Xt={class:"relative"},Kt=ge({__name:"CompactRichTextEditor",props:{modelValue:{},placeholder:{default:"Type your message..."},disabled:{type:Boolean,default:!1},showToolbar:{type:Boolean,default:!0}},emits:["update:modelValue","submit","keydown"],setup(H,{expose:y,emit:i}){const m=H,v=i,f=gt({content:m.modelValue,editable:!m.disabled,extensions:[vt.configure({heading:!1,bulletList:!1,orderedList:!1,blockquote:!1,horizontalRule:!1,codeBlock:!1}),yt.configure({placeholder:m.placeholder})],editorProps:{attributes:{class:"prose prose-sm dark:prose-invert max-w-none focus:outline-none min-h-[2rem] max-h-32 overflow-y-auto",style:"padding: 8px; line-height: 1.5;"},handleKeyDown:(E,O)=>(v("keydown",O),O.key==="Enter"&&!O.shiftKey?(O.preventDefault(),v("submit"),!0):!1)},onUpdate:({editor:E})=>{v("update:modelValue",E.getHTML())}});ue(()=>m.modelValue,E=>{f.value&&f.value.getHTML()!==E&&f.value.commands.setContent(E,!1)}),ue(()=>m.disabled,E=>{f.value&&f.value.setEditable(!E)}),it(()=>{f.value&&f.value.destroy()});const b=()=>f.value?.chain().focus().toggleBold().run(),w=()=>f.value?.chain().focus().toggleItalic().run(),d=()=>f.value?.chain().focus().toggleCode().run(),r=E=>f.value?.isActive(E)??!1,h=()=>{f.value?.commands.focus()},T=()=>f.value?.getText()??"";return y({focus:h,clear:()=>{f.value?.commands.clearContent()},getTextContent:T,editor:f}),(E,O)=>(c(),_("div",Qt,[E.showToolbar?(c(),_("div",Wt,[s(t(k),{onClick:b,variant:r("bold")?"default":"ghost",size:"sm",class:"h-6 w-6 p-0"},{default:l(()=>[s(t(bt),{class:"w-3 h-3"})]),_:1},8,["variant"]),s(t(k),{onClick:w,variant:r("italic")?"default":"ghost",size:"sm",class:"h-6 w-6 p-0"},{default:l(()=>[s(t(xt),{class:"w-3 h-3"})]),_:1},8,["variant"]),s(t(k),{onClick:d,variant:r("code")?"default":"ghost",size:"sm",class:"h-6 w-6 p-0"},{default:l(()=>[s(t(wt),{class:"w-3 h-3"})]),_:1},8,["variant"]),O[1]||(O[1]=n("div",{class:"flex-1"},null,-1)),s(t(k),{onClick:O[0]||(O[0]=W=>v("submit")),disabled:E.disabled||!T().trim(),size:"sm",class:"h-6 px-2"},{default:l(()=>[s(t(et),{class:"w-3 h-3"})]),_:1},8,["disabled"])])):L("",!0),n("div",Xt,[s(t(ht),{editor:t(f),class:"compact-prose-editor"},null,8,["editor"])])]))}}),Zt=_e(Kt,[["__scopeId","data-v-06ee7de1"]]),Jt={class:"space-y-4"},es=["accept","disabled"],ts={class:"flex flex-col items-center gap-3"},ss={class:"space-y-1"},as={class:"text-sm font-medium"},os={class:"text-xs text-muted-foreground"},rs={key:0,class:"w-full max-w-xs"},ns={class:"text-xs text-muted-foreground mt-1"},is={key:0,class:"space-y-2"},ls={key:1,class:"space-y-2"},ds={key:2,class:"space-y-3"},us={class:"space-y-2"},cs={class:"flex-1 min-w-0 space-y-2"},fs={class:"flex items-start justify-between gap-2"},ps={class:"min-w-0 flex-1"},ms={class:"text-sm font-medium truncate"},gs={class:"text-xs text-muted-foreground"},vs={class:"flex flex-wrap gap-1"},hs={key:0,class:"text-xs text-muted-foreground"},ys=ge({__name:"FileUpload",props:{projectSlug:{},chapterNumber:{},sessionId:{},disabled:{type:Boolean}},emits:["file-uploaded","file-deleted","files-loaded"],setup(H,{emit:y}){const i=H,m=y,v=D(),f=D(!1),b=D(0),w=D(""),d=D(""),r=D(!1),h=D([]),T=ie(()=>h.value.length>0),I=ie(()=>".pdf,.doc,.docx,.txt,.rtf,.md"),E=ie(()=>"10 MB"),O=()=>{!i.disabled&&!f.value&&v.value?.click()},W=u=>{const o=u.target;o.files&&o.files.length>0&&K(o.files[0])},V=u=>{if(u.preventDefault(),r.value=!1,i.disabled||f.value)return;const o=u.dataTransfer?.files;o&&o.length>0&&K(o[0])},J=u=>{u.preventDefault(),!i.disabled&&!f.value&&(r.value=!0)},U=()=>{r.value=!1},K=async u=>{if(!i.disabled){if(w.value="",d.value="",f.value=!0,b.value=0,!q(u)){f.value=!1;return}try{const o=new FormData;o.append("file",u),o.append("session_id",i.sessionId);const p=await he.post(pe("chapters.chat-upload",{project:i.projectSlug,chapter:i.chapterNumber}),o,{headers:{"Content-Type":"multipart/form-data"},onUploadProgress:F=>{F.total&&(b.value=Math.round(F.loaded*100/F.total))}});p.data.success?(d.value=p.data.message,h.value.unshift(p.data.upload),m("file-uploaded",p.data.upload),v.value&&(v.value.value=""),setTimeout(()=>{d.value=""},3e3)):w.value=p.data.error||"Upload failed"}catch(o){console.error("Upload error:",o),w.value=o.response?.data?.error||"Failed to upload file. Please try again."}finally{f.value=!1,b.value=0}}},q=u=>{if(u.size>10485760)return w.value=`File size exceeds ${E.value} limit`,!1;const p=["pdf","doc","docx","txt","rtf","md"],F=u.name.split(".").pop()?.toLowerCase();return!F||!p.includes(F)?(w.value="Please upload PDF, DOC, DOCX, TXT, RTF, or MD files only",!1):!0},N=async u=>{try{(await he.delete(pe("chapters.chat-file-delete",{project:i.projectSlug,chapter:i.chapterNumber,uploadId:u}))).data.success&&(h.value=h.value.filter(p=>p.id!==u),m("file-deleted",u))}catch(o){console.error("Delete error:",o),w.value="Failed to delete file"}},se=async()=>{try{const u=await he.get(pe("chapters.chat-files",{project:i.projectSlug,chapter:i.chapterNumber}),{params:{session_id:i.sessionId}});u.data.success&&(h.value=u.data.files,m("files-loaded",u.data.files))}catch(u){console.error("Failed to load existing files:",u)}},te=u=>(u.split(".").pop()?.toLowerCase(),tt),ae=u=>u.slice(0,3).join(", ")+(u.length>3?"...":"");return ke(()=>{se()}),(u,o)=>(c(),_("div",Jt,[n("div",{class:Q(["border-2 border-dashed rounded-lg p-6 text-center transition-all",r.value?"border-primary bg-primary/5":"border-muted-foreground/25 hover:border-muted-foreground/50",u.disabled||f.value?"opacity-50 cursor-not-allowed":"cursor-pointer"]),onClick:O,onDragover:J,onDragleave:U,onDrop:V},[n("input",{ref_key:"fileInput",ref:v,type:"file",accept:I.value,class:"hidden",onChange:W,disabled:u.disabled||f.value},null,40,es),n("div",ts,[n("div",{class:Q(["flex h-12 w-12 items-center justify-center rounded-full",f.value?"bg-primary/10":"bg-muted"])},[f.value?(c(),G(t(Ct),{key:0,class:"h-6 w-6 animate-spin text-primary"})):(c(),G(t(_t),{key:1,class:"h-6 w-6 text-muted-foreground"}))],2),n("div",ss,[n("p",as,j(f.value?"Uploading and analyzing...":"Drop files here or click to browse"),1),n("p",os," PDF, DOC, DOCX, TXT, RTF, MD up to "+j(E.value),1)]),f.value?(c(),_("div",rs,[s(t(Ze),{value:b.value,class:"h-2"},null,8,["value"]),n("p",ns,j(b.value)+"%",1)])):L("",!0)])],34),w.value?(c(),_("div",is,[s(t(Le),{variant:"destructive"},{default:l(()=>[s(t(Ae),{class:"h-4 w-4"}),s(t(Ue),null,{default:l(()=>[C(j(w.value),1)]),_:1})]),_:1})])):L("",!0),d.value?(c(),_("div",ls,[s(t(Le),null,{default:l(()=>[s(t(St),{class:"h-4 w-4"}),s(t(Ue),null,{default:l(()=>[C(j(d.value),1)]),_:1})]),_:1})])):L("",!0),T.value?(c(),_("div",ds,[o[0]||(o[0]=n("h4",{class:"text-sm font-medium text-foreground"},"Uploaded Documents",-1)),n("div",us,[(c(!0),_(be,null,xe(h.value,p=>(c(),_("div",{key:p.id,class:"flex items-start gap-3 p-3 bg-muted/30 rounded-lg border"},[(c(),G(lt(te(p.filename)),{class:"h-5 w-5 text-muted-foreground mt-0.5 flex-shrink-0"})),n("div",cs,[n("div",fs,[n("div",ps,[n("p",ms,j(p.filename),1),n("p",gs,j(p.size),1)]),s(t(k),{onClick:F=>N(p.id),variant:"ghost",size:"sm",class:"h-6 w-6 p-0 text-muted-foreground hover:text-destructive"},{default:l(()=>[s(t(Tt),{class:"h-3 w-3"})]),_:2},1032,["onClick"])]),n("div",vs,[s(t(me),{variant:"secondary",class:"text-xs"},{default:l(()=>[C(j(p.word_count)+" words ",1)]),_:2},1024),p.citations_found>0?(c(),G(t(me),{key:0,variant:"secondary",class:"text-xs"},{default:l(()=>[C(j(p.citations_found)+" citations ",1)]),_:2},1024)):L("",!0),p.main_topics.length>0?(c(),G(t(me),{key:1,variant:"outline",class:"text-xs"},{default:l(()=>[C(j(ae(p.main_topics)),1)]),_:2},1024)):L("",!0)]),p.uploaded_at?(c(),_("p",hs," Uploaded "+j(p.uploaded_at),1)):L("",!0)])]))),128))])])):L("",!0)]))}}),bs=_e(ys,[["__scopeId","data-v-0e5d2848"]]),xs={key:0,class:"flex h-full flex-col bg-background border-l"},ws={class:"flex-shrink-0 border-b p-3"},_s={class:"flex items-center justify-between mb-3"},ks={class:"text-sm font-semibold flex items-center gap-2"},Cs={class:"space-y-2"},Ss={class:"relative"},Ts={class:"flex gap-1"},$s={class:"p-3 space-y-3"},Es={key:0,class:"text-center py-8"},Rs={key:1,class:"text-center py-8"},js={class:"text-sm text-destructive"},Ms={key:2,class:"text-center py-8"},Ds={class:"flex flex-col items-center gap-2"},zs={key:3,class:"space-y-2"},As={class:"flex items-center justify-between"},Ps={class:"text-xs text-muted-foreground"},Os={key:0,class:"text-xs text-muted-foreground"},Ns={class:"space-y-2"},Is=["onClick"],Hs={class:"flex items-start justify-between gap-2 mb-2"},Fs={class:"flex items-center gap-1 text-xs text-muted-foreground"},Ls={class:"space-y-2"},Us=["innerHTML"],Ys={key:0,class:"text-xs text-muted-foreground border-l-2 pl-2"},Bs={key:0,class:"flex items-center justify-center gap-1 pt-2 border-t"},Vs={class:"text-xs text-muted-foreground px-2"},qs={key:4,class:"text-center py-8"},Gs={class:"flex flex-col items-center gap-2"},Ve=10,Qs=ge({__name:"ChatSearch",props:{projectSlug:{},chapterNumber:{},show:{type:Boolean}},emits:["close","message-selected"],setup(H,{emit:y}){const i=H,m=y,v=D(""),f=D([]),b=D(!1),w=D(""),d=D(1),r=D(0),h=D("all"),T=ie(()=>f.value.length>0),I=ie(()=>Math.ceil(r.value/Ve)),E=ie(()=>d.value<I.value),O=ie(()=>d.value>1),W=ie(()=>!b.value&&v.value.length>0&&!T.value);let V=null;const J=()=>{V&&clearTimeout(V),V=setTimeout(()=>{v.value.trim().length>=2?U():(f.value=[],r.value=0,d.value=1)},300)},U=async(u=1)=>{if(!(!v.value.trim()||b.value)){b.value=!0,w.value="",d.value=u;try{const o=await he.get(pe("chapters.chat-search",{project:i.projectSlug,chapter:i.chapterNumber}),{params:{q:v.value.trim(),type:h.value==="all"?null:h.value,page:u,per_page:Ve}});o.data.success?(f.value=o.data.results,r.value=o.data.total):w.value=o.data.error||"Search failed"}catch(o){console.error("Search error:",o),w.value="Failed to search chat history. Please try again."}finally{b.value=!1}}},K=()=>{v.value="",f.value=[],r.value=0,d.value=1,w.value=""},q=u=>{u>=1&&u<=I.value&&u!==d.value&&U(u)},N=u=>{m("message-selected",u.id,u.session_id),m("close")},se=u=>{const o=new Date(u),F=new Date().getTime()-o.getTime(),re=Math.floor(F/(1e3*60*60*24));return re===0?"Today "+o.toLocaleTimeString("en-US",{hour:"2-digit",minute:"2-digit",hour12:!1}):re===1?"Yesterday "+o.toLocaleTimeString("en-US",{hour:"2-digit",minute:"2-digit",hour12:!1}):re<7?o.toLocaleDateString("en-US",{weekday:"short",hour:"2-digit",minute:"2-digit",hour12:!1}):o.toLocaleDateString("en-US",{month:"short",day:"numeric",hour:"2-digit",minute:"2-digit",hour12:!1})},te=u=>{switch(u){case"user":return"You";case"ai":return"AI";case"system":return"System";default:return u}},ae=u=>{switch(u){case"user":return"bg-blue-100 text-blue-800 dark:bg-blue-900 dark:text-blue-200";case"ai":return"bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-200";case"system":return"bg-gray-100 text-gray-800 dark:bg-gray-900 dark:text-gray-200";default:return"bg-gray-100 text-gray-800 dark:bg-gray-900 dark:text-gray-200"}};return ue(v,J),ue(h,()=>{v.value.trim().length>=2&&(d.value=1,U())}),ue(()=>i.show,u=>{u&&ke(()=>{document.querySelector("[data-search-input]")?.focus()})}),(u,o)=>u.show?(c(),_("div",xs,[n("div",ws,[n("div",_s,[n("h3",ks,[s(t(ye),{class:"h-4 w-4"}),o[8]||(o[8]=C(" Search Chat History ",-1))]),s(t(k),{onClick:o[0]||(o[0]=p=>m("close")),variant:"ghost",size:"icon",class:"h-6 w-6"},{default:l(()=>[s(t(Se),{class:"h-3 w-3"})]),_:1})]),n("div",Cs,[n("div",Ss,[s(t(ye),{class:"absolute left-2 top-1/2 h-3 w-3 -translate-y-1/2 text-muted-foreground"}),s(t($t),{modelValue:v.value,"onUpdate:modelValue":o[1]||(o[1]=p=>v.value=p),"data-search-input":"",placeholder:"Search messages...",class:"pl-7 pr-8 h-8 text-sm"},null,8,["modelValue"]),v.value?(c(),G(t(k),{key:0,onClick:K,variant:"ghost",size:"icon",class:"absolute right-1 top-1/2 h-6 w-6 -translate-y-1/2"},{default:l(()=>[s(t(Se),{class:"h-3 w-3"})]),_:1})):L("",!0)]),n("div",Ts,[s(t(k),{onClick:o[2]||(o[2]=p=>h.value="all"),variant:h.value==="all"?"default":"outline",size:"xs",class:"h-6 px-2 text-xs"},{default:l(()=>[...o[9]||(o[9]=[C(" All ",-1)])]),_:1},8,["variant"]),s(t(k),{onClick:o[3]||(o[3]=p=>h.value="user"),variant:h.value==="user"?"default":"outline",size:"xs",class:"h-6 px-2 text-xs"},{default:l(()=>[...o[10]||(o[10]=[C(" Your Messages ",-1)])]),_:1},8,["variant"]),s(t(k),{onClick:o[4]||(o[4]=p=>h.value="ai"),variant:h.value==="ai"?"default":"outline",size:"xs",class:"h-6 px-2 text-xs"},{default:l(()=>[...o[11]||(o[11]=[C(" AI Responses ",-1)])]),_:1},8,["variant"])])])]),s(t(Ce),{class:"flex-1"},{default:l(()=>[n("div",$s,[b.value?(c(),_("div",Es,[...o[12]||(o[12]=[n("div",{class:"inline-flex items-center gap-2 text-sm text-muted-foreground"},[n("div",{class:"h-4 w-4 animate-spin rounded-full border-2 border-primary border-t-transparent"}),C(" Searching... ")],-1)])])):w.value?(c(),_("div",Rs,[n("p",js,j(w.value),1),s(t(k),{onClick:o[5]||(o[5]=p=>U()),variant:"outline",size:"sm",class:"mt-2"},{default:l(()=>[...o[13]||(o[13]=[C(" Try Again ",-1)])]),_:1})])):W.value?(c(),_("div",Ms,[n("div",Ds,[s(t(st),{class:"h-8 w-8 text-muted-foreground/50"}),o[14]||(o[14]=n("p",{class:"text-sm text-muted-foreground"},"No messages found",-1)),o[15]||(o[15]=n("p",{class:"text-xs text-muted-foreground"},"Try a different search term",-1))])])):T.value?(c(),_("div",zs,[n("div",As,[n("p",Ps,j(r.value)+" result"+j(r.value!==1?"s":"")+" found ",1),I.value>1?(c(),_("p",Os," Page "+j(d.value)+" of "+j(I.value),1)):L("",!0)]),n("div",Ns,[(c(!0),_(be,null,xe(f.value,p=>(c(),_("div",{key:p.id,onClick:F=>N(p),class:"cursor-pointer rounded-lg border p-3 hover:bg-muted/50 transition-colors"},[n("div",Hs,[s(t(me),{class:Q([ae(p.message_type),"text-xs"])},{default:l(()=>[C(j(te(p.message_type)),1)]),_:2},1032,["class"]),n("div",Fs,[s(t(Ie),{class:"h-3 w-3"}),C(" "+j(se(p.timestamp)),1)])]),n("div",Ls,[n("p",{class:"text-sm leading-relaxed",innerHTML:p.highlight},null,8,Us),p.context?(c(),_("p",Ys,j(p.context),1)):L("",!0)])],8,Is))),128))]),I.value>1?(c(),_("div",Bs,[s(t(k),{onClick:o[6]||(o[6]=p=>q(d.value-1)),disabled:!O.value,variant:"outline",size:"icon",class:"h-6 w-6"},{default:l(()=>[s(t(at),{class:"h-3 w-3"})]),_:1},8,["disabled"]),n("span",Vs,j(d.value)+" / "+j(I.value),1),s(t(k),{onClick:o[7]||(o[7]=p=>q(d.value+1)),disabled:!E.value,variant:"outline",size:"icon",class:"h-6 w-6"},{default:l(()=>[s(t(ot),{class:"h-3 w-3"})]),_:1},8,["disabled"])])):L("",!0)])):v.value?L("",!0):(c(),_("div",qs,[n("div",Gs,[s(t(ye),{class:"h-8 w-8 text-muted-foreground/50"}),o[16]||(o[16]=n("p",{class:"text-sm text-muted-foreground"},"Search your chat history",-1)),o[17]||(o[17]=n("p",{class:"text-xs text-muted-foreground"},"Enter at least 2 characters to search",-1))])]))])]),_:1})])):L("",!0)}}),Ws=_e(Qs,[["__scopeId","data-v-a92378d7"]]);var De={exports:{}},z={};/**
 * @license React
 * react.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var qe;function Xs(){if(qe)return z;qe=1;var H=Symbol.for("react.transitional.element"),y=Symbol.for("react.portal"),i=Symbol.for("react.fragment"),m=Symbol.for("react.strict_mode"),v=Symbol.for("react.profiler"),f=Symbol.for("react.consumer"),b=Symbol.for("react.context"),w=Symbol.for("react.forward_ref"),d=Symbol.for("react.suspense"),r=Symbol.for("react.memo"),h=Symbol.for("react.lazy"),T=Symbol.iterator;function I(e){return e===null||typeof e!="object"?null:(e=T&&e[T]||e["@@iterator"],typeof e=="function"?e:null)}var E={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},O=Object.assign,W={};function V(e,a,S){this.props=e,this.context=a,this.refs=W,this.updater=S||E}V.prototype.isReactComponent={},V.prototype.setState=function(e,a){if(typeof e!="object"&&typeof e!="function"&&e!=null)throw Error("takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,e,a,"setState")},V.prototype.forceUpdate=function(e){this.updater.enqueueForceUpdate(this,e,"forceUpdate")};function J(){}J.prototype=V.prototype;function U(e,a,S){this.props=e,this.context=a,this.refs=W,this.updater=S||E}var K=U.prototype=new J;K.constructor=U,O(K,V.prototype),K.isPureReactComponent=!0;var q=Array.isArray,N={H:null,A:null,T:null,S:null,V:null},se=Object.prototype.hasOwnProperty;function te(e,a,S,$,A,P){return S=P.ref,{$$typeof:H,type:e,key:a,ref:S!==void 0?S:null,props:P}}function ae(e,a){return te(e.type,a,void 0,void 0,void 0,e.props)}function u(e){return typeof e=="object"&&e!==null&&e.$$typeof===H}function o(e){var a={"=":"=0",":":"=2"};return"$"+e.replace(/[=:]/g,function(S){return a[S]})}var p=/\/+/g;function F(e,a){return typeof e=="object"&&e!==null&&e.key!=null?o(""+e.key):a.toString(36)}function re(){}function x(e){switch(e.status){case"fulfilled":return e.value;case"rejected":throw e.reason;default:switch(typeof e.status=="string"?e.then(re,re):(e.status="pending",e.then(function(a){e.status==="pending"&&(e.status="fulfilled",e.value=a)},function(a){e.status==="pending"&&(e.status="rejected",e.reason=a)})),e.status){case"fulfilled":return e.value;case"rejected":throw e.reason}}throw e}function M(e,a,S,$,A){var P=typeof e;(P==="undefined"||P==="boolean")&&(e=null);var R=!1;if(e===null)R=!0;else switch(P){case"bigint":case"string":case"number":R=!0;break;case"object":switch(e.$$typeof){case H:case y:R=!0;break;case h:return R=e._init,M(R(e._payload),a,S,$,A)}}if(R)return A=A(e),R=$===""?"."+F(e,0):$,q(A)?(S="",R!=null&&(S=R.replace(p,"$&/")+"/"),M(A,a,S,"",function(ne){return ne})):A!=null&&(u(A)&&(A=ae(A,S+(A.key==null||e&&e.key===A.key?"":(""+A.key).replace(p,"$&/")+"/")+R)),a.push(A)),1;R=0;var X=$===""?".":$+":";if(q(e))for(var B=0;B<e.length;B++)$=e[B],P=X+F($,B),R+=M($,a,S,P,A);else if(B=I(e),typeof B=="function")for(e=B.call(e),B=0;!($=e.next()).done;)$=$.value,P=X+F($,B++),R+=M($,a,S,P,A);else if(P==="object"){if(typeof e.then=="function")return M(x(e),a,S,$,A);throw a=String(e),Error("Objects are not valid as a React child (found: "+(a==="[object Object]"?"object with keys {"+Object.keys(e).join(", ")+"}":a)+"). If you meant to render a collection of children, use an array instead.")}return R}function Y(e,a,S){if(e==null)return e;var $=[],A=0;return M(e,$,"","",function(P){return a.call(S,P,A++)}),$}function ee(e){if(e._status===-1){var a=e._result;a=a(),a.then(function(S){(e._status===0||e._status===-1)&&(e._status=1,e._result=S)},function(S){(e._status===0||e._status===-1)&&(e._status=2,e._result=S)}),e._status===-1&&(e._status=0,e._result=a)}if(e._status===1)return e._result.default;throw e._result}var le=typeof reportError=="function"?reportError:function(e){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var a=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof e=="object"&&e!==null&&typeof e.message=="string"?String(e.message):String(e),error:e});if(!window.dispatchEvent(a))return}else if(typeof process=="object"&&typeof process.emit=="function"){process.emit("uncaughtException",e);return}console.error(e)};function g(){}return z.Children={map:Y,forEach:function(e,a,S){Y(e,function(){a.apply(this,arguments)},S)},count:function(e){var a=0;return Y(e,function(){a++}),a},toArray:function(e){return Y(e,function(a){return a})||[]},only:function(e){if(!u(e))throw Error("React.Children.only expected to receive a single React element child.");return e}},z.Component=V,z.Fragment=i,z.Profiler=v,z.PureComponent=U,z.StrictMode=m,z.Suspense=d,z.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=N,z.__COMPILER_RUNTIME={__proto__:null,c:function(e){return N.H.useMemoCache(e)}},z.cache=function(e){return function(){return e.apply(null,arguments)}},z.cloneElement=function(e,a,S){if(e==null)throw Error("The argument must be a React element, but you passed "+e+".");var $=O({},e.props),A=e.key,P=void 0;if(a!=null)for(R in a.ref!==void 0&&(P=void 0),a.key!==void 0&&(A=""+a.key),a)!se.call(a,R)||R==="key"||R==="__self"||R==="__source"||R==="ref"&&a.ref===void 0||($[R]=a[R]);var R=arguments.length-2;if(R===1)$.children=S;else if(1<R){for(var X=Array(R),B=0;B<R;B++)X[B]=arguments[B+2];$.children=X}return te(e.type,A,void 0,void 0,P,$)},z.createContext=function(e){return e={$$typeof:b,_currentValue:e,_currentValue2:e,_threadCount:0,Provider:null,Consumer:null},e.Provider=e,e.Consumer={$$typeof:f,_context:e},e},z.createElement=function(e,a,S){var $,A={},P=null;if(a!=null)for($ in a.key!==void 0&&(P=""+a.key),a)se.call(a,$)&&$!=="key"&&$!=="__self"&&$!=="__source"&&(A[$]=a[$]);var R=arguments.length-2;if(R===1)A.children=S;else if(1<R){for(var X=Array(R),B=0;B<R;B++)X[B]=arguments[B+2];A.children=X}if(e&&e.defaultProps)for($ in R=e.defaultProps,R)A[$]===void 0&&(A[$]=R[$]);return te(e,P,void 0,void 0,null,A)},z.createRef=function(){return{current:null}},z.forwardRef=function(e){return{$$typeof:w,render:e}},z.isValidElement=u,z.lazy=function(e){return{$$typeof:h,_payload:{_status:-1,_result:e},_init:ee}},z.memo=function(e,a){return{$$typeof:r,type:e,compare:a===void 0?null:a}},z.startTransition=function(e){var a=N.T,S={};N.T=S;try{var $=e(),A=N.S;A!==null&&A(S,$),typeof $=="object"&&$!==null&&typeof $.then=="function"&&$.then(g,le)}catch(P){le(P)}finally{N.T=a}},z.unstable_useCacheRefresh=function(){return N.H.useCacheRefresh()},z.use=function(e){return N.H.use(e)},z.useActionState=function(e,a,S){return N.H.useActionState(e,a,S)},z.useCallback=function(e,a){return N.H.useCallback(e,a)},z.useContext=function(e){return N.H.useContext(e)},z.useDebugValue=function(){},z.useDeferredValue=function(e,a){return N.H.useDeferredValue(e,a)},z.useEffect=function(e,a,S){var $=N.H;if(typeof S=="function")throw Error("useEffect CRUD overload is not enabled in this build of React.");return $.useEffect(e,a)},z.useId=function(){return N.H.useId()},z.useImperativeHandle=function(e,a,S){return N.H.useImperativeHandle(e,a,S)},z.useInsertionEffect=function(e,a){return N.H.useInsertionEffect(e,a)},z.useLayoutEffect=function(e,a){return N.H.useLayoutEffect(e,a)},z.useMemo=function(e,a){return N.H.useMemo(e,a)},z.useOptimistic=function(e,a){return N.H.useOptimistic(e,a)},z.useReducer=function(e,a,S){return N.H.useReducer(e,a,S)},z.useRef=function(e){return N.H.useRef(e)},z.useState=function(e){return N.H.useState(e)},z.useSyncExternalStore=function(e,a,S){return N.H.useSyncExternalStore(e,a,S)},z.useTransition=function(){return N.H.useTransition()},z.version="19.1.1",z}var Ge;function nt(){return Ge||(Ge=1,De.exports=Xs()),De.exports}var Ks=nt();const ve=dt(Ks);var ze={exports:{}},Z={};/**
 * @license React
 * react-dom.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Qe;function Zs(){if(Qe)return Z;Qe=1;var H=nt();function y(d){var r="https://react.dev/errors/"+d;if(1<arguments.length){r+="?args[]="+encodeURIComponent(arguments[1]);for(var h=2;h<arguments.length;h++)r+="&args[]="+encodeURIComponent(arguments[h])}return"Minified React error #"+d+"; visit "+r+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function i(){}var m={d:{f:i,r:function(){throw Error(y(522))},D:i,C:i,L:i,m:i,X:i,S:i,M:i},p:0,findDOMNode:null},v=Symbol.for("react.portal");function f(d,r,h){var T=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:v,key:T==null?null:""+T,children:d,containerInfo:r,implementation:h}}var b=H.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE;function w(d,r){if(d==="font")return"";if(typeof r=="string")return r==="use-credentials"?r:""}return Z.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=m,Z.createPortal=function(d,r){var h=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!r||r.nodeType!==1&&r.nodeType!==9&&r.nodeType!==11)throw Error(y(299));return f(d,r,null,h)},Z.flushSync=function(d){var r=b.T,h=m.p;try{if(b.T=null,m.p=2,d)return d()}finally{b.T=r,m.p=h,m.d.f()}},Z.preconnect=function(d,r){typeof d=="string"&&(r?(r=r.crossOrigin,r=typeof r=="string"?r==="use-credentials"?r:"":void 0):r=null,m.d.C(d,r))},Z.prefetchDNS=function(d){typeof d=="string"&&m.d.D(d)},Z.preinit=function(d,r){if(typeof d=="string"&&r&&typeof r.as=="string"){var h=r.as,T=w(h,r.crossOrigin),I=typeof r.integrity=="string"?r.integrity:void 0,E=typeof r.fetchPriority=="string"?r.fetchPriority:void 0;h==="style"?m.d.S(d,typeof r.precedence=="string"?r.precedence:void 0,{crossOrigin:T,integrity:I,fetchPriority:E}):h==="script"&&m.d.X(d,{crossOrigin:T,integrity:I,fetchPriority:E,nonce:typeof r.nonce=="string"?r.nonce:void 0})}},Z.preinitModule=function(d,r){if(typeof d=="string")if(typeof r=="object"&&r!==null){if(r.as==null||r.as==="script"){var h=w(r.as,r.crossOrigin);m.d.M(d,{crossOrigin:h,integrity:typeof r.integrity=="string"?r.integrity:void 0,nonce:typeof r.nonce=="string"?r.nonce:void 0})}}else r==null&&m.d.M(d)},Z.preload=function(d,r){if(typeof d=="string"&&typeof r=="object"&&r!==null&&typeof r.as=="string"){var h=r.as,T=w(h,r.crossOrigin);m.d.L(d,h,{crossOrigin:T,integrity:typeof r.integrity=="string"?r.integrity:void 0,nonce:typeof r.nonce=="string"?r.nonce:void 0,type:typeof r.type=="string"?r.type:void 0,fetchPriority:typeof r.fetchPriority=="string"?r.fetchPriority:void 0,referrerPolicy:typeof r.referrerPolicy=="string"?r.referrerPolicy:void 0,imageSrcSet:typeof r.imageSrcSet=="string"?r.imageSrcSet:void 0,imageSizes:typeof r.imageSizes=="string"?r.imageSizes:void 0,media:typeof r.media=="string"?r.media:void 0})}},Z.preloadModule=function(d,r){if(typeof d=="string")if(r){var h=w(r.as,r.crossOrigin);m.d.m(d,{as:typeof r.as=="string"&&r.as!=="script"?r.as:void 0,crossOrigin:h,integrity:typeof r.integrity=="string"?r.integrity:void 0})}else m.d.m(d)},Z.requestFormReset=function(d){m.d.r(d)},Z.unstable_batchedUpdates=function(d,r){return d(r)},Z.useFormState=function(d,r,h){return b.H.useFormState(d,r,h)},Z.useFormStatus=function(){return b.H.useHostTransitionStatus()},Z.version="19.1.1",Z}var We;function Js(){if(We)return ze.exports;We=1;function H(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(H)}catch(y){console.error(y)}}return H(),ze.exports=Zs(),ze.exports}Js();function ea(H){if(typeof document>"u")return;let y=document.head||document.getElementsByTagName("head")[0],i=document.createElement("style");i.type="text/css",y.appendChild(i),i.styleSheet?i.styleSheet.cssText=H:i.appendChild(document.createTextNode(H))}Array(12).fill(0);let Oe=1;class ta{constructor(){this.subscribe=y=>(this.subscribers.push(y),()=>{const i=this.subscribers.indexOf(y);this.subscribers.splice(i,1)}),this.publish=y=>{this.subscribers.forEach(i=>i(y))},this.addToast=y=>{this.publish(y),this.toasts=[...this.toasts,y]},this.create=y=>{var i;const{message:m,...v}=y,f=typeof y?.id=="number"||((i=y.id)==null?void 0:i.length)>0?y.id:Oe++,b=this.toasts.find(d=>d.id===f),w=y.dismissible===void 0?!0:y.dismissible;return this.dismissedToasts.has(f)&&this.dismissedToasts.delete(f),b?this.toasts=this.toasts.map(d=>d.id===f?(this.publish({...d,...y,id:f,title:m}),{...d,...y,id:f,dismissible:w,title:m}):d):this.addToast({title:m,...v,dismissible:w,id:f}),f},this.dismiss=y=>(y?(this.dismissedToasts.add(y),requestAnimationFrame(()=>this.subscribers.forEach(i=>i({id:y,dismiss:!0})))):this.toasts.forEach(i=>{this.subscribers.forEach(m=>m({id:i.id,dismiss:!0}))}),y),this.message=(y,i)=>this.create({...i,message:y}),this.error=(y,i)=>this.create({...i,message:y,type:"error"}),this.success=(y,i)=>this.create({...i,type:"success",message:y}),this.info=(y,i)=>this.create({...i,type:"info",message:y}),this.warning=(y,i)=>this.create({...i,type:"warning",message:y}),this.loading=(y,i)=>this.create({...i,type:"loading",message:y}),this.promise=(y,i)=>{if(!i)return;let m;i.loading!==void 0&&(m=this.create({...i,promise:y,type:"loading",message:i.loading,description:typeof i.description!="function"?i.description:void 0}));const v=Promise.resolve(y instanceof Function?y():y);let f=m!==void 0,b;const w=v.then(async r=>{if(b=["resolve",r],ve.isValidElement(r))f=!1,this.create({id:m,type:"default",message:r});else if(aa(r)&&!r.ok){f=!1;const T=typeof i.error=="function"?await i.error(`HTTP error! status: ${r.status}`):i.error,I=typeof i.description=="function"?await i.description(`HTTP error! status: ${r.status}`):i.description,O=typeof T=="object"&&!ve.isValidElement(T)?T:{message:T};this.create({id:m,type:"error",description:I,...O})}else if(r instanceof Error){f=!1;const T=typeof i.error=="function"?await i.error(r):i.error,I=typeof i.description=="function"?await i.description(r):i.description,O=typeof T=="object"&&!ve.isValidElement(T)?T:{message:T};this.create({id:m,type:"error",description:I,...O})}else if(i.success!==void 0){f=!1;const T=typeof i.success=="function"?await i.success(r):i.success,I=typeof i.description=="function"?await i.description(r):i.description,O=typeof T=="object"&&!ve.isValidElement(T)?T:{message:T};this.create({id:m,type:"success",description:I,...O})}}).catch(async r=>{if(b=["reject",r],i.error!==void 0){f=!1;const h=typeof i.error=="function"?await i.error(r):i.error,T=typeof i.description=="function"?await i.description(r):i.description,E=typeof h=="object"&&!ve.isValidElement(h)?h:{message:h};this.create({id:m,type:"error",description:T,...E})}}).finally(()=>{f&&(this.dismiss(m),m=void 0),i.finally==null||i.finally.call(i)}),d=()=>new Promise((r,h)=>w.then(()=>b[0]==="reject"?h(b[1]):r(b[1])).catch(h));return typeof m!="string"&&typeof m!="number"?{unwrap:d}:Object.assign(m,{unwrap:d})},this.custom=(y,i)=>{const m=i?.id||Oe++;return this.create({jsx:y(m),id:m,...i}),m},this.getActiveToasts=()=>this.toasts.filter(y=>!this.dismissedToasts.has(y.id)),this.subscribers=[],this.toasts=[],this.dismissedToasts=new Set}}const oe=new ta,sa=(H,y)=>{const i=y?.id||Oe++;return oe.addToast({title:H,...y,id:i}),i},aa=H=>H&&typeof H=="object"&&"ok"in H&&typeof H.ok=="boolean"&&"status"in H&&typeof H.status=="number",oa=sa,ra=()=>oe.toasts,na=()=>oe.getActiveToasts(),de=Object.assign(oa,{success:oe.success,info:oe.info,warning:oe.warning,error:oe.error,custom:oe.custom,message:oe.message,promise:oe.promise,dismiss:oe.dismiss,loading:oe.loading},{getHistory:ra,getToasts:na});ea("[data-sonner-toaster][dir=ltr],html[dir=ltr]{--toast-icon-margin-start:-3px;--toast-icon-margin-end:4px;--toast-svg-margin-start:-1px;--toast-svg-margin-end:0px;--toast-button-margin-start:auto;--toast-button-margin-end:0;--toast-close-button-start:0;--toast-close-button-end:unset;--toast-close-button-transform:translate(-35%, -35%)}[data-sonner-toaster][dir=rtl],html[dir=rtl]{--toast-icon-margin-start:4px;--toast-icon-margin-end:-3px;--toast-svg-margin-start:0px;--toast-svg-margin-end:-1px;--toast-button-margin-start:0;--toast-button-margin-end:auto;--toast-close-button-start:unset;--toast-close-button-end:0;--toast-close-button-transform:translate(35%, -35%)}[data-sonner-toaster]{position:fixed;width:var(--width);font-family:ui-sans-serif,system-ui,-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Helvetica Neue,Arial,Noto Sans,sans-serif,Apple Color Emoji,Segoe UI Emoji,Segoe UI Symbol,Noto Color Emoji;--gray1:hsl(0, 0%, 99%);--gray2:hsl(0, 0%, 97.3%);--gray3:hsl(0, 0%, 95.1%);--gray4:hsl(0, 0%, 93%);--gray5:hsl(0, 0%, 90.9%);--gray6:hsl(0, 0%, 88.7%);--gray7:hsl(0, 0%, 85.8%);--gray8:hsl(0, 0%, 78%);--gray9:hsl(0, 0%, 56.1%);--gray10:hsl(0, 0%, 52.3%);--gray11:hsl(0, 0%, 43.5%);--gray12:hsl(0, 0%, 9%);--border-radius:8px;box-sizing:border-box;padding:0;margin:0;list-style:none;outline:0;z-index:999999999;transition:transform .4s ease}@media (hover:none) and (pointer:coarse){[data-sonner-toaster][data-lifted=true]{transform:none}}[data-sonner-toaster][data-x-position=right]{right:var(--offset-right)}[data-sonner-toaster][data-x-position=left]{left:var(--offset-left)}[data-sonner-toaster][data-x-position=center]{left:50%;transform:translateX(-50%)}[data-sonner-toaster][data-y-position=top]{top:var(--offset-top)}[data-sonner-toaster][data-y-position=bottom]{bottom:var(--offset-bottom)}[data-sonner-toast]{--y:translateY(100%);--lift-amount:calc(var(--lift) * var(--gap));z-index:var(--z-index);position:absolute;opacity:0;transform:var(--y);touch-action:none;transition:transform .4s,opacity .4s,height .4s,box-shadow .2s;box-sizing:border-box;outline:0;overflow-wrap:anywhere}[data-sonner-toast][data-styled=true]{padding:16px;background:var(--normal-bg);border:1px solid var(--normal-border);color:var(--normal-text);border-radius:var(--border-radius);box-shadow:0 4px 12px rgba(0,0,0,.1);width:var(--width);font-size:13px;display:flex;align-items:center;gap:6px}[data-sonner-toast]:focus-visible{box-shadow:0 4px 12px rgba(0,0,0,.1),0 0 0 2px rgba(0,0,0,.2)}[data-sonner-toast][data-y-position=top]{top:0;--y:translateY(-100%);--lift:1;--lift-amount:calc(1 * var(--gap))}[data-sonner-toast][data-y-position=bottom]{bottom:0;--y:translateY(100%);--lift:-1;--lift-amount:calc(var(--lift) * var(--gap))}[data-sonner-toast][data-styled=true] [data-description]{font-weight:400;line-height:1.4;color:#3f3f3f}[data-rich-colors=true][data-sonner-toast][data-styled=true] [data-description]{color:inherit}[data-sonner-toaster][data-sonner-theme=dark] [data-description]{color:#e8e8e8}[data-sonner-toast][data-styled=true] [data-title]{font-weight:500;line-height:1.5;color:inherit}[data-sonner-toast][data-styled=true] [data-icon]{display:flex;height:16px;width:16px;position:relative;justify-content:flex-start;align-items:center;flex-shrink:0;margin-left:var(--toast-icon-margin-start);margin-right:var(--toast-icon-margin-end)}[data-sonner-toast][data-promise=true] [data-icon]>svg{opacity:0;transform:scale(.8);transform-origin:center;animation:sonner-fade-in .3s ease forwards}[data-sonner-toast][data-styled=true] [data-icon]>*{flex-shrink:0}[data-sonner-toast][data-styled=true] [data-icon] svg{margin-left:var(--toast-svg-margin-start);margin-right:var(--toast-svg-margin-end)}[data-sonner-toast][data-styled=true] [data-content]{display:flex;flex-direction:column;gap:2px}[data-sonner-toast][data-styled=true] [data-button]{border-radius:4px;padding-left:8px;padding-right:8px;height:24px;font-size:12px;color:var(--normal-bg);background:var(--normal-text);margin-left:var(--toast-button-margin-start);margin-right:var(--toast-button-margin-end);border:none;font-weight:500;cursor:pointer;outline:0;display:flex;align-items:center;flex-shrink:0;transition:opacity .4s,box-shadow .2s}[data-sonner-toast][data-styled=true] [data-button]:focus-visible{box-shadow:0 0 0 2px rgba(0,0,0,.4)}[data-sonner-toast][data-styled=true] [data-button]:first-of-type{margin-left:var(--toast-button-margin-start);margin-right:var(--toast-button-margin-end)}[data-sonner-toast][data-styled=true] [data-cancel]{color:var(--normal-text);background:rgba(0,0,0,.08)}[data-sonner-toaster][data-sonner-theme=dark] [data-sonner-toast][data-styled=true] [data-cancel]{background:rgba(255,255,255,.3)}[data-sonner-toast][data-styled=true] [data-close-button]{position:absolute;left:var(--toast-close-button-start);right:var(--toast-close-button-end);top:0;height:20px;width:20px;display:flex;justify-content:center;align-items:center;padding:0;color:var(--gray12);background:var(--normal-bg);border:1px solid var(--gray4);transform:var(--toast-close-button-transform);border-radius:50%;cursor:pointer;z-index:1;transition:opacity .1s,background .2s,border-color .2s}[data-sonner-toast][data-styled=true] [data-close-button]:focus-visible{box-shadow:0 4px 12px rgba(0,0,0,.1),0 0 0 2px rgba(0,0,0,.2)}[data-sonner-toast][data-styled=true] [data-disabled=true]{cursor:not-allowed}[data-sonner-toast][data-styled=true]:hover [data-close-button]:hover{background:var(--gray2);border-color:var(--gray5)}[data-sonner-toast][data-swiping=true]::before{content:'';position:absolute;left:-100%;right:-100%;height:100%;z-index:-1}[data-sonner-toast][data-y-position=top][data-swiping=true]::before{bottom:50%;transform:scaleY(3) translateY(50%)}[data-sonner-toast][data-y-position=bottom][data-swiping=true]::before{top:50%;transform:scaleY(3) translateY(-50%)}[data-sonner-toast][data-swiping=false][data-removed=true]::before{content:'';position:absolute;inset:0;transform:scaleY(2)}[data-sonner-toast][data-expanded=true]::after{content:'';position:absolute;left:0;height:calc(var(--gap) + 1px);bottom:100%;width:100%}[data-sonner-toast][data-mounted=true]{--y:translateY(0);opacity:1}[data-sonner-toast][data-expanded=false][data-front=false]{--scale:var(--toasts-before) * 0.05 + 1;--y:translateY(calc(var(--lift-amount) * var(--toasts-before))) scale(calc(-1 * var(--scale)));height:var(--front-toast-height)}[data-sonner-toast]>*{transition:opacity .4s}[data-sonner-toast][data-x-position=right]{right:0}[data-sonner-toast][data-x-position=left]{left:0}[data-sonner-toast][data-expanded=false][data-front=false][data-styled=true]>*{opacity:0}[data-sonner-toast][data-visible=false]{opacity:0;pointer-events:none}[data-sonner-toast][data-mounted=true][data-expanded=true]{--y:translateY(calc(var(--lift) * var(--offset)));height:var(--initial-height)}[data-sonner-toast][data-removed=true][data-front=true][data-swipe-out=false]{--y:translateY(calc(var(--lift) * -100%));opacity:0}[data-sonner-toast][data-removed=true][data-front=false][data-swipe-out=false][data-expanded=true]{--y:translateY(calc(var(--lift) * var(--offset) + var(--lift) * -100%));opacity:0}[data-sonner-toast][data-removed=true][data-front=false][data-swipe-out=false][data-expanded=false]{--y:translateY(40%);opacity:0;transition:transform .5s,opacity .2s}[data-sonner-toast][data-removed=true][data-front=false]::before{height:calc(var(--initial-height) + 20%)}[data-sonner-toast][data-swiping=true]{transform:var(--y) translateY(var(--swipe-amount-y,0)) translateX(var(--swipe-amount-x,0));transition:none}[data-sonner-toast][data-swiped=true]{user-select:none}[data-sonner-toast][data-swipe-out=true][data-y-position=bottom],[data-sonner-toast][data-swipe-out=true][data-y-position=top]{animation-duration:.2s;animation-timing-function:ease-out;animation-fill-mode:forwards}[data-sonner-toast][data-swipe-out=true][data-swipe-direction=left]{animation-name:swipe-out-left}[data-sonner-toast][data-swipe-out=true][data-swipe-direction=right]{animation-name:swipe-out-right}[data-sonner-toast][data-swipe-out=true][data-swipe-direction=up]{animation-name:swipe-out-up}[data-sonner-toast][data-swipe-out=true][data-swipe-direction=down]{animation-name:swipe-out-down}@keyframes swipe-out-left{from{transform:var(--y) translateX(var(--swipe-amount-x));opacity:1}to{transform:var(--y) translateX(calc(var(--swipe-amount-x) - 100%));opacity:0}}@keyframes swipe-out-right{from{transform:var(--y) translateX(var(--swipe-amount-x));opacity:1}to{transform:var(--y) translateX(calc(var(--swipe-amount-x) + 100%));opacity:0}}@keyframes swipe-out-up{from{transform:var(--y) translateY(var(--swipe-amount-y));opacity:1}to{transform:var(--y) translateY(calc(var(--swipe-amount-y) - 100%));opacity:0}}@keyframes swipe-out-down{from{transform:var(--y) translateY(var(--swipe-amount-y));opacity:1}to{transform:var(--y) translateY(calc(var(--swipe-amount-y) + 100%));opacity:0}}@media (max-width:600px){[data-sonner-toaster]{position:fixed;right:var(--mobile-offset-right);left:var(--mobile-offset-left);width:100%}[data-sonner-toaster][dir=rtl]{left:calc(var(--mobile-offset-left) * -1)}[data-sonner-toaster] [data-sonner-toast]{left:0;right:0;width:calc(100% - var(--mobile-offset-left) * 2)}[data-sonner-toaster][data-x-position=left]{left:var(--mobile-offset-left)}[data-sonner-toaster][data-y-position=bottom]{bottom:var(--mobile-offset-bottom)}[data-sonner-toaster][data-y-position=top]{top:var(--mobile-offset-top)}[data-sonner-toaster][data-x-position=center]{left:var(--mobile-offset-left);right:var(--mobile-offset-right);transform:none}}[data-sonner-toaster][data-sonner-theme=light]{--normal-bg:#fff;--normal-border:var(--gray4);--normal-text:var(--gray12);--success-bg:hsl(143, 85%, 96%);--success-border:hsl(145, 92%, 87%);--success-text:hsl(140, 100%, 27%);--info-bg:hsl(208, 100%, 97%);--info-border:hsl(221, 91%, 93%);--info-text:hsl(210, 92%, 45%);--warning-bg:hsl(49, 100%, 97%);--warning-border:hsl(49, 91%, 84%);--warning-text:hsl(31, 92%, 45%);--error-bg:hsl(359, 100%, 97%);--error-border:hsl(359, 100%, 94%);--error-text:hsl(360, 100%, 45%)}[data-sonner-toaster][data-sonner-theme=light] [data-sonner-toast][data-invert=true]{--normal-bg:#000;--normal-border:hsl(0, 0%, 20%);--normal-text:var(--gray1)}[data-sonner-toaster][data-sonner-theme=dark] [data-sonner-toast][data-invert=true]{--normal-bg:#fff;--normal-border:var(--gray3);--normal-text:var(--gray12)}[data-sonner-toaster][data-sonner-theme=dark]{--normal-bg:#000;--normal-bg-hover:hsl(0, 0%, 12%);--normal-border:hsl(0, 0%, 20%);--normal-border-hover:hsl(0, 0%, 25%);--normal-text:var(--gray1);--success-bg:hsl(150, 100%, 6%);--success-border:hsl(147, 100%, 12%);--success-text:hsl(150, 86%, 65%);--info-bg:hsl(215, 100%, 6%);--info-border:hsl(223, 43%, 17%);--info-text:hsl(216, 87%, 65%);--warning-bg:hsl(64, 100%, 6%);--warning-border:hsl(60, 100%, 9%);--warning-text:hsl(46, 87%, 65%);--error-bg:hsl(358, 76%, 10%);--error-border:hsl(357, 89%, 16%);--error-text:hsl(358, 100%, 81%)}[data-sonner-toaster][data-sonner-theme=dark] [data-sonner-toast] [data-close-button]{background:var(--normal-bg);border-color:var(--normal-border);color:var(--normal-text)}[data-sonner-toaster][data-sonner-theme=dark] [data-sonner-toast] [data-close-button]:hover{background:var(--normal-bg-hover);border-color:var(--normal-border-hover)}[data-rich-colors=true][data-sonner-toast][data-type=success]{background:var(--success-bg);border-color:var(--success-border);color:var(--success-text)}[data-rich-colors=true][data-sonner-toast][data-type=success] [data-close-button]{background:var(--success-bg);border-color:var(--success-border);color:var(--success-text)}[data-rich-colors=true][data-sonner-toast][data-type=info]{background:var(--info-bg);border-color:var(--info-border);color:var(--info-text)}[data-rich-colors=true][data-sonner-toast][data-type=info] [data-close-button]{background:var(--info-bg);border-color:var(--info-border);color:var(--info-text)}[data-rich-colors=true][data-sonner-toast][data-type=warning]{background:var(--warning-bg);border-color:var(--warning-border);color:var(--warning-text)}[data-rich-colors=true][data-sonner-toast][data-type=warning] [data-close-button]{background:var(--warning-bg);border-color:var(--warning-border);color:var(--warning-text)}[data-rich-colors=true][data-sonner-toast][data-type=error]{background:var(--error-bg);border-color:var(--error-border);color:var(--error-text)}[data-rich-colors=true][data-sonner-toast][data-type=error] [data-close-button]{background:var(--error-bg);border-color:var(--error-border);color:var(--error-text)}.sonner-loading-wrapper{--size:16px;height:var(--size);width:var(--size);position:absolute;inset:0;z-index:10}.sonner-loading-wrapper[data-visible=false]{transform-origin:center;animation:sonner-fade-out .2s ease forwards}.sonner-spinner{position:relative;top:50%;left:50%;height:var(--size);width:var(--size)}.sonner-loading-bar{animation:sonner-spin 1.2s linear infinite;background:var(--gray11);border-radius:6px;height:8%;left:-10%;position:absolute;top:-3.9%;width:24%}.sonner-loading-bar:first-child{animation-delay:-1.2s;transform:rotate(.0001deg) translate(146%)}.sonner-loading-bar:nth-child(2){animation-delay:-1.1s;transform:rotate(30deg) translate(146%)}.sonner-loading-bar:nth-child(3){animation-delay:-1s;transform:rotate(60deg) translate(146%)}.sonner-loading-bar:nth-child(4){animation-delay:-.9s;transform:rotate(90deg) translate(146%)}.sonner-loading-bar:nth-child(5){animation-delay:-.8s;transform:rotate(120deg) translate(146%)}.sonner-loading-bar:nth-child(6){animation-delay:-.7s;transform:rotate(150deg) translate(146%)}.sonner-loading-bar:nth-child(7){animation-delay:-.6s;transform:rotate(180deg) translate(146%)}.sonner-loading-bar:nth-child(8){animation-delay:-.5s;transform:rotate(210deg) translate(146%)}.sonner-loading-bar:nth-child(9){animation-delay:-.4s;transform:rotate(240deg) translate(146%)}.sonner-loading-bar:nth-child(10){animation-delay:-.3s;transform:rotate(270deg) translate(146%)}.sonner-loading-bar:nth-child(11){animation-delay:-.2s;transform:rotate(300deg) translate(146%)}.sonner-loading-bar:nth-child(12){animation-delay:-.1s;transform:rotate(330deg) translate(146%)}@keyframes sonner-fade-in{0%{opacity:0;transform:scale(.8)}100%{opacity:1;transform:scale(1)}}@keyframes sonner-fade-out{0%{opacity:1;transform:scale(1)}100%{opacity:0;transform:scale(.8)}}@keyframes sonner-spin{0%{opacity:1}100%{opacity:.15}}@media (prefers-reduced-motion){.sonner-loading-bar,[data-sonner-toast],[data-sonner-toast]>*{transition:none!important;animation:none!important}}.sonner-loader{position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);transform-origin:center;transition:opacity .2s,transform .2s}.sonner-loader[data-visible=false]{opacity:0;transform:scale(.8) translate(-50%,-50%)}");const ia={class:"chat-history"},la={class:"flex items-center justify-between mb-4"},da={class:"flex items-center gap-2"},ua={class:"flex items-center gap-2"},ca={key:0,class:"flex items-center justify-center py-8"},fa={key:1,class:"text-center py-8"},pa={class:"text-muted-foreground"},ma={key:2,class:"space-y-4"},ga={class:"flex items-center justify-between p-4 border-b bg-muted/30"},va={class:"flex-1"},ha={class:"font-medium text-sm truncate"},ya={class:"flex items-center gap-4 text-xs text-muted-foreground mt-1"},ba={class:"flex items-center gap-2"},xa={key:0,class:"p-4 space-y-3 max-h-96 overflow-y-auto"},wa={class:"flex items-center justify-between mt-2 pt-2 border-t border-current/20"},_a={class:"text-xs opacity-70"},ka={key:3,class:"flex items-center justify-between mt-6"},Ca={class:"text-sm text-muted-foreground"},Sa={key:1,class:"animate-spin rounded-full h-4 w-4 border-b-2 border-current mr-2"},Ta={key:1,class:"animate-spin rounded-full h-4 w-4 border-b-2 border-current mr-2"},$a={key:1,class:"animate-spin rounded-full h-4 w-4 border-b-2 border-current mr-2"},Ea=ge({__name:"ChatHistory",props:{projectSlug:{},chapterNumber:{}},emits:["chat-deleted","chat-cleared"],setup(H,{emit:y}){const i=H,m=y,v=D([]),f=D(!1),b=D(!1),w=D(1),d=D(1),r=D(0),h=ut(new Set),T=D(!1),I=D(!1),E=D(!1),O=D(null),W=D(null),V=async(u=1)=>{f.value=!0;try{const p=await(await fetch(`/projects/${i.projectSlug}/chapters/${i.chapterNumber}/chat/sessions?page=${u}&per_page=10`)).json();if(p.success)v.value=p.sessions,w.value=p.page,d.value=p.total_pages,r.value=p.total_sessions;else throw new Error(p.error||"Failed to load chat history")}catch(o){console.error("Failed to load chat history:",o),de.error("Failed to load chat history")}finally{f.value=!1}},J=u=>{u>=1&&u<=d.value&&V(u)},U=()=>{V(w.value)},K=u=>{h.has(u)?h.delete(u):h.add(u)},q=u=>{O.value=u,T.value=!0},N=(u,o)=>{W.value=u,O.value=o,I.value=!0},se=async()=>{if(O.value){b.value=!0;try{const o=await(await fetch(`/projects/${i.projectSlug}/chapters/${i.chapterNumber}/chat/sessions/${O.value.session_id}`,{method:"DELETE",headers:{"X-CSRF-TOKEN":document.querySelector('meta[name="csrf-token"]')?.getAttribute("content")||"",Accept:"application/json"}})).json();if(o.success)de.success(o.message),T.value=!1,O.value=null,m("chat-deleted"),V(w.value);else throw new Error(o.error||"Failed to delete session")}catch(u){console.error("Failed to delete session:",u),de.error("Failed to delete chat session")}finally{b.value=!1}}},te=async()=>{if(W.value){b.value=!0;try{const o=await(await fetch(`/projects/${i.projectSlug}/chapters/${i.chapterNumber}/chat/messages/${W.value.id}`,{method:"DELETE",headers:{"X-CSRF-TOKEN":document.querySelector('meta[name="csrf-token"]')?.getAttribute("content")||"",Accept:"application/json"}})).json();if(o.success)de.success(o.message),I.value=!1,W.value=null,V(w.value);else throw new Error(o.error||"Failed to delete message")}catch(u){console.error("Failed to delete message:",u),de.error("Failed to delete message")}finally{b.value=!1}}},ae=async()=>{b.value=!0;try{const o=await(await fetch(`/projects/${i.projectSlug}/chapters/${i.chapterNumber}/chat/clear`,{method:"DELETE",headers:{"X-CSRF-TOKEN":document.querySelector('meta[name="csrf-token"]')?.getAttribute("content")||"",Accept:"application/json"}})).json();if(o.success)de.success(o.message),E.value=!1,m("chat-cleared"),v.value=[],r.value=0,d.value=1,w.value=1,h.clear();else throw new Error(o.error||"Failed to clear history")}catch(u){console.error("Failed to clear history:",u),de.error("Failed to clear chat history")}finally{b.value=!1}};return Ne(()=>{V()}),(u,o)=>(c(),_("div",ia,[n("div",la,[n("div",da,[s(t(Ie),{class:"h-5 w-5 text-muted-foreground"}),o[9]||(o[9]=n("h3",{class:"text-lg font-semibold"},"Chat History",-1))]),n("div",ua,[s(t(k),{variant:"outline",size:"sm",onClick:U,disabled:f.value},{default:l(()=>[s(t(Je),{class:"h-4 w-4"}),o[10]||(o[10]=C(" Refresh ",-1))]),_:1},8,["disabled"]),s(t(k),{variant:"destructive",size:"sm",onClick:o[0]||(o[0]=p=>E.value=!0),disabled:v.value.length===0||f.value},{default:l(()=>[s(t(fe),{class:"h-4 w-4"}),o[11]||(o[11]=C(" Clear All ",-1))]),_:1},8,["disabled"])])]),f.value?(c(),_("div",ca,[...o[12]||(o[12]=[n("div",{class:"flex items-center gap-2 text-muted-foreground"},[n("div",{class:"animate-spin rounded-full h-4 w-4 border-b-2 border-current"}),C(" Loading chat history... ")],-1)])])):v.value.length===0?(c(),_("div",fa,[n("div",pa,[s(t(Gt),{class:"h-12 w-12 mx-auto mb-2 opacity-50"}),o[13]||(o[13]=n("p",{class:"text-lg"},"No chat history yet",-1)),o[14]||(o[14]=n("p",{class:"text-sm"},"Start a conversation to see your chat history here.",-1))])])):(c(),_("div",ma,[(c(!0),_(be,null,xe(v.value,p=>(c(),_("div",{key:p.session_id,class:"border rounded-lg"},[n("div",ga,[n("div",va,[n("div",ha,[s(we,{content:p.title,class:"prose prose-sm max-w-none prose-headings:text-sm prose-headings:m-0 prose-p:m-0 prose-p:text-sm"},null,8,["content"])]),n("div",ya,[n("span",null,j(p.started_at),1),n("span",null,j(p.message_count)+" messages",1),n("span",null,j(p.duration),1)])]),n("div",ba,[s(t(k),{variant:"ghost",size:"sm",onClick:F=>K(p.session_id)},{default:l(()=>[s(t(Et),{class:Q(["h-4 w-4 transition-transform",{"rotate-180":h.has(p.session_id)}])},null,8,["class"])]),_:2},1032,["onClick"]),s(t(k),{variant:"ghost",size:"sm",onClick:F=>q(p)},{default:l(()=>[s(t(fe),{class:"h-4 w-4 text-destructive"})]),_:2},1032,["onClick"])])]),h.has(p.session_id)?(c(),_("div",xa,[(c(!0),_(be,null,xe(p.messages,F=>(c(),_("div",{key:F.id,class:Q(["flex gap-3 group",F.message_type==="user"?"justify-end":"justify-start"])},[n("div",{class:Q(["max-w-[80%] rounded-lg p-3 text-sm",F.message_type==="user"?"bg-primary text-primary-foreground":"bg-muted"])},[s(we,{content:F.content,class:Q(["prose prose-sm max-w-none",F.message_type==="user"?"chat-message-user prose-invert":"chat-message-ai"])},null,8,["content","class"]),n("div",wa,[n("div",_a,j(F.formatted_time),1),s(t(k),{variant:"ghost",size:"sm",class:"opacity-0 group-hover:opacity-100 transition-opacity h-6 w-6 p-0",onClick:re=>N(F,p)},{default:l(()=>[s(t(fe),{class:"h-3 w-3"})]),_:2},1032,["onClick"])])],2)],2))),128))])):L("",!0)]))),128))])),d.value>1?(c(),_("div",ka,[s(t(k),{variant:"outline",size:"sm",onClick:o[1]||(o[1]=p=>J(w.value-1)),disabled:w.value===1||f.value},{default:l(()=>[s(t(at),{class:"h-4 w-4"}),o[15]||(o[15]=C(" Previous ",-1))]),_:1},8,["disabled"]),n("span",Ca," Page "+j(w.value)+" of "+j(d.value),1),s(t(k),{variant:"outline",size:"sm",onClick:o[2]||(o[2]=p=>J(w.value+1)),disabled:w.value===d.value||f.value},{default:l(()=>[o[16]||(o[16]=C(" Next ",-1)),s(t(ot),{class:"h-4 w-4"})]),_:1},8,["disabled"])])):L("",!0),s(t(Te),{open:T.value,"onUpdate:open":o[4]||(o[4]=p=>T.value=p)},{default:l(()=>[s(t($e),null,{default:l(()=>[s(t(je),null,{default:l(()=>[s(t(Me),null,{default:l(()=>[...o[17]||(o[17]=[C("Delete Chat Session",-1)])]),_:1}),s(t(Ee),null,{default:l(()=>[C(" Are you sure you want to delete this chat session? This will permanently remove "+j(O.value?.message_count)+" messages. This action cannot be undone. ",1)]),_:1})]),_:1}),s(t(Re),null,{default:l(()=>[s(t(k),{variant:"outline",onClick:o[3]||(o[3]=p=>T.value=!1)},{default:l(()=>[...o[18]||(o[18]=[C(" Cancel ",-1)])]),_:1}),s(t(k),{variant:"destructive",onClick:se,disabled:b.value},{default:l(()=>[b.value?(c(),_("div",Sa)):(c(),G(t(fe),{key:0,class:"h-4 w-4 mr-2"})),C(" "+j(b.value?"Deleting...":"Delete Session"),1)]),_:1},8,["disabled"])]),_:1})]),_:1})]),_:1},8,["open"]),s(t(Te),{open:I.value,"onUpdate:open":o[6]||(o[6]=p=>I.value=p)},{default:l(()=>[s(t($e),null,{default:l(()=>[s(t(je),null,{default:l(()=>[s(t(Me),null,{default:l(()=>[...o[19]||(o[19]=[C("Delete Message",-1)])]),_:1}),s(t(Ee),null,{default:l(()=>[...o[20]||(o[20]=[C(" Are you sure you want to delete this message? This action cannot be undone. ",-1)])]),_:1})]),_:1}),s(t(Re),null,{default:l(()=>[s(t(k),{variant:"outline",onClick:o[5]||(o[5]=p=>I.value=!1)},{default:l(()=>[...o[21]||(o[21]=[C(" Cancel ",-1)])]),_:1}),s(t(k),{variant:"destructive",onClick:te,disabled:b.value},{default:l(()=>[b.value?(c(),_("div",Ta)):(c(),G(t(fe),{key:0,class:"h-4 w-4 mr-2"})),C(" "+j(b.value?"Deleting...":"Delete Message"),1)]),_:1},8,["disabled"])]),_:1})]),_:1})]),_:1},8,["open"]),s(t(Te),{open:E.value,"onUpdate:open":o[8]||(o[8]=p=>E.value=p)},{default:l(()=>[s(t($e),null,{default:l(()=>[s(t(je),null,{default:l(()=>[s(t(Me),null,{default:l(()=>[...o[22]||(o[22]=[C("Clear All Chat History",-1)])]),_:1}),s(t(Ee),null,{default:l(()=>[C(" Are you sure you want to clear all chat history for this chapter? This will permanently delete all "+j(v.value.reduce((p,F)=>p+F.message_count,0))+" messages across "+j(v.value.length)+" sessions. This action cannot be undone. ",1)]),_:1})]),_:1}),s(t(Re),null,{default:l(()=>[s(t(k),{variant:"outline",onClick:o[7]||(o[7]=p=>E.value=!1)},{default:l(()=>[...o[23]||(o[23]=[C(" Cancel ",-1)])]),_:1}),s(t(k),{variant:"destructive",onClick:ae,disabled:b.value},{default:l(()=>[b.value?(c(),_("div",$a)):(c(),G(t(fe),{key:0,class:"h-4 w-4 mr-2"})),C(" "+j(b.value?"Clearing...":"Clear All History"),1)]),_:1},8,["disabled"])]),_:1})]),_:1})]),_:1},8,["open"])]))}}),Ra=_e(Ea,[["__scopeId","data-v-aca492d0"]]),ja={class:"flex items-center gap-3"},Ma={key:0,class:"flex items-center rounded-full border bg-muted/40 p-0.5 shadow-inner"},Da={class:"flex items-center gap-1"},za={key:0,class:"flex flex-1 flex-col items-center justify-center space-y-2 p-2"},Aa={key:1,class:"relative flex-1 overflow-hidden"},Pa={key:"search",class:"absolute inset-0 bg-background"},Oa={key:"history",class:"absolute inset-0 bg-background overflow-y-auto"},Na={class:"p-4"},Ia={key:"chat",class:"flex flex-col h-full"},Ha={class:Q(["flex-shrink-0 border-b bg-background px-4 py-3"])},Fa={class:"flex-shrink-0 border-b bg-muted/20 px-4 py-2"},La={class:"flex items-center gap-2"},Ua={class:"text-[10px] text-muted-foreground truncate"},Ya={key:0,class:"flex-shrink-0 border-b bg-blue-50/50 dark:bg-blue-950/20 px-4 py-2"},Ba={class:"flex items-start gap-3"},Va={class:"mt-0.5 p-1 rounded bg-blue-100 dark:bg-blue-900/50 text-blue-600 dark:text-blue-400"},qa={class:"min-w-0 flex-1"},Ga={class:"flex items-center justify-between mb-1"},Qa={class:"text-xs text-muted-foreground italic line-clamp-2 border-l-2 border-blue-200 dark:border-blue-800 pl-2"},Wa={key:0,class:"flex-shrink-0 border-b bg-orange-50 p-3 dark:bg-orange-950/20"},Xa={class:"min-h-full space-y-4 p-3"},Ka={key:0,class:"flex max-w-[90%] gap-3"},Za={class:"flex-1 min-w-0"},Ja={key:1,class:"flex items-center gap-2 py-1"},eo={key:2,class:"mt-3 flex items-center justify-between border-t border-border/40 pt-2 opacity-0 group-hover:opacity-100 transition-opacity duration-200"},to={class:"flex items-center gap-1"},so={key:3,class:"text-green-600"},ao={key:4},oo={key:5},ro={class:"mt-1.5 px-1 text-[10px] text-muted-foreground/50 opacity-0 group-hover:opacity-100 transition-opacity duration-300"},no={key:1,class:"flex max-w-[85%] gap-3 flex-row-reverse"},io={class:"mt-1 flex h-8 w-8 flex-shrink-0 items-center justify-center rounded-full bg-primary shadow-sm"},lo={class:"flex-1 text-right"},uo={class:"inline-block rounded-2xl rounded-tr-sm bg-primary px-6 py-4 text-primary-foreground shadow-md text-left"},co={class:"mt-1.5 px-1 text-[10px] text-muted-foreground/50 opacity-0 group-hover:opacity-100 transition-opacity duration-300"},fo={key:0,class:"flex gap-2"},po={class:"flex h-8 w-8 flex-shrink-0 items-center justify-center rounded-full bg-gradient-to-br from-indigo-500 to-violet-600 shadow-md"},mo={class:"flex-shrink-0 border-t bg-background/50 backdrop-blur-sm p-4"},go={class:"relative rounded-xl border bg-background shadow-sm focus-within:ring-2 focus-within:ring-primary/20 transition-all"},vo={class:"absolute right-2 bottom-2"},ho={class:"mt-2 flex items-center justify-between px-1"},yo={class:"flex items-center gap-2"},bo={key:0,class:"text-[10px] text-muted-foreground"},xo={key:1,class:"flex items-center gap-1.5 text-[10px] text-primary font-medium"},wo={class:"flex items-center gap-2"},_o=ge({__name:"ChatAssistant",props:{isMinimized:{type:Boolean},messages:{},isTyping:{type:Boolean},selectedText:{},chapterContent:{},chapterNumber:{},input:{},currentMode:{default:"assist"},projectSlug:{},sessionId:{},isMobile:{type:Boolean,default:!1}},emits:["update:input","send-message","quick-action","retry-message","stop-generation","toggle-minimize","change-mode","copy-message","rate-message","new-session","chat-deleted","chat-cleared"],setup(H,{emit:y}){const i=H,m=y,v=D(),f=D(),b=D(!1),w=D(!1),d=D(!1),r=D([]),h=ie(()=>i.selectedText.trim().length>0),T=ie(()=>i.messages.length),I=ie(()=>i.messages.reduce((g,e)=>g+e.content.length,0)),E=()=>{ke(()=>{setTimeout(()=>{try{const g=v.value;if(!g)return;const e=g.$el||g;if(!e)return;let a=e.querySelector("[data-radix-scroll-area-viewport]");if(a||(a=e.querySelector("[data-viewport]")),a||(a=e.querySelector('[role="region"]')),a||(a=e.querySelector('div[style*="overflow"]')),!a){const S=e.querySelectorAll("div");for(const $ of S){const A=window.getComputedStyle($);if(A.overflow==="auto"||A.overflow==="scroll"||A.overflowY==="auto"||A.overflowY==="scroll"){a=$;break}}}a?(console.log("Scrolling chat to bottom:",{scrollHeight:a.scrollHeight,clientHeight:a.clientHeight,currentScrollTop:a.scrollTop}),a.scrollTop=a.scrollHeight,a.scrollTo&&a.scrollTo({top:a.scrollHeight,behavior:"auto"})):(console.warn("Could not find scrollable viewport in ScrollArea"),console.log("ScrollArea element structure:",e))}catch(g){console.warn("Chat scroll to bottom failed:",g)}},100)})};ue(T,()=>{E()},{flush:"post"}),ue(I,()=>{i.messages.some(e=>e.isStreaming)&&W()},{flush:"post"});let O=null;const W=()=>{O&&clearTimeout(O),O=setTimeout(()=>{E()},50)};Ne(()=>{setTimeout(()=>{E()},300)});const V=()=>{i.input.trim()&&(m("send-message"),setTimeout(()=>{E()},100),ke(()=>{try{f.value&&f.value.$el?f.value.$el.focus():f.value&&f.value.focus&&f.value.focus()}catch(g){console.warn("Focus failed:",g)}}))},J=g=>{g.key==="Enter"&&!g.shiftKey&&(g.preventDefault(),V())},U=g=>{m("quick-action",g)},K=g=>g.toLocaleTimeString("en-US",{hour:"2-digit",minute:"2-digit",hour12:!1}),q=D(null),N=async g=>{try{const e=document.createElement("div");e.innerHTML=g.content;const a=e.textContent||e.innerText||g.content;await navigator.clipboard.writeText(a),m("copy-message",g),q.value=g.id,setTimeout(()=>{q.value=null},1500)}catch(e){console.error("Failed to copy message:",e),q.value=-1,setTimeout(()=>{q.value=null},1500)}},se=()=>{h.value&&m("update:input",`Can you help me improve this text: "${i.selectedText}"`)},te=()=>{b.value=!b.value,b.value&&(w.value=!1,d.value=!1)},ae=()=>{w.value=!w.value,w.value&&(b.value=!1,d.value=!1)},u=()=>{d.value=!d.value,d.value&&(b.value=!1,w.value=!1)},o=g=>{r.value.unshift(g),console.log("File uploaded and will be included in chat context:",g)},p=g=>{r.value=r.value.filter(e=>e.id!==g)},F=g=>{r.value=g},re=(g,e)=>{console.log("Navigate to message:",g,"in session:",e),w.value=!1},x=()=>{m("new-session")},M=()=>{m("chat-deleted")},Y=()=>{m("chat-cleared")},ee=g=>{m("retry-message",g)},le=()=>{m("stop-generation")};return(g,e)=>(c(),_("div",{class:Q(["flex h-full flex-col bg-background",g.isMobile?"border-0":"border-l"])},[n("div",{class:Q(["flex flex-shrink-0 items-center justify-between border-b bg-background/80 backdrop-blur-md sticky top-0 z-10",g.isMobile?"p-3":"px-4 py-3"])},[n("div",ja,[g.isMinimized?L("",!0):(c(),_("div",Ma,[s(t(k),{onClick:e[0]||(e[0]=a=>m("change-mode","assist")),variant:g.currentMode==="assist"?"default":"ghost",size:"sm",class:"h-7 rounded-full px-3 text-xs font-medium gap-1.5 transition-all duration-200"},{default:l(()=>[s(t(Pe),{class:"h-3.5 w-3.5"}),e[15]||(e[15]=C(" Assist ",-1))]),_:1},8,["variant"]),s(t(k),{onClick:e[1]||(e[1]=a=>m("change-mode","review")),variant:g.currentMode==="review"?"default":"ghost",size:"sm",class:"h-7 rounded-full px-3 text-xs font-medium gap-1.5 transition-all duration-200"},{default:l(()=>[s(t(ye),{class:"h-3.5 w-3.5"}),e[16]||(e[16]=C(" Review ",-1))]),_:1},8,["variant"])]))]),n("div",Da,[s(t(k),{onClick:x,variant:"ghost",size:"icon",class:"h-8 w-8 hover:bg-muted text-muted-foreground hover:text-foreground rounded-full transition-colors",title:"New Session"},{default:l(()=>[s(t(Ye),{class:"h-4 w-4"})]),_:1}),e[17]||(e[17]=n("div",{class:"h-4 w-px bg-border/60 mx-1"},null,-1)),s(t(k),{onClick:ae,variant:"ghost",size:"icon",class:Q(["h-8 w-8 rounded-full transition-colors",w.value?"bg-primary/10 text-primary":"hover:bg-muted text-muted-foreground hover:text-foreground"]),title:"Search"},{default:l(()=>[s(t(ye),{class:"h-4 w-4"})]),_:1},8,["class"]),s(t(k),{onClick:u,variant:"ghost",size:"icon",class:Q(["h-8 w-8 rounded-full transition-colors",d.value?"bg-primary/10 text-primary":"hover:bg-muted text-muted-foreground hover:text-foreground"]),title:"History"},{default:l(()=>[s(t(Ie),{class:"h-4 w-4"})]),_:1},8,["class"]),s(t(k),{onClick:te,variant:"ghost",size:"icon",class:Q(["h-8 w-8 rounded-full transition-colors",b.value?"bg-primary/10 text-primary":"hover:bg-muted text-muted-foreground hover:text-foreground"]),title:"Upload Context"},{default:l(()=>[s(t(tt),{class:"h-4 w-4"})]),_:1},8,["class"]),g.isMobile?L("",!0):(c(),G(t(k),{key:0,onClick:e[2]||(e[2]=a=>m("toggle-minimize")),variant:"ghost",size:"icon",class:"h-8 w-8 hover:bg-muted text-muted-foreground hover:text-foreground rounded-full transition-colors"},{default:l(()=>[g.isMinimized?(c(),G(t(jt),{key:1,class:"h-4 w-4"})):(c(),G(t(Rt),{key:0,class:"h-4 w-4"}))]),_:1})),g.isMobile?(c(),G(t(k),{key:1,onClick:e[3]||(e[3]=a=>m("toggle-minimize")),variant:"ghost",size:"icon",class:"h-8 w-8 hover:bg-muted text-muted-foreground hover:text-foreground rounded-full"},{default:l(()=>[s(t(Se),{class:"h-4 w-4"})]),_:1})):L("",!0)])],2),g.isMinimized?(c(),_("div",za,[s(t(k),{onClick:e[4]||(e[4]=a=>m("toggle-minimize")),variant:"ghost",size:"icon",class:"h-12 w-12 rounded-full"},{default:l(()=>[s(t(st),{class:"h-6 w-6"})]),_:1}),e[18]||(e[18]=n("p",{class:"-rotate-90 transform text-center text-xs whitespace-nowrap text-muted-foreground"},"Chat",-1))])):(c(),_("div",Aa,[s(ce,{name:"slide-left",mode:"out-in",appear:""},{default:l(()=>[w.value?(c(),_("div",Pa,[s(Ws,{"project-slug":g.projectSlug,"chapter-number":g.chapterNumber,show:w.value,onClose:e[5]||(e[5]=a=>w.value=!1),onMessageSelected:re},null,8,["project-slug","chapter-number","show"])])):L("",!0)]),_:1}),s(ce,{name:"slide-right",mode:"out-in",appear:""},{default:l(()=>[d.value?(c(),_("div",Oa,[n("div",Na,[s(Ra,{"project-slug":g.projectSlug,"chapter-number":g.chapterNumber,onChatDeleted:M,onChatCleared:Y},null,8,["project-slug","chapter-number"])])])):L("",!0)]),_:1}),s(ce,{name:"slide-up",mode:"out-in",appear:""},{default:l(()=>[!w.value&&!d.value&&!b.value?(c(),_("div",Ia,[n("div",Ha,[g.currentMode==="review"?(c(),_("div",{key:0,class:Q(["flex flex-wrap gap-2",g.isMobile?"justify-start overflow-x-auto pb-2 noscrollbar":"justify-start"])},[s(t(k),{onClick:e[6]||(e[6]=a=>U("overall-review")),size:"sm",variant:"outline",class:"h-8 rounded-full px-3 text-xs bg-card hover:bg-muted/50 border-input transition-all"},{default:l(()=>[s(t(Mt),{class:"mr-1.5 h-3.5 w-3.5 text-blue-500"}),e[19]||(e[19]=C(" Overall Review ",-1))]),_:1}),s(t(k),{onClick:e[7]||(e[7]=a=>U("test-knowledge")),size:"sm",variant:"outline",class:"h-8 rounded-full px-3 text-xs bg-card hover:bg-muted/50 border-input transition-all"},{default:l(()=>[s(t(Dt),{class:"mr-1.5 h-3.5 w-3.5 text-purple-500"}),e[20]||(e[20]=C(" Test Knowledge ",-1))]),_:1}),s(t(k),{onClick:e[8]||(e[8]=a=>U("find-weaknesses")),size:"sm",variant:"outline",class:"h-8 rounded-full px-3 text-xs bg-card hover:bg-muted/50 border-input transition-all"},{default:l(()=>[s(t(zt),{class:"mr-1.5 h-3.5 w-3.5 text-red-500"}),e[21]||(e[21]=C(" Find Weaknesses ",-1))]),_:1}),s(t(k),{onClick:e[9]||(e[9]=a=>U("citation-check")),size:"sm",variant:"outline",class:"h-8 rounded-full px-3 text-xs bg-card hover:bg-muted/50 border-input transition-all"},{default:l(()=>[s(t(At),{class:"mr-1.5 h-3.5 w-3.5 text-amber-500"}),e[22]||(e[22]=C(" Check Citations ",-1))]),_:1}),s(t(k),{onClick:e[10]||(e[10]=a=>U("structure-review")),size:"sm",variant:"outline",class:"h-8 rounded-full px-3 text-xs bg-card hover:bg-muted/50 border-input transition-all"},{default:l(()=>[s(t(Pt),{class:"mr-1.5 h-3.5 w-3.5 text-indigo-500"}),e[23]||(e[23]=C(" Review Structure ",-1))]),_:1})],2)):(c(),_("div",{key:1,class:Q(["flex flex-wrap gap-2",g.isMobile?"justify-start overflow-x-auto pb-2 noscrollbar":"justify-start"])},[s(t(k),{onClick:e[11]||(e[11]=a=>U("improve-writing")),size:"sm",variant:"outline",class:"h-8 rounded-full px-3 text-xs bg-card hover:bg-muted/50 border-input transition-all"},{default:l(()=>[s(t(Pe),{class:"mr-1.5 h-3.5 w-3.5 text-emerald-500"}),e[24]||(e[24]=C(" Improve Writing ",-1))]),_:1}),s(t(k),{onClick:e[12]||(e[12]=a=>U("expand-section")),size:"sm",variant:"outline",class:"h-8 rounded-full px-3 text-xs bg-card hover:bg-muted/50 border-input transition-all"},{default:l(()=>[s(t(Ot),{class:"mr-1.5 h-3.5 w-3.5 text-yellow-500"}),e[25]||(e[25]=C(" Expand Section ",-1))]),_:1}),s(t(k),{onClick:e[13]||(e[13]=a=>U("fix-grammar")),size:"sm",variant:"outline",class:"h-8 rounded-full px-3 text-xs bg-card hover:bg-muted/50 border-input transition-all"},{default:l(()=>[s(t(Nt),{class:"mr-1.5 h-3.5 w-3.5 text-blue-500"}),e[26]||(e[26]=C(" Fix Grammar ",-1))]),_:1})],2))]),n("div",Fa,[n("div",La,[s(t(me),{variant:"secondary",class:"h-5 px-1.5 text-[10px] bg-green-100 text-green-700 dark:bg-green-900/30 dark:text-green-400 gap-1 border-0"},{default:l(()=>[s(t(It),{class:"h-3 w-3"}),e[27]||(e[27]=C(" Context Active ",-1))]),_:1}),n("span",Ua," Analyzing "+j(Math.round(g.chapterContent.length/1e3))+"k characters of content ",1)])]),s(ce,{name:"slide-down"},{default:l(()=>[h.value?(c(),_("div",Ya,[n("div",Ba,[n("div",Va,[s(t(Ht),{class:"h-3.5 w-3.5"})]),n("div",qa,[n("div",Ga,[e[29]||(e[29]=n("p",{class:"text-xs font-medium text-blue-700 dark:text-blue-300"},"Selected text context",-1)),s(t(k),{onClick:se,size:"sm",variant:"ghost",class:"h-5 px-2 text-[10px] hover:bg-blue-100 dark:hover:bg-blue-900/50 text-blue-600 dark:text-blue-400"},{default:l(()=>[...e[28]||(e[28]=[C(" Ask AI ",-1)])]),_:1})]),n("p",Qa,' "'+j(g.selectedText)+'" ',1)])])])):L("",!0)]),_:1}),s(ce,{name:"slide-down",appear:""},{default:l(()=>[b.value?(c(),_("div",Wa,[s(bs,{"project-slug":g.projectSlug,"chapter-number":g.chapterNumber,"session-id":g.sessionId,disabled:g.isTyping,onFileUploaded:o,onFileDeleted:p,onFilesLoaded:F},null,8,["project-slug","chapter-number","session-id","disabled"])])):L("",!0)]),_:1}),s(t(Ce),{ref_key:"scrollContainer",ref:v,class:"min-h-0 flex-1"},{default:l(()=>[n("div",Xa,[s(ct,{name:"message-list",tag:"div",class:"space-y-4"},{default:l(()=>[(c(!0),_(be,null,xe(g.messages,a=>(c(),_("div",{key:a.id,class:Q(["flex gap-4 group",a.type==="user"?"justify-end":"justify-start"])},[a.type!=="user"?(c(),_("div",Ka,[n("div",{class:Q(["mt-1 flex h-8 w-8 flex-shrink-0 items-center justify-center rounded-full shadow-sm border border-border/50",a.type==="ai"?"bg-gradient-to-br from-indigo-500 to-violet-600":"bg-orange-500"])},[a.type==="ai"?(c(),G(t(Be),{key:0,class:"h-4 w-4 text-white"})):(c(),G(t(Ae),{key:1,class:"h-4 w-4 text-white"}))],2),n("div",Za,[n("div",{class:Q(["rounded-2xl rounded-tl-none px-6 py-4 shadow-sm transition-all duration-200",a.type==="ai"?"bg-card border border-border/50 text-card-foreground":"border border-orange-200 bg-orange-50/50 dark:border-orange-900/50 dark:bg-orange-950/20"])},[a.content?(c(),G(we,{key:0,content:a.content,class:"prose dark:prose-invert max-w-none chat-message-ai leading-relaxed text-lg"},null,8,["content"])):a.isStreaming?(c(),_("div",Ja,[...e[30]||(e[30]=[n("div",{class:"flex gap-1.5"},[n("div",{class:"h-2 w-2 animate-bounce rounded-full bg-primary/40"}),n("div",{class:"h-2 w-2 animate-bounce rounded-full bg-primary/40",style:{"animation-delay":"0.1s"}}),n("div",{class:"h-2 w-2 animate-bounce rounded-full bg-primary/40",style:{"animation-delay":"0.2s"}})],-1),n("span",{class:"text-xs text-muted-foreground font-medium"},"Thinking...",-1)])])):L("",!0),a.type==="ai"?(c(),_("div",eo,[n("div",to,[a.failed?(c(),G(t(k),{key:0,onClick:S=>ee(a),size:"sm",variant:"ghost",class:"h-6 px-2 text-xs text-orange-600 hover:text-orange-700 hover:bg-orange-50 dark:hover:bg-orange-950/30"},{default:l(()=>[s(t(Je),{class:"mr-1 h-3 w-3"}),e[31]||(e[31]=C(" Try Again ",-1))]),_:2},1032,["onClick"])):L("",!0),s(t(k),{onClick:S=>N(a),size:"sm",variant:"ghost",class:"h-6 px-2 text-xs text-muted-foreground hover:text-foreground",disabled:q.value===a.id||q.value===-1},{default:l(()=>[q.value!==a.id&&q.value!==-1?(c(),G(t(Ft),{key:0,class:"mr-1 h-3 w-3"})):q.value===a.id?(c(),G(t(rt),{key:1,class:"mr-1 h-3 w-3 text-green-600"})):(c(),G(t(Ae),{key:2,class:"mr-1 h-3 w-3 text-red-600"})),q.value===a.id?(c(),_("span",so,"Copied!")):q.value===-1?(c(),_("span",ao,"Failed")):(c(),_("span",oo,"Copy"))]),_:2},1032,["onClick","disabled"]),s(t(k),{onClick:S=>m("rate-message",a.id,1),size:"sm",variant:"ghost",class:"h-6 px-2 text-xs text-muted-foreground hover:text-foreground"},{default:l(()=>[s(t(Lt),{class:"h-3 w-3"})]),_:2},1032,["onClick"]),s(t(k),{onClick:S=>m("rate-message",a.id,-1),size:"sm",variant:"ghost",class:"h-6 px-2 text-xs text-muted-foreground hover:text-foreground"},{default:l(()=>[s(t(Ut),{class:"h-3 w-3"})]),_:2},1032,["onClick"])]),e[32]||(e[32]=n("span",{class:"text-[10px] uppercase font-semibold text-muted-foreground/60 tracking-wider"}," AI Assistant ",-1))])):L("",!0)],2),n("p",ro,j(K(a.timestamp)),1)])])):(c(),_("div",no,[n("div",io,[s(t(Yt),{class:"h-4 w-4 text-primary-foreground"})]),n("div",lo,[n("div",uo,[s(we,{content:a.content,class:"prose max-w-none chat-message-user leading-relaxed text-lg break-words text-primary-foreground grayscale-0"},null,8,["content"])]),n("p",co,j(K(a.timestamp)),1)])]))],2))),128))]),_:1})])]),_:1},512),s(ce,{name:"fade"},{default:l(()=>[g.isTyping?(c(),_("div",fo,[n("div",po,[s(t(Be),{class:"h-4 w-4 text-white"})]),e[33]||(e[33]=n("div",{class:"max-w-[85%] rounded-lg border bg-muted p-3"},[n("div",{class:"flex items-center gap-1"},[n("div",{class:"flex gap-1"},[n("div",{class:"h-2 w-2 animate-bounce rounded-full bg-muted-foreground"}),n("div",{class:"h-2 w-2 animate-bounce rounded-full bg-muted-foreground",style:{"animation-delay":"0.1s"}}),n("div",{class:"h-2 w-2 animate-bounce rounded-full bg-muted-foreground",style:{"animation-delay":"0.2s"}})]),n("span",{class:"ml-2 text-xs text-muted-foreground"},"AI is thinking...")])],-1))])):L("",!0)]),_:1}),n("div",mo,[n("div",go,[s(Zt,{ref_key:"inputRef",ref:f,"model-value":g.input,"onUpdate:modelValue":e[14]||(e[14]=a=>m("update:input",a)),onSubmit:V,onKeydown:J,disabled:g.isTyping,"show-toolbar":!1,placeholder:"Ask anything about your chapter...",class:"pr-12 min-h-[50px] max-h-[150px] py-1"},null,8,["model-value","disabled"]),n("div",vo,[g.isTyping?(c(),G(t(k),{key:1,onClick:le,size:"icon",variant:"destructive",class:"h-8 w-8 rounded-lg shadow-sm animate-pulse"},{default:l(()=>[s(t(Bt),{class:"h-4 w-4"})]),_:1})):(c(),G(t(k),{key:0,onClick:V,size:"icon",class:"h-8 w-8 rounded-lg bg-primary text-primary-foreground hover:bg-primary/90 transition-all shadow-sm",disabled:!g.input.trim()},{default:l(()=>[s(t(et),{class:"h-4 w-4"})]),_:1},8,["disabled"]))])]),n("div",ho,[n("div",yo,[g.isTyping?(c(),_("span",xo,[...e[35]||(e[35]=[n("span",{class:"relative flex h-2 w-2"},[n("span",{class:"animate-ping absolute inline-flex h-full w-full rounded-full bg-primary opacity-75"}),n("span",{class:"relative inline-flex rounded-full h-2 w-2 bg-primary"})],-1),C(" AI is writing... ",-1)])])):(c(),_("span",bo,[...e[34]||(e[34]=[n("span",{class:"font-medium text-foreground/80"},"Tip:",-1),C(" Press ",-1),n("kbd",{class:"px-1 py-0.5 rounded bg-muted font-mono text-[9px]"},"Enter",-1),C(" to send ",-1)])]))]),n("div",wo,[s(t(k),{onClick:x,variant:"ghost",size:"sm",class:"h-6 px-2 text-[10px] gap-1 text-muted-foreground hover:text-foreground",disabled:g.isTyping},{default:l(()=>[s(t(Ye),{class:"h-3 w-3"}),e[36]||(e[36]=C(" Clear Chat ",-1))]),_:1},8,["disabled"])])])])])):L("",!0)]),_:1})]))],2))}}),Xe=_e(_o,[["__scopeId","data-v-e137d10e"]]),ko={class:"flex h-screen flex-col overflow-hidden bg-background"},Co={class:"flex flex-shrink-0 items-center justify-between border-b bg-background/95 p-2 backdrop-blur supports-[backdrop-filter]:bg-background/60"},So={class:"flex items-center gap-2"},To={class:"flex items-center gap-2"},$o={class:"flex-shrink-0 bg-muted/30 px-3 py-2"},Eo={class:"mb-1 flex items-center justify-between"},Ro={class:"text-xs text-muted-foreground"},jo={class:"flex flex-1 overflow-hidden"},Mo={key:0,class:"absolute inset-0 z-50 bg-background md:hidden"},Do={class:"flex min-h-0 flex-1 flex-col border-r"},zo={class:"flex min-h-0 flex-1 flex-col space-y-2"},Ao={class:"flex items-center justify-end"},Po={key:0,class:"flex flex-shrink-0 items-center gap-2 rounded-lg bg-muted/30 p-2"},Oo={class:"text-xs"},No={class:"flex flex-shrink-0 gap-2 pt-2"},Dn=ge({__name:"ChatModeLayout",props:{project:{},chapter:{},chapterTitle:{},chapterContent:{},currentWordCount:{},targetWordCount:{},progressPercentage:{},writingQualityScore:{},isValid:{type:Boolean},isSaving:{type:Boolean},showPreview:{type:Boolean},isGenerating:{type:Boolean},generationProgress:{},historyIndex:{},contentHistoryLength:{},selectedText:{}},emits:["update:chapterTitle","update:chapterContent","update:selectedText","update:showPreview","save","undo","redo","exitChatMode"],setup(H,{emit:y}){const i=H,m=y,v=D([]),f=D(""),b=D(!1),w=D(null),d=D(!1),r=D(null),h=D(!1),T=D(!1),I=D("review"),E=D(!1),O=D(0),W=()=>{O.value=window.innerWidth,E.value=window.innerWidth<768,E.value&&T.value},V=()=>{W()},J=async()=>{d.value=!0;try{const x=await he.get(pe("chapters.chat-history",{project:i.project.slug,chapter:i.chapter.chapter_number})),{messages:M,current_session_id:Y}=x.data;M&&M.length>0?(v.value=M.map(ee=>({id:ee.id,type:ee.type,content:ee.content,timestamp:new Date(ee.timestamp)})),w.value=Y):v.value=[]}catch(x){console.warn("Failed to load chat history:",x),v.value=[]}finally{d.value=!1}};Ne(()=>{J(),W(),window.addEventListener("resize",V)}),ft(()=>{window.removeEventListener("resize",V)});const U=async x=>{if(!f.value.trim()&&!x)return;const M=x?"":f.value,Y=f.value;f.value="",x||v.value.push({id:Date.now(),type:"user",content:M,timestamp:new Date}),b.value=!0;const ee=Date.now()+1;try{const le=await fetch(pe("chapters.chat-stream",{project:i.project.slug,chapter:i.chapter.chapter_number}),{method:"POST",headers:{"Content-Type":"application/json",Accept:"text/event-stream","X-CSRF-TOKEN":document.querySelector('meta[name="csrf-token"]')?.getAttribute("content")||""},body:JSON.stringify({message:M,chapter_content:i.chapterContent||"",selected_text:i.selectedText||"",session_id:w.value,task_type:I.value,quick_action:x||null})});if(!le.ok)throw new Error(`HTTP error! status: ${le.status}`);const g=le.body?.getReader();if(!g)throw new Error("No response body reader available");r.value=g;const e=new TextDecoder;let a="";const S=async()=>{try{for(;;){const{done:P,value:R}=await g.read();if(P)break;a+=e.decode(R,{stream:!0});const X=a.split(`
`);a=X.pop()||"";for(const B of X)if(B.startsWith("data: "))try{const ne=JSON.parse(B.slice(6));$(ne)}catch(ne){console.error("Failed to parse streaming data:",ne)}}}catch(P){console.error("Stream reading error:",P),A(P)}},$=P=>{switch(P.type){case"start":b.value=!0,P.session_id&&(w.value=P.session_id);break;case"content":b.value&&(b.value=!1);const R=v.value.findIndex(ne=>ne.id===ee);R===-1?v.value.push({id:ee,type:"ai",content:P.content,timestamp:new Date,isStreaming:!0}):v.value[R].content+=P.content;break;case"complete":b.value=!1,P.session_id&&(w.value=P.session_id);const X=v.value.findIndex(ne=>ne.id===ee);X!==-1&&(v.value[X].isStreaming=!1,P.ai_message_id&&(v.value[X].id=P.ai_message_id));break;case"error":b.value=!1;const B=v.value.findIndex(ne=>ne.id===ee);B!==-1?v.value[B]={id:v.value[B].id,type:"ai",content:P.message||" Sorry, I encountered an error processing your message.",timestamp:new Date,failed:!0,lastPrompt:Y,lastQuickAction:x}:v.value.push({id:Date.now(),type:"ai",content:P.message||" Sorry, I encountered an error processing your message.",timestamp:new Date,failed:!0,lastPrompt:Y,lastQuickAction:x});break;case"heartbeat":break}},A=P=>{b.value=!1;const R=v.value.findIndex(X=>X.id===ee);R!==-1?v.value[R]={id:v.value[R].id,type:"ai",content:" Connection error. Please check your internet and try again.",timestamp:new Date,failed:!0,lastPrompt:Y,lastQuickAction:x}:v.value.push({id:Date.now(),type:"ai",content:" Connection error. Please check your internet and try again.",timestamp:new Date,failed:!0,lastPrompt:Y,lastQuickAction:x})};try{await S()}finally{r.value=null}}catch(le){console.error("Chat streaming error:",le),b.value=!1;const g=v.value.findIndex(e=>e.id===ee);g!==-1?v.value[g]={id:v.value[g].id,type:"ai",content:" Failed to start conversation. Please try again.",timestamp:new Date,failed:!0,lastPrompt:Y,lastQuickAction:x}:v.value.push({id:Date.now(),type:"ai",content:" Failed to start conversation. Please try again.",timestamp:new Date,failed:!0,lastPrompt:Y,lastQuickAction:x})}},K=x=>{U(x)},q=x=>{I.value=x,console.log("Chat mode changed to:",x)},N=x=>{console.log("Message copied:",x)},se=(x,M)=>{console.log("Message rated:",x,M)},te=()=>{console.log("Starting new chat session..."),v.value=[],w.value=null,f.value="",console.log("New chat session started")},ae=()=>{console.log("Chat deleted - refreshing main chat"),J()},u=()=>{console.log("Chat cleared - refreshing main chat"),v.value=[],w.value=null,J()},o=x=>{console.log("Retrying failed message:",x);const M=v.value.findIndex(Y=>Y.id===x.id);M!==-1&&v.value.splice(M,1),x.lastQuickAction?U(x.lastQuickAction):x.lastPrompt&&(f.value=x.lastPrompt,U())},p=()=>{if(console.log("Stopping generation..."),r.value){try{r.value.cancel()}catch(M){console.warn("Error cancelling stream:",M)}r.value=null}b.value=!1;const x=v.value[v.value.length-1];x&&x.type==="ai"&&x.isStreaming&&(x.isStreaming=!1,x.content+=`

*[Generation stopped by user]*`)},F=()=>{T.value=!T.value},re=()=>{h.value=!h.value};return(x,M)=>(c(),_("div",ko,[n("div",Co,[n("div",So,[s(t(k),{onClick:M[0]||(M[0]=Y=>m("exitChatMode")),variant:"ghost",size:"sm",class:"gap-1"},{default:l(()=>[s(t(Se),{class:"h-4 w-4"}),M[6]||(M[6]=C(" Exit Chat ",-1))]),_:1})]),n("div",To,[s(t(me),{variant:"outline",class:"text-xs"},{default:l(()=>[C(j(x.writingQualityScore)+"% Quality ",1)]),_:1})])]),n("div",$o,[n("div",Eo,[M[7]||(M[7]=n("span",{class:"text-xs font-medium"},"Writing Progress",-1)),n("span",Ro,j(Math.round(x.progressPercentage))+"% ("+j(x.currentWordCount)+" / "+j(x.targetWordCount)+" words)",1)]),s(t(Ze),{"model-value":x.progressPercentage,class:"h-1"},null,8,["model-value"])]),n("div",jo,[E.value&&!T.value?(c(),_("div",Mo,[s(Xe,{"is-minimized":!1,messages:v.value,"is-typing":b.value,"selected-text":x.selectedText,"chapter-content":x.chapterContent,"chapter-number":x.chapter.chapter_number,"current-mode":I.value,"project-slug":x.project.slug,"session-id":w.value||"temp-session","is-mobile":!0,onSendMessage:U,onQuickAction:K,onRetryMessage:o,onStopGeneration:p,onToggleMinimize:F,onChangeMode:q,onCopyMessage:N,onRateMessage:se,onNewSession:te,onChatDeleted:ae,onChatCleared:u,input:f.value,"onUpdate:input":M[1]||(M[1]=Y=>f.value=Y),class:"mobile-chat-overlay"},null,8,["messages","is-typing","selected-text","chapter-content","chapter-number","current-mode","project-slug","session-id","input"])])):L("",!0),n("div",Do,[s(t(mt),{class:"flex min-h-0 flex-1 flex-col rounded-none border-0 bg-transparent shadow-none"},{default:l(()=>[s(t(pt),{class:"flex min-h-0 flex-1 flex-col space-y-4 p-6"},{default:l(()=>[n("div",zo,[n("div",Ao,[s(t(k),{onClick:re,variant:h.value?"default":"ghost",size:"sm",class:"h-7 text-xs"},{default:l(()=>[h.value?(c(),G(t(Pe),{key:0,class:"mr-1.5 h-3 w-3"})):(c(),G(t(Vt),{key:1,class:"mr-1.5 h-3 w-3"})),C(" "+j(h.value?"Edit":"Preview"),1)]),_:1},8,["variant"])]),He(s(t(Ce),{class:"min-h-0 flex-1"},{default:l(()=>[s(kt,{"model-value":x.chapterContent,"onUpdate:modelValue":M[2]||(M[2]=Y=>m("update:chapterContent",Y)),placeholder:"Start writing your chapter...","min-height":"400px",class:"text-lg leading-relaxed"},null,8,["model-value"])]),_:1},512),[[Fe,!h.value]]),He(s(t(Ce),{class:"min-h-0 flex-1"},{default:l(()=>[s(we,{content:x.chapterContent,class:"p-4 text-lg",style:{"font-family":"'Times New Roman', serif","line-height":"1.6"}},null,8,["content"])]),_:1},512),[[Fe,h.value]])]),x.isGenerating?(c(),_("div",Po,[M[8]||(M[8]=n("div",{class:"h-3 w-3 animate-spin rounded-full border-2 border-primary border-t-transparent"},null,-1)),n("span",Oo,j(x.generationProgress),1)])):L("",!0),n("div",No,[s(t(k),{onClick:M[3]||(M[3]=Y=>m("save",!1)),disabled:!x.isValid||x.isSaving,size:"sm"},{default:l(()=>[s(t(qt),{class:"mr-1 h-3 w-3"}),C(" "+j(x.isSaving?"Saving...":"Save"),1)]),_:1},8,["disabled"]),s(t(k),{onClick:M[4]||(M[4]=Y=>m("save",!1)),disabled:!x.isValid||x.currentWordCount<x.targetWordCount*.8,size:"sm"},{default:l(()=>[s(t(rt),{class:"mr-1 h-3 w-3"}),M[9]||(M[9]=C(" Complete ",-1))]),_:1},8,["disabled"])])]),_:1})]),_:1})]),E.value?L("",!0):(c(),_("div",{key:1,class:Q(["flex min-h-0 flex-col bg-muted/20 border-l transition-all duration-300 ease-in-out",T.value?"w-[60px]":"w-[600px] xl:w-[800px]"])},[s(Xe,{"is-minimized":T.value,messages:v.value,"is-typing":b.value,"selected-text":x.selectedText,"chapter-content":x.chapterContent,"chapter-number":x.chapter.chapter_number,"current-mode":I.value,"project-slug":x.project.slug,"session-id":w.value||"temp-session",onSendMessage:U,onQuickAction:K,onRetryMessage:o,onStopGeneration:p,onToggleMinimize:F,onChangeMode:q,onCopyMessage:N,onRateMessage:se,onNewSession:te,onChatDeleted:ae,onChatCleared:u,input:f.value,"onUpdate:input":M[5]||(M[5]=Y=>f.value=Y)},null,8,["is-minimized","messages","is-typing","selected-text","chapter-content","chapter-number","current-mode","project-slug","session-id","input"])],2))])]))}});export{Dn as default};
