import{_ as C}from"./index-DaGexGBE.js";import{_ as q,a as A,b as F,c as W,d as $,e as N}from"./DialogTitle.vue_vue_type_script_setup_true_lang-Cmbjv-8g.js";import{d as j,g as f,c as S,o as b,u as a,w as p,k as n,e as t,a as y,z as x,A as l,t as r,F as T,K as R,B as L,L as V,s as B}from"./app-OLVDhRZX.js";import{T as O}from"./triangle-alert-Vj-YkvmG.js";import{C as Y}from"./AppLayout.vue_vue_type_script_setup_true_lang-B2Ylnxoa.js";import{S as D}from"./sparkles-CcJC3EAx.js";import{A as M}from"./arrow-right-zrCrOdnP.js";const E={class:"mx-auto mb-4 p-3 rounded-full bg-amber-100 dark:bg-amber-900/30"},G={class:"my-6 p-4 rounded-lg bg-muted/50"},K={class:"flex items-center justify-between mb-2"},U={class:"flex items-center gap-1 text-lg font-bold"},z={class:"flex items-center justify-between mb-2"},I={class:"text-lg font-medium"},J={key:0,class:"pt-2 border-t border-border"},X={class:"flex items-center justify-between text-red-600 dark:text-red-400"},H={class:"font-bold"},Q={key:0,class:"p-4 rounded-lg border border-primary/20 bg-primary/5"},Z={class:"flex items-start gap-3"},ee={class:"font-medium text-sm"},te={class:"text-xs text-muted-foreground mt-1"},me=j({__name:"PurchaseModal",props:{open:{type:Boolean},currentBalance:{},requiredWords:{},action:{default:"continue"}},emits:["update:open","close"],setup(h,{emit:g}){const c=h,i=g,d=f(()=>Math.max(0,c.requiredWords-c.currentBalance)),s=f(()=>c.currentBalance<c.requiredWords),v=f(()=>d.value<=5e3?{name:"Small Top-up",words:"5,000",price:"₦2,500"}:d.value<=15e3?{name:"Medium Top-up",words:"15,000",price:"₦6,000"}:{name:"Large Top-up",words:"30,000",price:"₦10,000"}),k=()=>{i("update:open",!1),R.visit(L("pricing"))},w=()=>{i("update:open",!1),i("close")};return(u,e)=>(b(),S(a(q),{open:u.open,"onUpdate:open":e[0]||(e[0]=P=>i("update:open",P))},{default:p(()=>[n(a(N),{class:"sm:max-w-md"},{default:p(()=>[n(a(A),null,{default:p(()=>[t("div",E,[n(a(O),{class:"w-8 h-8 text-amber-600 dark:text-amber-400"})]),n(a(F),{class:"text-center"},{default:p(()=>[l(r(s.value?"Insufficient Credits":"Credit Balance Check"),1)]),_:1}),n(a(W),{class:"text-center"},{default:p(()=>[s.value?(b(),y(T,{key:0},[e[1]||(e[1]=l(" You need ",-1)),t("strong",null,r(u.requiredWords.toLocaleString()),1),l(" credits to "+r(u.action)+", but you only have ",1),t("strong",null,r(u.currentBalance.toLocaleString()),1),e[2]||(e[2]=l(" credits remaining. ",-1))],64)):(b(),y(T,{key:1},[e[3]||(e[3]=l(" This action requires approximately ",-1)),t("strong",null,r(u.requiredWords.toLocaleString()),1),e[4]||(e[4]=l(" credits. You have ",-1)),t("strong",null,r(u.currentBalance.toLocaleString()),1),e[5]||(e[5]=l(" credits available. ",-1))],64))]),_:1})]),_:1}),t("div",G,[t("div",K,[e[6]||(e[6]=t("span",{class:"text-sm text-muted-foreground"},"Your Balance",-1)),t("div",U,[n(a(Y),{class:"w-5 h-5 text-primary"}),l(" "+r(u.currentBalance.toLocaleString()),1)])]),t("div",z,[e[7]||(e[7]=t("span",{class:"text-sm text-muted-foreground"},"Required",-1)),t("span",I,r(u.requiredWords.toLocaleString()),1)]),s.value?(b(),y("div",J,[t("div",X,[e[8]||(e[8]=t("span",{class:"text-sm font-medium"},"Shortage",-1)),t("span",H,r(d.value.toLocaleString())+" credits",1)])])):x("",!0)]),s.value?(b(),y("div",Q,[t("div",Z,[n(a(D),{class:"w-5 h-5 text-primary mt-0.5"}),t("div",null,[t("h4",ee,"Recommended: "+r(v.value.name),1),t("p",te," Get "+r(v.value.words)+" credits for "+r(v.value.price),1)])])])):x("",!0),n(a($),{class:"flex-col sm:flex-col gap-2 mt-4"},{default:p(()=>[s.value?(b(),S(a(C),{key:0,class:"w-full",onClick:k},{default:p(()=>[e[9]||(e[9]=l(" Buy More Credits ",-1)),n(a(M),{class:"w-4 h-4 ml-2"})]),_:1})):x("",!0),s.value?x("",!0):(b(),S(a(C),{key:1,class:"w-full",onClick:w},{default:p(()=>[e[10]||(e[10]=l(" Continue ",-1)),n(a(M),{class:"w-4 h-4 ml-2"})]),_:1})),n(a(C),{variant:"ghost",class:"w-full",onClick:w},{default:p(()=>[l(r(s.value?"Cancel":"Go Back"),1)]),_:1})]),_:1})]),_:1})]),_:1},8,["open"]))}});function pe(){const h=V(),g=B(!1),c=B(!1),i=B(0),d=B(""),s=f(()=>h.props.auth?.user?.word_balance_data??null),v=f(()=>s.value?.balance??0),k=f(()=>s.value?.formatted_balance??"0"),w=f(()=>v.value>0),u=f(()=>s.value?s.value.percentage_remaining<20:!1),e=o=>{const m=v.value,_=m>=o;return{canProceed:_,balance:m,required:o,shortage:_?0:o-m}};return{wordBalance:s,balance:v,formattedBalance:k,hasWords:w,isLowBalance:u,isLoading:g,showPurchaseModal:c,requiredWordsForModal:i,actionDescriptionForModal:d,checkBalance:e,checkAndPrompt:(o,m="continue")=>e(o).canProceed?!0:(i.value=o,d.value=m,c.value=!0,!1),refreshBalance:async()=>{g.value=!0;try{const m=await(await fetch(L("api.balance"))).json();if(m.balance){const _=h.props.auth;_?.user&&(_.user.word_balance_data=m.balance)}return m.balance}catch(o){return console.error("Failed to fetch balance:",o),null}finally{g.value=!1}},closePurchaseModal:()=>{c.value=!1,i.value=0,d.value=""},estimates:{chapter:o=>Math.ceil(o*1.1),suggestion:()=>200,chat:()=>500,defense:()=>1e3,expand:()=>300,rephrase:()=>150}}}async function fe(h,g,c,i){try{await fetch(L("api.words.record-usage"),{method:"POST",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":document.querySelector('meta[name="csrf-token"]')?.getAttribute("content")||""},body:JSON.stringify({words:h,description:g,reference_type:c,reference_id:i})})}catch(d){console.error("Failed to record word usage:",d)}}export{me as _,fe as r,pe as u};
