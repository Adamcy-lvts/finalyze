const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/AISidebar-Cw6jZnjY.js","assets/app-Cen5RKeB.js","assets/app-Dsuds9Ti.css","assets/index-Cgn6EYUI.js","assets/CardContent.vue_vue_type_script_setup_true_lang-BAEFnlj1.js","assets/CardTitle.vue_vue_type_script_setup_true_lang-C4BAP5vQ.js","assets/CollapsibleTrigger.vue_vue_type_script_setup_true_lang-zAFWPYHZ.js","assets/VisuallyHidden-Ba7onNaf.js","assets/useForwardExpose-Ck0jElzv.js","assets/Separator.vue_vue_type_script_setup_true_lang-DrocebkM.js","assets/Separator-7_o8fch9.js","assets/Progress.vue_vue_type_script_setup_true_lang-Dw1PEhMQ.js","assets/nullish-CHIgUVhi.js","assets/Sonner.vue_vue_type_script_setup_true_lang-CjYRaDSp.js","assets/DropdownMenuTrigger.vue_vue_type_script_setup_true_lang-Duk75vcO.js","assets/triangle-alert-CXxdltH5.js","assets/circle-check-CJSzebHD.js","assets/CitationHelper.vue_vue_type_script_setup_true_lang-DsYx58nb.js","assets/index-BnbYGTxm.js","assets/Input.vue_vue_type_script_setup_true_lang-CIfqySYo.js","assets/ScrollArea.vue_vue_type_script_setup_true_lang-CjqhvKoQ.js","assets/useNonce-DL2XoeTc.js","assets/AlertDialogTitle.vue_vue_type_script_setup_true_lang-CIVM88f7.js","assets/RichTextEditor-BIfZ_hYg.js","assets/_plugin-vue_export-helper-DlAUqK2U.js","assets/SafeHtmlText.vue_vue_type_script_setup_true_lang-DpfNR0di.js","assets/index-BWEDi_FC.js","assets/step-DrZ9DcYd.js","assets/DialogTitle.vue_vue_type_script_setup_true_lang-BRAdlRCP.js","assets/DialogFooter.vue_vue_type_script_setup_true_lang-CjjN1Jnz.js","assets/Label.vue_vue_type_script_setup_true_lang-B1Cx5X3Q.js","assets/type-DPSv4dOo.js","assets/minus-BOv_CeLO.js","assets/plus-Aq2i_wOa.js","assets/list-Bbp2IGjC.js","assets/RichTextEditor-BDJ8Kfyb.css","assets/chevron-down-BzbJRQ0R.js","assets/wand-sparkles-DuqFfZO8.js","assets/search-C7cHiwYI.js","assets/history-DE3ZR2lx.js","assets/trash-2-Ci5PDdzZ.js","assets/copy-LVJR4jnq.js","assets/brain-DraOsiN9.js","assets/zap-Bo7wR78Q.js","assets/pen-tool-ooa8FVus.js","assets/refresh-cw-Dcp2Gukm.js","assets/sparkles-BbfhqcEi.js","assets/AISidebar-Ymbz_oju.css","assets/ChapterNavigation-CshsLq65.js","assets/ChapterNavigation.vue_vue_type_script_setup_true_lang-G9ToMgw2.js","assets/DialogTrigger-DLrug7ne.js","assets/chevron-right-CBn3iXPH.js","assets/circle-check-big-B8WJaiLA.js","assets/lock-DnldpR0G.js","assets/target-DBaBhqOU.js","assets/MobileNavOverlay-pI7EpWN6.js","assets/index-OQMe2Hed.js","assets/DefensePreparationPanel.vue_vue_type_script_setup_true_lang-Buhu1i3T.js","assets/Switch.vue_vue_type_script_setup_true_lang-BJ7syh3-.js","assets/VisuallyHiddenInput-CEuRq02c.js","assets/thumbs-up-DibTVOJm.js","assets/lightbulb-CU94Ho4K.js","assets/download-BiixNm5I.js","assets/circle-alert-C9MLVqit.js","assets/DataCollectionPanel.vue_vue_type_script_setup_true_lang-BGIZgFQ-.js","assets/MobileNavOverlay-CN-XSdXy.css","assets/ChatModeLayout-cd16tG5T.js","assets/ChatModeLayout.vue_vue_type_script_setup_true_lang-BKtbDMA4.js","assets/square-D44JlSgU.js","assets/useTextHistory-BCmTvRod.js","assets/Checkbox.vue_vue_type_script_setup_true_lang-Bask1UoJ.js","assets/ohash.D__AXeF1-C-E83dC9.js","assets/RovingFocusItem-DHrc2C0R.js","assets/check-DppQJG0E.js","assets/file-text-BLwMqBnB.js","assets/useTextHistory-BWcwai4o.css","assets/loader-BhWb1ss5.js","assets/message-square-wdIixzpM.js","assets/chevron-left-CPDDE7vm.js","assets/clock-BZnQKj0X.js","assets/rotate-ccw-INI5ulpq.js","assets/chart-column-3hNYK9RT.js","assets/user-DZf6gcTO.js","assets/eye--p-GthQJ.js","assets/save-L7oVcAt2.js","assets/ChatModeLayout-wjQGykpm.css","assets/CitationVerificationLayout-BnTn0EVQ.js","assets/DefensePreparationPanel-CGukafK_.js","assets/DataCollectionPanel-BJqiQkci.js"])))=>i.map(i=>d[i]);
import{ak as ha,ab as fa,d as kr,g as $,c as V,q as ge,o as y,u as t,w as n,k as s,e as r,s as L,n as pe,t as f,a as z,F as Et,A as Tt,X as Ve,z as c,Q as Me,C as xe,y as te,h as it,p as ut,j as ma,al as Re,x as Ge,T as ur,am as ct,b as He,f as Ue,an as De}from"./app-Cen5RKeB.js";import{_ as Ee}from"./index-BnbYGTxm.js";import{_ as G}from"./index-Cgn6EYUI.js";import{_ as At,a as $t}from"./CardContent.vue_vue_type_script_setup_true_lang-BAEFnlj1.js";import{_ as qt,a as Sr}from"./CardTitle.vue_vue_type_script_setup_true_lang-C4BAP5vQ.js";import{_ as cr}from"./Input.vue_vue_type_script_setup_true_lang-CIfqySYo.js";import{_ as _t}from"./Label.vue_vue_type_script_setup_true_lang-B1Cx5X3Q.js";import{_ as Er}from"./Progress.vue_vue_type_script_setup_true_lang-Dw1PEhMQ.js";import{_ as dr}from"./ScrollArea.vue_vue_type_script_setup_true_lang-CjqhvKoQ.js";import{_ as se,a as oe,b as ne}from"./UserInfo.vue_vue_type_script_setup_true_lang-B2L-vOto.js";import{u as ba,r as tt,_ as wa,a as xa}from"./AppLayout.vue_vue_type_script_setup_true_lang-CXBUzfRa.js";import{_ as pr}from"./SafeHtmlText.vue_vue_type_script_setup_true_lang-DpfNR0di.js";import{t as C,M as gr,S as vr}from"./Sonner.vue_vue_type_script_setup_true_lang-CjYRaDSp.js";import{_ as ya}from"./PurchaseModal.vue_vue_type_script_setup_true_lang-4MfoQ2TN.js";import{B as rt,u as _a,M as hr,_ as Ct,R as fr,a as Ca,P as ka,b as Sa}from"./useTextHistory-BCmTvRod.js";import{T as Ea}from"./trending-up-m__kgjTE.js";import{C as Ta}from"./circle-alert-C9MLVqit.js";import{ao as mr}from"./RichTextEditor-BIfZ_hYg.js";import{t as br}from"./toNumber-DrUgNTeE.js";import{A as wr}from"./arrow-left-B15UB-n9.js";import{B as dt}from"./brain-DraOsiN9.js";import{T as xr}from"./target-DBaBhqOU.js";import{E as kt}from"./eye--p-GthQJ.js";import{S as yr}from"./save-L7oVcAt2.js";import{C as _r}from"./circle-check-big-B8WJaiLA.js";import{M as Aa}from"./message-square-wdIixzpM.js";import{P as $a,a as qa}from"./panel-left-open-B9m1O8py.js";import{P as Pa}from"./pen-tool-ooa8FVus.js";import"./useForwardExpose-Ck0jElzv.js";import"./VisuallyHidden-Ba7onNaf.js";import"./nullish-CHIgUVhi.js";import"./useNonce-DL2XoeTc.js";import"./DropdownMenuTrigger.vue_vue_type_script_setup_true_lang-Duk75vcO.js";import"./coins-CBQIZLFf.js";import"./AppLogoIcon.vue_vue_type_script_setup_true_lang-CWRLx9RL.js";import"./plus-Aq2i_wOa.js";import"./chevron-right-CBn3iXPH.js";import"./triangle-alert-CXxdltH5.js";import"./circle-check-CJSzebHD.js";import"./DialogTitle.vue_vue_type_script_setup_true_lang-BRAdlRCP.js";import"./DialogFooter.vue_vue_type_script_setup_true_lang-CjjN1Jnz.js";import"./sparkles-BbfhqcEi.js";import"./arrow-right-DOqQ9mmQ.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";import"./Checkbox.vue_vue_type_script_setup_true_lang-Bask1UoJ.js";import"./ohash.D__AXeF1-C-E83dC9.js";import"./VisuallyHiddenInput-CEuRq02c.js";import"./RovingFocusItem-DHrc2C0R.js";import"./minus-BOv_CeLO.js";import"./check-DppQJG0E.js";import"./Separator.vue_vue_type_script_setup_true_lang-DrocebkM.js";import"./Separator-7_o8fch9.js";import"./download-BiixNm5I.js";import"./chevron-down-BzbJRQ0R.js";import"./file-text-BLwMqBnB.js";import"./index-BWEDi_FC.js";import"./step-DrZ9DcYd.js";import"./type-DPSv4dOo.js";import"./list-Bbp2IGjC.js";var St=function(){return ha.Date.now()},ja="Expected a function",Ra=Math.max,Da=Math.min;function Ma(M,k,q){var F,h,d,w,g,l,_=0,m=!1,N=!1,A=!0;if(typeof M!="function")throw new TypeError(ja);k=br(k)||0,fa(q)&&(m=!!q.leading,N="maxWait"in q,d=N?Ra(br(q.maxWait)||0,k):d,A="trailing"in q?!!q.trailing:A);function v(O){var S=F,B=h;return F=h=void 0,_=O,w=M.apply(B,S),w}function j(O){return _=O,g=setTimeout(Y,k),m?v(O):w}function H(O){var S=O-l,B=O-_,Z=k-S;return N?Da(Z,d-B):Z}function K(O){var S=O-l,B=O-_;return l===void 0||S>=k||S<0||N&&B>=d}function Y(){var O=St();if(K(O))return fe(O);g=setTimeout(Y,H(O))}function fe(O){return g=void 0,A&&F?v(O):(F=h=void 0,w)}function ye(){g!==void 0&&clearTimeout(g),_=0,F=l=h=g=void 0}function me(){return g===void 0?w:fe(St())}function ve(){var O=St(),S=K(O);if(F=arguments,h=this,l=O,S){if(g===void 0)return j(l);if(N)return clearTimeout(g),g=setTimeout(Y,k),v(l)}return g===void 0&&(g=setTimeout(Y,k)),w}return ve.cancel=ye,ve.flush=me,ve}const Fa={class:"flex items-center justify-between mb-3"},Na={class:"flex items-center gap-3"},Oa={class:"p-2 rounded-lg bg-blue-500/10"},Wa={class:"text-right"},La={class:"space-y-2"},Ia={class:"flex justify-between items-center text-xs"},za={class:"relative"},Ga={key:0},Ha={class:"space-y-3"},Ua={class:"flex-1"},Va={class:"text-sm font-medium"},Ba={class:"text-xs text-muted-foreground"},Qa={class:"w-20 h-2 bg-muted rounded-full overflow-hidden ml-3"},Ka={key:1},Xa={class:"space-y-2"},Ja={class:"flex-1"},Ya={class:"text-sm font-medium"},Za={class:"text-xs text-muted-foreground"},es={key:2,class:"flex items-center justify-center gap-3 p-4 rounded-lg bg-blue-50/50 border border-blue-200/50"},ts={key:3,class:"text-center p-4 rounded-lg bg-muted/30"},Cr=kr({__name:"WritingStatistics",props:{showStatistics:{type:Boolean},currentWordCount:{},writingStats:{},qualityAnalysis:{},isAnalyzing:{type:Boolean}},setup(M){const k=M;$(()=>{if(!k.qualityAnalysis?.quality_level)return"text-muted-foreground";switch(k.qualityAnalysis.quality_level){case"Excellent":return"text-green-600";case"Good":return"text-blue-600";case"Satisfactory":return"text-yellow-600";case"Needs Improvement":return"text-orange-600";case"Poor":return"text-red-600";default:return"text-muted-foreground"}});const q=$(()=>k.qualityAnalysis?.scores?Object.entries(k.qualityAnalysis.scores).filter(([,h])=>h.max>0).filter(([,h])=>h.percentage<75).sort(([,h],[,d])=>h.percentage-d.percentage).map(([h,d])=>({category:h.replace(" & "," & "),percentage:Math.round(d.percentage),score:d.score,max:d.max,status:d.percentage<40?"poor":d.percentage<60?"needs-work":"fair"})):[]),F=$(()=>{const h=k.qualityAnalysis?.total_score||0;return h>=80?{text:"Excellent",color:"text-green-600",bgColor:"bg-green-50"}:h>=70?{text:"Satisfactory",color:"text-yellow-600",bgColor:"bg-yellow-50"}:h>=60?{text:"Needs Work",color:"text-orange-600",bgColor:"bg-orange-50"}:{text:"Poor",color:"text-red-600",bgColor:"bg-red-50"}});return(h,d)=>h.showStatistics?(y(),V(t(At),{key:0,class:"border border-border/50 bg-gradient-to-br from-card/80 to-card/60 backdrop-blur-sm shadow-lg"},{default:n(()=>[h.qualityAnalysis?(y(),V(t(qt),{key:0,class:"pb-4 border-b border-border/50"},{default:n(()=>[r("div",Fa,[r("div",Na,[r("div",Oa,[s(t(rt),{class:"h-4 w-4 text-blue-600"})]),r("div",null,[s(t(Sr),{class:"text-sm font-semibold"},{default:n(()=>[...d[0]||(d[0]=[L("Academic Quality",-1)])]),_:1}),d[1]||(d[1]=r("p",{class:"text-xs text-muted-foreground"},"AI-powered analysis",-1))])]),r("div",Wa,[r("div",{class:pe(["text-2xl font-bold",F.value.color])},[L(f(h.qualityAnalysis.total_score),1),d[2]||(d[2]=r("span",{class:"text-sm text-muted-foreground"},"/100",-1))],2),s(t(Ee),{class:pe([[F.value.color,F.value.bgColor],"text-xs font-medium"]),variant:"outline"},{default:n(()=>[L(f(F.value.text),1)]),_:1},8,["class"])])]),r("div",La,[r("div",Ia,[d[3]||(d[3]=r("span",{class:"text-muted-foreground"},"Overall Score",-1)),r("span",{class:pe(["font-medium",h.qualityAnalysis.meets_threshold?"text-green-600":"text-orange-600"])},f(h.qualityAnalysis.meets_threshold?"Meets threshold âœ“":"Below 80% threshold"),3)]),r("div",za,[s(t(Er),{"model-value":Math.round(h.qualityAnalysis.total_score||0),class:pe(["h-2",{"[&>[data-slot=progress-indicator]]:bg-green-500":(h.qualityAnalysis.total_score||0)>=80,"[&>[data-slot=progress-indicator]]:bg-yellow-500":(h.qualityAnalysis.total_score||0)>=70&&(h.qualityAnalysis.total_score||0)<80,"[&>[data-slot=progress-indicator]]:bg-orange-500":(h.qualityAnalysis.total_score||0)>=60&&(h.qualityAnalysis.total_score||0)<70,"[&>[data-slot=progress-indicator]]:bg-red-500":(h.qualityAnalysis.total_score||0)<60}])},null,8,["model-value","class"]),d[4]||(d[4]=r("div",{class:"absolute inset-0 flex items-center justify-center"},[r("div",{class:"w-0.5 h-4 bg-orange-400/60 rounded-full",style:{"margin-left":"80%"}})],-1))])])]),_:1})):ge("",!0),s(t($t),{class:"p-4 space-y-4"},{default:n(()=>[h.qualityAnalysis?.scores?(y(),z("div",Ga,[d[5]||(d[5]=r("h4",{class:"text-xs font-semibold text-muted-foreground mb-3 flex items-center gap-2"},[r("div",{class:"w-1 h-4 bg-green-500 rounded-full"}),L(" Analysis Results ")],-1)),r("div",Ha,[(y(!0),z(Et,null,Tt(Object.entries(h.qualityAnalysis.scores).filter(([,w])=>w.max>0),([w,g])=>(y(),z("div",{key:w,class:"flex items-center justify-between p-3 rounded-lg bg-muted/30 hover:bg-muted/40 transition-colors"},[r("div",Ua,[r("div",Va,f(w),1),r("div",Ba,[L(f(g.score)+"/"+f(g.max)+" points ",1),r("span",{class:pe(["ml-1",{"text-red-500":g.percentage<50,"text-orange-500":g.percentage>=50&&g.percentage<75,"text-blue-500":g.percentage>=75&&g.percentage<90,"text-green-500":g.percentage>=90}])}," ("+f(Math.round(g.percentage))+"%) ",3)])]),r("div",Qa,[r("div",{class:pe(["h-full transition-all duration-500 rounded-full",{"bg-red-500":g.percentage<50,"bg-orange-500":g.percentage>=50&&g.percentage<75,"bg-blue-500":g.percentage>=75&&g.percentage<90,"bg-green-500":g.percentage>=90}]),style:Ve({width:`${g.percentage}%`})},null,6)])]))),128))])])):ge("",!0),q.value.length>0?(y(),z("div",Ka,[d[6]||(d[6]=r("h4",{class:"text-xs font-semibold text-muted-foreground mb-3 flex items-center gap-2"},[r("div",{class:"w-1 h-4 bg-orange-500 rounded-full"}),L(" Focus Areas ")],-1)),r("div",Xa,[(y(!0),z(Et,null,Tt(q.value,w=>(y(),z("div",{key:w.category,class:"flex items-center gap-3 p-3 rounded-lg border border-orange-200/50 bg-orange-50/30"},[s(t(Ta),{class:"h-4 w-4 text-orange-500 flex-shrink-0"}),r("div",Ja,[r("div",Ya,f(w.category),1),r("div",Za,[L(f(w.score)+"/"+f(w.max)+" points - ",1),r("span",{class:pe({"text-red-600":w.status==="poor","text-orange-600":w.status==="needs-work","text-yellow-600":w.status==="fair"})},f(w.status==="poor"?"needs significant improvement":w.status==="needs-work"?"needs improvement":"fair, could be better"),3)])])]))),128))])])):ge("",!0),h.isAnalyzing?(y(),z("div",es,[s(t(Ea),{class:"h-4 w-4 text-blue-500 animate-pulse"}),d[7]||(d[7]=r("span",{class:"text-sm text-blue-700 font-medium"},"Analyzing academic quality with AI...",-1))])):ge("",!0),!h.qualityAnalysis&&!h.isAnalyzing?(y(),z("div",ts,[s(t(rt),{class:"h-8 w-8 text-muted-foreground mx-auto mb-2"}),d[8]||(d[8]=r("p",{class:"text-sm text-muted-foreground"},'Click "Analyze" to get AI-powered quality insights',-1))])):ge("",!0)]),_:1})]),_:1})):ge("",!0)}});function rs(M){const{delay:k=1e4,onSave:q}=M,F=c(!1),h=c(!1),d=c(null),w=()=>{F.value=!0,d.value&&clearTimeout(d.value),d.value=setTimeout(()=>{g(!0)},k)},g=async(_=!1)=>{if(!h.value){h.value=!0;try{await q(_),F.value=!1,d.value&&(clearTimeout(d.value),d.value=null)}finally{h.value=!1}}};return{hasUnsavedChanges:F,isSaving:h,triggerAutoSave:w,save:g,clearAutoSave:()=>{d.value&&(clearTimeout(d.value),d.value=null)}}}function as(M){const k=c({sentences:0,paragraphs:0,readingTime:0,avgWordLength:0,uniqueWords:0,commonWords:[]}),q=$(()=>M.value?M.value.split(/\s+/).filter(d=>d.length>0).length:0),F=()=>{if(!M.value){k.value={sentences:0,paragraphs:0,readingTime:0,avgWordLength:0,uniqueWords:0,commonWords:[]};return}const d=M.value,w=d.split(/\s+/).filter(A=>A.length>0),g=d.split(/[.!?]+/).filter(A=>A.trim().length>0),l=d.split(`

`).filter(A=>A.trim().length>0),_=new Map;w.forEach(A=>{const v=A.toLowerCase().replace(/[^a-z0-9]/g,"");v&&_.set(v,(_.get(v)||0)+1)});const m=new Set(["the","a","an","and","or","but","in","on","at","to","for","of","with","by","is","was","are","were"]),N=Array.from(_.entries()).filter(([A])=>!m.has(A)).sort((A,v)=>v[1]-A[1]).slice(0,5).map(([A])=>A);k.value={sentences:g.length,paragraphs:l.length,readingTime:Math.ceil(w.length/200),avgWordLength:w.reduce((A,v)=>A+v.length,0)/w.length,uniqueWords:_.size,commonWords:N}},h=$(()=>{if(!M.value)return 0;let d=0;const w=M.value;w.includes("##")&&(d+=20),w.length>1e3&&(d+=20),w.match(/\[.*?\]/g)&&(d+=15),(w.includes("**")||w.includes("*"))&&(d+=10);const g=w.split(/[.!?]+/).filter(_=>_.trim().length>0);if(g.length>0){const _=g.reduce((m,N)=>m+N.split(/\s+/).length,0)/g.length;_>10&&_<25&&(d+=20)}return w.split(`

`).filter(_=>_.trim().length>0).length>3&&(d+=15),Math.min(d,100)});return{writingStats:k,currentWordCount:q,writingQualityScore:h,calculateWritingStats:F}}function ss(M,k=c(3e3),q=.8){const F=u=>{if(!u)return 0;const U=u.replace(/<[^>]*>/g,"").trim().replace(/\s+/g," ");if(!U)return 0;const P=U.match(/\b\w+\b/g);return P?P.length:0},h=u=>u?u.replace(/<[^>]*>/g,"").replace(/\r\n|\r/g,`
`).trim().split(/\n\s*\n/).filter(R=>R.trim().length>0).length:0,d=u=>{if(!u)return 0;const U=u.replace(/<[^>]*>/g,"").match(/[.!?]+/g);return U?U.length:0},w=u=>Math.round(u/200*10)/10,g=$(()=>F(M.value)),l=$(()=>M.value.length),_=$(()=>M.value.replace(/\s/g,"").length),m=$(()=>h(M.value)),N=$(()=>d(M.value)),A=$(()=>w(g.value)),v=$(()=>{const u=k.value;return!u||u<=0?0:Math.min(g.value/u*100,100)}),j=$(()=>g.value>=k.value*q),H=$(()=>{const u=k.value-g.value;return Math.max(u,0)}),K=$(()=>{const u=k.value*q-g.value;return Math.max(u,0)}),Y=$(()=>({wordCount:g.value,characterCount:l.value,characterCountNoSpaces:_.value,paragraphCount:m.value,sentenceCount:N.value,readingTimeMinutes:A.value})),fe=$(()=>({current:g.value,target:k.value,percentage:v.value,isComplete:j.value,completionThreshold:q})),ye=u=>u>=1e3?`${Math.round(u/100)/10}k`:u.toString(),me=(u=0)=>`${Math.round(v.value*Math.pow(10,u))/Math.pow(10,u)}%`,ve=()=>`${g.value} / ${k.value} words (${me()}%)`,O=()=>{if(j.value)return`âœ… Complete (${ye(g.value)} words)`;const u=K.value;return`${ye(u)} more words to complete`},S=()=>{const u=g.value,x=k.value;return u===0?"empty":u<x*.25?"started":u<x*.75?"progressing":u<x*q?"near_complete":u<x?"complete":"exceeded"},B=()=>{const u=S();return{empty:"text-gray-500",started:"text-blue-500",progressing:"text-yellow-500",near_complete:"text-orange-500",complete:"text-green-500",exceeded:"text-emerald-600"}[u]},Z=()=>{const u=S();return{empty:"bg-gray-200",started:"bg-blue-200",progressing:"bg-yellow-200",near_complete:"bg-orange-200",complete:"bg-green-200",exceeded:"bg-emerald-200"}[u]},ie=800,Te=$(()=>g.value>=ie),D=$(()=>Math.max(ie-g.value,0)),T=$(()=>Math.min(g.value/ie*100,100));return{currentWordCount:g,characterCount:l,characterCountNoSpaces:_,paragraphCount:m,sentenceCount:N,readingTimeMinutes:A,progressPercentage:v,isComplete:j,wordsRemaining:H,wordsToComplete:K,wordCountStats:Y,wordCountProgress:fe,meetsDefenseThreshold:Te,defenseWordsRemaining:D,defenseProgressPercentage:T,DEFENSE_THRESHOLD:ie,formatWordCount:ye,formatProgress:me,getProgressDisplay:ve,getCompletionDisplay:O,getWordCountStatus:S,getStatusColor:B,getProgressBarColor:Z,countWords:F}}function os(M,k,q,F){const d=c(!1),w=c(0),g=c(!1),l=S=>{if(!S)return 0;const Z=S.replace(/<[^>]*>/g,"").trim().replace(/\s+/g," ");if(!Z)return 0;const ie=Z.match(/\b\w+\b/g);return ie?ie.length:0},_=$(()=>l(q.value)),m=$(()=>_.value>=800),N=()=>`defense_generation_triggered_${M.id}_ch_${k.chapter_number}`,A=()=>{const S=N();return localStorage.getItem(S)==="true"},v=()=>{const S=N();localStorage.setItem(S,"true"),d.value=!0},j=()=>{const S=N();localStorage.removeItem(S),d.value=!1,console.log(`ðŸ”„ DEFENSE WATCHER: Reset generation trigger for Chapter ${k.chapter_number}`)},H=Ma(async()=>{if(!g.value)return;const S=_.value;console.log(`ðŸ“Š DEFENSE WATCHER: Word count check - Chapter ${k.chapter_number}: ${S} words`),S<800*.8&&d.value&&(console.log("â¬‡ï¸ DEFENSE WATCHER: Content dropped below 80% of threshold, resetting trigger"),j()),w.value=S},2e3),K=()=>g.value?void 0:(g.value=!0,d.value=A(),w.value=_.value,console.log(`ðŸ‘€ DEFENSE WATCHER: Started watching Chapter ${k.chapter_number}`),console.log(`   Initial word count: ${w.value}`),console.log(`   Generation already triggered: ${d.value}`),console.log("   Threshold: 800 words"),Me(q,(B,Z)=>{B!==Z&&H()},{immediate:!1})),Y=()=>{g.value=!1,H.cancel(),console.log(`ðŸ›‘ DEFENSE WATCHER: Stopped watching Chapter ${k.chapter_number}`)},fe=async()=>{console.log(`ðŸ” DEFENSE WATCHER: Force checking Chapter ${k.chapter_number}`),await H(),H.flush()},ye=$(()=>{const S=_.value;return S>0&&S<800&&!d.value}),me=$(()=>{const S=_.value/800*100;return Math.min(S,100)}),ve=$(()=>{const S=800-_.value;return Math.max(S,0)});return{isWatching:g,hasTriggeredGeneration:d,currentWordCount:_,lastWordCount:w,meetsThreshold:m,shouldShowProgressIndicator:ye,progressPercentage:me,wordsRemaining:ve,startWatching:K,stopWatching:Y,forceCheck:fe,resetGenerationTrigger:j,markGenerationTriggered:v,getStatusMessage:()=>{const S=_.value;return d.value?`Defense questions available (${S} words)`:S>=800?`Ready for defense questions (${S} words)`:S>0?`${800-S} more words needed for defense questions`:"Start writing to enable defense questions (800 words needed)"},countWords:l,DEFENSE_WORD_COUNT_THRESHOLD:800}}function ns(M){const k=c(!1),q=c(null),F=c([]),h=c(null),d=$(()=>{if(!q.value?.quality_level)return"text-muted-foreground";switch(q.value.quality_level){case"Excellent":return"text-green-600";case"Good":return"text-blue-600";case"Satisfactory":return"text-yellow-600";case"Needs Improvement":return"text-orange-600";case"Poor":return"text-red-600";default:return"text-muted-foreground"}}),w=$(()=>q.value?.scores?Object.entries(q.value.scores).sort(([,v],[,j])=>v.percentage-j.percentage).slice(0,3).map(([v,j])=>({category:v.replace(" & "," & "),percentage:Math.round(j.percentage),score:j.score,max:j.max})):[]),g=async()=>{try{k.value=!0,h.value=null,await xe.get("/sanctum/csrf-cookie");const v=await xe.post(te("api.chapters.analysis.analyze",{chapter:M}));if(v.data.success)return q.value=v.data.analysis,v.data.analysis;throw new Error(v.data.error||"Analysis failed")}catch(v){return h.value=v.response?.data?.error||v.message||"Analysis failed",console.error("Chapter analysis failed:",v),null}finally{k.value=!1}};return{isAnalyzing:k,latestAnalysis:q,analysisHistory:F,error:h,qualityLevelColor:d,topImprovementAreas:w,analyzeChapter:g,getLatestAnalysis:async()=>{try{await xe.get("/sanctum/csrf-cookie");const v=await xe.get(te("api.chapters.analysis.latest",{chapter:M}));return v.data.success?(q.value=v.data.analysis,v.data.analysis):(q.value=null,null)}catch(v){return v.response?.status!==404&&(h.value=v.response?.data?.error||v.message||"Failed to get analysis",console.error("Failed to get latest analysis:",v)),null}},getAnalysisHistory:async()=>{try{await xe.get("/sanctum/csrf-cookie");const v=await xe.get(te("api.chapters.analysis.history",{chapter:M}));if(v.data.success)return F.value=v.data.analyses,v.data.analyses;throw new Error(v.data.error||"Failed to get history")}catch(v){return h.value=v.response?.data?.error||v.message||"Failed to get analysis history",console.error("Failed to get analysis history:",v),[]}},autoAnalyze:async(v,j=500)=>{v>=j&&await g()},getScoreColor:(v,j)=>{const H=v/j*100;return H>=80?"text-green-600":H>=70?"text-blue-600":H>=60?"text-yellow-600":H>=40?"text-orange-600":"text-red-600"},getProgressVariant:v=>v>=80?"success":v>=60?"default":"destructive"}}const ls={key:2,class:"flex h-screen flex-col overflow-hidden bg-zinc-50 dark:bg-zinc-950 font-sans selection:bg-primary/20"},is={class:"relative z-20 flex flex-shrink-0 items-center justify-between border-b border-border/40 bg-background/60 p-4 backdrop-blur-xl supports-[backdrop-filter]:bg-background/40 transition-all duration-300"},us={class:"flex items-center gap-5"},cs={class:"flex flex-col"},ds={class:"flex items-center gap-3 text-xs text-muted-foreground"},ps={class:"flex items-center gap-1.5"},gs={class:"flex items-center gap-4"},vs={class:"flex items-center p-1 rounded-full border border-border/40 bg-background/50 backdrop-blur-sm shadow-sm"},hs={class:"flex items-center gap-2"},fs={class:"relative z-20 h-[2px] w-full bg-border/20"},ms={key:0,class:"mx-3 my-2"},bs={class:"relative overflow-hidden rounded-xl border border-blue-200 bg-gradient-to-br from-blue-50 to-purple-50 p-3 shadow-sm dark:border-blue-800 dark:from-blue-950/30 dark:to-purple-950/30"},ws={class:"relative z-10 mb-2 flex items-center justify-between"},xs={class:"flex items-center gap-2"},ys={class:"relative"},_s={class:"flex h-6 w-6 items-center justify-center rounded-full bg-gradient-to-br from-blue-500 to-purple-600"},Cs={class:"text-xs text-blue-700 dark:text-blue-300"},ks={class:"relative z-10 mb-2"},Ss={class:"mb-1 flex items-center justify-between"},Es={class:"text-xs text-blue-600 dark:text-blue-400"},Ts={class:"relative h-2 overflow-hidden rounded-full bg-blue-100 dark:bg-blue-900/50"},As={class:"relative z-10 flex items-center gap-2"},$s={class:"flex-shrink-0"},qs={key:0,class:"h-2 w-2 animate-bounce rounded-full bg-blue-500"},Ps={key:1,class:"flex gap-0.5"},js={key:2,class:"h-2 w-2 animate-spin rounded-full border-2 border-blue-500 border-t-transparent"},Rs={key:3,class:"h-2 w-2 rounded-full bg-green-500"},Ds={key:4,class:"h-2 w-2 rounded-full bg-red-500"},Ms={class:"flex-1 text-xs text-blue-800 dark:text-blue-200"},Fs={class:"relative z-10 flex flex-1 overflow-hidden"},Ns={key:0,class:"w-[320px] flex-shrink-0 border-r border-border/50 bg-background/80 backdrop-blur-xl shadow-xl z-20"},Os={class:"h-full overflow-y-auto custom-scrollbar"},Ws={class:"p-4"},Ls={class:"mb-3"},Is={class:"text-xs text-muted-foreground"},zs={class:"flex min-h-0 flex-1 flex-col bg-transparent relative"},Gs={class:"flex-1 overflow-hidden relative"},Hs={class:"absolute inset-0 overflow-y-auto custom-scrollbar flex flex-col items-center py-8 px-4 sm:px-8"},Us={class:"flex items-center justify-between"},Vs={class:"space-y-1"},Bs={class:"flex items-center gap-2"},Qs={class:"flex items-center justify-between px-6 py-2 border-b border-border/30 bg-muted/5"},Ks={class:"flex items-center gap-2"},Xs={class:"space-y-1 relative z-10"},Js={class:"text-sm font-medium text-foreground"},Ys={class:"text-[10px] text-muted-foreground line-clamp-2 leading-relaxed"},Zs={class:"flex-1 relative bg-background"},eo={class:"px-12 py-10 min-h-[500px]"},to={class:"sticky bottom-0 z-10 border-t border-border/30 bg-background/80 backdrop-blur-md p-4 flex items-center justify-between"},ro={class:"text-xs text-muted-foreground"},ao={class:"flex items-center gap-2"},so={key:0,class:"w-72 flex-shrink-0 border-l border-border/40 bg-background/40 backdrop-blur-md"},oo={class:"h-full overflow-y-auto custom-scrollbar"},no={class:"space-y-6 p-4"},lo={class:"min-h-screen bg-gradient-to-br from-background via-background to-muted/20"},io={class:"w-full px-4 py-6 transition-all duration-300"},uo={class:"mb-6 flex items-center justify-between"},co={class:"flex items-center gap-4"},po={class:"text-sm text-muted-foreground"},go={class:"flex items-center gap-2"},vo={class:"hidden items-center gap-2 lg:flex"},ho={class:"mb-6"},fo={class:"mb-2 flex items-center justify-between"},mo={class:"text-sm text-muted-foreground"},bo={key:0,class:"mb-6"},wo={class:"relative overflow-hidden rounded-xl border border-blue-200 bg-gradient-to-br from-blue-50 to-purple-50 p-4 shadow-sm dark:border-blue-800 dark:from-blue-950/30 dark:to-purple-950/30"},xo={class:"relative z-10 mb-3 flex items-center justify-between"},yo={class:"flex items-center gap-2"},_o={class:"relative"},Co={class:"flex h-8 w-8 items-center justify-center rounded-full bg-gradient-to-br from-blue-500 to-purple-600"},ko={class:"text-xs text-blue-700 dark:text-blue-300"},So={class:"relative z-10 mb-3"},Eo={class:"mb-1 flex items-center justify-between"},To={class:"text-xs text-blue-600 dark:text-blue-400"},Ao={class:"relative h-2 overflow-hidden rounded-full bg-blue-100 dark:bg-blue-900/50"},$o={class:"relative z-10 flex items-center gap-2"},qo={class:"flex-shrink-0"},Po={key:0,class:"h-3 w-3 animate-bounce rounded-full bg-blue-500"},jo={key:1,class:"flex gap-1"},Ro={key:2,class:"h-3 w-3 animate-spin rounded-full border-2 border-blue-500 border-t-transparent"},Do={key:3,class:"h-3 w-3 rounded-full bg-green-500"},Mo={key:4,class:"h-3 w-3 rounded-full bg-red-500"},Fo={class:"flex-1 text-xs text-blue-800 dark:text-blue-200"},No={key:0,class:"relative z-10 mt-3 border-t border-blue-200 pt-3 dark:border-blue-800"},Oo={class:"flex items-center justify-between text-xs"},Wo={class:"flex items-center gap-1"},Lo={class:"flex gap-0.5"},Io={class:"ml-1 text-blue-600 dark:text-blue-400"},zo={class:"grid grid-cols-1 gap-6 lg:grid-cols-12 transition-all duration-300"},Go={class:"hidden lg:block lg:col-span-2 transition-all duration-300"},Ho={class:"h-[calc(100vh-320px)] overflow-y-auto space-y-6 custom-scrollbar pr-1"},Uo={class:"flex items-center justify-between"},Vo={class:"flex items-center gap-2"},Bo={class:"flex items-center gap-2"},Qo={class:"space-y-2"},Ko={class:"space-y-2"},Xo={class:"flex items-center justify-between"},Jo={class:"flex items-center gap-2"},Yo={class:"flex flex-col gap-2 pt-4 sm:flex-row"},Zo={class:"hidden sm:inline"},en={class:"sm:hidden"},tn={class:"hidden sm:inline"},rn={class:"sm:hidden"},an={class:"hidden lg:block lg:col-span-3 transition-all duration-300"},sn={class:"h-[calc(100vh-40px)] overflow-y-auto space-y-4 custom-scrollbar px-1"},on=1e3,gl=kr({__name:"ChapterEditor",props:{project:{},chapter:{},allChapters:{},facultyChapters:{},mode:{}},setup(M){const k=Re(()=>De(()=>import("./AISidebar-Cw6jZnjY.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47]))),q=Re(()=>De(()=>import("./ChapterNavigation-CshsLq65.js"),__vite__mapDeps([48,49,3,1,2,20,7,8,21,22,14,50,18,13,15,16,33,51,52,53,54,40]))),F=Re(()=>De(()=>import("./MobileNavOverlay-pI7EpWN6.js"),__vite__mapDeps([55,1,2,56,3,0,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,49,50,51,52,53,54,57,58,59,60,61,62,63,64,65]))),h=Re(()=>De(()=>import("./ChatModeLayout-cd16tG5T.js"),__vite__mapDeps([66,67,1,2,18,3,8,4,11,7,12,20,21,23,24,25,26,27,14,28,29,19,30,31,32,33,34,35,68,69,70,71,59,72,73,9,10,13,15,16,62,36,74,75,56,76,63,40,38,77,78,51,79,80,44,81,60,54,43,42,46,41,52,82,83,84,85]))),d=Re(()=>De(()=>import("./CitationVerificationLayout-BnTn0EVQ.js"),__vite__mapDeps([86,18,3,1,2,8,4,5,11,7,12,20,21,25,69,23,24,26,27,14,28,29,19,30,31,32,33,34,35,70,71,59,72,73,9,10,13,15,16,62,36,74,75,76,52]))),w=Re(()=>De(()=>import("./DefensePreparationPanel-CGukafK_.js"),__vite__mapDeps([87,57,1,2,56,3,18,8,4,5,6,7,11,12,20,21,9,10,58,59,36,60,61,37,45,62,14,63]))),g=Re(()=>De(()=>import("./DataCollectionPanel-BJqiQkci.js"),__vite__mapDeps([88,64,1,2,13,3,14,8,7,15,16]))),l=M,_=c(l.chapter.title||""),m=c(l.chapter.content||""),N=c(!0),A=c(!1),v=c(!1);c(!1);const j=c(!1);c("write");const H=c("");c(0);const K=c(!1),Y=c(!1),fe=c(!0),ye=()=>{try{return localStorage.getItem(`chatMode_${l.project.id}_${l.chapter.chapter_number}`)==="true"}catch(a){return console.warn("Failed to load chat mode from localStorage:",a),!1}},me=a=>{try{localStorage.setItem(`chatMode_${l.project.id}_${l.chapter.chapter_number}`,String(a))}catch(e){console.warn("Failed to save chat mode to localStorage:",e)}},ve=c(!1),O=c(!1),S=c(!1),B=c(!1),Z=c(!1),ie=c(!0),Te=c(!0),D=c(!1),T=c(""),u=c(0),x=c(""),U=c(0),P=c(0),R=c(null),W=c(""),at=c(0),pt=c(""),Pt=c([]),Be=c(!1),Ae=c(!1),{balance:Tr,showPurchaseModal:jt,requiredWordsForModal:Ar,actionDescriptionForModal:$r,checkAndPrompt:qr,closePurchaseModal:Pr,estimates:ke}=ba(),Fe=(a,e)=>qr(Math.max(1,Math.round(a)),e),Qe=c(!1),Ne=c(""),Oe=c(""),jr=c(0),$e=c(null),Rr=c(0),Dr=c(null),Mr=c([]),Fr=c([]),Nr=c(null);c(null),c(null);const Or=c(),Rt=c(),Wr=c(),Dt=c();c(null),c(null);const re=c(!1),{hasUnsavedChanges:Lr,isSaving:Se,triggerAutoSave:We,save:_e,clearAutoSave:Ir}=rs({delay:1e4,onSave:Ot});let Mt=0;const zr=()=>{const a=Date.now();a-Mt>on&&(Mt=a,C.success("Saved",{duration:2e3}))},{contentHistory:Gr,historyIndex:Hr,addToHistory:Ur,undo:Vr,redo:Br}=_a(l.chapter.content||""),{writingStats:gt,writingQualityScore:Ce,calculateWritingStats:st}=as(m),{isAnalyzing:Ft,latestAnalysis:X,getLatestAnalysis:Qr}=ns(l.chapter.id),ue=$(()=>{if(l.facultyChapters&&l.facultyChapters.length>0){const e=l.facultyChapters.find(o=>o.number===l.chapter.chapter_number);if(e?.word_count)return e.word_count}if(l.project?.outlines&&l.project.outlines.length>0){const e=l.project.outlines.find(o=>o.chapter_number===l.chapter.chapter_number);if(e?.target_word_count)return e.target_word_count}const a=l.project.type==="undergraduate"?2500:3500;return l.chapter.chapter_number===1||l.chapter.chapter_number===5?Math.round(a*.8):a}),{currentWordCount:ee,progressPercentage:Kr,meetsDefenseThreshold:Xr,defenseWordsRemaining:Jr,defenseProgressPercentage:Yr,DEFENSE_THRESHOLD:ot,countWords:Nt}=ss(m,ue),Ke=Kr,vt=$(()=>{const a=_.value?.trim(),e=m.value?.trim();return a&&a.length>0&&e&&e.length>50}),be=$(()=>l.project),we=$(()=>l.chapter),qe=$(()=>l.allChapters);async function Ot(a=!1){try{const e=await fetch(te("chapters.save",{project:l.project.id}),{method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json","X-Requested-With":"XMLHttpRequest","X-CSRF-TOKEN":document.querySelector('meta[name="csrf-token"]')?.getAttribute("content")||""},body:JSON.stringify({project_id:l.project.id,chapter_number:l.chapter.chapter_number,title:_.value,content:m.value,auto_save:a,statistics:gt.value,quality_score:Ce.value})});console.log("Response status:",e.status,e.statusText),console.log("Response headers:",e.headers);const o=await e.text();console.log("Raw response:",o);let i;try{i=JSON.parse(o)}catch(p){throw console.error("JSON parse error:",p),console.error("Response was:",o),new Error(`Server returned non-JSON response: ${e.status} ${e.statusText}`)}e.ok}catch(e){throw a||C.error("âŒ Save Failed",{description:"Please try again or check your connection."}),e}}const Wt=()=>{const a=Vr();a!==null&&(m.value=a,We())},Lt=()=>{const a=Br();a!==null&&(m.value=a,We())},Xe=a=>{Lr.value&&confirm("You have unsaved changes. Save before switching chapters?")&&_e();const e=l.allChapters.find(p=>p.chapter_number===a),i=e?.content&&e.content.trim()!==""?"chapters.edit":"chapters.write";Ge.visit(te(i,{project:l.project.slug,chapter:a}),{only:["chapter","mode","allChapters"],preserveState:!0,preserveScroll:!1})},ht=async()=>{const a=ke.chapter(ue.value||0);if(!Fe(a,"generate the next chapter with AI"))return;await _e();const e=l.allChapters.map(p=>p.chapter_number).sort((p,b)=>p-b),o=e.indexOf(l.chapter.chapter_number);let i;if(o===-1||o===e.length-1)i=Math.max(...e)+1;else{const p=e[o+1];p===l.chapter.chapter_number+1?i=p:i=l.chapter.chapter_number+1}console.log("ðŸ“ Generating next chapter:",{currentChapter:l.chapter.chapter_number,existingChapters:e,nextChapterNumber:i});try{const p=te("chapters.write",{project:l.project.slug,chapter:i});console.log("ðŸ”— Generated URL for next chapter:",p);const b=new URL(p,window.location.origin);b.searchParams.set("ai_generate","true"),b.searchParams.set("generation_type","progressive"),console.log("ðŸš€ Navigating to:",b.toString()),Ge.visit(b.toString())}catch(p){console.error("âŒ Error generating next chapter:",p),C.error("Navigation Error",{description:"Failed to navigate to next chapter. Please try again."})}},ft=(a,e)=>{a==="section"&&e?.section?Zr(e.section):a==="rephrase"&&e?.selectedText?ea(e.selectedText,e.style||"Academic Formal"):a==="expand"&&e?.selectedText?ta(e.selectedText):mt(a)},Zr=async a=>{D.value=!0,W.value="",P.value=0,u.value=5,x.value="Papers",T.value="Checking for verified sources...",U.value=600,pt.value=m.value||l.chapter.content||"",re.value=!0;try{u.value=50,x.value="Papers",T.value="Using existing verified sources...",await new Promise(o=>setTimeout(o,500)),x.value="Section",T.value=`Generating ${a} section with verified sources...`,u.value=51;const e=te("chapters.stream",{project:l.project.slug,chapter:l.chapter.chapter_number});R.value=new EventSource(`${e}?generation_type=section&section_type=${a}`),R.value.onmessage=o=>{const i=JSON.parse(o.data);switch(i.type){case"start":x.value="Generating Section",u.value=52,T.value=`Starting ${a} section generation...`;break;case"content":W.value+=i.content,P.value=i.word_count||Nt(W.value);const p=Date.now();if(p-at.value>150){const E=W.value;m.value=pt.value+`

`+E,at.value=p;const Q=Math.min(P.value/U.value*43,43);u.value=Math.max(52,52+Q),T.value=`Generating ${a} section... (${P.value} / ${U.value} words)`,st(),Kt()}break;case"complete":u.value=100,x.value="Complete",T.value=`âœ“ Generated ${a} section (${P.value} words)`;const b=W.value;m.value=pt.value+`

`+b,_e(!0),C.success("âœ… Section Generated Successfully",{description:`Added ${a} section with ${P.value} words and verified citations.`,duration:5e3}),D.value=!1,R.value?.close();break;case"error":throw new Error(i.message||"Section generation failed");case"heartbeat":u.value<95&&(u.value+=.5);break}},R.value.onerror=()=>{D.value=!1,x.value="Error",T.value="âŒ Section generation failed",C.error("âŒ Generation Failed",{description:"Unable to generate section. Please check your connection and try again."}),R.value?.close()}}catch(e){console.error("Section generation failed:",e),D.value=!1,x.value="Error",T.value="âŒ Section generation error",C.error("âŒ Generation Failed",{description:"Section generation encountered an error."})}},ea=async(a,e)=>{const o=a.split(/\s+/).length,i=Math.max(o,ke.rephrase());if(!Fe(i,`rephrase about ${o} words`))return;console.log("ðŸš€ ChapterEditor - Starting rephrase generation:",{selectedTextLength:a.length,selectedTextPreview:a.substring(0,100)+(a.length>100?"...":""),style:e,timestamp:new Date().toISOString()}),D.value=!0,W.value="",P.value=0,u.value=10,x.value="Rephrasing",T.value="Preparing to rephrase selected text...",U.value=Math.max(o,50);const p=Je.value||nt.value,b=p?.getSelectionRange();console.log("ðŸ“ ChapterEditor - Editor and selection info:",{hasActiveEditor:!!p,selectionRange:b,selectedWordCount:o,estimatedWords:U.value});const E={originalText:a,range:b,wordCount:o,style:e,startTime:Date.now()};console.log("ðŸ’¾ ChapterEditor - Stored rephrase context:",E),re.value=!0;try{u.value=20,T.value=`Rephrasing ${o} words in ${e} style...`;const ae=`${te("chapters.stream",{project:l.project.slug,chapter:l.chapter.chapter_number})}?generation_type=rephrase&selected_text=${encodeURIComponent(a)}&style=${encodeURIComponent(e)}`;console.log("ðŸŒ ChapterEditor - Creating EventSource:",{url:ae,encodedTextLength:encodeURIComponent(a).length}),R.value=new EventSource(ae),R.value.onmessage=I=>{const J=JSON.parse(I.data);switch(console.log("ðŸ“¨ ChapterEditor - EventSource message received:",{type:J.type,hasContent:!!J.content,contentLength:J.content?.length||0,wordCount:J.word_count}),J.type){case"start":console.log("â–¶ï¸ ChapterEditor - Rephrase generation started"),x.value="Rephrasing Text",u.value=30,T.value=`Rephrasing text in ${e} style...`;break;case"content":W.value+=J.content,P.value=J.word_count||Nt(W.value),console.log("ðŸ“ ChapterEditor - Content chunk received:",{chunkLength:J.content?.length||0,totalBufferLength:W.value.length,totalWords:P.value});const de=Math.min(P.value/U.value*60,60);u.value=Math.max(30,30+de),T.value=`Rephrasing... (${P.value} words)`;break;case"complete":if(console.log("ðŸ ChapterEditor - Rephrase generation complete"),u.value=100,x.value="Complete",T.value=`âœ“ Text rephrased successfully (${P.value} words)`,console.log("ðŸ”„ ChapterEditor - Starting text replacement:",{hasRange:!!E.range,hasContent:!!W.value.trim(),range:E.range,newContentLength:W.value.trim().length,newContentPreview:W.value.trim().substring(0,100)+"..."}),E.range&&W.value.trim()){console.log("ðŸŽ¯ ChapterEditor - Attempting text replacement with activeEditor:",{editorType:p===Je.value?"fullscreen":"normal",hasActiveEditor:!!p});const he=p?.replaceSelection(W.value.trim(),E.range);console.log("ðŸ“Š ChapterEditor - Text replacement result:",{success:he}),he?(console.log("âœ… ChapterEditor - Text replacement successful, updating chapter content"),setTimeout(()=>{const je=p?.getHTML()||m.value;console.log("ðŸ“„ ChapterEditor - Updated chapter content length:",je.length),m.value=je},100)):(console.warn("âŒ ChapterEditor - Failed to replace selected text, falling back to manual update"),C.warning("Please manually replace the selected text",{description:"The rephrased text is ready but couldn't be automatically replaced."}))}else console.error("âŒ ChapterEditor - Cannot replace text:",{missingRange:!E.range,missingContent:!W.value.trim()});_e(!0),C.success("âœ… Text Rephrased Successfully",{description:`Rephrased ${o} words in ${e} style.`,duration:5e3}),tt(P.value||o,`Rephrase (${e})`,"chapter",l.chapter.id).catch(he=>console.error("Failed to record word usage (rephrase):",he)),D.value=!1,R.value?.close();break;case"error":throw new Error(J.message||"Text rephrasing failed");case"heartbeat":u.value<95&&(u.value+=.5);break}},R.value.onerror=()=>{D.value=!1,x.value="Error",T.value="âŒ Text rephrasing failed",C.error("âŒ Rephrasing Failed",{description:"Unable to rephrase text. Please check your connection and try again."}),R.value?.close()}}catch(Q){console.error("Text rephrasing failed:",Q),D.value=!1,x.value="Error",T.value="âŒ Rephrasing error",C.error("âŒ Rephrasing Failed",{description:"Text rephrasing encountered an error."})}},ta=async a=>{const e=a.split(/\s+/).length,o=Math.max(e*2,ke.expand());if(!Fe(o,`expand about ${e} words`))return;console.log("ðŸ“ˆ ChapterEditor - Starting expand generation:",{selectedTextLength:a.length,selectedTextPreview:a.substring(0,100)+(a.length>100?"...":""),timestamp:new Date().toISOString()}),D.value=!0,W.value="",P.value=0,u.value=10,x.value="Expanding",T.value="Preparing to expand selected text...",U.value=Math.max(e*2,100);const i=Je.value||nt.value,p=i?.getSelectionRange();console.log("ðŸ“ ChapterEditor - Editor and selection info for expand:",{hasActiveEditor:!!i,selectionRange:p,selectedWordCount:e,estimatedWords:U.value});const b={originalText:a,range:p,wordCount:e,startTime:Date.now()};console.log("ðŸ’¾ ChapterEditor - Stored expand context:",b);try{const Q=`${te("chapters.stream",{project:l.project.slug,chapter:l.chapter.chapter_number})}?generation_type=expand&selected_text=${encodeURIComponent(a)}`;console.log("ðŸŒ ChapterEditor - Creating EventSource for expand:",{url:Q,encodedTextLength:encodeURIComponent(a).length}),R.value=new EventSource(Q),R.value.onmessage=ae=>{const I=JSON.parse(ae.data);switch(console.log("ðŸ“¨ ChapterEditor - EventSource message received:",{type:I.type,hasContent:!!I.content,contentLength:I.content?.length||0,wordCount:I.word_count}),I.type){case"start":console.log("â–¶ï¸ ChapterEditor - Expand generation started"),x.value="Expanding Text",u.value=20,T.value="Starting text expansion...";break;case"content":W.value+=I.content,P.value=I.word_count||W.value.split(/\s+/).filter(de=>de.length>0).length;const J=Math.min(P.value/U.value*90,90);u.value=Math.max(J,25),T.value=`Expanding text... ${P.value}/${U.value} words`,console.log("ðŸ“ ChapterEditor - Expand content received:",{chunkLength:I.content?.length||0,totalWords:P.value,progress:u.value});break;case"complete":if(console.log("âœ… ChapterEditor - Expand generation complete"),x.value="Complete",T.value="âœ… Text expansion completed",u.value=100,b.range&&W.value.trim()){console.log("ðŸŽ¯ ChapterEditor - Attempting text replacement for expand");const de=i?.replaceSelection(W.value.trim(),b.range);console.log("ðŸ“Š ChapterEditor - Expand text replacement result:",{success:de}),de?(console.log("âœ… ChapterEditor - Expand text replacement successful"),setTimeout(()=>{const he=i?.getHTML()||m.value;console.log("ðŸ“„ ChapterEditor - Updated chapter content length after expand:",he.length),m.value=he},100)):(console.warn("âŒ ChapterEditor - Failed to replace expanded text"),C.warning("Please manually replace the selected text",{description:"The expanded text is ready but couldn't be automatically replaced."}))}else console.error("âŒ ChapterEditor - Cannot replace expanded text:",{missingRange:!b.range,missingContent:!W.value.trim()});_e(!0),C.success("âœ… Text Expanded Successfully",{description:`Expanded ${b.wordCount} words into ${P.value} words`}),tt(P.value||b.wordCount*2,"Expand text","chapter",l.chapter.id).catch(de=>console.error("Failed to record word usage (expand):",de)),D.value=!1,R.value?.close();break;case"error":console.error("âŒ ChapterEditor - Expand generation error:",I.message),D.value=!1,x.value="Error",T.value="âŒ Text expansion failed",C.error("âŒ Expansion Failed",{description:I.message||"Text expansion encountered an error."}),R.value?.close();break}},R.value.onerror=()=>{console.error("âŒ ChapterEditor - Expand stream error occurred"),D.value=!1,x.value="Error",T.value="âŒ Text expansion failed",C.error("âŒ Expansion Failed",{description:"Unable to expand text. Please check your connection and try again."}),R.value?.close()}}catch(E){console.error("Text expansion failed:",E),D.value=!1,x.value="Error",T.value="âŒ Expansion error",C.error("âŒ Expansion Failed",{description:"Text expansion encountered an error."})}},ra=async()=>{Qe.value=!0,Oe.value="Starting",Ne.value="Initializing source collection...",u.value=5;try{const a=document.querySelector('meta[name="csrf-token"]')?.content;if(!a)throw new Error("CSRF token not found - please refresh the page");const e=await fetch(te("api.projects.paper-collection.start",{project:l.project.slug}),{method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json","X-CSRF-TOKEN":a,"X-Requested-With":"XMLHttpRequest"},credentials:"include"});if(!e.ok){const o=await e.text();if(console.error("API Error:",e.status,o),e.status===409)try{const i=JSON.parse(o);throw new Error(i.message||"Source collection is already in progress")}catch{throw new Error("Source collection is already in progress for this project")}throw new Error(`Failed to start source collection: ${e.status}`)}return await aa()}catch(a){return console.error("Paper collection failed:",a),Oe.value="Error",Ne.value="âŒ Source collection failed",Qe.value=!1,!1}},aa=async()=>new Promise(a=>{let e=0;const o=120,i=async()=>{try{const b=await(await fetch(te("api.projects.paper-collection.status",{project:l.project.slug}))).json();if(b.success&&b.data){Nr.value=b.data;const E=b.data.status,Q=b.data.papers_count||b.data.count||0,ae=b.data.message,I=b.data.percentage||0,J=b.data.current_source,de=b.data.sources_completed||[],he=b.data.papers_preview||[];if(jr.value=Q,Rr.value=I,Dr.value=J,Mr.value=de,Fr.value=he,E==="completed"){Oe.value="Complete",Ne.value=`âœ“ Collected ${Q} verified sources from ${de.length} databases`,u.value=50,Qe.value=!1,$e.value&&clearInterval($e.value),a(!0);return}else if(E==="collecting_papers"||E==="initializing"||E==="processing"||E==="storing"){let je="";J&&(je={semantic_scholar:"Semantic Scholar",openalex:"OpenAlex",crossref:"CrossRef",pubmed:"PubMed"}[J]||J),Oe.value=je||"Collecting Sources",Ne.value=ae||"Collecting sources from academic databases...",u.value=Math.min(5+I*.4,45)}else if(E==="collection_failed"){Oe.value="Error",Ne.value=ae||"âŒ Source collection failed",Qe.value=!1,$e.value&&clearInterval($e.value),a(!1);return}}e++,e>=o&&(Oe.value="Timeout",Ne.value="â±ï¸ Source collection timed out",Qe.value=!1,$e.value&&clearInterval($e.value),a(!1))}catch(p){console.error("Error checking paper collection status:",p),e++}};i(),$e.value=setInterval(i,5e3)}),mt=async a=>{const e=ke.chapter(ue.value||0);if(!Fe(e,"generate this chapter with AI"))return;if(D.value=!0,W.value="",P.value=0,u.value=5,x.value="Papers",T.value="Checking for verified sources...",U.value=ue.value,re.value=!0,!await ra()){C.error("Paper Collection Failed",{description:"Unable to collect verified papers. Please try again."}),D.value=!1,re.value=!1;return}x.value="Initializing",T.value="Starting AI generation with verified sources...",u.value=51;const i=setInterval(()=>{u.value<52&&D.value?u.value+=.2:clearInterval(i)},100),p=te("chapters.stream",{project:l.project.slug,chapter:l.chapter.chapter_number});R.value=new EventSource(`${p}?generation_type=${a}`),R.value.onmessage=b=>{const E=JSON.parse(b.data);switch(E.type){case"start":x.value="Connecting",u.value=52,T.value="Connecting to AI service...";break;case"content":x.value="Generating",W.value+=E.content,P.value=E.word_count||W.value.split(/\s+/).filter(I=>I.length>0).length;const Q=Date.now();if(Q-at.value>150){m.value=W.value,at.value=Q;const I=Math.min(P.value/U.value*43,43);u.value=Math.max(52,52+I),T.value=`Generating chapter content... (${P.value} / ${U.value} words)`,st(),Kt()}break;case"heartbeat":u.value<95&&(u.value+=.5);break;case"complete":x.value="Complete",u.value=100,D.value=!1,m.value=W.value;const ae=E.final_word_count||P.value;T.value=`âœ“ Generated ${ae} words successfully`,tt(ae,`Chapter generation (${l.chapter.chapter_number})`,"chapter",l.chapter.id).catch(I=>console.error("Failed to record word usage (chapter generation):",I)),setTimeout(()=>{We()},500),R.value?.close(),R.value=null;break;case"error":x.value="Error",u.value=50,D.value=!1,E.code==="OFFLINE_MODE"?(T.value="ðŸ“¡ AI services offline",C.error("AI Services Offline",{description:"Please check your internet connection and try again."})):(T.value="âŒ Generation failed",C.error("Generation Error",{description:E.message||"Please try again."})),R.value?.close(),R.value=null;break}},R.value.onerror=()=>{x.value="Error",u.value=50,D.value=!1,T.value="âŒ Connection error",C.error("Connection Error",{description:"Please check your internet connection and try again."}),R.value?.close(),R.value=null}},bt=async()=>{if(!H.value)return;const a=ke.suggestion();if(Fe(a,"get AI suggestions")){Be.value=!0;try{const o=await(await fetch(te("chapters.suggestions",{project:l.project.slug,chapter:l.chapter.chapter_number}),{method:"POST",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":document.querySelector('meta[name="csrf-token"]')?.getAttribute("content")||""},body:JSON.stringify({selected_text:H.value,context:m.value})})).json();Pt.value=o.suggestions||[],Pt.value.length&&tt(ke.suggestion(),"AI suggestions","chapter",l.chapter.id).catch(i=>console.error("Failed to record word usage (suggestions):",i))}catch{C.error("Error getting suggestions",{description:"Please try again."})}finally{Be.value=!1}}},wt=()=>{Ae.value=!0,C.success("Citation Manager opened!",{description:"Review and verify your citations in the panel below."})},It=a=>{try{const e=Je.value?.editor||nt.value?.editor;if(!e){C.error("Editor not found");return}const{from:o}=e.state.selection;e.chain().focus().insertContentAt(o,` ${a} `).run(),C.success("Citation inserted successfully")}catch(e){console.error("Failed to insert citation:",e),C.error("Failed to insert citation")}},nt=c(null),Je=c(null),sa=async()=>{try{const a=document.documentElement;a.requestFullscreen?await a.requestFullscreen():a.webkitRequestFullscreen?await a.webkitRequestFullscreen():a.msRequestFullscreen&&await a.msRequestFullscreen()}catch(a){console.error("Error entering fullscreen:",a),C.error("Fullscreen Error",{description:"Unable to enter fullscreen mode"})}},oa=async()=>{try{document.exitFullscreen?await document.exitFullscreen():document.webkitExitFullscreen?await document.webkitExitFullscreen():document.msExitFullscreen&&await document.msExitFullscreen()}catch(a){console.error("Error exiting fullscreen:",a),C.error("Fullscreen Error",{description:"Unable to exit fullscreen mode"})}},zt=async()=>{v.value?await oa():await sa()},Le=()=>{const a=document.fullscreenElement||document.webkitFullscreenElement||document.msFullscreenElement;v.value=!!a},Gt=()=>{A.value=!A.value,document.documentElement.classList.toggle("dark",A.value),localStorage.setItem("darkMode",A.value.toString())},na=()=>{K.value=!K.value,K.value&&(Y.value=!1),me(K.value)},la=()=>{K.value=!1,me(!1)},ia=()=>{Y.value=!Y.value,Y.value&&(K.value=!1,me(!1))},ua=()=>{Y.value=!1},Ht=()=>{re.value=!re.value},Ut=()=>{Ge.visit(te("projects.analysis",{project:l.project.slug}))},Vt=async()=>{try{await _e(!1),Ge.post(te("chapters.mark-complete",{project:l.project.slug,chapter:l.chapter.chapter_number}),{},{onSuccess:()=>{C.success("Chapter marked as complete")},onError:a=>{console.error("Mark complete failed:",a),C.error("Failed to mark chapter as complete")}})}catch(a){console.error("Error marking chapter complete:",a),C.error("Failed to save chapter before marking complete")}},Bt=()=>{Ur(m.value),We(),st()},Qt=a=>{(a.ctrlKey||a.metaKey)&&a.key==="s"&&(a.preventDefault(),_e(),zr()),(a.ctrlKey||a.metaKey)&&!a.shiftKey&&a.key==="z"&&(a.preventDefault(),Wt()),(a.ctrlKey||a.metaKey)&&a.shiftKey&&a.key==="z"&&(a.preventDefault(),Lt()),a.key==="F11"&&(a.preventDefault(),zt())};it(()=>{const a=()=>{S.value=window.innerWidth<1024};a(),window.addEventListener("resize",a);const e=localStorage.getItem("darkMode")==="true";A.value=e,document.documentElement.classList.toggle("dark",e),K.value=ye(),document.addEventListener("keydown",Xt),document.addEventListener("keydown",Qt),document.addEventListener("fullscreenchange",Le),document.addEventListener("webkitfullscreenchange",Le),document.addEventListener("msfullscreenchange",Le),st(),ca()});const Kt=()=>{ut(()=>{if(D.value){const a=re.value?v.value?Dt.value:Wr.value:v.value?Rt.value:Or.value;if(a)try{const e=a;if(!e)return;const o=e.$el||e;if(!o)return;let i=o.querySelector("[data-radix-scroll-area-viewport]");if(i||(i=o.querySelector("[data-viewport]")),i||(i=o.querySelector('[role="region"]')),i||(i=o.querySelector('div[style*="overflow"]')),i||(i=o.querySelector("[data-scrollable]")),!i){const p=o.querySelectorAll("div");for(const b of p){const E=window.getComputedStyle(b);if(E.overflow==="auto"||E.overflow==="scroll"||E.overflowY==="auto"||E.overflowY==="scroll"||b.scrollHeight>b.clientHeight){i=b;break}}}if(!i){const p=o.querySelector('.ProseMirror, [contenteditable="true"]');p&&(i=p.closest('div[style*="overflow"]')||p.closest("[data-radix-scroll-area-viewport]")||p.parentElement)}if(i){const p=i.scrollHeight-i.clientHeight;i.scrollTop=p,requestAnimationFrame(()=>{i.scrollTop=i.scrollHeight,i.scrollTo&&i.scrollTo({top:i.scrollHeight,behavior:"instant"})})}else console.warn("Could not find scrollable viewport in ScrollArea",{scrollAreaEl:o,children:o.children,mode:re.value?"preview":"editor",fullscreen:v.value})}catch(e){console.warn("Auto-scroll failed:",e)}else{const e=document.querySelector(".ProseMirror");e&&e.scrollIntoView({behavior:"instant",block:"end"})}}})},ca=()=>{const a=new URLSearchParams(window.location.search),e=a.get("ai_generate")==="true",o=a.get("generation_type");e&&o&&setTimeout(()=>{if(o==="progressive"){mt("progressive");const i=new URL(window.location.href);i.searchParams.delete("ai_generate"),i.searchParams.delete("generation_type"),window.history.replaceState({},"",i.toString()),C.success("ðŸš€ AI Generation Started",{description:`Generating ${l.chapter.title} with AI assistance...`})}else if(o==="single"){mt("progressive");const i=new URL(window.location.href);i.searchParams.delete("ai_generate"),i.searchParams.delete("generation_type"),window.history.replaceState({},"",i.toString()),C.success("ðŸš€ AI Generation Started",{description:`Generating ${l.chapter.title} with AI assistance...`})}},1e3)},Xt=a=>{if((a.ctrlKey||a.metaKey)&&!["INPUT","TEXTAREA","SELECT"].includes(a.target?.tagName))switch(a.key){case"ArrowLeft":a.preventDefault();const e=l.chapter.chapter_number-1;l.allChapters.find(b=>b.chapter_number===e)&&Xe(e);break;case"ArrowRight":a.preventDefault();const i=l.chapter.chapter_number+1;l.allChapters.find(b=>b.chapter_number===i)&&Xe(i);break}};it(()=>{const a=e=>{const o=i=>{const{scrollTop:p,scrollHeight:b,clientHeight:E}=e,Q=i.deltaY,ae=p<=0,I=p+E>=b;Q<0&&ae||Q>0&&I||i.stopPropagation()};return e.addEventListener("wheel",o,{passive:!0}),()=>e.removeEventListener("wheel",o)};ut(()=>{const e=document.querySelectorAll('[class*="overflow-y-auto"]'),o=[];e.forEach(i=>{if(i instanceof HTMLElement){const p=a(i);o.push(p)}}),window.__scrollChainCleanup=o})}),ma(()=>{Ir(),R.value&&R.value.close(),document.removeEventListener("keydown",Qt),document.removeEventListener("keydown",Xt);const a=window.__scrollChainCleanup;a&&Array.isArray(a)&&(a.forEach(e=>e()),delete window.__scrollChainCleanup),document.removeEventListener("fullscreenchange",Le),document.removeEventListener("webkitfullscreenchange",Le),document.removeEventListener("msfullscreenchange",Le)}),Me(()=>l.chapter,async a=>{_.value=a.title||"",m.value=a.content||"",ce.value=[],ga(),tr(),Pe.value=Yt(),await Ze(!1,{skipGeneration:!0}),await ut(()=>{rr(),lt()})},{immediate:!1});const ce=c([]),Ie=c(!1),ze=c(!1),Ye=c(null),Pe=c(!1),Jt=(a,e)=>`defense_auto_generate_${a}_ch_${e}`,Yt=()=>{try{return localStorage.getItem(Jt(l.project.id,l.chapter.chapter_number))==="true"}catch(a){return console.warn("Failed to load defense auto-generation preference:",a),!1}},da=a=>{try{localStorage.setItem(Jt(l.project.id,l.chapter.chapter_number),String(a))}catch(e){console.warn("Failed to save defense auto-generation preference:",e)}};Pe.value=Yt(),Me(m,Bt),Me(_,We);const le=$(()=>l.chapter),Zt=async a=>{fe.value=a,a&&pa()&&await Ze(!1,{skipGeneration:!0})},pa=()=>{if(!ce.value.length||!Ye.value)return!0;const a=new Date(Date.now()-360*60*1e3);return Ye.value<a},Ze=async(a=!1,e={})=>{if(Ie.value)return;const o=e.skipGeneration??!0;Ie.value=!0;try{console.log("Loading defense questions with params:",{project_id:l.project.id,chapter_number:le.value?.chapter_number,limit:5,force_refresh:a,skip_generation:o});const i=await xe.get(`/api/projects/${l.project.id}/defense/questions`,{params:{chapter_number:le.value?.chapter_number||null,limit:5,force_refresh:a?1:0,skip_generation:o?1:0},headers:{Accept:"application/json","X-Requested-With":"XMLHttpRequest"}});if(console.log("Defense questions loaded:",i.data),console.log("Questions array:",i.data.questions),console.log("Questions count:",i.data.questions?i.data.questions.length:0),ce.value=i.data.questions||[],Ye.value=new Date,i.data.questions&&i.data.questions.length>0){const p=`defense_questions_${l.project.id}_chapter_${le.value?.chapter_number}`;localStorage.setItem(p,JSON.stringify({questions:i.data.questions,chapter_number:le.value?.chapter_number,loaded_at:new Date().toISOString()}))}else a||(console.log("No existing questions found for this chapter"),console.log(`Current word count: ${ee.value}/${ot}`),console.log('User must click "Generate Questions" button to create defense questions'))}catch(i){if(console.error("Failed to load defense questions:",i),i.response)if(console.error("Response status:",i.response.status),console.error("Response data:",i.response.data),i.response.status===422){console.error("Validation errors:",i.response.data.errors);const p=Object.values(i.response.data.errors||{})[0];p&&Array.isArray(p)?C.error(`Validation Error: ${p[0]}`):C.error("Invalid request parameters. Please refresh the page.")}else i.response.status===500?C.error("Server error. Please try again later."):C.error("Failed to load defense questions");else i.request?(console.error("No response received:",i.request),C.error("Network error. Please check your connection.")):(console.error("Error setting up request:",i.message),C.error("An unexpected error occurred"));ce.value=[]}finally{Ie.value=!1}},lt=async()=>{!Pe.value||ze.value||Ie.value||et.value||!yt.value||ce.value.length>0||await xt({autoTriggered:!0})},er=a=>{Pe.value=a,da(a),a&&lt()};Me(m,Bt),Me(_,We),Me([ee,Pe],()=>{lt()});const xt=async(a={})=>{if(ze.value)return;const e=a.autoTriggered??!1,o=ke.defense();if(Fe(o,"generate defense questions")){ze.value=!0;try{const i=b=>b?b.replace(/<[^>]*>/g," ").trim().split(/\s+/).filter(E=>E.length>0).length:0,p=await xe.post(`/api/projects/${l.project.id}/defense/questions/generate`,{chapter_number:le.value.chapter_number},{headers:{"X-CSRF-TOKEN":document.querySelector('meta[name="csrf-token"]')?.getAttribute("content"),Accept:"application/json","Content-Type":"application/json"}});if(p.data&&p.data.questions){ce.value=p.data.questions,Ye.value=new Date;const b=p.data.questions.reduce((Q,ae)=>{const I=i(ae.question),J=i(ae.suggested_answer),de=(ae.key_points||[]).reduce((he,je)=>he+i(je),0);return Q+I+J+de},0),E=`defense_questions_${l.project.id}_chapter_${le.value?.chapter_number}`;localStorage.setItem(E,JSON.stringify({questions:p.data.questions,chapter_number:le.value?.chapter_number,loaded_at:new Date().toISOString()})),C.success(`Generated ${p.data.questions.length} new questions`),tt(b||ke.defense(),"Defense questions","chapter",l.chapter.id).catch(Q=>console.error("Failed to record word usage (defense):",Q)),et.value=!0,va(),e&&console.log("Auto-generated defense questions after meeting threshold.")}}catch(i){console.error("Failed to generate defense questions:",i),C.error("Failed to generate defense questions")}finally{ze.value=!1}}},{hasTriggeredGeneration:et,startWatching:tr,stopWatching:ga,forceCheck:rr,getStatusMessage:ar,markGenerationTriggered:va}=os(l.project,l.chapter,m),yt=Xr,sr=$(()=>{const a=ee.value;return a>0&&a<ot&&!et.value}),or=Yr,nr=Jr,lr=async(a,e)=>{try{await xe.patch(`/api/projects/${l.project.id}/defense/questions/${a}`,{user_marked_helpful:e},{headers:{"X-CSRF-TOKEN":document.querySelector('meta[name="csrf-token"]')?.getAttribute("content"),Accept:"application/json","Content-Type":"application/json"}});const o=ce.value.find(i=>i.id===a);o&&(o.user_marked_helpful=e),C.success(e?"Question marked as helpful":"Removed helpful mark")}catch(o){console.error("Failed to mark question:",o),C.error("Failed to update question")}},ir=async a=>{try{await xe.delete(`/api/projects/${l.project.id}/defense/questions/${a}`,{headers:{"X-CSRF-TOKEN":document.querySelector('meta[name="csrf-token"]')?.getAttribute("content"),Accept:"application/json"}}),ce.value=ce.value.filter(e=>e.id!==a),localStorage.setItem(`defense_questions_${l.project.id}`,JSON.stringify({questions:ce.value,loaded_at:new Date().toISOString()})),C.success("Question hidden")}catch(e){console.error("Failed to hide question:",e),C.error("Failed to hide question")}};return it(async()=>{const a=`defense_questions_${l.project.id}_chapter_${le.value?.chapter_number}`,e=localStorage.getItem(a);let o=!0;if(e){const i=JSON.parse(e),p=new Date(i.loaded_at),b=new Date(Date.now()-360*60*1e3);p>b&&i.chapter_number===le.value?.chapter_number&&(ce.value=i.questions,Ye.value=p,o=!1)}o&&await Ze(!1,{skipGeneration:!0}),tr(),await ut(()=>{rr(),lt()})}),it(async()=>{await Qr()}),(a,e)=>(y(),V(t(xa),null,{default:n(()=>[K.value?(y(),V(t(h),{key:0,project:be.value,chapter:we.value,"chapter-title":_.value,"chapter-content":m.value,"current-word-count":t(ee),"target-word-count":ue.value,"progress-percentage":t(Ke),"writing-quality-score":t(Ce),"is-valid":vt.value,"is-saving":t(Se),"show-preview":N.value,"is-generating":D.value,"generation-progress":T.value,"history-index":t(Hr),"content-history-length":t(Gr).length,"selected-text":H.value,"onUpdate:chapterTitle":e[0]||(e[0]=o=>_.value=o),"onUpdate:chapterContent":e[1]||(e[1]=o=>m.value=o),"onUpdate:selectedText":e[2]||(e[2]=o=>H.value=o),"onUpdate:showPreview":e[3]||(e[3]=o=>N.value=o),onSave:e[4]||(e[4]=o=>Ot(o)),onUndo:Wt,onRedo:Lt,onExitChatMode:la},null,8,["project","chapter","chapter-title","chapter-content","current-word-count","target-word-count","progress-percentage","writing-quality-score","is-valid","is-saving","show-preview","is-generating","generation-progress","history-index","content-history-length","selected-text"])):Y.value?(y(),V(t(d),{key:1,project:be.value,chapter:we.value,"chapter-title":_.value,"chapter-content":m.value,"current-word-count":t(ee),"target-word-count":ue.value,"progress-percentage":t(Ke),onExitCitationMode:ua},null,8,["project","chapter","chapter-title","chapter-content","current-word-count","target-word-count","progress-percentage"])):v.value?(y(),z("div",ls,[e[54]||(e[54]=r("div",{class:"absolute inset-0 z-0 overflow-hidden pointer-events-none"},[r("div",{class:"absolute top-[-20%] left-[-10%] w-[50%] h-[50%] rounded-full bg-blue-500/5 blur-[120px]"}),r("div",{class:"absolute bottom-[-20%] right-[-10%] w-[50%] h-[50%] rounded-full bg-purple-500/5 blur-[120px]"})],-1)),r("div",is,[r("div",us,[s(t(se),null,{default:n(()=>[s(t(oe),{asChild:""},{default:n(()=>[s(t(G),{onClick:e[5]||(e[5]=o=>t(Ge).visit(t(te)("projects.show",l.project.slug))),variant:"ghost",size:"icon",class:"h-10 w-10 rounded-full hover:bg-primary/10 hover:text-primary transition-all duration-300"},{default:n(()=>[s(t(wr),{class:"h-5 w-5"})]),_:1})]),_:1}),s(t(ne),null,{default:n(()=>[...e[32]||(e[32]=[r("p",null,"Back to Project",-1)])]),_:1})]),_:1}),r("div",cs,[s(pr,{as:"h1",class:"text-lg font-bold tracking-tight text-foreground/90 font-display",content:l.project.title},null,8,["content"]),r("div",ds,[s(t(Ee),{variant:"outline",class:"h-5 px-2 rounded-full border-primary/20 bg-primary/5 text-primary font-medium"},{default:n(()=>[L(" Chapter "+f(l.chapter.chapter_number),1)]),_:1}),r("span",ps,[e[33]||(e[33]=r("span",{class:"h-1.5 w-1.5 rounded-full bg-green-500 animate-pulse"},null,-1)),L(" "+f(t(ee))+" words ",1)])])])]),r("div",gs,[r("div",vs,[s(t(G),{onClick:e[6]||(e[6]=o=>ie.value=!ie.value),variant:ie.value?"secondary":"ghost",size:"sm",class:pe(["h-8 px-4 rounded-full text-xs font-medium transition-all duration-300",ie.value?"bg-primary/10 text-primary hover:bg-primary/15":"hover:bg-muted"])},{default:n(()=>[s(t(hr),{class:"mr-2 h-3.5 w-3.5"}),e[34]||(e[34]=L(" Outline ",-1))]),_:1},8,["variant","class"]),e[36]||(e[36]=r("div",{class:"w-px h-4 bg-border/50 mx-1"},null,-1)),s(t(G),{onClick:e[7]||(e[7]=o=>Te.value=!Te.value),variant:Te.value?"secondary":"ghost",size:"sm",class:pe(["h-8 px-4 rounded-full text-xs font-medium transition-all duration-300",Te.value?"bg-primary/10 text-primary hover:bg-primary/15":"hover:bg-muted"])},{default:n(()=>[s(t(dt),{class:"mr-2 h-3.5 w-3.5"}),e[35]||(e[35]=L(" Assistant ",-1))]),_:1},8,["variant","class"])]),r("div",hs,[s(t(se),null,{default:n(()=>[s(t(oe),{asChild:""},{default:n(()=>[s(t(G),{onClick:e[8]||(e[8]=o=>j.value=!j.value),variant:j.value?"secondary":"ghost",size:"icon",class:"h-9 w-9 rounded-full transition-all hover:bg-muted"},{default:n(()=>[s(t(xr),{class:"h-4.5 w-4.5 text-muted-foreground"})]),_:1},8,["variant"])]),_:1}),s(t(ne),null,{default:n(()=>[r("p",null,f(j.value?"Hide":"Show")+" Statistics",1)]),_:1})]),_:1}),s(t(se),null,{default:n(()=>[s(t(oe),{asChild:""},{default:n(()=>[s(t(G),{onClick:Gt,variant:"ghost",size:"icon",class:"h-9 w-9 rounded-full transition-all hover:bg-muted"},{default:n(()=>[A.value?(y(),V(t(vr),{key:1,class:"h-4.5 w-4.5 text-muted-foreground"})):(y(),V(t(gr),{key:0,class:"h-4.5 w-4.5 text-muted-foreground"}))]),_:1})]),_:1}),s(t(ne),null,{default:n(()=>[...e[37]||(e[37]=[r("p",null,"Toggle Theme",-1)])]),_:1})]),_:1}),s(Ct,{project:be.value,"current-chapter":we.value,"all-chapters":qe.value,size:"icon",variant:"ghost",class:"h-9 w-9 rounded-full hover:bg-muted"},null,8,["project","current-chapter","all-chapters"])])])]),r("div",fs,[r("div",{class:"absolute top-0 left-0 h-full bg-gradient-to-r from-blue-500 via-purple-500 to-pink-500 transition-all duration-700 ease-out shadow-[0_0_10px_rgba(59,130,246,0.5)]",style:Ve({width:`${Math.min(t(Ke),100)}%`})},null,4)]),D.value?(y(),z("div",ms,[r("div",bs,[e[43]||(e[43]=r("div",{class:"absolute inset-0 -skew-x-12 animate-pulse bg-gradient-to-r from-transparent via-white/10 to-transparent"},null,-1)),r("div",ws,[r("div",xs,[r("div",ys,[r("div",_s,[s(t(dt),{class:"h-3 w-3 text-white"})]),e[38]||(e[38]=r("div",{class:"absolute inset-0 h-6 w-6 animate-ping rounded-full bg-gradient-to-br from-blue-500 to-purple-600 opacity-20"},null,-1))]),r("div",null,[e[39]||(e[39]=r("h4",{class:"text-xs font-semibold text-blue-900 dark:text-blue-100"},"AI Generator",-1)),r("p",Cs,f(x.value),1)])]),s(t(Ee),{variant:"outline",class:"border-blue-300 text-xs text-blue-700 dark:border-blue-700 dark:text-blue-300"},{default:n(()=>[L(f(Math.round(u.value))+"% ",1)]),_:1})]),r("div",ks,[r("div",Ss,[e[40]||(e[40]=r("span",{class:"text-xs text-blue-800 dark:text-blue-200"},"Generation Progress",-1)),r("span",Es,f(P.value)+" / "+f(U.value)+" words",1)]),r("div",Ts,[r("div",{class:"absolute top-0 left-0 h-full rounded-full bg-gradient-to-r from-blue-500 to-purple-500 transition-all duration-500 ease-out",style:Ve({width:`${u.value}%`})},[...e[41]||(e[41]=[r("div",{class:"absolute inset-0 animate-pulse bg-gradient-to-r from-transparent via-white/30 to-transparent"},null,-1)])],4),r("div",{class:"absolute top-0 left-0 h-full rounded-full bg-gradient-to-r from-blue-400 to-purple-400 opacity-50 blur-sm transition-all duration-500",style:Ve({width:`${u.value}%`})},null,4)])]),r("div",As,[r("div",$s,[x.value==="Initializing"?(y(),z("div",qs)):x.value==="Connecting"?(y(),z("div",Ps,[...e[42]||(e[42]=[r("div",{class:"h-2 w-0.5 animate-pulse rounded-full bg-blue-500"},null,-1),r("div",{class:"h-2 w-0.5 animate-pulse rounded-full bg-purple-500",style:{"animation-delay":"0.2s"}},null,-1),r("div",{class:"h-2 w-0.5 animate-pulse rounded-full bg-blue-500",style:{"animation-delay":"0.4s"}},null,-1)])])):x.value==="Generating"?(y(),z("div",js)):x.value==="Complete"?(y(),z("div",Rs)):(y(),z("div",Ds))]),r("p",Ms,f(T.value),1)])])])):ge("",!0),j.value?(y(),V(Cr,{key:1,"show-statistics":j.value,"current-word-count":t(ee),"writing-stats":t(gt),"quality-analysis":t(X),"is-analyzing":t(Ft),class:"relative z-20 mx-4 mt-2 rounded-lg border border-border/40 bg-background/60 backdrop-blur-md"},null,8,["show-statistics","current-word-count","writing-stats","quality-analysis","is-analyzing"])):ge("",!0),r("div",Fs,[s(ur,{"enter-active-class":"transition-all duration-300 ease-in-out","enter-from-class":"-ml-72 opacity-0","enter-to-class":"ml-0 opacity-100","leave-active-class":"transition-all duration-300 ease-in-out","leave-from-class":"ml-0 opacity-100","leave-to-class":"-ml-72 opacity-0"},{default:n(()=>[ie.value?(y(),z("div",Ns,[r("div",Os,[r("div",Ws,[r("div",Ls,[e[44]||(e[44]=r("h2",{class:"text-sm font-semibold text-foreground mb-1"},"Table of Contents",-1)),r("p",Is,f(qe.value.length)+" Chapters ",1)]),(y(),V(ct,null,{fallback:n(()=>[...e[45]||(e[45]=[r("div",{class:"flex items-center justify-center p-8"},[r("div",{class:"h-6 w-6 animate-spin rounded-full border-2 border-primary border-t-transparent"})],-1)])]),default:n(()=>[s(t(q),{"all-chapters":qe.value,"current-chapter":we.value,project:be.value,outlines:a.project.outlines||[],"faculty-chapters":a.facultyChapters||[],"current-word-count":t(ee),"target-word-count":ue.value,"writing-quality-score":t(Ce),"chapter-content-length":m.value.length,onGoToChapter:Xe,onGenerateNextChapter:ht},null,8,["all-chapters","current-chapter","project","outlines","faculty-chapters","current-word-count","target-word-count","writing-quality-score","chapter-content-length"])]),_:1}))])])])):ge("",!0)]),_:1}),r("div",zs,[r("div",Gs,[r("div",Hs,[s(t(At),{class:"w-full max-w-[850px] min-h-[calc(100vh-180px)] flex flex-col bg-background shadow-xl shadow-black/5 ring-1 ring-black/5 dark:ring-white/10 rounded-xl overflow-hidden transition-all duration-300"},{default:n(()=>[s(t(qt),{class:"flex-shrink-0 border-b border-border/30 px-8 py-6 bg-background/50 backdrop-blur-sm sticky top-0 z-10"},{default:n(()=>[r("div",Us,[r("div",Vs,[s(t(_t),{for:"chapter-title-fs",class:"text-xs font-medium text-muted-foreground uppercase tracking-wider"},{default:n(()=>[...e[46]||(e[46]=[L("Chapter Title",-1)])]),_:1}),s(t(cr),{id:"chapter-title-fs",modelValue:_.value,"onUpdate:modelValue":e[9]||(e[9]=o=>_.value=o),placeholder:"Enter chapter title...",class:"h-auto p-0 border-0 bg-transparent text-2xl font-bold placeholder:text-muted-foreground/40 focus-visible:ring-0 px-0"},null,8,["modelValue"])]),r("div",Bs,[s(t(Ee),{variant:a.chapter.status==="approved"?"default":"secondary",class:"rounded-full px-3"},{default:n(()=>[L(f(a.chapter.status.replace("_"," ")),1)]),_:1},8,["variant"]),s(t(Ee),{variant:"outline",class:pe(["rounded-full px-3 transition-colors",{"text-green-600 border-green-200 bg-green-50 dark:bg-green-900/20 dark:border-green-800":(t(X)?.total_score||0)>=80,"text-yellow-600 border-yellow-200 bg-yellow-50 dark:bg-yellow-900/20 dark:border-yellow-800":(t(X)?.total_score||0)>=70&&(t(X)?.total_score||0)<80,"text-orange-600 border-orange-200 bg-orange-50 dark:bg-orange-900/20 dark:border-orange-800":(t(X)?.total_score||0)>=60&&(t(X)?.total_score||0)<70,"text-red-600 border-red-200 bg-red-50 dark:bg-red-900/20 dark:border-red-800":(t(X)?.total_score||0)<60}])},{default:n(()=>[L(f(t(X)?.total_score?Math.round(t(X).total_score):t(Ce))+"% Quality ",1)]),_:1},8,["class"])])])]),_:1}),s(t($t),{class:"flex min-h-0 flex-1 flex-col p-0"},{default:n(()=>[r("div",Qs,[r("div",Ks,[s(t(G),{onClick:Ht,variant:re.value?"default":"ghost",size:"sm",class:"h-7 text-xs rounded-full"},{default:n(()=>[s(t(kt),{class:"mr-1.5 h-3.5 w-3.5"}),L(" "+f(re.value?"Edit":"Preview"),1)]),_:1},8,["variant"])]),r("div",Xs,[r("div",Js,f(a.aiChapterAnalysis?.section.name||a.getSectionInfo(a.nextSection).name),1),r("div",Ys,f(a.aiChapterAnalysis?.section.description||a.getSectionInfo(a.nextSection).description),1)])]),r("div",Zs,[He(s(mr,{modelValue:m.value,"onUpdate:modelValue":e[10]||(e[10]=o=>m.value=o),placeholder:"Start writing your chapter...","min-height":"500px",class:"min-h-[500px] px-8 py-6",ref_key:"richTextEditor",ref:nt,"show-toolbar":!0,"onUpdate:selectedText":e[11]||(e[11]=o=>{H.value=o})},null,8,["modelValue"]),[[Ue,!re.value]]),He(r("div",eo,[s(fr,{content:m.value,"show-font-controls":!1,class:"prose-lg mx-auto",style:{"font-family":"'Times New Roman', serif","line-height":"1.8"}},null,8,["content"])],512),[[Ue,re.value]])])]),_:1}),r("div",to,[r("div",ro,f(t(Se)?"Saving...":"All changes saved"),1),r("div",ao,[s(t(G),{onClick:e[12]||(e[12]=o=>t(_e)(!1)),disabled:!vt.value||t(Se),size:"sm",variant:"ghost",class:"h-8 rounded-full"},{default:n(()=>[s(t(yr),{class:"mr-2 h-3.5 w-3.5"}),e[47]||(e[47]=L(" Save Draft ",-1))]),_:1},8,["disabled"]),s(t(G),{onClick:Ut,variant:"outline",size:"sm",class:"h-8 rounded-full"},{default:n(()=>[s(t(rt),{class:"mr-2 h-3.5 w-3.5"}),e[48]||(e[48]=L(" Run Bulk Analysis ",-1))]),_:1}),s(t(G),{onClick:Vt,disabled:t(Se),size:"sm",class:"h-8 rounded-full bg-gradient-to-r from-primary to-primary/90 shadow-sm hover:shadow-md transition-all"},{default:n(()=>[s(t(_r),{class:"mr-2 h-3.5 w-3.5"}),e[49]||(e[49]=L(" Complete ",-1))]),_:1},8,["disabled"])])])]),_:1}),e[50]||(e[50]=r("div",{class:"h-12"},null,-1))])])]),s(ur,{"enter-active-class":"transition-all duration-300 ease-in-out","enter-from-class":"-mr-72 opacity-0","enter-to-class":"mr-0 opacity-100","leave-active-class":"transition-all duration-300 ease-in-out","leave-from-class":"mr-0 opacity-100","leave-to-class":"-mr-72 opacity-0"},{default:n(()=>[Te.value?(y(),z("div",so,[r("div",oo,[r("div",no,[(y(),V(ct,null,{fallback:n(()=>[...e[51]||(e[51]=[r("div",{class:"flex items-center justify-center p-8"},[r("div",{class:"h-6 w-6 animate-spin rounded-full border-2 border-primary border-t-transparent"})],-1)])]),default:n(()=>[s(t(k),{project:be.value,chapter:we.value,"is-generating":D.value,"selected-text":H.value,"is-loading-suggestions":Be.value,"show-citation-helper":Ae.value,"chapter-content":m.value,"current-word-count":t(ee),"target-word-count":ue.value,onStartStreamingGeneration:ft,onGetAiSuggestions:bt,"onUpdate:showCitationHelper":e[13]||(e[13]=o=>Ae.value=o),onInsertCitation:It,onCheckCitations:wt},null,8,["project","chapter","is-generating","selected-text","is-loading-suggestions","show-citation-helper","chapter-content","current-word-count","target-word-count"])]),_:1})),(y(),V(ct,null,{fallback:n(()=>[...e[52]||(e[52]=[r("div",{class:"flex items-center justify-center p-4"},[r("div",{class:"h-4 w-4 animate-spin rounded-full border-2 border-muted border-t-transparent"})],-1)])]),default:n(()=>[s(t(w),{"show-defense-prep":fe.value,questions:ce.value,"is-loading":Ie.value,"is-generating":ze.value,"chapter-context":{chapter_number:le.value.chapter_number,chapter_title:le.value.title,word_count:t(ee)},"defense-watcher":{meetsThreshold:t(yt),shouldShowProgress:sr.value,progressPercentage:t(or),wordsRemaining:t(nr),hasTriggeredGeneration:t(et),threshold:t(ot),statusMessage:t(ar)()},"auto-generate-enabled":Pe.value,"onUpdate:showDefensePrep":Zt,onGenerateMore:xt,onToggleAutoGenerate:er,onRefresh:e[14]||(e[14]=()=>Ze(!0,{skipGeneration:!0})),onMarkHelpful:lr,onHideQuestion:ir},null,8,["show-defense-prep","questions","is-loading","is-generating","chapter-context","defense-watcher","auto-generate-enabled"])]),_:1})),(y(),V(ct,null,{fallback:n(()=>[...e[53]||(e[53]=[r("div",{class:"flex items-center justify-center p-4"},[r("div",{class:"h-4 w-4 animate-spin rounded-full border-2 border-muted border-t-transparent"})],-1)])]),default:n(()=>[s(t(g),{"chapter-id":le.value.id,content:m.value},null,8,["chapter-id","content"])]),_:1}))])])])):ge("",!0)]),_:1})])])):(y(),V(wa,{key:3,class:"h-screen overflow-hidden"},{default:n(()=>[r("div",lo,[r("div",io,[r("div",uo,[r("div",co,[s(t(se),null,{default:n(()=>[s(t(oe),{asChild:""},{default:n(()=>[s(t(G),{onClick:e[15]||(e[15]=o=>t(Ge).visit(t(te)("projects.show",l.project.slug))),variant:"ghost",size:"icon",class:"hidden sm:flex"},{default:n(()=>[s(t(wr),{class:"h-4 w-4"})]),_:1})]),_:1}),s(t(ne),null,{default:n(()=>[...e[55]||(e[55]=[r("p",null,"Back to Project",-1)])]),_:1})]),_:1}),r("div",null,[s(pr,{as:"h1",class:"text-xl font-bold sm:text-2xl",content:l.project.title},null,8,["content"]),r("p",po," Chapter "+f(l.chapter.chapter_number)+" â€¢ "+f(t(ee))+" / "+f(ue.value)+" words ",1)])]),r("div",go,[s(t(se),null,{default:n(()=>[s(t(oe),{asChild:""},{default:n(()=>[s(t(G),{onClick:e[16]||(e[16]=o=>ve.value=!0),variant:"outline",size:"icon",class:"lg:hidden"},{default:n(()=>[s(t(hr),{class:"h-4 w-4"})]),_:1})]),_:1}),s(t(ne),null,{default:n(()=>[...e[56]||(e[56]=[r("p",null,"Chapter Navigation",-1)])]),_:1})]),_:1}),s(t(se),null,{default:n(()=>[s(t(oe),{asChild:""},{default:n(()=>[s(t(G),{onClick:e[17]||(e[17]=o=>O.value=!0),variant:"outline",size:"icon",class:"lg:hidden"},{default:n(()=>[s(t(dt),{class:"h-4 w-4"})]),_:1})]),_:1}),s(t(ne),null,{default:n(()=>[...e[57]||(e[57]=[r("p",null,"AI Tools & Defense Prep",-1)])]),_:1})]),_:1}),r("div",vo,[s(t(se),null,{default:n(()=>[s(t(oe),{asChild:""},{default:n(()=>[s(t(G),{onClick:na,variant:K.value?"default":"outline",size:"sm"},{default:n(()=>[s(t(Aa),{class:"h-4 w-4"})]),_:1},8,["variant"])]),_:1}),s(t(ne),null,{default:n(()=>[r("p",null,f(K.value?"Exit":"Open")+" AI Chat Assistant",1)]),_:1})]),_:1}),s(t(se),null,{default:n(()=>[s(t(oe),{asChild:""},{default:n(()=>[s(t(G),{onClick:ia,variant:Y.value?"default":"outline",size:"sm"},{default:n(()=>[s(t(rt),{class:"h-4 w-4"})]),_:1},8,["variant"])]),_:1}),s(t(ne),null,{default:n(()=>[r("p",null,f(Y.value?"Exit":"Open")+" Citation Verification",1)]),_:1})]),_:1}),s(t(se),null,{default:n(()=>[s(t(oe),{asChild:""},{default:n(()=>[s(t(G),{onClick:e[18]||(e[18]=o=>j.value=!j.value),variant:j.value?"default":"outline",size:"sm"},{default:n(()=>[s(t(xr),{class:"h-4 w-4"})]),_:1},8,["variant"])]),_:1}),s(t(ne),null,{default:n(()=>[r("p",null,f(j.value?"Hide":"Show")+" Writing Statistics",1)]),_:1})]),_:1}),s(t(se),null,{default:n(()=>[s(t(oe),{asChild:""},{default:n(()=>[s(t(G),{onClick:Gt,variant:"outline",size:"sm"},{default:n(()=>[A.value?(y(),V(t(vr),{key:1,class:"h-4 w-4"})):(y(),V(t(gr),{key:0,class:"h-4 w-4"}))]),_:1})]),_:1}),s(t(ne),null,{default:n(()=>[r("p",null,"Switch to "+f(A.value?"Light":"Dark")+" Mode",1)]),_:1})]),_:1}),s(t(se),null,{default:n(()=>[s(t(oe),{asChild:""},{default:n(()=>[s(t(G),{onClick:zt,variant:v.value?"default":"outline",size:"sm"},{default:n(()=>[s(t(Ca),{class:"h-4 w-4"})]),_:1},8,["variant"])]),_:1}),s(t(ne),null,{default:n(()=>[r("p",null,f(v.value?"Exit":"Enter")+" Fullscreen Mode (F11)",1)]),_:1})]),_:1}),s(Ct,{project:be.value,"current-chapter":we.value,"all-chapters":qe.value,size:"sm"},null,8,["project","current-chapter","all-chapters"])])])]),r("div",ho,[r("div",fo,[e[58]||(e[58]=r("span",{class:"text-sm font-medium"},"Writing Progress",-1)),r("span",mo,f(t(ee))+" / "+f(ue.value)+" words ("+f(Math.round(t(Ke)))+"%)",1)]),s(t(Er),{"model-value":Number(t(Ke)),class:"h-2"},null,8,["model-value"])]),D.value?(y(),z("div",bo,[r("div",wo,[e[65]||(e[65]=r("div",{class:"absolute inset-0 -skew-x-12 animate-pulse bg-gradient-to-r from-transparent via-white/10 to-transparent"},null,-1)),r("div",xo,[r("div",yo,[r("div",_o,[r("div",Co,[s(t(dt),{class:"h-4 w-4 text-white"})]),e[59]||(e[59]=r("div",{class:"absolute inset-0 h-8 w-8 animate-ping rounded-full bg-gradient-to-br from-blue-500 to-purple-600 opacity-20"},null,-1))]),r("div",null,[e[60]||(e[60]=r("h4",{class:"text-sm font-semibold text-blue-900 dark:text-blue-100"},"AI Chapter Generator ",-1)),r("p",ko,f(x.value),1)])]),s(t(Ee),{variant:"outline",class:"border-blue-300 text-xs text-blue-700 dark:border-blue-700 dark:text-blue-300"},{default:n(()=>[L(f(Math.round(u.value))+"% ",1)]),_:1})]),r("div",So,[r("div",Eo,[e[61]||(e[61]=r("span",{class:"text-xs text-blue-800 dark:text-blue-200"},"Generation Progress",-1)),r("span",To,f(P.value)+" / "+f(U.value)+" words",1)]),r("div",Ao,[r("div",{class:"absolute top-0 left-0 h-full rounded-full bg-gradient-to-r from-blue-500 to-purple-500 transition-all duration-500 ease-out",style:Ve({width:`${u.value}%`})},[...e[62]||(e[62]=[r("div",{class:"absolute inset-0 animate-pulse bg-gradient-to-r from-transparent via-white/30 to-transparent"},null,-1)])],4),r("div",{class:"absolute top-0 left-0 h-full rounded-full bg-gradient-to-r from-blue-400 to-purple-400 opacity-50 blur-sm transition-all duration-500",style:Ve({width:`${u.value}%`})},null,4)])]),r("div",$o,[r("div",qo,[x.value==="Initializing"?(y(),z("div",Po)):x.value==="Connecting"?(y(),z("div",jo,[...e[63]||(e[63]=[r("div",{class:"h-3 w-1 animate-pulse rounded-full bg-blue-500"},null,-1),r("div",{class:"h-3 w-1 animate-pulse rounded-full bg-purple-500",style:{"animation-delay":"0.2s"}},null,-1),r("div",{class:"h-3 w-1 animate-pulse rounded-full bg-blue-500",style:{"animation-delay":"0.4s"}},null,-1)])])):x.value==="Generating"?(y(),z("div",Ro)):x.value==="Complete"?(y(),z("div",Do)):(y(),z("div",Mo))]),r("p",Fo,f(T.value),1)]),x.value==="Generating"&&P.value>50?(y(),z("div",No,[r("div",Oo,[e[64]||(e[64]=r("span",{class:"text-blue-700 dark:text-blue-300"},"Writing Quality",-1)),r("div",Wo,[r("div",Lo,[(y(),z(Et,null,Tt(5,o=>r("div",{key:o,class:pe(["h-2 w-2 rounded-full",o<=Math.ceil(t(Ce)/20)?"bg-yellow-400":"bg-blue-200 dark:bg-blue-800"])},null,2)),64))]),r("span",Io,f(t(Ce))+"%",1)])])])):ge("",!0)])])):ge("",!0),s(Cr,{"show-statistics":j.value,"current-word-count":t(ee),"writing-stats":t(gt),"quality-analysis":t(X),"is-analyzing":t(Ft)},null,8,["show-statistics","current-word-count","writing-stats","quality-analysis","is-analyzing"]),r("div",zo,[He(r("div",Go,[r("div",Ho,[s(t(q),{"all-chapters":qe.value,"current-chapter":we.value,project:be.value,outlines:a.project.outlines||[],"faculty-chapters":a.facultyChapters||[],"current-word-count":t(ee),"target-word-count":ue.value,"writing-quality-score":t(Ce),"chapter-content-length":m.value.length,onGoToChapter:Xe,onGenerateNextChapter:ht},null,8,["all-chapters","current-chapter","project","outlines","faculty-chapters","current-word-count","target-word-count","writing-quality-score","chapter-content-length"])])],512),[[Ue,!B.value]]),r("div",{class:pe(["transition-all duration-300",B.value&&Z.value?"lg:col-span-12":B.value?"lg:col-span-9":Z.value?"lg:col-span-10":"lg:col-span-7"])},[s(t(At),{class:"border-[0.5px] border-border/50 transition-all duration-300"},{default:n(()=>[s(t(qt),{class:"pb-4"},{default:n(()=>[r("div",Uo,[r("div",Vo,[s(t(G),{variant:"ghost",size:"icon",class:"h-6 w-6 hidden lg:flex mr-1 text-muted-foreground hover:text-foreground",onClick:e[19]||(e[19]=o=>B.value=!B.value),title:B.value?"Expand Sidebar":"Collapse Sidebar"},{default:n(()=>[B.value?(y(),V(t(qa),{key:1,class:"h-4 w-4"})):(y(),V(t($a),{key:0,class:"h-4 w-4"}))]),_:1},8,["title"]),s(t(Sr),{class:"text-lg"},{default:n(()=>[L("Chapter "+f(a.chapter.chapter_number),1)]),_:1})]),r("div",Bo,[s(t(Ee),{variant:a.chapter.status==="approved"?"default":"secondary"},{default:n(()=>[L(f(a.chapter.status.replace("_"," ")),1)]),_:1},8,["variant"]),s(t(Ee),{variant:"outline",class:pe(["text-xs",{"text-green-600 border-green-200 bg-green-50":(t(X)?.total_score||0)>=80,"text-yellow-600 border-yellow-200 bg-yellow-50":(t(X)?.total_score||0)>=70&&(t(X)?.total_score||0)<80,"text-orange-600 border-orange-200 bg-orange-50":(t(X)?.total_score||0)>=60&&(t(X)?.total_score||0)<70,"text-red-600 border-red-200 bg-red-50":(t(X)?.total_score||0)<60}])},{default:n(()=>[L(f(t(X)?.total_score?Math.round(t(X).total_score):t(Ce))+"% Quality ",1)]),_:1},8,["class"]),s(t(G),{variant:"ghost",size:"icon",class:"h-6 w-6 hidden lg:flex ml-1 text-muted-foreground hover:text-foreground",onClick:e[20]||(e[20]=o=>Z.value=!Z.value),title:Z.value?"Expand Tools":"Collapse Tools"},{default:n(()=>[Z.value?(y(),V(t(Sa),{key:1,class:"h-4 w-4"})):(y(),V(t(ka),{key:0,class:"h-4 w-4"}))]),_:1},8,["title"])])])]),_:1}),s(t($t),{class:"space-y-4"},{default:n(()=>[r("div",Qo,[s(t(_t),{for:"chapter-title"},{default:n(()=>[...e[66]||(e[66]=[L("Chapter Title",-1)])]),_:1}),s(t(cr),{id:"chapter-title",modelValue:_.value,"onUpdate:modelValue":e[21]||(e[21]=o=>_.value=o),placeholder:"Enter chapter title...",class:"text-lg font-medium"},null,8,["modelValue"])]),r("div",Ko,[r("div",Xo,[s(t(_t),{for:"chapter-content"},{default:n(()=>[...e[67]||(e[67]=[L("Content",-1)])]),_:1}),r("div",Jo,[s(t(G),{onClick:Ht,variant:re.value?"default":"outline",size:"sm"},{default:n(()=>[s(t(kt),{class:"mr-1 h-4 w-4"}),L(" "+f(re.value?"Edit Mode":"Preview Mode"),1)]),_:1},8,["variant"])])]),He(s(t(dr),{ref_key:"editorFullscreenScrollRef",ref:Rt,class:"h-[calc(100vh-320px)] w-full"},{default:n(()=>[s(mr,{modelValue:m.value,"onUpdate:modelValue":e[22]||(e[22]=o=>m.value=o),placeholder:"Start writing your chapter...","min-height":"600px",class:"text-base leading-relaxed",ref_key:"richTextEditorFullscreen",ref:Je,"onUpdate:selectedText":e[23]||(e[23]=o=>{H.value=o,console.log("ðŸ“‹ ChapterEditor Fullscreen - Selected text updated:",{length:o.length,preview:o.substring(0,50)+(o.length>50?"...":"")})})},null,8,["modelValue"])]),_:1},512),[[Ue,!re.value]]),He(s(t(dr),{ref_key:"previewFullscreenScrollRef",ref:Dt,class:"h-[calc(100vh-320px)] w-full"},{default:n(()=>[s(fr,{content:m.value,"show-font-controls":!1,class:"min-h-[600px] rounded-md border border-border/50 bg-background p-6",style:{"font-family":"'Times New Roman', serif","line-height":"1.8"}},null,8,["content"])]),_:1},512),[[Ue,re.value]])]),r("div",Yo,[s(t(se),null,{default:n(()=>[s(t(oe),{asChild:""},{default:n(()=>[s(t(G),{onClick:e[24]||(e[24]=o=>t(_e)(!1)),disabled:!vt.value||t(Se),size:"sm",class:"flex-1 sm:flex-none"},{default:n(()=>[s(t(yr),{class:"mr-1 h-3 w-3 sm:mr-2 sm:h-4 sm:w-4"}),r("span",Zo,f(t(Se)?"Saving...":"Save Draft"),1),r("span",en,f(t(Se)?"Saving...":"Save"),1)]),_:1},8,["disabled"])]),_:1}),s(t(ne),null,{default:n(()=>[...e[68]||(e[68]=[r("p",null,"Save chapter as draft (Ctrl+S)",-1)])]),_:1})]),_:1}),s(t(se),null,{default:n(()=>[s(t(oe),{asChild:""},{default:n(()=>[s(t(G),{onClick:Ut,variant:"outline",size:"sm",class:"flex-1 sm:flex-none"},{default:n(()=>[s(t(rt),{class:"mr-1 h-3 w-3 sm:mr-2 sm:h-4 sm:w-4"}),e[69]||(e[69]=r("span",{class:"hidden sm:inline"},"Bulk Analysis",-1)),e[70]||(e[70]=r("span",{class:"sm:hidden"},"Analyze",-1))]),_:1})]),_:1}),s(t(ne),null,{default:n(()=>[...e[71]||(e[71]=[r("p",null,"Open bulk chapter analysis to score this project.",-1)])]),_:1})]),_:1}),s(t(se),null,{default:n(()=>[s(t(oe),{asChild:""},{default:n(()=>[s(t(G),{onClick:e[25]||(e[25]=o=>N.value=!N.value),variant:"outline",size:"sm",class:"flex-1 sm:flex-none"},{default:n(()=>[N.value?(y(),V(t(Pa),{key:1,class:"mr-1 h-3 w-3 sm:mr-2 sm:h-4 sm:w-4"})):(y(),V(t(kt),{key:0,class:"mr-1 h-3 w-3 sm:mr-2 sm:h-4 sm:w-4"})),r("span",tn,f(N.value?"Edit":"Preview"),1),r("span",rn,f(N.value?"Edit":"Preview"),1)]),_:1})]),_:1}),s(t(ne),null,{default:n(()=>[r("p",null,f(N.value?"Switch to edit mode":"Switch to preview mode"),1)]),_:1})]),_:1}),s(t(se),null,{default:n(()=>[s(t(oe),{asChild:""},{default:n(()=>[s(t(G),{onClick:Vt,disabled:t(Se),size:"sm",class:"flex-1 sm:flex-none"},{default:n(()=>[s(t(_r),{class:"mr-1 h-3 w-3 sm:mr-2 sm:h-4 sm:w-4"}),e[72]||(e[72]=r("span",{class:"hidden sm:inline"},"Save & Mark Complete",-1)),e[73]||(e[73]=r("span",{class:"sm:hidden"},"Complete",-1))]),_:1},8,["disabled"])]),_:1}),s(t(ne),null,{default:n(()=>[...e[74]||(e[74]=[r("p",null,"Mark chapter as complete (requires 80% of target word count)",-1)])]),_:1})]),_:1}),s(Ct,{project:be.value,"current-chapter":we.value,"all-chapters":qe.value,size:"sm",variant:"outline",class:"flex-1 sm:flex-none"},null,8,["project","current-chapter","all-chapters"])])]),_:1})]),_:1})],2),He(r("div",an,[r("div",sn,[s(t(k),{project:be.value,chapter:we.value,"is-generating":D.value,"selected-text":H.value,"is-loading-suggestions":Be.value,"show-citation-helper":Ae.value,"chapter-content":m.value,"current-word-count":t(ee),"target-word-count":ue.value,onStartStreamingGeneration:ft,onGetAiSuggestions:bt,"onUpdate:showCitationHelper":e[26]||(e[26]=o=>Ae.value=o),onInsertCitation:It,onCheckCitations:wt},null,8,["project","chapter","is-generating","selected-text","is-loading-suggestions","show-citation-helper","chapter-content","current-word-count","target-word-count"]),s(t(w),{"show-defense-prep":fe.value,questions:ce.value,"is-loading":Ie.value,"is-generating":ze.value,"chapter-context":{chapter_number:le.value.chapter_number,chapter_title:le.value.title,word_count:t(ee)},"defense-watcher":{meetsThreshold:t(yt),shouldShowProgress:sr.value,progressPercentage:t(or),wordsRemaining:t(nr),hasTriggeredGeneration:t(et),threshold:t(ot),statusMessage:t(ar)()},"auto-generate-enabled":Pe.value,"onUpdate:showDefensePrep":Zt,onGenerateMore:xt,onToggleAutoGenerate:er,onRefresh:e[27]||(e[27]=()=>Ze(!0,{skipGeneration:!0})),onMarkHelpful:lr,onHideQuestion:ir},null,8,["show-defense-prep","questions","is-loading","is-generating","chapter-context","defense-watcher","auto-generate-enabled"])])],512),[[Ue,!Z.value]])]),s(t(F),{"show-left-sidebar":ve.value,"show-right-sidebar":O.value,"is-mobile":S.value,"all-chapters":qe.value,"current-chapter":we.value,project:be.value,"current-word-count":t(ee),"target-word-count":ue.value,"writing-quality-score":t(Ce),"chapter-content-length":m.value.length,"is-generating":D.value,"selected-text":H.value,"is-loading-suggestions":Be.value,"show-citation-helper":Ae.value,"chapter-content":m.value,"onUpdate:showLeftSidebar":e[28]||(e[28]=o=>ve.value=o),"onUpdate:showRightSidebar":e[29]||(e[29]=o=>O.value=o),onGoToChapter:Xe,onGenerateNextChapter:ht,onStartStreamingGeneration:ft,onGetAiSuggestions:bt,"onUpdate:showCitationHelper":e[30]||(e[30]=o=>Ae.value=o),onCheckCitations:wt},null,8,["show-left-sidebar","show-right-sidebar","is-mobile","all-chapters","current-chapter","project","current-word-count","target-word-count","writing-quality-score","chapter-content-length","is-generating","selected-text","is-loading-suggestions","show-citation-helper","chapter-content"]),s(ya,{open:t(jt),"current-balance":t(Tr),"required-words":t(Ar),action:t($r),"onUpdate:open":e[31]||(e[31]=o=>jt.value=o),onClose:t(Pr)},null,8,["open","current-balance","required-words","action","onClose"])])])]),_:1}))]),_:1}))}});export{gl as default};
