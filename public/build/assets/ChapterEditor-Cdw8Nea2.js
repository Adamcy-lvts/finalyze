const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/AISidebar-BnYEEV9M.js","assets/app-qOMdRN8u.js","assets/app-D68hcwyk.css","assets/index-DdjhVIk5.js","assets/CardContent.vue_vue_type_script_setup_true_lang-GJ3J8yz-.js","assets/CardTitle.vue_vue_type_script_setup_true_lang-DFeWFrL3.js","assets/CollapsibleTrigger.vue_vue_type_script_setup_true_lang-DEG4iCKe.js","assets/VisuallyHidden-NIevzlSJ.js","assets/useForwardExpose-B9GGfyTK.js","assets/index-D1ZM71Rt.js","assets/Separator.vue_vue_type_script_setup_true_lang-BSajxehW.js","assets/Separator-BKoq2zok.js","assets/Progress.vue_vue_type_script_setup_true_lang-0G7zD7M1.js","assets/nullish-CHIgUVhi.js","assets/index-hMoChnMN.js","assets/CitationHelper.vue_vue_type_script_setup_true_lang-ENFCFMQt.js","assets/index-BINz85eJ.js","assets/Input.vue_vue_type_script_setup_true_lang-BrSuEOJv.js","assets/ScrollArea.vue_vue_type_script_setup_true_lang-CFncaQs2.js","assets/useNonce-CC8B137P.js","assets/AlertDialogTitle.vue_vue_type_script_setup_true_lang-DwpBDgp6.js","assets/DropdownMenuTrigger.vue_vue_type_script_setup_true_lang-BrIX0XIw.js","assets/RichTextEditor-DSCYeHyH.js","assets/_plugin-vue_export-helper-DlAUqK2U.js","assets/SafeHtmlText.vue_vue_type_script_setup_true_lang-jg3k6Wm9.js","assets/index-BWEDi_FC.js","assets/step-DrZ9DcYd.js","assets/chart-column-DeiAmtVC.js","assets/calendar-DyUxjgrS.js","assets/brain-nmeF7Key.js","assets/users-BjMa25Re.js","assets/circle-alert-BAxD5gbk.js","assets/eye-BAtXB8Mn.js","assets/check-CiTWsk8U.js","assets/download-D0pf8t0T.js","assets/trash-2-CdgLoVSk.js","assets/DialogTitle.vue_vue_type_script_setup_true_lang-BnSmbE7d.js","assets/x-DYtB_dSi.js","assets/DialogFooter.vue_vue_type_script_setup_true_lang-CTPEAX6J.js","assets/Label.vue_vue_type_script_setup_true_lang-xdSaaVUP.js","assets/type-afNMWPj8.js","assets/minus-D-ma-zd5.js","assets/plus-BK056iww.js","assets/list-uib6IxdV.js","assets/RichTextEditor-DrYiwMFR.css","assets/chevron-down-CusJ8fij.js","assets/wand-sparkles-Tdw9788o.js","assets/search-8f4w3-_g.js","assets/history-D7ZDYKBa.js","assets/zap-BDhRJDzQ.js","assets/pen-tool-ClRWmW7G.js","assets/refresh-cw-CV5Nfrli.js","assets/circle-check-uQUCCLJs.js","assets/sparkles-DUu7Sddb.js","assets/AISidebar-Ymbz_oju.css","assets/ChapterNavigation-BAJw0bqT.js","assets/ChapterNavigation.vue_vue_type_script_setup_true_lang-CseoSqS4.js","assets/DialogTrigger-CMQ4aHcz.js","assets/chevron-right-o0YmRdmv.js","assets/circle-check-big-3HbniIo4.js","assets/lock-COPgbfZD.js","assets/target-akrN9U0F.js","assets/MobileNavOverlay-0cjIVllT.js","assets/index-D9SsDyfX.js","assets/DefensePreparationPanel.vue_vue_type_script_setup_true_lang-Kx4CLeFf.js","assets/Switch.vue_vue_type_script_setup_true_lang-C-Q0s7Li.js","assets/VisuallyHiddenInput-DP0EQDxM.js","assets/thumbs-up-DseA3HKe.js","assets/lightbulb-rjIeMVNv.js","assets/DataCollectionPanel.vue_vue_type_script_setup_true_lang-DX8ca01M.js","assets/MobileNavOverlay-CN-XSdXy.css","assets/ChatModeLayout-BdcyKp89.js","assets/ChatModeLayout.vue_vue_type_script_setup_true_lang-T39XNu_U.js","assets/square-BA7JzK6n.js","assets/useTextHistory-C7UeheHp.js","assets/Checkbox.vue_vue_type_script_setup_true_lang-Bwg1TC1i.js","assets/ohash.D__AXeF1-C-E83dC9.js","assets/RovingFocusItem-DwWLE0ex.js","assets/file-text-CxZ1T_wy.js","assets/useTextHistory-BLZ3MaDD.css","assets/loader-By1dTdaP.js","assets/message-square-He0yAVC_.js","assets/chevron-left-gnjfBM7O.js","assets/clock-CcEr-A_b.js","assets/bot-C7-fdH2D.js","assets/user-Lwmu79wa.js","assets/save-DwHhuEXe.js","assets/ChatModeLayout-wjQGykpm.css","assets/CitationVerificationLayout-CljLROPu.js","assets/triangle-alert-CuEGQevP.js","assets/DefensePreparationPanel-Cn7b-_Si.js","assets/DataCollectionPanel-CI4Hdjs1.js"])))=>i.map(i=>d[i]);
import{az as Pr,ac as jr,Z as qr,f as ze,B as p,ae as Fr,J as pr,P as se,i as bt,O as Be,b as z,I as mt,T as Pe,d as hr,a as X,L as we,o as $,u as e,w as a,K as s,F as r,M as j,n as be,H as q,c as re,N as Xt,R as Yt,a2 as at,aA as He,a8 as ft,aB as vt,k as Dt,D as Xe,G as Ye,aC as Ue}from"./app-qOMdRN8u.js";import{_ as Ke}from"./index-BINz85eJ.js";import{c as Lr,_ as V}from"./index-DdjhVIk5.js";import{_ as Pt,a as jt}from"./CardContent.vue_vue_type_script_setup_true_lang-GJ3J8yz-.js";import{_ as qt,a as fr}from"./CardTitle.vue_vue_type_script_setup_true_lang-DFeWFrL3.js";import{_ as Ir}from"./Input.vue_vue_type_script_setup_true_lang-BrSuEOJv.js";import{_ as Or}from"./Label.vue_vue_type_script_setup_true_lang-xdSaaVUP.js";import{_ as Zt}from"./ScrollArea.vue_vue_type_script_setup_true_lang-CFncaQs2.js";import{_ as De,a as Me,b as Re}from"./UserInfo.vue_vue_type_script_setup_true_lang-BZGYvGeR.js";import{r as lt,u as zr,_ as Gr,a as Nr}from"./AppLayout.vue_vue_type_script_setup_true_lang-VsEI6pm_.js";import{_ as er}from"./SafeHtmlText.vue_vue_type_script_setup_true_lang-jg3k6Wm9.js";import{t as T}from"./index-hMoChnMN.js";import{_ as Wr}from"./PurchaseModal.vue_vue_type_script_setup_true_lang-DIQSIcN8.js";import{t as tr}from"./toNumber-DOeZSTfj.js";import{_ as Hr}from"./Progress.vue_vue_type_script_setup_true_lang-0G7zD7M1.js";import{B as wt,u as Ur,_ as rr,R as sr,M as Br,a as Kr,P as Qr,b as Vr}from"./useTextHistory-C7UeheHp.js";import{T as Jr}from"./trending-up-C9DGkZpC.js";import{C as Xr}from"./circle-alert-BAxD5gbk.js";import{ap as or}from"./RichTextEditor-DSCYeHyH.js";import{A as nr}from"./arrow-left-DTjOLoZF.js";import{M as ar}from"./menu-BSOo-3Eh.js";import{B as nt}from"./brain-nmeF7Key.js";import{T as lr}from"./target-akrN9U0F.js";import{M as ir,S as cr}from"./Sonner.vue_vue_type_script_setup_true_lang-ByOjaXSV.js";import{E as ur}from"./eye-BAtXB8Mn.js";import{S as dr}from"./save-DwHhuEXe.js";import{C as Mt}from"./circle-check-big-3HbniIo4.js";import{P as Yr,a as Zr}from"./panel-left-open-B-sUVpks.js";import{M as es}from"./message-square-He0yAVC_.js";import{_ as ts}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./index-D1ZM71Rt.js";import"./useForwardExpose-B9GGfyTK.js";import"./VisuallyHidden-NIevzlSJ.js";import"./useNonce-CC8B137P.js";import"./DropdownMenuTrigger.vue_vue_type_script_setup_true_lang-BrIX0XIw.js";import"./x-DYtB_dSi.js";import"./coins-ChXKqGBP.js";import"./log-out-CuZiXC3R.js";import"./AppLogo.vue_vue_type_script_setup_true_lang-CPevuhWg.js";import"./plus-BK056iww.js";import"./chevron-right-o0YmRdmv.js";import"./DialogTitle.vue_vue_type_script_setup_true_lang-BnSmbE7d.js";import"./DialogFooter.vue_vue_type_script_setup_true_lang-CTPEAX6J.js";import"./triangle-alert-CuEGQevP.js";import"./sparkles-DUu7Sddb.js";import"./arrow-right-qi6c_C1X.js";import"./nullish-CHIgUVhi.js";import"./Checkbox.vue_vue_type_script_setup_true_lang-Bwg1TC1i.js";import"./ohash.D__AXeF1-C-E83dC9.js";import"./VisuallyHiddenInput-DP0EQDxM.js";import"./RovingFocusItem-DwWLE0ex.js";import"./minus-D-ma-zd5.js";import"./check-CiTWsk8U.js";import"./Separator.vue_vue_type_script_setup_true_lang-BSajxehW.js";import"./Separator-BKoq2zok.js";import"./download-D0pf8t0T.js";import"./chevron-down-CusJ8fij.js";import"./file-text-CxZ1T_wy.js";import"./index-BWEDi_FC.js";import"./step-DrZ9DcYd.js";import"./chart-column-DeiAmtVC.js";import"./calendar-DyUxjgrS.js";import"./users-BjMa25Re.js";import"./trash-2-CdgLoVSk.js";import"./type-afNMWPj8.js";import"./list-uib6IxdV.js";import"./circle-check-uQUCCLJs.js";var Rt=function(){return Pr.Date.now()},rs="Expected a function",ss=Math.max,os=Math.min;function ns(i,c,k){var A,v,o,m,g,u,w=0,F=!1,C=!1,h=!0;if(typeof i!="function")throw new TypeError(rs);c=tr(c)||0,jr(k)&&(F=!!k.leading,C="maxWait"in k,o=C?ss(tr(k.maxWait)||0,c):o,h="trailing"in k?!!k.trailing:h);function l(O){var E=A,Z=v;return A=v=void 0,w=O,m=i.apply(Z,E),m}function f(O){return w=O,g=setTimeout(G,c),F?l(O):m}function x(O){var E=O-u,Z=O-w,Y=c-E;return C?os(Y,o-Z):Y}function D(O){var E=O-u,Z=O-w;return u===void 0||E>=c||E<0||C&&Z>=o}function G(){var O=Rt();if(D(O))return S(O);g=setTimeout(G,x(O))}function S(O){return g=void 0,h&&A?l(O):(A=v=void 0,m)}function M(){g!==void 0&&clearTimeout(g),w=0,A=u=v=g=void 0}function U(){return g===void 0?m:S(Rt())}function te(){var O=Rt(),E=D(O);if(A=arguments,v=this,u=O,E){if(g===void 0)return f(u);if(C)return clearTimeout(g),g=setTimeout(G,c),l(u)}return g===void 0&&(g=setTimeout(G,c)),m}return te.cancel=M,te.flush=U,te}/**
 * @license lucide-vue-next v0.468.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const as=Lr("PenIcon",[["path",{d:"M21.174 6.812a1 1 0 0 0-3.986-3.987L3.842 16.174a2 2 0 0 0-.5.83l-1.321 4.352a.5.5 0 0 0 .623.622l4.353-1.32a2 2 0 0 0 .83-.497z",key:"1a8usu"}]]);function ls(i){const c=qr();ze(()=>c.props?.flash,W=>{W&&(W.success&&T.success(W.success),W.error&&T.error(W.error))},{deep:!0,immediate:!0});const k=p(i.chapter.title||""),A=p(i.chapter.content||""),v=p(!0),{isDark:o}=Fr(),m=p(!1),g=()=>{const W=localStorage.getItem(`chapter_theme_${i.project.id}`);W?m.value=W==="dark":m.value=o.value},u=()=>{m.value=!m.value;const W=m.value?"dark":"light";localStorage.setItem(`chapter_theme_${i.project.id}`,W),T.success(`Switched to ${m.value?"Dark":"Light"} Mode`)},w=p(!1),F=p(!1),C=p(!1),h=p("write"),l=p(""),f=p(0),x=p(!1),D=p(!1),G=p(!0),S=()=>{try{return localStorage.getItem(`chatMode_${i.project.id}_${i.chapter.chapter_number}`)==="true"}catch(W){return console.warn("Failed to load chat mode from localStorage:",W),!1}},M=W=>{try{localStorage.setItem(`chatMode_${i.project.id}_${i.chapter.chapter_number}`,String(W))}catch(le){console.warn("Failed to save chat mode to localStorage:",le)}},U=p(!1),te=p(!1),O=p(!1),E=p(!1),Z=p(!1),Y=p(!0),ee=p(!0);return{chapterTitle:k,chapterContent:A,showPreview:v,isEditorDark:m,initChapterTheme:g,toggleChapterTheme:u,isNativeFullscreen:w,showAISidebar:F,showStatistics:C,activeTab:h,selectedText:l,cursorPosition:f,showChatMode:x,showCitationMode:D,showDefensePrep:G,loadChatModeFromStorage:S,saveChatModeToStorage:M,showLeftSidebar:U,showRightSidebar:te,isMobile:O,isLeftSidebarCollapsed:E,isRightSidebarCollapsed:Z,showLeftSidebarInFullscreen:Y,showRightSidebarInFullscreen:ee}}const is={userScrollTimeout:2e3,scrollBehavior:"smooth",bottomThreshold:100};class cs{scrollContainer=null;isUserScrolling=!1;userScrollTimeout=null;isEnabled=!0;isDestroyed=!1;config;wasAtBottom=!0;rafId=null;handleWheel;handleTouchStart;handleTouchMove;handleScroll;handleKeydown;constructor(c={}){this.config={...is,...c},this.handleWheel=this.onUserScroll.bind(this),this.handleTouchStart=this.onUserScroll.bind(this),this.handleTouchMove=this.onUserScroll.bind(this),this.handleScroll=this.onScroll.bind(this),this.handleKeydown=this.onKeydown.bind(this)}attach(c){this.isDestroyed||(this.detach(),this.scrollContainer=c,this.setupEventListeners(),this.wasAtBottom=this.isAtBottom())}detach(){this.scrollContainer&&(this.scrollContainer.removeEventListener("wheel",this.handleWheel),this.scrollContainer.removeEventListener("touchstart",this.handleTouchStart),this.scrollContainer.removeEventListener("touchmove",this.handleTouchMove),this.scrollContainer.removeEventListener("scroll",this.handleScroll),this.scrollContainer.removeEventListener("keydown",this.handleKeydown)),this.userScrollTimeout&&(clearTimeout(this.userScrollTimeout),this.userScrollTimeout=null),this.rafId&&(cancelAnimationFrame(this.rafId),this.rafId=null),this.scrollContainer=null}setupEventListeners(){this.scrollContainer&&(this.scrollContainer.addEventListener("wheel",this.handleWheel,{passive:!0}),this.scrollContainer.addEventListener("touchstart",this.handleTouchStart,{passive:!0}),this.scrollContainer.addEventListener("touchmove",this.handleTouchMove,{passive:!0}),this.scrollContainer.addEventListener("scroll",this.handleScroll,{passive:!0}),this.scrollContainer.addEventListener("keydown",this.handleKeydown))}onUserScroll(){this.isEnabled&&(this.isUserScrolling=!0,this.userScrollTimeout&&clearTimeout(this.userScrollTimeout),this.userScrollTimeout=setTimeout(()=>{this.isUserScrolling=!1,this.isAtBottom()&&(this.wasAtBottom=!0)},this.config.userScrollTimeout))}onScroll(){this.wasAtBottom=this.isAtBottom()}onKeydown(c){["ArrowUp","ArrowDown","PageUp","PageDown","Home","End"].includes(c.key)&&this.onUserScroll()}isAtBottom(){if(!this.scrollContainer)return!0;const{scrollTop:c,scrollHeight:k,clientHeight:A}=this.scrollContainer;return k-c-A<=this.config.bottomThreshold}scrollToBottom(){!this.scrollContainer||!this.isEnabled||this.isDestroyed||this.isUserScrolling||!this.wasAtBottom||(this.rafId&&cancelAnimationFrame(this.rafId),this.rafId=requestAnimationFrame(()=>{if(this.rafId=null,!this.scrollContainer||this.isDestroyed)return;const c=this.scrollContainer.scrollHeight-this.scrollContainer.clientHeight;this.config.scrollBehavior==="instant"?this.scrollContainer.scrollTop=c:this.scrollContainer.scrollTo({top:c,behavior:"smooth"}),this.wasAtBottom=!0}))}forceScrollToBottom(){!this.scrollContainer||this.isDestroyed||(this.isUserScrolling=!1,this.wasAtBottom=!0,this.userScrollTimeout&&(clearTimeout(this.userScrollTimeout),this.userScrollTimeout=null),this.scrollToBottom())}enable(){this.isEnabled=!0}disable(){this.isEnabled=!1}isAutoScrollActive(){return this.isEnabled&&!this.isUserScrolling&&this.wasAtBottom}isUserScrollingNow(){return this.isUserScrolling}reset(){this.isUserScrolling=!1,this.wasAtBottom=!0,this.userScrollTimeout&&(clearTimeout(this.userScrollTimeout),this.userScrollTimeout=null)}destroy(){this.isDestroyed=!0,this.detach()}}function us(i={}){const c=new cs(i),k=p(!0),A=p(!1);let v=null;function o(f){f?(c.attach(f),g()):(c.detach(),u())}function m(f){ze(f,x=>{o(x)},{immediate:!0})}function g(){u(),v=setInterval(()=>{k.value=c.isAutoScrollActive(),A.value=c.isUserScrollingNow()},100)}function u(){v&&(clearInterval(v),v=null)}function w(){c.scrollToBottom()}function F(){c.forceScrollToBottom()}function C(){c.enable()}function h(){c.disable()}function l(){c.reset(),k.value=!0,A.value=!1}return pr(()=>{u(),c.destroy()}),{attach:o,attachRef:m,scrollToBottom:w,forceScrollToBottom:F,enable:C,disable:h,reset:l,isAutoScrollActive:k,isUserScrolling:A}}function ds({props:i,chapterContent:c,targetWordCount:k,estimates:A,ensureBalance:v,save:o,triggerAutoSave:m,calculateWritingStats:g,countWords:u,selectedText:w,richTextEditor:F,richTextEditorFullscreen:C,isNativeFullscreen:h}){const l=p(!1),f=p(""),x=p(0),D=p(""),G=p(0),S=p(0),M=p(""),U=p(0),te=p(""),O=p([]),E=p(!1),Z=p(!1),Y=p(!1),ee=p(!1),W=p(!1),le=p(!1),ie=p(0),_=p(!1),B=p(""),oe=p(""),Ce=p(0),L=p(0),K=p(null),ce=p([]),I=p([]),ue=p(null),pe=p(null),ne=p(0),de=3,xe=p(2e3),ge=p(!1),je=p(null),Qe=p("progressive"),R=p(null),it=p(),{attach:ct,scrollToBottom:ut,forceScrollToBottom:xt,reset:dt,isAutoScrollActive:Ze,isUserScrolling:ke}=us({userScrollTimeout:2e3,scrollBehavior:"smooth",bottomThreshold:100}),Oe=()=>{l.value&&bt(()=>{let y=null;if(h.value){const d=it.value;if(d){const N=d.$el||d;y=N?.querySelector("[data-radix-scroll-area-viewport]")||N?.querySelector("[data-viewport]")||N?.querySelector('[role="region"]')}}else y=document.querySelector(".overflow-y-auto.custom-scrollbar");if(!y){const d=document.querySelector("main");if(d){const N=d.querySelectorAll("div");for(const P of N)if(P.scrollHeight>P.clientHeight&&P.classList.contains("overflow-y-auto")){y=P;break}}}y&&(ct(y),ut(),requestAnimationFrame(()=>{!ke.value&&y&&y.scrollTo({top:y.scrollHeight,behavior:"smooth"})}))})},et=async()=>{if(!navigator.onLine)return T.error("No Internet Connection",{description:"Please check your internet connection and try again."}),!1;const y=navigator.connection||navigator.mozConnection||navigator.webkitConnection;if(y){const d=y.effectiveType;(d==="slow-2g"||d==="2g")&&T.warning("Slow Connection Detected",{description:"Your connection is slow. Content will be auto-saved during generation.",duration:4e3})}try{const d=new AbortController,N=setTimeout(()=>d.abort(),5e3),P=performance.now();await fetch(se("api.ping"),{method:"HEAD",cache:"no-cache",signal:d.signal}),clearTimeout(N);const J=performance.now()-P;console.log("üì° Server latency:",J.toFixed(0),"ms"),J>2e3&&T.info("Connection is slow",{description:"Content will be auto-saved during generation to prevent data loss.",duration:3e3})}catch(d){console.warn("Connection check ping failed:",d),T.info("Connection check skipped",{description:"Content will be auto-saved during generation.",duration:2e3})}return!0},ye=async()=>new Promise(y=>{let d=0;const N=120,P=async()=>{try{const Q=await(await fetch(se("api.projects.paper-collection.status",{project:i.project.slug}))).json();if(Q.success&&Q.data){ue.value=Q.data;const ve=Q.data.status,H=Q.data.papers_count||Q.data.count||0,Se=Q.data.message,Ee=Q.data.percentage||0,me=Q.data.current_source,Ne=Q.data.sources_completed||[],he=Q.data.papers_preview||[];if(Ce.value=H,L.value=Ee,K.value=me,ce.value=Ne,I.value=he,ve==="completed"){oe.value="Complete",B.value=`‚úì Collected ${H} verified sources from ${Ne.length} databases`,x.value=50,_.value=!1,pe.value&&clearInterval(pe.value),y(!0);return}else if(["collecting_papers","initializing","processing","storing"].includes(ve)){let $e="";me&&($e={semantic_scholar:"Semantic Scholar",openalex:"OpenAlex",crossref:"CrossRef",pubmed:"PubMed"}[me]||me),oe.value=$e||"Collecting Sources",B.value=Se||"Collecting sources from academic databases...",x.value=Math.min(5+Ee*.4,45)}else if(ve==="collection_failed"){oe.value="Error",B.value=Se||"‚ùå Source collection failed",_.value=!1,pe.value&&clearInterval(pe.value),y(!1);return}}d++,d>=N&&(oe.value="Timeout",B.value="‚è±Ô∏è Source collection timed out",_.value=!1,pe.value&&clearInterval(pe.value),y(!1))}catch(J){console.error("Error checking paper collection status:",J),d++}};P(),pe.value=setInterval(P,5e3)}),gt=async()=>{_.value=!0,oe.value="Starting",B.value="Initializing source collection...",x.value=5;try{const y=document.querySelector('meta[name="csrf-token"]')?.content;if(!y)throw new Error("CSRF token not found - please refresh the page");const d=await fetch(se("api.projects.paper-collection.start",{project:i.project.slug}),{method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json","X-CSRF-TOKEN":y,"X-Requested-With":"XMLHttpRequest"},credentials:"include"});if(!d.ok){const N=await d.text();if(console.error("API Error:",d.status,N),d.status===409)try{const P=JSON.parse(N);throw new Error(P.message||"Source collection is already in progress")}catch{throw new Error("Source collection is already in progress for this project")}throw new Error(`Failed to start source collection: ${d.status}`)}return await ye()}catch(y){return console.error("Paper collection failed:",y),oe.value="Error",B.value="‚ùå Source collection failed",_.value=!1,!1}},fe=async y=>{const d=A.chapter(k.value||0);if(!v(d,"generate this chapter with AI")||!await et())return;if(l.value=!0,M.value="",S.value=0,x.value=5,D.value="Papers",f.value="Checking for verified sources...",ee.value=!0,dt(),G.value=k.value||0,Y.value=!0,!await gt()){T.error("Paper Collection Failed",{description:"Unable to collect verified papers. Please try again."}),l.value=!1,Y.value=!1;return}D.value="Initializing",f.value="Starting AI generation with verified sources...",x.value=51;const J=setInterval(()=>{x.value<52&&l.value?x.value+=.2:clearInterval(J)},100),Q=se("chapters.stream",{project:i.project.slug,chapter:i.chapter.chapter_number});R.value=new EventSource(`${Q}?generation_type=${y}`),R.value.onmessage=ve=>{const H=JSON.parse(ve.data);switch(H.type){case"start":D.value="Connecting",x.value=52,f.value="Connecting to AI service...";break;case"content":D.value="Generating",M.value+=H.content,S.value=H.word_count||M.value.split(/\s+/).filter(me=>me.length>0).length;const Se=Date.now();if(Se-U.value>200){c.value=M.value,U.value=Se;const me=Math.min(S.value/Math.max(G.value,1)*43,43);x.value=Math.max(52,52+me),f.value=`Generating chapter content... (${S.value} / ${G.value} words)`,Oe()}break;case"heartbeat":x.value<95&&(x.value+=.5);break;case"complete":D.value="Complete",x.value=100,l.value=!1,ee.value=!1,c.value=M.value;const Ee=H.final_word_count||S.value;f.value=`‚úì Generated ${Ee} words successfully`,g(),lt(Ee,`Chapter generation (${i.chapter.chapter_number})`,"chapter",i.chapter.id).catch(me=>console.error("Failed to record word usage (chapter generation):",me)),setTimeout(()=>{m()},500),R.value?.close(),R.value=null;break;case"error":D.value="Error",x.value=50,ee.value=!1,H.partial_saved&&(le.value=!0,ie.value=H.saved_word_count||0),H.code==="OFFLINE_MODE"?(f.value="üì° AI services offline",l.value=!1,T.error("AI Services Offline",{description:"Please check your internet connection and try again."})):H.can_resume?(f.value=`‚ö†Ô∏è Generation interrupted (${H.saved_word_count} words saved)`,l.value=!1,W.value=!0,T.warning("Generation Interrupted",{description:`${H.saved_word_count} words were saved. You can resume generation.`,duration:8e3})):(f.value="‚ùå Generation failed",l.value=!1,T.error("Generation Error",{description:H.message||"Please try again."})),R.value?.close(),R.value=null;break;case"autosave":H.word_count&&H.generation_id&&(je.value=H.generation_id);break}},R.value.onerror=()=>{if(ne.value<de){ne.value++,ge.value=!0,D.value="Reconnecting",f.value=`üîÑ Connection lost. Reconnecting... (${ne.value}/${de})`,R.value?.close(),R.value=null;const ve=xe.value*Math.pow(2,ne.value-1);setTimeout(()=>Ge(y),ve)}else D.value="Error",x.value=50,l.value=!1,ge.value=!1,f.value="‚ùå Connection failed after multiple attempts",S.value>100?(le.value=!0,ie.value=S.value,W.value=!0,T.warning("Connection Lost",{description:`${S.value} words may have been saved. Check and resume if needed.`,duration:8e3})):T.error("Connection Error",{description:"Please check your internet connection and try again."}),R.value?.close(),R.value=null,ne.value=0,xe.value=2e3}},Ge=y=>{R.value&&(R.value.close(),R.value=null);const d=se("chapters.stream",{project:i.project.slug,chapter:i.chapter.chapter_number}),N=new URLSearchParams({generation_type:y,resume_from:S.value.toString()});je.value&&N.set("generation_id",je.value),R.value=new EventSource(`${d}?${N}`),R.value.onmessage=P=>{const J=JSON.parse(P.data);switch(["content","start"].includes(J.type)&&(ge.value=!1,ne.value=0,D.value="Generating"),J.type){case"start":f.value="‚úÖ Reconnected! Continuing generation...",T.success("Reconnected",{description:"Generation resumed successfully.",duration:3e3});break;case"content":D.value="Generating",M.value+=J.content,S.value=J.word_count||M.value.split(/\s+/).filter(H=>H.length>0).length;const Q=Date.now();if(Q-U.value>150){c.value=M.value,U.value=Q;const H=Math.min(S.value/Math.max(G.value,1)*43,43);x.value=Math.max(52,52+H),f.value=`Generating chapter content... (${S.value} / ${G.value} words)`,Oe()}break;case"complete":D.value="Complete",x.value=100,l.value=!1,ge.value=!1,c.value=M.value;const ve=J.final_word_count||S.value;f.value=`‚úì Generated ${ve} words successfully`,lt(ve,`Chapter generation (${i.chapter.chapter_number})`,"chapter",i.chapter.id).catch(H=>console.error("Failed to record word usage:",H)),setTimeout(()=>{m()},500),R.value?.close(),R.value=null;break;case"error":D.value="Error",l.value=!1,ge.value=!1,f.value="‚ùå Generation failed",T.error("Generation Error",{description:J.message||"Please try again."}),R.value?.close(),R.value=null;break;case"autosave":J.generation_id&&(je.value=J.generation_id);break}},R.value.onerror=()=>{if(ne.value<de){ne.value++;const P=xe.value*Math.pow(2,ne.value-1);f.value=`üîÑ Reconnecting... (${ne.value}/${de})`,R.value?.close(),setTimeout(()=>Ge(y),P)}else D.value="Error",l.value=!1,ge.value=!1,f.value="‚ùå Connection failed",S.value>100?(W.value=!0,T.warning("Connection Lost",{description:`${S.value} words may be saved. Refresh to recover.`})):T.error("Connection Error",{description:"Please check your connection and try again."}),R.value?.close(),R.value=null,ne.value=0}},ae=async y=>{l.value=!0,M.value="",S.value=0,x.value=5,D.value="Papers",f.value="Checking for verified sources...",G.value=600,te.value=c.value||i.chapter.content||"",Y.value=!0;try{x.value=50,D.value="Papers",f.value="Using existing verified sources...",await new Promise(N=>setTimeout(N,500)),D.value="Section",f.value=`Generating ${y} section with verified sources...`,x.value=51;const d=se("chapters.stream",{project:i.project.slug,chapter:i.chapter.chapter_number});R.value=new EventSource(`${d}?generation_type=section&section_type=${y}`),R.value.onmessage=N=>{const P=JSON.parse(N.data);switch(P.type){case"start":D.value="Generating Section",x.value=52,f.value=`Starting ${y} section generation...`;break;case"content":M.value+=P.content,S.value=P.word_count||u(M.value);const J=Date.now();if(J-U.value>150){c.value=te.value+`

`+M.value,U.value=J;const Q=Math.min(S.value/G.value*43,43);x.value=Math.max(52,52+Q),f.value=`Generating ${y} section... (${S.value} / ${G.value} words)`,g(),Oe()}break;case"complete":x.value=100,D.value="Complete",f.value=`‚úì Generated ${y} section (${S.value} words)`,c.value=te.value+`

`+M.value,o(!0),T.success("‚úÖ Section Generated Successfully",{description:`Added ${y} section with ${S.value} words and verified citations.`,duration:5e3}),l.value=!1,R.value?.close();break;case"error":throw new Error(P.message||"Section generation failed");case"heartbeat":x.value<95&&(x.value+=.5);break}},R.value.onerror=()=>{l.value=!1,D.value="Error",f.value="‚ùå Section generation failed",T.error("‚ùå Generation Failed",{description:"Unable to generate section. Please check your connection and try again."}),R.value?.close()}}catch(d){console.error("Section generation failed:",d),l.value=!1,D.value="Error",f.value="‚ùå Section generation error",T.error("‚ùå Generation Failed",{description:"Section generation encountered an error."})}},tt=async(y,d,N)=>{const P=y.split(/\s+/).length,J=d==="rephrase"?Math.max(P,A.rephrase()):Math.max(P*2,A.expand());if(!v(J,`${d} about ${P} words`))return;l.value=!0,M.value="",S.value=0,x.value=10,D.value=d==="rephrase"?"Rephrasing":"Expanding",f.value=`Preparing to ${d} selected text...`,G.value=Math.max(P*(d==="expand"?2:1),100);const Q=C.value||F.value,ve=Q?.getSelectionRange(),H={originalText:y,range:ve,wordCount:P,style:N||"Academic Formal",startTime:Date.now()};Y.value=!0;try{const Se=d==="rephrase"?"rephrase":"expand",Ee=se("chapters.stream",{project:i.project.slug,chapter:i.chapter.chapter_number}),me=d==="rephrase"?`${Ee}?generation_type=rephrase&selected_text=${encodeURIComponent(y)}&style=${encodeURIComponent(N||"Academic Formal")}`:`${Ee}?generation_type=expand&selected_text=${encodeURIComponent(y)}`;R.value=new EventSource(me),R.value.onmessage=Ne=>{const he=JSON.parse(Ne.data);switch(he.type){case"start":D.value=d==="rephrase"?"Rephrasing Text":"Expanding Text",x.value=d==="rephrase"?30:20,f.value=`${d==="rephrase"?"Rephrasing":"Expanding"} text...`;break;case"content":M.value+=he.content,S.value=he.word_count||u(M.value);const $e=Math.min(S.value/G.value*60,60);x.value=Math.max(d==="rephrase"?30:25,(d==="rephrase"?30:25)+$e),f.value=`${d==="rephrase"?"Rephrasing":"Expanding"}... (${S.value} words)`;break;case"complete":x.value=100,D.value="Complete",f.value=`‚úì Text ${d==="rephrase"?"rephrased":"expanded"} successfully (${S.value} words)`,H.range&&M.value.trim()&&(Q?.replaceSelection(M.value.trim(),H.range)?setTimeout(()=>{const qe=Q?.getHTML()||c.value;c.value=qe},100):T.warning("Please manually replace the selected text",{description:"The generated text is ready but could not be automatically inserted."})),o(!0),T.success(`‚úÖ Text ${d==="rephrase"?"Rephrased":"Expanded"} Successfully`,{description:`${d==="rephrase"?"Rephrased":"Expanded"} ${P} words.`}),lt(S.value||(d==="expand"?P*2:P),d==="rephrase"?`Rephrase (${H.style})`:"Expand text","chapter",i.chapter.id).catch(Te=>console.error(`Failed to record word usage (${d}):`,Te)),l.value=!1,R.value?.close();break;case"error":console.error(`${d} generation error:`,he.message),l.value=!1,D.value="Error",f.value=`‚ùå Text ${d==="rephrase"?"rephrasing":"expansion"} failed`,T.error(`‚ùå ${d==="rephrase"?"Rephrasing":"Expansion"} Failed`,{description:he.message||"Please try again."}),R.value?.close();break;case"heartbeat":x.value<95&&(x.value+=.5);break}},R.value.onerror=()=>{l.value=!1,D.value="Error",f.value=`‚ùå Text ${d==="rephrase"?"rephrasing":"expansion"} failed`,T.error(`‚ùå ${d==="rephrase"?"Rephrasing":"Expansion"} Failed`,{description:"Unable to process the request. Please check your connection and try again."}),R.value?.close()}}catch(Se){console.error("Selection generation failed:",Se),l.value=!1,D.value="Error",f.value=`‚ùå Text ${d==="rephrase"?"rephrasing":"expansion"} error`,T.error(`‚ùå ${d==="rephrase"?"Rephrasing":"Expansion"} Failed`,{description:"Text generation encountered an error."})}};return{isGenerating:l,generationProgress:f,generationPercentage:x,generationPhase:D,estimatedTotalWords:G,streamWordCount:S,streamBuffer:M,lastStreamUpdate:U,originalContentForAppend:te,aiSuggestions:O,isLoadingSuggestions:E,showCitationHelper:Z,showPresentationMode:Y,isStreamingMode:ee,showRecoveryDialog:W,partialContentSaved:le,savedWordCountOnError:ie,isCollectingPapers:_,paperCollectionProgress:B,paperCollectionPhase:oe,collectedPapersCount:Ce,paperCollectionPercentage:L,currentSource:K,sourcesCompleted:ce,papersPreview:I,paperCollectionData:ue,paperCollectionInterval:pe,reconnectAttempts:ne,reconnectDelay:xe,isReconnecting:ge,currentGenerationId:je,currentGenerationType:Qe,eventSource:R,editorScrollRef:it,attachScroller:ct,smoothScrollToBottom:ut,forceScrollToBottom:xt,resetScroller:dt,isAutoScrollActive:Ze,isUserScrollingScroller:ke,scrollToBottom:Oe,checkConnectionQuality:et,startPaperCollection:gt,startStreamingGeneration:fe,attemptReconnection:Ge,startSectionGeneration:ae,handleSelectionGeneration:tt,handleAIGeneration:(y,d)=>{y==="section"&&d?.section?ae(d.section):y==="rephrase"&&d?.selectedText?tt(d.selectedText,"rephrase",d.style):y==="expand"&&d?.selectedText?tt(d.selectedText,"expand"):fe(y)},getAISuggestions:async()=>{if(!w.value)return;const y=A.suggestion();if(v(y,"get AI suggestions")){E.value=!0;try{const N=await(await fetch(se("chapters.suggestions",{project:i.project.slug,chapter:i.chapter.chapter_number}),{method:"POST",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":document.querySelector('meta[name="csrf-token"]')?.getAttribute("content")||""},body:JSON.stringify({selected_text:w.value,context:c.value})})).json();O.value=N.suggestions||[],O.value.length&&lt(A.suggestion(),"AI suggestions","chapter",i.chapter.id).catch(P=>console.error("Failed to record word usage (suggestions):",P))}catch{T.error("Error getting suggestions",{description:"Please try again."})}finally{E.value=!1}}},checkCitations:()=>{Z.value=!0,T.success("Citation Manager opened!",{description:"Review and verify your citations in the panel below."})},insertCitation:y=>{try{const d=C.value?.editor||F.value?.editor;if(!d){T.error("Editor not found");return}const{from:N}=d.state.selection;d.chain().focus().insertContentAt(N,` ${y} `).run(),T.success("Citation inserted successfully")}catch(d){console.error("Failed to insert citation:",d),T.error("Failed to insert citation")}},resumeGeneration:()=>{W.value=!1,le.value=!1,window.location.reload()},dismissRecovery:()=>{W.value=!1,le.value=!1,ie.value=0},checkForAutoGeneration:()=>{const y=new URLSearchParams(window.location.search),d=y.get("ai_generate")==="true",N=y.get("generation_type");!d||!N||setTimeout(()=>{fe("progressive");const P=new URL(window.location.href);P.searchParams.delete("ai_generate"),P.searchParams.delete("generation_type"),window.history.replaceState({},"",P.toString()),T.success("üöÄ AI Generation Started",{description:`Generating ${i.chapter.title} with AI assistance...`})},1e3)}}}function gs({props:i,allChapters:c,targetWordCount:k,estimates:A,ensureBalance:v,save:o}){return{generateNextChapter:async()=>{const g=A.chapter(k.value||0);if(!v(g,"generate the next chapter with AI"))return;await o();const u=c.map(C=>C.chapter_number).sort((C,h)=>C-h),w=u.indexOf(i.chapter.chapter_number);let F;if(w===-1||w===u.length-1)F=Math.max(...u)+1;else{const C=u[w+1];C===i.chapter.chapter_number+1?F=C:F=i.chapter.chapter_number+1}try{const C=se("chapters.write",{project:i.project.slug,chapter:F}),h=new URL(C,window.location.origin);h.searchParams.set("ai_generate","true"),h.searchParams.set("generation_type","progressive"),Be.visit(h.toString())}catch(C){console.error("‚ùå Error generating next chapter:",C)}}}}function ps(i,c,k,A){const o=p(!1),m=p(0),g=p(!1),u=E=>{if(!E)return 0;const Y=E.replace(/<[^>]*>/g,"").trim().replace(/\s+/g," ");if(!Y)return 0;const ee=Y.match(/\b\w+\b/g);return ee?ee.length:0},w=z(()=>u(k.value)),F=z(()=>w.value>=800),C=()=>`defense_generation_triggered_${i.id}_ch_${c.chapter_number}`,h=()=>{const E=C();return localStorage.getItem(E)==="true"},l=()=>{const E=C();localStorage.setItem(E,"true"),o.value=!0},f=()=>{const E=C();localStorage.removeItem(E),o.value=!1,console.log(`üîÑ DEFENSE WATCHER: Reset generation trigger for Chapter ${c.chapter_number}`)},x=ns(async()=>{if(!g.value)return;const E=w.value;console.log(`üìä DEFENSE WATCHER: Word count check - Chapter ${c.chapter_number}: ${E} words`),E<800*.8&&o.value&&(console.log("‚¨áÔ∏è DEFENSE WATCHER: Content dropped below 80% of threshold, resetting trigger"),f()),m.value=E},2e3),D=()=>g.value?void 0:(g.value=!0,o.value=h(),m.value=w.value,console.log(`üëÄ DEFENSE WATCHER: Started watching Chapter ${c.chapter_number}`),console.log(`   Initial word count: ${m.value}`),console.log(`   Generation already triggered: ${o.value}`),console.log("   Threshold: 800 words"),ze(k,(Z,Y)=>{Z!==Y&&x()},{immediate:!1})),G=()=>{g.value=!1,x.cancel(),console.log(`üõë DEFENSE WATCHER: Stopped watching Chapter ${c.chapter_number}`)},S=async()=>{console.log(`üîç DEFENSE WATCHER: Force checking Chapter ${c.chapter_number}`),await x(),x.flush()},M=z(()=>{const E=w.value;return E>0&&E<800&&!o.value}),U=z(()=>{const E=w.value/800*100;return Math.min(E,100)}),te=z(()=>{const E=800-w.value;return Math.max(E,0)});return{isWatching:g,hasTriggeredGeneration:o,currentWordCount:w,lastWordCount:m,meetsThreshold:F,shouldShowProgressIndicator:M,progressPercentage:U,wordsRemaining:te,startWatching:D,stopWatching:G,forceCheck:S,resetGenerationTrigger:f,markGenerationTriggered:l,getStatusMessage:()=>{const E=w.value;return o.value?`Defense questions available (${E} words)`:E>=800?`Ready for defense questions (${E} words)`:E>0?`${800-E} more words needed for defense questions`:"Start writing to enable defense questions (800 words needed)"},countWords:u,DEFENSE_WORD_COUNT_THRESHOLD:800}}function hs({props:i,chapterContent:c,currentWordCount:k,ensureBalance:A,estimates:v}){const o=p([]),m=p(!1),g=p(!1),u=p(null),w=p(!1),F=z(()=>i.chapter),{hasTriggeredGeneration:C,startWatching:h,stopWatching:l,forceCheck:f,getStatusMessage:x,markGenerationTriggered:D,meetsThreshold:G,shouldShowProgressIndicator:S,progressPercentage:M,wordsRemaining:U,DEFENSE_WORD_COUNT_THRESHOLD:te}=ps(i.project,i.chapter,c),O=(L,K)=>`defense_auto_generate_${L}_ch_${K}`,E=()=>{try{return localStorage.getItem(O(i.project.id,i.chapter.chapter_number))==="true"}catch(L){return console.warn("Failed to load defense auto-generation preference:",L),!1}},Z=L=>{try{localStorage.setItem(O(i.project.id,i.chapter.chapter_number),String(L))}catch(K){console.warn("Failed to save defense auto-generation preference:",K)}};w.value=E();const Y=()=>{if(!o.value.length||!u.value)return!0;const L=new Date(Date.now()-360*60*1e3);return u.value<L},ee=async(L=!1,K={})=>{if(m.value)return;const ce=K.skipGeneration??!0;m.value=!0;try{console.log("Loading defense questions with params:",{project_id:i.project.id,chapter_number:F.value?.chapter_number,limit:5,force_refresh:L,skip_generation:ce});const I=await Pe.get(`/api/projects/${i.project.id}/defense/questions`,{params:{chapter_number:F.value?.chapter_number||null,limit:5,force_refresh:L?1:0,skip_generation:ce?1:0},headers:{Accept:"application/json","X-Requested-With":"XMLHttpRequest"}});if(console.log("Defense questions loaded:",I.data),o.value=I.data.questions||[],u.value=new Date,I.data.questions&&I.data.questions.length>0){const ue=`defense_questions_${i.project.id}_chapter_${F.value?.chapter_number}`;localStorage.setItem(ue,JSON.stringify({questions:I.data.questions,chapter_number:F.value?.chapter_number,loaded_at:new Date().toISOString()}))}else L||(console.log("No existing questions found for this chapter"),console.log(`Current word count: ${k.value}/${te}`),console.log('User must click "Generate Questions" button to create defense questions'))}catch(I){if(console.error("Failed to load defense questions:",I),I.response)if(console.error("Response status:",I.response.status),console.error("Response data:",I.response.data),I.response.status===422){const ue=Object.values(I.response.data.errors||{})[0];ue&&Array.isArray(ue)?T.error(`Validation Error: ${ue[0]}`):T.error("Invalid request parameters. Please refresh the page.")}else I.response.status===500?T.error("Server error. Please try again later."):T.error("Failed to load defense questions");else I.request?(console.error("No response received:",I.request),T.error("Network error. Please check your connection.")):(console.error("Error setting up request:",I.message),T.error("An unexpected error occurred"));o.value=[]}finally{m.value=!1}},W=L=>L?L.replace(/<[^>]*>/g," ").trim().split(/\s+/).filter(K=>K.length>0).length:0,le=async(L={})=>{if(g.value)return;const K=L.autoTriggered??!1,ce=v.defense();if(A(ce,"generate defense questions")){g.value=!0;try{const I=await Pe.post(`/api/projects/${i.project.id}/defense/questions/generate`,{chapter_number:F.value.chapter_number},{headers:{"X-CSRF-TOKEN":document.querySelector('meta[name="csrf-token"]')?.getAttribute("content"),Accept:"application/json","Content-Type":"application/json"}});if(I.data&&I.data.questions){o.value=I.data.questions,u.value=new Date;const ue=I.data.questions.reduce((ne,de)=>{const xe=W(de.question),ge=W(de.suggested_answer),je=(de.key_points||[]).reduce((Qe,R)=>Qe+W(R),0);return ne+xe+ge+je},0),pe=`defense_questions_${i.project.id}_chapter_${F.value?.chapter_number}`;localStorage.setItem(pe,JSON.stringify({questions:I.data.questions,chapter_number:F.value?.chapter_number,loaded_at:new Date().toISOString()})),T.success(`Generated ${I.data.questions.length} new questions`),lt(ue||v.defense(),"Defense questions","chapter",i.chapter.id).catch(ne=>console.error("Failed to record word usage (defense):",ne)),C.value=!0,D(),K&&console.log("Auto-generated defense questions after meeting threshold.")}}catch(I){console.error("Failed to generate defense questions:",I),T.error("Failed to generate defense questions")}finally{g.value=!1}}},ie=async()=>{!w.value||g.value||m.value||C.value||!G.value||o.value.length>0||await le({autoTriggered:!0})},_=L=>{w.value=L,Z(L),L&&ie()},B=async(L,K)=>{try{await Pe.patch(`/api/projects/${i.project.id}/defense/questions/${L}`,{user_marked_helpful:K},{headers:{"X-CSRF-TOKEN":document.querySelector('meta[name="csrf-token"]')?.getAttribute("content"),Accept:"application/json","Content-Type":"application/json"}});const ce=o.value.find(I=>I.id===L);ce&&(ce.user_marked_helpful=K),T.success(K?"Question marked as helpful":"Removed helpful mark")}catch(ce){console.error("Failed to mark question:",ce),T.error("Failed to update question")}},oe=async L=>{try{await Pe.delete(`/api/projects/${i.project.id}/defense/questions/${L}`,{headers:{"X-CSRF-TOKEN":document.querySelector('meta[name="csrf-token"]')?.getAttribute("content"),Accept:"application/json"}}),o.value=o.value.filter(K=>K.id!==L),localStorage.setItem(`defense_questions_${i.project.id}`,JSON.stringify({questions:o.value,loaded_at:new Date().toISOString()})),T.success("Question hidden")}catch(K){console.error("Failed to hide question:",K),T.error("Failed to hide question")}},Ce=async()=>{const L=`defense_questions_${i.project.id}_chapter_${F.value?.chapter_number}`,K=localStorage.getItem(L);let ce=!0;if(K){const I=JSON.parse(K),ue=new Date(I.loaded_at),pe=new Date(Date.now()-360*60*1e3);ue>pe&&I.chapter_number===F.value?.chapter_number&&(o.value=I.questions,u.value=ue,ce=!1)}ce&&await ee(!1,{skipGeneration:!0})};return ze(()=>i.chapter,async()=>{o.value=[],l(),h(),w.value=E(),await ee(!1,{skipGeneration:!0}),await bt(()=>{f(),ie()})},{immediate:!1}),ze([k,w],()=>{ie()}),mt(async()=>{await Ce(),h(),await bt(()=>{f(),ie()})}),{defenseQuestions:o,isLoadingDefenseQuestions:m,isGeneratingDefenseQuestions:g,autoGenerateDefense:w,shouldLoadDefenseQuestions:Y,loadDefenseQuestions:ee,generateNewDefenseQuestions:le,markQuestionHelpful:B,hideQuestion:oe,handleDefenseAutoToggle:_,attemptAutoGenerateDefense:ie,getDefenseStatusMessage:x,shouldShowDefenseProgress:S,defenseProgressPercentage:M,defenseWordsRemaining:U,hasTriggeredGeneration:C,meetsDefenseThreshold:G}}const fs={class:"flex items-center justify-between mb-3"},vs={class:"flex items-center gap-3"},ms={class:"p-2 rounded-lg bg-blue-500/10"},bs={class:"text-right"},ws={class:"space-y-2"},xs={class:"flex justify-between items-center text-xs"},ys={class:"relative"},_s={key:0},Cs={class:"space-y-3"},ks={class:"flex-1"},Ss={class:"text-sm font-medium"},Es={class:"text-xs text-muted-foreground"},Ts={class:"w-20 h-2 bg-muted rounded-full overflow-hidden ml-3"},As={key:1},$s={class:"space-y-2"},Ds={class:"flex-1"},Ms={class:"text-sm font-medium"},Rs={class:"text-xs text-muted-foreground"},Ps={key:2,class:"flex items-center justify-center gap-3 p-4 rounded-lg bg-blue-50/50 border border-blue-200/50"},js={key:3,class:"text-center p-4 rounded-lg bg-muted/30"},gr=hr({__name:"WritingStatistics",props:{showStatistics:{type:Boolean},currentWordCount:{},writingStats:{},qualityAnalysis:{},isAnalyzing:{type:Boolean}},setup(i){const c=i;z(()=>{if(!c.qualityAnalysis?.quality_level)return"text-muted-foreground";switch(c.qualityAnalysis.quality_level){case"Excellent":return"text-green-600";case"Good":return"text-blue-600";case"Satisfactory":return"text-yellow-600";case"Needs Improvement":return"text-orange-600";case"Poor":return"text-red-600";default:return"text-muted-foreground"}});const k=z(()=>c.qualityAnalysis?.scores?Object.entries(c.qualityAnalysis.scores).filter(([,v])=>v.max>0).filter(([,v])=>v.percentage<75).sort(([,v],[,o])=>v.percentage-o.percentage).map(([v,o])=>({category:v.replace(" & "," & "),percentage:Math.round(o.percentage),score:o.score,max:o.max,status:o.percentage<40?"poor":o.percentage<60?"needs-work":"fair"})):[]),A=z(()=>{const v=c.qualityAnalysis?.total_score||0;return v>=80?{text:"Excellent",color:"text-green-600",bgColor:"bg-green-50"}:v>=70?{text:"Satisfactory",color:"text-yellow-600",bgColor:"bg-yellow-50"}:v>=60?{text:"Needs Work",color:"text-orange-600",bgColor:"bg-orange-50"}:{text:"Poor",color:"text-red-600",bgColor:"bg-red-50"}});return(v,o)=>v.showStatistics?($(),X(e(Pt),{key:0,class:"border border-border/50 bg-gradient-to-br from-card/80 to-card/60 backdrop-blur-sm shadow-lg"},{default:a(()=>[v.qualityAnalysis?($(),X(e(qt),{key:0,class:"pb-4 border-b border-border/50"},{default:a(()=>[r("div",fs,[r("div",vs,[r("div",ms,[s(e(wt),{class:"h-4 w-4 text-blue-600"})]),r("div",null,[s(e(fr),{class:"text-sm font-semibold"},{default:a(()=>[...o[0]||(o[0]=[j("Academic Quality",-1)])]),_:1}),o[1]||(o[1]=r("p",{class:"text-xs text-muted-foreground"},"AI-powered analysis",-1))])]),r("div",bs,[r("div",{class:be(["text-2xl font-bold",A.value.color])},[j(q(v.qualityAnalysis.total_score),1),o[2]||(o[2]=r("span",{class:"text-sm text-muted-foreground"},"/100",-1))],2),s(e(Ke),{class:be([[A.value.color,A.value.bgColor],"text-xs font-medium"]),variant:"outline"},{default:a(()=>[j(q(A.value.text),1)]),_:1},8,["class"])])]),r("div",ws,[r("div",xs,[o[3]||(o[3]=r("span",{class:"text-muted-foreground"},"Overall Score",-1)),r("span",{class:be(["font-medium",v.qualityAnalysis.meets_threshold?"text-green-600":"text-orange-600"])},q(v.qualityAnalysis.meets_threshold?"Meets threshold ‚úì":"Below 80% threshold"),3)]),r("div",ys,[s(e(Hr),{"model-value":Math.round(v.qualityAnalysis.total_score||0),class:be(["h-2",{"[&>[data-slot=progress-indicator]]:bg-green-500":(v.qualityAnalysis.total_score||0)>=80,"[&>[data-slot=progress-indicator]]:bg-yellow-500":(v.qualityAnalysis.total_score||0)>=70&&(v.qualityAnalysis.total_score||0)<80,"[&>[data-slot=progress-indicator]]:bg-orange-500":(v.qualityAnalysis.total_score||0)>=60&&(v.qualityAnalysis.total_score||0)<70,"[&>[data-slot=progress-indicator]]:bg-red-500":(v.qualityAnalysis.total_score||0)<60}])},null,8,["model-value","class"]),o[4]||(o[4]=r("div",{class:"absolute inset-0 flex items-center justify-center"},[r("div",{class:"w-0.5 h-4 bg-orange-400/60 rounded-full",style:{"margin-left":"80%"}})],-1))])])]),_:1})):we("",!0),s(e(jt),{class:"p-4 space-y-4"},{default:a(()=>[v.qualityAnalysis?.scores?($(),re("div",_s,[o[5]||(o[5]=r("h4",{class:"text-xs font-semibold text-muted-foreground mb-3 flex items-center gap-2"},[r("div",{class:"w-1 h-4 bg-green-500 rounded-full"}),j(" Analysis Results ")],-1)),r("div",Cs,[($(!0),re(Xt,null,Yt(Object.entries(v.qualityAnalysis.scores).filter(([,m])=>m.max>0),([m,g])=>($(),re("div",{key:m,class:"flex items-center justify-between p-3 rounded-lg bg-muted/30 hover:bg-muted/40 transition-colors"},[r("div",ks,[r("div",Ss,q(m),1),r("div",Es,[j(q(g.score)+"/"+q(g.max)+" points ",1),r("span",{class:be(["ml-1",{"text-red-500":g.percentage<50,"text-orange-500":g.percentage>=50&&g.percentage<75,"text-blue-500":g.percentage>=75&&g.percentage<90,"text-green-500":g.percentage>=90}])}," ("+q(Math.round(g.percentage))+"%) ",3)])]),r("div",Ts,[r("div",{class:be(["h-full transition-all duration-500 rounded-full",{"bg-red-500":g.percentage<50,"bg-orange-500":g.percentage>=50&&g.percentage<75,"bg-blue-500":g.percentage>=75&&g.percentage<90,"bg-green-500":g.percentage>=90}]),style:at({width:`${g.percentage}%`})},null,6)])]))),128))])])):we("",!0),k.value.length>0?($(),re("div",As,[o[6]||(o[6]=r("h4",{class:"text-xs font-semibold text-muted-foreground mb-3 flex items-center gap-2"},[r("div",{class:"w-1 h-4 bg-orange-500 rounded-full"}),j(" Focus Areas ")],-1)),r("div",$s,[($(!0),re(Xt,null,Yt(k.value,m=>($(),re("div",{key:m.category,class:"flex items-center gap-3 p-3 rounded-lg border border-orange-200/50 bg-orange-50/30"},[s(e(Xr),{class:"h-4 w-4 text-orange-500 flex-shrink-0"}),r("div",Ds,[r("div",Ms,q(m.category),1),r("div",Rs,[j(q(m.score)+"/"+q(m.max)+" points - ",1),r("span",{class:be({"text-red-600":m.status==="poor","text-orange-600":m.status==="needs-work","text-yellow-600":m.status==="fair"})},q(m.status==="poor"?"needs significant improvement":m.status==="needs-work"?"needs improvement":"fair, could be better"),3)])])]))),128))])])):we("",!0),v.isAnalyzing?($(),re("div",Ps,[s(e(Jr),{class:"h-4 w-4 text-blue-500 animate-pulse"}),o[7]||(o[7]=r("span",{class:"text-sm text-blue-700 font-medium"},"Analyzing academic quality with AI...",-1))])):we("",!0),!v.qualityAnalysis&&!v.isAnalyzing?($(),re("div",js,[s(e(wt),{class:"h-8 w-8 text-muted-foreground mx-auto mb-2"}),o[8]||(o[8]=r("p",{class:"text-sm text-muted-foreground"},'Click "Analyze" to get AI-powered quality insights',-1))])):we("",!0)]),_:1})]),_:1})):we("",!0)}});function qs(i){const{delay:c=1e4,onSave:k}=i,A=p(!1),v=p(!1),o=p(null),m=()=>{A.value=!0,o.value&&clearTimeout(o.value),o.value=setTimeout(()=>{g(!0)},c)},g=async(w=!1)=>{if(!v.value){v.value=!0;try{await k(w),A.value=!1,o.value&&(clearTimeout(o.value),o.value=null)}finally{v.value=!1}}};return{hasUnsavedChanges:A,isSaving:v,triggerAutoSave:m,save:g,clearAutoSave:()=>{o.value&&(clearTimeout(o.value),o.value=null)}}}function Fs(i){const c=p({sentences:0,paragraphs:0,readingTime:0,avgWordLength:0,uniqueWords:0,commonWords:[]}),k=z(()=>i.value?i.value.split(/\s+/).filter(o=>o.length>0).length:0),A=()=>{if(!i.value){c.value={sentences:0,paragraphs:0,readingTime:0,avgWordLength:0,uniqueWords:0,commonWords:[]};return}const o=i.value,m=o.split(/\s+/).filter(h=>h.length>0),g=o.split(/[.!?]+/).filter(h=>h.trim().length>0),u=o.split(`

`).filter(h=>h.trim().length>0),w=new Map;m.forEach(h=>{const l=h.toLowerCase().replace(/[^a-z0-9]/g,"");l&&w.set(l,(w.get(l)||0)+1)});const F=new Set(["the","a","an","and","or","but","in","on","at","to","for","of","with","by","is","was","are","were"]),C=Array.from(w.entries()).filter(([h])=>!F.has(h)).sort((h,l)=>l[1]-h[1]).slice(0,5).map(([h])=>h);c.value={sentences:g.length,paragraphs:u.length,readingTime:Math.ceil(m.length/200),avgWordLength:m.reduce((h,l)=>h+l.length,0)/m.length,uniqueWords:w.size,commonWords:C}},v=z(()=>{if(!i.value)return 0;let o=0;const m=i.value;m.includes("##")&&(o+=20),m.length>1e3&&(o+=20),m.match(/\[.*?\]/g)&&(o+=15),(m.includes("**")||m.includes("*"))&&(o+=10);const g=m.split(/[.!?]+/).filter(w=>w.trim().length>0);if(g.length>0){const w=g.reduce((F,C)=>F+C.split(/\s+/).length,0)/g.length;w>10&&w<25&&(o+=20)}return m.split(`

`).filter(w=>w.trim().length>0).length>3&&(o+=15),Math.min(o,100)});return{writingStats:c,currentWordCount:k,writingQualityScore:v,calculateWritingStats:A}}function Ls(i,c=p(3e3),k=.8){const A=_=>{if(!_)return 0;const oe=_.replace(/<[^>]*>/g,"").trim().replace(/\s+/g," ");if(!oe)return 0;const Ce=oe.match(/\b\w+\b/g);return Ce?Ce.length:0},v=_=>_?_.replace(/<[^>]*>/g,"").replace(/\r\n|\r/g,`
`).trim().split(/\n\s*\n/).filter(L=>L.trim().length>0).length:0,o=_=>{if(!_)return 0;const oe=_.replace(/<[^>]*>/g,"").match(/[.!?]+/g);return oe?oe.length:0},m=_=>Math.round(_/200*10)/10,g=z(()=>A(i.value)),u=z(()=>i.value.length),w=z(()=>i.value.replace(/\s/g,"").length),F=z(()=>v(i.value)),C=z(()=>o(i.value)),h=z(()=>m(g.value)),l=z(()=>{const _=c.value;return!_||_<=0?0:Math.min(g.value/_*100,100)}),f=z(()=>g.value>=c.value*k),x=z(()=>{const _=c.value-g.value;return Math.max(_,0)}),D=z(()=>{const _=c.value*k-g.value;return Math.max(_,0)}),G=z(()=>({wordCount:g.value,characterCount:u.value,characterCountNoSpaces:w.value,paragraphCount:F.value,sentenceCount:C.value,readingTimeMinutes:h.value})),S=z(()=>({current:g.value,target:c.value,percentage:l.value,isComplete:f.value,completionThreshold:k})),M=_=>_>=1e3?`${Math.round(_/100)/10}k`:_.toString(),U=(_=0)=>`${Math.round(l.value*Math.pow(10,_))/Math.pow(10,_)}%`,te=()=>`${g.value} / ${c.value} words (${U()}%)`,O=()=>{if(f.value)return`‚úÖ Complete (${M(g.value)} words)`;const _=D.value;return`${M(_)} more words to complete`},E=()=>{const _=g.value,B=c.value;return _===0?"empty":_<B*.25?"started":_<B*.75?"progressing":_<B*k?"near_complete":_<B?"complete":"exceeded"},Z=()=>{const _=E();return{empty:"text-gray-500",started:"text-blue-500",progressing:"text-yellow-500",near_complete:"text-orange-500",complete:"text-green-500",exceeded:"text-emerald-600"}[_]},Y=()=>{const _=E();return{empty:"bg-gray-200",started:"bg-blue-200",progressing:"bg-yellow-200",near_complete:"bg-orange-200",complete:"bg-green-200",exceeded:"bg-emerald-200"}[_]},ee=800,W=z(()=>g.value>=ee),le=z(()=>Math.max(ee-g.value,0)),ie=z(()=>Math.min(g.value/ee*100,100));return{currentWordCount:g,characterCount:u,characterCountNoSpaces:w,paragraphCount:F,sentenceCount:C,readingTimeMinutes:h,progressPercentage:l,isComplete:f,wordsRemaining:x,wordsToComplete:D,wordCountStats:G,wordCountProgress:S,meetsDefenseThreshold:W,defenseWordsRemaining:le,defenseProgressPercentage:ie,DEFENSE_THRESHOLD:ee,formatWordCount:M,formatProgress:U,getProgressDisplay:te,getCompletionDisplay:O,getWordCountStatus:E,getStatusColor:Z,getProgressBarColor:Y,countWords:A}}function Is(i){const c=p(!1),k=p(null),A=p([]),v=p(null),o=z(()=>{if(!k.value?.quality_level)return"text-muted-foreground";switch(k.value.quality_level){case"Excellent":return"text-green-600";case"Good":return"text-blue-600";case"Satisfactory":return"text-yellow-600";case"Needs Improvement":return"text-orange-600";case"Poor":return"text-red-600";default:return"text-muted-foreground"}}),m=z(()=>k.value?.scores?Object.entries(k.value.scores).sort(([,l],[,f])=>l.percentage-f.percentage).slice(0,3).map(([l,f])=>({category:l.replace(" & "," & "),percentage:Math.round(f.percentage),score:f.score,max:f.max})):[]),g=async()=>{try{c.value=!0,v.value=null,await Pe.get("/sanctum/csrf-cookie");const l=await Pe.post(se("api.chapters.analysis.analyze",{chapter:i}));if(l.data.success)return k.value=l.data.analysis,l.data.analysis;throw new Error(l.data.error||"Analysis failed")}catch(l){return v.value=l.response?.data?.error||l.message||"Analysis failed",console.error("Chapter analysis failed:",l),null}finally{c.value=!1}};return{isAnalyzing:c,latestAnalysis:k,analysisHistory:A,error:v,qualityLevelColor:o,topImprovementAreas:m,analyzeChapter:g,getLatestAnalysis:async()=>{try{await Pe.get("/sanctum/csrf-cookie");const l=await Pe.get(se("api.chapters.analysis.latest",{chapter:i}));return l.data.success?(k.value=l.data.analysis,l.data.analysis):(k.value=null,null)}catch(l){return l.response?.status!==404&&(v.value=l.response?.data?.error||l.message||"Failed to get analysis",console.error("Failed to get latest analysis:",l)),null}},getAnalysisHistory:async()=>{try{await Pe.get("/sanctum/csrf-cookie");const l=await Pe.get(se("api.chapters.analysis.history",{chapter:i}));if(l.data.success)return A.value=l.data.analyses,l.data.analyses;throw new Error(l.data.error||"Failed to get history")}catch(l){return v.value=l.response?.data?.error||l.message||"Failed to get analysis history",console.error("Failed to get analysis history:",l),[]}},autoAnalyze:async(l,f=500)=>{l>=f&&await g()},getScoreColor:(l,f)=>{const x=l/f*100;return x>=80?"text-green-600":x>=70?"text-blue-600":x>=60?"text-yellow-600":x>=40?"text-orange-600":"text-red-600"},getProgressVariant:l=>l>=80?"success":l>=60?"default":"destructive"}}const Os={class:"relative z-20 flex flex-shrink-0 items-center justify-between border-b border-border/40 bg-background/60 p-4 backdrop-blur-xl supports-[backdrop-filter]:bg-background/40 transition-all duration-300"},zs={class:"flex items-center gap-5"},Gs={class:"flex flex-col"},Ns={class:"flex items-center gap-3 text-xs text-muted-foreground"},Ws={class:"flex items-center gap-1.5"},Hs={class:"flex items-center gap-4"},Us={class:"flex items-center p-1 rounded-full border border-border/40 bg-background/50 backdrop-blur-sm shadow-sm"},Bs={class:"flex items-center gap-2"},Ks={class:"relative z-20 h-[2px] w-full bg-border/20"},Qs={key:0,class:"mx-3 my-2"},Vs={class:"relative overflow-hidden rounded-xl border border-blue-200 bg-gradient-to-br from-blue-50 to-purple-50 p-3 shadow-sm dark:border-blue-800 dark:from-blue-950/30 dark:to-purple-950/30"},Js={class:"relative z-10 mb-2 flex items-center justify-between"},Xs={class:"flex items-center gap-2"},Ys={class:"relative"},Zs={class:"flex h-6 w-6 items-center justify-center rounded-full bg-gradient-to-br from-blue-500 to-purple-600"},eo={class:"text-xs text-blue-700 dark:text-blue-300"},to={class:"relative z-10 mb-2"},ro={class:"mb-1 flex items-center justify-between"},so={class:"text-xs text-blue-600 dark:text-blue-400"},oo={class:"relative h-2 overflow-hidden rounded-full bg-blue-100 dark:bg-blue-900/50"},no={class:"relative z-10 flex items-center gap-2"},ao={class:"flex-shrink-0"},lo={key:0,class:"h-2 w-2 animate-bounce rounded-full bg-blue-500"},io={key:1,class:"flex gap-0.5"},co={key:2,class:"h-2 w-2 animate-spin rounded-full border-2 border-blue-500 border-t-transparent"},uo={key:3,class:"h-2 w-2 rounded-full bg-green-500"},go={key:4,class:"h-2 w-2 rounded-full bg-red-500"},po={class:"flex-1 text-xs text-blue-800 dark:text-blue-200"},ho={class:"relative z-10 flex flex-1 overflow-hidden"},fo={key:0,class:"w-[320px] flex-shrink-0 border-r border-border/50 bg-background/80 backdrop-blur-xl shadow-xl z-20"},vo={class:"h-full overflow-y-auto custom-scrollbar"},mo={class:"p-4"},bo={class:"mb-3"},wo={class:"text-xs text-muted-foreground"},xo={class:"flex min-h-0 flex-1 flex-col bg-transparent relative"},yo={class:"flex-1 overflow-hidden relative"},_o={class:"absolute inset-0 overflow-y-auto custom-scrollbar flex flex-col items-center py-8 px-4 sm:px-8"},Co={class:"flex items-center justify-between"},ko={class:"space-y-1"},So={class:"flex items-center gap-2"},Eo={class:"flex items-center justify-between px-6 py-2 border-b border-border/30 bg-muted/5"},To={class:"flex items-center gap-2"},Ao={class:"space-y-1 relative z-10"},$o={class:"text-sm font-medium text-foreground"},Do={class:"text-[10px] text-muted-foreground line-clamp-2 leading-relaxed"},Mo={class:"flex-1 relative bg-background"},Ro={class:"px-12 py-10 min-h-[500px]"},Po={class:"sticky bottom-0 z-10 border-t border-border/30 bg-background/80 backdrop-blur-md p-4 flex items-center justify-between"},jo={class:"text-xs text-muted-foreground"},qo={class:"flex items-center gap-2"},Fo={key:0,class:"w-72 flex-shrink-0 border-l border-border/40 bg-background/40 backdrop-blur-md"},Lo={class:"h-full overflow-y-auto custom-scrollbar"},Io={class:"space-y-6 p-4"},Oo={class:"flex h-full w-full overflow-hidden relative"},zo={class:"hidden lg:flex w-80 flex-col border-r border-border/40 bg-background/60 backdrop-blur-xl z-20 transition-all duration-300"},Go={class:"h-14 flex items-center justify-between px-4 border-b border-border/40 shrink-0"},No={class:"p-4"},Wo={class:"flex-1 flex flex-col relative z-10 min-w-0 bg-background/30 dark:bg-background transition-all duration-300"},Ho={class:"min-h-[5.5rem] flex flex-shrink-0 items-center justify-between border-b border-border/40 bg-background/60 backdrop-blur-md px-4 py-2 relative z-30 transition-all duration-300"},Uo={class:"flex items-center gap-4 flex-1"},Bo={class:"flex items-center gap-2 flex-shrink-0 h-full self-start mt-1"},Ko={class:"flex flex-col gap-1.5 flex-1 min-w-0"},Qo={class:"flex items-start gap-3 w-full"},Vo={class:"flex items-center gap-2 flex-wrap"},Jo={class:"flex items-center bg-background/50 rounded-md border border-border/50 p-0.5 mr-2 backdrop-blur-sm hidden sm:flex"},Xo={class:"flex items-center self-start mt-1 ml-2"},Yo={class:"flex-1 overflow-hidden relative group bg-background/20"},Zo={key:0,class:"absolute top-6 left-0 right-0 z-40 px-4 flex justify-center pointer-events-none"},en={class:"w-full max-w-lg pointer-events-auto"},tn={class:"relative overflow-hidden rounded-xl border border-blue-200 bg-gradient-to-br from-blue-50/95 to-purple-50/95 p-3 shadow-lg backdrop-blur-lg dark:border-blue-800 dark:from-blue-950/90 dark:to-purple-950/90"},rn={class:"flex items-center gap-3"},sn={class:"relative flex h-8 w-8 items-center justify-center rounded-full bg-gradient-to-br from-blue-500 to-purple-600 shadow-md"},on={class:"flex-1 min-w-0"},nn={class:"flex items-center justify-between mb-1"},an={class:"text-xs font-mono text-muted-foreground"},ln={class:"h-1.5 w-full bg-blue-100 dark:bg-blue-900/40 rounded-full overflow-hidden"},cn={class:"mt-2 text-xs text-muted-foreground ml-11 truncate"},un={class:"max-w-[850px] mx-auto py-12 px-6 sm:px-10 min-h-full"},dn={class:"min-h-[600px] pb-32"},gn={class:"pb-32"},pn={class:"h-7 border-t border-border/30 bg-background/40 backdrop-blur-sm flex items-center justify-between px-4 text-[10px] text-muted-foreground shrink-0"},hn={class:"flex items-center gap-3"},fn={class:"hidden sm:inline"},vn={class:"flex items-center gap-2"},mn={key:0,class:"text-green-500 flex items-center gap-1 ml-2"},bn={class:"hidden lg:flex w-96 flex-col border-l border-border/40 bg-background/60 backdrop-blur-xl z-20 transition-all duration-300"},wn={class:"h-14 flex items-center justify-between px-4 border-b border-border/40 shrink-0"},xn={class:"flex-1 overflow-y-auto custom-scrollbar"},yn={class:"p-4 space-y-6"},_n={key:0,class:"fixed inset-0 bg-black/50 flex items-center justify-center z-50"},Cn={class:"text-slate-600 dark:text-slate-300 mb-4"},kn={class:"font-semibold text-amber-600 dark:text-amber-400"},Sn={class:"flex flex-col sm:flex-row gap-3"},En=1e3,Tn=hr({__name:"ChapterEditor",props:{project:{},chapter:{},allChapters:{},facultyChapters:{},mode:{}},setup(i){const c=He(()=>Ue(()=>import("./AISidebar-BnYEEV9M.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54]))),k=He(()=>Ue(()=>import("./ChapterNavigation-BAJw0bqT.js"),__vite__mapDeps([55,56,3,1,2,18,7,8,9,19,20,21,57,16,14,42,58,59,60,61,35]))),A=He(()=>Ue(()=>import("./MobileNavOverlay-0cjIVllT.js"),__vite__mapDeps([62,1,2,63,3,0,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,56,57,58,59,60,61,64,65,66,67,68,69,70]))),v=He(()=>Ue(()=>import("./ChatModeLayout-BdcyKp89.js"),__vite__mapDeps([71,72,1,2,16,3,9,4,12,7,8,13,18,19,22,23,24,25,26,27,28,29,30,31,32,33,34,35,21,36,37,38,17,39,40,41,42,43,44,73,74,75,76,66,77,10,11,14,45,78,79,63,80,47,81,82,58,83,50,67,61,49,53,84,59,85,86,87]))),o=He(()=>Ue(()=>import("./CitationVerificationLayout-CljLROPu.js"),__vite__mapDeps([88,16,3,1,2,9,4,5,12,7,8,13,18,19,24,74,22,23,25,26,27,28,29,30,31,32,33,34,35,21,36,37,38,17,39,40,41,42,43,44,75,76,66,77,10,11,14,45,78,79,80,59,89]))),m=He(()=>Ue(()=>import("./DefensePreparationPanel-Cn7b-_Si.js"),__vite__mapDeps([90,64,1,2,63,3,16,9,4,5,6,7,8,12,13,18,19,10,11,65,66,45,67,68,46,51,34,37,31]))),g=He(()=>Ue(()=>import("./DataCollectionPanel-CI4Hdjs1.js"),__vite__mapDeps([91,69,1,2,14,3]))),u=i,w=p(null),F=p(null),{chapterTitle:C,chapterContent:h,showPreview:l,isEditorDark:f,initChapterTheme:x,toggleChapterTheme:D,isNativeFullscreen:G,showStatistics:S,selectedText:M,showChatMode:U,showCitationMode:te,showDefensePrep:O,loadChatModeFromStorage:E,saveChatModeToStorage:Z,showLeftSidebar:Y,showRightSidebar:ee,isMobile:W,isLeftSidebarCollapsed:le,isRightSidebarCollapsed:ie,showLeftSidebarInFullscreen:_,showRightSidebarInFullscreen:B}=ls(u),{balance:oe,showPurchaseModal:Ce,requiredWordsForModal:L,actionDescriptionForModal:K,checkAndPrompt:ce,closePurchaseModal:I,estimates:ue}=zr(),pe=(n,t)=>ce(Math.max(1,Math.round(n)),t),{hasUnsavedChanges:ne,isSaving:de,triggerAutoSave:xe,save:ge,clearAutoSave:je}=qs({delay:1e4,onSave:zt});let Qe=0;const R=()=>{const n=Date.now();n-Qe>En&&(Qe=n,T.success("Saved",{duration:2e3}))},{contentHistory:it,historyIndex:ct,addToHistory:ut,undo:xt,redo:dt}=Ur(u.chapter.content||""),{writingStats:Ze,writingQualityScore:ke,calculateWritingStats:Oe}=Fs(h),{isAnalyzing:et,latestAnalysis:ye,getLatestAnalysis:gt}=Is(u.chapter.id),fe=z(()=>{if(u.facultyChapters&&u.facultyChapters.length>0){const t=u.facultyChapters.find(b=>b.number===u.chapter.chapter_number);if(t?.word_count)return t.word_count}if(u.project?.outlines&&u.project.outlines.length>0){const t=u.project.outlines.find(b=>b.chapter_number===u.chapter.chapter_number);if(t?.target_word_count)return t.target_word_count}const n=u.project.type==="undergraduate"?2500:3500;return u.chapter.chapter_number===1||u.chapter.chapter_number===5?Math.round(n*.8):n}),{generateNextChapter:Ge}=gs({props:u,allChapters:u.allChapters,targetWordCount:fe,estimates:ue,ensureBalance:pe,save:ge}),{currentWordCount:ae,progressPercentage:tt,DEFENSE_THRESHOLD:yt,countWords:Ft}=Ls(h,fe),pt=tt,{defenseQuestions:_t,isLoadingDefenseQuestions:Ct,isGeneratingDefenseQuestions:kt,autoGenerateDefense:St,shouldLoadDefenseQuestions:y,loadDefenseQuestions:d,generateNewDefenseQuestions:N,markQuestionHelpful:P,hideQuestion:J,handleDefenseAutoToggle:Q,getDefenseStatusMessage:ve,shouldShowDefenseProgress:H,defenseProgressPercentage:Se,defenseWordsRemaining:Ee,hasTriggeredGeneration:me,meetsDefenseThreshold:Ne}=hs({props:u,chapterContent:h,currentWordCount:ae,ensureBalance:pe,estimates:ue}),{isGenerating:he,generationProgress:$e,generationPercentage:Te,generationPhase:qe,estimatedTotalWords:vr,streamWordCount:mr,isLoadingSuggestions:Et,showCitationHelper:Ve,showPresentationMode:Ae,isStreamingMode:Lt,showRecoveryDialog:br,savedWordCountOnError:wr,eventSource:It,editorScrollRef:xr,handleAIGeneration:Tt,getAISuggestions:At,checkCitations:$t,insertCitation:Ot,resumeGeneration:yr,dismissRecovery:_r,checkForAutoGeneration:Cr}=ds({props:u,chapterContent:h,targetWordCount:fe,estimates:ue,ensureBalance:pe,save:ge,triggerAutoSave:xe,calculateWritingStats:Oe,countWords:Ft,selectedText:M,richTextEditor:w,richTextEditorFullscreen:F,isNativeFullscreen:G}),ht=z(()=>{const n=C.value?.trim(),t=h.value?.trim();return n&&n.length>0&&t&&t.length>50}),Fe=z(()=>u.project),Le=z(()=>u.chapter),We=z(()=>u.allChapters),rt=z(()=>u.chapter);async function zt(n=!1){try{const t=await fetch(se("chapters.save",{project:u.project.id}),{method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json","X-Requested-With":"XMLHttpRequest","X-CSRF-TOKEN":document.querySelector('meta[name="csrf-token"]')?.getAttribute("content")||""},body:JSON.stringify({project_id:u.project.id,chapter_number:u.chapter.chapter_number,title:C.value,content:h.value,auto_save:n,statistics:Ze.value,quality_score:ke.value})});console.log("Response status:",t.status,t.statusText),console.log("Response headers:",t.headers);const b=await t.text();console.log("Raw response:",b);let _e;try{_e=JSON.parse(b)}catch(Ie){throw console.error("JSON parse error:",Ie),console.error("Response was:",b),new Error(`Server returned non-JSON response: ${t.status} ${t.statusText}`)}t.ok}catch(t){throw n||T.error("‚ùå Save Failed",{description:"Please try again or check your connection."}),t}}const Gt=()=>{const n=xt();n!==null&&(h.value=n,xe())},Nt=()=>{const n=dt();n!==null&&(h.value=n,xe())},st=n=>{ne.value&&confirm("You have unsaved changes. Save before switching chapters?")&&ge();const t=u.allChapters.find(Ie=>Ie.chapter_number===n),_e=t?.content&&t.content.trim()!==""?"chapters.edit":"chapters.write";Be.visit(se(_e,{project:u.project.slug,chapter:n}),{only:["chapter","mode","allChapters"],preserveState:!0,preserveScroll:!1})},kr=async()=>{try{const n=document.documentElement;n.requestFullscreen?await n.requestFullscreen():n.webkitRequestFullscreen?await n.webkitRequestFullscreen():n.msRequestFullscreen&&await n.msRequestFullscreen()}catch(n){console.error("Error entering fullscreen:",n),T.error("Fullscreen Error",{description:"Unable to enter fullscreen mode"})}},Sr=async()=>{try{document.exitFullscreen?await document.exitFullscreen():document.webkitExitFullscreen?await document.webkitExitFullscreen():document.msExitFullscreen&&await document.msExitFullscreen()}catch(n){console.error("Error exiting fullscreen:",n),T.error("Fullscreen Error",{description:"Unable to exit fullscreen mode"})}},Wt=async()=>{G.value?await Sr():await kr()},Je=()=>{const n=document.fullscreenElement||document.webkitFullscreenElement||document.msFullscreenElement;G.value=!!n},Er=()=>{U.value=!U.value,U.value&&(te.value=!1),Z(U.value)},Tr=()=>{U.value=!1,Z(!1)},Ar=()=>{te.value=!1},Ht=()=>{Ae.value=!Ae.value},Ut=()=>{Be.visit(se("projects.analysis",{project:u.project.slug}))},$r=()=>{ut(h.value),xe(),Oe()},Bt=n=>{(n.ctrlKey||n.metaKey)&&n.key==="s"&&(n.preventDefault(),ge(),R()),(n.ctrlKey||n.metaKey)&&!n.shiftKey&&n.key==="z"&&(n.preventDefault(),Gt()),(n.ctrlKey||n.metaKey)&&n.shiftKey&&n.key==="z"&&(n.preventDefault(),Nt()),n.key==="F11"&&(n.preventDefault(),Wt())};mt(()=>{const n=()=>{W.value=window.innerWidth<1024};n(),window.addEventListener("resize",n),U.value=E(),document.addEventListener("keydown",Kt),document.addEventListener("keydown",Bt),document.addEventListener("fullscreenchange",Je),document.addEventListener("webkitfullscreenchange",Je),document.addEventListener("msfullscreenchange",Je),Oe(),Cr(),x()});const Kt=n=>{if((n.ctrlKey||n.metaKey)&&!["INPUT","TEXTAREA","SELECT"].includes(n.target?.tagName))switch(n.key){case"ArrowLeft":n.preventDefault();const t=u.chapter.chapter_number-1;u.allChapters.find(ot=>ot.chapter_number===t)&&st(t);break;case"ArrowRight":n.preventDefault();const _e=u.chapter.chapter_number+1;u.allChapters.find(ot=>ot.chapter_number===_e)&&st(_e);break}};mt(()=>{const n=t=>{const b=_e=>{const{scrollTop:Ie,scrollHeight:ot,clientHeight:Dr}=t,Jt=_e.deltaY,Mr=Ie<=0,Rr=Ie+Dr>=ot;Jt<0&&Mr||Jt>0&&Rr||_e.stopPropagation()};return t.addEventListener("wheel",b,{passive:!0}),()=>t.removeEventListener("wheel",b)};bt(()=>{const t=document.querySelectorAll('[class*="overflow-y-auto"]'),b=[];t.forEach(_e=>{if(_e instanceof HTMLElement){const Ie=n(_e);b.push(Ie)}}),window.__scrollChainCleanup=b})}),pr(()=>{je(),It.value&&It.value.close(),document.removeEventListener("keydown",Bt),document.removeEventListener("keydown",Kt);const n=window.__scrollChainCleanup;n&&Array.isArray(n)&&(n.forEach(t=>t()),delete window.__scrollChainCleanup),document.removeEventListener("fullscreenchange",Je),document.removeEventListener("webkitfullscreenchange",Je),document.removeEventListener("msfullscreenchange",Je)}),ze(()=>u.chapter,async n=>{C.value=n.title||"",h.value=n.content||""},{immediate:!1});const Qt=async n=>{O.value=n,n&&y()&&await d(!1,{skipGeneration:!0})};ze(h,$r),ze(C,xe);const Vt=async()=>{console.log("üîµ [MARK COMPLETE] Function called"),console.log("üîµ [MARK COMPLETE] Current word count:",ae.value);try{console.log("üîµ [MARK COMPLETE] Saving chapter..."),await ge(!1),console.log("‚úÖ [MARK COMPLETE] Chapter saved");const n=se("chapters.mark-complete",{project:u.project.slug,chapter:u.chapter.chapter_number});console.log("üîµ [MARK COMPLETE] Posting to:",n),Be.post(n,{},{onSuccess:()=>{console.log("‚úÖ [MARK COMPLETE] Request successful")},onError:t=>{console.error("‚ùå [MARK COMPLETE] Request failed:",t)}})}catch(n){console.error("‚ùå [MARK COMPLETE] Error:",n),T.error("Failed to save chapter before marking complete")}};return mt(async()=>{await gt()}),(n,t)=>($(),X(e(Nr),null,{default:a(()=>[e(U)?($(),X(e(v),{key:0,project:Fe.value,chapter:Le.value,class:be({dark:e(f)}),"chapter-title":e(C),"chapter-content":e(h),"current-word-count":e(ae),"target-word-count":fe.value,"progress-percentage":e(pt),"writing-quality-score":e(ke),"is-valid":ht.value,"is-saving":e(de),"show-preview":e(l),"is-generating":e(he),"generation-progress":e($e),"history-index":e(ct),"content-history-length":e(it).length,"selected-text":e(M),"onUpdate:chapterTitle":t[0]||(t[0]=b=>C.value=b),"onUpdate:chapterContent":t[1]||(t[1]=b=>h.value=b),"onUpdate:selectedText":t[2]||(t[2]=b=>M.value=b),"onUpdate:showPreview":t[3]||(t[3]=b=>l.value=b),onSave:t[4]||(t[4]=b=>zt(b)),onUndo:Gt,onRedo:Nt,onExitChatMode:Tr},null,8,["project","chapter","class","chapter-title","chapter-content","current-word-count","target-word-count","progress-percentage","writing-quality-score","is-valid","is-saving","show-preview","is-generating","generation-progress","history-index","content-history-length","selected-text"])):e(te)?($(),X(e(o),{key:1,project:Fe.value,chapter:Le.value,class:be({dark:e(f)}),"chapter-title":e(C),"chapter-content":e(h),"current-word-count":e(ae),"target-word-count":fe.value,"progress-percentage":e(pt),onExitCitationMode:Ar},null,8,["project","chapter","class","chapter-title","chapter-content","current-word-count","target-word-count","progress-percentage"])):e(G)?($(),re("div",{key:2,class:be(["flex h-screen flex-col overflow-hidden bg-background dark:bg-background font-sans selection:bg-primary/20 transition-colors duration-300",{dark:e(f)}])},[t[53]||(t[53]=r("div",{class:"absolute inset-0 z-0 overflow-hidden pointer-events-none"},[r("div",{class:"absolute top-[-20%] left-[-10%] w-[50%] h-[50%] rounded-full bg-blue-500/5 blur-[120px]"}),r("div",{class:"absolute bottom-[-20%] right-[-10%] w-[50%] h-[50%] rounded-full bg-purple-500/5 blur-[120px]"})],-1)),r("div",Os,[r("div",zs,[s(e(De),null,{default:a(()=>[s(e(Me),{asChild:""},{default:a(()=>[s(e(V),{onClick:t[5]||(t[5]=b=>e(Be).visit(e(se)("projects.show",u.project.slug))),variant:"ghost",size:"icon",class:"h-10 w-10 rounded-full hover:bg-primary/10 hover:text-primary transition-all duration-300"},{default:a(()=>[s(e(nr),{class:"h-5 w-5"})]),_:1})]),_:1}),s(e(Re),null,{default:a(()=>[...t[31]||(t[31]=[r("p",null,"Back to Project",-1)])]),_:1})]),_:1}),r("div",Gs,[s(er,{as:"h1",class:"text-lg font-bold tracking-tight text-foreground/90 font-display",content:u.project.title},null,8,["content"]),r("div",Ns,[s(e(Ke),{variant:"outline",class:"h-5 px-2 rounded-full border-primary/20 bg-primary/5 text-primary font-medium"},{default:a(()=>[j(" Chapter "+q(u.chapter.chapter_number),1)]),_:1}),r("span",Ws,[t[32]||(t[32]=r("span",{class:"h-1.5 w-1.5 rounded-full bg-green-500 animate-pulse"},null,-1)),j(" "+q(e(ae))+" words ",1)])])])]),r("div",Hs,[r("div",Us,[s(e(V),{onClick:t[6]||(t[6]=b=>_.value=!e(_)),variant:e(_)?"secondary":"ghost",size:"sm",class:be(["h-8 px-4 rounded-full text-xs font-medium transition-all duration-300",e(_)?"bg-primary/10 text-primary hover:bg-primary/15":"hover:bg-muted"])},{default:a(()=>[s(e(ar),{class:"mr-2 h-3.5 w-3.5"}),t[33]||(t[33]=j(" Outline ",-1))]),_:1},8,["variant","class"]),t[35]||(t[35]=r("div",{class:"w-px h-4 bg-border/50 mx-1"},null,-1)),s(e(V),{onClick:t[7]||(t[7]=b=>B.value=!e(B)),variant:e(B)?"secondary":"ghost",size:"sm",class:be(["h-8 px-4 rounded-full text-xs font-medium transition-all duration-300",e(B)?"bg-primary/10 text-primary hover:bg-primary/15":"hover:bg-muted"])},{default:a(()=>[s(e(nt),{class:"mr-2 h-3.5 w-3.5"}),t[34]||(t[34]=j(" Assistant ",-1))]),_:1},8,["variant","class"])]),r("div",Bs,[s(e(De),null,{default:a(()=>[s(e(Me),{asChild:""},{default:a(()=>[s(e(V),{onClick:t[8]||(t[8]=b=>S.value=!e(S)),variant:e(S)?"secondary":"ghost",size:"icon",class:"h-9 w-9 rounded-full transition-all hover:bg-muted"},{default:a(()=>[s(e(lr),{class:"h-4.5 w-4.5 text-muted-foreground"})]),_:1},8,["variant"])]),_:1}),s(e(Re),null,{default:a(()=>[r("p",null,q(e(S)?"Hide":"Show")+" Statistics",1)]),_:1})]),_:1}),s(e(De),null,{default:a(()=>[s(e(Me),{asChild:""},{default:a(()=>[s(e(V),{onClick:e(D),variant:e(f)?"secondary":"ghost",size:"icon",class:"h-9 w-9 rounded-full transition-all hover:bg-muted"},{default:a(()=>[e(f)?($(),X(e(ir),{key:0,class:"h-4.5 w-4.5 text-foreground"})):($(),X(e(cr),{key:1,class:"h-4.5 w-4.5 text-muted-foreground"}))]),_:1},8,["onClick","variant"])]),_:1}),s(e(Re),null,{default:a(()=>[...t[36]||(t[36]=[r("p",null,"Toggle Dark Mode",-1)])]),_:1})]),_:1}),s(rr,{project:Fe.value,"current-chapter":Le.value,"all-chapters":We.value,size:"icon",variant:"ghost",class:"h-9 w-9 rounded-full hover:bg-muted"},null,8,["project","current-chapter","all-chapters"])])])]),r("div",Ks,[r("div",{class:"absolute top-0 left-0 h-full bg-gradient-to-r from-blue-500 via-purple-500 to-pink-500 transition-all duration-700 ease-out shadow-[0_0_10px_rgba(59,130,246,0.5)]",style:at({width:`${Math.min(e(pt),100)}%`})},null,4)]),e(he)?($(),re("div",Qs,[r("div",Vs,[t[42]||(t[42]=r("div",{class:"absolute inset-0 -skew-x-12 animate-pulse bg-gradient-to-r from-transparent via-white/10 to-transparent"},null,-1)),r("div",Js,[r("div",Xs,[r("div",Ys,[r("div",Zs,[s(e(nt),{class:"h-3 w-3 text-white"})]),t[37]||(t[37]=r("div",{class:"absolute inset-0 h-6 w-6 animate-ping rounded-full bg-gradient-to-br from-blue-500 to-purple-600 opacity-20"},null,-1))]),r("div",null,[t[38]||(t[38]=r("h4",{class:"text-xs font-semibold text-blue-900 dark:text-blue-100"},"AI Generator",-1)),r("p",eo,q(e(qe)),1)])]),s(e(Ke),{variant:"outline",class:"border-blue-300 text-xs text-blue-700 dark:border-blue-700 dark:text-blue-300"},{default:a(()=>[j(q(Math.round(e(Te)))+"% ",1)]),_:1})]),r("div",to,[r("div",ro,[t[39]||(t[39]=r("span",{class:"text-xs text-blue-800 dark:text-blue-200"},"Generation Progress",-1)),r("span",so,q(e(mr))+" / "+q(e(vr))+" words",1)]),r("div",oo,[r("div",{class:"absolute top-0 left-0 h-full rounded-full bg-gradient-to-r from-blue-500 to-purple-500 transition-all duration-500 ease-out",style:at({width:`${e(Te)}%`})},[...t[40]||(t[40]=[r("div",{class:"absolute inset-0 animate-pulse bg-gradient-to-r from-transparent via-white/30 to-transparent"},null,-1)])],4),r("div",{class:"absolute top-0 left-0 h-full rounded-full bg-gradient-to-r from-blue-400 to-purple-400 opacity-50 blur-sm transition-all duration-500",style:at({width:`${e(Te)}%`})},null,4)])]),r("div",no,[r("div",ao,[e(qe)==="Initializing"?($(),re("div",lo)):e(qe)==="Connecting"?($(),re("div",io,[...t[41]||(t[41]=[r("div",{class:"h-2 w-0.5 animate-pulse rounded-full bg-blue-500"},null,-1),r("div",{class:"h-2 w-0.5 animate-pulse rounded-full bg-purple-500",style:{"animation-delay":"0.2s"}},null,-1),r("div",{class:"h-2 w-0.5 animate-pulse rounded-full bg-blue-500",style:{"animation-delay":"0.4s"}},null,-1)])])):e(qe)==="Generating"?($(),re("div",co)):e(qe)==="Complete"?($(),re("div",uo)):($(),re("div",go))]),r("p",po,q(e($e)),1)])])])):we("",!0),e(S)?($(),X(gr,{key:1,"show-statistics":e(S),"current-word-count":e(ae),"writing-stats":e(Ze),"quality-analysis":e(ye),"is-analyzing":e(et),class:"relative z-20 mx-4 mt-2 rounded-lg border border-border/40 bg-background/60 backdrop-blur-md"},null,8,["show-statistics","current-word-count","writing-stats","quality-analysis","is-analyzing"])):we("",!0),r("div",ho,[s(ft,{"enter-active-class":"transition-all duration-300 ease-in-out","enter-from-class":"-ml-72 opacity-0","enter-to-class":"ml-0 opacity-100","leave-active-class":"transition-all duration-300 ease-in-out","leave-from-class":"ml-0 opacity-100","leave-to-class":"-ml-72 opacity-0"},{default:a(()=>[e(_)?($(),re("div",fo,[r("div",vo,[r("div",mo,[r("div",bo,[t[43]||(t[43]=r("h2",{class:"text-sm font-semibold text-foreground mb-1"},"Table of Contents",-1)),r("p",wo,q(We.value.length)+" Chapters ",1)]),($(),X(vt,null,{fallback:a(()=>[...t[44]||(t[44]=[r("div",{class:"flex items-center justify-center p-8"},[r("div",{class:"h-6 w-6 animate-spin rounded-full border-2 border-primary border-t-transparent"})],-1)])]),default:a(()=>[s(e(k),{"all-chapters":We.value,"current-chapter":Le.value,project:Fe.value,outlines:n.project.outlines||[],"faculty-chapters":n.facultyChapters||[],"current-word-count":e(ae),"target-word-count":fe.value,"writing-quality-score":e(ke),"chapter-content-length":e(h).length,onGoToChapter:st,onGenerateNextChapter:e(Ge)},null,8,["all-chapters","current-chapter","project","outlines","faculty-chapters","current-word-count","target-word-count","writing-quality-score","chapter-content-length","onGenerateNextChapter"])]),_:1}))])])])):we("",!0)]),_:1}),r("div",xo,[r("div",yo,[r("div",_o,[s(e(Pt),{class:"w-full max-w-[850px] min-h-[calc(100vh-180px)] flex flex-col bg-background shadow-xl shadow-black/5 ring-1 ring-black/5 dark:ring-white/10 rounded-xl overflow-hidden transition-all duration-300"},{default:a(()=>[s(e(qt),{class:"flex-shrink-0 border-b border-border/30 px-8 py-6 bg-background/50 backdrop-blur-sm sticky top-0 z-10"},{default:a(()=>[r("div",Co,[r("div",ko,[s(e(Or),{for:"chapter-title-fs",class:"text-xs font-medium text-zinc-500 dark:text-zinc-400 uppercase tracking-wider"},{default:a(()=>[...t[45]||(t[45]=[j("Chapter Title",-1)])]),_:1}),s(e(Ir),{id:"chapter-title-fs",modelValue:e(C),"onUpdate:modelValue":t[9]||(t[9]=b=>Dt(C)?C.value=b:null),placeholder:"Enter chapter title...",class:"h-auto p-0 border-0 bg-transparent text-2xl font-bold placeholder:text-muted-foreground/40 focus-visible:ring-0 px-0 text-foreground"},null,8,["modelValue"])]),r("div",So,[s(e(Ke),{variant:n.chapter.status==="approved"?"default":"secondary",class:"rounded-full px-3"},{default:a(()=>[j(q(n.chapter.status.replace("_"," ")),1)]),_:1},8,["variant"]),s(e(Ke),{variant:"outline",class:be(["rounded-full px-3 transition-colors",{"text-green-600 border-green-200 bg-green-50 dark:bg-green-900/20 dark:border-green-800":(e(ye)?.total_score||0)>=80,"text-yellow-600 border-yellow-200 bg-yellow-50 dark:bg-yellow-900/20 dark:border-yellow-800":(e(ye)?.total_score||0)>=70&&(e(ye)?.total_score||0)<80,"text-orange-600 border-orange-200 bg-orange-50 dark:bg-orange-900/20 dark:border-orange-800":(e(ye)?.total_score||0)>=60&&(e(ye)?.total_score||0)<70,"text-red-600 border-red-200 bg-red-50 dark:bg-red-900/20 dark:border-red-800":(e(ye)?.total_score||0)<60}])},{default:a(()=>[j(q(e(ye)?.total_score?Math.round(e(ye).total_score):e(ke))+"% Quality ",1)]),_:1},8,["class"])])])]),_:1}),s(e(jt),{class:"flex min-h-0 flex-1 flex-col p-0"},{default:a(()=>[r("div",Eo,[r("div",To,[s(e(V),{onClick:Ht,variant:e(Ae)?"default":"ghost",size:"sm",class:"h-7 text-xs rounded-full text-zinc-700 dark:text-zinc-300 hover:text-foreground"},{default:a(()=>[s(e(ur),{class:"mr-1.5 h-3.5 w-3.5"}),j(" "+q(e(Ae)?"Edit":"Preview"),1)]),_:1},8,["variant"])]),r("div",Ao,[r("div",$o,q(n.aiChapterAnalysis?.section.name||n.getSectionInfo(n.nextSection).name),1),r("div",Do,q(n.aiChapterAnalysis?.section.description||n.getSectionInfo(n.nextSection).description),1)])]),r("div",Mo,[Xe(s(or,{modelValue:e(h),"onUpdate:modelValue":t[10]||(t[10]=b=>Dt(h)?h.value=b:null),placeholder:"Start writing your chapter...","min-height":"500px",class:"min-h-[500px] px-8 py-6",ref_key:"richTextEditor",ref:w,"show-toolbar":!0,"streaming-mode":e(Lt),"is-generating":e(he),"generation-progress":e($e),"generation-percentage":e(Te),"generation-phase":e(qe),"onUpdate:selectedText":t[11]||(t[11]=b=>{M.value=b})},null,8,["modelValue","streaming-mode","is-generating","generation-progress","generation-percentage","generation-phase"]),[[Ye,!e(Ae)]]),Xe(r("div",Ro,[s(sr,{content:e(h),"show-font-controls":!1,class:"prose-lg mx-auto",style:{"font-family":"'Times New Roman', serif","line-height":"1.8"}},null,8,["content"])],512),[[Ye,e(Ae)]])])]),_:1}),r("div",Po,[r("div",jo,q(e(de)?"Saving...":"All changes saved"),1),r("div",qo,[s(e(V),{onClick:t[12]||(t[12]=b=>e(ge)(!1)),disabled:!ht.value||e(de),size:"sm",variant:"ghost",class:"h-8 rounded-full text-zinc-700 dark:text-zinc-300 hover:text-foreground"},{default:a(()=>[s(e(dr),{class:"mr-2 h-3.5 w-3.5"}),t[46]||(t[46]=j(" Save Draft ",-1))]),_:1},8,["disabled"]),s(e(V),{onClick:Ut,variant:"outline",size:"sm",class:"h-8 rounded-full"},{default:a(()=>[s(e(wt),{class:"mr-2 h-3.5 w-3.5"}),t[47]||(t[47]=j(" Run Bulk Analysis ",-1))]),_:1}),s(e(V),{onClick:Vt,disabled:e(de),size:"sm",class:"h-8 rounded-full bg-gradient-to-r from-primary to-primary/90 shadow-sm hover:shadow-md transition-all"},{default:a(()=>[s(e(Mt),{class:"mr-2 h-3.5 w-3.5"}),t[48]||(t[48]=j(" Complete ",-1))]),_:1},8,["disabled"])])])]),_:1}),t[49]||(t[49]=r("div",{class:"h-12"},null,-1))])])]),s(ft,{"enter-active-class":"transition-all duration-300 ease-in-out","enter-from-class":"-mr-72 opacity-0","enter-to-class":"mr-0 opacity-100","leave-active-class":"transition-all duration-300 ease-in-out","leave-from-class":"mr-0 opacity-100","leave-to-class":"-mr-72 opacity-0"},{default:a(()=>[e(B)?($(),re("div",Fo,[r("div",Lo,[r("div",Io,[($(),X(vt,null,{fallback:a(()=>[...t[50]||(t[50]=[r("div",{class:"flex items-center justify-center p-8"},[r("div",{class:"h-6 w-6 animate-spin rounded-full border-2 border-primary border-t-transparent"})],-1)])]),default:a(()=>[s(e(c),{project:Fe.value,chapter:Le.value,"is-generating":e(he),"selected-text":e(M),"is-loading-suggestions":e(Et),"show-citation-helper":e(Ve),"chapter-content":e(h),"current-word-count":e(ae),"target-word-count":fe.value,onStartStreamingGeneration:e(Tt),onGetAiSuggestions:e(At),"onUpdate:showCitationHelper":t[13]||(t[13]=b=>Ve.value=b),onInsertCitation:e(Ot),onCheckCitations:e($t)},null,8,["project","chapter","is-generating","selected-text","is-loading-suggestions","show-citation-helper","chapter-content","current-word-count","target-word-count","onStartStreamingGeneration","onGetAiSuggestions","onInsertCitation","onCheckCitations"])]),_:1})),($(),X(vt,null,{fallback:a(()=>[...t[51]||(t[51]=[r("div",{class:"flex items-center justify-center p-4"},[r("div",{class:"h-4 w-4 animate-spin rounded-full border-2 border-muted border-t-transparent"})],-1)])]),default:a(()=>[s(e(m),{"show-defense-prep":e(O),questions:e(_t),"is-loading":e(Ct),"is-generating":e(kt),"chapter-context":{chapter_number:rt.value.chapter_number,chapter_title:rt.value.title,word_count:e(ae)},"defense-watcher":{meetsThreshold:e(Ne),shouldShowProgress:e(H),progressPercentage:e(Se),wordsRemaining:e(Ee),hasTriggeredGeneration:e(me),threshold:e(yt),statusMessage:e(ve)()},"auto-generate-enabled":e(St),"onUpdate:showDefensePrep":Qt,onGenerateMore:e(N),onToggleAutoGenerate:e(Q),onRefresh:t[14]||(t[14]=()=>e(d)(!0,{skipGeneration:!0})),onMarkHelpful:e(P),onHideQuestion:e(J)},null,8,["show-defense-prep","questions","is-loading","is-generating","chapter-context","defense-watcher","auto-generate-enabled","onGenerateMore","onToggleAutoGenerate","onMarkHelpful","onHideQuestion"])]),_:1})),($(),X(vt,null,{fallback:a(()=>[...t[52]||(t[52]=[r("div",{class:"flex items-center justify-center p-4"},[r("div",{class:"h-4 w-4 animate-spin rounded-full border-2 border-muted border-t-transparent"})],-1)])]),default:a(()=>[s(e(g),{"chapter-id":rt.value.id,content:e(h)},null,8,["chapter-id","content"])]),_:1}))])])])):we("",!0)]),_:1})])],2)):($(),X(Gr,{key:3,class:be(["h-screen overflow-hidden bg-background dark:bg-background transition-colors duration-300",{dark:e(f)}])},{default:a(()=>[r("div",Oo,[t[81]||(t[81]=r("div",{class:"absolute inset-0 z-0 overflow-hidden pointer-events-none"},[r("div",{class:"absolute top-[-10%] left-[-10%] w-[40%] h-[40%] rounded-full bg-blue-500/5 blur-[100px]"}),r("div",{class:"absolute bottom-[-10%] right-[-10%] w-[40%] h-[40%] rounded-full bg-purple-500/5 blur-[100px]"})],-1)),Xe(r("aside",zo,[r("div",Go,[t[54]||(t[54]=r("span",{class:"text-sm font-semibold tracking-tight text-foreground"},"Navigation",-1)),s(e(Ke),{variant:"outline",class:"text-[10px] h-5 px-1.5"},{default:a(()=>[j(q(We.value.length)+" Chapters ",1)]),_:1})]),s(e(Zt),{class:"flex-1"},{default:a(()=>[r("div",No,[s(e(k),{"all-chapters":We.value,"current-chapter":Le.value,project:Fe.value,outlines:n.project.outlines||[],"faculty-chapters":n.facultyChapters||[],"current-word-count":e(ae),"target-word-count":fe.value,"writing-quality-score":e(ke),"chapter-content-length":e(h).length,onGoToChapter:st,onGenerateNextChapter:e(Ge)},null,8,["all-chapters","current-chapter","project","outlines","faculty-chapters","current-word-count","target-word-count","writing-quality-score","chapter-content-length","onGenerateNextChapter"])])]),_:1})],512),[[Ye,!e(le)]]),r("main",Wo,[r("header",Ho,[r("div",Uo,[r("div",Bo,[s(e(De),null,{default:a(()=>[s(e(Me),{asChild:""},{default:a(()=>[s(e(V),{variant:"ghost",size:"icon",class:"h-8 w-8 text-zinc-700 dark:text-zinc-300 hover:text-foreground",onClick:t[15]||(t[15]=b=>e(Be).visit(e(se)("projects.writing",u.project.slug)))},{default:a(()=>[s(e(nr),{class:"w-4 h-4"})]),_:1})]),_:1}),s(e(Re),null,{default:a(()=>[...t[55]||(t[55]=[j("Back to Writing",-1)])]),_:1})]),_:1}),t[56]||(t[56]=r("div",{class:"h-8 w-px bg-border/50 mx-1"},null,-1)),s(e(V),{variant:"ghost",size:"icon",onClick:t[16]||(t[16]=b=>le.value=!e(le)),class:"hidden lg:flex text-muted-foreground hover:text-foreground -ml-2 h-8 w-8"},{default:a(()=>[e(le)?($(),X(e(Zr),{key:1,class:"h-4 w-4"})):($(),X(e(Yr),{key:0,class:"h-4 w-4"}))]),_:1}),s(e(V),{variant:"ghost",size:"icon",onClick:t[17]||(t[17]=b=>Y.value=!0),class:"lg:hidden text-muted-foreground hover:text-foreground -ml-2 h-8 w-8"},{default:a(()=>[s(e(ar),{class:"h-4 w-4"})]),_:1}),t[57]||(t[57]=r("div",{class:"h-8 w-px bg-border/50 hidden lg:block mx-1"},null,-1))]),r("div",Ko,[r("div",Qo,[s(er,{as:"h1",class:"text-lg font-bold tracking-tight text-foreground leading-tight cursor-pointer hover:text-primary/80 transition-colors break-words line-clamp-2",content:u.project.title,onClick:t[18]||(t[18]=b=>e(Be).visit(e(se)("projects.show",u.project.slug)))},null,8,["content"]),s(e(Ke),{variant:"secondary",class:"h-5 px-2 text-[10px] font-medium rounded-full bg-secondary/50 border border-border/50 shrink-0 mt-0.5"},{default:a(()=>[j(" Ch "+q(u.chapter.chapter_number),1)]),_:1})]),r("div",Vo,[r("div",Jo,[s(e(De),null,{default:a(()=>[s(e(Me),{asChild:""},{default:a(()=>[s(e(V),{onClick:t[19]||(t[19]=b=>S.value=!e(S)),variant:e(S)?"secondary":"ghost",size:"sm",class:"h-7 px-3 text-xs gap-2 text-zinc-700 dark:text-zinc-300 hover:text-foreground"},{default:a(()=>[s(e(lr),{class:"h-3.5 w-3.5"}),t[58]||(t[58]=j(" Stats ",-1))]),_:1},8,["variant"])]),_:1}),s(e(Re),null,{default:a(()=>[...t[59]||(t[59]=[j("Toggle Writing Statistics",-1)])]),_:1})]),_:1}),t[65]||(t[65]=r("div",{class:"w-px h-3 bg-border/50 mx-0.5"},null,-1)),s(e(De),null,{default:a(()=>[s(e(Me),{asChild:""},{default:a(()=>[s(e(V),{onClick:Ht,variant:e(Ae)?"secondary":"ghost",size:"sm",class:"h-7 px-3 text-xs gap-2 text-zinc-700 dark:text-zinc-300 hover:text-foreground"},{default:a(()=>[e(Ae)?($(),X(e(as),{key:1,class:"h-3.5 w-3.5"})):($(),X(e(ur),{key:0,class:"h-3.5 w-3.5"})),j(" "+q(e(Ae)?"Edit":"Preview"),1)]),_:1},8,["variant"])]),_:1}),s(e(Re),null,{default:a(()=>[...t[60]||(t[60]=[j("Toggle Preview Mode",-1)])]),_:1})]),_:1}),t[66]||(t[66]=r("div",{class:"w-px h-3 bg-border/50 mx-0.5"},null,-1)),s(e(De),null,{default:a(()=>[s(e(Me),{asChild:""},{default:a(()=>[s(e(V),{onClick:Er,variant:"ghost",size:"sm",class:"h-7 px-3 text-xs gap-2 text-muted-foreground hover:text-foreground"},{default:a(()=>[s(e(es),{class:"h-3.5 w-3.5 text-blue-500"}),t[61]||(t[61]=r("span",{class:"text-foreground"},"AI Chat",-1))]),_:1})]),_:1}),s(e(Re),null,{default:a(()=>[...t[62]||(t[62]=[j("Open AI Assistant Overlay",-1)])]),_:1})]),_:1}),t[67]||(t[67]=r("div",{class:"w-px h-3 bg-border/50 mx-0.5"},null,-1)),s(e(De),null,{default:a(()=>[s(e(Me),{asChild:""},{default:a(()=>[s(e(V),{onClick:Wt,variant:"ghost",size:"sm",class:"h-7 px-3 text-xs gap-2 text-zinc-700 dark:text-zinc-300 hover:text-foreground",title:e(G)?"Exit Full Screen":"Enter Full Screen"},{default:a(()=>[e(G)?($(),X(e(Br),{key:0,class:"h-3.5 w-3.5"})):($(),X(e(Kr),{key:1,class:"h-3.5 w-3.5"}))]),_:1},8,["title"])]),_:1}),s(e(Re),null,{default:a(()=>[...t[63]||(t[63]=[j("Toggle Full Screen",-1)])]),_:1})]),_:1}),t[68]||(t[68]=r("div",{class:"w-px h-3 bg-border/50 mx-0.5"},null,-1)),s(e(De),null,{default:a(()=>[s(e(Me),{asChild:""},{default:a(()=>[s(e(V),{onClick:e(D),variant:"ghost",size:"sm",class:"h-7 px-3 text-xs gap-2 text-zinc-700 dark:text-zinc-300 hover:text-foreground"},{default:a(()=>[e(f)?($(),X(e(ir),{key:0,class:"h-3.5 w-3.5 text-foreground"})):($(),X(e(cr),{key:1,class:"h-3.5 w-3.5"})),j(" "+q(e(f)?"Dark":"Light"),1)]),_:1},8,["onClick"])]),_:1}),s(e(Re),null,{default:a(()=>[...t[64]||(t[64]=[j("Toggle Dark Mode",-1)])]),_:1})]),_:1})]),s(rr,{project:Fe.value,"current-chapter":Le.value,"all-chapters":We.value,size:"sm",variant:"outline",class:"h-7 hidden md:flex text-zinc-700 dark:text-zinc-300"},null,8,["project","current-chapter","all-chapters"]),s(e(V),{variant:"ghost",size:"sm",class:"hidden md:flex h-7 gap-2 text-zinc-700 dark:text-zinc-300 hover:text-foreground",onClick:Ut,title:"Open bulk analysis"},{default:a(()=>[s(e(nt),{class:"w-4 h-4"}),t[69]||(t[69]=r("span",{class:"text-xs font-medium"},"Analyze",-1))]),_:1}),s(e(V),{onClick:t[20]||(t[20]=b=>e(ge)(!1)),disabled:e(de),variant:ht.value?"default":"secondary",size:"sm",class:"h-7 px-3 text-xs shadow-sm gap-2"},{default:a(()=>[s(e(dr),{class:"h-3.5 w-3.5"}),j(" "+q(e(de)?"Saving...":"Save"),1)]),_:1},8,["disabled","variant"]),s(e(V),{onClick:Vt,disabled:e(de),size:"sm",class:"h-7 px-3 text-xs shadow-sm gap-2"},{default:a(()=>[s(e(Mt),{class:"h-3.5 w-3.5"}),t[70]||(t[70]=j(" Mark Complete ",-1))]),_:1},8,["disabled"])])])]),r("div",Xo,[s(e(V),{variant:"ghost",size:"icon",onClick:t[21]||(t[21]=b=>ie.value=!e(ie)),class:"hidden lg:flex text-muted-foreground hover:text-foreground ml-1 h-8 w-8"},{default:a(()=>[e(ie)?($(),X(e(Vr),{key:1,class:"h-4 w-4"})):($(),X(e(Qr),{key:0,class:"h-4 w-4"}))]),_:1}),s(e(V),{variant:"ghost",size:"icon",onClick:t[22]||(t[22]=b=>ee.value=!0),class:"lg:hidden text-muted-foreground hover:text-foreground ml-1 h-8 w-8"},{default:a(()=>[s(e(nt),{class:"h-4 w-4"})]),_:1})])]),r("div",Yo,[s(ft,{"enter-active-class":"transition-all duration-300 ease-out","enter-from-class":"opacity-0 -translate-y-4","enter-to-class":"opacity-100 translate-y-0","leave-active-class":"transition-all duration-200 ease-in","leave-from-class":"opacity-100 translate-y-0","leave-to-class":"opacity-0 -translate-y-4"},{default:a(()=>[e(he)?($(),re("div",Zo,[r("div",en,[r("div",tn,[r("div",rn,[r("div",sn,[s(e(nt),{class:"h-4 w-4 text-white animate-pulse"})]),r("div",on,[r("div",nn,[t[71]||(t[71]=r("h4",{class:"text-xs font-semibold text-foreground"},"Generating Content...",-1)),r("span",an,q(Math.round(e(Te)))+"%",1)]),r("div",ln,[r("div",{class:"h-full bg-gradient-to-r from-blue-500 to-purple-500 transition-all duration-300",style:at({width:`${e(Te)}%`})},null,4)])])]),r("p",cn,q(e($e)),1)])])])):we("",!0)]),_:1}),s(e(Zt),{ref_key:"editorScrollRef",ref:xr,class:"h-full w-full"},{default:a(()=>[r("div",un,[s(ft,{"enter-active-class":"transition-all duration-300 ease-out","enter-from-class":"opacity-0 -translate-y-2","enter-to-class":"opacity-100 translate-y-0","leave-active-class":"transition-all duration-200 ease-in","leave-from-class":"opacity-100 translate-y-0","leave-to-class":"opacity-0 -translate-y-2"},{default:a(()=>[e(S)?($(),X(gr,{key:0,"show-statistics":!0,"current-word-count":e(ae),"writing-stats":e(Ze),"quality-analysis":e(ye),"is-analyzing":e(et),class:"mb-8"},null,8,["current-word-count","writing-stats","quality-analysis","is-analyzing"])):we("",!0)]),_:1}),Xe(r("div",dn,[s(or,{ref_key:"richTextEditorFullscreen",ref:F,modelValue:e(h),"onUpdate:modelValue":t[23]||(t[23]=b=>Dt(h)?h.value=b:null),placeholder:"Start writing your chapter...",class:"prose prose-slate dark:prose-invert prose-lg max-w-none focus:outline-none min-h-[500px]","streaming-mode":e(Lt),"is-generating":e(he),"generation-progress":e($e),"generation-percentage":e(Te),"generation-phase":e(qe),"onUpdate:selectedText":t[24]||(t[24]=b=>M.value=b),"min-height":"500px"},null,8,["modelValue","streaming-mode","is-generating","generation-progress","generation-percentage","generation-phase"])],512),[[Ye,!e(Ae)]]),Xe(r("div",gn,[s(sr,{content:e(h),class:"prose prose-slate dark:prose-invert prose-lg max-w-none"},null,8,["content"])],512),[[Ye,e(Ae)]])])]),_:1},512)]),r("div",pn,[r("div",hn,[r("span",null,"Words: "+q(e(ae))+" / "+q(fe.value),1),r("span",fn,"Last saved: "+q(e(de)?"Saving...":"Just now"),1)]),r("div",vn,[r("span",null,[t[72]||(t[72]=j("Quality: ",-1)),r("span",{class:be(e(ke)>70?"text-green-500":"text-amber-500")},q(e(ke))+"%",3)]),ht.value?($(),re("span",mn,[s(e(Mt),{class:"h-3 w-3"}),t[73]||(t[73]=j(" Ready ",-1))])):we("",!0)])])]),Xe(r("aside",bn,[r("div",wn,[t[75]||(t[75]=r("span",{class:"text-sm font-semibold tracking-tight text-foreground"},"Writing Assistant",-1)),s(e(De),null,{default:a(()=>[s(e(Me),{asChild:""},{default:a(()=>[s(e(V),{variant:"ghost",size:"icon",class:"h-7 w-7"},{default:a(()=>[s(e(wt),{class:"h-3.5 w-3.5"})]),_:1})]),_:1}),s(e(Re),null,{default:a(()=>[...t[74]||(t[74]=[j("Manage Citations",-1)])]),_:1})]),_:1})]),r("div",xn,[r("div",yn,[s(e(c),{project:Fe.value,chapter:Le.value,"is-generating":e(he),"selected-text":e(M),"is-loading-suggestions":e(Et),"show-citation-helper":e(Ve),"chapter-content":e(h),"current-word-count":e(ae),"target-word-count":fe.value,onStartStreamingGeneration:e(Tt),onGetAiSuggestions:e(At),"onUpdate:showCitationHelper":t[25]||(t[25]=b=>Ve.value=b),onInsertCitation:e(Ot),onCheckCitations:e($t)},null,8,["project","chapter","is-generating","selected-text","is-loading-suggestions","show-citation-helper","chapter-content","current-word-count","target-word-count","onStartStreamingGeneration","onGetAiSuggestions","onInsertCitation","onCheckCitations"]),s(e(m),{"show-defense-prep":e(O),questions:e(_t),"is-loading":e(Ct),"is-generating":e(kt),"chapter-context":{chapter_number:rt.value.chapter_number,chapter_title:rt.value.title,word_count:e(ae)},"defense-watcher":{meetsThreshold:e(Ne),shouldShowProgress:e(H),progressPercentage:e(Se),wordsRemaining:e(Ee),hasTriggeredGeneration:e(me),threshold:e(yt),statusMessage:e(ve)()},"auto-generate-enabled":e(St),"onUpdate:showDefensePrep":Qt,onGenerateMore:e(N),onToggleAutoGenerate:e(Q),onRefresh:t[26]||(t[26]=()=>e(d)(!0,{skipGeneration:!0})),onMarkHelpful:e(P),onHideQuestion:e(J)},null,8,["show-defense-prep","questions","is-loading","is-generating","chapter-context","defense-watcher","auto-generate-enabled","onGenerateMore","onToggleAutoGenerate","onMarkHelpful","onHideQuestion"])])])],512),[[Ye,!e(ie)]]),s(e(A),{"show-left-sidebar":e(Y),"show-right-sidebar":e(ee),"is-mobile":e(W),"all-chapters":We.value,"current-chapter":Le.value,project:Fe.value,"current-word-count":e(ae),"target-word-count":fe.value,"writing-quality-score":e(ke),"chapter-content-length":e(h).length,"is-generating":e(he),"selected-text":e(M),"is-loading-suggestions":e(Et),"show-citation-helper":e(Ve),"chapter-content":e(h),"onUpdate:showLeftSidebar":t[27]||(t[27]=b=>Y.value=b),"onUpdate:showRightSidebar":t[28]||(t[28]=b=>ee.value=b),onGoToChapter:st,onGenerateNextChapter:e(Ge),onStartStreamingGeneration:e(Tt),onGetAiSuggestions:e(At),"onUpdate:showCitationHelper":t[29]||(t[29]=b=>Ve.value=b),onCheckCitations:e($t)},null,8,["show-left-sidebar","show-right-sidebar","is-mobile","all-chapters","current-chapter","project","current-word-count","target-word-count","writing-quality-score","chapter-content-length","is-generating","selected-text","is-loading-suggestions","show-citation-helper","chapter-content","onGenerateNextChapter","onStartStreamingGeneration","onGetAiSuggestions","onCheckCitations"]),s(Wr,{open:e(Ce),"current-balance":e(oe),"required-words":e(L),action:e(K),"onUpdate:open":t[30]||(t[30]=b=>Ce.value=b),onClose:e(I)},null,8,["open","current-balance","required-words","action","onClose"]),e(br)?($(),re("div",_n,[s(e(Pt),{class:"w-full max-w-md mx-4 bg-white dark:bg-slate-900 border-amber-500/50 shadow-2xl"},{default:a(()=>[s(e(qt),null,{default:a(()=>[s(e(fr),{class:"flex items-center gap-2 text-amber-600 dark:text-amber-400"},{default:a(()=>[...t[76]||(t[76]=[r("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[r("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"})],-1),j(" Generation Interrupted ",-1)])]),_:1})]),_:1}),s(e(jt),null,{default:a(()=>[r("p",Cn,[t[77]||(t[77]=j(" Connection lost. ",-1)),r("span",kn,q(e(wr))+" words",1),t[78]||(t[78]=j(" may have been saved. ",-1))]),r("div",Sn,[s(e(V),{onClick:e(yr),class:"flex-1 bg-amber-600 hover:bg-amber-700 text-white"},{default:a(()=>[...t[79]||(t[79]=[r("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-4 w-4 mr-2",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[r("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"})],-1),j(" Reload & Recover ",-1)])]),_:1},8,["onClick"]),s(e(V),{onClick:e(_r),variant:"outline",class:"flex-1"},{default:a(()=>[...t[80]||(t[80]=[j(" Dismiss ",-1)])]),_:1},8,["onClick"])])]),_:1})]),_:1})])):we("",!0)])]),_:1},8,["class"]))]),_:1}))}}),Ga=ts(Tn,[["__scopeId","data-v-c42e8d31"]]);export{Ga as default};
