import{W as L,B as f,b as i,I as M,J as $,P as w,d as A,a as F,o as S,u as t,Q as T,w as u,K as d,F as E}from"./app-BpX9aRyY.js";import{T as I}from"./index-C_gBUjfg.js";import{X as N}from"./x-Hd4-68ti.js";import{L as U}from"./loader-circle-6s4DkbQh.js";import{c as _}from"./index-CpZtUi5B.js";import{T as X}from"./triangle-alert-yvBDoTvX.js";import{C as V}from"./circle-check-B7KTglAz.js";import{r as j}from"./index-gOpobaE2.js";/**
 * @license lucide-vue-next v0.468.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const D=_("InfoIcon",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M12 16v-4",key:"1dtifu"}],["path",{d:"M12 8h.01",key:"e9boi3"}]]);/**
 * @license lucide-vue-next v0.468.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const J=_("OctagonXIcon",[["path",{d:"m15 9-6 6",key:"1uzhvr"}],["path",{d:"M2.586 16.726A2 2 0 0 1 2 15.312V8.688a2 2 0 0 1 .586-1.414l4.688-4.688A2 2 0 0 1 8.688 2h6.624a2 2 0 0 1 1.414.586l4.688 4.688A2 2 0 0 1 22 8.688v6.624a2 2 0 0 1-.586 1.414l-4.688 4.688a2 2 0 0 1-1.414.586H8.688a2 2 0 0 1-1.414-.586z",key:"2d38gg"}],["path",{d:"m9 9 6 6",key:"z0biqf"}]]),B=f(null);let b=!1,g=0,h=null;function K(e){if(g++,console.log(`[WordBalance] Init listener called, subscriber count: ${g}, already subscribed: ${b}`),b){console.log("[WordBalance] Already subscribed, skipping");return}if(!window.Echo){console.warn("[WordBalance] window.Echo not available");return}try{console.log(`[WordBalance] Subscribing to private channel: user.${e}`);const r=window.Echo.private(`user.${e}`);r.listen(".balance.updated",a=>{console.log("ðŸ’° [WordBalance] Event received:",a),console.log(`ðŸ’° [WordBalance] New balance: ${a.balance.formatted_balance} (reason: ${a.reason})`),B.value=a.balance}),r.subscribed(()=>{console.log(`âœ… [WordBalance] Successfully subscribed to user.${e} channel`)}),r.error(a=>{console.error("[WordBalance] Channel error:",a)}),b=!0,h=e,console.log(`âœ… [WordBalance] Listener registered for user.${e}`)}catch(r){console.error("[WordBalance] Failed to subscribe to balance channel:",r)}}function q(){if(g--,!(g>0||!b||!window.Echo||!h))try{window.Echo.leave(`user.${h}`),b=!1,h=null,console.log("ðŸ”Œ Unsubscribed from balance updates channel")}catch(e){console.error("Failed to unsubscribe from balance channel:",e)}}function oe(){const e=L(),r=f(!1),a=f(!1),s=f(0),c=f(""),y=i(()=>e.props.auth?.user?.id??null),p=i(()=>B.value?B.value:e.props.auth?.user?.word_balance_data??null),m=i(()=>p.value?.balance??0),k=i(()=>p.value?.formatted_balance??"0"),C=i(()=>m.value>0),W=i(()=>p.value?p.value.percentage_remaining<20:!1),v=o=>{const n=m.value,l=n>=o;return{canProceed:l,balance:n,required:o,shortage:l?0:o-n}},P=(o,n="continue")=>v(o).canProceed?!0:(s.value=o,c.value=n,a.value=!0,!1),x=async()=>{r.value=!0;try{const n=await(await fetch(w("api.balance"))).json();if(n.balance){const l=e.props.auth;l?.user&&(l.user.word_balance_data=n.balance)}return n.balance}catch(o){return console.error("Failed to fetch balance:",o),null}finally{r.value=!1}},O={chapter:o=>Math.ceil(o*1.1),suggestion:()=>200,chat:()=>500,defense:()=>1e3,expand:()=>300,rephrase:()=>150},z=()=>{a.value=!1,s.value=0,c.value=""};return M(()=>{y.value&&K(y.value)}),$(()=>{q()}),{wordBalance:p,balance:m,formattedBalance:k,hasWords:C,isLowBalance:W,isLoading:r,showPurchaseModal:a,requiredWordsForModal:s,actionDescriptionForModal:c,checkBalance:v,checkAndPrompt:P,refreshBalance:x,closePurchaseModal:z,estimates:O}}async function re(e,r,a,s){try{await fetch(w("api.words.record-usage"),{method:"POST",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":document.querySelector('meta[name="csrf-token"]')?.getAttribute("content")||""},body:JSON.stringify({words:e,description:r,reference_type:a,reference_id:s})})}catch(c){console.error("Failed to record word usage:",c)}}const ne=A({__name:"Sonner",props:{id:{},invert:{type:Boolean},theme:{},position:{},closeButtonPosition:{},hotkey:{},richColors:{type:Boolean},expand:{type:Boolean},duration:{},gap:{},visibleToasts:{},closeButton:{type:Boolean},toastOptions:{},class:{},style:{},offset:{},mobileOffset:{},dir:{},swipeDirections:{},icons:{},containerAriaLabel:{}},setup(e){const a=j(e,"toastOptions");return(s,c)=>(S(),F(t(I),T({class:"toaster group","toast-options":{classes:{toast:"group toast group-[.toaster]:bg-background group-[.toaster]:text-foreground group-[.toaster]:border-border group-[.toaster]:shadow-lg",description:"group-[.toast]:text-muted-foreground",actionButton:"group-[.toast]:bg-primary group-[.toast]:text-primary-foreground",cancelButton:"group-[.toast]:bg-muted group-[.toast]:text-muted-foreground"}}},t(a)),{"success-icon":u(()=>[d(t(V),{class:"size-4"})]),"info-icon":u(()=>[d(t(D),{class:"size-4"})]),"warning-icon":u(()=>[d(t(X),{class:"size-4"})]),"error-icon":u(()=>[d(t(J),{class:"size-4"})]),"loading-icon":u(()=>[E("div",null,[d(t(U),{class:"size-4 animate-spin"})])]),"close-icon":u(()=>[d(t(N),{class:"size-4"})]),_:1},16))}});export{D as I,ne as _,re as r,oe as u};
