const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/AISidebar-DdhoeboQ.js","assets/app-CRHIBinC.js","assets/app-BQhtnlcI.css","assets/index-C57tJw-c.js","assets/CardContent.vue_vue_type_script_setup_true_lang-DNFz2X1I.js","assets/CardTitle.vue_vue_type_script_setup_true_lang-BpurTBvg.js","assets/CollapsibleTrigger.vue_vue_type_script_setup_true_lang-MbLBqX5B.js","assets/VisuallyHidden-DXEPd-Tl.js","assets/useForwardExpose-CcIYequg.js","assets/Separator.vue_vue_type_script_setup_true_lang-CCpndayC.js","assets/Separator-C2bT-YxD.js","assets/Progress.vue_vue_type_script_setup_true_lang-DI1oxQTU.js","assets/nullish-CHIgUVhi.js","assets/Sonner.vue_vue_type_script_setup_true_lang-BSZsdVc9.js","assets/DropdownMenuTrigger.vue_vue_type_script_setup_true_lang-C50_k0f2.js","assets/triangle-alert-DuHwL0CY.js","assets/circle-check-D1tUgghK.js","assets/CitationHelper.vue_vue_type_script_setup_true_lang-C8TbzAZH.js","assets/index-B9nH2UNr.js","assets/Input.vue_vue_type_script_setup_true_lang-nkC69OGZ.js","assets/useTextHistory-Bd7uuNh6.js","assets/RichTextEditor-Ccr25INY.js","assets/_plugin-vue_export-helper-DlAUqK2U.js","assets/SafeHtmlText.vue_vue_type_script_setup_true_lang-kZSN0u71.js","assets/index-BWEDi_FC.js","assets/step-DrZ9DcYd.js","assets/DialogTitle.vue_vue_type_script_setup_true_lang-CwcQ8QJs.js","assets/DialogFooter.vue_vue_type_script_setup_true_lang-CkLJzkK8.js","assets/Label.vue_vue_type_script_setup_true_lang-DS8-NriQ.js","assets/type-CBF60nua.js","assets/minus-BVkjycF2.js","assets/plus-C3-bO-mH.js","assets/list-D6cKNqbe.js","assets/RichTextEditor-BDJ8Kfyb.css","assets/Checkbox.vue_vue_type_script_setup_true_lang-DfmZjXzw.js","assets/ohash.D__AXeF1-C-E83dC9.js","assets/VisuallyHiddenInput-DkqYdF2s.js","assets/RovingFocusItem-Cwaknf33.js","assets/check-DeQj5fPU.js","assets/useNonce-DQ34V5z7.js","assets/download-CNh8sKZ4.js","assets/chevron-down-D5HO80Vg.js","assets/file-text-Bx4HAOrw.js","assets/useTextHistory-BWcwai4o.css","assets/AlertDialogTitle.vue_vue_type_script_setup_true_lang-DZ04f4eT.js","assets/wand-sparkles-OOlKkfA8.js","assets/search-KjYSsDt-.js","assets/trash-2-DESwagxW.js","assets/copy-CS5mfEk9.js","assets/brain-lthNzyMg.js","assets/zap-B1qnOTYr.js","assets/pen-tool-nuWdZuPz.js","assets/refresh-cw-DVJRKU5v.js","assets/sparkles-DcZDswG6.js","assets/AISidebar-Ymbz_oju.css","assets/ChapterNavigation-CIKJlAYo.js","assets/ChapterNavigation.vue_vue_type_script_setup_true_lang-B52DzM4g.js","assets/DialogTrigger-HF82OFsn.js","assets/chevron-right-DmNXX95H.js","assets/circle-check-big-DFxpbQTN.js","assets/lock-CSnUgptk.js","assets/target-BSFJp2Pz.js","assets/MobileNavOverlay-DRvJvV8X.js","assets/index-1rr3BO4S.js","assets/DefensePreparationPanel.vue_vue_type_script_setup_true_lang-KnQOvKJJ.js","assets/thumbs-up-DjFnSb7a.js","assets/lightbulb-CYG9NDBF.js","assets/circle-alert-C0SvwWKs.js","assets/DataCollectionPanel.vue_vue_type_script_setup_true_lang-DbWQQTHp.js","assets/MobileNavOverlay-CN-XSdXy.css","assets/ChatModeLayout-CNUxHx7b.js","assets/ChatModeLayout.vue_vue_type_script_setup_true_lang-Blq4N4er.js","assets/loader-BvG-1Bx0.js","assets/message-square-CdDuOkfD.js","assets/chevron-left-D2rG0kIj.js","assets/clock-CXR8RIml.js","assets/rotate-ccw-BMOSAvsy.js","assets/chart-column-DluDAt14.js","assets/user-CGrEsqAB.js","assets/eye-B1_N7Q-4.js","assets/save-DNFCpCo3.js","assets/ChatModeLayout-wjQGykpm.css","assets/CitationVerificationLayout-DrnUuXEn.js","assets/DefensePreparationPanel-CekOMUzj.js","assets/DataCollectionPanel-7FpJbbLe.js"])))=>i.map(i=>d[i]);
import{ak as ia,ab as ua,d as br,g as A,c as G,q as de,o as y,u as t,w as o,k as s,e as r,s as O,n as le,t as v,a as z,F as Et,E as kt,Y as ze,A as c,N as et,Q as xe,y as oe,h as lt,p as it,j as ca,al as Re,x as ut,T as ar,am as ct,b as Oe,f as Le,an as Pe}from"./app-CRHIBinC.js";import{_ as ke}from"./index-B9nH2UNr.js";import{_ as W}from"./index-C57tJw-c.js";import{_ as Tt,a as At}from"./CardContent.vue_vue_type_script_setup_true_lang-DNFz2X1I.js";import{_ as $t,a as wr}from"./CardTitle.vue_vue_type_script_setup_true_lang-BpurTBvg.js";import{_ as sr}from"./Input.vue_vue_type_script_setup_true_lang-nkC69OGZ.js";import{_ as yt}from"./Label.vue_vue_type_script_setup_true_lang-DS8-NriQ.js";import{_ as xr}from"./Progress.vue_vue_type_script_setup_true_lang-DI1oxQTU.js";import{B as tt,u as da,M as nr,a as _t,R as or,b as pa,P as ga,c as va,d as ha,e as fa,_ as lr}from"./useTextHistory-Bd7uuNh6.js";import{_ as ae,a as se,b as ne}from"./UserInfo.vue_vue_type_script_setup_true_lang-DMHdTfrg.js";import{u as ma,_ as ba,a as wa,r as Ze}from"./AppLayout.vue_vue_type_script_setup_true_lang-DcB1JHJJ.js";import{_ as ir}from"./SafeHtmlText.vue_vue_type_script_setup_true_lang-kZSN0u71.js";import{t as E}from"./Sonner.vue_vue_type_script_setup_true_lang-BSZsdVc9.js";import{_ as xa}from"./PurchaseModal.vue_vue_type_script_setup_true_lang-DXQTfQLC.js";import{T as ya}from"./trending-up-BUB6hLZ6.js";import{C as _a}from"./circle-alert-C0SvwWKs.js";import{ao as ur}from"./RichTextEditor-Ccr25INY.js";import{t as cr}from"./toNumber-B0pVeiNS.js";import{A as dr}from"./arrow-left-CtiEDQ4i.js";import{B as dt}from"./brain-lthNzyMg.js";import{T as pr}from"./target-BSFJp2Pz.js";import{M as gr,S as vr}from"./sun-CT8ORAA0.js";import{E as Ct}from"./eye-B1_N7Q-4.js";import{S as hr}from"./save-DNFCpCo3.js";import{C as fr}from"./circle-check-big-DFxpbQTN.js";import{M as Ca}from"./message-square-CdDuOkfD.js";import{P as Sa}from"./pen-tool-nuWdZuPz.js";import"./useForwardExpose-CcIYequg.js";import"./VisuallyHidden-DXEPd-Tl.js";import"./nullish-CHIgUVhi.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";import"./Checkbox.vue_vue_type_script_setup_true_lang-DfmZjXzw.js";import"./ohash.D__AXeF1-C-E83dC9.js";import"./VisuallyHiddenInput-DkqYdF2s.js";import"./RovingFocusItem-Cwaknf33.js";import"./minus-BVkjycF2.js";import"./check-DeQj5fPU.js";import"./DialogTitle.vue_vue_type_script_setup_true_lang-CwcQ8QJs.js";import"./DropdownMenuTrigger.vue_vue_type_script_setup_true_lang-C50_k0f2.js";import"./DialogFooter.vue_vue_type_script_setup_true_lang-CkLJzkK8.js";import"./useNonce-DQ34V5z7.js";import"./Separator.vue_vue_type_script_setup_true_lang-CCpndayC.js";import"./Separator-C2bT-YxD.js";import"./download-CNh8sKZ4.js";import"./chevron-down-D5HO80Vg.js";import"./file-text-Bx4HAOrw.js";import"./coins-B5-HB5nV.js";import"./AppLogoIcon.vue_vue_type_script_setup_true_lang-Cu7bGR4G.js";import"./plus-C3-bO-mH.js";import"./chevron-right-DmNXX95H.js";import"./triangle-alert-DuHwL0CY.js";import"./circle-check-D1tUgghK.js";import"./sparkles-DcZDswG6.js";import"./arrow-right-k9AQsbe9.js";import"./index-BWEDi_FC.js";import"./step-DrZ9DcYd.js";import"./type-CBF60nua.js";import"./list-D6cKNqbe.js";var St=function(){return ia.Date.now()},Ea="Expected a function",ka=Math.max,Ta=Math.min;function Aa(D,S,$){var F,h,d,w,g,l,C=0,b=!1,L=!1,T=!0;if(typeof D!="function")throw new TypeError(Ea);S=cr(S)||0,ua($)&&(b=!!$.leading,L="maxWait"in $,d=L?ka(cr($.maxWait)||0,S):d,T="trailing"in $?!!$.trailing:T);function p(m){var Q=F,B=h;return F=h=void 0,C=m,w=D.apply(B,Q),w}function q(m){return C=m,g=setTimeout(X,S),b?p(m):w}function V(m){var Q=m-l,B=m-C,te=S-Q;return L?Ta(te,d-B):te}function K(m){var Q=m-l,B=m-C;return l===void 0||Q>=S||Q<0||L&&B>=d}function X(){var m=St();if(K(m))return ge(m);g=setTimeout(X,V(m))}function ge(m){return g=void 0,T&&F?p(m):(F=h=void 0,w)}function ye(){g!==void 0&&clearTimeout(g),C=0,F=l=h=g=void 0}function ve(){return g===void 0?w:ge(St())}function he(){var m=St(),Q=K(m);if(F=arguments,h=this,l=m,Q){if(g===void 0)return q(l);if(L)return clearTimeout(g),g=setTimeout(X,S),p(l)}return g===void 0&&(g=setTimeout(X,S)),w}return he.cancel=ye,he.flush=ve,he}const $a={class:"flex items-center justify-between mb-3"},qa={class:"flex items-center gap-3"},Ra={class:"p-2 rounded-lg bg-blue-500/10"},Pa={class:"text-right"},ja={class:"space-y-2"},Ma={class:"flex justify-between items-center text-xs"},Da={class:"relative"},Fa={key:0},Na={class:"space-y-3"},Oa={class:"flex-1"},La={class:"text-sm font-medium"},za={class:"text-xs text-muted-foreground"},Wa={class:"w-20 h-2 bg-muted rounded-full overflow-hidden ml-3"},Ia={key:1},Ha={class:"space-y-2"},Ua={class:"flex-1"},Ga={class:"text-sm font-medium"},Va={class:"text-xs text-muted-foreground"},Qa={key:2,class:"flex items-center justify-center gap-3 p-4 rounded-lg bg-blue-50/50 border border-blue-200/50"},Ba={key:3,class:"text-center p-4 rounded-lg bg-muted/30"},mr=br({__name:"WritingStatistics",props:{showStatistics:{type:Boolean},currentWordCount:{},writingStats:{},qualityAnalysis:{},isAnalyzing:{type:Boolean}},setup(D){const S=D;A(()=>{if(!S.qualityAnalysis?.quality_level)return"text-muted-foreground";switch(S.qualityAnalysis.quality_level){case"Excellent":return"text-green-600";case"Good":return"text-blue-600";case"Satisfactory":return"text-yellow-600";case"Needs Improvement":return"text-orange-600";case"Poor":return"text-red-600";default:return"text-muted-foreground"}});const $=A(()=>S.qualityAnalysis?.scores?Object.entries(S.qualityAnalysis.scores).filter(([,h])=>h.max>0).filter(([,h])=>h.percentage<75).sort(([,h],[,d])=>h.percentage-d.percentage).map(([h,d])=>({category:h.replace(" & "," & "),percentage:Math.round(d.percentage),score:d.score,max:d.max,status:d.percentage<40?"poor":d.percentage<60?"needs-work":"fair"})):[]),F=A(()=>{const h=S.qualityAnalysis?.total_score||0;return h>=80?{text:"Excellent",color:"text-green-600",bgColor:"bg-green-50"}:h>=70?{text:"Satisfactory",color:"text-yellow-600",bgColor:"bg-yellow-50"}:h>=60?{text:"Needs Work",color:"text-orange-600",bgColor:"bg-orange-50"}:{text:"Poor",color:"text-red-600",bgColor:"bg-red-50"}});return(h,d)=>h.showStatistics?(y(),G(t(Tt),{key:0,class:"border border-border/50 bg-gradient-to-br from-card/80 to-card/60 backdrop-blur-sm shadow-lg"},{default:o(()=>[h.qualityAnalysis?(y(),G(t($t),{key:0,class:"pb-4 border-b border-border/50"},{default:o(()=>[r("div",$a,[r("div",qa,[r("div",Ra,[s(t(tt),{class:"h-4 w-4 text-blue-600"})]),r("div",null,[s(t(wr),{class:"text-sm font-semibold"},{default:o(()=>[...d[0]||(d[0]=[O("Academic Quality",-1)])]),_:1}),d[1]||(d[1]=r("p",{class:"text-xs text-muted-foreground"},"AI-powered analysis",-1))])]),r("div",Pa,[r("div",{class:le(["text-2xl font-bold",F.value.color])},[O(v(h.qualityAnalysis.total_score),1),d[2]||(d[2]=r("span",{class:"text-sm text-muted-foreground"},"/100",-1))],2),s(t(ke),{class:le([[F.value.color,F.value.bgColor],"text-xs font-medium"]),variant:"outline"},{default:o(()=>[O(v(F.value.text),1)]),_:1},8,["class"])])]),r("div",ja,[r("div",Ma,[d[3]||(d[3]=r("span",{class:"text-muted-foreground"},"Overall Score",-1)),r("span",{class:le(["font-medium",h.qualityAnalysis.meets_threshold?"text-green-600":"text-orange-600"])},v(h.qualityAnalysis.meets_threshold?"Meets threshold âœ“":"Below 80% threshold"),3)]),r("div",Da,[s(t(xr),{"model-value":Math.round(h.qualityAnalysis.total_score||0),class:le(["h-2",{"[&>[data-slot=progress-indicator]]:bg-green-500":(h.qualityAnalysis.total_score||0)>=80,"[&>[data-slot=progress-indicator]]:bg-yellow-500":(h.qualityAnalysis.total_score||0)>=70&&(h.qualityAnalysis.total_score||0)<80,"[&>[data-slot=progress-indicator]]:bg-orange-500":(h.qualityAnalysis.total_score||0)>=60&&(h.qualityAnalysis.total_score||0)<70,"[&>[data-slot=progress-indicator]]:bg-red-500":(h.qualityAnalysis.total_score||0)<60}])},null,8,["model-value","class"]),d[4]||(d[4]=r("div",{class:"absolute inset-0 flex items-center justify-center"},[r("div",{class:"w-0.5 h-4 bg-orange-400/60 rounded-full",style:{"margin-left":"80%"}})],-1))])])]),_:1})):de("",!0),s(t(At),{class:"p-4 space-y-4"},{default:o(()=>[h.qualityAnalysis?.scores?(y(),z("div",Fa,[d[5]||(d[5]=r("h4",{class:"text-xs font-semibold text-muted-foreground mb-3 flex items-center gap-2"},[r("div",{class:"w-1 h-4 bg-green-500 rounded-full"}),O(" Analysis Results ")],-1)),r("div",Na,[(y(!0),z(Et,null,kt(Object.entries(h.qualityAnalysis.scores).filter(([,w])=>w.max>0),([w,g])=>(y(),z("div",{key:w,class:"flex items-center justify-between p-3 rounded-lg bg-muted/30 hover:bg-muted/40 transition-colors"},[r("div",Oa,[r("div",La,v(w),1),r("div",za,[O(v(g.score)+"/"+v(g.max)+" points ",1),r("span",{class:le(["ml-1",{"text-red-500":g.percentage<50,"text-orange-500":g.percentage>=50&&g.percentage<75,"text-blue-500":g.percentage>=75&&g.percentage<90,"text-green-500":g.percentage>=90}])}," ("+v(Math.round(g.percentage))+"%) ",3)])]),r("div",Wa,[r("div",{class:le(["h-full transition-all duration-500 rounded-full",{"bg-red-500":g.percentage<50,"bg-orange-500":g.percentage>=50&&g.percentage<75,"bg-blue-500":g.percentage>=75&&g.percentage<90,"bg-green-500":g.percentage>=90}]),style:ze({width:`${g.percentage}%`})},null,6)])]))),128))])])):de("",!0),$.value.length>0?(y(),z("div",Ia,[d[6]||(d[6]=r("h4",{class:"text-xs font-semibold text-muted-foreground mb-3 flex items-center gap-2"},[r("div",{class:"w-1 h-4 bg-orange-500 rounded-full"}),O(" Focus Areas ")],-1)),r("div",Ha,[(y(!0),z(Et,null,kt($.value,w=>(y(),z("div",{key:w.category,class:"flex items-center gap-3 p-3 rounded-lg border border-orange-200/50 bg-orange-50/30"},[s(t(_a),{class:"h-4 w-4 text-orange-500 flex-shrink-0"}),r("div",Ua,[r("div",Ga,v(w.category),1),r("div",Va,[O(v(w.score)+"/"+v(w.max)+" points - ",1),r("span",{class:le({"text-red-600":w.status==="poor","text-orange-600":w.status==="needs-work","text-yellow-600":w.status==="fair"})},v(w.status==="poor"?"needs significant improvement":w.status==="needs-work"?"needs improvement":"fair, could be better"),3)])])]))),128))])])):de("",!0),h.isAnalyzing?(y(),z("div",Qa,[s(t(ya),{class:"h-4 w-4 text-blue-500 animate-pulse"}),d[7]||(d[7]=r("span",{class:"text-sm text-blue-700 font-medium"},"Analyzing academic quality with AI...",-1))])):de("",!0),!h.qualityAnalysis&&!h.isAnalyzing?(y(),z("div",Ba,[s(t(tt),{class:"h-8 w-8 text-muted-foreground mx-auto mb-2"}),d[8]||(d[8]=r("p",{class:"text-sm text-muted-foreground"},'Click "Analyze" to get AI-powered quality insights',-1))])):de("",!0)]),_:1})]),_:1})):de("",!0)}});function Ka(D){const{delay:S=1e4,onSave:$}=D,F=c(!1),h=c(!1),d=c(null),w=()=>{F.value=!0,d.value&&clearTimeout(d.value),d.value=setTimeout(()=>{g(!0)},S)},g=async(C=!1)=>{if(!h.value){h.value=!0;try{await $(C),F.value=!1,d.value&&(clearTimeout(d.value),d.value=null)}finally{h.value=!1}}};return{hasUnsavedChanges:F,isSaving:h,triggerAutoSave:w,save:g,clearAutoSave:()=>{d.value&&(clearTimeout(d.value),d.value=null)}}}function Ja(D){const S=c({sentences:0,paragraphs:0,readingTime:0,avgWordLength:0,uniqueWords:0,commonWords:[]}),$=A(()=>D.value?D.value.split(/\s+/).filter(d=>d.length>0).length:0),F=()=>{if(!D.value){S.value={sentences:0,paragraphs:0,readingTime:0,avgWordLength:0,uniqueWords:0,commonWords:[]};return}const d=D.value,w=d.split(/\s+/).filter(T=>T.length>0),g=d.split(/[.!?]+/).filter(T=>T.trim().length>0),l=d.split(`

`).filter(T=>T.trim().length>0),C=new Map;w.forEach(T=>{const p=T.toLowerCase().replace(/[^a-z0-9]/g,"");p&&C.set(p,(C.get(p)||0)+1)});const b=new Set(["the","a","an","and","or","but","in","on","at","to","for","of","with","by","is","was","are","were"]),L=Array.from(C.entries()).filter(([T])=>!b.has(T)).sort((T,p)=>p[1]-T[1]).slice(0,5).map(([T])=>T);S.value={sentences:g.length,paragraphs:l.length,readingTime:Math.ceil(w.length/200),avgWordLength:w.reduce((T,p)=>T+p.length,0)/w.length,uniqueWords:C.size,commonWords:L}},h=A(()=>{if(!D.value)return 0;let d=0;const w=D.value;w.includes("##")&&(d+=20),w.length>1e3&&(d+=20),w.match(/\[.*?\]/g)&&(d+=15),(w.includes("**")||w.includes("*"))&&(d+=10);const g=w.split(/[.!?]+/).filter(C=>C.trim().length>0);if(g.length>0){const C=g.reduce((b,L)=>b+L.split(/\s+/).length,0)/g.length;C>10&&C<25&&(d+=20)}return w.split(`

`).filter(C=>C.trim().length>0).length>3&&(d+=15),Math.min(d,100)});return{writingStats:S,currentWordCount:$,writingQualityScore:h,calculateWritingStats:F}}function Xa(D,S=c(3e3),$=.8){const F=i=>{if(!i)return 0;const U=i.replace(/<[^>]*>/g,"").trim().replace(/\s+/g," ");if(!U)return 0;const R=U.match(/\b\w+\b/g);return R?R.length:0},h=i=>i?i.replace(/<[^>]*>/g,"").replace(/\r\n|\r/g,`
`).trim().split(/\n\s*\n/).filter(j=>j.trim().length>0).length:0,d=i=>{if(!i)return 0;const U=i.replace(/<[^>]*>/g,"").match(/[.!?]+/g);return U?U.length:0},w=i=>Math.round(i/200*10)/10,g=A(()=>F(D.value)),l=A(()=>D.value.length),C=A(()=>D.value.replace(/\s/g,"").length),b=A(()=>h(D.value)),L=A(()=>d(D.value)),T=A(()=>w(g.value)),p=A(()=>{const i=S.value;return!i||i<=0?0:Math.min(g.value/i*100,100)}),q=A(()=>g.value>=S.value*$),V=A(()=>{const i=S.value-g.value;return Math.max(i,0)}),K=A(()=>{const i=S.value*$-g.value;return Math.max(i,0)}),X=A(()=>({wordCount:g.value,characterCount:l.value,characterCountNoSpaces:C.value,paragraphCount:b.value,sentenceCount:L.value,readingTimeMinutes:T.value})),ge=A(()=>({current:g.value,target:S.value,percentage:p.value,isComplete:q.value,completionThreshold:$})),ye=i=>i>=1e3?`${Math.round(i/100)/10}k`:i.toString(),ve=(i=0)=>`${Math.round(p.value*Math.pow(10,i))/Math.pow(10,i)}%`,he=()=>`${g.value} / ${S.value} words (${ve()}%)`,m=()=>{if(q.value)return`âœ… Complete (${ye(g.value)} words)`;const i=K.value;return`${ye(i)} more words to complete`},Q=()=>{const i=g.value,x=S.value;return i===0?"empty":i<x*.25?"started":i<x*.75?"progressing":i<x*$?"near_complete":i<x?"complete":"exceeded"},B=()=>{const i=Q();return{empty:"text-gray-500",started:"text-blue-500",progressing:"text-yellow-500",near_complete:"text-orange-500",complete:"text-green-500",exceeded:"text-emerald-600"}[i]},te=()=>{const i=Q();return{empty:"bg-gray-200",started:"bg-blue-200",progressing:"bg-yellow-200",near_complete:"bg-orange-200",complete:"bg-green-200",exceeded:"bg-emerald-200"}[i]},fe=800,Te=A(()=>g.value>=fe),M=A(()=>Math.max(fe-g.value,0)),k=A(()=>Math.min(g.value/fe*100,100));return{currentWordCount:g,characterCount:l,characterCountNoSpaces:C,paragraphCount:b,sentenceCount:L,readingTimeMinutes:T,progressPercentage:p,isComplete:q,wordsRemaining:V,wordsToComplete:K,wordCountStats:X,wordCountProgress:ge,meetsDefenseThreshold:Te,defenseWordsRemaining:M,defenseProgressPercentage:k,DEFENSE_THRESHOLD:fe,formatWordCount:ye,formatProgress:ve,getProgressDisplay:he,getCompletionDisplay:m,getWordCountStatus:Q,getStatusColor:B,getProgressBarColor:te,countWords:F}}function Ya(D,S,$,F){const d=c(!1),w=c(0),g=c(!1),l=m=>{if(!m)return 0;const B=m.replace(/<[^>]*>/g,"").trim().replace(/\s+/g," ");if(!B)return 0;const te=B.match(/\b\w+\b/g);return te?te.length:0},C=A(()=>l($.value)),b=A(()=>C.value>=800),L=()=>`defense_generation_triggered_${D.id}_ch_${S.chapter_number}`,T=()=>{const m=L();return localStorage.getItem(m)==="true"},p=()=>{const m=L();localStorage.removeItem(m),d.value=!1,console.log(`ðŸ”„ DEFENSE WATCHER: Reset generation trigger for Chapter ${S.chapter_number}`)},q=Aa(async()=>{if(!g.value)return;const m=C.value;console.log(`ðŸ“Š DEFENSE WATCHER: Word count check - Chapter ${S.chapter_number}: ${m} words`),m<800*.8&&d.value&&(console.log("â¬‡ï¸ DEFENSE WATCHER: Content dropped below 80% of threshold, resetting trigger"),p()),w.value=m},2e3),V=()=>g.value?void 0:(g.value=!0,d.value=T(),w.value=C.value,console.log(`ðŸ‘€ DEFENSE WATCHER: Started watching Chapter ${S.chapter_number}`),console.log(`   Initial word count: ${w.value}`),console.log(`   Generation already triggered: ${d.value}`),console.log("   Threshold: 800 words"),et($,(Q,B)=>{Q!==B&&q()},{immediate:!1})),K=()=>{g.value=!1,q.cancel(),console.log(`ðŸ›‘ DEFENSE WATCHER: Stopped watching Chapter ${S.chapter_number}`)},X=async()=>{console.log(`ðŸ” DEFENSE WATCHER: Force checking Chapter ${S.chapter_number}`),await q(),q.flush()},ge=A(()=>{const m=C.value;return m>0&&m<800&&!d.value}),ye=A(()=>{const m=C.value/800*100;return Math.min(m,100)}),ve=A(()=>{const m=800-C.value;return Math.max(m,0)});return{isWatching:g,hasTriggeredGeneration:d,currentWordCount:C,lastWordCount:w,meetsThreshold:b,shouldShowProgressIndicator:ge,progressPercentage:ye,wordsRemaining:ve,startWatching:V,stopWatching:K,forceCheck:X,resetGenerationTrigger:p,getStatusMessage:()=>{const m=C.value;return d.value?`Defense questions available (${m} words)`:m>=800?`Ready for defense questions (${m} words)`:m>0?`${800-m} more words needed for defense questions`:"Start writing to enable defense questions (800 words needed)"},countWords:l,DEFENSE_WORD_COUNT_THRESHOLD:800}}function Za(D){const S=c(!1),$=c(null),F=c([]),h=c(null),d=A(()=>{if(!$.value?.quality_level)return"text-muted-foreground";switch($.value.quality_level){case"Excellent":return"text-green-600";case"Good":return"text-blue-600";case"Satisfactory":return"text-yellow-600";case"Needs Improvement":return"text-orange-600";case"Poor":return"text-red-600";default:return"text-muted-foreground"}}),w=A(()=>$.value?.scores?Object.entries($.value.scores).sort(([,p],[,q])=>p.percentage-q.percentage).slice(0,3).map(([p,q])=>({category:p.replace(" & "," & "),percentage:Math.round(q.percentage),score:q.score,max:q.max})):[]),g=async()=>{try{S.value=!0,h.value=null,await xe.get("/sanctum/csrf-cookie");const p=await xe.post(oe("api.chapters.analysis.analyze",{chapter:D}));if(p.data.success)return $.value=p.data.analysis,p.data.analysis;throw new Error(p.data.error||"Analysis failed")}catch(p){return h.value=p.response?.data?.error||p.message||"Analysis failed",console.error("Chapter analysis failed:",p),null}finally{S.value=!1}};return{isAnalyzing:S,latestAnalysis:$,analysisHistory:F,error:h,qualityLevelColor:d,topImprovementAreas:w,analyzeChapter:g,getLatestAnalysis:async()=>{try{await xe.get("/sanctum/csrf-cookie");const p=await xe.get(oe("api.chapters.analysis.latest",{chapter:D}));return p.data.success?($.value=p.data.analysis,p.data.analysis):($.value=null,null)}catch(p){return p.response?.status!==404&&(h.value=p.response?.data?.error||p.message||"Failed to get analysis",console.error("Failed to get latest analysis:",p)),null}},getAnalysisHistory:async()=>{try{await xe.get("/sanctum/csrf-cookie");const p=await xe.get(oe("api.chapters.analysis.history",{chapter:D}));if(p.data.success)return F.value=p.data.analyses,p.data.analyses;throw new Error(p.data.error||"Failed to get history")}catch(p){return h.value=p.response?.data?.error||p.message||"Failed to get analysis history",console.error("Failed to get analysis history:",p),[]}},autoAnalyze:async(p,q=500)=>{p>=q&&await g()},getScoreColor:(p,q)=>{const V=p/q*100;return V>=80?"text-green-600":V>=70?"text-blue-600":V>=60?"text-yellow-600":V>=40?"text-orange-600":"text-red-600"},getProgressVariant:p=>p>=80?"success":p>=60?"default":"destructive"}}const es={key:2,class:"flex h-screen flex-col overflow-hidden bg-zinc-50 dark:bg-zinc-950 font-sans selection:bg-primary/20"},ts={class:"relative z-20 flex flex-shrink-0 items-center justify-between border-b border-border/40 bg-background/60 p-4 backdrop-blur-xl supports-[backdrop-filter]:bg-background/40 transition-all duration-300"},rs={class:"flex items-center gap-5"},as={class:"flex flex-col"},ss={class:"flex items-center gap-3 text-xs text-muted-foreground"},ns={class:"flex items-center gap-1.5"},os={class:"flex items-center gap-4"},ls={class:"flex items-center p-1 rounded-full border border-border/40 bg-background/50 backdrop-blur-sm shadow-sm"},is={class:"flex items-center gap-2"},us={class:"relative z-20 h-[2px] w-full bg-border/20"},cs={key:0,class:"mx-3 my-2"},ds={class:"relative overflow-hidden rounded-xl border border-blue-200 bg-gradient-to-br from-blue-50 to-purple-50 p-3 shadow-sm dark:border-blue-800 dark:from-blue-950/30 dark:to-purple-950/30"},ps={class:"relative z-10 mb-2 flex items-center justify-between"},gs={class:"flex items-center gap-2"},vs={class:"relative"},hs={class:"flex h-6 w-6 items-center justify-center rounded-full bg-gradient-to-br from-blue-500 to-purple-600"},fs={class:"text-xs text-blue-700 dark:text-blue-300"},ms={class:"relative z-10 mb-2"},bs={class:"mb-1 flex items-center justify-between"},ws={class:"text-xs text-blue-600 dark:text-blue-400"},xs={class:"relative h-2 overflow-hidden rounded-full bg-blue-100 dark:bg-blue-900/50"},ys={class:"relative z-10 flex items-center gap-2"},_s={class:"flex-shrink-0"},Cs={key:0,class:"h-2 w-2 animate-bounce rounded-full bg-blue-500"},Ss={key:1,class:"flex gap-0.5"},Es={key:2,class:"h-2 w-2 animate-spin rounded-full border-2 border-blue-500 border-t-transparent"},ks={key:3,class:"h-2 w-2 rounded-full bg-green-500"},Ts={key:4,class:"h-2 w-2 rounded-full bg-red-500"},As={class:"flex-1 text-xs text-blue-800 dark:text-blue-200"},$s={class:"relative z-10 flex flex-1 overflow-hidden"},qs={key:0,class:"w-[320px] flex-shrink-0 border-r border-border/50 bg-background/80 backdrop-blur-xl shadow-xl z-20"},Rs={class:"h-full overflow-y-auto custom-scrollbar"},Ps={class:"p-4"},js={class:"mb-3"},Ms={class:"text-xs text-muted-foreground"},Ds={class:"flex min-h-0 flex-1 flex-col bg-transparent relative"},Fs={class:"flex-1 overflow-hidden relative"},Ns={class:"absolute inset-0 overflow-y-auto custom-scrollbar flex flex-col items-center py-8 px-4 sm:px-8"},Os={class:"flex items-center justify-between"},Ls={class:"space-y-1"},zs={class:"flex items-center gap-2"},Ws={class:"flex items-center justify-between px-6 py-2 border-b border-border/30 bg-muted/5"},Is={class:"flex items-center gap-2"},Hs={class:"space-y-1 relative z-10"},Us={class:"text-sm font-medium text-foreground"},Gs={class:"text-[10px] text-muted-foreground line-clamp-2 leading-relaxed"},Vs={class:"flex-1 relative bg-background"},Qs={class:"px-12 py-10 min-h-[500px]"},Bs={class:"sticky bottom-0 z-10 border-t border-border/30 bg-background/80 backdrop-blur-md p-4 flex items-center justify-between"},Ks={class:"text-xs text-muted-foreground"},Js={class:"flex items-center gap-2"},Xs={key:0,class:"w-72 flex-shrink-0 border-l border-border/40 bg-background/40 backdrop-blur-md"},Ys={class:"h-full overflow-y-auto custom-scrollbar"},Zs={class:"space-y-6 p-4"},en={class:"min-h-screen bg-gradient-to-br from-background via-background to-muted/20"},tn={class:"w-full px-4 py-6 transition-all duration-300"},rn={class:"mb-6 flex items-center justify-between"},an={class:"flex items-center gap-4"},sn={class:"text-sm text-muted-foreground"},nn={class:"flex items-center gap-2"},on={class:"hidden items-center gap-2 lg:flex"},ln={class:"mb-6"},un={class:"mb-2 flex items-center justify-between"},cn={class:"text-sm text-muted-foreground"},dn={key:0,class:"mb-6"},pn={class:"relative overflow-hidden rounded-xl border border-blue-200 bg-gradient-to-br from-blue-50 to-purple-50 p-4 shadow-sm dark:border-blue-800 dark:from-blue-950/30 dark:to-purple-950/30"},gn={class:"relative z-10 mb-3 flex items-center justify-between"},vn={class:"flex items-center gap-2"},hn={class:"relative"},fn={class:"flex h-8 w-8 items-center justify-center rounded-full bg-gradient-to-br from-blue-500 to-purple-600"},mn={class:"text-xs text-blue-700 dark:text-blue-300"},bn={class:"relative z-10 mb-3"},wn={class:"mb-1 flex items-center justify-between"},xn={class:"text-xs text-blue-600 dark:text-blue-400"},yn={class:"relative h-2 overflow-hidden rounded-full bg-blue-100 dark:bg-blue-900/50"},_n={class:"relative z-10 flex items-center gap-2"},Cn={class:"flex-shrink-0"},Sn={key:0,class:"h-3 w-3 animate-bounce rounded-full bg-blue-500"},En={key:1,class:"flex gap-1"},kn={key:2,class:"h-3 w-3 animate-spin rounded-full border-2 border-blue-500 border-t-transparent"},Tn={key:3,class:"h-3 w-3 rounded-full bg-green-500"},An={key:4,class:"h-3 w-3 rounded-full bg-red-500"},$n={class:"flex-1 text-xs text-blue-800 dark:text-blue-200"},qn={key:0,class:"relative z-10 mt-3 border-t border-blue-200 pt-3 dark:border-blue-800"},Rn={class:"flex items-center justify-between text-xs"},Pn={class:"flex items-center gap-1"},jn={class:"flex gap-0.5"},Mn={class:"ml-1 text-blue-600 dark:text-blue-400"},Dn={class:"grid grid-cols-1 gap-6 lg:grid-cols-12 transition-all duration-300"},Fn={class:"hidden lg:block lg:col-span-2 transition-all duration-300"},Nn={class:"h-[calc(100vh-320px)] overflow-y-auto space-y-6 custom-scrollbar pr-1"},On={class:"flex items-center justify-between"},Ln={class:"flex items-center gap-2"},zn={class:"flex items-center gap-2"},Wn={class:"space-y-2"},In={class:"space-y-2"},Hn={class:"flex items-center justify-between"},Un={class:"flex items-center gap-2"},Gn={class:"flex flex-col gap-2 pt-4 sm:flex-row"},Vn={class:"hidden sm:inline"},Qn={class:"sm:hidden"},Bn={class:"hidden sm:inline"},Kn={class:"sm:hidden"},Jn={class:"hidden sm:inline"},Xn={class:"sm:hidden"},Yn={class:"hidden lg:block lg:col-span-3 transition-all duration-300"},Zn={class:"h-[calc(100vh-40px)] overflow-y-auto space-y-4 custom-scrollbar px-1"},eo=1e3,ll=br({__name:"ChapterEditor",props:{project:{},chapter:{},allChapters:{},facultyChapters:{},mode:{}},setup(D){const S=Re(()=>Pe(()=>import("./AISidebar-DdhoeboQ.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54]))),$=Re(()=>Pe(()=>import("./ChapterNavigation-CIKJlAYo.js"),__vite__mapDeps([55,56,3,1,2,20,21,11,7,8,12,22,23,24,25,14,26,27,19,28,29,30,31,32,33,18,4,34,35,36,37,38,39,9,10,13,15,16,40,41,42,43,44,57,58,59,60,61,47]))),F=Re(()=>Pe(()=>import("./MobileNavOverlay-DRvJvV8X.js"),__vite__mapDeps([62,1,2,63,3,0,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,56,57,58,59,60,61,64,65,66,67,68,69]))),h=Re(()=>Pe(()=>import("./ChatModeLayout-CNUxHx7b.js"),__vite__mapDeps([70,71,1,2,18,3,8,4,11,7,12,20,21,22,23,24,25,14,26,27,19,28,29,30,31,32,33,34,35,36,37,38,39,9,10,13,15,16,40,41,42,43,63,72,67,47,46,73,74,58,75,76,51,77,65,61,50,49,53,48,59,78,79,80,81]))),d=Re(()=>Pe(()=>import("./CitationVerificationLayout-DrnUuXEn.js"),__vite__mapDeps([82,18,3,1,2,8,4,5,11,7,12,20,21,22,23,24,25,14,26,27,19,28,29,30,31,32,33,34,35,36,37,38,39,9,10,13,15,16,40,41,42,43,72,59]))),w=Re(()=>Pe(()=>import("./DefensePreparationPanel-CekOMUzj.js"),__vite__mapDeps([83,64,1,2,63,3,18,8,4,5,6,7,11,12,20,21,22,23,24,25,14,26,27,19,28,29,30,31,32,33,34,35,36,37,38,39,9,10,13,15,16,40,41,42,43,65,66,45,52,67]))),g=Re(()=>Pe(()=>import("./DataCollectionPanel-7FpJbbLe.js"),__vite__mapDeps([84,68,1,2,13,3,14,8,7,15,16]))),l=D,C=c(l.chapter.title||""),b=c(l.chapter.content||""),L=c(!0),T=c(!1),p=c(!1);c(!1);const q=c(!1);c("write");const V=c("");c(0);const K=c(!1),X=c(!1),ge=c(!0),ye=()=>{try{return localStorage.getItem(`chatMode_${l.project.id}_${l.chapter.chapter_number}`)==="true"}catch(a){return console.warn("Failed to load chat mode from localStorage:",a),!1}},ve=a=>{try{localStorage.setItem(`chatMode_${l.project.id}_${l.chapter.chapter_number}`,String(a))}catch(e){console.warn("Failed to save chat mode to localStorage:",e)}},he=c(!1),m=c(!1),Q=c(!1),B=c(!1),te=c(!1),fe=c(!0),Te=c(!0),M=c(!1),k=c(""),i=c(0),x=c(""),U=c(0),R=c(0),j=c(null),N=c(""),rt=c(0),pt=c(""),qt=c([]),We=c(!1),Ae=c(!1),{balance:yr,showPurchaseModal:Rt,requiredWordsForModal:_r,actionDescriptionForModal:Cr,checkAndPrompt:Sr,closePurchaseModal:Er,estimates:Se}=ma(),je=(a,e)=>Sr(Math.max(1,Math.round(a)),e),Ie=c(!1),Me=c(""),De=c(""),kr=c(0),$e=c(null),Tr=c(0),Ar=c(null),$r=c([]),qr=c([]),Rr=c(null);c(null),c(null);const Pr=c(),Pt=c(),jr=c(),jt=c();c(null),c(null);const Y=c(!1),{hasUnsavedChanges:Mr,isSaving:Fe,triggerAutoSave:He,save:me,clearAutoSave:Dr}=Ka({delay:1e4,onSave:Ft});let Mt=0;const Fr=()=>{const a=Date.now();a-Mt>eo&&(Mt=a,E.success("Saved",{duration:2e3}))},{contentHistory:Nr,historyIndex:Or,addToHistory:Lr,undo:zr,redo:Wr}=da(l.chapter.content||""),{writingStats:gt,writingQualityScore:_e,calculateWritingStats:at}=Ja(b),{isAnalyzing:Ee,latestAnalysis:J,analyzeChapter:st,getLatestAnalysis:Ir}=Za(l.chapter.id),re=A(()=>{if(l.facultyChapters&&l.facultyChapters.length>0){const e=l.facultyChapters.find(n=>n.number===l.chapter.chapter_number);if(e?.word_count)return e.word_count}if(l.project?.outlines&&l.project.outlines.length>0){const e=l.project.outlines.find(n=>n.chapter_number===l.chapter.chapter_number);if(e?.target_word_count)return e.target_word_count}const a=l.project.type==="undergraduate"?2500:3500;return l.chapter.chapter_number===1||l.chapter.chapter_number===5?Math.round(a*.8):a}),{currentWordCount:I,progressPercentage:Hr,meetsDefenseThreshold:Ur,defenseWordsRemaining:Gr,defenseProgressPercentage:Vr,DEFENSE_THRESHOLD:nt,countWords:Dt}=Xa(b,re),Ue=Hr,Ge=A(()=>{const a=C.value?.trim(),e=b.value?.trim();return a&&a.length>0&&e&&e.length>50}),be=A(()=>l.project),we=A(()=>l.chapter),qe=A(()=>l.allChapters);async function Ft(a=!1){try{const e=await fetch(oe("chapters.save",{project:l.project.id}),{method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json","X-Requested-With":"XMLHttpRequest","X-CSRF-TOKEN":document.querySelector('meta[name="csrf-token"]')?.getAttribute("content")||""},body:JSON.stringify({project_id:l.project.id,chapter_number:l.chapter.chapter_number,title:C.value,content:b.value,auto_save:a,statistics:gt.value,quality_score:_e.value})});console.log("Response status:",e.status,e.statusText),console.log("Response headers:",e.headers);const n=await e.text();console.log("Raw response:",n);let u;try{u=JSON.parse(n)}catch(f){throw console.error("JSON parse error:",f),console.error("Response was:",n),new Error(`Server returned non-JSON response: ${e.status} ${e.statusText}`)}e.ok}catch(e){throw a||E.error("âŒ Save Failed",{description:"Please try again or check your connection."}),e}}const Nt=()=>{const a=zr();a!==null&&(b.value=a,He())},Ot=()=>{const a=Wr();a!==null&&(b.value=a,He())},Ve=a=>{Mr.value&&confirm("You have unsaved changes. Save before switching chapters?")&&me();const e=l.allChapters.find(f=>f.chapter_number===a),u=e?.content&&e.content.trim()!==""?"chapters.edit":"chapters.write";ut.visit(oe(u,{project:l.project.slug,chapter:a}),{only:["chapter","mode","allChapters"],preserveState:!0,preserveScroll:!1})},vt=async()=>{const a=Se.chapter(re.value||0);if(!je(a,"generate the next chapter with AI"))return;await me();const e=l.allChapters.map(f=>f.chapter_number).sort((f,_)=>f-_),n=e.indexOf(l.chapter.chapter_number);let u;if(n===-1||n===e.length-1)u=Math.max(...e)+1;else{const f=e[n+1];f===l.chapter.chapter_number+1?u=f:u=l.chapter.chapter_number+1}console.log("ðŸ“ Generating next chapter:",{currentChapter:l.chapter.chapter_number,existingChapters:e,nextChapterNumber:u});try{const f=oe("chapters.write",{project:l.project.slug,chapter:u});console.log("ðŸ”— Generated URL for next chapter:",f);const _=new URL(f,window.location.origin);_.searchParams.set("ai_generate","true"),_.searchParams.set("generation_type","progressive"),console.log("ðŸš€ Navigating to:",_.toString()),ut.visit(_.toString())}catch(f){console.error("âŒ Error generating next chapter:",f),E.error("Navigation Error",{description:"Failed to navigate to next chapter. Please try again."})}},ht=(a,e)=>{a==="section"&&e?.section?Qr(e.section):a==="rephrase"&&e?.selectedText?Br(e.selectedText,e.style||"Academic Formal"):a==="expand"&&e?.selectedText?Kr(e.selectedText):ft(a)},Qr=async a=>{M.value=!0,N.value="",R.value=0,i.value=5,x.value="Papers",k.value="Checking for verified sources...",U.value=600,pt.value=b.value||l.chapter.content||"",Y.value=!0;try{i.value=50,x.value="Papers",k.value="Using existing verified sources...",await new Promise(n=>setTimeout(n,500)),x.value="Section",k.value=`Generating ${a} section with verified sources...`,i.value=51;const e=oe("chapters.stream",{project:l.project.slug,chapter:l.chapter.chapter_number});j.value=new EventSource(`${e}?generation_type=section&section_type=${a}`),j.value.onmessage=n=>{const u=JSON.parse(n.data);switch(u.type){case"start":x.value="Generating Section",i.value=52,k.value=`Starting ${a} section generation...`;break;case"content":N.value+=u.content,R.value=u.word_count||Dt(N.value);const f=Date.now();if(f-rt.value>150){const P=N.value;b.value=pt.value+`

`+P,rt.value=f;const Z=Math.min(R.value/U.value*43,43);i.value=Math.max(52,52+Z),k.value=`Generating ${a} section... (${R.value} / ${U.value} words)`,at(),Ut()}break;case"complete":i.value=100,x.value="Complete",k.value=`âœ“ Generated ${a} section (${R.value} words)`;const _=N.value;b.value=pt.value+`

`+_,me(!0),E.success("âœ… Section Generated Successfully",{description:`Added ${a} section with ${R.value} words and verified citations.`,duration:5e3}),M.value=!1,j.value?.close();break;case"error":throw new Error(u.message||"Section generation failed");case"heartbeat":i.value<95&&(i.value+=.5);break}},j.value.onerror=()=>{M.value=!1,x.value="Error",k.value="âŒ Section generation failed",E.error("âŒ Generation Failed",{description:"Unable to generate section. Please check your connection and try again."}),j.value?.close()}}catch(e){console.error("Section generation failed:",e),M.value=!1,x.value="Error",k.value="âŒ Section generation error",E.error("âŒ Generation Failed",{description:"Section generation encountered an error."})}},Br=async(a,e)=>{const n=a.split(/\s+/).length,u=Math.max(n,Se.rephrase());if(!je(u,`rephrase about ${n} words`))return;console.log("ðŸš€ ChapterEditor - Starting rephrase generation:",{selectedTextLength:a.length,selectedTextPreview:a.substring(0,100)+(a.length>100?"...":""),style:e,timestamp:new Date().toISOString()}),M.value=!0,N.value="",R.value=0,i.value=10,x.value="Rephrasing",k.value="Preparing to rephrase selected text...",U.value=Math.max(n,50);const f=Qe.value||ot.value,_=f?.getSelectionRange();console.log("ðŸ“ ChapterEditor - Editor and selection info:",{hasActiveEditor:!!f,selectionRange:_,selectedWordCount:n,estimatedWords:U.value});const P={originalText:a,range:_,wordCount:n,style:e,startTime:Date.now()};console.log("ðŸ’¾ ChapterEditor - Stored rephrase context:",P),Y.value=!0;try{i.value=20,k.value=`Rephrasing ${n} words in ${e} style...`;const ce=`${oe("chapters.stream",{project:l.project.slug,chapter:l.chapter.chapter_number})}?generation_type=rephrase&selected_text=${encodeURIComponent(a)}&style=${encodeURIComponent(e)}`;console.log("ðŸŒ ChapterEditor - Creating EventSource:",{url:ce,encodedTextLength:encodeURIComponent(a).length}),j.value=new EventSource(ce),j.value.onmessage=H=>{const ee=JSON.parse(H.data);switch(console.log("ðŸ“¨ ChapterEditor - EventSource message received:",{type:ee.type,hasContent:!!ee.content,contentLength:ee.content?.length||0,wordCount:ee.word_count}),ee.type){case"start":console.log("â–¶ï¸ ChapterEditor - Rephrase generation started"),x.value="Rephrasing Text",i.value=30,k.value=`Rephrasing text in ${e} style...`;break;case"content":N.value+=ee.content,R.value=ee.word_count||Dt(N.value),console.log("ðŸ“ ChapterEditor - Content chunk received:",{chunkLength:ee.content?.length||0,totalBufferLength:N.value.length,totalWords:R.value});const pe=Math.min(R.value/U.value*60,60);i.value=Math.max(30,30+pe),k.value=`Rephrasing... (${R.value} words)`;break;case"complete":if(console.log("ðŸ ChapterEditor - Rephrase generation complete"),i.value=100,x.value="Complete",k.value=`âœ“ Text rephrased successfully (${R.value} words)`,console.log("ðŸ”„ ChapterEditor - Starting text replacement:",{hasRange:!!P.range,hasContent:!!N.value.trim(),range:P.range,newContentLength:N.value.trim().length,newContentPreview:N.value.trim().substring(0,100)+"..."}),P.range&&N.value.trim()){console.log("ðŸŽ¯ ChapterEditor - Attempting text replacement with activeEditor:",{editorType:f===Qe.value?"fullscreen":"normal",hasActiveEditor:!!f});const Ce=f?.replaceSelection(N.value.trim(),P.range);console.log("ðŸ“Š ChapterEditor - Text replacement result:",{success:Ce}),Ce?(console.log("âœ… ChapterEditor - Text replacement successful, updating chapter content"),setTimeout(()=>{const Ye=f?.getHTML()||b.value;console.log("ðŸ“„ ChapterEditor - Updated chapter content length:",Ye.length),b.value=Ye},100)):(console.warn("âŒ ChapterEditor - Failed to replace selected text, falling back to manual update"),E.warning("Please manually replace the selected text",{description:"The rephrased text is ready but couldn't be automatically replaced."}))}else console.error("âŒ ChapterEditor - Cannot replace text:",{missingRange:!P.range,missingContent:!N.value.trim()});me(!0),E.success("âœ… Text Rephrased Successfully",{description:`Rephrased ${n} words in ${e} style.`,duration:5e3}),Ze(R.value||n,`Rephrase (${e})`,"chapter",l.chapter.id).catch(Ce=>console.error("Failed to record word usage (rephrase):",Ce)),M.value=!1,j.value?.close();break;case"error":throw new Error(ee.message||"Text rephrasing failed");case"heartbeat":i.value<95&&(i.value+=.5);break}},j.value.onerror=()=>{M.value=!1,x.value="Error",k.value="âŒ Text rephrasing failed",E.error("âŒ Rephrasing Failed",{description:"Unable to rephrase text. Please check your connection and try again."}),j.value?.close()}}catch(Z){console.error("Text rephrasing failed:",Z),M.value=!1,x.value="Error",k.value="âŒ Rephrasing error",E.error("âŒ Rephrasing Failed",{description:"Text rephrasing encountered an error."})}},Kr=async a=>{const e=a.split(/\s+/).length,n=Math.max(e*2,Se.expand());if(!je(n,`expand about ${e} words`))return;console.log("ðŸ“ˆ ChapterEditor - Starting expand generation:",{selectedTextLength:a.length,selectedTextPreview:a.substring(0,100)+(a.length>100?"...":""),timestamp:new Date().toISOString()}),M.value=!0,N.value="",R.value=0,i.value=10,x.value="Expanding",k.value="Preparing to expand selected text...",U.value=Math.max(e*2,100);const u=Qe.value||ot.value,f=u?.getSelectionRange();console.log("ðŸ“ ChapterEditor - Editor and selection info for expand:",{hasActiveEditor:!!u,selectionRange:f,selectedWordCount:e,estimatedWords:U.value});const _={originalText:a,range:f,wordCount:e,startTime:Date.now()};console.log("ðŸ’¾ ChapterEditor - Stored expand context:",_);try{const Z=`${oe("chapters.stream",{project:l.project.slug,chapter:l.chapter.chapter_number})}?generation_type=expand&selected_text=${encodeURIComponent(a)}`;console.log("ðŸŒ ChapterEditor - Creating EventSource for expand:",{url:Z,encodedTextLength:encodeURIComponent(a).length}),j.value=new EventSource(Z),j.value.onmessage=ce=>{const H=JSON.parse(ce.data);switch(console.log("ðŸ“¨ ChapterEditor - EventSource message received:",{type:H.type,hasContent:!!H.content,contentLength:H.content?.length||0,wordCount:H.word_count}),H.type){case"start":console.log("â–¶ï¸ ChapterEditor - Expand generation started"),x.value="Expanding Text",i.value=20,k.value="Starting text expansion...";break;case"content":N.value+=H.content,R.value=H.word_count||N.value.split(/\s+/).filter(pe=>pe.length>0).length;const ee=Math.min(R.value/U.value*90,90);i.value=Math.max(ee,25),k.value=`Expanding text... ${R.value}/${U.value} words`,console.log("ðŸ“ ChapterEditor - Expand content received:",{chunkLength:H.content?.length||0,totalWords:R.value,progress:i.value});break;case"complete":if(console.log("âœ… ChapterEditor - Expand generation complete"),x.value="Complete",k.value="âœ… Text expansion completed",i.value=100,_.range&&N.value.trim()){console.log("ðŸŽ¯ ChapterEditor - Attempting text replacement for expand");const pe=u?.replaceSelection(N.value.trim(),_.range);console.log("ðŸ“Š ChapterEditor - Expand text replacement result:",{success:pe}),pe?(console.log("âœ… ChapterEditor - Expand text replacement successful"),setTimeout(()=>{const Ce=u?.getHTML()||b.value;console.log("ðŸ“„ ChapterEditor - Updated chapter content length after expand:",Ce.length),b.value=Ce},100)):(console.warn("âŒ ChapterEditor - Failed to replace expanded text"),E.warning("Please manually replace the selected text",{description:"The expanded text is ready but couldn't be automatically replaced."}))}else console.error("âŒ ChapterEditor - Cannot replace expanded text:",{missingRange:!_.range,missingContent:!N.value.trim()});me(!0),E.success("âœ… Text Expanded Successfully",{description:`Expanded ${_.wordCount} words into ${R.value} words`}),Ze(R.value||_.wordCount*2,"Expand text","chapter",l.chapter.id).catch(pe=>console.error("Failed to record word usage (expand):",pe)),M.value=!1,j.value?.close();break;case"error":console.error("âŒ ChapterEditor - Expand generation error:",H.message),M.value=!1,x.value="Error",k.value="âŒ Text expansion failed",E.error("âŒ Expansion Failed",{description:H.message||"Text expansion encountered an error."}),j.value?.close();break}},j.value.onerror=()=>{console.error("âŒ ChapterEditor - Expand stream error occurred"),M.value=!1,x.value="Error",k.value="âŒ Text expansion failed",E.error("âŒ Expansion Failed",{description:"Unable to expand text. Please check your connection and try again."}),j.value?.close()}}catch(P){console.error("Text expansion failed:",P),M.value=!1,x.value="Error",k.value="âŒ Expansion error",E.error("âŒ Expansion Failed",{description:"Text expansion encountered an error."})}},Jr=async()=>{Ie.value=!0,De.value="Starting",Me.value="Initializing source collection...",i.value=5;try{const a=document.querySelector('meta[name="csrf-token"]')?.content;if(!a)throw new Error("CSRF token not found - please refresh the page");const e=await fetch(oe("api.projects.paper-collection.start",{project:l.project.slug}),{method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json","X-CSRF-TOKEN":a,"X-Requested-With":"XMLHttpRequest"},credentials:"include"});if(!e.ok){const n=await e.text();if(console.error("API Error:",e.status,n),e.status===409)try{const u=JSON.parse(n);throw new Error(u.message||"Source collection is already in progress")}catch{throw new Error("Source collection is already in progress for this project")}throw new Error(`Failed to start source collection: ${e.status}`)}return await Xr()}catch(a){return console.error("Paper collection failed:",a),De.value="Error",Me.value="âŒ Source collection failed",Ie.value=!1,!1}},Xr=async()=>new Promise(a=>{let e=0;const n=120,u=async()=>{try{const _=await(await fetch(oe("api.projects.paper-collection.status",{project:l.project.slug}))).json();if(_.success&&_.data){Rr.value=_.data;const P=_.data.status,Z=_.data.papers_count||_.data.count||0,ce=_.data.message,H=_.data.percentage||0,ee=_.data.current_source,pe=_.data.sources_completed||[],Ce=_.data.papers_preview||[];if(kr.value=Z,Tr.value=H,Ar.value=ee,$r.value=pe,qr.value=Ce,P==="completed"){De.value="Complete",Me.value=`âœ“ Collected ${Z} verified sources from ${pe.length} databases`,i.value=50,Ie.value=!1,$e.value&&clearInterval($e.value),a(!0);return}else if(P==="collecting_papers"||P==="initializing"||P==="processing"||P==="storing"){let Ye="";ee&&(Ye={semantic_scholar:"Semantic Scholar",openalex:"OpenAlex",crossref:"CrossRef",pubmed:"PubMed"}[ee]||ee),De.value=Ye||"Collecting Sources",Me.value=ce||"Collecting sources from academic databases...",i.value=Math.min(5+H*.4,45)}else if(P==="collection_failed"){De.value="Error",Me.value=ce||"âŒ Source collection failed",Ie.value=!1,$e.value&&clearInterval($e.value),a(!1);return}}e++,e>=n&&(De.value="Timeout",Me.value="â±ï¸ Source collection timed out",Ie.value=!1,$e.value&&clearInterval($e.value),a(!1))}catch(f){console.error("Error checking paper collection status:",f),e++}};u(),$e.value=setInterval(u,5e3)}),ft=async a=>{const e=Se.chapter(re.value||0);if(!je(e,"generate this chapter with AI"))return;if(M.value=!0,N.value="",R.value=0,i.value=5,x.value="Papers",k.value="Checking for verified sources...",U.value=re.value,Y.value=!0,!await Jr()){E.error("Paper Collection Failed",{description:"Unable to collect verified papers. Please try again."}),M.value=!1,Y.value=!1;return}x.value="Initializing",k.value="Starting AI generation with verified sources...",i.value=51;const u=setInterval(()=>{i.value<52&&M.value?i.value+=.2:clearInterval(u)},100),f=oe("chapters.stream",{project:l.project.slug,chapter:l.chapter.chapter_number});j.value=new EventSource(`${f}?generation_type=${a}`),j.value.onmessage=_=>{const P=JSON.parse(_.data);switch(P.type){case"start":x.value="Connecting",i.value=52,k.value="Connecting to AI service...";break;case"content":x.value="Generating",N.value+=P.content,R.value=P.word_count||N.value.split(/\s+/).filter(H=>H.length>0).length;const Z=Date.now();if(Z-rt.value>150){b.value=N.value,rt.value=Z;const H=Math.min(R.value/U.value*43,43);i.value=Math.max(52,52+H),k.value=`Generating chapter content... (${R.value} / ${U.value} words)`,at(),Ut()}break;case"heartbeat":i.value<95&&(i.value+=.5);break;case"complete":x.value="Complete",i.value=100,M.value=!1,b.value=N.value;const ce=P.final_word_count||R.value;k.value=`âœ“ Generated ${ce} words successfully`,Ze(ce,`Chapter generation (${l.chapter.chapter_number})`,"chapter",l.chapter.id).catch(H=>console.error("Failed to record word usage (chapter generation):",H)),setTimeout(()=>{He()},500),j.value?.close(),j.value=null;break;case"error":x.value="Error",i.value=50,M.value=!1,P.code==="OFFLINE_MODE"?(k.value="ðŸ“¡ AI services offline",E.error("AI Services Offline",{description:"Please check your internet connection and try again."})):(k.value="âŒ Generation failed",E.error("Generation Error",{description:P.message||"Please try again."})),j.value?.close(),j.value=null;break}},j.value.onerror=()=>{x.value="Error",i.value=50,M.value=!1,k.value="âŒ Connection error",E.error("Connection Error",{description:"Please check your internet connection and try again."}),j.value?.close(),j.value=null}},mt=async()=>{if(!V.value)return;const a=Se.suggestion();if(je(a,"get AI suggestions")){We.value=!0;try{const n=await(await fetch(oe("chapters.suggestions",{project:l.project.slug,chapter:l.chapter.chapter_number}),{method:"POST",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":document.querySelector('meta[name="csrf-token"]')?.getAttribute("content")||""},body:JSON.stringify({selected_text:V.value,context:b.value})})).json();qt.value=n.suggestions||[],qt.value.length&&Ze(Se.suggestion(),"AI suggestions","chapter",l.chapter.id).catch(u=>console.error("Failed to record word usage (suggestions):",u))}catch{E.error("Error getting suggestions",{description:"Please try again."})}finally{We.value=!1}}},bt=()=>{Ae.value=!0,E.success("Citation Manager opened!",{description:"Review and verify your citations in the panel below."})},Lt=a=>{try{const e=Qe.value?.editor||ot.value?.editor;if(!e){E.error("Editor not found");return}const{from:n}=e.state.selection;e.chain().focus().insertContentAt(n,` ${a} `).run(),E.success("Citation inserted successfully")}catch(e){console.error("Failed to insert citation:",e),E.error("Failed to insert citation")}},ot=c(null),Qe=c(null),Yr=async()=>{try{const a=document.documentElement;a.requestFullscreen?await a.requestFullscreen():a.webkitRequestFullscreen?await a.webkitRequestFullscreen():a.msRequestFullscreen&&await a.msRequestFullscreen()}catch(a){console.error("Error entering fullscreen:",a),E.error("Fullscreen Error",{description:"Unable to enter fullscreen mode"})}},Zr=async()=>{try{document.exitFullscreen?await document.exitFullscreen():document.webkitExitFullscreen?await document.webkitExitFullscreen():document.msExitFullscreen&&await document.msExitFullscreen()}catch(a){console.error("Error exiting fullscreen:",a),E.error("Fullscreen Error",{description:"Unable to exit fullscreen mode"})}},zt=async()=>{p.value?await Zr():await Yr()},Ne=()=>{const a=document.fullscreenElement||document.webkitFullscreenElement||document.msFullscreenElement;p.value=!!a},Wt=()=>{T.value=!T.value,document.documentElement.classList.toggle("dark",T.value),localStorage.setItem("darkMode",T.value.toString())},ea=()=>{K.value=!K.value,K.value&&(X.value=!1),ve(K.value)},ta=()=>{K.value=!1,ve(!1)},ra=()=>{X.value=!X.value,X.value&&(K.value=!1,ve(!1))},aa=()=>{X.value=!1},It=()=>{Y.value=!Y.value},sa=()=>{Lr(b.value),He(),at()},Ht=a=>{(a.ctrlKey||a.metaKey)&&a.key==="s"&&(a.preventDefault(),me(),Fr()),(a.ctrlKey||a.metaKey)&&!a.shiftKey&&a.key==="z"&&(a.preventDefault(),Nt()),(a.ctrlKey||a.metaKey)&&a.shiftKey&&a.key==="z"&&(a.preventDefault(),Ot()),a.key==="F11"&&(a.preventDefault(),zt())};lt(()=>{const a=()=>{Q.value=window.innerWidth<1024};a(),window.addEventListener("resize",a);const e=localStorage.getItem("darkMode")==="true";T.value=e,document.documentElement.classList.toggle("dark",e),K.value=ye(),document.addEventListener("keydown",Gt),document.addEventListener("keydown",Ht),document.addEventListener("fullscreenchange",Ne),document.addEventListener("webkitfullscreenchange",Ne),document.addEventListener("msfullscreenchange",Ne),at(),na()});const Ut=()=>{it(()=>{if(M.value){const a=Y.value?p.value?jt.value:jr.value:p.value?Pt.value:Pr.value;if(a)try{const e=a;if(!e)return;const n=e.$el||e;if(!n)return;let u=n.querySelector("[data-radix-scroll-area-viewport]");if(u||(u=n.querySelector("[data-viewport]")),u||(u=n.querySelector('[role="region"]')),u||(u=n.querySelector('div[style*="overflow"]')),u||(u=n.querySelector("[data-scrollable]")),!u){const f=n.querySelectorAll("div");for(const _ of f){const P=window.getComputedStyle(_);if(P.overflow==="auto"||P.overflow==="scroll"||P.overflowY==="auto"||P.overflowY==="scroll"||_.scrollHeight>_.clientHeight){u=_;break}}}if(!u){const f=n.querySelector('.ProseMirror, [contenteditable="true"]');f&&(u=f.closest('div[style*="overflow"]')||f.closest("[data-radix-scroll-area-viewport]")||f.parentElement)}if(u){const f=u.scrollHeight-u.clientHeight;u.scrollTop=f,requestAnimationFrame(()=>{u.scrollTop=u.scrollHeight,u.scrollTo&&u.scrollTo({top:u.scrollHeight,behavior:"instant"})})}else console.warn("Could not find scrollable viewport in ScrollArea",{scrollAreaEl:n,children:n.children,mode:Y.value?"preview":"editor",fullscreen:p.value})}catch(e){console.warn("Auto-scroll failed:",e)}else{const e=document.querySelector(".ProseMirror");e&&e.scrollIntoView({behavior:"instant",block:"end"})}}})},na=()=>{const a=new URLSearchParams(window.location.search),e=a.get("ai_generate")==="true",n=a.get("generation_type");e&&n&&setTimeout(()=>{if(n==="progressive"){ft("progressive");const u=new URL(window.location.href);u.searchParams.delete("ai_generate"),u.searchParams.delete("generation_type"),window.history.replaceState({},"",u.toString()),E.success("ðŸš€ AI Generation Started",{description:`Generating ${l.chapter.title} with AI assistance...`})}else if(n==="single"){ft("progressive");const u=new URL(window.location.href);u.searchParams.delete("ai_generate"),u.searchParams.delete("generation_type"),window.history.replaceState({},"",u.toString()),E.success("ðŸš€ AI Generation Started",{description:`Generating ${l.chapter.title} with AI assistance...`})}},1e3)},Gt=a=>{if((a.ctrlKey||a.metaKey)&&!["INPUT","TEXTAREA","SELECT"].includes(a.target?.tagName))switch(a.key){case"ArrowLeft":a.preventDefault();const e=l.chapter.chapter_number-1;l.allChapters.find(_=>_.chapter_number===e)&&Ve(e);break;case"ArrowRight":a.preventDefault();const u=l.chapter.chapter_number+1;l.allChapters.find(_=>_.chapter_number===u)&&Ve(u);break}};lt(()=>{const a=e=>{const n=u=>{const{scrollTop:f,scrollHeight:_,clientHeight:P}=e,Z=u.deltaY,ce=f<=0,H=f+P>=_;Z<0&&ce||Z>0&&H||u.stopPropagation()};return e.addEventListener("wheel",n,{passive:!0}),()=>e.removeEventListener("wheel",n)};it(()=>{const e=document.querySelectorAll('[class*="overflow-y-auto"]'),n=[];e.forEach(u=>{if(u instanceof HTMLElement){const f=a(u);n.push(f)}}),window.__scrollChainCleanup=n})}),ca(()=>{Dr(),j.value&&j.value.close(),document.removeEventListener("keydown",Ht),document.removeEventListener("keydown",Gt);const a=window.__scrollChainCleanup;a&&Array.isArray(a)&&(a.forEach(e=>e()),delete window.__scrollChainCleanup),document.removeEventListener("fullscreenchange",Ne),document.removeEventListener("webkitfullscreenchange",Ne),document.removeEventListener("msfullscreenchange",Ne)}),et(b,sa),et(C,He),et(()=>l.chapter,async a=>{C.value=a.title||"",b.value=a.content||"",ue.value=[],la(),Bt(),await Xe(),await it(()=>{Kt()})},{immediate:!1});const ue=c([]),Be=c(!1),Ke=c(!1),Je=c(null),ie=A(()=>l.chapter),Vt=async a=>{ge.value=a,a&&oa()&&await Xe()},oa=()=>{if(!ue.value.length||!Je.value)return!0;const a=new Date(Date.now()-360*60*1e3);return Je.value<a},Xe=async(a=!1)=>{if(!Be.value){Be.value=!0;try{console.log("Loading defense questions with params:",{project_id:l.project.id,chapter_number:ie.value?.chapter_number,limit:5,force_refresh:a});const e=await xe.get(`/api/projects/${l.project.id}/defense/questions`,{params:{chapter_number:ie.value?.chapter_number||null,limit:5,force_refresh:a?1:0},headers:{Accept:"application/json","X-Requested-With":"XMLHttpRequest"}});if(console.log("Defense questions loaded:",e.data),console.log("Questions array:",e.data.questions),console.log("Questions count:",e.data.questions?e.data.questions.length:0),ue.value=e.data.questions||[],Je.value=new Date,e.data.questions&&e.data.questions.length>0){const n=`defense_questions_${l.project.id}_chapter_${ie.value?.chapter_number}`;localStorage.setItem(n,JSON.stringify({questions:e.data.questions,chapter_number:ie.value?.chapter_number,loaded_at:new Date().toISOString()}))}else a||(console.log("No existing questions found for this chapter"),console.log(`Current word count: ${I.value}/${nt}`),console.log('User must click "Generate Questions" button to create defense questions'))}catch(e){if(console.error("Failed to load defense questions:",e),e.response)if(console.error("Response status:",e.response.status),console.error("Response data:",e.response.data),e.response.status===422){console.error("Validation errors:",e.response.data.errors);const n=Object.values(e.response.data.errors||{})[0];n&&Array.isArray(n)?E.error(`Validation Error: ${n[0]}`):E.error("Invalid request parameters. Please refresh the page.")}else e.response.status===500?E.error("Server error. Please try again later."):E.error("Failed to load defense questions");else e.request?(console.error("No response received:",e.request),E.error("Network error. Please check your connection.")):(console.error("Error setting up request:",e.message),E.error("An unexpected error occurred"));ue.value=[]}finally{Be.value=!1}}},Qt=async()=>{if(Ke.value)return;const a=Se.defense();if(je(a,"generate defense questions")){Ke.value=!0;try{const e=await xe.post(`/api/projects/${l.project.id}/defense/questions/generate`,{chapter_number:ie.value.chapter_number},{headers:{"X-CSRF-TOKEN":document.querySelector('meta[name="csrf-token"]')?.getAttribute("content"),Accept:"application/json","Content-Type":"application/json"}});if(e.data&&e.data.questions){ue.value=e.data.questions,Je.value=new Date;const n=`defense_questions_${l.project.id}_chapter_${ie.value?.chapter_number}`;localStorage.setItem(n,JSON.stringify({questions:e.data.questions,chapter_number:ie.value?.chapter_number,loaded_at:new Date().toISOString()})),E.success(`Generated ${e.data.questions.length} new questions`),Ze(Se.defense(),"Defense questions","chapter",l.chapter.id).catch(u=>console.error("Failed to record word usage (defense):",u))}}catch(e){console.error("Failed to generate defense questions:",e),E.error("Failed to generate defense questions")}finally{Ke.value=!1}}},{hasTriggeredGeneration:wt,startWatching:Bt,stopWatching:la,forceCheck:Kt,getStatusMessage:Jt}=Ya(l.project,l.chapter,b),Xt=Ur,Yt=A(()=>{const a=I.value;return a>0&&a<nt&&!wt.value}),Zt=Vr,er=Gr,tr=async(a,e)=>{try{await xe.patch(`/api/projects/${l.project.id}/defense/questions/${a}`,{user_marked_helpful:e},{headers:{"X-CSRF-TOKEN":document.querySelector('meta[name="csrf-token"]')?.getAttribute("content"),Accept:"application/json","Content-Type":"application/json"}});const n=ue.value.find(u=>u.id===a);n&&(n.user_marked_helpful=e),E.success(e?"Question marked as helpful":"Removed helpful mark")}catch(n){console.error("Failed to mark question:",n),E.error("Failed to update question")}},rr=async a=>{try{await xe.delete(`/api/projects/${l.project.id}/defense/questions/${a}`,{headers:{"X-CSRF-TOKEN":document.querySelector('meta[name="csrf-token"]')?.getAttribute("content"),Accept:"application/json"}}),ue.value=ue.value.filter(e=>e.id!==a),localStorage.setItem(`defense_questions_${l.project.id}`,JSON.stringify({questions:ue.value,loaded_at:new Date().toISOString()})),E.success("Question hidden")}catch(e){console.error("Failed to hide question:",e),E.error("Failed to hide question")}};lt(async()=>{const a=`defense_questions_${l.project.id}_chapter_${ie.value?.chapter_number}`,e=localStorage.getItem(a);let n=!0;if(e){const u=JSON.parse(e),f=new Date(u.loaded_at),_=new Date(Date.now()-360*60*1e3);f>_&&u.chapter_number===ie.value?.chapter_number&&(ue.value=u.questions,Je.value=f,n=!1)}n&&await Xe(),Bt(),await it(()=>{Kt()})}),lt(async()=>{await Ir(),I.value>=800&&await st()});let xt=null;return et(I,(a,e)=>{xt&&clearTimeout(xt),a>=800&&Math.abs(a-e)>=100&&(xt=setTimeout(async()=>{await st()},5e3))}),(a,e)=>(y(),G(t(wa),null,{default:o(()=>[K.value?(y(),G(t(h),{key:0,project:be.value,chapter:we.value,"chapter-title":C.value,"chapter-content":b.value,"current-word-count":t(I),"target-word-count":re.value,"progress-percentage":t(Ue),"writing-quality-score":t(_e),"is-valid":Ge.value,"is-saving":t(Fe),"show-preview":L.value,"is-generating":M.value,"generation-progress":k.value,"history-index":t(Or),"content-history-length":t(Nr).length,"selected-text":V.value,"onUpdate:chapterTitle":e[0]||(e[0]=n=>C.value=n),"onUpdate:chapterContent":e[1]||(e[1]=n=>b.value=n),"onUpdate:selectedText":e[2]||(e[2]=n=>V.value=n),"onUpdate:showPreview":e[3]||(e[3]=n=>L.value=n),onSave:e[4]||(e[4]=n=>Ft(n)),onUndo:Nt,onRedo:Ot,onExitChatMode:ta},null,8,["project","chapter","chapter-title","chapter-content","current-word-count","target-word-count","progress-percentage","writing-quality-score","is-valid","is-saving","show-preview","is-generating","generation-progress","history-index","content-history-length","selected-text"])):X.value?(y(),G(t(d),{key:1,project:be.value,chapter:we.value,"chapter-title":C.value,"chapter-content":b.value,"current-word-count":t(I),"target-word-count":re.value,"progress-percentage":t(Ue),onExitCitationMode:aa},null,8,["project","chapter","chapter-title","chapter-content","current-word-count","target-word-count","progress-percentage"])):p.value?(y(),z("div",es,[e[56]||(e[56]=r("div",{class:"absolute inset-0 z-0 overflow-hidden pointer-events-none"},[r("div",{class:"absolute top-[-20%] left-[-10%] w-[50%] h-[50%] rounded-full bg-blue-500/5 blur-[120px]"}),r("div",{class:"absolute bottom-[-20%] right-[-10%] w-[50%] h-[50%] rounded-full bg-purple-500/5 blur-[120px]"})],-1)),r("div",ts,[r("div",rs,[s(t(ae),null,{default:o(()=>[s(t(se),{asChild:""},{default:o(()=>[s(t(W),{onClick:e[5]||(e[5]=n=>t(ut).visit(t(oe)("projects.show",l.project.slug))),variant:"ghost",size:"icon",class:"h-10 w-10 rounded-full hover:bg-primary/10 hover:text-primary transition-all duration-300"},{default:o(()=>[s(t(dr),{class:"h-5 w-5"})]),_:1})]),_:1}),s(t(ne),null,{default:o(()=>[...e[34]||(e[34]=[r("p",null,"Back to Project",-1)])]),_:1})]),_:1}),r("div",as,[s(ir,{as:"h1",class:"text-lg font-bold tracking-tight text-foreground/90 font-display",content:l.project.title},null,8,["content"]),r("div",ss,[s(t(ke),{variant:"outline",class:"h-5 px-2 rounded-full border-primary/20 bg-primary/5 text-primary font-medium"},{default:o(()=>[O(" Chapter "+v(l.chapter.chapter_number),1)]),_:1}),r("span",ns,[e[35]||(e[35]=r("span",{class:"h-1.5 w-1.5 rounded-full bg-green-500 animate-pulse"},null,-1)),O(" "+v(t(I))+" words ",1)])])])]),r("div",os,[r("div",ls,[s(t(W),{onClick:e[6]||(e[6]=n=>fe.value=!fe.value),variant:fe.value?"secondary":"ghost",size:"sm",class:le(["h-8 px-4 rounded-full text-xs font-medium transition-all duration-300",fe.value?"bg-primary/10 text-primary hover:bg-primary/15":"hover:bg-muted"])},{default:o(()=>[s(t(nr),{class:"mr-2 h-3.5 w-3.5"}),e[36]||(e[36]=O(" Outline ",-1))]),_:1},8,["variant","class"]),e[38]||(e[38]=r("div",{class:"w-px h-4 bg-border/50 mx-1"},null,-1)),s(t(W),{onClick:e[7]||(e[7]=n=>Te.value=!Te.value),variant:Te.value?"secondary":"ghost",size:"sm",class:le(["h-8 px-4 rounded-full text-xs font-medium transition-all duration-300",Te.value?"bg-primary/10 text-primary hover:bg-primary/15":"hover:bg-muted"])},{default:o(()=>[s(t(dt),{class:"mr-2 h-3.5 w-3.5"}),e[37]||(e[37]=O(" Assistant ",-1))]),_:1},8,["variant","class"])]),r("div",is,[s(t(ae),null,{default:o(()=>[s(t(se),{asChild:""},{default:o(()=>[s(t(W),{onClick:e[8]||(e[8]=n=>q.value=!q.value),variant:q.value?"secondary":"ghost",size:"icon",class:"h-9 w-9 rounded-full transition-all hover:bg-muted"},{default:o(()=>[s(t(pr),{class:"h-4.5 w-4.5 text-muted-foreground"})]),_:1},8,["variant"])]),_:1}),s(t(ne),null,{default:o(()=>[r("p",null,v(q.value?"Hide":"Show")+" Statistics",1)]),_:1})]),_:1}),s(t(ae),null,{default:o(()=>[s(t(se),{asChild:""},{default:o(()=>[s(t(W),{onClick:Wt,variant:"ghost",size:"icon",class:"h-9 w-9 rounded-full transition-all hover:bg-muted"},{default:o(()=>[T.value?(y(),G(t(vr),{key:1,class:"h-4.5 w-4.5 text-muted-foreground"})):(y(),G(t(gr),{key:0,class:"h-4.5 w-4.5 text-muted-foreground"}))]),_:1})]),_:1}),s(t(ne),null,{default:o(()=>[...e[39]||(e[39]=[r("p",null,"Toggle Theme",-1)])]),_:1})]),_:1}),s(_t,{project:be.value,"current-chapter":we.value,"all-chapters":qe.value,size:"icon",variant:"ghost",class:"h-9 w-9 rounded-full hover:bg-muted"},null,8,["project","current-chapter","all-chapters"])])])]),r("div",us,[r("div",{class:"absolute top-0 left-0 h-full bg-gradient-to-r from-blue-500 via-purple-500 to-pink-500 transition-all duration-700 ease-out shadow-[0_0_10px_rgba(59,130,246,0.5)]",style:ze({width:`${Math.min(t(Ue),100)}%`})},null,4)]),M.value?(y(),z("div",cs,[r("div",ds,[e[45]||(e[45]=r("div",{class:"absolute inset-0 -skew-x-12 animate-pulse bg-gradient-to-r from-transparent via-white/10 to-transparent"},null,-1)),r("div",ps,[r("div",gs,[r("div",vs,[r("div",hs,[s(t(dt),{class:"h-3 w-3 text-white"})]),e[40]||(e[40]=r("div",{class:"absolute inset-0 h-6 w-6 animate-ping rounded-full bg-gradient-to-br from-blue-500 to-purple-600 opacity-20"},null,-1))]),r("div",null,[e[41]||(e[41]=r("h4",{class:"text-xs font-semibold text-blue-900 dark:text-blue-100"},"AI Generator",-1)),r("p",fs,v(x.value),1)])]),s(t(ke),{variant:"outline",class:"border-blue-300 text-xs text-blue-700 dark:border-blue-700 dark:text-blue-300"},{default:o(()=>[O(v(Math.round(i.value))+"% ",1)]),_:1})]),r("div",ms,[r("div",bs,[e[42]||(e[42]=r("span",{class:"text-xs text-blue-800 dark:text-blue-200"},"Generation Progress",-1)),r("span",ws,v(R.value)+" / "+v(U.value)+" words",1)]),r("div",xs,[r("div",{class:"absolute top-0 left-0 h-full rounded-full bg-gradient-to-r from-blue-500 to-purple-500 transition-all duration-500 ease-out",style:ze({width:`${i.value}%`})},[...e[43]||(e[43]=[r("div",{class:"absolute inset-0 animate-pulse bg-gradient-to-r from-transparent via-white/30 to-transparent"},null,-1)])],4),r("div",{class:"absolute top-0 left-0 h-full rounded-full bg-gradient-to-r from-blue-400 to-purple-400 opacity-50 blur-sm transition-all duration-500",style:ze({width:`${i.value}%`})},null,4)])]),r("div",ys,[r("div",_s,[x.value==="Initializing"?(y(),z("div",Cs)):x.value==="Connecting"?(y(),z("div",Ss,[...e[44]||(e[44]=[r("div",{class:"h-2 w-0.5 animate-pulse rounded-full bg-blue-500"},null,-1),r("div",{class:"h-2 w-0.5 animate-pulse rounded-full bg-purple-500",style:{"animation-delay":"0.2s"}},null,-1),r("div",{class:"h-2 w-0.5 animate-pulse rounded-full bg-blue-500",style:{"animation-delay":"0.4s"}},null,-1)])])):x.value==="Generating"?(y(),z("div",Es)):x.value==="Complete"?(y(),z("div",ks)):(y(),z("div",Ts))]),r("p",As,v(k.value),1)])])])):de("",!0),q.value?(y(),G(mr,{key:1,"show-statistics":q.value,"current-word-count":t(I),"writing-stats":t(gt),"quality-analysis":t(J),"is-analyzing":t(Ee),class:"relative z-20 mx-4 mt-2 rounded-lg border border-border/40 bg-background/60 backdrop-blur-md"},null,8,["show-statistics","current-word-count","writing-stats","quality-analysis","is-analyzing"])):de("",!0),r("div",$s,[s(ar,{"enter-active-class":"transition-all duration-300 ease-in-out","enter-from-class":"-ml-72 opacity-0","enter-to-class":"ml-0 opacity-100","leave-active-class":"transition-all duration-300 ease-in-out","leave-from-class":"ml-0 opacity-100","leave-to-class":"-ml-72 opacity-0"},{default:o(()=>[fe.value?(y(),z("div",qs,[r("div",Rs,[r("div",Ps,[r("div",js,[e[46]||(e[46]=r("h2",{class:"text-sm font-semibold text-foreground mb-1"},"Table of Contents",-1)),r("p",Ms,v(qe.value.length)+" Chapters ",1)]),(y(),G(ct,null,{fallback:o(()=>[...e[47]||(e[47]=[r("div",{class:"flex items-center justify-center p-8"},[r("div",{class:"h-6 w-6 animate-spin rounded-full border-2 border-primary border-t-transparent"})],-1)])]),default:o(()=>[s(t($),{"all-chapters":qe.value,"current-chapter":we.value,project:be.value,outlines:a.project.outlines||[],"faculty-chapters":a.facultyChapters||[],"current-word-count":t(I),"target-word-count":re.value,"writing-quality-score":t(_e),"chapter-content-length":b.value.length,onGoToChapter:Ve,onGenerateNextChapter:vt},null,8,["all-chapters","current-chapter","project","outlines","faculty-chapters","current-word-count","target-word-count","writing-quality-score","chapter-content-length"])]),_:1}))])])])):de("",!0)]),_:1}),r("div",Ds,[r("div",Fs,[r("div",Ns,[s(t(Tt),{class:"w-full max-w-[850px] min-h-[calc(100vh-180px)] flex flex-col bg-background shadow-xl shadow-black/5 ring-1 ring-black/5 dark:ring-white/10 rounded-xl overflow-hidden transition-all duration-300"},{default:o(()=>[s(t($t),{class:"flex-shrink-0 border-b border-border/30 px-8 py-6 bg-background/50 backdrop-blur-sm sticky top-0 z-10"},{default:o(()=>[r("div",Os,[r("div",Ls,[s(t(yt),{for:"chapter-title-fs",class:"text-xs font-medium text-muted-foreground uppercase tracking-wider"},{default:o(()=>[...e[48]||(e[48]=[O("Chapter Title",-1)])]),_:1}),s(t(sr),{id:"chapter-title-fs",modelValue:C.value,"onUpdate:modelValue":e[9]||(e[9]=n=>C.value=n),placeholder:"Enter chapter title...",class:"h-auto p-0 border-0 bg-transparent text-2xl font-bold placeholder:text-muted-foreground/40 focus-visible:ring-0 px-0"},null,8,["modelValue"])]),r("div",zs,[s(t(ke),{variant:a.chapter.status==="approved"?"default":"secondary",class:"rounded-full px-3"},{default:o(()=>[O(v(a.chapter.status.replace("_"," ")),1)]),_:1},8,["variant"]),s(t(ke),{variant:"outline",class:le(["rounded-full px-3 transition-colors",{"text-green-600 border-green-200 bg-green-50 dark:bg-green-900/20 dark:border-green-800":(t(J)?.total_score||0)>=80,"text-yellow-600 border-yellow-200 bg-yellow-50 dark:bg-yellow-900/20 dark:border-yellow-800":(t(J)?.total_score||0)>=70&&(t(J)?.total_score||0)<80,"text-orange-600 border-orange-200 bg-orange-50 dark:bg-orange-900/20 dark:border-orange-800":(t(J)?.total_score||0)>=60&&(t(J)?.total_score||0)<70,"text-red-600 border-red-200 bg-red-50 dark:bg-red-900/20 dark:border-red-800":(t(J)?.total_score||0)<60}])},{default:o(()=>[O(v(t(J)?.total_score?Math.round(t(J).total_score):t(_e))+"% Quality ",1)]),_:1},8,["class"])])])]),_:1}),s(t(At),{class:"flex min-h-0 flex-1 flex-col p-0"},{default:o(()=>[r("div",Ws,[r("div",Is,[s(t(W),{onClick:It,variant:Y.value?"default":"ghost",size:"sm",class:"h-7 text-xs rounded-full"},{default:o(()=>[s(t(Ct),{class:"mr-1.5 h-3.5 w-3.5"}),O(" "+v(Y.value?"Edit":"Preview"),1)]),_:1},8,["variant"])]),r("div",Hs,[r("div",Us,v(a.aiChapterAnalysis?.section.name||a.getSectionInfo(a.nextSection).name),1),r("div",Gs,v(a.aiChapterAnalysis?.section.description||a.getSectionInfo(a.nextSection).description),1)])]),r("div",Vs,[Oe(s(ur,{modelValue:b.value,"onUpdate:modelValue":e[10]||(e[10]=n=>b.value=n),placeholder:"Start writing your chapter...","min-height":"500px",class:"min-h-[500px] px-8 py-6",ref_key:"richTextEditor",ref:ot,"show-toolbar":!0,"onUpdate:selectedText":e[11]||(e[11]=n=>{V.value=n})},null,8,["modelValue"]),[[Le,!Y.value]]),Oe(r("div",Qs,[s(or,{content:b.value,"show-font-controls":!1,class:"prose-lg mx-auto",style:{"font-family":"'Times New Roman', serif","line-height":"1.8"}},null,8,["content"])],512),[[Le,Y.value]])])]),_:1}),r("div",Bs,[r("div",Ks,v(t(Fe)?"Saving...":"All changes saved"),1),r("div",Js,[s(t(W),{onClick:e[12]||(e[12]=n=>t(me)(!1)),disabled:!Ge.value||t(Fe),size:"sm",variant:"ghost",class:"h-8 rounded-full"},{default:o(()=>[s(t(hr),{class:"mr-2 h-3.5 w-3.5"}),e[49]||(e[49]=O(" Save Draft ",-1))]),_:1},8,["disabled"]),s(t(W),{onClick:t(st),disabled:t(Ee)||t(I)<100,variant:"outline",size:"sm",class:"h-8 rounded-full"},{default:o(()=>[s(t(tt),{class:le(["mr-2 h-3.5 w-3.5",{"animate-pulse":t(Ee)}])},null,8,["class"]),e[50]||(e[50]=O(" Analyze ",-1))]),_:1},8,["onClick","disabled"]),s(t(W),{onClick:e[13]||(e[13]=n=>t(me)(!1)),disabled:!Ge.value||t(I)<re.value*.8,size:"sm",class:"h-8 rounded-full bg-gradient-to-r from-primary to-primary/90 shadow-sm hover:shadow-md transition-all"},{default:o(()=>[s(t(fr),{class:"mr-2 h-3.5 w-3.5"}),e[51]||(e[51]=O(" Complete ",-1))]),_:1},8,["disabled"])])])]),_:1}),e[52]||(e[52]=r("div",{class:"h-12"},null,-1))])])]),s(ar,{"enter-active-class":"transition-all duration-300 ease-in-out","enter-from-class":"-mr-72 opacity-0","enter-to-class":"mr-0 opacity-100","leave-active-class":"transition-all duration-300 ease-in-out","leave-from-class":"mr-0 opacity-100","leave-to-class":"-mr-72 opacity-0"},{default:o(()=>[Te.value?(y(),z("div",Xs,[r("div",Ys,[r("div",Zs,[(y(),G(ct,null,{fallback:o(()=>[...e[53]||(e[53]=[r("div",{class:"flex items-center justify-center p-8"},[r("div",{class:"h-6 w-6 animate-spin rounded-full border-2 border-primary border-t-transparent"})],-1)])]),default:o(()=>[s(t(S),{project:be.value,chapter:we.value,"is-generating":M.value,"selected-text":V.value,"is-loading-suggestions":We.value,"show-citation-helper":Ae.value,"chapter-content":b.value,"current-word-count":t(I),"target-word-count":re.value,onStartStreamingGeneration:ht,onGetAiSuggestions:mt,"onUpdate:showCitationHelper":e[14]||(e[14]=n=>Ae.value=n),onInsertCitation:Lt,onCheckCitations:bt},null,8,["project","chapter","is-generating","selected-text","is-loading-suggestions","show-citation-helper","chapter-content","current-word-count","target-word-count"])]),_:1})),(y(),G(ct,null,{fallback:o(()=>[...e[54]||(e[54]=[r("div",{class:"flex items-center justify-center p-4"},[r("div",{class:"h-4 w-4 animate-spin rounded-full border-2 border-muted border-t-transparent"})],-1)])]),default:o(()=>[s(t(w),{"show-defense-prep":ge.value,questions:ue.value,"is-loading":Be.value,"is-generating":Ke.value,"chapter-context":{chapter_number:ie.value.chapter_number,chapter_title:ie.value.title,word_count:t(I)},"defense-watcher":{meetsThreshold:t(Xt),shouldShowProgress:Yt.value,progressPercentage:t(Zt),wordsRemaining:t(er),hasTriggeredGeneration:t(wt),threshold:t(nt),statusMessage:t(Jt)()},"onUpdate:showDefensePrep":Vt,onGenerateMore:Qt,onRefresh:e[15]||(e[15]=()=>Xe(!0)),onMarkHelpful:tr,onHideQuestion:rr},null,8,["show-defense-prep","questions","is-loading","is-generating","chapter-context","defense-watcher"])]),_:1})),(y(),G(ct,null,{fallback:o(()=>[...e[55]||(e[55]=[r("div",{class:"flex items-center justify-center p-4"},[r("div",{class:"h-4 w-4 animate-spin rounded-full border-2 border-muted border-t-transparent"})],-1)])]),default:o(()=>[s(t(g),{"chapter-id":ie.value.id,content:b.value},null,8,["chapter-id","content"])]),_:1}))])])])):de("",!0)]),_:1})])])):(y(),G(ba,{key:3,class:"h-screen overflow-hidden"},{default:o(()=>[r("div",en,[r("div",tn,[r("div",rn,[r("div",an,[s(t(ae),null,{default:o(()=>[s(t(se),{asChild:""},{default:o(()=>[s(t(W),{onClick:e[16]||(e[16]=n=>t(ut).visit(t(oe)("projects.show",l.project.slug))),variant:"ghost",size:"icon",class:"hidden sm:flex"},{default:o(()=>[s(t(dr),{class:"h-4 w-4"})]),_:1})]),_:1}),s(t(ne),null,{default:o(()=>[...e[57]||(e[57]=[r("p",null,"Back to Project",-1)])]),_:1})]),_:1}),r("div",null,[s(ir,{as:"h1",class:"text-xl font-bold sm:text-2xl",content:l.project.title},null,8,["content"]),r("p",sn," Chapter "+v(l.chapter.chapter_number)+" â€¢ "+v(t(I))+" / "+v(re.value)+" words ",1)])]),r("div",nn,[s(t(ae),null,{default:o(()=>[s(t(se),{asChild:""},{default:o(()=>[s(t(W),{onClick:e[17]||(e[17]=n=>he.value=!0),variant:"outline",size:"icon",class:"lg:hidden"},{default:o(()=>[s(t(nr),{class:"h-4 w-4"})]),_:1})]),_:1}),s(t(ne),null,{default:o(()=>[...e[58]||(e[58]=[r("p",null,"Chapter Navigation",-1)])]),_:1})]),_:1}),s(t(ae),null,{default:o(()=>[s(t(se),{asChild:""},{default:o(()=>[s(t(W),{onClick:e[18]||(e[18]=n=>m.value=!0),variant:"outline",size:"icon",class:"lg:hidden"},{default:o(()=>[s(t(dt),{class:"h-4 w-4"})]),_:1})]),_:1}),s(t(ne),null,{default:o(()=>[...e[59]||(e[59]=[r("p",null,"AI Tools & Defense Prep",-1)])]),_:1})]),_:1}),r("div",on,[s(t(ae),null,{default:o(()=>[s(t(se),{asChild:""},{default:o(()=>[s(t(W),{onClick:ea,variant:K.value?"default":"outline",size:"sm"},{default:o(()=>[s(t(Ca),{class:"h-4 w-4"})]),_:1},8,["variant"])]),_:1}),s(t(ne),null,{default:o(()=>[r("p",null,v(K.value?"Exit":"Open")+" AI Chat Assistant",1)]),_:1})]),_:1}),s(t(ae),null,{default:o(()=>[s(t(se),{asChild:""},{default:o(()=>[s(t(W),{onClick:ra,variant:X.value?"default":"outline",size:"sm"},{default:o(()=>[s(t(tt),{class:"h-4 w-4"})]),_:1},8,["variant"])]),_:1}),s(t(ne),null,{default:o(()=>[r("p",null,v(X.value?"Exit":"Open")+" Citation Verification",1)]),_:1})]),_:1}),s(t(ae),null,{default:o(()=>[s(t(se),{asChild:""},{default:o(()=>[s(t(W),{onClick:e[19]||(e[19]=n=>q.value=!q.value),variant:q.value?"default":"outline",size:"sm"},{default:o(()=>[s(t(pr),{class:"h-4 w-4"})]),_:1},8,["variant"])]),_:1}),s(t(ne),null,{default:o(()=>[r("p",null,v(q.value?"Hide":"Show")+" Writing Statistics",1)]),_:1})]),_:1}),s(t(ae),null,{default:o(()=>[s(t(se),{asChild:""},{default:o(()=>[s(t(W),{onClick:Wt,variant:"outline",size:"sm"},{default:o(()=>[T.value?(y(),G(t(vr),{key:1,class:"h-4 w-4"})):(y(),G(t(gr),{key:0,class:"h-4 w-4"}))]),_:1})]),_:1}),s(t(ne),null,{default:o(()=>[r("p",null,"Switch to "+v(T.value?"Light":"Dark")+" Mode",1)]),_:1})]),_:1}),s(t(ae),null,{default:o(()=>[s(t(se),{asChild:""},{default:o(()=>[s(t(W),{onClick:zt,variant:p.value?"default":"outline",size:"sm"},{default:o(()=>[s(t(pa),{class:"h-4 w-4"})]),_:1},8,["variant"])]),_:1}),s(t(ne),null,{default:o(()=>[r("p",null,v(p.value?"Exit":"Enter")+" Fullscreen Mode (F11)",1)]),_:1})]),_:1}),s(_t,{project:be.value,"current-chapter":we.value,"all-chapters":qe.value,size:"sm"},null,8,["project","current-chapter","all-chapters"])])])]),r("div",ln,[r("div",un,[e[60]||(e[60]=r("span",{class:"text-sm font-medium"},"Writing Progress",-1)),r("span",cn,v(t(I))+" / "+v(re.value)+" words ("+v(Math.round(t(Ue)))+"%)",1)]),s(t(xr),{"model-value":Number(t(Ue)),class:"h-2"},null,8,["model-value"])]),M.value?(y(),z("div",dn,[r("div",pn,[e[67]||(e[67]=r("div",{class:"absolute inset-0 -skew-x-12 animate-pulse bg-gradient-to-r from-transparent via-white/10 to-transparent"},null,-1)),r("div",gn,[r("div",vn,[r("div",hn,[r("div",fn,[s(t(dt),{class:"h-4 w-4 text-white"})]),e[61]||(e[61]=r("div",{class:"absolute inset-0 h-8 w-8 animate-ping rounded-full bg-gradient-to-br from-blue-500 to-purple-600 opacity-20"},null,-1))]),r("div",null,[e[62]||(e[62]=r("h4",{class:"text-sm font-semibold text-blue-900 dark:text-blue-100"},"AI Chapter Generator ",-1)),r("p",mn,v(x.value),1)])]),s(t(ke),{variant:"outline",class:"border-blue-300 text-xs text-blue-700 dark:border-blue-700 dark:text-blue-300"},{default:o(()=>[O(v(Math.round(i.value))+"% ",1)]),_:1})]),r("div",bn,[r("div",wn,[e[63]||(e[63]=r("span",{class:"text-xs text-blue-800 dark:text-blue-200"},"Generation Progress",-1)),r("span",xn,v(R.value)+" / "+v(U.value)+" words",1)]),r("div",yn,[r("div",{class:"absolute top-0 left-0 h-full rounded-full bg-gradient-to-r from-blue-500 to-purple-500 transition-all duration-500 ease-out",style:ze({width:`${i.value}%`})},[...e[64]||(e[64]=[r("div",{class:"absolute inset-0 animate-pulse bg-gradient-to-r from-transparent via-white/30 to-transparent"},null,-1)])],4),r("div",{class:"absolute top-0 left-0 h-full rounded-full bg-gradient-to-r from-blue-400 to-purple-400 opacity-50 blur-sm transition-all duration-500",style:ze({width:`${i.value}%`})},null,4)])]),r("div",_n,[r("div",Cn,[x.value==="Initializing"?(y(),z("div",Sn)):x.value==="Connecting"?(y(),z("div",En,[...e[65]||(e[65]=[r("div",{class:"h-3 w-1 animate-pulse rounded-full bg-blue-500"},null,-1),r("div",{class:"h-3 w-1 animate-pulse rounded-full bg-purple-500",style:{"animation-delay":"0.2s"}},null,-1),r("div",{class:"h-3 w-1 animate-pulse rounded-full bg-blue-500",style:{"animation-delay":"0.4s"}},null,-1)])])):x.value==="Generating"?(y(),z("div",kn)):x.value==="Complete"?(y(),z("div",Tn)):(y(),z("div",An))]),r("p",$n,v(k.value),1)]),x.value==="Generating"&&R.value>50?(y(),z("div",qn,[r("div",Rn,[e[66]||(e[66]=r("span",{class:"text-blue-700 dark:text-blue-300"},"Writing Quality",-1)),r("div",Pn,[r("div",jn,[(y(),z(Et,null,kt(5,n=>r("div",{key:n,class:le(["h-2 w-2 rounded-full",n<=Math.ceil(t(_e)/20)?"bg-yellow-400":"bg-blue-200 dark:bg-blue-800"])},null,2)),64))]),r("span",Mn,v(t(_e))+"%",1)])])])):de("",!0)])])):de("",!0),s(mr,{"show-statistics":q.value,"current-word-count":t(I),"writing-stats":t(gt),"quality-analysis":t(J),"is-analyzing":t(Ee)},null,8,["show-statistics","current-word-count","writing-stats","quality-analysis","is-analyzing"]),r("div",Dn,[Oe(r("div",Fn,[r("div",Nn,[s(t($),{"all-chapters":qe.value,"current-chapter":we.value,project:be.value,outlines:a.project.outlines||[],"faculty-chapters":a.facultyChapters||[],"current-word-count":t(I),"target-word-count":re.value,"writing-quality-score":t(_e),"chapter-content-length":b.value.length,onGoToChapter:Ve,onGenerateNextChapter:vt},null,8,["all-chapters","current-chapter","project","outlines","faculty-chapters","current-word-count","target-word-count","writing-quality-score","chapter-content-length"])])],512),[[Le,!B.value]]),r("div",{class:le(["transition-all duration-300",B.value&&te.value?"lg:col-span-12":B.value?"lg:col-span-9":te.value?"lg:col-span-10":"lg:col-span-7"])},[s(t(Tt),{class:"border-[0.5px] border-border/50 transition-all duration-300"},{default:o(()=>[s(t($t),{class:"pb-4"},{default:o(()=>[r("div",On,[r("div",Ln,[s(t(W),{variant:"ghost",size:"icon",class:"h-6 w-6 hidden lg:flex mr-1 text-muted-foreground hover:text-foreground",onClick:e[20]||(e[20]=n=>B.value=!B.value),title:B.value?"Expand Sidebar":"Collapse Sidebar"},{default:o(()=>[B.value?(y(),G(t(va),{key:1,class:"h-4 w-4"})):(y(),G(t(ga),{key:0,class:"h-4 w-4"}))]),_:1},8,["title"]),s(t(wr),{class:"text-lg"},{default:o(()=>[O("Chapter "+v(a.chapter.chapter_number),1)]),_:1})]),r("div",zn,[s(t(ke),{variant:a.chapter.status==="approved"?"default":"secondary"},{default:o(()=>[O(v(a.chapter.status.replace("_"," ")),1)]),_:1},8,["variant"]),s(t(ke),{variant:"outline",class:le(["text-xs",{"text-green-600 border-green-200 bg-green-50":(t(J)?.total_score||0)>=80,"text-yellow-600 border-yellow-200 bg-yellow-50":(t(J)?.total_score||0)>=70&&(t(J)?.total_score||0)<80,"text-orange-600 border-orange-200 bg-orange-50":(t(J)?.total_score||0)>=60&&(t(J)?.total_score||0)<70,"text-red-600 border-red-200 bg-red-50":(t(J)?.total_score||0)<60}])},{default:o(()=>[O(v(t(J)?.total_score?Math.round(t(J).total_score):t(_e))+"% Quality ",1)]),_:1},8,["class"]),s(t(W),{variant:"ghost",size:"icon",class:"h-6 w-6 hidden lg:flex ml-1 text-muted-foreground hover:text-foreground",onClick:e[21]||(e[21]=n=>te.value=!te.value),title:te.value?"Expand Tools":"Collapse Tools"},{default:o(()=>[te.value?(y(),G(t(fa),{key:1,class:"h-4 w-4"})):(y(),G(t(ha),{key:0,class:"h-4 w-4"}))]),_:1},8,["title"])])])]),_:1}),s(t(At),{class:"space-y-4"},{default:o(()=>[r("div",Wn,[s(t(yt),{for:"chapter-title"},{default:o(()=>[...e[68]||(e[68]=[O("Chapter Title",-1)])]),_:1}),s(t(sr),{id:"chapter-title",modelValue:C.value,"onUpdate:modelValue":e[22]||(e[22]=n=>C.value=n),placeholder:"Enter chapter title...",class:"text-lg font-medium"},null,8,["modelValue"])]),r("div",In,[r("div",Hn,[s(t(yt),{for:"chapter-content"},{default:o(()=>[...e[69]||(e[69]=[O("Content",-1)])]),_:1}),r("div",Un,[s(t(W),{onClick:It,variant:Y.value?"default":"outline",size:"sm"},{default:o(()=>[s(t(Ct),{class:"mr-1 h-4 w-4"}),O(" "+v(Y.value?"Edit Mode":"Preview Mode"),1)]),_:1},8,["variant"])])]),Oe(s(t(lr),{ref_key:"editorFullscreenScrollRef",ref:Pt,class:"h-[calc(100vh-320px)] w-full"},{default:o(()=>[s(ur,{modelValue:b.value,"onUpdate:modelValue":e[23]||(e[23]=n=>b.value=n),placeholder:"Start writing your chapter...","min-height":"600px",class:"text-base leading-relaxed",ref_key:"richTextEditorFullscreen",ref:Qe,"onUpdate:selectedText":e[24]||(e[24]=n=>{V.value=n,console.log("ðŸ“‹ ChapterEditor Fullscreen - Selected text updated:",{length:n.length,preview:n.substring(0,50)+(n.length>50?"...":"")})})},null,8,["modelValue"])]),_:1},512),[[Le,!Y.value]]),Oe(s(t(lr),{ref_key:"previewFullscreenScrollRef",ref:jt,class:"h-[calc(100vh-320px)] w-full"},{default:o(()=>[s(or,{content:b.value,"show-font-controls":!1,class:"min-h-[600px] rounded-md border border-border/50 bg-background p-6",style:{"font-family":"'Times New Roman', serif","line-height":"1.8"}},null,8,["content"])]),_:1},512),[[Le,Y.value]])]),r("div",Gn,[s(t(ae),null,{default:o(()=>[s(t(se),{asChild:""},{default:o(()=>[s(t(W),{onClick:e[25]||(e[25]=n=>t(me)(!1)),disabled:!Ge.value||t(Fe),size:"sm",class:"flex-1 sm:flex-none"},{default:o(()=>[s(t(hr),{class:"mr-1 h-3 w-3 sm:mr-2 sm:h-4 sm:w-4"}),r("span",Vn,v(t(Fe)?"Saving...":"Save Draft"),1),r("span",Qn,v(t(Fe)?"Saving...":"Save"),1)]),_:1},8,["disabled"])]),_:1}),s(t(ne),null,{default:o(()=>[...e[70]||(e[70]=[r("p",null,"Save chapter as draft (Ctrl+S)",-1)])]),_:1})]),_:1}),s(t(ae),null,{default:o(()=>[s(t(se),{asChild:""},{default:o(()=>[s(t(W),{onClick:t(st),disabled:t(Ee)||t(I)<100,variant:"outline",size:"sm",class:"flex-1 sm:flex-none"},{default:o(()=>[s(t(tt),{class:le(["mr-1 h-3 w-3 sm:mr-2 sm:h-4 sm:w-4",{"animate-pulse":t(Ee)}])},null,8,["class"]),r("span",Bn,v(t(Ee)?"Analyzing...":"Analyze Quality"),1),r("span",Kn,v(t(Ee)?"Analyzing...":"Analyze"),1)]),_:1},8,["onClick","disabled"])]),_:1}),s(t(ne),null,{default:o(()=>[r("p",null,"Run academic quality analysis ("+v(t(I))+"/100 words min) ",1)]),_:1})]),_:1}),s(t(ae),null,{default:o(()=>[s(t(se),{asChild:""},{default:o(()=>[s(t(W),{onClick:e[26]||(e[26]=n=>L.value=!L.value),variant:"outline",size:"sm",class:"flex-1 sm:flex-none"},{default:o(()=>[L.value?(y(),G(t(Sa),{key:1,class:"mr-1 h-3 w-3 sm:mr-2 sm:h-4 sm:w-4"})):(y(),G(t(Ct),{key:0,class:"mr-1 h-3 w-3 sm:mr-2 sm:h-4 sm:w-4"})),r("span",Jn,v(L.value?"Edit":"Preview"),1),r("span",Xn,v(L.value?"Edit":"Preview"),1)]),_:1})]),_:1}),s(t(ne),null,{default:o(()=>[r("p",null,v(L.value?"Switch to edit mode":"Switch to preview mode"),1)]),_:1})]),_:1}),s(t(ae),null,{default:o(()=>[s(t(se),{asChild:""},{default:o(()=>[s(t(W),{onClick:e[27]||(e[27]=n=>t(me)(!1)),disabled:!Ge.value||t(I)<re.value*.8,size:"sm",class:"flex-1 sm:flex-none"},{default:o(()=>[s(t(fr),{class:"mr-1 h-3 w-3 sm:mr-2 sm:h-4 sm:w-4"}),e[71]||(e[71]=r("span",{class:"hidden sm:inline"},"Save & Mark Complete",-1)),e[72]||(e[72]=r("span",{class:"sm:hidden"},"Complete",-1))]),_:1},8,["disabled"])]),_:1}),s(t(ne),null,{default:o(()=>[...e[73]||(e[73]=[r("p",null,"Mark chapter as complete (requires 80% of target word count)",-1)])]),_:1})]),_:1}),s(_t,{project:be.value,"current-chapter":we.value,"all-chapters":qe.value,size:"sm",variant:"outline",class:"flex-1 sm:flex-none"},null,8,["project","current-chapter","all-chapters"])])]),_:1})]),_:1})],2),Oe(r("div",Yn,[r("div",Zn,[s(t(S),{project:be.value,chapter:we.value,"is-generating":M.value,"selected-text":V.value,"is-loading-suggestions":We.value,"show-citation-helper":Ae.value,"chapter-content":b.value,"current-word-count":t(I),"target-word-count":re.value,onStartStreamingGeneration:ht,onGetAiSuggestions:mt,"onUpdate:showCitationHelper":e[28]||(e[28]=n=>Ae.value=n),onInsertCitation:Lt,onCheckCitations:bt},null,8,["project","chapter","is-generating","selected-text","is-loading-suggestions","show-citation-helper","chapter-content","current-word-count","target-word-count"]),s(t(w),{"show-defense-prep":ge.value,questions:ue.value,"is-loading":Be.value,"is-generating":Ke.value,"chapter-context":{chapter_number:ie.value.chapter_number,chapter_title:ie.value.title,word_count:t(I)},"defense-watcher":{meetsThreshold:t(Xt),shouldShowProgress:Yt.value,progressPercentage:t(Zt),wordsRemaining:t(er),hasTriggeredGeneration:t(wt),threshold:t(nt),statusMessage:t(Jt)()},"onUpdate:showDefensePrep":Vt,onGenerateMore:Qt,onRefresh:e[29]||(e[29]=()=>Xe(!0)),onMarkHelpful:tr,onHideQuestion:rr},null,8,["show-defense-prep","questions","is-loading","is-generating","chapter-context","defense-watcher"])])],512),[[Le,!te.value]])]),s(t(F),{"show-left-sidebar":he.value,"show-right-sidebar":m.value,"is-mobile":Q.value,"all-chapters":qe.value,"current-chapter":we.value,project:be.value,"current-word-count":t(I),"target-word-count":re.value,"writing-quality-score":t(_e),"chapter-content-length":b.value.length,"is-generating":M.value,"selected-text":V.value,"is-loading-suggestions":We.value,"show-citation-helper":Ae.value,"chapter-content":b.value,"onUpdate:showLeftSidebar":e[30]||(e[30]=n=>he.value=n),"onUpdate:showRightSidebar":e[31]||(e[31]=n=>m.value=n),onGoToChapter:Ve,onGenerateNextChapter:vt,onStartStreamingGeneration:ht,onGetAiSuggestions:mt,"onUpdate:showCitationHelper":e[32]||(e[32]=n=>Ae.value=n),onCheckCitations:bt},null,8,["show-left-sidebar","show-right-sidebar","is-mobile","all-chapters","current-chapter","project","current-word-count","target-word-count","writing-quality-score","chapter-content-length","is-generating","selected-text","is-loading-suggestions","show-citation-helper","chapter-content"]),s(xa,{open:t(Rt),"current-balance":t(yr),"required-words":t(_r),action:t(Cr),"onUpdate:open":e[33]||(e[33]=n=>Rt.value=n),onClose:t(Er)},null,8,["open","current-balance","required-words","action","onClose"])])])]),_:1}))]),_:1}))}});export{ll as default};
