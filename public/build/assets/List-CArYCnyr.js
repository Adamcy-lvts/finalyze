import{bt as V,bs as g,ds as O,ci as z,cn as c,co as l,cp as n,cq as r,bE as a,cr as s,cs as m,ct as d,cB as y,cG as f,cS as D,df as P,cu as U,dt as q,du as B,dk as L,dv as K,dw as M,ce as C,cl as p,cj as i}from"./vendor-DwcF3VNb.js";import{_ as X}from"./AdminLayout.vue_vue_type_script_setup_true_lang-Cjul3uBB.js";import{_ as G,a as J}from"./CardContent.vue_vue_type_script_setup_true_lang-ByVWGonT.js";import{_ as Q}from"./CardDescription.vue_vue_type_script_setup_true_lang-DCwZv7vk.js";import{_ as W,a as H}from"./CardTitle.vue_vue_type_script_setup_true_lang-CANz9L_6.js";import{_ as u}from"./index-BpTO5Kag.js";import{_ as S}from"./Input.vue_vue_type_script_setup_true_lang-CQe6L5n4.js";import{_ as I}from"./Label.vue_vue_type_script_setup_true_lang-BCx0cnBe.js";import{_ as Y}from"./index-BU6y8D-V.js";import{_ as Z,a as ee}from"./DialogContent.vue_vue_type_script_setup_true_lang-DTGeh0zi.js";import{_ as te}from"./DialogDescription.vue_vue_type_script_setup_true_lang-DJcKnsJu.js";import{_ as se}from"./DialogFooter.vue_vue_type_script_setup_true_lang-gNJW6pFS.js";import{_ as ae,a as oe}from"./DialogTitle.vue_vue_type_script_setup_true_lang-CCtpPhJI.js";import"./Sonner.vue_vue_type_script_setup_true_lang-kLZ_SglN.js";import"./UserInfo.vue_vue_type_script_setup_true_lang-CpzsT-yS.js";import"./TooltipTrigger.vue_vue_type_script_setup_true_lang-C_drGNy-.js";const re={class:"mb-6"},ne={key:0,class:"text-center py-12 text-muted-foreground"},ie={key:1,class:"overflow-x-auto"},le={class:"w-full"},de={class:"py-4 px-2"},me={class:"font-medium"},ue={class:"text-sm text-muted-foreground"},ce={class:"py-4 px-2"},fe={class:"px-2 py-1 bg-muted rounded text-sm"},pe={class:"py-4 px-2 text-center"},_e={class:"py-4 px-2 text-right font-medium text-green-600"},ve={class:"py-4 px-2 text-center"},ge={class:"flex items-center justify-center gap-2"},ye={class:"font-medium"},xe={class:"py-4 px-2 text-right"},he={class:"flex items-center justify-end gap-2"},be={key:2,class:"flex items-center justify-between mt-6"},Ce={class:"text-sm text-muted-foreground"},ke={class:"flex gap-2"},we={class:"space-y-4 py-4"},Se={class:"space-y-2"},$e={class:"text-sm text-muted-foreground"},Ke=V({__name:"List",props:{affiliates:{},defaultRate:{}},setup($){const R=$,_=g(""),v=g(!1),x=g(null),h=g(!1),b=g({commission_rate:0}),F=O(()=>{C.get(p("admin.affiliates.list"),{search:_.value},{preserveState:!0,replace:!0})},300);z(_,()=>{F()});const w=o=>{C.get(p("admin.affiliates.list"),{page:o,search:_.value},{preserveState:!0})},T=o=>{x.value=o,b.value.commission_rate=o.commission_rate??R.defaultRate,v.value=!0},j=async()=>{if(x.value){h.value=!0;try{const e=await(await fetch(p("admin.affiliates.update",x.value.id),{method:"PUT",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":document.querySelector('meta[name="csrf-token"]')?.getAttribute("content")||""},body:JSON.stringify({commission_rate:b.value.commission_rate})})).json();e.success?(i.success(e.message||"Commission rate updated"),v.value=!1,C.reload({only:["affiliates"]})):i.error(e.message||"Failed to update rate")}catch{i.error("Failed to update rate")}finally{h.value=!1}}},E=async o=>{try{const t=await(await fetch(p("admin.affiliates.reset-rate",o.id),{method:"DELETE",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":document.querySelector('meta[name="csrf-token"]')?.getAttribute("content")||""}})).json();t.success?(i.success(t.message||"Rate reset to default"),C.reload({only:["affiliates"]})):i.error(t.message||"Failed to reset rate")}catch{i.error("Failed to reset rate")}},N=async o=>{try{const t=await(await fetch(p("admin.affiliates.setup-reminder",o.id),{method:"POST",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":document.querySelector('meta[name="csrf-token"]')?.getAttribute("content")||""}})).json();t.success?i.success(t.message||"Setup reminder sent"):i.error(t.message||"Failed to send setup reminder")}catch{i.error("Failed to send setup reminder")}},A=async o=>{try{const t=await(await fetch(p("admin.affiliates.approval-email",o.id),{method:"POST",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":document.querySelector('meta[name="csrf-token"]')?.getAttribute("content")||""}})).json();t.success?i.success(t.message||"Approval email sent"):i.error(t.message||"Failed to send approval email")}catch{i.error("Failed to send approval email")}};return(o,e)=>(l(),c(X,{title:"Affiliates",subtitle:"Manage affiliates and their commission rates."},{default:n(()=>[r(a(G),{class:"border-border/50"},{default:n(()=>[r(a(W),{class:"flex flex-row items-center justify-between pb-4"},{default:n(()=>[s("div",null,[r(a(H),{class:"text-base"},{default:n(()=>[...e[6]||(e[6]=[m("All Affiliates",-1)])]),_:1}),r(a(Q),null,{default:n(()=>[m(" Default commission rate: "+d(o.defaultRate)+"%. Users with custom rates are highlighted. ",1)]),_:1})])]),_:1}),r(a(J),null,{default:n(()=>[s("div",re,[r(a(S),{modelValue:_.value,"onUpdate:modelValue":e[0]||(e[0]=t=>_.value=t),placeholder:"Search by name, email, or referral code...",class:"max-w-md"},null,8,["modelValue"])]),o.affiliates.data.length===0?(l(),y("div",ne," No affiliates found ")):(l(),y("div",ie,[s("table",le,[e[8]||(e[8]=s("thead",null,[s("tr",{class:"border-b border-border/50"},[s("th",{class:"text-left py-3 px-2 text-sm font-medium text-muted-foreground"},"User"),s("th",{class:"text-left py-3 px-2 text-sm font-medium text-muted-foreground"},"Referral Code"),s("th",{class:"text-center py-3 px-2 text-sm font-medium text-muted-foreground"},"Referrals"),s("th",{class:"text-right py-3 px-2 text-sm font-medium text-muted-foreground"},"Total Earned"),s("th",{class:"text-center py-3 px-2 text-sm font-medium text-muted-foreground"},"Commission Rate"),s("th",{class:"text-right py-3 px-2 text-sm font-medium text-muted-foreground"},"Actions")])],-1)),s("tbody",null,[(l(!0),y(D,null,P(o.affiliates.data,t=>(l(),y("tr",{key:t.id,class:U(["border-b border-border/30",{"bg-primary/5":t.has_custom_rate}])},[s("td",de,[s("div",null,[s("p",me,d(t.name),1),s("p",ue,d(t.email),1)])]),s("td",ce,[s("code",fe,d(t.referral_code),1)]),s("td",pe,d(t.total_referrals),1),s("td",_e,d(t.total_earned_formatted),1),s("td",ve,[s("div",ge,[s("span",ye,d(t.effective_rate)+"%",1),t.has_custom_rate?(l(),c(a(Y),{key:0,variant:"secondary",class:"text-xs"},{default:n(()=>[...e[7]||(e[7]=[m(" Custom ",-1)])]),_:1})):f("",!0)])]),s("td",xe,[s("div",he,[t.affiliate_status==="approved"?(l(),c(a(u),{key:0,variant:"ghost",size:"sm",onClick:k=>A(t),title:"Send approval email"},{default:n(()=>[r(a(q),{class:"h-4 w-4"})]),_:2},1032,["onClick"])):f("",!0),t.affiliate_status==="approved"&&!t.can_receive_commissions?(l(),c(a(u),{key:1,variant:"ghost",size:"sm",onClick:k=>N(t),title:"Send setup reminder"},{default:n(()=>[r(a(B),{class:"h-4 w-4"})]),_:2},1032,["onClick"])):f("",!0),r(a(u),{variant:"outline",size:"sm",onClick:k=>T(t)},{default:n(()=>[r(a(L),{class:"h-4 w-4"})]),_:2},1032,["onClick"]),t.has_custom_rate?(l(),c(a(u),{key:2,variant:"ghost",size:"sm",onClick:k=>E(t),title:"Reset to default"},{default:n(()=>[r(a(K),{class:"h-4 w-4"})]),_:2},1032,["onClick"])):f("",!0)])])],2))),128))])])])),o.affiliates.last_page>1?(l(),y("div",be,[s("p",Ce," Page "+d(o.affiliates.current_page)+" of "+d(o.affiliates.last_page),1),s("div",ke,[r(a(u),{variant:"outline",size:"sm",disabled:o.affiliates.current_page===1,onClick:e[1]||(e[1]=t=>w(o.affiliates.current_page-1))},{default:n(()=>[...e[9]||(e[9]=[m(" Previous ",-1)])]),_:1},8,["disabled"]),r(a(u),{variant:"outline",size:"sm",disabled:o.affiliates.current_page===o.affiliates.last_page,onClick:e[2]||(e[2]=t=>w(o.affiliates.current_page+1))},{default:n(()=>[...e[10]||(e[10]=[m(" Next ",-1)])]),_:1},8,["disabled"])])])):f("",!0)]),_:1})]),_:1}),r(a(Z),{open:v.value,"onUpdate:open":e[5]||(e[5]=t=>v.value=t)},{default:n(()=>[r(a(ee),null,{default:n(()=>[r(a(ae),null,{default:n(()=>[r(a(oe),null,{default:n(()=>[...e[11]||(e[11]=[m("Edit Commission Rate",-1)])]),_:1}),r(a(te),null,{default:n(()=>[m(" Set a custom commission rate for "+d(x.value?.name),1)]),_:1})]),_:1}),s("div",we,[s("div",Se,[r(a(I),null,{default:n(()=>[...e[12]||(e[12]=[m("Commission Rate (%)",-1)])]),_:1}),r(a(S),{modelValue:b.value.commission_rate,"onUpdate:modelValue":e[3]||(e[3]=t=>b.value.commission_rate=t),modelModifiers:{number:!0},type:"number",min:"0",max:"100",step:"0.5"},null,8,["modelValue"]),s("p",$e," Default rate is "+d(o.defaultRate)+"%. Leave empty or set to default to use the global rate. ",1)])]),r(a(se),null,{default:n(()=>[r(a(u),{variant:"outline",onClick:e[4]||(e[4]=t=>v.value=!1)},{default:n(()=>[...e[13]||(e[13]=[m(" Cancel ",-1)])]),_:1}),r(a(u),{onClick:j,disabled:h.value},{default:n(()=>[h.value?(l(),c(a(M),{key:0,class:"h-4 w-4 animate-spin mr-2"})):f("",!0),e[14]||(e[14]=m(" Save Rate ",-1))]),_:1},8,["disabled"])]),_:1})]),_:1})]),_:1},8,["open"])]),_:1}))}});export{Ke as default};
