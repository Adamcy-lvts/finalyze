import{d as Ie,b as u,t as Y,q as lt,c as g,o as n,g as s,f as C,k as r,u as e,j as c,z as p,y as T,F as Fe,h as dt,n as M,ad as ct,U as E,S as ut,e as V,p as Ae,T as Le,a4 as pt,a0 as mt,X as P,i as S,aa as Re}from"./app-TT48nyjp.js";import{t as v}from"./index-CEXqyF32.js";import{_ as m}from"./index-DP4ThCdY.js";import{_ as ht}from"./index-9wCK-7Y_.js";import{_ as O}from"./Separator.vue_vue_type_script_setup_true_lang-BtM5sUoh.js";import{_ as gt}from"./Progress.vue_vue_type_script_setup_true_lang-BNIvb6px.js";import{aa as ft}from"./RichTextEditor-DclT8LFb.js";import{c as vt,u as bt,a as xt,b as wt,_ as yt,M as Ct}from"./useManualEditorSuggestions-cG5cpiJ-.js";import{_ as _t}from"./Input.vue_vue_type_script_setup_true_lang-oJ2QuLAR.js";import{a as kt}from"./ScrollArea.vue_vue_type_script_setup_true_lang-B3I_33z5.js";import{B as St}from"./bot-DUmwP4-R.js";import{X as Mt}from"./x-Basvi7e0.js";import{S as zt}from"./sparkles-D8v5LTqf.js";import{L as Be}from"./loader-circle-Dyp4s-Ms.js";import{S as $t}from"./send-Bb0-RPtb.js";import{_ as jt}from"./ChapterNavigation.vue_vue_type_script_setup_true_lang-AdDyu9dI.js";import{u as Et,M as Tt,a as At,P as Lt,_ as Rt,b as Pe}from"./useTextHistory-DJSy0Hom.js";import{_ as Pt}from"./DropdownMenuTrigger.vue_vue_type_script_setup_true_lang-f8_GrFC-.js";import{b as Ot}from"./WordBalanceDisplay.vue_vue_type_script_setup_true_lang-DsJk46nN.js";import{_ as Ut}from"./PurchaseModal.vue_vue_type_script_setup_true_lang-CFUIX1xE.js";import{r as Ne,u as It}from"./useWordBalance-CSMNLoiy.js";import{A as Oe}from"./arrow-left-BMiq2DUd.js";import{M as Ft}from"./menu-BMFxzJ1a.js";import{S as de}from"./save-P980OPFu.js";import{M as Ue}from"./message-square-Binnmgef.js";import{C as Bt}from"./chevron-left-Dvo-1KCL.js";import{C as Nt}from"./chevron-right-DlLvFs6D.js";import{a as Dt,P as Ht}from"./AlertDialogTitle.vue_vue_type_script_setup_true_lang-DbHrR7BD.js";import{M as Kt,S as qt}from"./sun-HDxgChSy.js";import{M as Vt}from"./minimize-2-C5f6IScD.js";import{B as Wt}from"./brain-D-mPnelQ.js";import{C as Gt}from"./circle-check-big-C93zq9Tf.js";import{_ as Qt}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./index-oq13fV5J.js";import"./Separator-DQbVmBVO.js";import"./Presence-9PI4tTID.js";import"./useForwardExpose-Dbm4xzLD.js";import"./nullish-CHIgUVhi.js";import"./purify.es-DxJI3Wx7.js";import"./index-BWEDi_FC.js";import"./step-DrZ9DcYd.js";import"./chart-column-C0oThU4L.js";import"./calendar-CEpWtLnI.js";import"./users-CPuaPtFt.js";import"./circle-alert-CYy7JQHT.js";import"./eye-TEuY40SI.js";import"./check-PBjlZVoN.js";import"./type-DSbbrXHT.js";import"./download-kN7fO5Qz.js";import"./trash-2-BkyJP9YU.js";import"./DialogTitle.vue_vue_type_script_setup_true_lang-DvkFCoUv.js";import"./DialogTitle-KBRGtlOP.js";import"./DialogDescription.vue_vue_type_script_setup_true_lang-90gUKkp_.js";import"./DialogFooter.vue_vue_type_script_setup_true_lang-uDeFU3gz.js";import"./Label.vue_vue_type_script_setup_true_lang-DUqfID8B.js";import"./minus-BJ-pNowi.js";import"./plus-YvI5gyOA.js";import"./list-CJLJxGbG.js";import"./CollapsibleTrigger.vue_vue_type_script_setup_true_lang-iSfPbvSF.js";import"./SafeHtmlText.vue_vue_type_script_setup_true_lang-DilL3Trk.js";import"./lightbulb-CO8KcAgY.js";import"./chevron-down-7zBjbpse.js";import"./DefensePreparationPanel.vue_vue_type_script_setup_true_lang-Bl9Z3FOd.js";import"./index-qRxTH7D4.js";import"./CardContent.vue_vue_type_script_setup_true_lang-BYYhQ7Wx.js";import"./CardTitle.vue_vue_type_script_setup_true_lang-CIg9mqe5.js";import"./Switch.vue_vue_type_script_setup_true_lang-DxVZjFVZ.js";import"./VisuallyHiddenInput-CsIxlv3l.js";import"./VisuallyHidden-bHCC2X31.js";import"./circle-help-DKXB0Ebl.js";import"./refresh-cw-D2XN5D-g.js";import"./thumbs-up-CmqVxWui.js";import"./useNonce-ga19YQGq.js";import"./DialogTrigger-CiilS_d_.js";import"./lock-Bm09Iagk.js";import"./target-BhPURjCD.js";import"./book-open-SPJvQUXO.js";import"./search-BvIGVKq2.js";import"./Checkbox.vue_vue_type_script_setup_true_lang-ClOfFpWd.js";import"./ohash.D__AXeF1-C-E83dC9.js";import"./RovingFocusItem-D-Rc3bD1.js";import"./file-text-BmZjwUxw.js";import"./TooltipTrigger.vue_vue_type_script_setup_true_lang-Cjzyak1V.js";import"./coins-C5ZHbm8a.js";import"./arrow-right-CjAO-a7h.js";const Xt={class:"flex flex-col h-full bg-transparent"},Yt={class:"p-4 border-b border-border/50 flex justify-between items-start bg-background/50 backdrop-blur-sm"},Jt={class:"flex items-center gap-2"},Zt={class:"p-1.5 rounded-md bg-primary/10 text-primary"},eo={key:0,class:"px-4 py-2 bg-muted/30 border-b border-border/50 text-xs flex gap-3 text-muted-foreground"},to={key:0,class:"ml-auto text-amber-600 dark:text-amber-400 font-medium flex items-center gap-1"},oo={class:"space-y-6"},so={key:0,class:"flex flex-col items-center justify-center text-center py-12 px-4 space-y-4 opacity-0 animate-in fade-in slide-in-from-bottom-4 duration-700 fill-mode-forwards"},ro={class:"w-12 h-12 rounded-full bg-primary/5 flex items-center justify-center mb-2"},ao={class:"grid grid-cols-1 gap-2 w-full max-w-xs mt-4"},no={class:"space-y-1"},io=["innerHTML"],lo={key:1,class:"flex gap-3"},co={class:"w-8 h-8 rounded-full bg-muted flex items-center justify-center shrink-0"},uo={class:"p-4 border-t border-border/50 bg-background/50 backdrop-blur-sm"},po={class:"relative"},mo=Ie({__name:"ManualChatSidebar",props:{messages:{},isLoading:{type:Boolean},analysis:{}},emits:["send","close"],setup(U,{emit:i}){const A=U,z=i,x=u(""),$=u(null),I=()=>{x.value.trim()&&!A.isLoading&&(z("send",x.value),x.value="")},W=d=>{d.key==="Enter"&&!d.shiftKey&&(d.preventDefault(),I())};return Y(()=>A.messages.length,async()=>{if(await lt(),$.value){const d=$.value.$el.querySelector("[data-radix-scroll-area-viewport]");d&&(d.scrollTop=d.scrollHeight)}}),(d,l)=>(n(),g("div",Xt,[s("div",Yt,[s("div",null,[s("div",Jt,[s("div",Zt,[r(e(St),{class:"w-4 h-4"})]),l[4]||(l[4]=s("h3",{class:"font-semibold text-foreground"},"AI Assistant",-1))]),l[5]||(l[5]=s("p",{class:"text-xs text-muted-foreground mt-1 ml-1"},"Context-aware writing companion",-1))]),r(e(m),{variant:"ghost",size:"icon",class:"h-8 w-8 -mr-2",onClick:l[0]||(l[0]=f=>d.$emit("close"))},{default:c(()=>[r(e(Mt),{class:"w-4 h-4"})]),_:1})]),d.analysis?(n(),g("div",eo,[s("span",null,p(d.analysis.word_count)+" words",1),l[6]||(l[6]=s("span",null,"â€¢",-1)),s("span",null,p(d.analysis.citation_count)+" citations",1),d.analysis.detected_issues.length>0?(n(),g("span",to,p(d.analysis.detected_issues.length)+" issues ",1)):C("",!0)])):C("",!0),r(e(kt),{ref_key:"messagesContainer",ref:$,class:"flex-1 p-4"},{default:c(()=>[s("div",oo,[d.messages.length===0?(n(),g("div",so,[s("div",ro,[r(e(zt),{class:"w-6 h-6 text-primary/60"})]),l[9]||(l[9]=s("div",{class:"space-y-1"},[s("h4",{class:"font-medium text-foreground"},"How can I help?"),s("p",{class:"text-sm text-muted-foreground max-w-[240px]"}," I can help you structure your arguments, find citations, or rephrase complex sentences. ")],-1)),s("div",ao,[r(e(m),{variant:"outline",size:"sm",class:"justify-start h-auto py-2 text-xs font-normal",onClick:l[1]||(l[1]=f=>{x.value="Analyze the structure of this chapter",I()})},{default:c(()=>[...l[7]||(l[7]=[T(' "Analyze the structure of this chapter" ',-1)])]),_:1}),r(e(m),{variant:"outline",size:"sm",class:"justify-start h-auto py-2 text-xs font-normal",onClick:l[2]||(l[2]=f=>{x.value="Suggest some relevant citations",I()})},{default:c(()=>[...l[8]||(l[8]=[T(' "Suggest some relevant citations" ',-1)])]),_:1})])])):C("",!0),(n(!0),g(Fe,null,dt(d.messages,(f,h)=>(n(),g("div",{key:h,class:M(["flex gap-3 max-w-[90%]",f.role==="user"?"ml-auto flex-row-reverse":""])},[s("div",{class:M(["w-8 h-8 rounded-full flex items-center justify-center shrink-0 text-xs font-medium",f.role==="user"?"bg-primary text-primary-foreground":"bg-muted text-muted-foreground"])},p(f.role==="user"?"You":"AI"),3),s("div",no,[s("div",{class:M(["p-3 rounded-2xl text-sm shadow-sm",f.role==="user"?"bg-primary text-primary-foreground rounded-tr-sm":"bg-card border text-card-foreground rounded-tl-sm"])},[s("div",{innerHTML:f.content,class:"prose prose-sm dark:prose-invert max-w-none break-words"},null,8,io)],2),s("p",{class:M(["text-[10px] text-muted-foreground opacity-70 px-1",f.role==="user"?"text-right":""])},p(new Date(f.timestamp).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})),3)])],2))),128)),d.isLoading?(n(),g("div",lo,[s("div",co,[r(e(Be),{class:"w-4 h-4 animate-spin text-muted-foreground"})]),l[10]||(l[10]=s("div",{class:"bg-card border px-4 py-3 rounded-2xl rounded-tl-sm text-sm text-muted-foreground shadow-sm"}," Thinking... ",-1))])):C("",!0)])]),_:1},512),s("div",uo,[s("div",po,[r(e(_t),{modelValue:x.value,"onUpdate:modelValue":l[3]||(l[3]=f=>x.value=f),placeholder:"Ask anything about your chapter...",onKeydown:W,disabled:d.isLoading,class:"pr-10 py-6 bg-background/80 border-border/60 focus-visible:ring-primary/20 shadow-sm"},null,8,["modelValue","disabled"]),r(e(m),{onClick:I,disabled:d.isLoading||!x.value.trim(),size:"icon",class:M(["absolute right-1.5 top-1.5 h-9 w-9 transition-all duration-200",x.value.trim()?"opacity-100 scale-100":"opacity-70 scale-90"])},{default:c(()=>[r(e($t),{class:"w-4 h-4"})]),_:1},8,["disabled","class"])]),l[11]||(l[11]=s("p",{class:"text-[10px] text-center text-muted-foreground mt-2"}," AI can make mistakes. Review generated content. ",-1))])]))}});function ho(U,i=[]){const A=u(!1),z=u(i),x=u(!1),$=u(null);return{isChatOpen:A,messages:z,isLoading:x,toggleChat:()=>{A.value=!A.value},sendMessage:async d=>{if(d.trim()){z.value.push({role:"user",content:d,timestamp:new Date}),x.value=!0;try{const f=(await ct.post(E("projects.manual-editor.chat",{project:U.project.slug,chapter:U.chapter_number}),{message:d,history:z.value})).data.message;z.value.push({role:"assistant",content:f,timestamp:new Date});const h=vt(f||"");if(h>0)try{await Ne(h,"Manual editor: Chat","chapter",U.id),await $.value?.()}catch(N){console.error("Failed to record word usage (manual chat):",N)}}catch(l){console.error("Failed to send chat message:",l),z.value.push({role:"assistant",content:"I'm having trouble responding right now. Please try again.",timestamp:new Date})}finally{x.value=!1}}},setOnUsageRecorded:d=>{$.value=d}}}const go={class:"manual-editor h-screen flex flex-col bg-background dark:bg-background transition-colors duration-300"},fo={class:"md:hidden border-b h-14 px-3 flex justify-between items-center bg-background/80 backdrop-blur-md sticky top-0 z-50 transition-all duration-200"},vo={class:"flex items-center gap-2"},bo={class:"flex flex-col justify-center min-w-0 flex-1 mx-2"},xo={class:"items-center gap-2 text-xs font-medium text-muted-foreground mb-1 hidden sm:flex"},wo={class:"flex items-center gap-2 -ml-1"},yo={class:"font-bold text-base text-foreground truncate"},Co={class:"truncate"},_o={class:"flex gap-2 items-center"},ko={class:"hidden md:flex flex-col w-full z-50 sticky top-0 bg-background/80 backdrop-blur-md transition-all duration-200 border-b"},So={class:"h-10 border-b border-border/40 flex items-center justify-center px-4 bg-background/60 relative"},Mo={class:"flex items-center gap-2"},zo={class:"flex items-center gap-1 absolute right-4"},$o={class:"h-12 flex items-center justify-between px-4 bg-background/40"},jo={class:"flex items-center gap-3"},Eo={class:"flex items-center gap-1"},To={class:"flex items-center gap-2 px-3 py-1.5 rounded-full bg-muted/30 border border-border/40"},Ao={class:"flex items-center gap-1.5"},Lo={class:"text-xs font-medium text-muted-foreground"},Ro={key:0,class:"flex items-center gap-1.5"},Po={key:1,class:"text-xs text-muted-foreground"},Oo={class:"flex items-center gap-3"},Uo={class:"flex items-center gap-1 bg-muted/30 p-1 rounded-full border border-border/40"},Io={class:"text-xs font-medium"},Fo={class:"w-full bg-background border-b px-3 md:px-6 py-2 flex flex-col gap-1"},Bo={class:"flex justify-between items-center text-xs text-muted-foreground mb-1"},No={class:"flex-1 flex overflow-hidden"},Do={key:0,class:"w-[320px] border-r bg-background/80 backdrop-blur-xl border-border/50 shadow-xl z-20 overflow-y-auto custom-scrollbar"},Ho={class:"p-4"},Ko={class:"mb-3"},qo={class:"text-xs text-muted-foreground"},Vo={class:"flex-1 overflow-auto p-2 md:p-6 bg-background"},Wo={key:0,class:"w-1/2 flex flex-col bg-background overflow-hidden"},Go={class:"flex-1 overflow-y-auto custom-scrollbar"},Qo={key:0,class:"w-[400px] border-l bg-background/80 backdrop-blur-xl border-border/50 shadow-2xl z-20 overflow-y-auto custom-scrollbar flex flex-col"},Xo={key:0,class:"flex-1 overflow-hidden"},Yo={class:"h-full border-b border-border/50"},Jo={key:1,class:"p-4 space-y-6"},Zo={key:0,class:"space-y-2"},es={key:1,class:"space-y-2"},ts={class:"flex items-center justify-between"},os={class:"text-xs whitespace-pre-wrap rounded-lg border border-border/50 bg-muted/30 p-3"},ss={class:"space-y-2"},rs={class:"border-t p-2 md:p-3 flex flex-col gap-3 text-xs md:text-sm bg-muted/30"},as={class:"flex flex-col sm:flex-row justify-between gap-3 sm:gap-2 items-start sm:items-center w-full"},ns={class:"flex gap-2 md:gap-4 flex-wrap items-center"},is={class:"text-muted-foreground"},ls={class:"text-foreground"},ds={key:0,class:"text-muted-foreground hidden sm:inline"},cs={class:"text-foreground"},us={key:1,class:"text-muted-foreground hidden md:inline"},ps={class:"text-foreground"},ms={key:2,class:"text-muted-foreground hidden lg:inline"},hs={class:"flex gap-2 items-center w-full sm:w-auto"},gs={class:"text-xs font-medium"},fs=Ie({__name:"ManualEditor",props:{project:{},chapter:{},allChapters:{},facultyChapters:{},currentSuggestion:{},contextAnalysis:{},initialProgressGuidance:{},chatHistory:{}},setup(U){const i=U,A=ut();Y(()=>A.props?.flash,t=>{t&&(t.success&&v.success(t.success),t.error&&v.error(t.error))},{deep:!0,immediate:!0});const{wordBalance:z,balance:x,showPurchaseModal:$,requiredWordsForModal:I,actionDescriptionForModal:W,checkAndPrompt:d,closePurchaseModal:l,refreshBalance:f}=It(),{content:h,isDirty:N,isSaving:j,lastSaved:ce,updateContent:De,manualSave:ue}=bt(i.chapter,i.project.slug),{currentSuggestion:J,currentAnalysis:b,isAnalyzing:Z,saveSuggestion:pe,clearSuggestion:me,applySuggestion:he}=xt(i.chapter,i.project.slug,i.currentSuggestion,h,{onUsageRecorded:()=>f()}),{addToHistory:He}=Et(i.chapter.content||""),{isChatOpen:ge,messages:Ke,isLoading:qe,toggleChat:Ve,sendMessage:We,setOnUsageRecorded:Ge}=ho(i.chapter,i.chatHistory||[]);Ge(()=>f());const Qe=u(i.chapter.title||"");u(!1),u(!1),u("");const fe=()=>{B.value&&ve(),w.value=!0,Ve()},F=t=>{De(t),He(t)};V(()=>{const t=Qe.value?.trim(),o=h.value?.trim();return!!(t&&t.length>0&&o&&o.length>50)});const Xe=()=>typeof window<"u"&&window.innerWidth<1024,G=(t,o)=>{try{const a=localStorage.getItem(t);return a!==null?a==="true":o}catch{return o}},_=u(Xe()),k=u(G("manualEditor_showLeftSidebar",!_.value)),w=u(G("manualEditor_showRightSidebar",!_.value)),ee=u(""),te=u(null),D=u(null),H=u("");u(!1),u([]),u(!1);const L=u(!0),B=u((()=>{try{return localStorage.getItem("citationOperationMode")==="true"}catch{return!1}})()),Ye=()=>{B.value=!0,w.value=!1;try{localStorage.setItem("citationOperationMode","true")}catch{}},ve=()=>{B.value=!1,w.value=!0;try{localStorage.setItem("citationOperationMode","false")}catch{}},be=u(!1),Je=async()=>{v.info("Fullscreen temporarily disabled")},Ze=()=>{P.visit(E("projects.analysis",{project:i.project.slug}))};Ae(()=>{}),Le(()=>{});const{isDark:xe,toggle:et}=pt(),tt=V(()=>{const t=b.value?.word_count??i.chapter.word_count,o=i.chapter.target_word_count||1e3;return Math.min(t/o*100,100)});V(()=>j.value?"Saving...":ce.value?`Saved ${ce.value}`:"Not saved");const ot=()=>{k.value=!k.value},st=()=>{w.value=!w.value};Y(k,t=>{if(!_.value)try{localStorage.setItem("manualEditor_showLeftSidebar",String(t))}catch(o){console.error("Failed to save left sidebar state:",o)}}),Y(w,t=>{if(!_.value)try{localStorage.setItem("manualEditor_showRightSidebar",String(t))}catch(o){console.error("Failed to save right sidebar state:",o)}});const we=t=>{(t.ctrlKey||t.metaKey)&&t.key==="s"&&(t.preventDefault(),Q())};Ae(()=>{_.value=window.innerWidth<1024,_.value&&(k.value=!1,w.value=!1);const t=()=>{const o=_.value;_.value=window.innerWidth<1024,o!==_.value&&(_.value?(k.value=!1,w.value=!1):(k.value=G("manualEditor_showLeftSidebar",!0),w.value=G("manualEditor_showRightSidebar",!0)))};window.addEventListener("resize",t),window.addEventListener("keydown",we),Le(()=>{window.removeEventListener("resize",t),window.removeEventListener("keydown",we)})});const ye=t=>{F(t),v.success("Applied improved text")},Ce=t=>{if(D.value?.replaceSelection(t,te.value||void 0)??!1){v.success("Expanded selection");return}F(`${h.value}

${t}`),v.success("Added expanded text")},_e=t=>{H.value=t,L.value=!0;try{navigator.clipboard?.writeText(t)}catch{}v.success("Citation suggestions ready")},ke=t=>{if(D.value?.replaceSelection(t,te.value||void 0)??!1){v.success("Applied rephrased text");return}F(`${h.value}

${t}`),v.success("Added rephrased text")},Se=(t,o)=>d(t,o),Me=async(t,o)=>{const a=Math.max(0,Math.round(t||0));a&&(await Ne(a,o,"chapter",i.chapter.id),await f())},rt=async()=>{if(H.value)try{await navigator.clipboard.writeText(H.value),v.success("Copied citation suggestions")}catch{v.error("Could not copy citation suggestions")}},oe=V(()=>i.allChapters.find(t=>t.chapter_number===i.chapter.chapter_number-1)),se=V(()=>i.allChapters.find(t=>t.chapter_number===i.chapter.chapter_number+1)),re=(t,o)=>{if(o&&h.value){const ae=o.trim(),ne=document.createElement("div");ne.innerHTML=h.value;const je=ne.textContent||ne.innerText||"",Ee=je.indexOf(ae);if(Ee!==-1){const ie=Ee+ae.length,Te=je.substring(ie).match(/^[^.!?]*[.!?]/);let le;Te?le=ie+Te[0].length:le=ie;let y=0,X=0;const R=h.value;for(;y<R.length&&X<le;)if(R[y]==="<"){for(;y<R.length&&R[y]!==">";)y++;y++}else if(R[y]==="&"){const q=R.indexOf(";",y);q!==-1&&q-y<10?(y=q+1,X++):(y++,X++)}else y++,X++;if(y>0){const q=R.substring(0,y),nt=R.substring(y),it=`${q} ${t}${nt}`;F(it),v.success("Citation inserted at claim location");return}}}const a=D.value?.getCursorPosition?.();if(typeof a=="number"&&(D.value?.replaceTextAt?.({from:a,to:a},` ${t} `)??!1)){v.success("Citation inserted at cursor");return}F(`${h.value} ${t}`),v.success("Citation appended to content")},K=t=>{N.value&&!confirm("You have unsaved changes. Are you sure you want to switch chapters?")||P.visit(E("projects.manual-editor.show",{project:i.project.slug,chapter:t}))},ze=()=>{const t=i.chapter.chapter_number+1;i.allChapters.find(a=>a.chapter_number===t)?K(t):v.info("Please create the next chapter from the dashboard first.")},$e=t=>{confirm("Are you sure you want to delete this chapter?")&&P.delete(E("chapters.destroy",{project:i.project.slug,chapter:i.allChapters.find(o=>o.id===t)?.slug}),{onSuccess:()=>v.success("Chapter deleted")})},Q=async()=>{try{await ue(),v.success("Chapter saved successfully")}catch{v.error("Failed to save chapter")}},at=async()=>{console.log("ðŸ”µ [MARK COMPLETE] Function called"),console.log("ðŸ”µ [MARK COMPLETE] Current word count:",b.value?.word_count??i.chapter.word_count);try{console.log("ðŸ”µ [MARK COMPLETE] Saving chapter..."),await ue(),console.log("âœ… [MARK COMPLETE] Chapter saved");const t=E("projects.manual-editor.mark-complete",{project:i.project.slug,chapter:i.chapter.chapter_number});console.log("ðŸ”µ [MARK COMPLETE] Posting to:",t),P.post(t,{},{onSuccess:()=>{console.log("âœ… [MARK COMPLETE] Request successful")},onError:o=>{console.error("âŒ [MARK COMPLETE] Request failed:",o)}})}catch(t){console.error("âŒ [MARK COMPLETE] Error:",t),v.error("Failed to save chapter before marking complete")}};return(t,o)=>(n(),g(Fe,null,[r(e(mt),{title:`${t.chapter.title} - Manual Editor`},null,8,["title"]),s("div",go,[s("header",fo,[s("div",vo,[r(e(m),{variant:"ghost",size:"icon",class:"h-8 w-8 text-zinc-700 dark:text-zinc-300 hover:text-foreground",onClick:o[0]||(o[0]=a=>e(P).visit(e(E)("projects.show",t.project.slug))),title:"Back to Project"},{default:c(()=>[r(e(Oe),{class:"w-4 h-4"})]),_:1}),r(e(O),{orientation:"vertical",class:"h-6"}),r(e(m),{onClick:o[1]||(o[1]=a=>k.value=!0),variant:"ghost",size:"icon",class:"h-8 w-8 lg:hidden text-muted-foreground hover:text-foreground",title:"Open Chapter Navigation"},{default:c(()=>[r(e(Ft),{class:"w-4 h-4"})]),_:1})]),s("div",bo,[s("div",xo,[s("span",{class:"hover:text-foreground transition-colors cursor-pointer truncate",onClick:o[2]||(o[2]=a=>e(P).visit(e(E)("projects.show",t.project.slug)))},p(t.project.title),1)]),s("div",wo,[s("div",yo,[s("span",Co,"Ch. "+p(t.chapter.chapter_number),1)])])]),s("div",_o,[r(e(m),{variant:"ghost",size:"icon",class:"h-8 w-8",onClick:Q,disabled:e(j),title:"Save"},{default:c(()=>[r(e(de),{class:"w-4 h-4"})]),_:1},8,["disabled"]),r(e(O),{orientation:"vertical",class:"h-6 mx-1 opacity-50"}),r(e(m),{onClick:o[3]||(o[3]=a=>w.value=!0),variant:"ghost",size:"icon",class:"h-8 w-8 text-muted-foreground hover:text-foreground",title:"Open Tools"},{default:c(()=>[r(e(Ue),{class:"w-4 h-4"})]),_:1})])]),s("div",ko,[s("div",So,[s("div",Mo,[s("h1",{class:"text-sm font-bold text-foreground cursor-pointer hover:text-primary transition-colors",onClick:o[4]||(o[4]=a=>e(P).visit(e(E)("projects.show",t.project.slug)))},p(t.project.title),1),r(e(ht),{variant:"secondary",class:"h-5 px-2 text-[10px] rounded-full"},{default:c(()=>[T("Ch "+p(t.chapter.chapter_number),1)]),_:1})]),s("div",zo,[oe.value?(n(),S(e(m),{key:0,variant:"ghost",size:"sm",class:"h-6 px-2 text-zinc-500 hover:text-foreground gap-1 rounded-full text-[10px]",onClick:o[5]||(o[5]=a=>K(oe.value.chapter_number)),title:`Previous: ${oe.value.title}`},{default:c(()=>[r(e(Bt),{class:"w-3 h-3"}),o[17]||(o[17]=T(" Prev ",-1))]),_:1},8,["title"])):C("",!0),se.value?(n(),S(e(m),{key:1,variant:"ghost",size:"sm",class:"h-6 px-2 text-zinc-500 hover:text-foreground gap-1 rounded-full text-[10px]",onClick:o[6]||(o[6]=a=>K(se.value.chapter_number)),title:`Next: ${se.value.title}`},{default:c(()=>[o[18]||(o[18]=T(" Next ",-1)),r(e(Nt),{class:"w-3 h-3"})]),_:1},8,["title"])):C("",!0)])]),s("div",$o,[s("div",jo,[s("div",Eo,[r(e(m),{variant:"ghost",size:"icon",class:"h-8 w-8 text-zinc-700 dark:text-zinc-300 hover:text-foreground rounded-full",onClick:o[7]||(o[7]=a=>e(P).visit(e(E)("projects.show",t.project.slug))),title:"Back to Project"},{default:c(()=>[r(e(Oe),{class:"w-4 h-4"})]),_:1}),o[19]||(o[19]=s("div",{class:"h-4 w-px bg-border/50 mx-1"},null,-1)),r(e(m),{onClick:ot,variant:"ghost",size:"icon",class:M(["h-8 w-8 transition-all duration-300 rounded-full",k.value?"text-primary":"text-zinc-700 dark:text-zinc-300 hover:text-foreground"]),title:"Toggle Chapter Navigation"},{default:c(()=>[k.value?(n(),S(e(Dt),{key:0,class:"w-4 h-4"})):(n(),S(e(Ht),{key:1,class:"w-4 h-4"}))]),_:1},8,["class"])]),o[21]||(o[21]=s("div",{class:"h-4 w-px bg-border/50"},null,-1)),s("div",To,[s("div",Ao,[s("div",{class:M(["w-2 h-2 rounded-full transition-colors duration-300",e(N)?"bg-amber-500 animate-pulse":"bg-emerald-500"])},null,2),s("span",Lo,p(e(N)?"Unsaved":"Saved"),1)]),r(e(O),{orientation:"vertical",class:"h-3"}),e(Z)?(n(),g("div",Ro,[r(e(Be),{class:"w-3 h-3 animate-spin text-primary"}),o[20]||(o[20]=s("span",{class:"text-xs text-muted-foreground"},"Analyzing",-1))])):(n(),g("div",Po,p(e(b)?.word_count??t.chapter.word_count)+" words ",1))])]),o[24]||(o[24]=s("div",{class:"flex-1 px-4 min-w-0"},[s("div",{id:"manual-editor-toolbar",class:"mx-auto max-w-[950px]"})],-1)),s("div",Oo,[s("div",Uo,[r(e(m),{variant:"ghost",size:"icon",class:"h-7 w-7 rounded-full text-zinc-700 dark:text-zinc-300 hover:text-foreground",onClick:e(et),title:e(xe)?"Switch to Light Mode":"Switch to Dark Mode"},{default:c(()=>[e(xe)?(n(),S(e(Kt),{key:0,class:"w-4 h-4"})):(n(),S(e(qt),{key:1,class:"w-4 h-4"}))]),_:1},8,["onClick","title"]),r(e(m),{variant:"ghost",size:"icon",class:"h-7 w-7 rounded-full text-zinc-700 dark:text-zinc-300 hover:text-foreground",onClick:Je,title:be.value?"Exit Full Screen":"Enter Full Screen"},{default:c(()=>[be.value?(n(),S(e(Vt),{key:0,class:"w-4 h-4"})):(n(),S(e(Tt),{key:1,class:"w-4 h-4"}))]),_:1},8,["title"]),r(e(m),{onClick:fe,variant:"ghost",size:"icon",class:M(["h-7 w-7 rounded-full transition-all duration-300",e(ge)?"bg-background shadow-sm text-primary":"text-zinc-700 dark:text-zinc-300 hover:text-foreground"]),title:"Toggle AI Chat Mode"},{default:c(()=>[r(e(Ue),{class:"w-4 h-4"})]),_:1},8,["class"]),r(e(m),{onClick:st,variant:"ghost",size:"icon",class:M(["h-7 w-7 rounded-full transition-all duration-300",w.value?"bg-background shadow-sm text-primary":"text-zinc-700 dark:text-zinc-300 hover:text-foreground"]),title:"Toggle Tools Sidebar"},{default:c(()=>[w.value?(n(),S(e(At),{key:0,class:"w-4 h-4"})):(n(),S(e(Lt),{key:1,class:"w-4 h-4"}))]),_:1},8,["class"])]),o[23]||(o[23]=s("div",{class:"w-px h-4 bg-border/50"},null,-1)),e(z)?(n(),S(Ot,{key:0,balance:e(z),compact:""},null,8,["balance"])):C("",!0),r(Rt,{project:t.project,"current-chapter":t.chapter,"all-chapters":t.allChapters,size:"sm",variant:"outline",class:"h-9","button-class":"rounded-full bg-background/50"},null,8,["project","current-chapter","all-chapters"]),r(e(m),{variant:"ghost",size:"sm",class:"h-9 gap-2 text-zinc-700 dark:text-zinc-300 hover:text-foreground rounded-full bg-background/50 border border-transparent hover:border-border/50",onClick:Ze,title:"Open bulk analysis"},{default:c(()=>[r(e(Wt),{class:"w-4 h-4"}),o[22]||(o[22]=s("span",{class:"text-xs font-medium"},"Analyze",-1))]),_:1}),r(e(m),{variant:"outline",size:"sm",class:"h-9 gap-2 text-zinc-700 dark:text-zinc-300 hover:text-foreground rounded-full bg-background/50",onClick:Q,disabled:e(j),title:"Save (Ctrl+S)"},{default:c(()=>[r(e(de),{class:"w-4 h-4"}),s("span",Io,p(e(j)?"Saving...":"Save"),1)]),_:1},8,["disabled"])])])]),s("div",Fo,[s("div",Bo,[o[25]||(o[25]=s("span",{class:"font-medium"},"Writing Progress",-1)),s("span",null,p(e(b)?.word_count??t.chapter.word_count)+" / "+p(t.chapter.target_word_count)+" words",1)]),r(e(gt),{"model-value":tt.value,class:"h-1.5"},null,8,["model-value"])]),s("div",No,[r(Re,{"enter-active-class":"transition-all duration-500 cubic-bezier(0.4, 0, 0.2, 1)","enter-from-class":"-ml-[320px] opacity-0","enter-to-class":"ml-0 opacity-100","leave-active-class":"transition-all duration-500 cubic-bezier(0.4, 0, 0.2, 1)","leave-from-class":"ml-0 opacity-100","leave-to-class":"-ml-[320px] opacity-0"},{default:c(()=>[k.value&&!_.value?(n(),g("aside",Do,[s("div",Ho,[s("div",Ko,[o[26]||(o[26]=s("h2",{class:"text-sm font-semibold text-foreground mb-1"},"Table of Contents",-1)),s("p",qo,p(t.allChapters.length)+" Chapters",1)]),r(jt,{"all-chapters":t.allChapters,"current-chapter":t.chapter,project:t.project,outlines:t.project.outlines||[],"faculty-chapters":t.facultyChapters||[],"current-word-count":e(b)?.word_count||t.chapter.word_count,"target-word-count":t.chapter.target_word_count,"writing-quality-score":0,"chapter-content-length":e(h)?.length||0,onGoToChapter:K,onGenerateNextChapter:ze,onDeleteChapter:$e},null,8,["all-chapters","current-chapter","project","outlines","faculty-chapters","current-word-count","target-word-count","chapter-content-length"])])])):C("",!0)]),_:1}),s("div",{class:M(["flex-1 flex overflow-hidden",B.value?"flex-row":"flex-col"])},[s("div",{class:M(["flex flex-col overflow-hidden",B.value?"w-1/2 border-r border-border/50":"flex-1"])},[s("div",Vo,[r(ft,{ref_key:"editorRef",ref:D,modelValue:e(h),"onUpdate:modelValue":F,"onUpdate:selectedText":o[8]||(o[8]=a=>ee.value=a),"onUpdate:selectionRange":o[9]||(o[9]=a=>te.value=a),"manual-mode":!0,"toolbar-teleport-target":_.value?"":"#manual-editor-toolbar",class:"min-h-full"},null,8,["modelValue","toolbar-teleport-target"])])],2),B.value?(n(),g("div",Wo,[s("div",Go,[r(Pe,{"show-citation-helper":L.value,"onUpdate:showCitationHelper":o[10]||(o[10]=a=>L.value=a),"chapter-content":e(h),"chapter-id":t.chapter.id,"citation-operation-mode":!0,onInsertCitation:re,onExitOperationMode:ve},null,8,["show-citation-helper","chapter-content","chapter-id"])])])):C("",!0)],2),r(Re,{"enter-active-class":"transition-all duration-500 cubic-bezier(0.4, 0, 0.2, 1)","enter-from-class":"-mr-[400px] opacity-0","enter-to-class":"mr-0 opacity-100","leave-active-class":"transition-all duration-500 cubic-bezier(0.4, 0, 0.2, 1)","leave-from-class":"mr-0 opacity-100","leave-to-class":"-mr-[400px] opacity-0"},{default:c(()=>[w.value&&!_.value?(n(),g("aside",Qo,[e(ge)?(n(),g("div",Xo,[s("div",Yo,[r(mo,{messages:e(Ke),"is-loading":e(qe),analysis:e(b),class:"h-full",onSend:e(We),onClose:fe},null,8,["messages","is-loading","analysis","onSend"])])])):(n(),g("div",Jo,[e(J)?(n(),g("div",Zo,[r(wt,{suggestion:e(J),analysis:e(b),onSave:e(pe),onClear:e(me),onApply:e(he)},null,8,["suggestion","analysis","onSave","onClear","onApply"]),r(e(O),{class:"bg-border/50"})])):C("",!0),r(yt,{"project-slug":t.project.slug,"chapter-number":t.chapter.chapter_number,"selected-text":ee.value,"chapter-content":e(h),"is-processing":e(Z)||e(j),"ensure-balance":Se,"on-usage":Me,onTextImproved:ye,onTextExpanded:Ce,onCitationsSuggested:_e,onTextRephrased:ke,onOpenCitationHelper:o[11]||(o[11]=a=>L.value=!0)},null,8,["project-slug","chapter-number","selected-text","chapter-content","is-processing"]),r(e(O),{class:"bg-border/50"}),H.value?(n(),g("div",es,[s("div",ts,[o[28]||(o[28]=s("h3",{class:"text-sm font-semibold text-foreground"},"Citation Suggestions",-1)),r(e(m),{size:"sm",variant:"outline",onClick:rt},{default:c(()=>[...o[27]||(o[27]=[T(" Copy ",-1)])]),_:1})]),s("pre",os,p(H.value),1),r(e(O),{class:"bg-border/50"})])):C("",!0),s("div",ss,[r(Pe,{"show-citation-helper":L.value,"onUpdate:showCitationHelper":o[12]||(o[12]=a=>L.value=a),"chapter-content":e(h),"chapter-id":t.chapter.id,onInsertCitation:re,onEnterOperationMode:Ye},null,8,["show-citation-helper","chapter-content","chapter-id"])]),r(e(O),{class:"bg-border/50"}),r(e(O),{class:"bg-border/50"})]))])):C("",!0)]),_:1}),r(Ct,{"show-left-sidebar":k.value,"show-right-sidebar":w.value,"is-mobile":_.value,"all-chapters":t.allChapters,"current-chapter":t.chapter,project:t.project,"faculty-chapters":t.facultyChapters,"current-word-count":e(b)?.word_count||t.chapter.word_count,"target-word-count":t.chapter.target_word_count,"chapter-content-length":e(h)?.length||0,"selected-text":ee.value,"is-analyzing":e(Z),"is-saving":e(j),"current-suggestion":e(J),"current-analysis":e(b),"chapter-content":e(h),"show-citation-helper":L.value,"ensure-balance":Se,"on-usage":Me,"onUpdate:showLeftSidebar":o[13]||(o[13]=a=>k.value=a),"onUpdate:showRightSidebar":o[14]||(o[14]=a=>w.value=a),"onUpdate:showCitationHelper":o[15]||(o[15]=a=>L.value=a),onGoToChapter:K,onGenerateNextChapter:ze,onDeleteChapter:$e,onSaveSuggestion:e(pe),onClearSuggestion:e(me),onApplySuggestion:e(he),onTextImproved:ye,onTextExpanded:Ce,onCitationsSuggested:_e,onTextRephrased:ke,onInsertCitation:re},null,8,["show-left-sidebar","show-right-sidebar","is-mobile","all-chapters","current-chapter","project","faculty-chapters","current-word-count","target-word-count","chapter-content-length","selected-text","is-analyzing","is-saving","current-suggestion","current-analysis","chapter-content","show-citation-helper","onSaveSuggestion","onClearSuggestion","onApplySuggestion"])]),s("footer",rs,[s("div",as,[s("div",ns,[s("span",is,[o[29]||(o[29]=s("span",{class:"hidden sm:inline"},"Words: ",-1)),s("strong",ls,p(e(b)?.word_count??t.chapter.word_count),1),T(" / "+p(t.chapter.target_word_count),1)]),e(b)?(n(),g("span",ds,[o[30]||(o[30]=T(" Citations: ",-1)),s("strong",cs,p(e(b).citation_count),1)])):C("",!0),e(b)?(n(),g("span",us,[o[31]||(o[31]=T(" Tables: ",-1)),s("strong",ps,p(e(b).table_count),1)])):C("",!0),e(b)?(n(),g("span",ms," Quality: "+p(e(b).quality_metrics.reading_level),1)):C("",!0)]),s("div",hs,[r(e(m),{variant:"outline",size:"sm",class:"h-8 md:h-9 gap-2 flex-1 sm:flex-initial",onClick:Q,disabled:e(j),title:"Save chapter"},{default:c(()=>[r(e(de),{class:"w-3.5 h-3.5 md:w-4 md:h-4"}),s("span",gs,p(e(j)?"Saving...":"Save"),1)]),_:1},8,["disabled"]),r(e(m),{variant:"default",size:"sm",class:"h-8 md:h-9 gap-2 flex-1 sm:flex-initial",onClick:at,disabled:e(j),title:"Save and mark chapter as complete"},{default:c(()=>[r(e(Gt),{class:"w-3.5 h-3.5 md:w-4 md:h-4"}),o[32]||(o[32]=s("span",{class:"text-xs font-medium hidden sm:inline"},"Mark Complete",-1)),o[33]||(o[33]=s("span",{class:"text-xs font-medium sm:hidden"},"Complete",-1))]),_:1},8,["disabled"])])])]),r(Ut,{open:e($),"current-balance":e(x),"required-words":e(I),action:e(W),"onUpdate:open":o[16]||(o[16]=a=>$.value=a),onClose:e(l)},null,8,["open","current-balance","required-words","action","onClose"]),r(e(Pt),{position:"top-center"})])],64))}}),Xr=Qt(fs,[["__scopeId","data-v-9283fcc9"]]);export{Xr as default};
