import{bs as Y,ck as q,bA as Pe,cR as Le,ca as Fe,cb as se,cl as N,bt as Ge,cn as j,co as g,cp as x,cr as o,cq as h,bE as l,cU as Me,cB as C,cG as P,cu as F,ct as v,cF as Ae,dg as he,cs as A,cS as _e,df as xe,ft as Ee,dw as re,dK as Re,cQ as We,dj as ze,h0 as Ie,h3 as qe,dH as we,h4 as ye,ha as Ve,d1 as Be,cL as Oe,cj as E,ce as ke}from"./vendor-BwJgEX4g.js";import{_ as Ue}from"./index-DXsLaJg_.js";import{_ as Q}from"./index-Dh4Dof5h.js";import{_ as Ce}from"./CardContent.vue_vue_type_script_setup_true_lang-CHCDuRZd.js";import{_ as Se,a as je}from"./index-1ECBvjik.js";import{_ as Ne}from"./AlertTitle.vue_vue_type_script_setup_true_lang-C6MI-NlN.js";import{a as Ye}from"./AppLayout.vue_vue_type_script_setup_true_lang-DgIUSJU0.js";import{_ as He}from"./SafeHtmlText.vue_vue_type_script_setup_true_lang--LMJo8yA.js";import{_ as Ke}from"./PurchaseModal.vue_vue_type_script_setup_true_lang-B50RHn40.js";import{u as Qe}from"./useWordBalance-CZEmJJqq.js";import{_ as Je}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./UserInfo.vue_vue_type_script_setup_true_lang-Be-HwAt8.js";import"./TooltipTrigger.vue_vue_type_script_setup_true_lang-DJ0GQY-9.js";import"./Sonner.vue_vue_type_script_setup_true_lang-BX3Dlz2r.js";import"./AppLogo.vue_vue_type_script_setup_true_lang-CKHRxUG0.js";import"./WordBalanceDisplay.vue_vue_type_script_setup_true_lang-CgPuWSvn.js";import"./useAppearance-ninCSMwp.js";import"./PWAInstallPrompt.vue_vue_type_script_setup_true_lang-6LJd3mi5.js";import"./DialogContent.vue_vue_type_script_setup_true_lang-9N0hzFWp.js";import"./DialogDescription.vue_vue_type_script_setup_true_lang-CmiNOxGF.js";import"./DialogFooter.vue_vue_type_script_setup_true_lang-RfXEi-XF.js";import"./DialogTitle.vue_vue_type_script_setup_true_lang-uESiFFP8.js";function Xe(J,b){const a=Y({status:"not_started",progress:0,currentStage:"",message:"",isConnected:!1,error:null}),p=Y([]),R=Y([]),c=Y({}),V=Y(null),$=new Set,G=new Map,X=new Map;let L=null,m=null,B=null;const oe=5e3;let O=null;const ae=2e3,K=q(()=>["pending","processing"].includes(a.value.status)),Z=q(()=>a.value.status==="completed"),D=q(()=>a.value.status==="failed"),ne=q(()=>a.value.status==="failed"&&a.value.progress>0),U=q(()=>{if(Z.value)return"Completed";if(D.value)return"Stopped";if(!K.value)return"Est. 15-20m";const e=c.value.chapter_timings||{},s=Object.keys(e).length,t=c.value.total_chapters||5;if(s>0){const y=Object.values(e).reduce((T,H)=>T+H,0)/s,M=(t-s)*y+60;return M<60?"< 1 min remaining":`~${Math.ceil(M/60)} min${M>=120?"s":""} remaining`}const n=100-a.value.progress,d=Math.ceil(n/100*20);return`~${d} min${d>1?"s":""} remaining`}),z=()=>{if(L){console.warn("Already connected to WebSocket");return}try{L=new Fe({broadcaster:"reverb",key:"waxjdrpfwoo04quppd3r",wsHost:"ws.finalyze.live",wsPort:"443",wssPort:"443",forceTLS:!0,enabledTransports:["ws","wss"]}),m=L.private(`project.${J}.generation`),m.subscribed(()=>{console.log("‚úÖ Connected to generation channel"),a.value.isConnected=!0,a.value.error=null}),m.error(e=>{console.error("‚ùå Channel error:",e),a.value.error="WebSocket connection error"}),ie(),console.log("üîå Connecting to WebSocket channel...")}catch(e){console.error("Failed to initialize WebSocket:",e),a.value.error="Failed to connect to real-time updates"}},ie=()=>{m&&(m.listen(".generation.started",e=>{console.log("üì° Generation started:",e),ee(e)}),m.listen(".generation.literature_mining",e=>{console.log("üìö Literature mining:",e),le(e)}),m.listen(".generation.chapter.started",e=>{console.log("üìù Chapter started:",e),ce(e)}),m.listen(".generation.chapter.progress",e=>{console.log("‚è≥ Chapter progress:",e),de(e)}),m.listen(".generation.chapter.completed",e=>{console.log("‚úÖ Chapter completed:",e),ue(e)}),m.listen(".generation.completed",e=>{console.log("üéâ Generation completed:",e),pe(e)}),m.listen(".generation.failed",e=>{console.log("‚ùå Generation failed:",e),ge(e)}))},ee=e=>{a.value.status="processing",a.value.progress=e.progress,a.value.currentStage=e.current_stage,a.value.message=e.message,c.value={...c.value,total_chapters:e.total_chapters,is_resume:e.is_resume,estimated_duration:e.estimated_duration},te(e.total_chapters||5),I(),i({type:e.is_resume?"info":"stage",message:e.is_resume?"üîÑ Resuming generation sequence...":"üöÄ Starting generation sequence..."})},le=e=>{a.value.progress=e.progress,a.value.currentStage="literature_mining",a.value.message=e.message;const s=p.value.find(t=>t.id==="literature_mining");s&&(s.status="active",s.progress=(e.progress-0)/20*100,s.description=e.message),i({type:"mining",message:e.message,source:e.source}),e.sub_stage==="completed"&&e.source==="complete"&&s&&(s.status="completed",s.progress=100)},ce=e=>{const s=e.chapter_number;S(),a.value.progress=e.progress,a.value.currentStage=`chapter_generation_${s}`,a.value.message=e.message,c.value={...c.value,current_chapter:s,total_chapters:e.total_chapters},me(s,e.chapter_title,e.target_word_count),u(s);const t=p.value.find(n=>n.id===`chapter_generation_${s}`);t&&(t.status="active",t.progress=0,t.chapterProgress=10,t.chapterTitle=e.chapter_title||t.chapterTitle||t.description,t.progressMessage=e.stage_description||e.message||t.progressMessage),X.set(s,Date.now()),w(s,30),i({type:"chapter_progress",message:`üìù Starting Chapter ${s}: ${e.chapter_title}`,chapter:s})},de=e=>{const s=e.chapter_number;if(S(),a.value.progress=e.progress,a.value.message=e.stage_description||e.message,s>0){const t=p.value.find(n=>n.id===`chapter_generation_${s}`);if(t){t.chapterProgress=e.chapter_progress,t.wordCount=e.current_word_count,t.progressMessage=e.stage_description||e.message||t.progressMessage;const n=Date.now(),d=e.current_word_count??t.wordCount??0,_=G.get(s);if(!_)G.set(s,{lastCount:d,lastAt:n,velocity:0});else{const T=d-_.lastCount,H=(n-_.lastAt)/1e3;if(T>0&&H>0){const be=T/H,Te=_.velocity>0?_.velocity*.7+be*.3:be;_.velocity=Te,_.lastCount=d,_.lastAt=n,G.set(s,_)}}const y=G.get(s)?.velocity??0;t.wordVelocity=y>0?y:void 0;const W=e.chapter_progress??t.chapterProgress??0,M=X.get(s);if(M&&W>0){const T=Math.max(1,Math.round((n-M)/1e3));t.etaSeconds=Math.ceil(T*(100-W)/W)}else t.etaSeconds=void 0}c.value={...c.value,chapter_progress:e.chapter_progress,current_word_count:e.current_word_count},console.log(`üìä Real progress: Chapter ${s} - ${e.chapter_progress}% (${e.current_word_count} words)`)}},ue=e=>{const s=e.chapter_number;S(),a.value.progress=e.progress,a.value.message=e.message;const t=p.value.find(d=>d.id===`chapter_generation_${s}`);t&&(t.status="completed",t.progress=100,t.chapterProgress=100,t.wordCount=e.word_count,t.generationTime=e.generation_time,t.etaSeconds=0);const n=c.value.chapter_timings||{};n[s]=e.generation_time,c.value={...c.value,chapter_timings:n,chapters_completed:e.chapters_completed},i({type:"chapter_completed",message:`‚úÖ Chapter ${s} completed (${e.word_count?.toLocaleString()} words in ${e.generation_time}s)`,chapter:s,generationTime:e.generation_time})},pe=e=>{a.value.status="completed",a.value.progress=100,a.value.currentStage="completed",a.value.message="Project generation completed successfully!",f(),S();const s=p.value.find(t=>t.id==="html_conversion");s&&(s.status="completed",s.progress=100),V.value=e.download_links||null,c.value={...c.value,total_word_count:e.total_word_count,total_duration:e.total_duration,papers_collected:e.papers_collected},i({type:"success",message:`üéâ Project generation completed! (${e.total_word_count?.toLocaleString()} words in ${Math.round(e.total_duration||0)}s)`})},ge=e=>{a.value.status="failed",a.value.message=e.error_message||"Generation failed",a.value.error=e.error_message||null,f(),S();const s=p.value.find(t=>t.id===e.failed_stage);s&&(s.status="error"),c.value={...c.value,can_resume:e.can_resume,last_successful_chapter:e.last_successful_chapter},i({type:"error",message:`‚ùå Generation failed: ${e.error_message}`,chapter:e.failed_chapter})},te=e=>{const s=75/e;p.value=[{id:"literature_mining",name:"Literature Mining",description:"Collecting research papers from academic databases",status:"pending",progress:0,range:[0,20]}];for(let t=1;t<=e;t++){const n=20+(t-1)*s,d=20+t*s;p.value.push({id:`chapter_generation_${t}`,name:`Chapter ${t}`,description:`Chapter ${t}`,chapterTitle:`Chapter ${t}`,status:"pending",progress:0,chapterProgress:0,wordCount:0,targetWordCount:0,range:[n,d]}),$.add(t)}p.value.push({id:"html_conversion",name:"Finalizing Project",description:"Formatting content and preparing final document",status:"pending",progress:0,range:[95,100]})},me=(e,s,t)=>{if($.has(e)){const T=p.value.find(H=>H.id===`chapter_generation_${e}`);T&&(T.chapterTitle=s,T.targetWordCount=t);return}const d=75/Math.max($.size+1,e),_=20+(e-1)*d,y=20+e*d,W={id:`chapter_generation_${e}`,name:`Chapter ${e}`,description:s,chapterTitle:s,status:"pending",progress:0,chapterProgress:0,wordCount:0,targetWordCount:t,range:[_,y]},M=p.value.findIndex(T=>T.id==="html_conversion");p.value.splice(M,0,W),$.add(e),fe()},fe=()=>{const e=p.value.filter(n=>n.id.startsWith("chapter_generation_")),t=75/e.length;e.forEach((n,d)=>{const _=20+d*t,y=20+(d+1)*t;n.range=[_,y]})},u=e=>{const s=p.value.find(t=>t.id==="literature_mining");s&&s.status!=="completed"&&(s.status="completed",s.progress=100);for(let t=1;t<e;t++){const n=p.value.find(d=>d.id===`chapter_generation_${t}`);n&&n.status!=="completed"&&(n.status="completed",n.progress=100,n.chapterProgress=100)}},i=e=>{R.value.unshift({...e,timestamp:new Date().toISOString()}),R.value.length>100&&R.value.pop()},r=e=>{switch(e){case"success":return"success";case"error":return"error";case"chapter_completed":return"chapter_completed";case"chapter_started":case"chapter_progress":return"chapter_progress";case"mining":return"mining";case"conversion":return"conversion";case"stage":return"stage";default:return"info"}},k=e=>{a.value.status=e.status,a.value.progress=e.progress??0,a.value.currentStage=e.current_stage||"",a.value.message=e.message||"",a.value.error=e.status==="failed"?e.message:null,c.value=e.metadata||{},V.value=e.download_links||null,$.clear();const s=e.chapter_statuses?.length||c.value.total_chapters||5;if(te(s),c.value={...c.value,total_chapters:c.value.total_chapters||s},e.chapter_statuses?.forEach(t=>{const n=p.value.find(d=>d.id===`chapter_generation_${t.chapter_number}`);n&&(n.chapterTitle=t.title||n.chapterTitle||n.description,n.targetWordCount=t.target_word_count??n.targetWordCount,(t.is_completed||t.status==="completed")&&(n.status="completed",n.progress=100,n.chapterProgress=100,n.wordCount=t.word_count,n.generationTime=c.value?.chapter_timings?.[t.chapter_number]))}),["processing","pending"].includes(e.status)){if(e.current_stage){const t=p.value.find(n=>n.id===e.current_stage);if(t&&(t.status="active",t.id.startsWith("chapter_generation_"))){const n=Number(e.current_stage.replace("chapter_generation_","")),d=e.metadata?.chapter_progress??c.value.chapter_progress??0,_=e.metadata?.current_word_count??c.value.current_word_count;c.value={...c.value,current_chapter:n,chapter_progress:d,current_word_count:_},t.chapterProgress=d,t.wordCount=_??t.wordCount,w(n,30)}if(e.current_stage.includes("chapter_generation")){const n=p.value.find(d=>d.id==="literature_mining");n&&(n.status="completed",n.progress=100)}if(e.current_stage==="html_conversion"){const n=p.value.find(d=>d.id==="html_conversion");n&&(n.status="active",n.progress=e.progress||n.progress)}}I()}if(e.status==="completed"&&(a.value.progress=100,p.value.forEach(t=>{t.status="completed",t.progress=100,t.chapterProgress!==void 0&&(t.chapterProgress=100)})),e.status==="failed"&&e.current_stage){const t=p.value.find(n=>n.id===e.current_stage);t&&(t.status="error")}e.details?.length&&(R.value=e.details.map(t=>({timestamp:t.timestamp,type:r(t.type),message:t.message,chapter:t.chapter,generationTime:t.generation_time,source:t.source})).reverse())},I=()=>{B||(console.log("üì° Starting polling fallback"),B=setInterval(async()=>{if(!K.value){f();return}try{const s=(await se.get(N("api.projects.bulk-generate.status",b))).data;if(s.progress>a.value.progress||s.status!==a.value.status){if(console.log("üìä Polling update received:",{progress:s.progress,status:s.status,stage:s.current_stage}),a.value.progress=s.progress,a.value.status=s.status,a.value.message=s.message,a.value.currentStage=s.current_stage,s.metadata&&(c.value={...c.value,...s.metadata},s.metadata.chapter_progress!==void 0&&s.metadata.current_chapter)){const t=s.metadata.current_chapter,n=p.value.find(d=>d.id===`chapter_generation_${t}`);n&&(n.chapterProgress=s.metadata.chapter_progress,n.wordCount=s.metadata.current_word_count||0)}s.status==="completed"&&(V.value=s.download_links,f()),s.status==="failed"&&(a.value.error=s.message,f())}}catch(e){console.warn("Polling request failed:",e)}},oe))},f=()=>{B&&(clearInterval(B),B=null,console.log("üì° Polling stopped"))},w=(e,s=30)=>{if(S(),!p.value.find(y=>y.id===`chapter_generation_${e}`))return;const n=1;let d=0;const _=15;console.log(`üé¨ Starting fallback animation for Chapter ${e} (will be overridden by real progress)`),O=setInterval(()=>{d++;const y=p.value.find(M=>M.id===`chapter_generation_${e}`);if(!y||y.status!=="active"){S();return}if(d>=_){console.log("‚èπÔ∏è Fallback animation stopped - waiting for real WebSocket progress"),S();return}const W=y.chapterProgress||0;W<s&&(y.chapterProgress=Math.min(W+n,s))},ae)},S=()=>{O&&(clearInterval(O),O=null)},ve=()=>{f(),S(),m&&(m.stopListening(".generation.started"),m.stopListening(".generation.literature_mining"),m.stopListening(".generation.chapter.started"),m.stopListening(".generation.chapter.progress"),m.stopListening(".generation.chapter.completed"),m.stopListening(".generation.completed"),m.stopListening(".generation.failed")),L&&(L.leave(`project.${J}.generation`),L=null),m=null,a.value.isConnected=!1,console.log("üîå Disconnected from generation channel")},$e=()=>{a.value={status:"not_started",progress:0,currentStage:"",message:"",isConnected:a.value.isConnected,error:null},p.value=[],R.value=[],c.value={},V.value=null,$.clear()};return Pe(()=>{z()}),Le(()=>{ve()}),{state:a,stages:p,activityLog:R,metadata:c,downloadLinks:V,isGenerating:K,isCompleted:Z,hasFailed:D,canResume:ne,estimatedTimeRemaining:U,connect:z,disconnect:ve,restoreFromApiData:k,reset:$e,startPolling:I}}const Ze={class:"relative min-h-screen p-4 md:p-8 lg:p-12"},De={class:"max-w-5xl mx-auto space-y-8"},et={class:"flex flex-col gap-6"},tt={class:"flex flex-col md:flex-row items-start md:items-center justify-between gap-4"},rt={class:"flex items-center gap-3 px-4 py-2 rounded-full border border-border/50 bg-background/50 backdrop-blur-md shadow-sm self-end md:self-auto"},st={class:"relative flex h-3 w-3"},ot={key:0,class:"animate-ping absolute inline-flex h-full w-full rounded-full bg-green-400 opacity-75"},at={class:"space-y-2"},nt={class:"text-xl text-muted-foreground font-light tracking-wide"},it={class:"grid lg:grid-cols-12 gap-8 items-start relative"},lt={class:"lg:col-span-7 space-y-8 order-2 lg:order-1"},ct={class:"space-y-6 pl-2 z-10 relative"},dt={class:"relative space-y-0"},ut={class:"flex flex-col items-center"},pt={key:0,class:"w-full h-full bg-gradient-to-b from-primary to-transparent animate-pulse shadow-[0_0_10px_rgba(var(--primary),0.5)]"},gt={class:"flex items-center justify-between gap-4 p-4 rounded-xl border border-border/10 bg-card/10 backdrop-blur-md hover:border-primary/20 hover:bg-card/30 hover:shadow-[0_0_20px_rgba(var(--primary),0.1)] transition-all duration-300 group-hover:bg-card/20"},mt={class:"space-y-1 flex-1"},ft={class:"flex items-center gap-2"},ht={key:0,class:"mt-3 bg-secondary/30 rounded-lg p-3 space-y-2.5 border border-border/30 shadow-inner"},_t={class:"flex justify-between text-xs font-medium text-muted-foreground"},vt={class:"text-xs tracking-tight text-muted-foreground"},bt={class:"flex items-center justify-between text-[11px] text-muted-foreground/80"},xt={class:"font-mono"},wt={class:"font-mono"},yt={class:"h-2 w-full overflow-hidden rounded-full bg-background/50 border border-white/5"},kt={key:0,class:"absolute inset-0 bg-gradient-to-r from-transparent via-white/30 to-transparent skew-x-[-20deg] animate-shimmer",style:{"background-size":"200% 100%"}},Ct={key:0,class:"text-primary hidden sm:block"},St={class:"lg:col-span-5 flex flex-col gap-6 lg:sticky lg:top-24 lg:h-[calc(100vh-6rem)] order-1 lg:order-2"},jt={class:"group relative z-20"},Pt={class:"space-y-6 md:space-y-8"},$t={class:"flex flex-col items-center justify-center py-6"},Tt={class:"relative w-48 h-48"},Lt={class:"w-full h-full -rotate-90",viewBox:"0 0 100 100"},Ft=["stroke-dasharray","stroke-dashoffset"],Gt={class:"absolute inset-0 flex flex-col items-center justify-center"},Mt={class:"text-4xl font-bold tabular-nums tracking-tighter"},At={class:"text-xs font-medium uppercase tracking-widest text-muted-foreground/80 mt-1"},Et={class:"mt-6 text-center space-y-2"},Rt={class:"text-base text-muted-foreground leading-relaxed animate-pulse-slow"},Wt={class:"flex items-center justify-center gap-2 text-sm text-muted-foreground bg-secondary/30 px-3 py-1 rounded-full w-fit mx-auto"},zt={class:"font-mono"},It={class:"flex flex-col gap-4 pt-4 border-t border-border/50"},qt={class:"grid grid-cols-2 gap-3"},Vt={class:"hidden lg:flex flex-col flex-1 min-h-0 relative"},Bt={class:"flex items-center justify-between px-1 bg-background pb-2"},Ot={class:"flex items-center gap-2"},Ut={class:"flex-1 overflow-y-auto p-4 font-mono text-xs md:text-sm scrollbar-hide relative"},Nt={key:"empty",class:"absolute inset-0 flex flex-col items-center justify-center text-gray-700 select-none"},Yt={class:"animate-pulse flex flex-col items-center gap-2"},Ht={class:"shrink-0 text-gray-600 select-none text-[10px] mt-[3px]"},Kt={key:0,class:"text-gray-500 mr-2"},Qt=Ge({__name:"BulkGeneration",props:{project:{}},setup(J){const b=J,{state:a,stages:p,activityLog:R,metadata:c,downloadLinks:V,isGenerating:$,isCompleted:G,hasFailed:X,canResume:L,estimatedTimeRemaining:m,restoreFromApiData:B,reset:oe}=Xe(b.project.id,b.project.slug),{showPurchaseModal:O,requiredWordsForModal:ae,actionDescriptionForModal:K,checkAndPrompt:Z,closePurchaseModal:D,estimates:ne}=Qe(),U=Y(!1),z=Y(!1),ie=q(()=>a.value.isConnected?"text-green-500":a.value.error?"text-red-500":"text-yellow-500"),ee=q(()=>G.value?"Project Ready!":$.value?"Generating Your Project":L.value?"Resume Generation":"Ready to Generate"),le=q(()=>{if(G.value)return"Your project has been successfully generated. You can now download it or view the chapters.";if(c.value?.current_chapter){const u=c.value.current_chapter,i=c.value.chapter_progress||0,r=p.value.find(I=>I.id===`chapter_generation_${u}`);return`Generating ${r?.chapterTitle||r?.description||`Chapter ${u}`} (${i}% complete)...`}return a.value.currentStage==="literature_mining"?"Analyzing academic databases and collecting relevant sources...":a.value.currentStage?.includes("chapter_generation")?"Writing your chapters with proper citations and formatting...":a.value.currentStage==="html_conversion"?"Finalizing formatting and preparing your document...":X.value?"Generation failed. You can resume from where it left off.":L.value?'Click "Resume Generation" to continue from the last completed step.':"Click the button below to start generating your complete project."}),ce=u=>u==="literature_mining"?Be:u==="html_conversion"?Oe:we,de=async(u=!1)=>{if(U.value||$.value)return;const i=b.project.chapters?.filter(f=>f.status!=="completed"&&(f.word_count??0)<=0).length||b.project.chapters?.length||1,r=(()=>{const f=(b.project.chapters||[]).map(w=>w.target_word_count).filter(w=>typeof w=="number"&&w>0);return f.length>0?Math.ceil(f.reduce((w,S)=>w+S,0)/f.length):2e3})(),k=ne.chapter(r)*i;if(Z(k,u?"resume bulk generation":"bulk generate chapters")){U.value=!0,u||oe();try{if((await se.post(N("api.projects.bulk-generate.start",b.project.slug),{resume:u})).data.generation_id)E.success(u?"Resuming generation...":"Generation started!");else throw new Error("No generation ID returned")}catch(f){console.error("Failed to start generation:",f),E.error(f.response?.data?.message||"Failed to start generation"),a.value.error=f.response?.data?.message||"Failed to start generation"}finally{U.value=!1}}},ue=async()=>{try{await se.post(N("api.projects.bulk-generate.cancel",b.project.slug)),E.info("Generation cancelled")}catch(u){console.error("Failed to cancel generation:",u),E.error("Failed to cancel generation")}},pe=async()=>{if(z.value)return;const u=V.value?.pdf||N("export.project.pdf",{project:b.project.slug}),i=b.project.title||b.project.topic||"Project";z.value=!0,E.loading("Generating project PDF...",{id:"download-project-pdf"});try{const r=await fetch(u,{method:"GET",headers:{Accept:"application/pdf"}});if(r.ok){const k=r.headers.get("content-type");if(k&&k.includes("application/json")){const S=await r.json();E.error("Export Failed",{id:"download-project-pdf",description:S.message||"An error occurred during PDF export."});return}const I=await r.blob(),f=window.URL.createObjectURL(I),w=document.createElement("a");w.href=f,w.download=`${b.project.slug}_full_project.pdf`,document.body.appendChild(w),w.click(),document.body.removeChild(w),window.URL.revokeObjectURL(f),E.success("Project PDF exported successfully!",{id:"download-project-pdf",description:`${i} has been downloaded as PDF.`})}else try{const k=await r.json();E.error("Export Failed",{id:"download-project-pdf",description:k.message||"An error occurred during PDF export."})}catch{E.error("Export Failed",{id:"download-project-pdf",description:"Unable to export project as PDF. Please try again."})}}catch{E.error("Export Failed",{id:"download-project-pdf",description:"Network error occurred. Please check your connection and try again."})}finally{z.value=!1}},ge=()=>{ke.visit(N("projects.show",b.project.slug))},te=()=>{ke.visit(N("projects.writing",b.project.slug))},me=u=>new Date(u).toLocaleTimeString("en-US",{hour:"2-digit",minute:"2-digit",second:"2-digit"}),fe=u=>{if(u===void 0)return"‚Äî";if(u<=0)return"<1m";const i=Math.floor(u/60),r=Math.round(u%60);return i<=0?`${r}s`:r>0?`${i}m ${r}s`:`${i}m`};return Pe(async()=>{try{const u=await se.get(N("api.projects.bulk-generate.status",b.project.slug));u.data.status!=="not_started"&&B(u.data)}catch(u){console.error("Failed to check generation status:",u)}}),(u,i)=>(g(),j(Ye,{title:ee.value},{default:x(()=>[i[19]||(i[19]=o("div",{class:"fixed inset-0 overflow-hidden pointer-events-none"},[o("div",{class:"absolute top-[-10%] right-[-5%] w-[500px] h-[500px] bg-primary/10 rounded-full blur-[100px] mix-blend-screen animate-pulse duration-3000"}),o("div",{class:"absolute bottom-[-10%] left-[-5%] w-[600px] h-[600px] bg-blue-600/5 rounded-full blur-[120px] mix-blend-screen"})],-1)),o("div",Ze,[o("div",De,[o("div",et,[o("div",tt,[h(l(Q),{variant:"outline",size:"icon",onClick:te,class:"rounded-xl border-dashed border-gray-600/30 hover:bg-gray-100/10 hover:border-primary/50 transition-all shrink-0"},{default:x(()=>[h(l(Me),{class:"h-5 w-5"})]),_:1}),o("div",rt,[o("div",st,[l(a).isConnected?(g(),C("span",ot)):P("",!0),o("span",{class:F(["relative inline-flex rounded-full h-3 w-3",l(a).isConnected?"bg-green-500":"bg-red-500"])},null,2)]),o("span",{class:F(["text-sm font-medium",ie.value])},v(l(a).isConnected?"System Online":"Connecting..."),3)])]),o("div",at,[h(He,{as:"h1",class:"text-2xl md:text-3xl font-bold tracking-tight bg-gradient-to-r from-foreground to-foreground/60 bg-clip-text text-transparent leading-tight",content:u.project.title||u.project.topic},null,8,["content"]),o("p",nt,v(ee.value),1)])]),h(Ae,{"enter-active-class":"transition duration-300 ease-out","enter-from-class":"transform -translate-y-2 opacity-0","enter-to-class":"transform translate-y-0 opacity-100","leave-active-class":"transition duration-200 ease-in","leave-from-class":"transform translate-y-0 opacity-100","leave-to-class":"transform -translate-y-2 opacity-0"},{default:x(()=>[l(a).error&&!l($)?(g(),j(l(Se),{key:0,variant:"destructive",class:"border-red-500/50 bg-red-500/10"},{default:x(()=>[h(l(he),{class:"h-4 w-4"}),h(l(Ne),null,{default:x(()=>[...i[2]||(i[2]=[A("Execution Error",-1)])]),_:1}),h(l(je),null,{default:x(()=>[A(v(l(a).error),1)]),_:1})]),_:1})):P("",!0)]),_:1}),o("div",it,[o("div",lt,[o("div",ct,[i[6]||(i[6]=o("h2",{class:"text-xl font-semibold tracking-tight"},"Generation Sequence",-1)),o("div",dt,[i[5]||(i[5]=o("div",{class:"absolute left-[19px] top-6 bottom-6 w-0.5 bg-gradient-to-b from-border/50 via-border/30 to-transparent"},null,-1)),(g(!0),C(_e,null,xe(l(p),(r,k)=>(g(),C("div",{key:r.id,class:"relative flex gap-4 group"},[o("div",ut,[o("div",{class:F(["relative z-10 flex h-8 w-8 items-center justify-center rounded-full border-2 shadow-sm transition-all duration-500",{"border-muted bg-card scale-95 opacity-70":r.status==="pending","border-primary bg-background ring-2 ring-primary/20 scale-110 shadow-[0_0_10px_rgba(var(--primary),0.3)]":r.status==="active","border-green-500 bg-green-500 text-white scale-100 shadow-green-500/20":r.status==="completed","border-red-500 bg-red-500/10 text-red-500":r.status==="error"}])},[r.status==="completed"?(g(),j(l(Ee),{key:0,class:"h-4 w-4 stroke-[3]"})):r.status==="active"?(g(),j(l(re),{key:1,class:"h-4 w-4 animate-spin text-primary"})):r.status==="error"?(g(),j(l(he),{key:2,class:"h-4 w-4"})):(g(),j(Re(ce(r.id)),{key:3,class:"h-3.5 w-3.5 text-muted-foreground"}))],2),k<l(p).length-1?(g(),C("div",{key:0,class:F(["w-0.5 flex-1 transition-all duration-700 ease-in-out mt-[-1px] mb-[-1px]",{"bg-gradient-to-b from-green-500 to-transparent":r.status==="completed","bg-transparent":r.status!=="completed"}])},[r.status==="active"?(g(),C("div",pt)):P("",!0)],2)):P("",!0)]),o("div",{class:F(["flex-1 pb-6 min-w-0 transition-opacity duration-300",{"opacity-50 hover:opacity-100":r.status==="pending"}])},[o("div",gt,[o("div",mt,[o("div",ft,[o("h3",{class:F(["font-semibold text-base tracking-tight",{"text-foreground":r.status==="active"||r.status==="completed","text-muted-foreground":r.status==="pending","text-red-500":r.status==="error"}])},v(r.name),3),r.status==="completed"&&r.generationTime?(g(),j(l(Ue),{key:0,variant:"secondary",class:"text-[10px] h-5 px-1.5 font-mono bg-secondary/50 text-secondary-foreground/70"},{default:x(()=>[A(v(r.generationTime)+"s ",1)]),_:2},1024)):P("",!0)]),o("p",{class:F(["text-sm text-balance leading-relaxed",{"text-muted-foreground/80":r.status!=="active","text-primary/90 font-medium":r.status==="active"}])},v(r.id.startsWith("chapter_generation_")&&r.chapterTitle||r.description),3),r.id.startsWith("chapter_generation_")&&(r.status==="active"||r.status==="completed")?(g(),C("div",ht,[o("div",_t,[i[3]||(i[3]=o("span",{class:"uppercase tracking-wider text-[10px]"},"Progress",-1)),o("span",vt,v(r.chapterTitle||r.description||r.name),1)]),o("div",bt,[o("span",xt,[o("span",{class:F({"text-primary font-bold":r.status==="active","text-green-500 font-bold":r.status==="completed"})},v(r.wordCount?.toLocaleString()??0),3),i[4]||(i[4]=o("span",{class:"opacity-50 mx-1"},"/",-1)),A(" "+v(r.targetWordCount?.toLocaleString()??0)+" words ",1)]),o("span",wt," ETA "+v(fe(r.etaSeconds)),1)]),o("div",yt,[o("div",{class:F(["h-full transition-all duration-700 ease-out relative overflow-hidden",{"bg-gradient-to-r from-green-500 to-emerald-400":r.status==="completed","bg-gradient-to-r from-blue-500 to-indigo-500":r.status==="active"}]),style:We({width:r.status==="completed"?"100%":`${r.chapterProgress}%`})},[r.status==="active"?(g(),C("div",kt)):P("",!0)],6)])])):P("",!0)]),r.status==="active"?(g(),C("div",Ct,[h(l(re),{class:"h-4 w-4 animate-spin"})])):P("",!0)])],2)]))),128))])])]),o("div",St,[o("div",jt,[i[13]||(i[13]=o("div",{class:"absolute -inset-0.5 bg-gradient-to-r from-primary/30 to-purple-500/30 rounded-2xl blur opacity-30 group-hover:opacity-50 transition duration-1000"},null,-1)),h(l(Ce),{class:"relative p-6 md:p-8 border-border/50 bg-card/80 backdrop-blur-xl transition-all duration-300 shadow-2xl"},{default:x(()=>[o("div",Pt,[o("div",$t,[o("div",Tt,[(g(),C("svg",Lt,[i[7]||(i[7]=o("circle",{cx:"50",cy:"50",r:"45",fill:"none",stroke:"currentColor",class:"text-secondary/30","stroke-width":"8"},null,-1)),o("circle",{cx:"50",cy:"50",r:"45",fill:"none",stroke:"url(#progress-gradient)","stroke-width":"8","stroke-linecap":"round",class:"transition-all duration-1000 ease-out","stroke-dasharray":2*Math.PI*45,"stroke-dashoffset":2*Math.PI*45*(1-l(a).progress/100)},null,8,Ft),i[8]||(i[8]=o("defs",null,[o("linearGradient",{id:"progress-gradient",x1:"0%",y1:"0%",x2:"100%",y2:"0%"},[o("stop",{offset:"0%","stop-color":"#3b82f6"}),o("stop",{offset:"50%","stop-color":"#6366f1"}),o("stop",{offset:"100%","stop-color":"#a855f7"})])],-1))])),o("div",Gt,[o("span",Mt,v(Math.round(l(a).progress))+"%",1),o("span",At,v(l(G)?"Complete":"Progress"),1)])]),o("div",Et,[o("p",Rt,v(le.value),1),o("div",Wt,[h(l(ze),{class:"h-4 w-4 text-primary"}),o("span",zt,v(l(m)),1)])])]),o("div",It,[!l($)&&!l(G)?(g(),j(l(Q),{key:0,onClick:i[0]||(i[0]=r=>de(l(L))),disabled:U.value||!l(a).isConnected,size:"lg",class:"w-full rounded-xl shadow-lg shadow-primary/20 transition-all hover:scale-[1.02] active:scale-[0.98] text-base font-semibold py-6"},{default:x(()=>[U.value?(g(),j(l(re),{key:0,class:"mr-2 h-5 w-5 animate-spin"})):(g(),j(l(Ie),{key:1,class:"mr-2 h-5 w-5 fill-current"})),A(" "+v(l(L)?"Resume Operation":"Initialize Generation"),1)]),_:1},8,["disabled"])):P("",!0),l($)?(g(),j(l(Q),{key:1,variant:"destructive",size:"lg",onClick:ue,class:"w-full rounded-xl shadow-lg shadow-destructive/20 hover:bg-destructive/90 py-6"},{default:x(()=>[...i[9]||(i[9]=[A(" Cancel Process ",-1)])]),_:1})):P("",!0),l(G)?(g(),C(_e,{key:2},[o("div",qt,[h(l(Q),{onClick:ge,size:"lg",class:"rounded-xl shadow-lg shadow-primary/20 hover:scale-[1.02] transition-all text-base py-6"},{default:x(()=>[h(l(qe),{class:"mr-2 h-5 w-5"}),i[10]||(i[10]=A(" View in Editor ",-1))]),_:1}),h(l(Q),{variant:"secondary",size:"lg",onClick:pe,disabled:z.value,class:"rounded-xl hover:bg-secondary/80 py-6"},{default:x(()=>[z.value?(g(),j(l(re),{key:0,class:"mr-2 h-4 w-4 animate-spin"})):(g(),j(l(we),{key:1,class:"mr-2 h-4 w-4"})),i[11]||(i[11]=A(" Export PDF ",-1))]),_:1},8,["disabled"])]),h(l(Se),{variant:"default",class:"bg-yellow-500/10 border-yellow-500/20 text-yellow-500"},{default:x(()=>[h(l(he),{class:"h-4 w-4"}),h(l(je),{class:"text-xs leading-relaxed"},{default:x(()=>[...i[12]||(i[12]=[A(" AI is not perfect and can make mistakes. Please review each chapter and make adjustments where necessary. This will also help you know the project well enough to defend it. ",-1)])]),_:1})]),_:1})],64)):P("",!0)])])]),_:1})]),o("div",Vt,[o("div",Bt,[o("div",Ot,[h(l(ye),{class:"h-5 w-5 text-muted-foreground"}),i[14]||(i[14]=o("h2",{class:"text-lg font-semibold tracking-tight"},"System Logs",-1))]),i[15]||(i[15]=o("div",{class:"flex gap-1.5"},[o("div",{class:"w-3 h-3 rounded-full bg-red-500/80"}),o("div",{class:"w-3 h-3 rounded-full bg-yellow-500/80"}),o("div",{class:"w-3 h-3 rounded-full bg-green-500/80"})],-1))]),h(l(Ce),{class:"flex-1 overflow-hidden bg-[#0c0c0c] border-gray-800 shadow-2xl rounded-xl flex flex-col"},{default:x(()=>[i[18]||(i[18]=o("div",{class:"bg-gray-900/50 border-b border-gray-800 p-2 flex justify-center shrink-0"},[o("span",{class:"text-[10px] uppercase font-mono tracking-widest text-gray-500"},"generation-task.sh")],-1)),o("div",Ut,[h(Ve,{name:"list",tag:"div",class:"space-y-2"},{default:x(()=>[l(R).length===0?(g(),C("div",Nt,[o("div",Yt,[h(l(ye),{class:"h-10 w-10 opacity-20"}),i[16]||(i[16]=o("p",{class:"font-sans text-sm"},"Waiting for initialization...",-1))])])):P("",!0),(g(!0),C(_e,null,xe(l(R),(r,k)=>(g(),C("div",{key:k,class:F(["flex gap-3 items-start border-l-2 pl-3 py-0.5 transition-all hover:bg-white/5",{"border-blue-500/50":r.type==="info","border-green-500/50":r.type==="success"||r.type==="chapter_completed","border-red-500/50":r.type==="error","border-purple-500/50":r.type==="stage","border-transparent":!["info","success","chapter_completed","error","stage"].includes(r.type)}])},[o("span",Ht,v(me(r.timestamp)),1),o("span",{class:F(["break-words leading-tight",{"text-blue-400":r.type==="info","text-green-400 font-medium":r.type==="success"||r.type==="chapter_completed","text-red-400 font-bold bg-red-900/10 px-1 rounded":r.type==="error","text-purple-400 font-bold":r.type==="stage","text-cyan-400":r.type==="chapter_progress","text-amber-400":r.type==="mining","text-pink-400":r.type==="conversion","text-gray-300":!r.type}])},[r.type==="stage"?(g(),C("span",Kt,"$")):P("",!0),A(" "+v(r.message),1)],2)],2))),128)),i[17]||(i[17]=o("div",{key:"cursor",class:"h-4 w-2 bg-gray-500 animate-pulse mt-2 inline-block"},null,-1))]),_:1})])]),_:1})])])])])]),h(Ke,{open:l(O),"current-balance":0,"required-words":l(ae),"action-description":l(K),"onUpdate:open":i[1]||(i[1]=r=>O.value=r),onClose:l(D)},null,8,["open","required-words","action-description","onClose"])]),_:1},8,["title"]))}}),vr=Je(Qt,[["__scopeId","data-v-0d8a5488"]]);export{vr as default};
