import{c as M,o as k,b as u,d as We,r as v,p as F,y as Be,z as Ot,g as ie,w as i,a as P,n as b,t as D,u as t,av as ke,I as oe,D as nt,e as a,X as Qe,a1 as st,Z as Wt,a_ as ot,Y as Nt,F as Oe,ct as lt,cJ as it,cK as dt,h as x,az as ut,bo as jt,bh as ct,L as Fe,cL as qt,cM as Gt,cN as Kt,c9 as Xt,aD as Yt,cE as Zt,cF as Qt,cO as Jt,cP as ea,cG as ta,bn as aa,cQ as ra,bQ as na,cR as sa,aF as oa,co as la,cS as ia,cT as da,cU as ua,f as ca,bW as ga}from"./vendor-Bd-YbXdQ.js";import{aC as fa,aD as ma,aE as pa,aF as va,aG as Ne,aH as gt,aI as ft,aJ as mt,aK as pt,aL as vt,aM as je,aN as ha,aO as xa,aj as ba,al as ya,am as wa,an as ka,ao as Ca,aP as Ta,aQ as Aa,aq as za,ar as Ma,as as Sa,at as La,au as _a,ak as $a,av as Ea,aw as Ha}from"./index-C3PXxNyG.js";import{_ as Je}from"./Progress.vue_vue_type_script_setup_true_lang-D4c9IteC.js";import{_ as qe}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{_ as p}from"./index-DhgXNBxs.js";import{_ as le}from"./Input.vue_vue_type_script_setup_true_lang-Bhu57pIq.js";import{_ as _e,a as $e}from"./DialogContent.vue_vue_type_script_setup_true_lang-B0_mTwB9.js";import{_ as Ee}from"./DialogDescription.vue_vue_type_script_setup_true_lang-o698b8xn.js";import{_ as He}from"./DialogFooter.vue_vue_type_script_setup_true_lang-CWpuYIJK.js";import{_ as Re,a as Ie}from"./DialogTitle.vue_vue_type_script_setup_true_lang-DzEVjang.js";import{_ as fe}from"./Label.vue_vue_type_script_setup_true_lang-BtVR4Xej.js";import{a as et,b as tt,c as j,f as Le,_ as at}from"./Sonner.vue_vue_type_script_setup_true_lang-aZGMRizj.js";var Ra=fa,Ia=/(?:^|\s)(==(?!\s+==)((?:[^=]+))==(?!\s+==))$/,Va=/(?:^|\s)(==(?!\s+==)((?:[^=]+))==(?!\s+==))/g,Da=ma.create({name:"highlight",addOptions(){return{multicolor:!1,HTMLAttributes:{}}},addAttributes(){return this.options.multicolor?{color:{default:null,parseHTML:n=>n.getAttribute("data-color")||n.style.backgroundColor,renderHTML:n=>n.color?{"data-color":n.color,style:`background-color: ${n.color}; color: inherit`}:{}}}:{}},parseHTML(){return[{tag:"mark"}]},renderHTML({HTMLAttributes:n}){return["mark",Ne(this.options.HTMLAttributes,n),0]},addCommands(){return{setHighlight:n=>({commands:o})=>o.setMark(this.name,n),toggleHighlight:n=>({commands:o})=>o.toggleMark(this.name,n),unsetHighlight:()=>({commands:n})=>n.unsetMark(this.name)}},addKeyboardShortcuts(){return{"Mod-Shift-h":()=>this.editor.commands.toggleHighlight()}},addInputRules(){return[va({find:Ia,type:this.type})]},addPasteRules(){return[pa({find:Va,type:this.type})]}});function Pa(n,o){return k(),M("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor","aria-hidden":"true","data-slot":"icon"},[u("path",{"fill-rule":"evenodd",d:"M2.25 12c0-5.385 4.365-9.75 9.75-9.75s9.75 4.365 9.75 9.75-4.365 9.75-9.75 9.75S2.25 17.385 2.25 12Zm13.36-1.814a.75.75 0 1 0-1.22-.872l-3.236 4.53L9.53 12.22a.75.75 0 0 0-1.06 1.06l2.25 2.25a.75.75 0 0 0 1.14-.094l3.75-5.25Z","clip-rule":"evenodd"})])}function Ua(n,o){return k(),M("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor","aria-hidden":"true","data-slot":"icon"},[u("path",{"fill-rule":"evenodd",d:"M12 2.25c-5.385 0-9.75 4.365-9.75 9.75s4.365 9.75 9.75 9.75 9.75-4.365 9.75-9.75S17.385 2.25 12 2.25ZM12.75 6a.75.75 0 0 0-1.5 0v6c0 .414.336.75.75.75h4.5a.75.75 0 0 0 0-1.5h-3.75V6Z","clip-rule":"evenodd"})])}function Fa(n,o){return k(),M("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor","aria-hidden":"true","data-slot":"icon"},[u("path",{"fill-rule":"evenodd",d:"M2.25 12c0-5.385 4.365-9.75 9.75-9.75s9.75 4.365 9.75 9.75-4.365 9.75-9.75 9.75S2.25 17.385 2.25 12ZM12 8.25a.75.75 0 0 1 .75.75v3.75a.75.75 0 0 1-1.5 0V9a.75.75 0 0 1 .75-.75Zm0 8.25a.75.75 0 1 0 0-1.5.75.75 0 0 0 0 1.5Z","clip-rule":"evenodd"})])}const Ba={class:"space-y-2"},Oa={class:"font-semibold text-sm"},Wa={key:0,class:"text-xs text-gray-600 dark:text-gray-300"},Na={class:"flex items-center space-x-2 text-xs"},ja={key:0,class:"text-gray-500"},qa={key:1,class:"text-xs text-blue-600 dark:text-blue-400"},Ga={class:"flex space-x-2 pt-2 border-t"},Ka=We({__name:"CitationNodeView",props:{node:{type:Object,required:!0},editor:{type:Object,required:!0},getPos:{type:Function,required:!0},updateAttributes:{type:Function,required:!0}},emits:["verify","edit","remove"],setup(n,{emit:o}){const c=n,C=o,f=v(!1),A=v({top:"0px",left:"0px"}),U=F(()=>c.node.attrs.text||"[Citation]"),T=F(()=>c.node.attrs.verified===!1&&c.node.attrs.confidence<.8),S=F(()=>({"citation-verified":c.node.attrs.verified,"citation-unverified":T.value,"citation-pending":!c.node.attrs.verified&&!T.value})),L=F(()=>c.node.attrs.verified?"bg-green-100 dark:bg-green-900 text-green-800 dark:text-green-200 border border-green-300 dark:border-green-700":T.value?"bg-red-100 dark:bg-red-900 text-red-800 dark:text-red-200 border border-red-300 dark:border-red-700":"bg-yellow-100 dark:bg-yellow-900 text-yellow-800 dark:text-yellow-200 border border-yellow-300 dark:border-yellow-700"),B=F(()=>c.node.attrs.verified?"text-green-600 dark:text-green-400":T.value?"text-red-600 dark:text-red-400":"text-yellow-600 dark:text-yellow-400"),O=F(()=>c.node.attrs.verified?"Verified":T.value?"Needs Review":"Pending"),K=F(()=>c.node.attrs.verified?"bg-green-100 dark:bg-green-900 text-green-800 dark:text-green-200":T.value?"bg-red-100 dark:bg-red-900 text-red-800 dark:text-red-200":"bg-yellow-100 dark:bg-yellow-900 text-yellow-800 dark:text-yellow-200"),W=w=>{if(w.stopPropagation(),f.value)$();else{const de=w.target.getBoundingClientRect();A.value={top:`${de.height+5}px`,left:"0px"},f.value=!0}},$=()=>{f.value=!1},ee=async()=>{try{const w=await axios.post("/api/citations/verify",{citation_id:c.node.attrs.id,citation_text:c.node.attrs.text});w.data.verified&&c.updateAttributes({verified:!0,confidence:w.data.confidence,data:w.data.citation,doi:w.data.citation.doi}),C("verify",w.data),$()}catch(w){console.error("Failed to verify citation:",w)}},X=()=>{C("edit",{id:c.node.attrs.id,text:c.node.attrs.text,attributes:c.node.attrs}),$()},r=()=>{if(confirm("Are you sure you want to remove this citation?")){const w=c.getPos();c.editor.commands.deleteRange({from:w,to:w+1}),C("remove",c.node.attrs.id)}$()},te=w=>{w.key==="Enter"||w.key===" "?(w.preventDefault(),W(w)):w.key==="Escape"&&$()};return Be(()=>{document.addEventListener("keydown",te)}),Ot(()=>{document.removeEventListener("keydown",te)}),(w,de)=>(k(),ie(t(gt),{class:b(["citation-node inline-block relative cursor-pointer",S.value]),onClick:W},{default:i(()=>[u("span",{class:b(["citation-text px-2 py-1 rounded text-sm font-medium transition-all duration-200",L.value])},D(U.value),3),u("span",{class:b(["verification-indicator ml-1",B.value])},[n.node.attrs.verified?(k(),ie(t(Pa),{key:0,class:"w-3 h-3"})):T.value?(k(),ie(t(Fa),{key:1,class:"w-3 h-3"})):(k(),ie(t(Ua),{key:2,class:"w-3 h-3"}))],2),f.value?(k(),M("div",{key:0,class:"citation-popover absolute z-50 mt-2 p-4 bg-white dark:bg-gray-800 rounded-lg shadow-lg border max-w-sm",style:ke(A.value)},[u("div",Ba,[u("div",Oa,D(n.node.attrs.text||"[Citation]"),1),n.node.attrs.data&&n.node.attrs.data.title?(k(),M("div",Wa,D(n.node.attrs.data.title),1)):P("",!0),u("div",Na,[u("span",{class:b(["px-2 py-1 rounded",K.value])},D(O.value),3),n.node.attrs.confidence?(k(),M("span",ja,D(Math.round(n.node.attrs.confidence*100))+"% confidence ",1)):P("",!0)]),n.node.attrs.doi?(k(),M("div",qa," DOI: "+D(n.node.attrs.doi),1)):P("",!0),u("div",Ga,[n.node.attrs.verified?P("",!0):(k(),M("button",{key:0,onClick:ee,class:"text-xs px-2 py-1 bg-blue-600 text-white rounded hover:bg-blue-700"}," Verify ")),u("button",{onClick:X,class:"text-xs px-2 py-1 bg-gray-600 text-white rounded hover:bg-gray-700"}," Edit "),u("button",{onClick:r,class:"text-xs px-2 py-1 bg-red-600 text-white rounded hover:bg-red-700"}," Remove ")])])],4)):P("",!0),f.value?(k(),M("div",{key:1,class:"fixed inset-0 z-40",onClick:$})):P("",!0)]),_:1},8,["class"]))}}),Xa=qe(Ka,[["__scopeId","data-v-4fc4981e"]]),Ya=ft.create({name:"citation",group:"inline",inline:!0,atom:!0,addAttributes(){return{id:{default:null},text:{default:""},verified:{default:!1},confidence:{default:0},format:{default:"apa"},doi:{default:null},data:{default:{}}}},parseHTML(){return[{tag:"span[data-citation]"}]},renderHTML({HTMLAttributes:n}){return["span",Ne(n,{"data-citation":""})]},addNodeView(){return mt(Xa)},addCommands(){return{insertCitation:n=>({commands:o})=>o.insertContent({type:this.name,attrs:n}),updateCitation:(n,o)=>({state:c,dispatch:C})=>{const{doc:f,tr:A}=c;let U=!1;return f.descendants((T,S)=>{if(T.type.name===this.name&&T.attrs.id===n)return A.setNodeMarkup(S,null,{...T.attrs,...o}),U=!0,!1}),U?(C(A),!0):!1}}},addKeyboardShortcuts(){return{"Mod-Shift-c":()=>this.editor.commands.insertCitation({text:"[Citation]",verified:!1})}}}),Za={class:"text-muted-foreground text-xs mt-1 truncate max-w-full"},Qa=["src","alt","title"],Ja={key:2,class:"mt-2 w-full"},er={key:3,class:"mt-2 text-center text-sm text-muted-foreground italic"},tr={key:5,class:"absolute -top-12 left-1/2 -translate-x-1/2 flex items-center gap-1.5 px-3 py-1.5 bg-background/95 backdrop-blur-md rounded-lg border border-border shadow-lg z-10 min-w-max"},ar={class:"text-xs text-muted-foreground whitespace-nowrap"},rr={class:"grid gap-4 py-4"},nr={class:"grid gap-2"},sr={class:"grid gap-2"},or=We({__name:"ImageNodeView",props:{node:{},updateAttributes:{type:Function},deleteNode:{type:Function},selected:{type:Boolean},editor:{}},setup(n){const o=n,c=v(null),C=v(null),f=v(!1),A=v(null),U=v(0),T=v(0),S=v(0),L=v(0),B=v(o.node.attrs.width||400),O=v(o.node.attrs.height||300),K=v(!0),W=v(!1),$=v(!1),ee=v(""),X=v(""),r=v(o.node.attrs.caption||""),te=F(()=>{switch(o.node.attrs.alignment){case"left":return"mr-auto";case"right":return"ml-auto";default:return"mx-auto"}}),w=F(()=>({width:`${B.value}px`,height:`${O.value}px`,maxWidth:"100%"})),de=()=>{if(K.value=!1,W.value=!1,c.value&&!o.node.attrs.width){const m=c.value.naturalWidth,l=c.value.naturalHeight,g=600;if(m>g){const N=g/m;B.value=g,O.value=Math.round(l*N)}else B.value=m,O.value=l;o.updateAttributes({width:B.value,height:O.value,aspectRatio:m/l})}},me=()=>{K.value=!1,W.value=!0},_=(m,l)=>{if(!o.selected)return;l.preventDefault(),l.stopPropagation(),f.value=!0,A.value=m;const g="touches"in l?l.touches[0].clientX:l.clientX,N="touches"in l?l.touches[0].clientY:l.clientY;U.value=g,T.value=N,S.value=B.value,L.value=O.value,document.addEventListener("mousemove",Y),document.addEventListener("mouseup",Z),document.addEventListener("touchmove",Y),document.addEventListener("touchend",Z)},Y=m=>{if(!f.value)return;const l="touches"in m?m.touches[0].clientX:m.clientX,g="touches"in m?m.touches[0].clientY:m.clientY,N=l-U.value,ve=g-T.value,he=o.node.attrs.aspectRatio||S.value/L.value,re=A.value;let G=S.value,Q=L.value;re?.includes("e")&&(G=Math.max(100,S.value+N)),re?.includes("w")&&(G=Math.max(100,S.value-N)),re?.includes("s")&&(Q=Math.max(100,L.value+ve)),re?.includes("n")&&(Q=Math.max(100,L.value-ve)),re?.length===2&&(Math.abs(N)>Math.abs(ve)?Q=Math.round(G/he):G=Math.round(Q*he));const Te=800;G>Te&&(G=Te,Q=Math.round(G/he)),B.value=G,O.value=Q},Z=()=>{f.value&&(f.value=!1,A.value=null,o.updateAttributes({width:B.value,height:O.value}),document.removeEventListener("mousemove",Y),document.removeEventListener("mouseup",Z),document.removeEventListener("touchmove",Y),document.removeEventListener("touchend",Z))},pe=m=>{o.updateAttributes({alignment:m})},Ve=()=>{ee.value=o.node.attrs.alt||"",X.value=o.node.attrs.title||"",$.value=!0},De=()=>{o.updateAttributes({alt:ee.value,title:X.value}),$.value=!1},Ce=()=>{o.updateAttributes({caption:r.value})},ae=async()=>{const m=o.node.attrs.src;if(m&&m.startsWith("/storage/"))try{await ct.delete("/editor/images",{data:{url:m}})}catch(l){console.warn("Failed to delete image from storage:",l)}o.deleteNode()};return oe(()=>o.node.attrs.caption,m=>{m!==r.value&&(r.value=m||"")}),oe(()=>[o.node.attrs.width,o.node.attrs.height],([m,l])=>{m&&!f.value&&(B.value=m),l&&!f.value&&(O.value=l)},{immediate:!0}),nt(()=>{document.removeEventListener("mousemove",Y),document.removeEventListener("mouseup",Z),document.removeEventListener("touchmove",Y),document.removeEventListener("touchend",Z)}),(m,l)=>(k(),ie(t(gt),{class:"resizable-image-wrapper my-4"},{default:i(()=>[u("figure",{ref_key:"containerRef",ref:C,class:b(["relative inline-block",[te.value,{"ring-2 ring-primary ring-offset-2":m.selected}]])},[K.value?(k(),M("div",{key:0,class:"flex items-center justify-center bg-muted/50 rounded-lg",style:ke(w.value)},[a(t(st),{class:"w-8 h-8 animate-spin text-muted-foreground"})],4)):W.value?(k(),M("div",{key:1,class:"flex flex-col items-center justify-center bg-destructive/10 border border-destructive/30 rounded-lg p-4",style:ke(w.value)},[l[24]||(l[24]=u("span",{class:"text-destructive text-sm"},"Failed to load image",-1)),u("span",Za,D(m.node.attrs.src),1)],4)):P("",!0),Qe(u("img",{ref_key:"imageRef",ref:c,src:m.node.attrs.src,alt:m.node.attrs.alt,title:m.node.attrs.title,style:ke(w.value),class:b(["block rounded-lg object-contain",{"cursor-move":m.selected}]),onLoad:de,onError:me,draggable:"false"},null,46,Qa),[[Wt,!K.value&&!W.value]]),m.selected&&!W.value?(k(),M("div",Ja,[Qe(u("input",{"onUpdate:modelValue":l[0]||(l[0]=g=>r.value=g),type:"text",placeholder:"Add a caption...",class:"w-full text-center text-sm text-muted-foreground bg-transparent border-none focus:outline-none focus:ring-0 placeholder:text-muted-foreground/50",onBlur:Ce,onKeydown:ot(Ce,["enter"])},null,544),[[Nt,r.value]])])):m.node.attrs.caption&&!W.value?(k(),M("figcaption",er,D(m.node.attrs.caption),1)):P("",!0),m.selected&&!W.value&&!K.value?(k(),M(Oe,{key:4},[u("div",{class:"absolute -top-1.5 -left-1.5 w-3 h-3 bg-primary border-2 border-background rounded-full cursor-nw-resize z-20 hover:scale-125 transition-transform",onMousedown:l[1]||(l[1]=g=>_("nw",g)),onTouchstart:l[2]||(l[2]=g=>_("nw",g))},null,32),u("div",{class:"absolute -top-1.5 -right-1.5 w-3 h-3 bg-primary border-2 border-background rounded-full cursor-ne-resize z-20 hover:scale-125 transition-transform",onMousedown:l[3]||(l[3]=g=>_("ne",g)),onTouchstart:l[4]||(l[4]=g=>_("ne",g))},null,32),u("div",{class:"absolute -bottom-1.5 -left-1.5 w-3 h-3 bg-primary border-2 border-background rounded-full cursor-sw-resize z-20 hover:scale-125 transition-transform",onMousedown:l[5]||(l[5]=g=>_("sw",g)),onTouchstart:l[6]||(l[6]=g=>_("sw",g))},null,32),u("div",{class:"absolute -bottom-1.5 -right-1.5 w-3 h-3 bg-primary border-2 border-background rounded-full cursor-se-resize z-20 hover:scale-125 transition-transform",onMousedown:l[7]||(l[7]=g=>_("se",g)),onTouchstart:l[8]||(l[8]=g=>_("se",g))},null,32),u("div",{class:"absolute top-1/2 -left-1.5 w-3 h-3 bg-primary border-2 border-background rounded-full cursor-w-resize z-20 -translate-y-1/2 hover:scale-125 transition-transform",onMousedown:l[9]||(l[9]=g=>_("w",g)),onTouchstart:l[10]||(l[10]=g=>_("w",g))},null,32),u("div",{class:"absolute top-1/2 -right-1.5 w-3 h-3 bg-primary border-2 border-background rounded-full cursor-e-resize z-20 -translate-y-1/2 hover:scale-125 transition-transform",onMousedown:l[11]||(l[11]=g=>_("e",g)),onTouchstart:l[12]||(l[12]=g=>_("e",g))},null,32),u("div",{class:"absolute -top-1.5 left-1/2 w-3 h-3 bg-primary border-2 border-background rounded-full cursor-n-resize z-20 -translate-x-1/2 hover:scale-125 transition-transform",onMousedown:l[13]||(l[13]=g=>_("n",g)),onTouchstart:l[14]||(l[14]=g=>_("n",g))},null,32),u("div",{class:"absolute -bottom-1.5 left-1/2 w-3 h-3 bg-primary border-2 border-background rounded-full cursor-s-resize z-20 -translate-x-1/2 hover:scale-125 transition-transform",onMousedown:l[15]||(l[15]=g=>_("s",g)),onTouchstart:l[16]||(l[16]=g=>_("s",g))},null,32)],64)):P("",!0),m.selected?(k(),M("div",tr,[W.value?P("",!0):(k(),M(Oe,{key:0},[a(t(p),{variant:"ghost",size:"sm",class:b(["h-7 w-7 p-0",{"bg-primary/10 text-primary":m.node.attrs.alignment==="left"}]),onClick:l[17]||(l[17]=g=>pe("left"))},{default:i(()=>[a(t(lt),{class:"w-4 h-4"})]),_:1},8,["class"]),a(t(p),{variant:"ghost",size:"sm",class:b(["h-7 w-7 p-0",{"bg-primary/10 text-primary":m.node.attrs.alignment==="center"}]),onClick:l[18]||(l[18]=g=>pe("center"))},{default:i(()=>[a(t(it),{class:"w-4 h-4"})]),_:1},8,["class"]),a(t(p),{variant:"ghost",size:"sm",class:b(["h-7 w-7 p-0",{"bg-primary/10 text-primary":m.node.attrs.alignment==="right"}]),onClick:l[19]||(l[19]=g=>pe("right"))},{default:i(()=>[a(t(dt),{class:"w-4 h-4"})]),_:1},8,["class"]),l[26]||(l[26]=u("div",{class:"w-px h-5 bg-border mx-1"},null,-1)),a(t(p),{variant:"ghost",size:"sm",class:"h-7 px-2 text-xs gap-1",onClick:Ve},{default:i(()=>[a(t(ut),{class:"w-3 h-3"}),l[25]||(l[25]=x(" Alt ",-1))]),_:1}),l[27]||(l[27]=u("div",{class:"w-px h-5 bg-border mx-1"},null,-1)),u("span",ar,D(Math.round(B.value))+" x "+D(Math.round(O.value)),1),l[28]||(l[28]=u("div",{class:"w-px h-5 bg-border mx-1"},null,-1))],64)),a(t(p),{variant:"ghost",size:"sm",class:"h-7 w-7 p-0 text-destructive hover:text-destructive",onClick:ae},{default:i(()=>[a(t(jt),{class:"w-4 h-4"})]),_:1})])):P("",!0)],2),a(t(_e),{open:$.value,"onUpdate:open":l[23]||(l[23]=g=>$.value=g)},{default:i(()=>[a(t($e),null,{default:i(()=>[a(t(Re),null,{default:i(()=>[a(t(Ie),null,{default:i(()=>[...l[29]||(l[29]=[x("Image Properties",-1)])]),_:1}),a(t(Ee),null,{default:i(()=>[...l[30]||(l[30]=[x("Edit the alt text and title for this image.",-1)])]),_:1})]),_:1}),u("div",rr,[u("div",nr,[a(t(fe),{for:"alt-text"},{default:i(()=>[...l[31]||(l[31]=[x("Alt Text",-1)])]),_:1}),a(t(le),{id:"alt-text",modelValue:ee.value,"onUpdate:modelValue":l[20]||(l[20]=g=>ee.value=g),placeholder:"Describe this image for accessibility..."},null,8,["modelValue"]),l[32]||(l[32]=u("p",{class:"text-xs text-muted-foreground"}," Alt text helps screen readers describe the image to visually impaired users. ",-1))]),u("div",sr,[a(t(fe),{for:"title-text"},{default:i(()=>[...l[33]||(l[33]=[x("Title",-1)])]),_:1}),a(t(le),{id:"title-text",modelValue:X.value,"onUpdate:modelValue":l[21]||(l[21]=g=>X.value=g),placeholder:"Optional title shown on hover..."},null,8,["modelValue"])])]),a(t(He),null,{default:i(()=>[a(t(p),{variant:"outline",onClick:l[22]||(l[22]=g=>$.value=!1)},{default:i(()=>[...l[34]||(l[34]=[x("Cancel",-1)])]),_:1}),a(t(p),{onClick:De},{default:i(()=>[...l[35]||(l[35]=[x("Save",-1)])]),_:1})]),_:1})]),_:1})]),_:1},8,["open"])]),_:1}))}}),lr=qe(or,[["__scopeId","data-v-bc29ad5b"]]),ir=ft.create({name:"resizableImage",group:"block",atom:!0,draggable:!0,addOptions(){return{HTMLAttributes:{class:"resizable-image-block"},maxWidth:800}},addAttributes(){return{src:{default:null,parseHTML:n=>n.querySelector("img")?.getAttribute("src")||n.getAttribute("src")},alt:{default:"",parseHTML:n=>n.querySelector("img")?.getAttribute("alt")||n.getAttribute("alt")||""},title:{default:"",parseHTML:n=>n.querySelector("img")?.getAttribute("title")||n.getAttribute("title")||""},width:{default:null,parseHTML:n=>{const c=n.querySelector("img")?.getAttribute("width")||n.getAttribute("data-width");return c?parseInt(c,10):null}},height:{default:null,parseHTML:n=>{const c=n.querySelector("img")?.getAttribute("height")||n.getAttribute("data-height");return c?parseInt(c,10):null}},alignment:{default:"center",parseHTML:n=>n.getAttribute("data-alignment")||"center"},aspectRatio:{default:null,parseHTML:n=>{const o=n.getAttribute("data-aspect-ratio");return o?parseFloat(o):null}},caption:{default:"",parseHTML:n=>n.querySelector("figcaption")?.textContent||n.getAttribute("data-caption")||""}}},parseHTML(){return[{tag:"figure[data-resizable-image]"},{tag:"div[data-resizable-image]"},{tag:"img[src]",getAttrs:n=>{if(typeof n=="string")return!1;const o=n;return{src:o.getAttribute("src"),alt:o.getAttribute("alt"),title:o.getAttribute("title"),width:o.getAttribute("width")?parseInt(o.getAttribute("width"),10):null,height:o.getAttribute("height")?parseInt(o.getAttribute("height"),10):null}}}]},renderHTML({HTMLAttributes:n,node:o}){const c=Ne(this.options.HTMLAttributes,{"data-resizable-image":"","data-alignment":o.attrs.alignment,"data-width":o.attrs.width,"data-height":o.attrs.height,"data-aspect-ratio":o.attrs.aspectRatio,"data-caption":o.attrs.caption||""}),C={src:n.src||o.attrs.src,alt:o.attrs.alt||"",title:o.attrs.title||""};o.attrs.width&&(C.width=o.attrs.width),o.attrs.height&&(C.height=o.attrs.height);const f=[["img",C]];return o.attrs.caption&&f.push(["figcaption",{},o.attrs.caption]),["figure",c,...f]},addNodeView(){return mt(lr)},addCommands(){return{setImage:n=>({commands:o})=>o.insertContent({type:this.name,attrs:{src:n.src,alt:n.alt||"",title:n.title||"",width:n.width||null,height:n.height||null,caption:n.caption||"",aspectRatio:n.width&&n.height?n.width/n.height:null}}),updateImageSize:n=>({commands:o})=>o.updateAttributes(this.name,{width:n.width,height:n.height}),setImageAlignment:n=>({commands:o})=>o.updateAttributes(this.name,{alignment:n})}},addProseMirrorPlugins(){return[new pt({key:new vt("resizableImageDropPaste"),props:{handleDrop:(n,o,c,C)=>{if(C||!o.dataTransfer?.files?.length)return!1;const f=o.dataTransfer.files[0];return f.type.startsWith("image/")?(o.preventDefault(),document.dispatchEvent(new CustomEvent("tiptap-image-drop",{detail:{file:f,view:n,pos:n.posAtCoords({left:o.clientX,top:o.clientY})}})),!0):!1},handlePaste:(n,o)=>{const c=o.clipboardData?.items;if(!c)return!1;for(const C of c)if(C.type.startsWith("image/")){o.preventDefault();const f=C.getAsFile();return f&&document.dispatchEvent(new CustomEvent("tiptap-image-paste",{detail:{file:f,view:n}})),!0}return!1}}})]}}),J=new vt("ghostText"),dr=je.create({name:"ghostText",addOptions(){return{onManualTrigger:null,onAccepted:null,onDismissed:null}},addCommands(){return{setGhostText:({text:n,position:o,format:c})=>({tr:C,state:f,dispatch:A})=>{const U=typeof o=="number"?o:f.selection.to;return C.setMeta(J,{type:"set",text:n,format:c??"text",position:U}),A?.(C),!0},clearGhostText:()=>({tr:n,dispatch:o})=>(n.setMeta(J,{type:"clear"}),o?.(n),!0)}},addKeyboardShortcuts(){return{Tab:()=>{const n=J.getState(this.editor.state);if(!n?.isVisible||!n.text||!this.editor.state.selection.empty)return!1;const o=n.position,c=n.text;return this.editor.chain().focus().insertContentAt({from:o,to:o},c).command(({tr:C,dispatch:f})=>(C.setMeta(J,{type:"clear"}),f?.(C),!0)).run(),this.options.onAccepted?.(c),!0},Escape:()=>J.getState(this.editor.state)?.isVisible?(this.editor.commands.clearGhostText(),this.options.onDismissed?.(),!0):!1,"Mod-Space":()=>(this.options.onManualTrigger?.(),!0)}},addProseMirrorPlugins(){return[new pt({key:J,state:{init:()=>({text:null,format:"text",position:0,isVisible:!1}),apply:(n,o)=>{const c=n.getMeta(J);return c?.type==="clear"?{text:null,format:"text",position:0,isVisible:!1}:c?.type==="set"?{text:c.text,format:c.format,position:c.position,isVisible:!0}:n.docChanged?(o.isVisible&&this.options.onDismissed?.(),{text:null,format:"text",position:0,isVisible:!1}):n.selectionSet&&o.isVisible?(this.options.onDismissed?.(),{text:null,format:"text",position:0,isVisible:!1}):o}},props:{decorations:n=>{const o=J.getState(n);if(!o?.isVisible||!o.text)return null;const c=Math.min(Math.max(0,o.position),n.doc.content.size),C=ha.widget(c,()=>{const f=document.createElement("span");if(f.className="tiptap-ghost-text",o.format==="html"&&o.text.includes("<")){const A=document.createElement("div");A.innerHTML=o.text,f.textContent=(A.textContent||"").trim()}else f.textContent=o.text??"";return f},{side:1});return xa.create(n.doc,[C])}}})]}});var ur=je.create({name:"textAlign",addOptions(){return{types:[],alignments:["left","center","right","justify"],defaultAlignment:null}},addGlobalAttributes(){return[{types:this.options.types,attributes:{textAlign:{default:this.options.defaultAlignment,parseHTML:n=>{const o=n.style.textAlign;return this.options.alignments.includes(o)?o:this.options.defaultAlignment},renderHTML:n=>n.textAlign?{style:`text-align: ${n.textAlign}`}:{}}}}]},addCommands(){return{setTextAlign:n=>({commands:o})=>this.options.alignments.includes(n)?this.options.types.map(c=>o.updateAttributes(c,{textAlign:n})).some(c=>c):!1,unsetTextAlign:()=>({commands:n})=>this.options.types.map(o=>n.resetAttributes(o,"textAlign")).some(o=>o),toggleTextAlign:n=>({editor:o,commands:c})=>this.options.alignments.includes(n)?o.isActive({textAlign:n})?c.unsetTextAlign():c.setTextAlign(n):!1}},addKeyboardShortcuts(){return{"Mod-Shift-l":()=>this.editor.commands.setTextAlign("left"),"Mod-Shift-e":()=>this.editor.commands.setTextAlign("center"),"Mod-Shift-r":()=>this.editor.commands.setTextAlign("right"),"Mod-Shift-j":()=>this.editor.commands.setTextAlign("justify")}}}),cr=ur;const gr={class:"relative flex flex-col w-full h-full group bg-background"},fr={class:"flex items-center gap-0.5 border-r border-border/40 pr-1.5 mr-1.5 flex-shrink-0"},mr={class:"flex items-center gap-0.5 border-r border-border/40 pr-1.5 mr-1.5 flex-shrink-0"},pr={class:"text-xs text-zinc-700 dark:text-zinc-100"},vr={class:"flex items-center gap-0.5"},hr={class:"flex h-8 w-9 items-center justify-center border-y border-border/20 bg-muted/20 text-xs font-medium text-foreground"},xr={class:"flex items-center gap-0.5 border-r border-border/40 pr-1.5 mr-1.5 flex-shrink-0"},br={class:"flex items-center gap-0.5 border-r border-border/40 pr-1.5 mr-1.5 flex-shrink-0"},yr={class:"flex items-center gap-0.5 border-l border-border/20 ml-0.5 pl-0.5"},wr={class:"flex items-center gap-0.5 flex-shrink-0"},kr={class:"relative flex-1 min-h-0"},Cr={key:0,class:"absolute inset-0 z-10 flex flex-col items-center justify-center bg-background/50 backdrop-blur-[2px] transition-all duration-500"},Tr={class:"flex flex-col items-center gap-4 rounded-2xl border border-border/50 bg-background/90 p-8 shadow-xl backdrop-blur-xl"},Ar={class:"relative h-16 w-16"},zr={class:"relative flex h-full w-full items-center justify-center rounded-full bg-primary/10 ring-1 ring-primary/20"},Mr={class:"text-center"},Sr={class:"text-lg font-semibold tracking-tight"},Lr={class:"text-sm text-muted-foreground"},_r={class:"grid gap-4 py-4"},$r={class:"grid gap-2"},Er={class:"grid gap-2"},Hr={class:"grid gap-4 py-4"},Rr={class:"flex items-center gap-4"},Ir={class:"flex flex-wrap gap-2"},Vr=["onClick"],Dr={class:"grid gap-4 py-4"},Pr={class:"grid gap-2"},Ur={class:"flex items-center gap-2"},Fr={key:1,class:"text-sm text-destructive"},Br={class:"grid gap-2"},Or={class:"flex gap-2"},rt=300,Wr=We({__name:"RichTextEditor",props:{modelValue:{},placeholder:{default:"Start writing..."},readonly:{type:Boolean,default:!1},minHeight:{default:"200px"},showToolbar:{type:Boolean,default:!0},toolbarTeleportTarget:{default:""},isGenerating:{type:Boolean,default:!1},generationProgress:{default:""},generationPercentage:{default:0},generationPhase:{default:""},streamingMode:{type:Boolean,default:!1},ghostText:{default:null},ghostTextFormat:{default:"text"},ghostTextPosition:{default:null}},emits:["update:modelValue","update:selectedText","update:selectionRange","ghost-manual-trigger","ghost-accepted","ghost-dismissed"],setup(n,{expose:o,emit:c}){const C=ba(Ha),f=n,A=v(!1),U=v(0),T=v(""),S=v(null),L=c,B=je.create({name:"fontSize",addOptions(){return{types:["textStyle"]}},addGlobalAttributes(){return[{types:this.options.types,attributes:{fontSize:{default:null,parseHTML:s=>{const e=s.style.fontSize;return e||null},renderHTML:s=>s.fontSize?{style:`font-size: ${s.fontSize}`}:{}}}}]},addCommands(){return{setFontSize:s=>({chain:e})=>e().setMark("textStyle",{fontSize:s}).run(),unsetFontSize:()=>({chain:s})=>s().setMark("textStyle",{fontSize:null}).removeEmptyTextStyle().run()}}}),O=s=>{if(!s)return"";const e=s.split(`
`);let d=[],y=0;for(;y<e.length;){const E=e[y];if(E.includes("|")){const H=K(e,y);if(H.html){d.push(H.html),y=H.nextIndex;continue}}d.push(E),y++}return d.join(`
`)},K=(s,e)=>{let d=s[e];if(!d||!d.includes("|"))return{html:null,nextIndex:e+1};const y=d.split("|").map(R=>R.trim()).filter(R=>R.length>0);if(y.length===0)return{html:null,nextIndex:e+1};const E=s[e+1];if(!E||!E.includes("|")||!E.includes("-"))return{html:null,nextIndex:e+1};let H=[],h=e+2;for(;h<s.length;){const R=s[h];if(!R||!R.includes("|"))break;const V=R.split("|").map(I=>I.trim()).filter(I=>I.length>0);V.length>0&&H.push(V),h++}let z='<div class="tableWrapper"><table>';return z+="<thead><tr>",y.forEach(R=>{z+=`<th>${R}</th>`}),z+="</tr></thead>",H.length>0&&(z+="<tbody>",H.forEach(R=>{z+="<tr>";for(let V=0;V<y.length;V++){const I=R[V]||"";z+=`<td>${I}</td>`}z+="</tr>"}),z+="</tbody>"),z+="</table></div>",{html:z,nextIndex:h}},W=s=>s?(s=s.replace(/```(\w+)\n?([\s\S]*?)```/g,(e,d,y)=>`<pre><code class="language-${d}">${y.trim()}</code></pre>`),s=s.replace(/```\n?([\s\S]*?)```/g,(e,d)=>`<pre><code>${d.trim()}</code></pre>`),s):"",$=s=>{if(!s)return"";if(s.includes("<p>")||s.includes("<h1>")||s.includes("<h2>")||s.includes("<div>")||s.includes("<div "))return s;let e=s;const d=[];e=e.replace(/```mermaid\n?([\s\S]*?)```/g,(H,h)=>{const z=h.trim(),V=`<div data-mermaid data-mermaid-code="${z.replace(/&/g,"&amp;").replace(/"/g,"&quot;").replace(/</g,"&lt;").replace(/>/g,"&gt;")}" data-view-mode="diagram"><pre><code class="language-mermaid">${z}</code></pre></div>`,I=d.length;return d.push(V),`__MERMAID_PLACEHOLDER_${I}__`}),e=e.replace(/``mermaid\n?([\s\S]*?)``/g,(H,h)=>{const z=h.trim(),V=`<div data-mermaid data-mermaid-code="${z.replace(/&/g,"&amp;").replace(/"/g,"&quot;").replace(/</g,"&lt;").replace(/>/g,"&gt;")}" data-view-mode="diagram"><pre><code class="language-mermaid">${z}</code></pre></div>`,I=d.length;return d.push(V),`__MERMAID_PLACEHOLDER_${I}__`}),e=e.replace(/`mermaid\n([\s\S]*?)`/g,(H,h)=>{const z=h.trim(),V=`<div data-mermaid data-mermaid-code="${z.replace(/&/g,"&amp;").replace(/"/g,"&quot;").replace(/</g,"&lt;").replace(/>/g,"&gt;")}" data-view-mode="diagram"><pre><code class="language-mermaid">${z}</code></pre></div>`,I=d.length;return d.push(V),`__MERMAID_PLACEHOLDER_${I}__`}),e=W(e),e=e.replace(/^### (.*$)/gim,"<h3>$1</h3>"),e=e.replace(/^## (.*$)/gim,"<h2>$1</h2>"),e=e.replace(/^# (.*$)/gim,"<h1>$1</h1>"),e=e.replace(/\*\*(.*?)\*\*/g,"<strong>$1</strong>"),e=e.replace(/\*(.*?)\*/g,"<em>$1</em>"),e=e.replace(/`([^`]+)`/g,"<code>$1</code>"),e=O(e);let E=e.split(`

`).filter(H=>H.trim()).map(H=>{const h=H.trim();if(h.startsWith("<h1>")||h.startsWith("<h2>")||h.startsWith("<h3>")||h.startsWith("<div")||h.startsWith("<table")||h.startsWith("<pre")||h.startsWith("<ul")||h.startsWith("<ol")||h.startsWith("<blockquote")||h.startsWith("__MERMAID_PLACEHOLDER_"))return h;if(h.includes(`
`)&&(h.match(/^\d+\./)||h.match(/^-\s/)||h.match(/^\*\s/))){const R=h.split(`
`).map(V=>{const I=V.trim();return I.match(/^\d+\.\s/)?`<li>${I.replace(/^\d+\.\s/,"")}</li>`:I.match(/^[-*]\s/)?`<li>${I.replace(/^[-*]\s/,"")}</li>`:I}).filter(V=>V.startsWith("<li>"));return h.match(/^\d+\./)?`<ol>${R.join("")}</ol>`:`<ul>${R.join("")}</ul>`}return`<p>${h.replace(/\n/g,"<br>")}</p>`}).join("");return d.forEach((H,h)=>{E=E.replace(`__MERMAID_PLACEHOLDER_${h}__`,H)}),E},X=[ya.configure({heading:{levels:[1,2,3]},codeBlock:!1,link:!1}),wa.configure({lowlight:C,HTMLAttributes:{class:"code-block-highlighted"}}),Ra.configure({placeholder:f.placeholder}),ka,Ca,B,Ta,Da.configure({multicolor:!0}),Aa.configure({openOnClick:!1,HTMLAttributes:{class:"prose-link text-primary hover:text-primary/80 underline decoration-primary/50"}}),za.configure({resizable:!0}),Ma,Sa,La,Ya,_a,ir.configure({maxWidth:800}),cr.configure({types:["heading","paragraph"]}),dr.configure({onManualTrigger:()=>L("ghost-manual-trigger"),onAccepted:s=>L("ghost-accepted",s),onDismissed:()=>L("ghost-dismissed")})].filter((s,e,d)=>e===d.findIndex(y=>y.name===s.name)),r=$a({content:$(f.modelValue),editable:!f.readonly,extensions:X,editorProps:{attributes:{class:"prose prose-sm dark:prose-invert max-w-none focus:outline-none",style:`min-height: ${f.minHeight}; padding: 12px;`}},onUpdate:({editor:s})=>{L("update:modelValue",s.getHTML()),we()},onSelectionUpdate:({editor:s})=>{we();const{from:e,to:d,empty:y}=s.state.selection;if(y)L("update:selectedText",""),L("update:selectionRange",null),console.log("ðŸ”„ RichTextEditor - No selection, cleared");else{if(!s.state.doc)return;const E=s.state.doc.textBetween(e,d);E.split(/\s+/).filter(h=>h.length>0).length<=200?(L("update:selectedText",E),L("update:selectionRange",{from:e,to:d}),console.log("âœ… RichTextEditor - Selection emitted to parent")):(L("update:selectedText",""),L("update:selectionRange",null),console.log("âŒ RichTextEditor - Selection too long, cleared"))}}});oe(()=>f.modelValue,s=>{if(r.value){if(f.streamingMode&&A.value){de(s);return}if(r.value.getHTML()!==s){const e=$(s);r.value.commands.setContent(e,{emitUpdate:!1}),Fe(()=>{r.value&&L("update:modelValue",r.value.getHTML())})}}}),oe([()=>f.ghostText,()=>f.ghostTextFormat,()=>f.ghostTextPosition],([s,e,d])=>{if(!r.value)return;const y=(s??"").toString();if(!y){r.value.commands.clearGhostText?.();return}r.value.commands.setGhostText?.({text:y,format:e??"text",position:typeof d=="number"?d:void 0})},{immediate:!0}),oe(()=>f.streamingMode,s=>{s?te():w()});function te(){A.value=!0,U.value=0,T.value="",console.log("RichTextEditor: Streaming mode started (throttled)")}function w(){S.value&&(clearTimeout(S.value),S.value=null),T.value&&r.value&&me(T.value),A.value=!1,T.value="",U.value=0,console.log("RichTextEditor: Streaming mode ended")}function de(s){if(!r.value||!A.value)return;T.value=s;const d=Date.now()-U.value;if(d>=rt){me(s);return}if(!S.value){const y=rt-d;S.value=setTimeout(()=>{S.value=null,A.value&&T.value&&me(T.value)},y)}}function me(s){if(!r.value)return;U.value=Date.now();const e=$(s);r.value.getHTML()!==e&&r.value.commands.setContent(e,{emitUpdate:!1})}function _(){if(!r.value)return;const s=T.value||f.modelValue,e=$(s);r.value.commands.setContent(e,{emitUpdate:!1})}function Y(){const s=T.value||f.modelValue;return{length:s.length,wordCount:s.split(/\s+/).filter(e=>e.length>0).length}}oe(()=>f.readonly,s=>{r.value&&r.value.setEditable(!s)}),Be(()=>{setTimeout(()=>{r.value&&we()},100),document.addEventListener("tiptap-image-drop",Ke),document.addEventListener("tiptap-image-paste",Xe)}),nt(()=>{S.value&&(clearTimeout(S.value),S.value=null),r.value&&r.value.destroy(),document.removeEventListener("tiptap-image-drop",Ke),document.removeEventListener("tiptap-image-paste",Xe),l()});const Z=()=>r.value?.chain().focus().toggleBold().run(),pe=()=>r.value?.chain().focus().toggleItalic().run(),Ve=()=>r.value?.chain().focus().toggleStrike().run(),De=()=>r.value?.chain().focus().toggleCode().run(),Ce=()=>{r.value?.chain().focus().insertMermaid().run()},ae=v(!1);let m=null;const l=()=>{m&&(m.disconnect(),m=null)},g=()=>{if(typeof document>"u"){ae.value=!1;return}ae.value=!!(f.toolbarTeleportTarget&&document.querySelector(f.toolbarTeleportTarget))};typeof document<"u"&&g();const N=F(()=>!f.toolbarTeleportTarget||!ae.value);F(()=>!N.value);const ve=F(()=>N.value?"body":f.toolbarTeleportTarget||"body"),he=F(()=>{const s="z-20 flex items-center gap-1 border-border/40 bg-background/95 p-1.5 shadow-sm backdrop-blur-md transition-all duration-200 supports-[backdrop-filter]:bg-background/80 overflow-x-auto no-scrollbar mask-gradient-right";return N.value?`sticky top-0 mx-0 sm:mx-2 md:mx-4 mt-0 sm:mt-1 md:mt-2 mb-2 md:mb-4 rounded-none sm:rounded-lg md:rounded-xl border-y sm:border ${s}`:`w-full ${s} rounded-lg border`});oe(()=>f.toolbarTeleportTarget,async()=>{await Fe(),g()},{flush:"post"}),Be(async()=>{await Fe(),g(),!ae.value&&f.toolbarTeleportTarget&&typeof MutationObserver<"u"&&typeof document<"u"&&document.body&&(l(),m=new MutationObserver(()=>{g(),ae.value&&l()}),m.observe(document.body,{childList:!0,subtree:!0}))});const re=()=>r.value?.chain().focus().toggleUnderline().run(),G=()=>r.value?.chain().focus().toggleHeading({level:1}).run(),Q=()=>r.value?.chain().focus().toggleHeading({level:2}).run(),Te=()=>r.value?.chain().focus().toggleHeading({level:3}).run(),ht=()=>r.value?.chain().focus().toggleBulletList().run(),xt=()=>r.value?.chain().focus().toggleOrderedList().run(),bt=()=>r.value?.chain().focus().toggleBlockquote().run(),yt=()=>r.value?.chain().focus().setParagraph().run(),wt=()=>r.value?.chain().focus().undo().run(),kt=()=>r.value?.chain().focus().redo().run(),xe=v(!1),Ae=v(!1),q=v({url:"",text:""}),ne=v({color:"#000000"}),Ct=()=>{const{from:s,to:e}=r.value?.state.selection||{from:0,to:0},d=r.value?.state.doc.textBetween(s,e)||"";r.value?.isActive("link")?r.value.chain().focus().unsetLink().run():(q.value.text=d,q.value.url="",xe.value=!0)},Tt=()=>{if(q.value.url){if(q.value.text){const{from:s,to:e}=r.value?.state.selection||{from:0,to:0};r.value?.chain().focus().deleteRange({from:s,to:e}).insertContent(`<a href="${q.value.url}">${q.value.text}</a>`).run()}else r.value?.chain().focus().setLink({href:q.value.url}).run();xe.value=!1}},At=()=>{Ae.value=!0},zt=()=>{ne.value.color&&r.value?.chain().focus().setColor(ne.value.color).run(),Ae.value=!1},Mt=()=>{r.value?.chain().focus().unsetColor().run()},ue=v(!1),ce=v(""),be=v(!1),ze=v(0),ge=v(""),Me=v(null),St=()=>{ce.value="",ge.value="",ue.value=!0},Ge=()=>{ce.value&&(r.value?.chain().focus().setImage({src:ce.value}).run(),ue.value=!1)},Lt=s=>{const d=s.target.files?.[0];d&&Pe(d)},Pe=async s=>{if(!s.type.startsWith("image/")){ge.value="Please select an image file";return}be.value=!0,ge.value="",ze.value=0;try{const e=new FormData;e.append("image",s);const d=await ct.post("/editor/images",e,{headers:{"Content-Type":"multipart/form-data"},onUploadProgress:y=>{y.total&&(ze.value=Math.round(y.loaded*100/y.total))}});d.data.success&&(r.value?.chain().focus().setImage({src:d.data.url,width:d.data.width,height:d.data.height}).run(),ue.value=!1)}catch(e){ge.value=e.response?.data?.message||"Upload failed"}finally{be.value=!1,ze.value=0,Me.value&&(Me.value.value="")}},Ke=s=>{const{file:e}=s.detail;Pe(e)},Xe=s=>{const{file:e}=s.detail;Pe(e)},Ye=v("#ffff00"),_t=()=>{if(r.value?.isActive("highlight"))r.value.chain().focus().unsetHighlight().run();else{const s=prompt("Enter highlight color (hex, rgb, or color name):",Ye.value);s?(Ye.value=s,r.value?.chain().focus().setHighlight({color:s}).run()):r.value?.chain().focus().setHighlight().run()}},Se=s=>{r.value?.chain().focus().setTextAlign(s).run()},$t=()=>{r.value?.chain().focus().insertTable({rows:3,cols:3,withHeaderRow:!0}).run()},Et=()=>{r.value?.chain().focus().addColumnBefore().run()},Ht=()=>{r.value?.chain().focus().addColumnAfter().run()},Rt=()=>{r.value?.chain().focus().deleteColumn().run()},It=()=>{r.value?.chain().focus().addRowBefore().run()},Vt=()=>{r.value?.chain().focus().addRowAfter().run()},Dt=()=>{r.value?.chain().focus().deleteRow().run()},Pt=()=>{r.value?.chain().focus().deleteTable().run()},se=()=>r.value?.isActive("table")??!1,Ze=v("12pt"),ye=["8pt","9pt","10pt","11pt","12pt","14pt","16pt","18pt","20pt","24pt","28pt","36pt","48pt","72pt"],Ut=()=>{const s=Ue(),e=ye.indexOf(s);if(e===-1)r.value?.chain().focus().setFontSize("14pt").run();else if(e<ye.length-1){const d=ye[e+1];r.value?.chain().focus().setFontSize(d).run()}we()},Ft=()=>{const s=Ue(),e=ye.indexOf(s);if(e===-1)r.value?.chain().focus().setFontSize("11pt").run();else if(e>0){const d=ye[e-1];r.value?.chain().focus().setFontSize(d).run()}we()},Ue=()=>{const{from:s,to:e}=r.value?.state.selection||{from:0,to:0};let d="";return r.value?.state.doc.nodesBetween(s,e,y=>{y.marks&&y.marks.forEach(E=>{E.type.name==="textStyle"&&E.attrs.fontSize&&(d=E.attrs.fontSize)})}),d||"12pt"},we=()=>{const s=Ue();Ze.value=s},Bt=F(()=>r.value?r.value.state.doc.textContent.split(/\s+/).filter(e=>e.length>0).length:0);return o({getSelectionRange:()=>{if(!r.value)return null;const{from:s,to:e,empty:d}=r.value.state.selection;return d?null:{from:s,to:e}},getSelectedText:()=>{if(!r.value)return"";const{from:s,to:e}=r.value.state.selection;return r.value.state.doc.textBetween(s,e)},replaceSelection:(s,e)=>{if(!r.value)return console.error("âŒ RichTextEditor - Cannot replace selection: editor not available"),!1;try{const d=e||r.value.state.selection;return console.log("ðŸ”„ RichTextEditor - Starting text replacement:",{range:d,newTextLength:s.length,newTextPreview:s.substring(0,100)+(s.length>100?"...":"")}),r.value.chain().focus().insertContentAt({from:d.from,to:d.to},s,{parseOptions:{preserveWhitespace:"full"}}).run(),console.log("âœ… RichTextEditor - Text replacement successful"),!0}catch(d){return console.error("âŒ RichTextEditor - Error replacing selection:",d),!1}},replaceTextAt:(s,e)=>{if(!r.value)return!1;try{return r.value.chain().focus().insertContentAt(s,e).run(),!0}catch(d){return console.error("Error replacing text at position:",d),!1}},getCursorPosition:()=>r.value?r.value.state.selection.anchor:0,setCursorPosition:s=>{if(!r.value)return!1;try{return r.value.commands.setTextSelection(s),!0}catch(e){return console.error("Error setting cursor position:",e),!1}},focus:()=>r.value?.commands.focus(),blur:()=>r.value?.commands.blur(),getHTML:()=>r.value?.getHTML()||"",getText:()=>r.value?.getText()||"",wordCount:Bt,startStreamingMode:te,endStreamingMode:w,refreshContent:_,getStreamingInfo:Y,isStreamingActive:()=>A.value,editor:()=>r.value}),(s,e)=>(k(),M("div",gr,[s.showToolbar&&!s.readonly?(k(),ie(qt,{key:0,to:ve.value,disabled:N.value},[u("div",{class:b(he.value)},[u("div",fr,[a(t(p),{variant:"ghost",size:"icon",class:"h-8 w-8 rounded-lg hover:bg-muted/80 text-zinc-700 dark:text-zinc-300 hover:text-foreground",onClick:wt,disabled:!t(r)?.can().undo()},{default:i(()=>[a(t(Gt),{class:"h-4 w-4"})]),_:1},8,["disabled"]),a(t(p),{variant:"ghost",size:"icon",class:"h-8 w-8 rounded-lg hover:bg-muted/80 text-zinc-700 dark:text-zinc-300 hover:text-foreground",onClick:kt,disabled:!t(r)?.can().redo()},{default:i(()=>[a(t(Kt),{class:"h-4 w-4"})]),_:1},8,["disabled"])]),u("div",mr,[a(t(at),null,{default:i(()=>[a(t(et),{asChild:""},{default:i(()=>[a(t(p),{variant:"ghost",size:"sm",class:"h-8 gap-1 px-2 font-medium text-zinc-700 dark:text-zinc-300 hover:text-foreground hover:bg-muted/80"},{default:i(()=>[u("span",pr,D(t(r)?.isActive("heading",{level:1})?"H1":t(r)?.isActive("heading",{level:2})?"H2":t(r)?.isActive("heading",{level:3})?"H3":"Paragraph"),1),a(t(ut),{class:"h-3.5 w-3.5 opacity-70"})]),_:1})]),_:1}),a(t(tt),{align:"start"},{default:i(()=>[a(t(j),{onClick:yt,class:b({"bg-accent":t(r)?.isActive("paragraph")})},{default:i(()=>[...e[15]||(e[15]=[u("span",{class:"text-sm"},"Paragraph",-1)])]),_:1},8,["class"]),a(t(Le)),a(t(j),{onClick:G,class:b({"bg-accent":t(r)?.isActive("heading",{level:1})})},{default:i(()=>[...e[16]||(e[16]=[u("span",{class:"text-lg font-bold"},"Heading 1",-1)])]),_:1},8,["class"]),a(t(j),{onClick:Q,class:b({"bg-accent":t(r)?.isActive("heading",{level:2})})},{default:i(()=>[...e[17]||(e[17]=[u("span",{class:"text-base font-bold"},"Heading 2",-1)])]),_:1},8,["class"]),a(t(j),{onClick:Te,class:b({"bg-accent":t(r)?.isActive("heading",{level:3})})},{default:i(()=>[...e[18]||(e[18]=[u("span",{class:"text-sm font-bold"},"Heading 3",-1)])]),_:1},8,["class"])]),_:1})]),_:1}),u("div",vr,[a(t(p),{variant:"ghost",size:"icon",class:"h-8 w-6 rounded-l-lg text-zinc-700 dark:text-zinc-300 hover:text-foreground hover:bg-muted/80",onClick:Ft},{default:i(()=>[a(t(Xt),{class:"h-3 w-3"})]),_:1}),u("div",hr,D(Ze.value.replace("pt","")),1),a(t(p),{variant:"ghost",size:"icon",class:"h-8 w-6 rounded-r-lg text-zinc-700 dark:text-zinc-300 hover:text-foreground hover:bg-muted/80",onClick:Ut},{default:i(()=>[a(t(Yt),{class:"h-3 w-3"})]),_:1})])]),u("div",xr,[a(t(p),{variant:"ghost",size:"icon",class:b(["h-8 w-8 rounded-lg text-zinc-700 dark:text-zinc-300 hover:text-foreground hover:bg-muted/80",{"bg-primary/10 text-primary":t(r)?.isActive("bold")}]),onClick:Z},{default:i(()=>[a(t(Zt),{class:"h-4 w-4"})]),_:1},8,["class"]),a(t(p),{variant:"ghost",size:"icon",class:b(["h-8 w-8 rounded-lg text-zinc-700 dark:text-zinc-300 hover:text-foreground hover:bg-muted/80",{"bg-primary/10 text-primary":t(r)?.isActive("italic")}]),onClick:pe},{default:i(()=>[a(t(Qt),{class:"h-4 w-4"})]),_:1},8,["class"]),a(t(p),{variant:"ghost",size:"icon",class:b(["h-8 w-8 rounded-lg text-zinc-700 dark:text-zinc-300 hover:text-foreground hover:bg-muted/80",{"bg-primary/10 text-primary":t(r)?.isActive("underline")}]),onClick:re},{default:i(()=>[a(t(Jt),{class:"h-4 w-4"})]),_:1},8,["class"]),a(t(p),{variant:"ghost",size:"icon",class:b(["h-8 w-8 rounded-lg text-zinc-700 dark:text-zinc-300 hover:text-foreground hover:bg-muted/80",{"bg-primary/10 text-primary":t(r)?.isActive("strike")}]),onClick:Ve},{default:i(()=>[a(t(ea),{class:"h-4 w-4"})]),_:1},8,["class"]),a(t(p),{variant:"ghost",size:"icon",class:b(["h-8 w-8 rounded-lg text-zinc-700 dark:text-zinc-300 hover:text-foreground hover:bg-muted/80",{"bg-primary/10 text-primary":t(r)?.isActive("code")}]),onClick:De},{default:i(()=>[a(t(ta),{class:"h-4 w-4"})]),_:1},8,["class"])]),u("div",br,[a(t(p),{variant:"ghost",size:"icon",class:b(["h-8 w-8 rounded-lg text-zinc-700 dark:text-zinc-300 hover:text-foreground hover:bg-muted/80",{"bg-primary/10 text-primary":t(r)?.isActive("bulletList")}]),onClick:ht},{default:i(()=>[a(t(aa),{class:"h-4 w-4"})]),_:1},8,["class"]),a(t(p),{variant:"ghost",size:"icon",class:b(["h-8 w-8 rounded-lg text-zinc-700 dark:text-zinc-300 hover:text-foreground hover:bg-muted/80",{"bg-primary/10 text-primary":t(r)?.isActive("orderedList")}]),onClick:xt},{default:i(()=>[a(t(ra),{class:"h-4 w-4"})]),_:1},8,["class"]),a(t(p),{variant:"ghost",size:"icon",class:b(["h-8 w-8 rounded-lg text-zinc-700 dark:text-zinc-300 hover:text-foreground hover:bg-muted/80",{"bg-primary/10 text-primary":t(r)?.isActive("blockquote")}]),onClick:bt},{default:i(()=>[a(t(na),{class:"h-4 w-4"})]),_:1},8,["class"]),u("div",yr,[a(t(p),{variant:"ghost",size:"icon",class:b(["h-8 w-8 rounded-lg text-zinc-700 dark:text-zinc-300 hover:text-foreground hover:bg-muted/80",{"bg-primary/10 text-primary":t(r)?.isActive({textAlign:"left"})}]),onClick:e[0]||(e[0]=d=>Se("left"))},{default:i(()=>[a(t(lt),{class:"h-4 w-4"})]),_:1},8,["class"]),a(t(p),{variant:"ghost",size:"icon",class:b(["h-8 w-8 rounded-lg text-zinc-700 dark:text-zinc-300 hover:text-foreground hover:bg-muted/80",{"bg-primary/10 text-primary":t(r)?.isActive({textAlign:"center"})}]),onClick:e[1]||(e[1]=d=>Se("center"))},{default:i(()=>[a(t(it),{class:"h-4 w-4"})]),_:1},8,["class"]),a(t(p),{variant:"ghost",size:"icon",class:b(["h-8 w-8 rounded-lg text-zinc-700 dark:text-zinc-300 hover:text-foreground hover:bg-muted/80",{"bg-primary/10 text-primary":t(r)?.isActive({textAlign:"right"})}]),onClick:e[2]||(e[2]=d=>Se("right"))},{default:i(()=>[a(t(dt),{class:"h-4 w-4"})]),_:1},8,["class"]),a(t(p),{variant:"ghost",size:"icon",class:b(["h-8 w-8 rounded-lg text-zinc-700 dark:text-zinc-300 hover:text-foreground hover:bg-muted/80",{"bg-primary/10 text-primary":t(r)?.isActive({textAlign:"justify"})}]),onClick:e[3]||(e[3]=d=>Se("justify"))},{default:i(()=>[a(t(sa),{class:"h-4 w-4"})]),_:1},8,["class"])])]),u("div",wr,[a(t(p),{variant:"ghost",size:"icon",class:"h-8 w-8 rounded-lg text-zinc-700 dark:text-zinc-300 hover:text-foreground hover:bg-muted/80",title:"Insert Mermaid diagram (Ctrl/Cmd+Alt+M)",onClick:Ce},{default:i(()=>[...e[19]||(e[19]=[u("span",{class:"text-[11px] font-semibold"},"M",-1)])]),_:1}),a(t(p),{variant:"ghost",size:"icon",class:b(["h-8 w-8 rounded-lg text-zinc-700 dark:text-zinc-300 hover:text-foreground hover:bg-muted/80",{"bg-primary/10 text-primary":t(r)?.isActive("link")}]),onClick:Ct},{default:i(()=>[a(t(oa),{class:"h-4 w-4"})]),_:1},8,["class"]),a(t(p),{variant:"ghost",size:"icon",class:"h-8 w-8 rounded-lg text-zinc-700 dark:text-zinc-300 hover:text-foreground hover:bg-muted/80",title:"Insert image",onClick:St},{default:i(()=>[a(t(la),{class:"h-4 w-4"})]),_:1}),a(t(at),null,{default:i(()=>[a(t(et),{asChild:""},{default:i(()=>[a(t(p),{variant:"ghost",size:"icon",class:b(["h-8 w-8 rounded-lg text-zinc-700 dark:text-zinc-300 hover:text-foreground hover:bg-muted/80",{"bg-primary/10 text-primary":t(r)?.isActive("table")}])},{default:i(()=>[a(t(ia),{class:"h-4 w-4"})]),_:1},8,["class"])]),_:1}),a(t(tt),null,{default:i(()=>[a(t(j),{onClick:$t},{default:i(()=>[...e[20]||(e[20]=[x("Insert Table (3x3)",-1)])]),_:1}),a(t(Le)),a(t(j),{onClick:Et,disabled:!se()},{default:i(()=>[...e[21]||(e[21]=[x("Add Column Before",-1)])]),_:1},8,["disabled"]),a(t(j),{onClick:Ht,disabled:!se()},{default:i(()=>[...e[22]||(e[22]=[x("Add Column After",-1)])]),_:1},8,["disabled"]),a(t(j),{onClick:Rt,disabled:!se()},{default:i(()=>[...e[23]||(e[23]=[x("Delete Column",-1)])]),_:1},8,["disabled"]),a(t(Le)),a(t(j),{onClick:It,disabled:!se()},{default:i(()=>[...e[24]||(e[24]=[x("Add Row Before",-1)])]),_:1},8,["disabled"]),a(t(j),{onClick:Vt,disabled:!se()},{default:i(()=>[...e[25]||(e[25]=[x("Add Row After",-1)])]),_:1},8,["disabled"]),a(t(j),{onClick:Dt,disabled:!se()},{default:i(()=>[...e[26]||(e[26]=[x("Delete Row",-1)])]),_:1},8,["disabled"]),a(t(Le)),a(t(j),{onClick:Pt,disabled:!se(),class:"text-destructive"},{default:i(()=>[...e[27]||(e[27]=[x("Delete Table ",-1)])]),_:1},8,["disabled"])]),_:1})]),_:1}),a(t(p),{variant:"ghost",size:"icon",class:b(["h-8 w-8 rounded-lg text-zinc-700 dark:text-zinc-300 hover:text-foreground hover:bg-muted/80",{"bg-primary/10 text-primary":t(r)?.isActive("highlight")}]),onClick:_t},{default:i(()=>[a(t(da),{class:"h-4 w-4"})]),_:1},8,["class"]),a(t(p),{variant:"ghost",size:"icon",class:b(["h-8 w-8 rounded-lg text-zinc-700 dark:text-zinc-300 hover:text-foreground hover:bg-muted/80",{"bg-primary/10 text-primary":t(r)?.getAttributes("textStyle").color}]),onClick:At},{default:i(()=>[a(t(ua),{class:"h-4 w-4"})]),_:1},8,["class"])])],2)],8,["to","disabled"])):P("",!0),u("div",kr,[a(t(Ea),{editor:t(r),class:"h-full w-full outline-none"},null,8,["editor"]),s.isGenerating?(k(),M("div",Cr,[u("div",Tr,[u("div",Ar,[e[28]||(e[28]=u("div",{class:"absolute inset-0 animate-ping rounded-full bg-primary/20"},null,-1)),u("div",zr,[a(t(st),{class:"h-8 w-8 animate-spin text-primary"})])]),u("div",Mr,[u("h3",Sr,D(s.generationPhase||"Generating..."),1),u("p",Lr,D(s.generationProgress||"AI is writing your chapter..."),1)]),a(t(Je),{"model-value":s.generationPercentage,class:"h-2 w-64"},null,8,["model-value"])])])):P("",!0)]),a(t(_e),{open:xe.value,"onUpdate:open":e[7]||(e[7]=d=>xe.value=d)},{default:i(()=>[a(t($e),null,{default:i(()=>[a(t(Re),null,{default:i(()=>[a(t(Ie),null,{default:i(()=>[...e[29]||(e[29]=[x("Insert Link",-1)])]),_:1}),a(t(Ee),null,{default:i(()=>[...e[30]||(e[30]=[x("Enter the URL for the link.",-1)])]),_:1})]),_:1}),u("div",_r,[u("div",$r,[a(t(fe),{htmlFor:"link-text"},{default:i(()=>[...e[31]||(e[31]=[x("Text",-1)])]),_:1}),a(t(le),{id:"link-text",modelValue:q.value.text,"onUpdate:modelValue":e[4]||(e[4]=d=>q.value.text=d),placeholder:"Link text"},null,8,["modelValue"])]),u("div",Er,[a(t(fe),{htmlFor:"link-url"},{default:i(()=>[...e[32]||(e[32]=[x("URL",-1)])]),_:1}),a(t(le),{id:"link-url",modelValue:q.value.url,"onUpdate:modelValue":e[5]||(e[5]=d=>q.value.url=d),placeholder:"https://example.com"},null,8,["modelValue"])])]),a(t(He),null,{default:i(()=>[a(t(p),{variant:"outline",onClick:e[6]||(e[6]=d=>xe.value=!1)},{default:i(()=>[...e[33]||(e[33]=[x("Cancel",-1)])]),_:1}),a(t(p),{onClick:Tt},{default:i(()=>[...e[34]||(e[34]=[x("Insert",-1)])]),_:1})]),_:1})]),_:1})]),_:1},8,["open"]),a(t(_e),{open:Ae.value,"onUpdate:open":e[10]||(e[10]=d=>Ae.value=d)},{default:i(()=>[a(t($e),null,{default:i(()=>[a(t(Re),null,{default:i(()=>[a(t(Ie),null,{default:i(()=>[...e[35]||(e[35]=[x("Text Color",-1)])]),_:1}),a(t(Ee),null,{default:i(()=>[...e[36]||(e[36]=[x("Choose a color for the selected text.",-1)])]),_:1})]),_:1}),u("div",Hr,[u("div",Rr,[a(t(le),{type:"color",modelValue:ne.value.color,"onUpdate:modelValue":e[8]||(e[8]=d=>ne.value.color=d),class:"h-12 w-12 p-1"},null,8,["modelValue"]),a(t(le),{modelValue:ne.value.color,"onUpdate:modelValue":e[9]||(e[9]=d=>ne.value.color=d),placeholder:"#000000",class:"flex-1"},null,8,["modelValue"])]),u("div",Ir,[(k(),M(Oe,null,ca(["#000000","#ef4444","#f97316","#eab308","#22c55e","#3b82f6","#a855f7","#ec4899"],d=>u("button",{key:d,class:"h-8 w-8 rounded-full border border-border shadow-sm transition-transform hover:scale-110 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2",style:ke({backgroundColor:d}),onClick:y=>ne.value.color=d},null,12,Vr)),64))])]),a(t(He),null,{default:i(()=>[a(t(p),{variant:"outline",onClick:Mt},{default:i(()=>[...e[37]||(e[37]=[x("Reset",-1)])]),_:1}),a(t(p),{onClick:zt},{default:i(()=>[...e[38]||(e[38]=[x("Apply",-1)])]),_:1})]),_:1})]),_:1})]),_:1},8,["open"]),a(t(_e),{open:ue.value,"onUpdate:open":e[14]||(e[14]=d=>ue.value=d)},{default:i(()=>[a(t($e),{class:"sm:max-w-md"},{default:i(()=>[a(t(Re),null,{default:i(()=>[a(t(Ie),null,{default:i(()=>[...e[39]||(e[39]=[x("Insert Image",-1)])]),_:1}),a(t(Ee),null,{default:i(()=>[...e[40]||(e[40]=[x("Upload an image or enter a URL.",-1)])]),_:1})]),_:1}),u("div",Dr,[u("div",Pr,[a(t(fe),null,{default:i(()=>[...e[41]||(e[41]=[x("Upload from computer",-1)])]),_:1}),u("div",Ur,[u("input",{ref_key:"imageFileInput",ref:Me,type:"file",accept:"image/*",class:"hidden",onChange:Lt},null,544),a(t(p),{variant:"outline",class:"w-full",disabled:be.value,onClick:e[11]||(e[11]=d=>Me.value?.click())},{default:i(()=>[a(t(ga),{class:"w-4 h-4 mr-2"}),x(" "+D(be.value?"Uploading...":"Choose File"),1)]),_:1},8,["disabled"])]),be.value?(k(),ie(t(Je),{key:0,"model-value":ze.value,class:"h-2"},null,8,["model-value"])):P("",!0),ge.value?(k(),M("p",Fr,D(ge.value),1)):P("",!0)]),e[44]||(e[44]=u("div",{class:"relative"},[u("div",{class:"absolute inset-0 flex items-center"},[u("span",{class:"w-full border-t"})]),u("div",{class:"relative flex justify-center text-xs uppercase"},[u("span",{class:"bg-background px-2 text-muted-foreground"},"Or")])],-1)),u("div",Br,[a(t(fe),{for:"image-url"},{default:i(()=>[...e[42]||(e[42]=[x("Image URL",-1)])]),_:1}),u("div",Or,[a(t(le),{id:"image-url",modelValue:ce.value,"onUpdate:modelValue":e[12]||(e[12]=d=>ce.value=d),placeholder:"https://example.com/image.jpg",onKeydown:ot(Ge,["enter"])},null,8,["modelValue"]),a(t(p),{onClick:Ge,disabled:!ce.value},{default:i(()=>[...e[43]||(e[43]=[x(" Insert ",-1)])]),_:1},8,["disabled"])])])]),a(t(He),null,{default:i(()=>[a(t(p),{variant:"outline",onClick:e[13]||(e[13]=d=>ue.value=!1)},{default:i(()=>[...e[45]||(e[45]=[x("Cancel",-1)])]),_:1})]),_:1})]),_:1})]),_:1},8,["open"])]))}}),dn=qe(Wr,[["__scopeId","data-v-ae75afdc"]]);export{dn as R,Ra as i};
