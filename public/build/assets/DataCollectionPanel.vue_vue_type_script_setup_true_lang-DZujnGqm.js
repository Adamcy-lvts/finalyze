import{a as o,o as l,e,E as f,g as L,d as F,D as P,h as B,y as k,k as C,u as s,t as p,F as M,z as R,n as S}from"./app-DN5lyigx.js";import{t as X}from"./Sonner.vue_vue_type_script_setup_true_lang-wK-akjKl.js";function z(i,n){return l(),o("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor","aria-hidden":"true","data-slot":"icon"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M9.75 3.104v5.714a2.25 2.25 0 0 1-.659 1.591L5 14.5M9.75 3.104c-.251.023-.501.05-.75.082m.75-.082a24.301 24.301 0 0 1 4.5 0m0 0v5.714c0 .597.237 1.17.659 1.591L19.8 15.3M14.25 3.104c.251.023.501.05.75.082M19.8 15.3l-1.57.393A9.065 9.065 0 0 1 12 15a9.065 9.065 0 0 0-6.23-.693L5 14.5m14.8.8 1.402 1.402c1.232 1.232.65 3.318-1.067 3.611A48.309 48.309 0 0 1 12 21c-2.773 0-5.491-.235-8.135-.687-1.718-.293-2.3-2.379-1.067-3.61L5 14.5"})])}function W(i,n){return l(),o("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor","aria-hidden":"true","data-slot":"icon"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"m4.5 12.75 6 6 9-13.5"})])}function I(i,n){return l(),o("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor","aria-hidden":"true","data-slot":"icon"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M19.5 14.25v-2.625a3.375 3.375 0 0 0-3.375-3.375h-1.5A1.125 1.125 0 0 1 13.5 7.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H8.25m0 12.75h7.5m-7.5 3H12M10.5 2.25H5.625c-.621 0-1.125.504-1.125 1.125v17.25c0 .621.504 1.125 1.125 1.125h12.75c.621 0 1.125-.504 1.125-1.125V11.25a9 9 0 0 0-9-9Z"})])}function $(i,n){return l(),o("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor","aria-hidden":"true","data-slot":"icon"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M12 9v3.75m-9.303 3.376c-.866 1.5.217 3.374 1.948 3.374h14.71c1.73 0 2.813-1.874 1.948-3.374L13.949 3.378c-.866-1.5-3.032-1.5-3.898 0L2.697 16.126ZM12 15.75h.007v.008H12v-.008Z"})])}function V(){const i=f(!1),n=f(null),g=f(null),c=f(null),y=f([]),m=f({}),A=L(()=>g.value?.hasDataCollectionNeeds??!1),q=L(()=>g.value?.types??[]),v=L(()=>c.value?.hasPlaceholder?c.value.detectedType:null),D=L(()=>c.value?.hasPlaceholder?c.value.confidence??0:0);async function b(t){i.value=!0,n.value=null;try{const r=await fetch(`/api/chapters/${t}/detect`,{headers:{Accept:"application/json","X-Requested-With":"XMLHttpRequest"}});if(!r.ok)throw new Error("Failed to detect data collection needs");const x=await r.json();g.value=x.detection}catch(r){n.value=r instanceof Error?r.message:"An error occurred",console.error("Error detecting data collection needs:",r)}finally{i.value=!1}}async function h(t){i.value=!0,n.value=null;try{const r=await fetch(`/api/chapters/${t}/placeholder`,{headers:{Accept:"application/json","X-Requested-With":"XMLHttpRequest"}});if(!r.ok)throw new Error("Failed to generate placeholder");const x=await r.json();c.value=x.placeholder}catch(r){n.value=r instanceof Error?r.message:"An error occurred",console.error("Error generating placeholder:",r)}finally{i.value=!1}}async function T(t){i.value=!0,n.value=null;try{const r=await fetch(`/api/chapters/${t}/suggestions`,{headers:{Accept:"application/json","X-Requested-With":"XMLHttpRequest"}});if(!r.ok)throw new Error("Failed to get suggestions");const x=await r.json();y.value=x.suggestions}catch(r){n.value=r instanceof Error?r.message:"An error occurred",console.error("Error getting suggestions:",r)}finally{i.value=!1}}async function N(){i.value=!0,n.value=null;try{const t=await fetch("/api/data-collection/templates",{headers:{Accept:"application/json","X-Requested-With":"XMLHttpRequest"}});if(!t.ok)throw new Error("Failed to get templates");const r=await t.json();m.value=r.templates}catch(t){n.value=t instanceof Error?t.message:"An error occurred",console.error("Error getting templates:",t)}finally{i.value=!1}}async function w(t){i.value=!0,n.value=null;try{const r=await fetch(`/api/data-collection/template?type=${encodeURIComponent(t)}`,{headers:{Accept:"application/json","X-Requested-With":"XMLHttpRequest"}});if(!r.ok)throw new Error("Failed to get template");return(await r.json()).template}catch(r){return n.value=r instanceof Error?r.message:"An error occurred",console.error("Error getting template:",r),null}finally{i.value=!1}}async function H(t,r,x="append"){i.value=!0,n.value=null;try{if(!(await fetch(`/api/chapters/${t}/insert-template`,{method:"POST",headers:{Accept:"application/json","Content-Type":"application/json","X-Requested-With":"XMLHttpRequest"},body:JSON.stringify({type:r,position:x})})).ok)throw new Error("Failed to insert template");return!0}catch(j){return n.value=j instanceof Error?j.message:"An error occurred",console.error("Error inserting template:",j),!1}finally{i.value=!1}}async function _(t){await Promise.all([b(t),h(t),T(t)])}function E(t){return{survey:"Survey/Questionnaire",experiment:"Laboratory Experiment",engineering:"Engineering Design",statistical:"Statistical Analysis",construction:"Construction Project"}[t]||t.charAt(0).toUpperCase()+t.slice(1)}function u(t){return t>=50?"High":t>=25?"Medium":"Low"}function a(t){return t>=50?"text-green-600 dark:text-green-400":t>=25?"text-yellow-600 dark:text-yellow-400":"text-red-600 dark:text-red-400"}function d(){g.value=null,c.value=null,y.value=[],n.value=null}return{isLoading:i,error:n,detection:g,placeholder:c,suggestions:y,templates:m,hasDataCollectionNeeds:A,detectedTypes:q,primaryType:v,primaryConfidence:D,detectDataCollectionNeeds:b,generatePlaceholder:h,getSuggestions:T,getAllTemplates:N,getTemplate:w,insertTemplate:H,analyzeChapter:_,getTypeName:E,getConfidenceLevel:u,getConfidenceColor:a,clearData:d}}const Z={class:"space-y-4"},O={class:"flex items-center justify-between"},U={class:"flex items-center gap-2"},G=["disabled"],J={key:0,class:"text-center py-4"},Q={key:1,class:"text-center py-4"},K={key:2},Y={class:"bg-blue-50 dark:bg-blue-900/20 rounded-lg p-3"},ee={class:"flex items-start gap-2"},te={class:"min-w-0 flex-1"},re={class:"mt-2 space-y-1"},se={class:"text-xs text-blue-700 dark:text-blue-300"},ae={key:0,class:"border border-gray-200 dark:border-gray-700 rounded-lg p-3"},ne={class:"flex items-center justify-between mb-2"},oe={class:"text-xs px-2 py-1 bg-green-100 text-green-700 rounded dark:bg-green-900/20 dark:text-green-400"},le={class:"text-xs text-gray-600 dark:text-gray-400 mb-3"},ie={class:"flex gap-2"},de=["disabled"],ce={key:0,class:"mt-3 p-2 bg-gray-50 dark:bg-gray-800 rounded text-xs"},ue={class:"whitespace-pre-wrap text-gray-700 dark:text-gray-300 overflow-auto max-h-32"},pe={key:1,class:"space-y-2"},ge={class:"text-xs font-medium text-gray-700 dark:text-gray-300 mb-2"},me={class:"space-y-1"},xe={class:"border border-gray-200 dark:border-gray-700 rounded-lg"},ye={class:"p-3 pt-0 space-y-2"},he={class:"text-xs font-medium text-gray-900 dark:text-gray-100"},fe={class:"text-xs text-gray-600 dark:text-gray-400"},ve=["onClick","disabled"],be={key:3,class:"bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 rounded-lg p-3"},ke={class:"flex items-start gap-2"},we={class:"text-xs text-red-600 dark:text-red-400 mt-1"},Ae=F({__name:"DataCollectionPanel",props:{chapterId:{},content:{}},setup(i){const n=i,g=f(!1),{isLoading:c,error:y,placeholder:m,suggestions:A,templates:q,hasDataCollectionNeeds:v,detectedTypes:D,primaryType:b,analyzeChapter:h,insertTemplate:T,getAllTemplates:N,getTypeName:w,getConfidenceColor:H}=V();let _=null;P(()=>n.content,(u,a)=>{!u||u===a||(_&&clearTimeout(_),_=setTimeout(()=>{u&&u.length>500&&h(n.chapterId)},3e3))},{immediate:!1});async function E(u,a,d="append"){await T(u,a,d)?(X.success("Template added successfully"),g.value=!1,setTimeout(()=>{h(u)},1e3)):X.error(y.value||"Failed to insert template")}return B(async()=>{await N(),n.content&&n.content.length>500&&await h(n.chapterId)}),(u,a)=>(l(),o("div",Z,[e("div",O,[e("div",U,[C(s(z),{class:"h-5 w-5 text-blue-600 dark:text-blue-400"}),a[3]||(a[3]=e("h3",{class:"text-sm font-semibold text-gray-900 dark:text-gray-100"}," Data Collection Assistant ",-1))]),s(v)?k("",!0):(l(),o("button",{key:0,onClick:a[0]||(a[0]=d=>s(h)(u.chapterId)),disabled:s(c),class:"text-xs px-2 py-1 bg-blue-50 text-blue-600 rounded hover:bg-blue-100 disabled:opacity-50 dark:bg-blue-900/20 dark:text-blue-400 dark:hover:bg-blue-900/30"},p(s(c)?"Analyzing...":"Scan for Data Needs"),9,G))]),s(c)&&!s(v)?(l(),o("div",J,[...a[4]||(a[4]=[e("div",{class:"animate-spin rounded-full h-6 w-6 border-b-2 border-blue-600 mx-auto"},null,-1),e("p",{class:"text-xs text-gray-500 mt-2"},"Analyzing chapter content...",-1)])])):!s(v)&&!s(c)?(l(),o("div",Q,[C(s(I),{class:"h-8 w-8 text-gray-400 mx-auto mb-2"}),a[5]||(a[5]=e("p",{class:"text-sm text-gray-500 dark:text-gray-400"}," No data collection requirements detected in this chapter. ",-1)),a[6]||(a[6]=e("p",{class:"text-xs text-gray-400 mt-1"},' Add keywords like "survey", "experiment", or "statistical analysis" to get assistance. ',-1))])):s(v)?(l(),o("div",K,[e("div",Y,[e("div",ee,[C(s($),{class:"h-4 w-4 text-blue-600 dark:text-blue-400 mt-0.5 flex-shrink-0"}),e("div",te,[a[7]||(a[7]=e("p",{class:"text-sm font-medium text-blue-900 dark:text-blue-100"}," Data Collection Requirements Detected ",-1)),e("div",re,[(l(!0),o(M,null,R(s(D),d=>(l(),o("div",{key:d,class:"flex items-center justify-between"},[e("span",se,p(s(w)(d)),1),e("span",{class:S(["text-xs font-medium",s(H)(s(m)?.allConfidence?.[d]||0)])},p(s(m)?.allConfidence?.[d]?.toFixed(1))+"% confidence ",3)]))),128))])])])]),s(b)&&s(m)?.template?(l(),o("div",ae,[e("div",ne,[a[8]||(a[8]=e("h4",{class:"text-sm font-medium text-gray-900 dark:text-gray-100"}," Recommended Template ",-1)),e("span",oe,p(s(w)(s(b))),1)]),e("p",le,p(s(m).template.title),1),e("div",ie,[e("button",{onClick:a[1]||(a[1]=d=>E(u.chapterId,s(b),"append")),disabled:s(c),class:"flex-1 text-xs px-3 py-1.5 bg-blue-600 text-white rounded hover:bg-blue-700 disabled:opacity-50"},p(s(c)?"Inserting...":"Add Template"),9,de),e("button",{onClick:a[2]||(a[2]=d=>g.value=!g.value),class:"text-xs px-2 py-1.5 border border-gray-200 text-gray-600 rounded hover:bg-gray-50 dark:border-gray-600 dark:text-gray-400 dark:hover:bg-gray-800"},p(g.value?"Hide":"Preview"),1)]),g.value?(l(),o("div",ce,[e("pre",ue,p(s(m).template.content.trim()),1)])):k("",!0)])):k("",!0),s(A).length>0?(l(),o("div",pe,[a[9]||(a[9]=e("h4",{class:"text-sm font-medium text-gray-900 dark:text-gray-100"}," Research Guidelines ",-1)),(l(!0),o(M,null,R(s(A),d=>(l(),o("div",{key:d.type,class:"border border-gray-200 dark:border-gray-700 rounded-lg p-3"},[e("h5",ge,p(d.title),1),e("ul",me,[(l(!0),o(M,null,R(d.suggestions,(t,r)=>(l(),o("li",{key:r,class:"flex items-start gap-1.5 text-xs text-gray-600 dark:text-gray-400"},[C(s(W),{class:"h-3 w-3 text-green-500 mt-0.5 flex-shrink-0"}),e("span",null,p(t),1)]))),128))])]))),128))])):k("",!0),e("details",xe,[a[10]||(a[10]=e("summary",{class:"p-3 cursor-pointer text-sm font-medium text-gray-700 dark:text-gray-300 hover:bg-gray-50 dark:hover:bg-gray-800"}," Browse All Templates ",-1)),e("div",ye,[(l(!0),o(M,null,R(s(q),(d,t)=>(l(),o("div",{key:t,class:"flex items-center justify-between p-2 bg-gray-50 dark:bg-gray-800 rounded"},[e("div",null,[e("span",he,p(s(w)(t)),1),e("p",fe,p(d.title),1)]),e("button",{onClick:r=>E(u.chapterId,t,"append"),disabled:s(c),class:"text-xs px-2 py-1 bg-blue-600 text-white rounded hover:bg-blue-700 disabled:opacity-50"}," Add ",8,ve)]))),128))])])])):k("",!0),s(y)?(l(),o("div",be,[e("div",ke,[C(s($),{class:"h-4 w-4 text-red-500 mt-0.5 flex-shrink-0"}),e("div",null,[a[11]||(a[11]=e("p",{class:"text-sm font-medium text-red-800 dark:text-red-200"}," Analysis Error ",-1)),e("p",we,p(s(y)),1)])])])):k("",!0)]))}});export{Ae as _};
