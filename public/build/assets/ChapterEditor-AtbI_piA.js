const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/ChapterNavigation-BmjncN6T.js","assets/ChapterNavigation.vue_vue_type_script_setup_true_lang-BIX9rtmO.js","assets/index-DKTzjY4t.js","assets/vendor-BJBNFzu6.js","assets/vendor-CzBRREAs.css","assets/ScrollArea.vue_vue_type_script_setup_true_lang-BiVOEWCH.js","assets/AlertDialogTitle.vue_vue_type_script_setup_true_lang-DShD0gcS.js","assets/index-DweHVuYF.js","assets/MobileNavOverlay-C9Fu6AUH.js","assets/index-BWPj8eKR.js","assets/DefensePreparationPanel.vue_vue_type_script_setup_true_lang-Cnmr5d0f.js","assets/CardContent.vue_vue_type_script_setup_true_lang-BmpoBQtZ.js","assets/CardTitle.vue_vue_type_script_setup_true_lang-CLvp_ZLs.js","assets/CollapsibleTrigger.vue_vue_type_script_setup_true_lang-Cksae7nm.js","assets/Progress.vue_vue_type_script_setup_true_lang-BJ0VwWi9.js","assets/Separator.vue_vue_type_script_setup_true_lang-D0FejIcy.js","assets/Switch.vue_vue_type_script_setup_true_lang-CJ_Us863.js","assets/_plugin-vue_export-helper-DlAUqK2U.js","assets/TooltipTrigger.vue_vue_type_script_setup_true_lang-D5gHzBY1.js","assets/WordBalanceDisplay.vue_vue_type_script_setup_true_lang-vIKRZBkJ.js","assets/AppLayout.vue_vue_type_script_setup_true_lang-DowxnUGa.js","assets/UserInfo.vue_vue_type_script_setup_true_lang-LFxEtfzj.js","assets/Sonner.vue_vue_type_script_setup_true_lang-C7Uf4kO1.js","assets/AppLogo.vue_vue_type_script_setup_true_lang-DXhfr9d3.js","assets/useAppearance-BoUrjusV.js","assets/useWordBalance-wU2vTgqu.js","assets/PWAInstallPrompt.vue_vue_type_script_setup_true_lang-DCd0GLl4.js","assets/PurchaseModal.vue_vue_type_script_setup_true_lang-KQgPGRog.js","assets/DialogContent.vue_vue_type_script_setup_true_lang-C8SicQru.js","assets/DialogDescription.vue_vue_type_script_setup_true_lang-B95wIsmA.js","assets/DialogFooter.vue_vue_type_script_setup_true_lang-DsnnuiaB.js","assets/DialogTitle.vue_vue_type_script_setup_true_lang-vwptL7Il.js","assets/useChapterWordCount-C_DomqZz.js","assets/Input.vue_vue_type_script_setup_true_lang-CB-7LUUJ.js","assets/Label.vue_vue_type_script_setup_true_lang-YwrTvequ.js","assets/RichTextEditor-j25Fd6QF.js","assets/vendor-tiptap-DuG0yIO_.js","assets/MermaidExtension-C8Xh9spG.js","assets/vendor-mermaid-DjbGXZoA.js","assets/MermaidExtension-DI7x6sFR.css","assets/RichTextEditor-CdoRJEte.css","assets/RichTextViewer-D7HyL7g4.js","assets/RichTextViewer-DtmUEoMb.css","assets/useTextHistory-CCU6aS00.js","assets/Checkbox.vue_vue_type_script_setup_true_lang-BMD0Hw_m.js","assets/MobileNavOverlay-CN-XSdXy.css","assets/ChatModeLayout-D0PLWv0F.js","assets/ChatModeLayout-Dr0PWGkM.css","assets/CitationVerificationLayout-Dv4E6rnw.js","assets/SafeHtmlText.vue_vue_type_script_setup_true_lang-tJ5ehN7B.js"])))=>i.map(i=>d[i]);
import{ch as ss,ci as ue,cj as P,bt as m,ck as $,cl as J,ce as re,cm as ar,bE as $e,bB as Ae,cb as de,bu as Je,cn as F,co as h,bF as e,cp as o,cq as r,cr as s,cs as l,ct as c,cu as Ge,cv as rs,cw as Ee,cx as De,cy as pt,cz as os,cA as Ve,cB as W,cC as We,cD as lr,cE as Ft,cF as je,cG as Y,cH as Lt,cI as Xe,cJ as ir,cK as dr,cL as ur,cM as cr,cN as pr,cO as gr,cP as fr,cQ as mr,cR as hr,cS as Nt,cT as Ue,cU as ut,cV as Ot,cW as Wt,cX as qt,cY as Gt,cZ as It,c_ as Ht,c$ as Qe,d0 as Bt,d1 as vr,d2 as Ut,d3 as Qt,d4 as br,d5 as xr,d6 as wr,d7 as yr,d8 as _r,d9 as kr,da as Cr,db as Sr,_ as Ke}from"./vendor-BJBNFzu6.js";import{_ as Se}from"./index-DweHVuYF.js";import{_ as v}from"./index-DKTzjY4t.js";import{_ as oe,a as ne}from"./CardContent.vue_vue_type_script_setup_true_lang-BmpoBQtZ.js";import{_ as ae,a as ie}from"./CardTitle.vue_vue_type_script_setup_true_lang-CLvp_ZLs.js";import{_ as Kt}from"./ScrollArea.vue_vue_type_script_setup_true_lang-BiVOEWCH.js";import{_ as qe}from"./Separator.vue_vue_type_script_setup_true_lang-D0FejIcy.js";import{_ as K,a as V,b as X}from"./TooltipTrigger.vue_vue_type_script_setup_true_lang-D5gHzBY1.js";import{_ as Er}from"./WordBalanceDisplay.vue_vue_type_script_setup_true_lang-vIKRZBkJ.js";import{_ as Tr,a as Ar,b as $r,c as Dr,d as jr,e as Rr,f as zr,g as Pr}from"./AlertDialogTitle.vue_vue_type_script_setup_true_lang-DShD0gcS.js";import{_ as Vt,a as Xt}from"./AppLayout.vue_vue_type_script_setup_true_lang-DowxnUGa.js";import{_ as Mr}from"./PurchaseModal.vue_vue_type_script_setup_true_lang-KQgPGRog.js";import{r as Fr,u as Lr}from"./useWordBalance-wU2vTgqu.js";import{u as ns}from"./useAppearance-BoUrjusV.js";import{u as Nr,a as Or,b as Wr}from"./useChapterWordCount-C_DomqZz.js";import{_ as qr}from"./Input.vue_vue_type_script_setup_true_lang-CB-7LUUJ.js";import{_ as Gr}from"./Label.vue_vue_type_script_setup_true_lang-YwrTvequ.js";import{R as as}from"./RichTextEditor-j25Fd6QF.js";import{R as ls}from"./RichTextViewer-D7HyL7g4.js";import{_ as Jt,a as Yt,b as Zt}from"./CollapsibleTrigger.vue_vue_type_script_setup_true_lang-Cksae7nm.js";import{_ as Ir}from"./Progress.vue_vue_type_script_setup_true_lang-BJ0VwWi9.js";import{_ as Hr,u as Br,a as ct}from"./useTextHistory-CCU6aS00.js";import{_ as is}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./UserInfo.vue_vue_type_script_setup_true_lang-LFxEtfzj.js";import"./Sonner.vue_vue_type_script_setup_true_lang-C7Uf4kO1.js";import"./AppLogo.vue_vue_type_script_setup_true_lang-DXhfr9d3.js";import"./PWAInstallPrompt.vue_vue_type_script_setup_true_lang-DCd0GLl4.js";import"./DialogContent.vue_vue_type_script_setup_true_lang-C8SicQru.js";import"./DialogDescription.vue_vue_type_script_setup_true_lang-B95wIsmA.js";import"./DialogFooter.vue_vue_type_script_setup_true_lang-DsnnuiaB.js";import"./DialogTitle.vue_vue_type_script_setup_true_lang-vwptL7Il.js";import"./vendor-tiptap-DuG0yIO_.js";import"./MermaidExtension-C8Xh9spG.js";import"./vendor-mermaid-DjbGXZoA.js";import"./Checkbox.vue_vue_type_script_setup_true_lang-BMD0Hw_m.js";function Ur(f){const b=ss();ue(()=>b.props?.flash,O=>{O&&(O.success&&P.success(O.success),O.error&&P.error(O.error))},{deep:!0,immediate:!0});const i=m(f.chapter.title||""),D=m(f.chapter.content||""),N=m(!0),{isDark:n,toggle:_}=ns(),g=$(()=>n.value),z=()=>{},x=()=>{_()},j=m(!1),T=m(!1),E=m(!1),p=m("write"),M=m(""),k=m(0),U=m(!1),Q=m(!1),w=m(!0),d=()=>{try{return localStorage.getItem(`chatMode_${f.project.id}_${f.chapter.chapter_number}`)==="true"}catch(O){return console.warn("Failed to load chat mode from localStorage:",O),!1}},y=O=>{try{localStorage.setItem(`chatMode_${f.project.id}_${f.chapter.chapter_number}`,String(O))}catch(te){console.warn("Failed to save chat mode to localStorage:",te)}},R=m(!1),ce=m(!1),C=m(!1),Z=m(!1),ee=m(!1),q=m(!0),H=m(!0);return{chapterTitle:i,chapterContent:D,showPreview:N,isEditorDark:g,initChapterTheme:z,toggleChapterTheme:x,isNativeFullscreen:j,showAISidebar:T,showStatistics:E,activeTab:p,selectedText:M,cursorPosition:k,showChatMode:U,showCitationMode:Q,showDefensePrep:w,loadChatModeFromStorage:d,saveChatModeToStorage:y,showLeftSidebar:R,showRightSidebar:ce,isMobile:C,isLeftSidebarCollapsed:Z,isRightSidebarCollapsed:ee,showLeftSidebarInFullscreen:q,showRightSidebarInFullscreen:H}}function Qr({props:f,allChapters:b,targetWordCount:i,estimates:D,ensureBalance:N,save:n}){return{generateNextChapter:async()=>{const g=D.chapter(i.value||0);if(!N(g,"generate the next chapter with AI"))return;await n();const z=b.map(T=>T.chapter_number).sort((T,E)=>T-E),x=z.indexOf(f.chapter.chapter_number);let j;if(x===-1||x===z.length-1)j=Math.max(...z)+1;else{const T=z[x+1];T===f.chapter.chapter_number+1?j=T:j=f.chapter.chapter_number+1}try{const T=J("chapters.write",{project:f.project.slug,chapter:j}),E=new URL(T,window.location.origin);E.searchParams.set("ai_generate","true"),E.searchParams.set("generation_type","progressive"),re.visit(E.toString())}catch(T){console.error("âŒ Error generating next chapter:",T)}}}}function Kr(f,b,i,D){const n=m(!1),_=m(0),g=m(!1),z=C=>{if(!C)return 0;const ee=C.replace(/<[^>]*>/g,"").trim().replace(/\s+/g," ");if(!ee)return 0;const q=ee.match(/\b\w+\b/g);return q?q.length:0},x=$(()=>z(i.value)),j=$(()=>x.value>=800),T=()=>`defense_generation_triggered_${f.id}_ch_${b.chapter_number}`,E=()=>{const C=T();return localStorage.getItem(C)==="true"},p=()=>{const C=T();localStorage.setItem(C,"true"),n.value=!0},M=()=>{const C=T();localStorage.removeItem(C),n.value=!1,console.log(`ðŸ”„ DEFENSE WATCHER: Reset generation trigger for Chapter ${b.chapter_number}`)},k=ar(async()=>{if(!g.value)return;const C=x.value;console.log(`ðŸ“Š DEFENSE WATCHER: Word count check - Chapter ${b.chapter_number}: ${C} words`),C<800*.8&&n.value&&(console.log("â¬‡ï¸ DEFENSE WATCHER: Content dropped below 80% of threshold, resetting trigger"),M()),_.value=C},2e3),U=()=>g.value?void 0:(g.value=!0,n.value=E(),_.value=x.value,console.log(`ðŸ‘€ DEFENSE WATCHER: Started watching Chapter ${b.chapter_number}`),console.log(`   Initial word count: ${_.value}`),console.log(`   Generation already triggered: ${n.value}`),console.log("   Threshold: 800 words"),ue(i,(Z,ee)=>{Z!==ee&&k()},{immediate:!1})),Q=()=>{g.value=!1,k.cancel(),console.log(`ðŸ›‘ DEFENSE WATCHER: Stopped watching Chapter ${b.chapter_number}`)},w=async()=>{console.log(`ðŸ” DEFENSE WATCHER: Force checking Chapter ${b.chapter_number}`),await k(),k.flush()},d=$(()=>{const C=x.value;return C>0&&C<800&&!n.value}),y=$(()=>{const C=x.value/800*100;return Math.min(C,100)}),R=$(()=>{const C=800-x.value;return Math.max(C,0)});return{isWatching:g,hasTriggeredGeneration:n,currentWordCount:x,lastWordCount:_,meetsThreshold:j,shouldShowProgressIndicator:d,progressPercentage:y,wordsRemaining:R,startWatching:U,stopWatching:Q,forceCheck:w,resetGenerationTrigger:M,markGenerationTriggered:p,getStatusMessage:()=>{const C=x.value;return n.value?`Defense questions available (${C} words)`:C>=800?`Ready for defense questions (${C} words)`:C>0?`${800-C} more words needed for defense questions`:"Start writing to enable defense questions (800 words needed)"},countWords:z,DEFENSE_WORD_COUNT_THRESHOLD:800}}function Vr({props:f,chapterContent:b,currentWordCount:i,ensureBalance:D,estimates:N}){const n=m([]),_=m(!1),g=m(!1),z=m(null),x=m(!1),j=$(()=>f.chapter),{hasTriggeredGeneration:T,startWatching:E,stopWatching:p,forceCheck:M,getStatusMessage:k,markGenerationTriggered:U,meetsThreshold:Q,shouldShowProgressIndicator:w,progressPercentage:d,wordsRemaining:y,DEFENSE_WORD_COUNT_THRESHOLD:R}=Kr(f.project,f.chapter,b),ce=(A,L)=>`defense_auto_generate_${A}_ch_${L}`,C=()=>{try{return localStorage.getItem(ce(f.project.id,f.chapter.chapter_number))==="true"}catch(A){return console.warn("Failed to load defense auto-generation preference:",A),!1}},Z=A=>{try{localStorage.setItem(ce(f.project.id,f.chapter.chapter_number),String(A))}catch(L){console.warn("Failed to save defense auto-generation preference:",L)}};x.value=C();const ee=()=>{if(!n.value.length||!z.value)return!0;const A=new Date(Date.now()-360*60*1e3);return z.value<A},q=async(A=!1,L={})=>{if(_.value)return;const G=L.skipGeneration??!0;_.value=!0;try{console.log("Loading defense questions with params:",{project_id:f.project.id,chapter_number:j.value?.chapter_number,limit:5,force_refresh:A,skip_generation:G});const S=await de.get(`/api/projects/${f.project.id}/defense/questions`,{params:{chapter_number:j.value?.chapter_number||null,limit:5,force_refresh:A?1:0,skip_generation:G?1:0},headers:{Accept:"application/json","X-Requested-With":"XMLHttpRequest"}});if(console.log("Defense questions loaded:",S.data),n.value=S.data.questions||[],z.value=new Date,S.data.questions&&S.data.questions.length>0){const I=`defense_questions_${f.project.id}_chapter_${j.value?.chapter_number}`;localStorage.setItem(I,JSON.stringify({questions:S.data.questions,chapter_number:j.value?.chapter_number,loaded_at:new Date().toISOString()}))}else A||(console.log("No existing questions found for this chapter"),console.log(`Current word count: ${i.value}/${R}`),console.log('User must click "Generate Questions" button to create defense questions'))}catch(S){if(console.error("Failed to load defense questions:",S),S.response)if(console.error("Response status:",S.response.status),console.error("Response data:",S.response.data),S.response.status===422){const I=Object.values(S.response.data.errors||{})[0];I&&Array.isArray(I)?P.error(`Validation Error: ${I[0]}`):P.error("Invalid request parameters. Please refresh the page.")}else S.response.status===500?P.error("Server error. Please try again later."):P.error("Failed to load defense questions");else S.request?(console.error("No response received:",S.request),P.error("Network error. Please check your connection.")):(console.error("Error setting up request:",S.message),P.error("An unexpected error occurred"));n.value=[]}finally{_.value=!1}},H=A=>A?A.replace(/<[^>]*>/g," ").trim().split(/\s+/).filter(L=>L.length>0).length:0,O=async(A={})=>{if(g.value)return;const L=A.autoTriggered??!1,G=N.defense();if(D(G,"generate defense questions")){g.value=!0;try{const S=await de.post(`/api/projects/${f.project.id}/defense/questions/generate`,{chapter_number:j.value.chapter_number},{headers:{"X-CSRF-TOKEN":document.querySelector('meta[name="csrf-token"]')?.getAttribute("content"),Accept:"application/json","Content-Type":"application/json"}});if(S.data&&S.data.questions){n.value=S.data.questions,z.value=new Date;const I=S.data.questions.reduce((ze,Te)=>{const Ze=H(Te.question),et=H(Te.suggested_answer),tt=(Te.key_points||[]).reduce((st,Pe)=>st+H(Pe),0);return ze+Ze+et+tt},0),pe=`defense_questions_${f.project.id}_chapter_${j.value?.chapter_number}`;localStorage.setItem(pe,JSON.stringify({questions:S.data.questions,chapter_number:j.value?.chapter_number,loaded_at:new Date().toISOString()})),P.success(`Generated ${S.data.questions.length} new questions`),Fr(I||N.defense(),"Defense questions","chapter",f.chapter.id).catch(ze=>console.error("Failed to record word usage (defense):",ze)),T.value=!0,U(),L&&console.log("Auto-generated defense questions after meeting threshold.")}}catch(S){console.error("Failed to generate defense questions:",S),P.error("Failed to generate defense questions")}finally{g.value=!1}}},te=async()=>{!x.value||g.value||_.value||T.value||!Q.value||n.value.length>0||await O({autoTriggered:!0})},Ie=A=>{x.value=A,Z(A),A&&te()},Ye=async(A,L)=>{try{await de.patch(`/api/projects/${f.project.id}/defense/questions/${A}`,{user_marked_helpful:L},{headers:{"X-CSRF-TOKEN":document.querySelector('meta[name="csrf-token"]')?.getAttribute("content"),Accept:"application/json","Content-Type":"application/json"}});const G=n.value.find(S=>S.id===A);G&&(G.user_marked_helpful=L),P.success(L?"Question marked as helpful":"Removed helpful mark")}catch(G){console.error("Failed to mark question:",G),P.error("Failed to update question")}},He=async A=>{try{await de.delete(`/api/projects/${f.project.id}/defense/questions/${A}`,{headers:{"X-CSRF-TOKEN":document.querySelector('meta[name="csrf-token"]')?.getAttribute("content"),Accept:"application/json"}}),n.value=n.value.filter(L=>L.id!==A),localStorage.setItem(`defense_questions_${f.project.id}`,JSON.stringify({questions:n.value,loaded_at:new Date().toISOString()})),P.success("Question hidden")}catch(L){console.error("Failed to hide question:",L),P.error("Failed to hide question")}},Re=async()=>{const A=`defense_questions_${f.project.id}_chapter_${j.value?.chapter_number}`,L=localStorage.getItem(A);let G=!0;if(L){const S=JSON.parse(L),I=new Date(S.loaded_at),pe=new Date(Date.now()-360*60*1e3);I>pe&&S.chapter_number===j.value?.chapter_number&&(n.value=S.questions,z.value=I,G=!1)}G&&await q(!1,{skipGeneration:!0})};return ue(()=>f.chapter,async()=>{n.value=[],p(),E(),x.value=C(),await q(!1,{skipGeneration:!0}),await $e(()=>{M(),te()})},{immediate:!1}),ue([i,x],()=>{te()}),Ae(async()=>{await Re(),E(),await $e(()=>{M(),te()})}),{defenseQuestions:n,isLoadingDefenseQuestions:_,isGeneratingDefenseQuestions:g,autoGenerateDefense:x,shouldLoadDefenseQuestions:ee,loadDefenseQuestions:q,generateNewDefenseQuestions:O,markQuestionHelpful:Ye,hideQuestion:He,handleDefenseAutoToggle:Ie,attemptAutoGenerateDefense:te,getDefenseStatusMessage:k,shouldShowDefenseProgress:w,defenseProgressPercentage:d,defenseWordsRemaining:y,hasTriggeredGeneration:T,meetsDefenseThreshold:Q}}const Xr={class:"flex items-center justify-between"},Jr={class:"space-y-1 w-full max-w-[520px]"},Yr={class:"flex items-center justify-between gap-3"},Zr={class:"flex flex-col"},eo={class:"flex items-center gap-2"},to={class:"flex items-center justify-between px-6 py-2 border-b border-border/30 bg-muted/5"},so={class:"flex items-center gap-2"},ro={class:"space-y-1 relative z-10"},oo={class:"text-sm font-medium text-foreground"},no={class:"text-[10px] text-muted-foreground line-clamp-2 leading-relaxed"},ao={class:"flex-1 relative bg-background"},lo={class:"px-12 py-10 min-h-[500px]"},io={class:"sticky bottom-0 z-10 border-t border-border/30 bg-background/80 backdrop-blur-md p-4 flex items-center justify-between"},uo={class:"text-xs text-muted-foreground"},co={class:"flex items-center gap-2"},es=Je({__name:"ChapterEditorPaperCard",props:{context:{}},setup(f){const i=f.context,D=$(()=>{const _=i.getSectionInfo(i.nextSection);return i.aiChapterAnalysis?.section||_}),N=$(()=>D.value?.name||""),n=$(()=>D.value?.description||"");return(_,g)=>(h(),F(e(oe),{class:"w-full max-w-[850px] min-h-[calc(100vh-180px)] flex flex-col bg-background shadow-xl shadow-black/5 ring-1 ring-black/5 dark:ring-white/10 rounded-xl overflow-hidden transition-all duration-300"},{default:o(()=>[r(e(ae),{class:"flex-shrink-0 border-b border-border/30 px-8 py-6 bg-background/50 backdrop-blur-sm sticky top-0 z-10"},{default:o(()=>[s("div",Xr,[s("div",Jr,[s("div",Yr,[s("div",Zr,[r(e(Gr),{for:"chapter-title",class:"text-xs font-medium text-zinc-500 dark:text-zinc-400 uppercase tracking-wider"},{default:o(()=>[...g[3]||(g[3]=[l("Chapter Title",-1)])]),_:1}),r(e(qr),{id:"chapter-title",modelValue:e(i).chapterTitle,"onUpdate:modelValue":g[0]||(g[0]=z=>e(i).chapterTitle=z),placeholder:"Enter chapter title...",class:"h-auto p-0 border-0 bg-transparent text-2xl font-bold placeholder:text-muted-foreground/40 focus-visible:ring-0 px-0 text-foreground"},null,8,["modelValue"])]),s("div",eo,[r(e(Se),{variant:e(i).chapter.status==="approved"?"default":"secondary",class:"rounded-full px-3"},{default:o(()=>[l(c(e(i).chapter.status.replace("_"," ")),1)]),_:1},8,["variant"]),r(e(Se),{variant:"outline",class:Ge(["rounded-full px-3 transition-colors",{"text-green-600 border-green-200 bg-green-50 dark:bg-green-900/20 dark:border-green-800":(e(i).latestAnalysis?.total_score||0)>=80,"text-yellow-600 border-yellow-200 bg-yellow-50 dark:bg-yellow-900/20 dark:border-yellow-800":(e(i).latestAnalysis?.total_score||0)>=70&&(e(i).latestAnalysis?.total_score||0)<80,"text-orange-600 border-orange-200 bg-orange-50 dark:bg-orange-900/20 dark:border-orange-800":(e(i).latestAnalysis?.total_score||0)>=60&&(e(i).latestAnalysis?.total_score||0)<70,"text-red-600 border-red-200 bg-red-50 dark:bg-red-900/20 dark:border-red-800":(e(i).latestAnalysis?.total_score||0)<60}])},{default:o(()=>[l(c(e(i).latestAnalysis?.total_score?Math.round(e(i).latestAnalysis.total_score):e(i).writingQualityScore)+"% Quality ",1)]),_:1},8,["class"])])])])])]),_:1}),r(e(ne),{class:"flex min-h-0 flex-1 flex-col p-0"},{default:o(()=>[s("div",to,[s("div",so,[r(e(v),{onClick:e(i).togglePresentationMode,variant:e(i).showPresentationMode?"default":"ghost",size:"sm",class:"h-7 text-xs rounded-full text-zinc-700 dark:text-zinc-300 hover:text-foreground"},{default:o(()=>[r(e(rs),{class:"mr-1.5 h-3.5 w-3.5"}),l(" "+c(e(i).showPresentationMode?"Edit":"Preview"),1)]),_:1},8,["onClick","variant"])]),s("div",ro,[s("div",oo,c(N.value),1),s("div",no,c(n.value),1)])]),s("div",ao,[Ee(r(as,{modelValue:e(i).chapterContent,"onUpdate:modelValue":g[1]||(g[1]=z=>e(i).chapterContent=z),placeholder:"Start writing your chapter...","min-height":"500px",class:"min-h-[500px] px-8 py-6",ref:e(i).richTextEditor,"show-toolbar":!0,"streaming-mode":e(i).isStreamingMode,"is-generating":e(i).isGenerating,"generation-progress":e(i).generationProgress,"generation-percentage":e(i).generationPercentage,"generation-phase":e(i).generationPhase,"onUpdate:selectedText":e(i).setSelectedText},null,8,["modelValue","streaming-mode","is-generating","generation-progress","generation-percentage","generation-phase","onUpdate:selectedText"]),[[De,!e(i).showPresentationMode]]),Ee(s("div",lo,[r(ls,{content:e(i).chapterContent,"show-font-controls":!1,class:"prose-lg mx-auto",style:{"font-family":"'Times New Roman', serif","line-height":"1.8"}},null,8,["content"])],512),[[De,e(i).showPresentationMode]])])]),_:1}),s("div",io,[s("div",uo,c(e(i).isSaving?"Saving...":"All changes saved"),1),s("div",co,[r(e(v),{onClick:g[2]||(g[2]=()=>e(i).save(!1)),disabled:!e(i).isValid||e(i).isSaving,size:"sm",variant:"ghost",class:"h-8 rounded-full text-zinc-700 dark:text-zinc-300 hover:text-foreground"},{default:o(()=>[r(e(pt),{class:"mr-2 h-3.5 w-3.5"}),g[4]||(g[4]=l(" Save Draft ",-1))]),_:1},8,["disabled"]),r(e(v),{onClick:e(i).goToBulkAnalysis,variant:"outline",size:"sm",class:"h-8 rounded-full"},{default:o(()=>[r(e(os),{class:"mr-2 h-3.5 w-3.5"}),g[5]||(g[5]=l(" Run Bulk Analysis ",-1))]),_:1},8,["onClick"]),r(e(v),{onClick:e(i).markAsComplete,disabled:e(i).isSaving,size:"sm",class:"h-8 rounded-full bg-gradient-to-r from-primary to-primary/90 shadow-sm hover:shadow-md transition-all"},{default:o(()=>[r(e(Ve),{class:"mr-2 h-3.5 w-3.5"}),g[6]||(g[6]=l(" Complete ",-1))]),_:1},8,["onClick","disabled"])])])]),_:1}))}}),po={class:"flex flex-col gap-4 p-1"},go={class:"p-1.5 rounded-lg bg-primary/10 text-primary"},fo={class:"flex items-center gap-2"},mo={class:"space-y-3"},ho={key:0,class:"space-y-2"},vo={class:"flex items-center justify-between w-full relative z-10"},bo={class:"flex items-center gap-2 text-primary"},xo={class:"space-y-1 relative z-10"},wo={class:"text-sm font-medium text-foreground"},yo={class:"text-[10px] text-muted-foreground line-clamp-2 leading-relaxed"},_o={key:0,class:"p-4 rounded-xl bg-green-500/10 border border-green-500/20 space-y-3"},ko={class:"flex items-center gap-2 text-green-600 dark:text-green-400"},Co={class:"space-y-2"},So={class:"flex justify-between text-[10px] font-medium text-muted-foreground"},Eo={class:"grid grid-cols-2 gap-2 mt-2"},To={class:"p-1.5 rounded-full bg-blue-500/10 text-blue-500"},Ao={class:"p-1.5 rounded-full bg-purple-500/10 text-purple-500"},$o={class:"p-1.5 rounded-full bg-orange-500/10 text-orange-500"},Do={class:"p-1.5 rounded-full bg-emerald-500/10 text-emerald-500"},jo={class:"p-1.5 rounded-full bg-amber-500/10 text-amber-500"},Ro={class:"flex items-center gap-2"},zo={class:"p-1 rounded-xl bg-muted/30 border border-border/50"},Po=Je({__name:"AISidebar",props:{project:{},chapter:{},isGenerating:{type:Boolean},selectedText:{},isLoadingSuggestions:{type:Boolean},showCitationHelper:{type:Boolean},chapterContent:{},cursorPosition:{},currentWordCount:{},targetWordCount:{},canUndo:{type:Boolean}},emits:["startStreamingGeneration","getAISuggestions","update:showCitationHelper","insert-citation","checkCitations","undoLastAction"],setup(f,{emit:b}){const i=f,D=b,N=m("Academic Formal"),n=m(null),_=m(!1),g=m({expand:!1,improve:!1,rephrase:!1,cite:!1,"generate-full":!1,"generate-section":!1,custom:!1}),z=$(()=>!!i.chapter?.id&&!!i.chapter?.chapter_number),x=$(()=>i.chapterContent&&i.chapterContent.trim().length>0);$(()=>!x.value&&z.value),$(()=>!n.value&&z.value);const j=$(()=>!i.isGenerating&&!!i.chapterContent);$(()=>!i.isLoadingSuggestions&&!!i.selectedText);const T=$(()=>n.value&&n.value.section.name!=="NONE"?n.value.section.name.toLowerCase().replace(/\s+/g,"_"):k()),E=$(()=>!i.isGenerating&&!!i.chapter?.id),p=()=>[{id:"introduction",name:"Introduction",description:"Overview and objectives of this chapter"},{id:"content",name:"Main Content",description:"Chapter main content"},{id:"conclusion",name:"Conclusion",description:"Summary and transition to next chapter"}],M=async(w,d)=>{if(Object.values(g.value).some(y=>y)){P("Please wait for the current action to complete");return}try{switch(w in g.value&&(g.value[w]=!0),w){case"expand":i.selectedText?(D("startStreamingGeneration","expand",{selectedText:i.selectedText}),P("Expanding selected text...")):P.error("Please select text to expand");break;case"improve":D("startStreamingGeneration","improve"),P("Improving chapter content...");break;case"rephrase":i.selectedText?(D("startStreamingGeneration","rephrase",{selectedText:i.selectedText,style:N.value}),P("Rephrasing selected text...")):P.error("Please select text to rephrase");break;case"cite":D("update:showCitationHelper",!0),P("Opening citation helper...");break;case"generate-full":D("startStreamingGeneration","progressive"),P("Generating complete chapter...");break;case"generate-section":const y=d?.section||T.value;D("startStreamingGeneration","section",{section:y,mode:"progressive"}),P(`Generating ${y} section...`);break;default:throw new Error(`Unknown action: ${w}`)}}catch(y){console.error(`Quick action '${w}' failed:`,y),P.error(`Failed to ${w.replace("-"," ")}. Please try again.`)}finally{setTimeout(()=>{w in g.value&&(g.value[w]=!1)},1e3)}},k=()=>{if(!x.value)return"introduction";const w=i.chapterContent.toLowerCase(),d=p();for(const y of d)if(![y.name.toLowerCase(),y.id.replace("_"," ")].some(C=>w.includes(C)))return y.id;return"conclusion"},U=w=>{const d=p();return d.find(y=>y.id===w)||d[0]},Q=w=>{D("insert-citation",w)};return ue(()=>i.chapter,w=>{w?.id&&(n.value=null)},{immediate:!1}),ue(()=>i.chapterContent,w=>{n.value&&(!w||w.trim().length===0)&&(n.value=null)},{immediate:!1}),(w,d)=>(h(),W("div",po,[r(e(oe),{class:"border-none shadow-none bg-transparent"},{default:o(()=>[r(e(ae),{class:"px-2 py-3"},{default:o(()=>[r(e(ie),{class:"flex items-center gap-2 text-sm font-semibold text-foreground/80"},{default:o(()=>[s("div",go,[r(e(We),{class:"h-4 w-4"})]),d[9]||(d[9]=l(" AI Assistant ",-1))]),_:1})]),_:1}),r(e(ne),{class:"px-2 space-y-6"},{default:o(()=>[r(e(Jt),{open:!0,class:"space-y-2"},{default:o(()=>[r(e(Yt),{class:"flex w-full items-center justify-between text-xs font-medium text-muted-foreground hover:text-foreground transition-colors group"},{default:o(()=>[s("span",fo,[r(e(lr),{class:"h-3.5 w-3.5 text-amber-500/70 group-hover:text-amber-500 transition-colors"}),d[10]||(d[10]=l(" QUICK ACTIONS ",-1))]),r(e(Ft),{class:"h-3 w-3 transition-transform duration-200 group-data-[state=open]:rotate-180"})]),_:1}),r(e(Zt),{class:"space-y-3 pt-1"},{default:o(()=>[s("div",mo,[r(je,{"enter-active-class":"transition-all duration-300 ease-out","enter-from-class":"opacity-0 scale-95 translate-y-1","enter-to-class":"opacity-100 scale-100 translate-y-0"},{default:o(()=>[n.value&&n.value.show_section_button?(h(),W("div",ho,[r(e(v),{onClick:d[0]||(d[0]=y=>M("generate-section")),disabled:!E.value||_.value||w.isGenerating||g.value["generate-section"],variant:"outline",class:"w-full h-auto flex-col items-start gap-2 p-3 rounded-xl border-primary/20 bg-background/50 hover:bg-primary/5 hover:border-primary/40 transition-all duration-300 text-left group relative overflow-hidden"},{default:o(()=>[d[12]||(d[12]=s("div",{class:"absolute inset-0 bg-gradient-to-r from-primary/5 to-transparent opacity-0 group-hover:opacity-100 transition-opacity"},null,-1)),s("div",vo,[s("div",bo,[r(e(Lt),{class:"h-3.5 w-3.5"}),d[11]||(d[11]=s("span",{class:"text-xs font-semibold"},"Write Next Section",-1))]),g.value["generate-section"]?(h(),F(e(Xe),{key:0,class:"h-3 w-3 animate-spin text-primary"})):Y("",!0)]),s("div",xo,[s("div",wo,c(n.value?.section.name||U(T.value).name),1),s("div",yo,c(n.value?.section.description||U(T.value).description),1)])]),_:1},8,["disabled"])])):Y("",!0)]),_:1}),r(je,{"enter-active-class":"transition-all duration-300 ease-out","enter-from-class":"opacity-0 scale-95 translate-y-1","enter-to-class":"opacity-100 scale-100 translate-y-0"},{default:o(()=>[n.value&&n.value.show_full_chapter_button?(h(),F(e(v),{key:0,onClick:d[1]||(d[1]=y=>M("generate-full")),disabled:w.isGenerating||_.value||g.value["generate-full"],variant:"ghost",class:"w-full h-9 justify-start gap-2 px-3 rounded-lg text-xs text-muted-foreground hover:text-primary hover:bg-primary/5"},{default:o(()=>[r(e(ir),{class:"h-3.5 w-3.5"}),d[13]||(d[13]=s("span",null,"Generate Complete Chapter",-1))]),_:1},8,["disabled"])):Y("",!0)]),_:1}),r(je,{"enter-active-class":"transition-all duration-500 ease-out","enter-from-class":"opacity-0 scale-95 translate-y-2","enter-to-class":"opacity-100 scale-100 translate-y-0"},{default:o(()=>[n.value&&n.value.status==="COMPLETE"?(h(),W("div",_o,[s("div",ko,[r(e(dr),{class:"h-4 w-4"}),d[14]||(d[14]=s("span",{class:"text-sm font-semibold"},"Chapter Complete",-1))]),s("div",Co,[s("div",So,[d[15]||(d[15]=s("span",null,"Progress",-1)),s("span",null,c(n.value.completion_percentage)+"%",1)]),r(e(Ir),{"model-value":n.value.completion_percentage,class:"h-1.5"},null,8,["model-value"])])])):Y("",!0)]),_:1})]),s("div",Eo,[r(e(v),{onClick:d[2]||(d[2]=y=>M("improve")),disabled:!j.value||w.isGenerating||g.value.improve,variant:"outline",class:"h-20 flex-col gap-2 rounded-xl border-border/50 bg-background/50 hover:bg-accent hover:border-accent transition-all duration-300"},{default:o(()=>[s("div",To,[r(e(ur),{class:"h-4 w-4"})]),d[16]||(d[16]=s("span",{class:"text-xs font-medium"},"Improve",-1))]),_:1},8,["disabled"]),r(e(v),{onClick:d[3]||(d[3]=y=>M("expand")),disabled:!w.selectedText||w.isGenerating||g.value.expand,variant:"outline",class:"h-20 flex-col gap-2 rounded-xl border-border/50 bg-background/50 hover:bg-accent hover:border-accent transition-all duration-300"},{default:o(()=>[s("div",Ao,[r(e(cr),{class:"h-4 w-4"})]),d[17]||(d[17]=s("span",{class:"text-xs font-medium"},"Expand",-1))]),_:1},8,["disabled"]),r(e(v),{onClick:d[4]||(d[4]=y=>M("cite")),disabled:w.isGenerating||g.value.cite,variant:"outline",class:"h-20 flex-col gap-2 rounded-xl border-border/50 bg-background/50 hover:bg-accent hover:border-accent transition-all duration-300"},{default:o(()=>[s("div",$o,[r(e(pr),{class:"h-4 w-4"})]),d[18]||(d[18]=s("span",{class:"text-xs font-medium"},"Cite",-1))]),_:1},8,["disabled"]),r(e(v),{onClick:d[5]||(d[5]=y=>M("rephrase")),disabled:!w.selectedText||w.isGenerating||g.value.rephrase,variant:"outline",class:"h-20 flex-col gap-2 rounded-xl border-border/50 bg-background/50 hover:bg-accent hover:border-accent transition-all duration-300"},{default:o(()=>[s("div",Do,[r(e(gr),{class:"h-4 w-4"})]),d[19]||(d[19]=s("span",{class:"text-xs font-medium"},"Rephrase",-1))]),_:1},8,["disabled"]),w.canUndo?(h(),F(e(v),{key:0,onClick:d[6]||(d[6]=y=>D("undoLastAction")),variant:"outline",class:"h-20 flex-col gap-2 rounded-xl border-border/50 bg-background/50 hover:bg-amber-500/10 hover:border-amber-500/30 transition-all duration-300 col-span-2"},{default:o(()=>[s("div",jo,[r(e(fr),{class:"h-4 w-4"})]),d[20]||(d[20]=s("span",{class:"text-xs font-medium"},"Undo Last AI Change",-1))]),_:1})):Y("",!0)])]),_:1})]),_:1}),r(e(qe),{class:"bg-border/50"}),r(e(Jt),{open:!0,class:"space-y-2"},{default:o(()=>[r(e(Yt),{class:"flex w-full items-center justify-between text-xs font-medium text-muted-foreground hover:text-foreground transition-colors group"},{default:o(()=>[s("span",Ro,[r(e(Lt),{class:"h-3.5 w-3.5 text-indigo-500/70 group-hover:text-indigo-500 transition-colors"}),d[21]||(d[21]=l(" WRITING STYLE ",-1))]),r(e(Ft),{class:"h-3 w-3 transition-transform duration-200 group-data-[state=open]:rotate-180"})]),_:1}),r(e(Zt),{class:"pt-1"},{default:o(()=>[s("div",zo,[Ee(s("select",{"onUpdate:modelValue":d[7]||(d[7]=y=>N.value=y),class:"w-full bg-transparent border-none text-xs font-medium focus:ring-0 cursor-pointer py-1.5 px-2"},[...d[22]||(d[22]=[s("option",{value:"Academic Formal"},"Academic Formal",-1),s("option",{value:"Academic Casual"},"Academic Casual",-1),s("option",{value:"Technical"},"Technical",-1),s("option",{value:"Analytical"},"Analytical",-1),s("option",{value:"Research-Heavy"},"Research-Heavy",-1)])],512),[[mr,N.value]])])]),_:1})]),_:1})]),_:1})]),_:1}),r(Hr,{"show-citation-helper":w.showCitationHelper,"chapter-content":w.chapterContent,"chapter-id":w.chapter?.id||0,"onUpdate:showCitationHelper":d[8]||(d[8]=y=>D("update:showCitationHelper",y)),onInsertCitation:Q},null,8,["show-citation-helper","chapter-content","chapter-id"])]))}}),Mo=is(Po,[["__scopeId","data-v-8c5c841d"]]),Fo={class:"h-14 flex items-center justify-between px-4 border-b border-border/40 shrink-0"},Lo={class:"flex-1 overflow-y-auto custom-scrollbar"},No={class:"p-4 space-y-6"},ts=Je({__name:"ChapterEditorRightSidebar",props:{project:{},chapter:{},isGenerating:{type:Boolean},selectedText:{},isLoadingSuggestions:{type:Boolean},showCitationHelper:{type:Boolean},chapterContent:{},currentWordCount:{},targetWordCount:{},handleAIGeneration:{type:Function},getAISuggestions:{type:Function},updateCitationHelper:{type:Function},insertCitation:{type:Function},checkCitations:{type:Function},showDefensePrep:{type:Boolean},defenseQuestions:{},isLoadingDefenseQuestions:{type:Boolean},isGeneratingDefenseQuestions:{type:Boolean},chapterContext:{},defenseWatcher:{},autoGenerateDefense:{type:Boolean},handleDefensePanelToggle:{type:Function},generateNewDefenseQuestions:{type:Function},handleDefenseAutoToggle:{type:Function},refreshDefenseQuestions:{type:Function},markQuestionHelpful:{type:Function},hideQuestion:{type:Function},isCollapsed:{type:Boolean},containerClass:{}},setup(f){const b=f;return(i,D)=>Ee((h(),W("aside",{class:Ge(b.containerClass)},[s("div",Fo,[D[1]||(D[1]=s("span",{class:"text-sm font-semibold tracking-tight text-foreground"},"Writing Assistant",-1)),r(e(X),null,{default:o(()=>[r(e(K),{asChild:""},{default:o(()=>[r(e(v),{variant:"ghost",size:"icon",class:"h-7 w-7"},{default:o(()=>[r(e(os),{class:"h-3.5 w-3.5"})]),_:1})]),_:1}),r(e(V),null,{default:o(()=>[...D[0]||(D[0]=[l("Manage Citations",-1)])]),_:1})]),_:1})]),s("div",Lo,[s("div",No,[r(Mo,{project:b.project,chapter:b.chapter,"is-generating":b.isGenerating,"selected-text":b.selectedText,"is-loading-suggestions":b.isLoadingSuggestions,"show-citation-helper":b.showCitationHelper,"chapter-content":b.chapterContent,"current-word-count":b.currentWordCount,"target-word-count":b.targetWordCount,onStartStreamingGeneration:b.handleAIGeneration,onGetAiSuggestions:b.getAISuggestions,"onUpdate:showCitationHelper":b.updateCitationHelper,onInsertCitation:b.insertCitation,onCheckCitations:b.checkCitations},null,8,["project","chapter","is-generating","selected-text","is-loading-suggestions","show-citation-helper","chapter-content","current-word-count","target-word-count","onStartStreamingGeneration","onGetAiSuggestions","onUpdate:showCitationHelper","onInsertCitation","onCheckCitations"])])])],2)),[[De,!b.isCollapsed]])}});function Oo(f){const b=m({sentences:0,paragraphs:0,readingTime:0,avgWordLength:0,uniqueWords:0,commonWords:[]}),i=$(()=>f.value?f.value.split(/\s+/).filter(n=>n.length>0).length:0),D=()=>{if(!f.value){b.value={sentences:0,paragraphs:0,readingTime:0,avgWordLength:0,uniqueWords:0,commonWords:[]};return}const n=f.value,_=n.split(/\s+/).filter(E=>E.length>0),g=n.split(/[.!?]+/).filter(E=>E.trim().length>0),z=n.split(`

`).filter(E=>E.trim().length>0),x=new Map;_.forEach(E=>{const p=E.toLowerCase().replace(/[^a-z0-9]/g,"");p&&x.set(p,(x.get(p)||0)+1)});const j=new Set(["the","a","an","and","or","but","in","on","at","to","for","of","with","by","is","was","are","were"]),T=Array.from(x.entries()).filter(([E])=>!j.has(E)).sort((E,p)=>p[1]-E[1]).slice(0,5).map(([E])=>E);b.value={sentences:g.length,paragraphs:z.length,readingTime:Math.ceil(_.length/200),avgWordLength:_.reduce((E,p)=>E+p.length,0)/_.length,uniqueWords:x.size,commonWords:T}},N=$(()=>{if(!f.value)return 0;let n=0;const _=f.value;_.includes("##")&&(n+=20),_.length>1e3&&(n+=20),_.match(/\[.*?\]/g)&&(n+=15),(_.includes("**")||_.includes("*"))&&(n+=10);const g=_.split(/[.!?]+/).filter(x=>x.trim().length>0);if(g.length>0){const x=g.reduce((j,T)=>j+T.split(/\s+/).length,0)/g.length;x>10&&x<25&&(n+=20)}return _.split(`

`).filter(x=>x.trim().length>0).length>3&&(n+=15),Math.min(n,100)});return{writingStats:b,currentWordCount:i,writingQualityScore:N,calculateWritingStats:D}}function Wo(f){const b=m(!1),i=m(null),D=m([]),N=m(null),n=$(()=>{if(!i.value?.quality_level)return"text-muted-foreground";switch(i.value.quality_level){case"Excellent":return"text-green-600";case"Good":return"text-blue-600";case"Satisfactory":return"text-yellow-600";case"Needs Improvement":return"text-orange-600";case"Poor":return"text-red-600";default:return"text-muted-foreground"}}),_=$(()=>i.value?.scores?Object.entries(i.value.scores).sort(([,p],[,M])=>p.percentage-M.percentage).slice(0,3).map(([p,M])=>({category:p.replace(" & "," & "),percentage:Math.round(M.percentage),score:M.score,max:M.max})):[]),g=async()=>{try{b.value=!0,N.value=null,await de.get("/sanctum/csrf-cookie");const p=await de.post(J("api.chapters.analysis.analyze",{chapter:f}));if(p.data.success)return i.value=p.data.analysis,p.data.analysis;throw new Error(p.data.error||"Analysis failed")}catch(p){return N.value=p.response?.data?.error||p.message||"Analysis failed",console.error("Chapter analysis failed:",p),null}finally{b.value=!1}};return{isAnalyzing:b,latestAnalysis:i,analysisHistory:D,error:N,qualityLevelColor:n,topImprovementAreas:_,analyzeChapter:g,getLatestAnalysis:async()=>{try{await de.get("/sanctum/csrf-cookie");const p=await de.get(J("api.chapters.analysis.latest",{chapter:f}));return p.data.success?(i.value=p.data.analysis,p.data.analysis):(i.value=null,null)}catch(p){return p.response?.status!==404&&(N.value=p.response?.data?.error||p.message||"Failed to get analysis",console.error("Failed to get latest analysis:",p)),null}},getAnalysisHistory:async()=>{try{await de.get("/sanctum/csrf-cookie");const p=await de.get(J("api.chapters.analysis.history",{chapter:f}));if(p.data.success)return D.value=p.data.analyses,p.data.analyses;throw new Error(p.data.error||"Failed to get history")}catch(p){return N.value=p.response?.data?.error||p.message||"Failed to get analysis history",console.error("Failed to get analysis history:",p),[]}},autoAnalyze:async(p,M=500)=>{p>=M&&await g()},getScoreColor:(p,M)=>{const k=p/M*100;return k>=80?"text-green-600":k>=70?"text-blue-600":k>=60?"text-yellow-600":k>=40?"text-orange-600":"text-red-600"},getProgressVariant:p=>p>=80?"success":p>=60?"default":"destructive"}}const qo={key:0,class:"min-h-screen bg-background text-foreground"},Go={class:"mx-auto max-w-5xl p-6"},Io={class:"flex items-center justify-between gap-4"},Ho={class:"flex items-center gap-3"},Bo={class:"mt-6 grid gap-4"},Uo={class:"flex flex-wrap gap-x-6 gap-y-1"},Qo={class:"grid gap-1"},Ko={class:"grid gap-1"},Vo={class:"grid gap-4 md:grid-cols-3"},Xo={class:"mx-auto w-full max-w-5xl p-6"},Jo={class:"flex items-center justify-between gap-4"},Yo={class:"flex items-center gap-3"},Zo={class:"mt-6 grid gap-4"},en={class:"flex flex-wrap gap-x-6 gap-y-1"},tn={class:"grid gap-1"},sn={class:"grid gap-1"},rn={class:"grid gap-4 md:grid-cols-3"},on={key:0,class:"rounded-xl border border-border bg-card p-4"},nn={key:2,class:"flex h-screen flex-col overflow-hidden bg-background dark:bg-background font-sans selection:bg-primary/20 transition-colors duration-300"},an={class:"relative z-20 flex flex-shrink-0 items-center justify-between border-b border-border/40 bg-background/60 p-4 backdrop-blur-xl supports-[backdrop-filter]:bg-background/40 transition-all duration-300"},ln={class:"flex items-center gap-5"},dn={class:"flex flex-col"},un={class:"text-lg font-bold tracking-tight text-foreground/90 font-display"},cn={class:"flex items-center gap-3 text-xs text-muted-foreground"},pn={class:"flex items-center gap-1.5"},gn={class:"flex items-center gap-4"},fn={class:"flex items-center p-1 rounded-full border border-border/40 bg-background/50 backdrop-blur-sm shadow-sm"},mn={class:"flex items-center gap-2"},hn={class:"relative z-20 h-[2px] w-full bg-border/20"},vn={key:0,class:"mx-3 my-2"},bn={class:"relative overflow-hidden rounded-xl border border-blue-200 bg-gradient-to-br from-blue-50 to-purple-50 p-3 shadow-sm dark:border-blue-800 dark:from-blue-950/30 dark:to-purple-950/30"},xn={class:"relative z-10 mb-2 flex items-center justify-between"},wn={class:"flex items-center gap-2"},yn={class:"relative"},_n={class:"flex h-6 w-6 items-center justify-center rounded-full bg-gradient-to-br from-blue-500 to-purple-600"},kn={class:"text-xs text-blue-700 dark:text-blue-300"},Cn={class:"flex items-center gap-2"},Sn={class:"relative z-10 mb-2"},En={class:"mb-1 flex items-center justify-between"},Tn={class:"text-xs text-blue-600 dark:text-blue-400"},An={class:"relative h-2 overflow-hidden rounded-full bg-blue-100 dark:bg-blue-900/50"},$n={class:"relative z-10 flex items-center gap-2"},Dn={class:"flex-shrink-0"},jn={key:0,class:"h-2 w-2 animate-bounce rounded-full bg-blue-500"},Rn={key:1,class:"flex gap-0.5"},zn={key:2,class:"h-2 w-2 animate-spin rounded-full border-2 border-blue-500 border-t-transparent"},Pn={key:3,class:"h-2 w-2 rounded-full bg-green-500"},Mn={key:4,class:"h-2 w-2 rounded-full bg-red-500"},Fn={class:"flex-1 text-xs text-blue-800 dark:text-blue-200"},Ln={class:"relative z-10 flex flex-1 overflow-hidden"},Nn={key:0,class:"w-[320px] flex-shrink-0 border-r border-border/50 bg-background/80 backdrop-blur-xl shadow-xl z-20"},On={class:"h-full overflow-y-auto custom-scrollbar"},Wn={class:"p-4"},qn={class:"mb-3"},Gn={class:"text-xs text-muted-foreground"},In={class:"flex min-h-0 flex-1 flex-col bg-transparent relative"},Hn={class:"flex-1 overflow-hidden relative"},Bn={"data-editor-scroll-container":"",class:"absolute inset-0 overflow-y-auto custom-scrollbar flex flex-col items-center py-8 px-4 sm:px-8"},Un={class:"flex h-full w-full overflow-hidden relative"},Qn={id:"left-sidebar-panel",class:"hidden lg:flex w-80 flex-col border-r border-border/40 bg-background/60 backdrop-blur-xl z-20 transition-all duration-300"},Kn={class:"h-14 flex items-center justify-between px-4 border-b border-border/40 shrink-0"},Vn={class:"p-4"},Xn={class:"flex-1 flex flex-col relative z-10 min-w-0 bg-background/30 dark:bg-background transition-all duration-300"},Jn={class:"md:hidden flex flex-wrap items-start justify-between border-b border-border/40 bg-background/60 backdrop-blur-md px-4 py-3 relative z-30 transition-all duration-300 gap-y-2"},Yn={class:"flex items-center gap-2 flex-shrink-0 order-1"},Zn={class:"flex items-center order-2"},ea={class:"order-3 w-full flex flex-col gap-3"},ta={class:"flex items-start gap-3 w-full min-w-0"},sa={class:"flex items-center gap-2 justify-between mt-1"},ra={class:"flex items-center gap-2"},oa={class:"flex items-center gap-2"},na={key:0,class:"inline"},aa={class:"hidden md:flex flex-col w-full z-30 bg-background/60 backdrop-blur-md transition-all duration-300 relative"},la={class:"h-10 border-b border-border/40 flex items-left justify-left px-4 bg-background/40"},ia={class:"flex items-left gap-3"},da=["innerHTML"],ua={class:"h-12 border-b border-border/40 flex items-center justify-between px-4 gap-3 bg-muted/10"},ca={class:"flex items-center gap-1"},pa={class:"flex items-center gap-3"},ga={id:"view-controls",class:"flex items-center bg-background/50 rounded-full border border-border/50 p-1 backdrop-blur-sm shadow-sm"},fa={class:"hidden xl:inline"},ma={class:"hidden xl:inline"},ha={class:"flex items-center gap-2"},va={class:"flex items-center gap-2 pl-2 border-l border-border/50"},ba={class:"inline"},xa={class:"flex-1 overflow-hidden relative group bg-background/20"},wa={key:0,class:"absolute top-6 left-0 right-0 z-40 px-4 flex justify-center pointer-events-none"},ya={class:"w-full max-w-lg pointer-events-auto"},_a={class:"relative overflow-hidden rounded-xl border border-blue-200 bg-gradient-to-br from-blue-50/95 to-purple-50/95 p-3 shadow-lg backdrop-blur-lg dark:border-blue-800 dark:from-blue-950/90 dark:to-purple-950/90"},ka={class:"flex items-center gap-3"},Ca={class:"relative flex h-8 w-8 items-center justify-center rounded-full bg-gradient-to-br from-blue-500 to-purple-600 shadow-md"},Sa={class:"flex-1 min-w-0"},Ea={class:"flex items-center justify-between mb-1"},Ta={class:"text-xs font-mono text-muted-foreground"},Aa={class:"h-1.5 w-full bg-blue-100 dark:bg-blue-900/40 rounded-full overflow-hidden"},$a={class:"mt-2 text-xs text-muted-foreground ml-11 truncate"},Da={class:"mx-auto py-12 px-6 sm:px-10 min-h-full"},ja={class:"min-h-[600px] pb-32"},Ra={class:"pb-32"},za={id:"editor-footer",class:"h-7 border-t border-border/30 bg-background/40 backdrop-blur-sm flex items-center justify-between px-4 text-[10px] text-muted-foreground shrink-0"},Pa={class:"flex items-center gap-3"},Ma={class:"hidden sm:inline"},Fa={class:"flex items-center gap-2"},La={key:0,class:"text-green-500 flex items-center gap-1 ml-2"},Na={key:0,class:"fixed inset-0 bg-black/50 flex items-center justify-center z-50"},Oa={class:"text-slate-600 dark:text-slate-300 mb-4"},Wa={class:"font-semibold text-amber-600 dark:text-amber-400"},qa={class:"flex flex-col sm:flex-row gap-3"},Ga=1e3,Ia=Je({__name:"ChapterEditor",props:{project:{},chapter:{},allChapters:{},facultyChapters:{},mode:{}},setup(f){const b=Ue(()=>Ke(()=>import("./ChapterNavigation-BmjncN6T.js"),__vite__mapDeps([0,1,2,3,4,5,6,7]))),i=Ue(()=>Ke(()=>import("./MobileNavOverlay-C9Fu6AUH.js"),__vite__mapDeps([8,3,4,9,2,1,5,6,7,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45]))),D=Ue(()=>Ke(()=>import("./ChatModeLayout-D0PLWv0F.js"),__vite__mapDeps([46,3,4,7,2,11,14,5,36,17,41,37,38,39,42,9,33,28,29,30,31,35,34,22,40,47]))),N=Ue(()=>Ke(()=>import("./CitationVerificationLayout-Dv4E6rnw.js"),__vite__mapDeps([48,7,3,4,2,11,12,14,5,49,41,36,37,38,17,39,42]))),n=f,_=ss(),g=m(null),z=m(null),x=m(!1),j=m(!1),T=m(!1),E=m(0);if(typeof window<"u"){const a=new URLSearchParams(window.location.search);j.value=a.has("theme_sandbox"),T.value=a.get("theme_sandbox")==="nolayout"||a.has("theme_sandbox_nolayout");const t=a.get("theme_sandbox_step"),u=t?Number.parseInt(t,10):0;E.value=Number.isFinite(u)?u:0}const{appearance:p,isDark:M}=ns(),k=m({htmlHasDark:!1,background:"",foreground:"",card:"",sidebarBackground:"",bodyBg:"",insetBg:"",sampleBgBackground:"",sampleBgCard:"",sampleBgMuted:""}),U=m(null),Q=m(null),w=m(null);function d(){if(typeof window>"u")return;const a=document.documentElement,t=window.getComputedStyle(a),u=document.querySelector('[data-slot="sidebar-inset"]'),B=u?window.getComputedStyle(u).backgroundColor:"";k.value={htmlHasDark:a.classList.contains("dark"),background:t.getPropertyValue("--background").trim(),foreground:t.getPropertyValue("--foreground").trim(),card:t.getPropertyValue("--card").trim(),sidebarBackground:t.getPropertyValue("--sidebar-background").trim(),bodyBg:window.getComputedStyle(document.body).backgroundColor,insetBg:B,sampleBgBackground:U.value?window.getComputedStyle(U.value).backgroundColor:"",sampleBgCard:Q.value?window.getComputedStyle(Q.value).backgroundColor:"",sampleBgMuted:w.value?window.getComputedStyle(w.value).backgroundColor:""}}const{chapterTitle:y,chapterContent:R,showPreview:ce,isEditorDark:C,initChapterTheme:Z,toggleChapterTheme:ee,isNativeFullscreen:q,selectedText:H,showChatMode:O,showCitationMode:te,showDefensePrep:Ie,loadChatModeFromStorage:Ye,saveChatModeToStorage:He,showLeftSidebar:Re,showRightSidebar:A,isMobile:L,isLeftSidebarCollapsed:G,isRightSidebarCollapsed:S,showLeftSidebarInFullscreen:I,showRightSidebarInFullscreen:pe}=Ur(n),{balance:ze,showPurchaseModal:Te,requiredWordsForModal:Ze,actionDescriptionForModal:et,checkAndPrompt:tt,closePurchaseModal:st,estimates:Pe}=Lr(),rt=(a,t)=>tt(Math.max(1,Math.round(a)),t),{hasUnsavedChanges:ds,isSaving:ge,triggerAutoSave:Me,save:be,clearAutoSave:us}=Nr({delay:1e4,onSave:Et});let gt=0;const cs=()=>{const a=Date.now();a-gt>Ga&&(gt=a,P.success("Saved",{duration:2e3}))},{contentHistory:ps,historyIndex:gs,addToHistory:fs,undo:ms,redo:hs}=Br(n.chapter.content||""),{writingStats:ft,writingQualityScore:xe,calculateWritingStats:ot}=Oo(R),{isAnalyzing:vs,latestAnalysis:bs,getLatestAnalysis:xs}=Wo(n.chapter.id),le=$(()=>{if(n.facultyChapters&&n.facultyChapters.length>0){const t=n.facultyChapters.find(u=>u.number===n.chapter.chapter_number);if(t?.word_count)return t.word_count}if(n.project?.outlines&&n.project.outlines.length>0){const t=n.project.outlines.find(u=>u.chapter_number===n.chapter.chapter_number);if(t?.target_word_count)return t.target_word_count}const a=n.project.type==="undergraduate"?2500:3500;return n.chapter.chapter_number===1||n.chapter.chapter_number===5?Math.round(a*.8):a}),{generateNextChapter:nt}=Qr({props:n,allChapters:n.allChapters,targetWordCount:le,estimates:Pe,ensureBalance:rt,save:be}),{currentWordCount:se,progressPercentage:ws,DEFENSE_THRESHOLD:ys,countWords:_s}=Or(R,le),at=ws,mt=$(()=>({chapter:n.chapter,chapterTitle:y,chapterContent:R,showPresentationMode:we,togglePresentationMode:jt,isStreamingMode:xt,isGenerating:fe,generationProgress:Fe,generationPercentage:_e,generationPhase:ke,aiChapterAnalysis,nextSection,getSectionInfo,writingStats:ft,latestAnalysis:bs,isAnalyzing:vs,writingQualityScore:xe,isSaving:ge,isValid:Le,save:be,goToBulkAnalysis:it,markAsComplete:dt,richTextEditor:g,richTextEditorFullscreen:z,selectedText:H,setSelectedText:a=>{H.value=a}})),ks=$(()=>({chapter_number:St.value.chapter_number,chapter_title:St.value.title,word_count:se.value})),Cs=$(()=>({meetsThreshold:Os.value,shouldShowProgress:Ms.value,progressPercentage:Fs.value,wordsRemaining:Ls.value,hasTriggeredGeneration:Ns,threshold:ys,statusMessage:Ps()})),ht=$(()=>({project:me.value,chapter:he.value,isGenerating:fe.value,selectedText:H.value,isLoadingSuggestions:bt.value,showCitationHelper:Be.value,chapterContent:R.value,currentWordCount:se.value,targetWordCount:le.value,handleAIGeneration:yt,getAISuggestions:_t,updateCitationHelper:a=>{Be.value=a},insertCitation:Us,checkCitations:kt,showDefensePrep:Ie.value,defenseQuestions:Ss.value??[],isLoadingDefenseQuestions:Es.value,isGeneratingDefenseQuestions:Ts.value,chapterContext:ks.value,defenseWatcher:Cs.value,autoGenerateDefense:As.value,handleDefensePanelToggle:sr,generateNewDefenseQuestions:Ds,handleDefenseAutoToggle:zs,refreshDefenseQuestions:()=>vt(!0,{skipGeneration:!0}),markQuestionHelpful:js,hideQuestion:Rs})),{defenseQuestions:Ss,isLoadingDefenseQuestions:Es,isGeneratingDefenseQuestions:Ts,autoGenerateDefense:As,shouldLoadDefenseQuestions:$s,loadDefenseQuestions:vt,generateNewDefenseQuestions:Ds,markQuestionHelpful:js,hideQuestion:Rs,handleDefenseAutoToggle:zs,getDefenseStatusMessage:Ps,shouldShowDefenseProgress:Ms,defenseProgressPercentage:Fs,defenseWordsRemaining:Ls,hasTriggeredGeneration:Ns,meetsDefenseThreshold:Os}=Vr({props:n,chapterContent:R,currentWordCount:se,ensureBalance:rt,estimates:Pe}),{isGenerating:fe,generationProgress:Fe,generationPercentage:_e,generationPhase:ke,estimatedTotalWords:Ws,streamWordCount:qs,streamBuffer:Ba,lastStreamUpdate:Ua,originalContentForAppend:Qa,aiSuggestions:Ka,isLoadingSuggestions:bt,showCitationHelper:Be,showPresentationMode:we,isStreamingMode:xt,showRecoveryDialog:Gs,partialContentSaved:Va,savedWordCountOnError:Is,isCollectingPapers:Xa,paperCollectionProgress:Ja,paperCollectionPhase:Ya,collectedPapersCount:Za,paperCollectionPercentage:el,currentSource:tl,sourcesCompleted:sl,papersPreview:rl,paperCollectionData:ol,paperCollectionInterval:nl,reconnectAttempts:al,reconnectDelay:ll,isReconnecting:il,currentGenerationId:dl,currentGenerationType:ul,eventSource:wt,editorScrollRef:Hs,attachScroller:cl,smoothScrollToBottom:pl,forceScrollToBottom:gl,resetScroller:fl,isAutoScrollActive:ml,isUserScrollingScroller:hl,scrollToBottom:vl,checkConnectionQuality:bl,handleAIGeneration:yt,handleRegenerateChapter:Bs,getAISuggestions:_t,checkCitations:kt,insertCitation:Us,resumeGeneration:Qs,dismissRecovery:Ks,checkForAutoGeneration:Vs,stopGeneration:Ct}=Wr({props:n,chapterContent:R,targetWordCount:le,estimates:Pe,ensureBalance:rt,save:be,triggerAutoSave:Me,calculateWritingStats:ot,countWords:_s,selectedText:H,richTextEditor:g,richTextEditorFullscreen:z,isNativeFullscreen:q}),Le=$(()=>{const a=y.value?.trim(),t=R.value?.trim();return a&&a.length>0&&t&&t.length>50}),me=$(()=>n.project),he=$(()=>n.chapter),ye=$(()=>n.allChapters),St=$(()=>n.chapter);async function Et(a=!1){try{const t=await fetch(J("chapters.save",{project:n.project.id}),{method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json","X-Requested-With":"XMLHttpRequest","X-CSRF-TOKEN":document.querySelector('meta[name="csrf-token"]')?.getAttribute("content")||""},body:JSON.stringify({project_id:n.project.id,chapter_number:n.chapter.chapter_number,title:y.value,content:R.value,auto_save:a,statistics:ft.value,quality_score:xe.value})});console.log("Response status:",t.status,t.statusText),console.log("Response headers:",t.headers);const u=await t.text();console.log("Raw response:",u);let B;try{B=JSON.parse(u)}catch(ve){throw console.error("JSON parse error:",ve),console.error("Response was:",u),new Error(`Server returned non-JSON response: ${t.status} ${t.statusText}`)}t.ok}catch(t){throw a||P.error("âŒ Save Failed",{description:"Please try again or check your connection."}),t}}const Tt=()=>{const a=ms();a!==null&&(R.value=a,Me())},At=()=>{const a=hs();a!==null&&(R.value=a,Me())},Xs=async()=>{x.value=!1,await Bs(!0)},Ne=a=>{ds.value&&confirm("You have unsaved changes. Save before switching chapters?")&&be();const t=n.allChapters.find(ve=>ve.chapter_number===a),B=t?.content&&t.content.trim()!==""?"chapters.edit":"chapters.write";re.visit(J(B,{project:n.project.slug,chapter:a}),{only:["chapter","mode","allChapters"],preserveState:!0,preserveScroll:!1})},$t=()=>document.fullscreenElement||document.webkitFullscreenElement||document.msFullscreenElement||null,Js=async()=>{try{const a=document.documentElement;a.requestFullscreen?await a.requestFullscreen({navigationUI:"hide"}):a.webkitRequestFullscreen?await a.webkitRequestFullscreen():a.msRequestFullscreen&&await a.msRequestFullscreen()}catch(a){console.error("Error entering fullscreen:",a),P.error("Fullscreen Error",{description:"Unable to enter fullscreen mode"})}},Ys=async()=>{try{document.exitFullscreen?await document.exitFullscreen():document.webkitExitFullscreen?await document.webkitExitFullscreen():document.msExitFullscreen&&await document.msExitFullscreen()}catch(a){console.error("Error exiting fullscreen:",a),P.error("Fullscreen Error",{description:"Unable to exit fullscreen mode"})}},lt=async()=>{if($t()){await Ys();return}await Js()},Ce=()=>{q.value=!!$t(),$e(()=>{Z(),j.value&&d()})},Dt=()=>{O.value=!O.value,O.value&&(te.value=!1),He(O.value)},Zs=()=>{O.value=!1,He(!1)},er=()=>{te.value=!1},jt=()=>{we.value=!we.value},it=()=>{re.visit(J("projects.analysis",{project:n.project.slug}))},tr=()=>{fs(R.value),Me(),ot()},Rt=a=>{(a.ctrlKey||a.metaKey)&&a.key==="s"&&(a.preventDefault(),be(),cs()),(a.ctrlKey||a.metaKey)&&!a.shiftKey&&a.key==="z"&&(a.preventDefault(),Tt()),(a.ctrlKey||a.metaKey)&&a.shiftKey&&a.key==="z"&&(a.preventDefault(),At()),(a.ctrlKey||a.metaKey)&&a.shiftKey&&(a.key==="f"||a.key==="F")&&(a.preventDefault(),lt())};Ae(()=>{const a=()=>{L.value=window.innerWidth<1024};a(),window.addEventListener("resize",a),O.value=Ye(),document.addEventListener("keydown",zt),document.addEventListener("keydown",Rt),document.addEventListener("fullscreenchange",Ce),document.addEventListener("webkitfullscreenchange",Ce),document.addEventListener("msfullscreenchange",Ce),Ce(),ot(),Vs(),Z()});const zt=a=>{if((a.ctrlKey||a.metaKey)&&!["INPUT","TEXTAREA","SELECT"].includes(a.target?.tagName))switch(a.key){case"ArrowLeft":a.preventDefault();const t=n.chapter.chapter_number-1;n.allChapters.find(Oe=>Oe.chapter_number===t)&&Ne(t);break;case"ArrowRight":a.preventDefault();const B=n.chapter.chapter_number+1;n.allChapters.find(Oe=>Oe.chapter_number===B)&&Ne(B);break}};Ae(()=>{const a=t=>{const u=B=>{const{scrollTop:ve,scrollHeight:Oe,clientHeight:rr}=t,Mt=B.deltaY,or=ve<=0,nr=ve+rr>=Oe;Mt<0&&or||Mt>0&&nr||B.stopPropagation()};return t.addEventListener("wheel",u,{passive:!0}),()=>t.removeEventListener("wheel",u)};$e(()=>{const t=document.querySelectorAll('[class*="overflow-y-auto"]'),u=[];t.forEach(B=>{if(B instanceof HTMLElement){const ve=a(B);u.push(ve)}}),window.__scrollChainCleanup=u})}),hr(()=>{us(),wt.value&&wt.value.close(),document.removeEventListener("keydown",Rt),document.removeEventListener("keydown",zt);const a=window.__scrollChainCleanup;a&&Array.isArray(a)&&(a.forEach(t=>t()),delete window.__scrollChainCleanup),document.removeEventListener("fullscreenchange",Ce),document.removeEventListener("webkitfullscreenchange",Ce),document.removeEventListener("msfullscreenchange",Ce)}),ue(()=>n.chapter,async a=>{y.value=a.title||"",R.value=a.content||""},{immediate:!1});const sr=async a=>{Ie.value=a,a&&$s()&&await vt(!1,{skipGeneration:!0})},Pt=()=>{const a=[{popover:{title:"Welcome to the AI Assisted Editor",description:"Experience a powerful writing environment enhanced by AI. Generate an entire chapter with one click and access a suite of AI tools to refine your content.",popoverClass:"driver-popover-welcome"}},{element:"#back-to-project-btn",popover:{title:"Back to Project",description:"Return to your project dashboard."}},{element:"#left-sidebar-panel",popover:{title:"Chapter Navigation",description:"Use the Table of Contents to switch between chapters."},onHighlightStarted:()=>{G.value=!1},showOnMobile:!1},{element:"#view-controls",popover:{title:"View Options",description:"Customize your view with Preview, AI Chat, Fullscreen, and Dark Mode."}},{element:"#toggle-chat-mode",popover:{title:"AI Chat Assistant",description:"Open the AI assistant to help you write, brainstorm, or refine your content."}},{element:"#export-menu-container",popover:{title:"Export",description:"Export your chapter or entire project."}},{element:"#analyze-button",popover:{title:"Bulk Analysis",description:"Analyze content across chapters."}},{element:"#save-button",popover:{title:"Save Work",description:"Manually save your chapter. Auto-save is also active!"}},{element:"#mark-complete-btn",popover:{title:"Mark as Complete",description:"Finished writing? Mark the chapter as complete."}},{element:"#toggle-right-sidebar",popover:{title:"AI Tools Sidebar",description:"Toggle the sidebar to access AI tools like Smart Suggestions and Citation Helper."},showOnMobile:!1},{element:"#right-sidebar-panel",popover:{title:"AI Assistant Tools",description:"Access powerful AI features here."},onHighlightStarted:()=>{S.value=!1},showOnMobile:!1},{element:"#editor-footer",popover:{title:"Writing Stats",description:"Track your word count, quality score, and readiness."}},{element:"#reset-tour-button",popover:{title:"Need Help?",description:"Click here anytime to restart this tour."}}];Sr({showProgress:!0,animate:!0,steps:L.value?a.filter(u=>u.showOnMobile!==!1):a}).drive()};Ae(()=>{if(_.props.auth?.user?.email){const a=`chapter_editor_tour_seen_${_.props.auth.user.email}`;localStorage.getItem(a)||setTimeout(()=>{Pt(),localStorage.setItem(a,"true")},1e3)}}),ue(R,tr),ue(y,Me);const dt=async()=>{console.log("ðŸ”µ [MARK COMPLETE] Function called"),console.log("ðŸ”µ [MARK COMPLETE] Current word count:",se.value);try{console.log("ðŸ”µ [MARK COMPLETE] Saving chapter..."),await be(!1),console.log("âœ… [MARK COMPLETE] Chapter saved");const a=J("chapters.mark-complete",{project:n.project.slug,chapter:n.chapter.chapter_number});console.log("ðŸ”µ [MARK COMPLETE] Posting to:",a),re.post(a,{},{onSuccess:()=>{console.log("âœ… [MARK COMPLETE] Request successful")},onError:t=>{console.error("âŒ [MARK COMPLETE] Request failed:",t)}})}catch(a){console.error("âŒ [MARK COMPLETE] Error:",a),P.error("Failed to save chapter before marking complete")}};return Ae(async()=>{await xs()}),Ae(()=>{j.value&&$e(()=>d())}),ue(M,()=>{j.value&&$e(()=>d())},{flush:"post"}),(a,t)=>(h(),F(e(Er),null,{default:o(()=>[j.value?(h(),W(Nt,{key:0},[T.value?(h(),W("div",qo,[s("div",Go,[s("div",Io,[t[31]||(t[31]=s("div",null,[s("h1",{class:"text-lg font-semibold"},"ChapterEditor Theme Sandbox"),s("p",{class:"text-sm text-muted-foreground"},"No layout mode. Use `?theme_sandbox=nolayout`.")],-1)),s("div",Ho,[r(Vt),r(e(v),{variant:"outline",size:"sm",onClick:d},{default:o(()=>[...t[29]||(t[29]=[l("Refresh",-1)])]),_:1}),r(e(v),{variant:"outline",size:"sm",onClick:t[0]||(t[0]=u=>e(re).visit(a.window.location.pathname))},{default:o(()=>[...t[30]||(t[30]=[l("Exit",-1)])]),_:1})])]),s("div",Bo,[r(e(oe),{class:"bg-card text-card-foreground"},{default:o(()=>[r(e(ae),null,{default:o(()=>[r(e(ie),{class:"text-base"},{default:o(()=>[...t[32]||(t[32]=[l("Theme State",-1)])]),_:1})]),_:1}),r(e(ne),{class:"space-y-2 text-sm"},{default:o(()=>[s("div",Uo,[s("div",null,[t[33]||(t[33]=s("span",{class:"text-muted-foreground"},"appearance:",-1)),l(" "+c(e(p)),1)]),s("div",null,[t[34]||(t[34]=s("span",{class:"text-muted-foreground"},"isDark:",-1)),l(" "+c(e(M)),1)]),s("div",null,[t[35]||(t[35]=s("span",{class:"text-muted-foreground"},"html.dark:",-1)),l(" "+c(k.value.htmlHasDark),1)]),s("div",null,[t[36]||(t[36]=s("span",{class:"text-muted-foreground"},"step:",-1)),l(" "+c(E.value),1)])]),r(e(qe)),s("div",Qo,[s("div",null,[t[37]||(t[37]=s("span",{class:"text-muted-foreground"},"--background:",-1)),l(" "+c(k.value.background),1)]),s("div",null,[t[38]||(t[38]=s("span",{class:"text-muted-foreground"},"--foreground:",-1)),l(" "+c(k.value.foreground),1)]),s("div",null,[t[39]||(t[39]=s("span",{class:"text-muted-foreground"},"--card:",-1)),l(" "+c(k.value.card),1)]),s("div",null,[t[40]||(t[40]=s("span",{class:"text-muted-foreground"},"--sidebar-background:",-1)),l(" "+c(k.value.sidebarBackground),1)])]),r(e(qe)),s("div",Ko,[s("div",null,[t[41]||(t[41]=s("span",{class:"text-muted-foreground"},"body bg:",-1)),l(" "+c(k.value.bodyBg),1)]),s("div",null,[t[42]||(t[42]=s("span",{class:"text-muted-foreground"},"inset bg:",-1)),l(" "+c(k.value.insetBg),1)]),s("div",null,[t[43]||(t[43]=s("span",{class:"text-muted-foreground"},"sample bg-background:",-1)),l(" "+c(k.value.sampleBgBackground),1)]),s("div",null,[t[44]||(t[44]=s("span",{class:"text-muted-foreground"},"sample bg-card:",-1)),l(" "+c(k.value.sampleBgCard),1)]),s("div",null,[t[45]||(t[45]=s("span",{class:"text-muted-foreground"},"sample bg-muted:",-1)),l(" "+c(k.value.sampleBgMuted),1)])])]),_:1})]),_:1}),s("div",Vo,[r(e(oe),{ref_key:"sampleBgBackgroundEl",ref:U,class:"bg-background"},{default:o(()=>[r(e(ae),null,{default:o(()=>[r(e(ie),{class:"text-base"},{default:o(()=>[...t[46]||(t[46]=[l("bg-background",-1)])]),_:1})]),_:1}),r(e(ne),{class:"text-sm text-muted-foreground"},{default:o(()=>[...t[47]||(t[47]=[l("Should flip with theme.",-1)])]),_:1})]),_:1},512),r(e(oe),{ref_key:"sampleBgCardEl",ref:Q,class:"bg-card"},{default:o(()=>[r(e(ae),null,{default:o(()=>[r(e(ie),{class:"text-base"},{default:o(()=>[...t[48]||(t[48]=[l("bg-card",-1)])]),_:1})]),_:1}),r(e(ne),{class:"text-sm text-muted-foreground"},{default:o(()=>[...t[49]||(t[49]=[l("Card surface color.",-1)])]),_:1})]),_:1},512),r(e(oe),{ref_key:"sampleBgMutedEl",ref:w,class:"bg-muted"},{default:o(()=>[r(e(ae),null,{default:o(()=>[r(e(ie),{class:"text-base"},{default:o(()=>[...t[50]||(t[50]=[l("bg-muted",-1)])]),_:1})]),_:1}),r(e(ne),{class:"text-sm text-muted-foreground"},{default:o(()=>[...t[51]||(t[51]=[l("Muted surface color.",-1)])]),_:1})]),_:1},512)])])])])):(h(),F(Xt,{key:1,class:"h-screen overflow-hidden bg-background text-foreground"},{default:o(()=>[s("div",Xo,[s("div",Jo,[t[54]||(t[54]=s("div",null,[s("h1",{class:"text-lg font-semibold"},"ChapterEditor Theme Sandbox"),s("p",{class:"text-sm text-muted-foreground"}," Use `?theme_sandbox=1` (with layout) or `?theme_sandbox=nolayout`. ")],-1)),s("div",Yo,[r(Vt),r(e(v),{variant:"outline",size:"sm",onClick:d},{default:o(()=>[...t[52]||(t[52]=[l("Refresh",-1)])]),_:1}),r(e(v),{variant:"outline",size:"sm",onClick:t[1]||(t[1]=u=>e(re).visit(a.window.location.pathname))},{default:o(()=>[...t[53]||(t[53]=[l("Exit",-1)])]),_:1})])]),s("div",Zo,[r(e(oe),{class:"bg-card text-card-foreground"},{default:o(()=>[r(e(ae),null,{default:o(()=>[r(e(ie),{class:"text-base"},{default:o(()=>[...t[55]||(t[55]=[l("Theme State",-1)])]),_:1})]),_:1}),r(e(ne),{class:"space-y-2 text-sm"},{default:o(()=>[s("div",en,[s("div",null,[t[56]||(t[56]=s("span",{class:"text-muted-foreground"},"appearance:",-1)),l(" "+c(e(p)),1)]),s("div",null,[t[57]||(t[57]=s("span",{class:"text-muted-foreground"},"isDark:",-1)),l(" "+c(e(M)),1)]),s("div",null,[t[58]||(t[58]=s("span",{class:"text-muted-foreground"},"html.dark:",-1)),l(" "+c(k.value.htmlHasDark),1)]),s("div",null,[t[59]||(t[59]=s("span",{class:"text-muted-foreground"},"step:",-1)),l(" "+c(E.value),1)])]),r(e(qe)),s("div",tn,[s("div",null,[t[60]||(t[60]=s("span",{class:"text-muted-foreground"},"--background:",-1)),l(" "+c(k.value.background),1)]),s("div",null,[t[61]||(t[61]=s("span",{class:"text-muted-foreground"},"--foreground:",-1)),l(" "+c(k.value.foreground),1)]),s("div",null,[t[62]||(t[62]=s("span",{class:"text-muted-foreground"},"--card:",-1)),l(" "+c(k.value.card),1)]),s("div",null,[t[63]||(t[63]=s("span",{class:"text-muted-foreground"},"--sidebar-background:",-1)),l(" "+c(k.value.sidebarBackground),1)])]),r(e(qe)),s("div",sn,[s("div",null,[t[64]||(t[64]=s("span",{class:"text-muted-foreground"},"body bg:",-1)),l(" "+c(k.value.bodyBg),1)]),s("div",null,[t[65]||(t[65]=s("span",{class:"text-muted-foreground"},"inset bg:",-1)),l(" "+c(k.value.insetBg),1)]),s("div",null,[t[66]||(t[66]=s("span",{class:"text-muted-foreground"},"sample bg-background:",-1)),l(" "+c(k.value.sampleBgBackground),1)]),s("div",null,[t[67]||(t[67]=s("span",{class:"text-muted-foreground"},"sample bg-card:",-1)),l(" "+c(k.value.sampleBgCard),1)]),s("div",null,[t[68]||(t[68]=s("span",{class:"text-muted-foreground"},"sample bg-muted:",-1)),l(" "+c(k.value.sampleBgMuted),1)])])]),_:1})]),_:1}),s("div",rn,[r(e(oe),{ref_key:"sampleBgBackgroundEl",ref:U,class:"bg-background"},{default:o(()=>[r(e(ae),null,{default:o(()=>[r(e(ie),{class:"text-base"},{default:o(()=>[...t[69]||(t[69]=[l("bg-background",-1)])]),_:1})]),_:1}),r(e(ne),{class:"text-sm text-muted-foreground"},{default:o(()=>[...t[70]||(t[70]=[l("Should flip with theme.",-1)])]),_:1})]),_:1},512),r(e(oe),{ref_key:"sampleBgCardEl",ref:Q,class:"bg-card"},{default:o(()=>[r(e(ae),null,{default:o(()=>[r(e(ie),{class:"text-base"},{default:o(()=>[...t[71]||(t[71]=[l("bg-card",-1)])]),_:1})]),_:1}),r(e(ne),{class:"text-sm text-muted-foreground"},{default:o(()=>[...t[72]||(t[72]=[l("Card surface color.",-1)])]),_:1})]),_:1},512),r(e(oe),{ref_key:"sampleBgMutedEl",ref:w,class:"bg-muted"},{default:o(()=>[r(e(ae),null,{default:o(()=>[r(e(ie),{class:"text-base"},{default:o(()=>[...t[73]||(t[73]=[l("bg-muted",-1)])]),_:1})]),_:1}),r(e(ne),{class:"text-sm text-muted-foreground"},{default:o(()=>[...t[74]||(t[74]=[l("Muted surface color.",-1)])]),_:1})]),_:1},512)]),E.value>=1?(h(),W("div",on,[t[75]||(t[75]=s("div",{class:"text-sm font-medium"},"Step 1: Paper Card only",-1)),t[76]||(t[76]=s("div",{class:"text-xs text-muted-foreground mb-3"},"Adds `ChapterEditorPaperCard` only.",-1)),r(es,{context:mt.value},null,8,["context"])])):Y("",!0)])])]),_:1}))],64)):(h(),W(Nt,{key:1},[e(O)?(h(),F(e(D),{key:0,project:me.value,chapter:he.value,"chapter-title":e(y),"chapter-content":e(R),"current-word-count":e(se),"target-word-count":le.value,"progress-percentage":e(at),"writing-quality-score":e(xe),"is-valid":Le.value,"is-saving":e(ge),"show-preview":e(ce),"is-generating":e(fe),"generation-progress":e(Fe),"history-index":e(gs),"content-history-length":e(ps).length,"selected-text":e(H),"onUpdate:chapterTitle":t[2]||(t[2]=u=>y.value=u),"onUpdate:chapterContent":t[3]||(t[3]=u=>R.value=u),"onUpdate:selectedText":t[4]||(t[4]=u=>H.value=u),"onUpdate:showPreview":t[5]||(t[5]=u=>ce.value=u),onSave:t[6]||(t[6]=u=>Et(u)),onUndo:Tt,onRedo:At,onExitChatMode:Zs},null,8,["project","chapter","chapter-title","chapter-content","current-word-count","target-word-count","progress-percentage","writing-quality-score","is-valid","is-saving","show-preview","is-generating","generation-progress","history-index","content-history-length","selected-text"])):e(te)?(h(),F(e(N),{key:1,project:me.value,chapter:he.value,"chapter-title":e(y),"chapter-content":e(R),"current-word-count":e(se),"target-word-count":le.value,"progress-percentage":e(at),onExitCitationMode:er},null,8,["project","chapter","chapter-title","chapter-content","current-word-count","target-word-count","progress-percentage"])):e(q)?(h(),W("div",nn,[t[93]||(t[93]=s("div",{class:"absolute inset-0 z-0 overflow-hidden pointer-events-none"},[s("div",{class:"absolute top-[-20%] left-[-10%] w-[50%] h-[50%] rounded-full bg-blue-500/5 blur-[120px]"}),s("div",{class:"absolute bottom-[-20%] right-[-10%] w-[50%] h-[50%] rounded-full bg-purple-500/5 blur-[120px]"})],-1)),s("div",an,[s("div",ln,[r(e(X),null,{default:o(()=>[r(e(K),{asChild:""},{default:o(()=>[r(e(v),{onClick:t[7]||(t[7]=u=>e(re).visit(e(J)("projects.show",n.project.slug))),variant:"ghost",size:"icon",class:"h-10 w-10 rounded-full hover:bg-primary/10 hover:text-primary transition-all duration-300"},{default:o(()=>[r(e(ut),{class:"h-5 w-5"})]),_:1})]),_:1}),r(e(V),null,{default:o(()=>[...t[77]||(t[77]=[s("p",null,"Back to Project",-1)])]),_:1})]),_:1}),s("div",dn,[s("h1",un,c(n.project.title),1),s("div",cn,[r(e(Se),{variant:"outline",class:"h-5 px-2 rounded-full border-primary/20 bg-primary/5 text-primary font-medium"},{default:o(()=>[l(" Chapter "+c(n.chapter.chapter_number),1)]),_:1}),s("span",pn,[t[78]||(t[78]=s("span",{class:"h-1.5 w-1.5 rounded-full bg-green-500 animate-pulse"},null,-1)),l(" "+c(e(se))+" words ",1)])])])]),s("div",gn,[s("div",fn,[r(e(v),{onClick:t[8]||(t[8]=u=>I.value=!e(I)),variant:e(I)?"secondary":"ghost",size:"sm",class:Ge(["h-8 px-4 rounded-full text-xs font-medium transition-all duration-300",e(I)?"bg-primary/10 text-primary hover:bg-primary/15":"hover:bg-muted"])},{default:o(()=>[r(e(Ot),{class:"mr-2 h-3.5 w-3.5"}),t[79]||(t[79]=l(" Outline ",-1))]),_:1},8,["variant","class"]),t[81]||(t[81]=s("div",{class:"w-px h-4 bg-border/50 mx-1"},null,-1)),r(e(v),{onClick:t[9]||(t[9]=u=>pe.value=!e(pe)),variant:e(pe)?"secondary":"ghost",size:"sm",class:Ge(["h-8 px-4 rounded-full text-xs font-medium transition-all duration-300",e(pe)?"bg-primary/10 text-primary hover:bg-primary/15":"hover:bg-muted"])},{default:o(()=>[r(e(We),{class:"mr-2 h-3.5 w-3.5"}),t[80]||(t[80]=l(" Assistant ",-1))]),_:1},8,["variant","class"])]),s("div",mn,[r(e(X),null,{default:o(()=>[r(e(K),{asChild:""},{default:o(()=>[r(e(v),{onClick:Dt,variant:"ghost",size:"icon",class:"h-9 w-9 rounded-full transition-all hover:bg-muted"},{default:o(()=>[r(e(Wt),{class:"h-4.5 w-4.5 text-blue-500"})]),_:1})]),_:1}),r(e(V),null,{default:o(()=>[...t[82]||(t[82]=[s("p",null,"Open AI Chat",-1)])]),_:1})]),_:1}),r(e(X),null,{default:o(()=>[r(e(K),{asChild:""},{default:o(()=>[r(e(v),{onClick:lt,variant:e(q)?"secondary":"ghost",size:"icon",class:"h-9 w-9 rounded-full transition-all hover:bg-muted"},{default:o(()=>[e(q)?(h(),F(e(qt),{key:0,class:"h-4.5 w-4.5"})):(h(),F(e(Gt),{key:1,class:"h-4.5 w-4.5"}))]),_:1},8,["variant"])]),_:1}),r(e(V),null,{default:o(()=>[s("p",null,c(e(q)?"Exit fullscreen":"Enter fullscreen"),1)]),_:1})]),_:1}),r(e(X),null,{default:o(()=>[r(e(K),{asChild:""},{default:o(()=>[r(e(v),{onClick:e(ee),variant:e(C)?"secondary":"ghost",size:"icon",class:"h-9 w-9 rounded-full transition-all hover:bg-muted"},{default:o(()=>[e(C)?(h(),F(e(It),{key:0,class:"h-4.5 w-4.5 text-foreground"})):(h(),F(e(Ht),{key:1,class:"h-4.5 w-4.5 text-muted-foreground"}))]),_:1},8,["onClick","variant"])]),_:1}),r(e(V),null,{default:o(()=>[...t[83]||(t[83]=[s("p",null,"Toggle Dark Mode",-1)])]),_:1})]),_:1}),r(ct,{project:me.value,"current-chapter":he.value,"all-chapters":ye.value,size:"icon",variant:"ghost",class:"h-9 w-9 rounded-full hover:bg-muted"},null,8,["project","current-chapter","all-chapters"])])])]),s("div",hn,[s("div",{class:"absolute top-0 left-0 h-full bg-gradient-to-r from-blue-500 via-purple-500 to-pink-500 transition-all duration-700 ease-out shadow-[0_0_10px_rgba(59,130,246,0.5)]",style:Qe({width:`${Math.min(e(at),100)}%`})},null,4)]),e(fe)?(h(),W("div",vn,[s("div",bn,[t[89]||(t[89]=s("div",{class:"absolute inset-0 -skew-x-12 animate-pulse bg-gradient-to-r from-transparent via-white/10 to-transparent"},null,-1)),s("div",xn,[s("div",wn,[s("div",yn,[s("div",_n,[r(e(We),{class:"h-3 w-3 text-white"})]),t[84]||(t[84]=s("div",{class:"absolute inset-0 h-6 w-6 animate-ping rounded-full bg-gradient-to-br from-blue-500 to-purple-600 opacity-20"},null,-1))]),s("div",null,[t[85]||(t[85]=s("h4",{class:"text-xs font-semibold text-blue-900 dark:text-blue-100"},"AI Generator",-1)),s("p",kn,c(e(ke)),1)])]),s("div",Cn,[r(e(v),{variant:"ghost",size:"icon",class:"h-7 w-7 rounded-full hover:bg-red-100 dark:hover:bg-red-900/20",onClick:e(Ct),title:"Stop generation"},{default:o(()=>[r(e(Bt),{class:"h-4 w-4 text-red-600 dark:text-red-400"})]),_:1},8,["onClick"]),r(e(Se),{variant:"outline",class:"border-blue-300 text-xs text-blue-700 dark:border-blue-700 dark:text-blue-300"},{default:o(()=>[l(c(Math.round(e(_e)))+"% ",1)]),_:1})])]),s("div",Sn,[s("div",En,[t[86]||(t[86]=s("span",{class:"text-xs text-blue-800 dark:text-blue-200"},"Generation Progress",-1)),s("span",Tn,c(e(qs))+" / "+c(e(Ws))+" words",1)]),s("div",An,[s("div",{class:"absolute top-0 left-0 h-full rounded-full bg-gradient-to-r from-blue-500 to-purple-500 transition-all duration-500 ease-out",style:Qe({width:`${e(_e)}%`})},[...t[87]||(t[87]=[s("div",{class:"absolute inset-0 animate-pulse bg-gradient-to-r from-transparent via-white/30 to-transparent"},null,-1)])],4),s("div",{class:"absolute top-0 left-0 h-full rounded-full bg-gradient-to-r from-blue-400 to-purple-400 opacity-50 blur-sm transition-all duration-500",style:Qe({width:`${e(_e)}%`})},null,4)])]),s("div",$n,[s("div",Dn,[e(ke)==="Initializing"?(h(),W("div",jn)):e(ke)==="Connecting"?(h(),W("div",Rn,[...t[88]||(t[88]=[s("div",{class:"h-2 w-0.5 animate-pulse rounded-full bg-blue-500"},null,-1),s("div",{class:"h-2 w-0.5 animate-pulse rounded-full bg-purple-500",style:{"animation-delay":"0.2s"}},null,-1),s("div",{class:"h-2 w-0.5 animate-pulse rounded-full bg-blue-500",style:{"animation-delay":"0.4s"}},null,-1)])])):e(ke)==="Generating"?(h(),W("div",zn)):e(ke)==="Complete"?(h(),W("div",Pn)):(h(),W("div",Mn))]),s("p",Fn,c(e(Fe)),1)])])])):Y("",!0),s("div",Ln,[r(je,{"enter-active-class":"transition-all duration-300 ease-in-out","enter-from-class":"-ml-72 opacity-0","enter-to-class":"ml-0 opacity-100","leave-active-class":"transition-all duration-300 ease-in-out","leave-from-class":"ml-0 opacity-100","leave-to-class":"-ml-72 opacity-0"},{default:o(()=>[e(I)?(h(),W("div",Nn,[s("div",On,[s("div",Wn,[s("div",qn,[t[90]||(t[90]=s("h2",{class:"text-sm font-semibold text-foreground mb-1"},"Table of Contents",-1)),s("p",Gn,c(ye.value.length)+" Chapters ",1)]),(h(),F(vr,null,{fallback:o(()=>[...t[91]||(t[91]=[s("div",{class:"flex items-center justify-center p-8"},[s("div",{class:"h-6 w-6 animate-spin rounded-full border-2 border-primary border-t-transparent"})],-1)])]),default:o(()=>[r(e(b),{"all-chapters":ye.value,"current-chapter":he.value,project:me.value,outlines:a.project.outlines||[],"faculty-chapters":a.facultyChapters||[],"current-word-count":e(se),"target-word-count":le.value,"writing-quality-score":e(xe),"chapter-content-length":e(R).length,onGoToChapter:Ne,onGenerateNextChapter:e(nt)},null,8,["all-chapters","current-chapter","project","outlines","faculty-chapters","current-word-count","target-word-count","writing-quality-score","chapter-content-length","onGenerateNextChapter"])]),_:1}))])])])):Y("",!0)]),_:1}),s("div",In,[s("div",Hn,[s("div",Bn,[r(es,{context:mt.value},null,8,["context"]),t[92]||(t[92]=s("div",{class:"h-12"},null,-1))])])]),r(je,{"enter-active-class":"transition-all duration-300 ease-in-out","enter-from-class":"-mr-72 opacity-0","enter-to-class":"mr-0 opacity-100","leave-active-class":"transition-all duration-300 ease-in-out","leave-from-class":"mr-0 opacity-100","leave-to-class":"-mr-72 opacity-0"},{default:o(()=>[e(pe)?(h(),F(ts,Ut({key:0,"container-class":"w-72 flex-shrink-0 border-l border-border/40 bg-background/40 backdrop-blur-md"},ht.value),null,16)):Y("",!0)]),_:1})])])):(h(),F(Xt,{key:3,class:"h-screen overflow-hidden bg-background dark:bg-background transition-colors duration-300"},{default:o(()=>[s("div",Un,[t[117]||(t[117]=s("div",{class:"absolute inset-0 z-0 overflow-hidden pointer-events-none"},[s("div",{class:"absolute top-[-10%] left-[-10%] w-[40%] h-[40%] rounded-full bg-blue-500/5 blur-[100px]"}),s("div",{class:"absolute bottom-[-10%] right-[-10%] w-[40%] h-[40%] rounded-full bg-purple-500/5 blur-[100px]"})],-1)),Ee(s("aside",Qn,[s("div",Kn,[t[94]||(t[94]=s("span",{class:"text-sm font-semibold tracking-tight text-foreground"},"Navigation",-1)),r(e(Se),{variant:"outline",class:"text-[10px] h-5 px-1.5"},{default:o(()=>[l(c(ye.value.length)+" Chapters ",1)]),_:1})]),r(e(Kt),{class:"flex-1"},{default:o(()=>[s("div",Vn,[r(e(b),{"all-chapters":ye.value,"current-chapter":he.value,project:me.value,outlines:a.project.outlines||[],"faculty-chapters":a.facultyChapters||[],"current-word-count":e(se),"target-word-count":le.value,"writing-quality-score":e(xe),"chapter-content-length":e(R).length,onGoToChapter:Ne,onGenerateNextChapter:e(nt)},null,8,["all-chapters","current-chapter","project","outlines","faculty-chapters","current-word-count","target-word-count","writing-quality-score","chapter-content-length","onGenerateNextChapter"])])]),_:1})],512),[[De,!e(G)]]),s("main",Xn,[s("header",Jn,[s("div",Yn,[r(e(X),null,{default:o(()=>[r(e(K),{asChild:""},{default:o(()=>[r(e(v),{id:"back-to-project-btn-mobile",variant:"ghost",size:"icon",class:"h-9 w-9 text-zinc-700 dark:text-zinc-300 hover:text-foreground hover:bg-muted/50 rounded-full",onClick:t[10]||(t[10]=u=>e(re).visit(e(J)("projects.writing",n.project.slug)))},{default:o(()=>[r(e(ut),{class:"w-4 h-4"})]),_:1})]),_:1}),r(e(V),null,{default:o(()=>[...t[95]||(t[95]=[l("Back to Writing",-1)])]),_:1})]),_:1}),t[96]||(t[96]=s("div",{class:"h-6 w-px bg-border/50 mx-1 hidden lg:block"},null,-1)),r(e(v),{variant:"ghost",size:"icon",onClick:t[11]||(t[11]=u=>Re.value=!0),class:"lg:hidden text-muted-foreground hover:text-foreground h-9 w-9 hover:bg-muted/50 rounded-full"},{default:o(()=>[r(e(Ot),{class:"h-4.5 w-4.5"})]),_:1})]),s("div",Zn,[r(e(v),{variant:"ghost",size:"icon",onClick:t[12]||(t[12]=u=>A.value=!0),class:"text-muted-foreground hover:text-foreground h-9 w-9 hover:bg-muted/50 rounded-full"},{default:o(()=>[r(e(We),{class:"h-4.5 w-4.5"})]),_:1})]),s("div",ea,[s("div",ta,[s("h1",{class:"text-xl font-bold tracking-tight text-foreground leading-snug cursor-pointer hover:text-primary/80 transition-colors break-words",onClick:t[13]||(t[13]=u=>e(re).visit(e(J)("projects.show",n.project.slug)))},c(n.project.title),1),r(e(Se),{variant:"secondary",class:"shrink-0 h-5 px-2 text-[10px] font-medium rounded-full bg-secondary/50 border border-border/50 mt-1"},{default:o(()=>[l(" Ch "+c(n.chapter.chapter_number),1)]),_:1})]),s("div",sa,[s("div",ra,[r(ct,{project:me.value,"current-chapter":he.value,"all-chapters":ye.value,size:"icon",variant:"outline","trigger-element":"icon","button-class":"h-8 w-8 rounded-full bg-background/50 backdrop-blur-sm",class:"text-zinc-700 dark:text-zinc-300"},null,8,["project","current-chapter","all-chapters"]),r(e(v),{variant:"outline",size:"icon",class:"h-8 w-8 gap-2 text-zinc-700 dark:text-zinc-300 hover:text-foreground bg-background/50 backdrop-blur-sm rounded-full",onClick:it},{default:o(()=>[r(e(Qt),{class:"w-4 h-4"})]),_:1}),r(e(v),{variant:"outline",size:"icon",class:"h-8 w-8 gap-2 text-zinc-700 dark:text-zinc-300 hover:text-foreground bg-background/50 backdrop-blur-sm rounded-full",disabled:e(fe),onClick:t[14]||(t[14]=u=>x.value=!0),title:"Regenerate chapter"},{default:o(()=>[r(e(Xe),{class:"w-4 h-4"})]),_:1},8,["disabled"])]),s("div",oa,[r(e(v),{onClick:t[15]||(t[15]=u=>e(be)(!1)),disabled:e(ge),variant:Le.value?"default":"secondary",size:"sm",class:"h-8 px-3 text-xs shadow-sm gap-2 rounded-full min-w-[32px]"},{default:o(()=>[r(e(pt),{class:"h-3.5 w-3.5"}),e(ge)?(h(),W("span",na,"Saving")):Y("",!0)]),_:1},8,["disabled","variant"]),r(e(v),{onClick:dt,disabled:e(ge),size:"sm",class:"h-8 px-3 text-xs shadow-sm gap-2 rounded-full"},{default:o(()=>[r(e(Ve),{class:"h-3.5 w-3.5"}),t[97]||(t[97]=s("span",{class:"sm:hidden"},"Done",-1))]),_:1},8,["disabled"])])])])]),s("div",aa,[s("div",la,[s("div",ia,[s("h1",{class:"text-sm font-bold text-foreground cursor-pointer hover:text-primary transition-colors flex items-center",onClick:t[16]||(t[16]=u=>e(re).visit(e(J)("projects.show",n.project.slug)))},[s("div",{innerHTML:n.project.title,class:"inline-block"},null,8,da)]),r(e(Se),{variant:"secondary",class:"h-5 px-2 text-[10px] font-medium rounded-full bg-secondary/50 border border-border/50"},{default:o(()=>[l(" Ch "+c(n.chapter.chapter_number),1)]),_:1})])]),s("div",ua,[s("div",ca,[r(e(X),null,{default:o(()=>[r(e(K),{asChild:""},{default:o(()=>[r(e(v),{id:"back-to-project-btn",variant:"ghost",size:"icon",class:"h-8 w-8 text-zinc-700 dark:text-zinc-300 hover:text-foreground rounded-full",onClick:t[17]||(t[17]=u=>e(re).visit(e(J)("projects.writing",n.project.slug)))},{default:o(()=>[r(e(ut),{class:"w-4 h-4"})]),_:1})]),_:1}),r(e(V),null,{default:o(()=>[...t[98]||(t[98]=[l("Back to Writing",-1)])]),_:1})]),_:1}),t[99]||(t[99]=s("div",{class:"h-4 w-px bg-border/50 mx-1"},null,-1)),r(e(v),{id:"toggle-left-sidebar",variant:"ghost",size:"icon",onClick:t[18]||(t[18]=u=>G.value=!e(G)),class:"text-muted-foreground hover:text-foreground h-8 w-8 rounded-full"},{default:o(()=>[e(G)?(h(),F(e(xr),{key:1,class:"h-4 w-4"})):(h(),F(e(br),{key:0,class:"h-4 w-4"}))]),_:1})]),s("div",pa,[s("div",ga,[r(e(X),null,{default:o(()=>[r(e(K),{asChild:""},{default:o(()=>[r(e(v),{onClick:jt,variant:e(we)?"secondary":"ghost",size:"sm",class:"h-7 px-3 text-xs gap-2 text-zinc-700 dark:text-zinc-300 hover:text-foreground rounded-full"},{default:o(()=>[e(we)?(h(),F(e(wr),{key:1,class:"h-3.5 w-3.5"})):(h(),F(e(rs),{key:0,class:"h-3.5 w-3.5"})),s("span",fa,c(e(we)?"Edit":"Preview"),1)]),_:1},8,["variant"])]),_:1}),r(e(V),null,{default:o(()=>[...t[100]||(t[100]=[l("Toggle Preview Mode",-1)])]),_:1})]),_:1}),t[104]||(t[104]=s("div",{class:"w-px h-3 bg-border/50 mx-0.5"},null,-1)),r(e(X),null,{default:o(()=>[r(e(K),{asChild:""},{default:o(()=>[r(e(v),{id:"toggle-chat-mode",onClick:Dt,variant:"ghost",size:"sm",class:"h-7 px-3 text-xs gap-2 text-muted-foreground hover:text-foreground rounded-full"},{default:o(()=>[r(e(Wt),{class:"h-3.5 w-3.5 text-blue-500"}),t[101]||(t[101]=s("span",{class:"hidden xl:inline text-foreground"},"AI Chat",-1))]),_:1})]),_:1}),r(e(V),null,{default:o(()=>[...t[102]||(t[102]=[l("Open AI Assistant",-1)])]),_:1})]),_:1}),t[105]||(t[105]=s("div",{class:"w-px h-3 bg-border/50 mx-0.5"},null,-1)),r(e(X),null,{default:o(()=>[r(e(K),{asChild:""},{default:o(()=>[r(e(v),{onClick:lt,variant:"ghost",size:"sm",class:"h-7 px-3 text-xs gap-2 text-muted-foreground hover:text-foreground rounded-full"},{default:o(()=>[e(q)?(h(),F(e(qt),{key:0,class:"h-3.5 w-3.5"})):(h(),F(e(Gt),{key:1,class:"h-3.5 w-3.5"})),s("span",ma,c(e(q)?`Exit
                                                        Fullscreen`:"Fullscreen"),1)]),_:1})]),_:1}),r(e(V),null,{default:o(()=>[s("p",null,c(e(q)?"Exit fullscreen":"Enter fullscreen"),1)]),_:1})]),_:1}),t[106]||(t[106]=s("div",{class:"w-px h-3 bg-border/50 mx-0.5"},null,-1)),r(e(X),null,{default:o(()=>[r(e(K),{asChild:""},{default:o(()=>[r(e(v),{onClick:e(ee),variant:"ghost",size:"sm",class:"h-7 px-3 text-xs gap-2 text-zinc-700 dark:text-zinc-300 hover:text-foreground rounded-full"},{default:o(()=>[e(C)?(h(),F(e(It),{key:0,class:"h-3.5 w-3.5 text-foreground"})):(h(),F(e(Ht),{key:1,class:"h-3.5 w-3.5"}))]),_:1},8,["onClick"])]),_:1}),r(e(V),null,{default:o(()=>[...t[103]||(t[103]=[l("Toggle Dark Mode",-1)])]),_:1})]),_:1})]),s("div",ha,[r(ct,{id:"export-menu-container",project:me.value,"current-chapter":he.value,"all-chapters":ye.value,size:"sm",variant:"outline","trigger-element":"button","button-class":"h-9 gap-2 px-3 rounded-full bg-background/50 backdrop-blur-sm",class:"text-zinc-700 dark:text-zinc-300"},null,8,["project","current-chapter","all-chapters"]),r(e(v),{id:"analyze-button",variant:"outline",size:"sm",class:"h-9 gap-2 text-zinc-700 dark:text-zinc-300 hover:text-foreground bg-background/50 backdrop-blur-sm rounded-full",onClick:it,title:"Open bulk analysis"},{default:o(()=>[r(e(Qt),{class:"w-4 h-4"}),t[107]||(t[107]=s("span",{class:"text-xs font-medium"},"Analyze",-1))]),_:1}),r(e(X),null,{default:o(()=>[r(e(K),{asChild:""},{default:o(()=>[r(e(v),{id:"regenerate-button",variant:"outline",size:"sm",class:"h-9 gap-2 text-zinc-700 dark:text-zinc-300 hover:text-foreground bg-background/50 backdrop-blur-sm rounded-full",disabled:e(fe),onClick:t[19]||(t[19]=u=>x.value=!0)},{default:o(()=>[r(e(Xe),{class:"w-4 h-4"}),t[108]||(t[108]=s("span",{class:"text-xs font-medium"},"Regenerate",-1))]),_:1},8,["disabled"])]),_:1}),r(e(V),null,{default:o(()=>[...t[109]||(t[109]=[l("Regenerate chapter content",-1)])]),_:1})]),_:1})]),s("div",va,[r(e(v),{id:"save-button",onClick:t[20]||(t[20]=u=>e(be)(!1)),disabled:e(ge),variant:Le.value?"default":"secondary",size:"sm",class:"h-9 px-4 text-xs shadow-sm gap-2 rounded-full min-w-[32px]"},{default:o(()=>[r(e(pt),{class:"h-3.5 w-3.5"}),s("span",ba,c(e(ge)?"Saving":"Save"),1)]),_:1},8,["disabled","variant"]),r(e(v),{id:"mark-complete-btn",onClick:dt,disabled:e(ge),size:"sm",class:"h-9 px-4 text-xs shadow-sm gap-2 rounded-full"},{default:o(()=>[r(e(Ve),{class:"h-3.5 w-3.5"}),t[110]||(t[110]=s("span",null,"Mark Complete",-1))]),_:1},8,["disabled"]),t[112]||(t[112]=s("div",{class:"w-px h-4 bg-border/50 mx-1"},null,-1)),t[113]||(t[113]=s("div",{class:"w-px h-4 bg-border/50 mx-1"},null,-1)),r(e(X),null,{default:o(()=>[r(e(K),{asChild:""},{default:o(()=>[r(e(v),{id:"reset-tour-button",variant:"ghost",size:"icon",onClick:Pt,class:"text-muted-foreground hover:text-foreground h-9 w-9 hover:bg-muted/50 rounded-full"},{default:o(()=>[r(e(yr),{class:"h-4.5 w-4.5"})]),_:1})]),_:1}),r(e(V),null,{default:o(()=>[...t[111]||(t[111]=[l("Restart Tutorial",-1)])]),_:1})]),_:1}),r(e(v),{id:"toggle-right-sidebar",variant:"ghost",size:"icon",onClick:t[21]||(t[21]=u=>S.value=!e(S)),class:"hidden lg:flex text-muted-foreground hover:text-foreground h-9 w-9 hover:bg-muted/50 rounded-full"},{default:o(()=>[e(S)?(h(),F(e(kr),{key:1,class:"h-4.5 w-4.5"})):(h(),F(e(_r),{key:0,class:"h-4.5 w-4.5"}))]),_:1})])])])]),s("div",xa,[r(je,{"enter-active-class":"transition-all duration-300 ease-out","enter-from-class":"opacity-0 -translate-y-4","enter-to-class":"opacity-100 translate-y-0","leave-active-class":"transition-all duration-200 ease-in","leave-from-class":"opacity-100 translate-y-0","leave-to-class":"opacity-0 -translate-y-4"},{default:o(()=>[e(fe)?(h(),W("div",wa,[s("div",ya,[s("div",_a,[s("div",ka,[s("div",Ca,[r(e(We),{class:"h-4 w-4 text-white animate-pulse"})]),s("div",Sa,[s("div",Ea,[t[114]||(t[114]=s("h4",{class:"text-xs font-semibold text-foreground"}," Generating Content...",-1)),s("span",Ta,c(Math.round(e(_e)))+"%",1)]),s("div",Aa,[s("div",{class:"h-full bg-gradient-to-r from-blue-500 to-purple-500 transition-all duration-300",style:Qe({width:`${e(_e)}%`})},null,4)])]),r(e(v),{variant:"ghost",size:"icon",class:"h-8 w-8 rounded-full hover:bg-red-100 dark:hover:bg-red-900/20",onClick:e(Ct),title:"Stop generation"},{default:o(()=>[r(e(Bt),{class:"h-5 w-5 text-red-600 dark:text-red-400"})]),_:1},8,["onClick"])]),s("p",$a,c(e(Fe)),1)])])])):Y("",!0)]),_:1}),r(e(Kt),{ref_key:"editorScrollRef",ref:Hs,class:"h-full w-full","data-editor-scroll-container":""},{default:o(()=>[s("div",Da,[Ee(s("div",ja,[r(as,{ref_key:"richTextEditorFullscreen",ref:z,modelValue:e(R),"onUpdate:modelValue":t[22]||(t[22]=u=>Cr(R)?R.value=u:null),placeholder:"Start writing your chapter...",class:"prose prose-slate dark:prose-invert prose-lg max-w-none focus:outline-none min-h-[500px]","streaming-mode":e(xt),"is-generating":e(fe),"generation-progress":e(Fe),"generation-percentage":e(_e),"generation-phase":e(ke),"onUpdate:selectedText":t[23]||(t[23]=u=>H.value=u),"min-height":"500px"},null,8,["modelValue","streaming-mode","is-generating","generation-progress","generation-percentage","generation-phase"])],512),[[De,!e(we)]]),Ee(s("div",Ra,[r(ls,{content:e(R),class:"prose prose-slate dark:prose-invert prose-lg max-w-none"},null,8,["content"])],512),[[De,e(we)]])])]),_:1},512)]),s("div",za,[s("div",Pa,[s("span",null,"Words: "+c(e(se))+" / "+c(le.value),1),s("span",Ma,"Last saved: "+c(e(ge)?"Saving...":`Just
                                    now`),1)]),s("div",Fa,[s("span",null,[t[115]||(t[115]=l("Quality: ",-1)),s("span",{class:Ge(e(xe)>70?"text-green-500":"text-amber-500")},c(e(xe))+"%",3)]),Le.value?(h(),W("span",La,[r(e(Ve),{class:"h-3 w-3"}),t[116]||(t[116]=l(" Ready ",-1))])):Y("",!0)])])]),r(ts,Ut({id:"right-sidebar-panel","is-collapsed":e(S),"container-class":"hidden lg:flex w-96 flex-col border-l border-border/40 bg-background/60 backdrop-blur-xl z-20 transition-all duration-300"},ht.value),null,16,["is-collapsed"])]),r(e(i),{"show-left-sidebar":e(Re),"show-right-sidebar":e(A),"is-mobile":e(L),"all-chapters":ye.value,"current-chapter":he.value,project:me.value,"current-word-count":e(se),"target-word-count":le.value,"writing-quality-score":e(xe),"chapter-content-length":e(R).length,"is-generating":e(fe),"selected-text":e(H),"is-loading-suggestions":e(bt),"show-citation-helper":e(Be),"chapter-content":e(R),"onUpdate:showLeftSidebar":t[24]||(t[24]=u=>Re.value=u),"onUpdate:showRightSidebar":t[25]||(t[25]=u=>A.value=u),onGoToChapter:Ne,onGenerateNextChapter:e(nt),onStartStreamingGeneration:e(yt),onGetAiSuggestions:e(_t),"onUpdate:showCitationHelper":t[26]||(t[26]=u=>Be.value=u),onCheckCitations:e(kt)},null,8,["show-left-sidebar","show-right-sidebar","is-mobile","all-chapters","current-chapter","project","current-word-count","target-word-count","writing-quality-score","chapter-content-length","is-generating","selected-text","is-loading-suggestions","show-citation-helper","chapter-content","onGenerateNextChapter","onStartStreamingGeneration","onGetAiSuggestions","onCheckCitations"]),r(e(Tr),{open:x.value,"onUpdate:open":t[27]||(t[27]=u=>x.value=u)},{default:o(()=>[r(e(Ar),null,{default:o(()=>[r(e($r),null,{default:o(()=>[r(e(Dr),null,{default:o(()=>[...t[118]||(t[118]=[l("Regenerate Chapter?",-1)])]),_:1}),r(e(jr),null,{default:o(()=>[...t[119]||(t[119]=[l(" This will replace all existing content with freshly generated content. Your current content will be saved to history, so you can undo if needed. ",-1)])]),_:1})]),_:1}),r(e(Rr),null,{default:o(()=>[r(e(zr),null,{default:o(()=>[...t[120]||(t[120]=[l("Cancel",-1)])]),_:1}),r(e(Pr),{onClick:Xs,class:"bg-primary hover:bg-primary/90"},{default:o(()=>[r(e(Xe),{class:"w-4 h-4 mr-2"}),t[121]||(t[121]=l(" Regenerate ",-1))]),_:1})]),_:1})]),_:1})]),_:1},8,["open"]),r(Mr,{open:e(Te),"current-balance":e(ze),"required-words":e(Ze),action:e(et),"onUpdate:open":t[28]||(t[28]=u=>Te.value=u),onClose:e(st)},null,8,["open","current-balance","required-words","action","onClose"]),e(Gs)?(h(),W("div",Na,[r(e(oe),{class:"w-full max-w-md mx-4 bg-white dark:bg-slate-900 border-amber-500/50 shadow-2xl"},{default:o(()=>[r(e(ae),null,{default:o(()=>[r(e(ie),{class:"flex items-center gap-2 text-amber-600 dark:text-amber-400"},{default:o(()=>[...t[122]||(t[122]=[s("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[s("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"})],-1),l(" Generation Interrupted ",-1)])]),_:1})]),_:1}),r(e(ne),null,{default:o(()=>[s("p",Oa,[t[123]||(t[123]=l(" Connection lost. ",-1)),s("span",Wa,c(e(Is))+" words",1),t[124]||(t[124]=l(" may have been saved. ",-1))]),s("div",qa,[r(e(v),{onClick:e(Qs),class:"flex-1 bg-amber-600 hover:bg-amber-700 text-white"},{default:o(()=>[...t[125]||(t[125]=[s("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-4 w-4 mr-2",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[s("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"})],-1),l(" Reload & Recover ",-1)])]),_:1},8,["onClick"]),r(e(v),{onClick:e(Ks),variant:"outline",class:"flex-1"},{default:o(()=>[...t[126]||(t[126]=[l(" Dismiss ",-1)])]),_:1},8,["onClick"])])]),_:1})]),_:1})])):Y("",!0)]),_:1}))],64))]),_:1}))}}),Ha=is(Ia,[["__scopeId","data-v-a4e2cbb5"]]),ei=Object.freeze(Object.defineProperty({__proto__:null,default:Ha},Symbol.toStringTag,{value:"Module"}));export{Mo as A,ei as C};
