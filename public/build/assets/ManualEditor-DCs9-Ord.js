import{d as Me,g as O,o as l,w as p,c as _,a as z,b as o,e as r,u as e,Y as et,a5 as Ht,n as L,aa as tt,bA as Se,r as u,q as ne,y as Gt,bV as qt,t as x,h as H,F as st,f as Dt,a1 as ot,bY as Nt,bc as ie,Q as he,T as Wt,aI as y,m as N,R as Ye,aQ as Kt,b6 as Xe,_ as W,aR as Vt,bd as Ce,bv as Ze,i as Qt,j as Yt,bo as Xt,bn as Zt,b1 as Jt,b0 as es,ct as ts,bQ as ss,bq as os,bp as rs,b7 as as,a2 as ns,bh as is}from"./vendor-CwVTuNDX.js";import{s as F,u as ls}from"./app-Cc9TUqoT.js";import{A as cs}from"./driver-B4w0q6_T.js";import{_ as f}from"./index-CrxE9Zi3.js";import{_ as ds}from"./index-D-ML2bGq.js";import{_ as K}from"./Separator.vue_vue_type_script_setup_true_lang-DtJiP-22.js";import{_ as us}from"./Progress.vue_vue_type_script_setup_true_lang-BkF6HjW5.js";import{R as ps}from"./RichTextEditor-DVZV_R4B.js";import{c as ms,u as hs,a as gs,b as fs,_ as vs,M as bs}from"./useManualEditorSuggestions-BNU-7SeZ.js";import{_ as rt}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{_ as xs}from"./Input.vue_vue_type_script_setup_true_lang-C_DmbuW5.js";import{_ as ws}from"./ScrollArea.vue_vue_type_script_setup_true_lang-jgf_HMTE.js";import{_ as ys}from"./ChapterNavigation.vue_vue_type_script_setup_true_lang-Bokg2GV9.js";import{u as _s,_ as Cs,a as Je}from"./useTextHistory-CNeNKCG_.js";import{d as ks}from"./DropdownMenuTrigger.vue_vue_type_script_setup_true_lang-Bf5Vg9oh.js";import{e as Ss}from"./WordBalanceDisplay.vue_vue_type_script_setup_true_lang-aFJA1QO3.js";import{_ as Ms}from"./PurchaseModal.vue_vue_type_script_setup_true_lang-CP7QKXJs.js";import{r as at,u as Ts}from"./useWordBalance-CcsZnt93.js";import{u as js}from"./index-BaA8aalJ.js";import"./Separator-nXiBvQMc.js";import"./Presence-DIu7Hq1J.js";import"./useForwardExpose-DzXfkUQ9.js";import"./nullish-CHIgUVhi.js";import"./index-DUK3rd28.js";import"./purify.es-DxJI3Wx7.js";import"./step-2-6XWOkL.js";import"./DialogContent.vue_vue_type_script_setup_true_lang-2N0uTeXP.js";import"./DialogTitle-DCnPxe3d.js";import"./DialogDescription.vue_vue_type_script_setup_true_lang-D2my-8qT.js";import"./DialogFooter.vue_vue_type_script_setup_true_lang-Bj9EygLt.js";import"./DialogTitle.vue_vue_type_script_setup_true_lang-B3TbSoEk.js";import"./Label.vue_vue_type_script_setup_true_lang-BO6sf_Jr.js";import"./CollapsibleTrigger.vue_vue_type_script_setup_true_lang-BjeH3YcR.js";import"./CollapsibleTrigger-N_6l0ttW.js";import"./SafeHtmlText.vue_vue_type_script_setup_true_lang-72u-s0Lw.js";import"./DefensePreparationPanel.vue_vue_type_script_setup_true_lang-QUIH7AMS.js";import"./index-QaS4lz9S.js";import"./CardContent.vue_vue_type_script_setup_true_lang-BtnEOQTw.js";import"./CardTitle.vue_vue_type_script_setup_true_lang-nJJ1IpBN.js";import"./Switch.vue_vue_type_script_setup_true_lang-CSQiFhKB.js";import"./useFormControl-D0no87xr.js";import"./VisuallyHiddenInput-CSQJp8H2.js";import"./VisuallyHidden-DPKZa3kD.js";import"./useNonce-C7jB33rT.js";import"./AlertDialogTitle.vue_vue_type_script_setup_true_lang-2pI1VKRN.js";import"./DialogTrigger-DZIVbtlE.js";import"./Checkbox.vue_vue_type_script_setup_true_lang-6dk4bZib.js";import"./isValueEqualOrExist-DSClXoPv.js";import"./ohash.D__AXeF1-C-E83dC9.js";import"./RovingFocusItem-VdLAJO2h.js";import"./TooltipTrigger.vue_vue_type_script_setup_true_lang-CN-XKNc_.js";const zs={key:0,class:"fixed bottom-20 left-1/2 z-50 -translate-x-1/2 px-3"},As={class:"flex items-center gap-3 rounded-full border bg-background/95 px-4 py-2 shadow-lg backdrop-blur"},$s={class:"ml-1 flex items-center gap-1"},Es=Me({__name:"ChapterStarterOverlay",props:{show:{type:Boolean},isGenerating:{type:Boolean}},emits:["regenerate","dismiss"],setup(C,{emit:a}){const v=a;return(h,i)=>(l(),O(Se,{name:"slide-up"},{default:p(()=>[h.show?(l(),_("div",zs,[o("div",As,[r(e(et),{class:"h-4 w-4 shrink-0 text-primary"}),i[2]||(i[2]=o("span",{class:"text-sm"},"AI suggests an opening",-1)),i[3]||(i[3]=o("kbd",{class:"rounded bg-muted px-1.5 py-0.5 text-xs"},"Tab",-1)),i[4]||(i[4]=o("span",{class:"text-xs text-muted-foreground"},"to accept",-1)),o("div",$s,[r(e(f),{variant:"ghost",size:"icon",class:"h-6 w-6",disabled:h.isGenerating,title:"Regenerate",onClick:i[0]||(i[0]=w=>v("regenerate"))},{default:p(()=>[r(e(Ht),{class:L(["h-3 w-3",{"animate-spin":h.isGenerating}])},null,8,["class"])]),_:1},8,["disabled"]),r(e(f),{variant:"ghost",size:"icon",class:"h-6 w-6",title:"Dismiss",onClick:i[1]||(i[1]=w=>v("dismiss"))},{default:p(()=>[r(e(tt),{class:"h-3 w-3"})]),_:1})])])])):z("",!0)]),_:1}))}}),Rs=rt(Es,[["__scopeId","data-v-d5492de7"]]),Os={class:"flex flex-col h-full bg-transparent"},Ls={class:"p-4 border-b border-border/50 flex justify-between items-start bg-background/50 backdrop-blur-sm"},Is={class:"flex items-center gap-2"},Ps={class:"p-1.5 rounded-md bg-primary/10 text-primary"},Fs={key:0,class:"px-4 py-2 bg-muted/30 border-b border-border/50 text-xs flex gap-3 text-muted-foreground"},Bs={key:0,class:"ml-auto text-amber-600 dark:text-amber-400 font-medium flex items-center gap-1"},Us={class:"space-y-6"},Hs={key:0,class:"flex flex-col items-center justify-center text-center py-12 px-4 space-y-4 opacity-0 animate-in fade-in slide-in-from-bottom-4 duration-700 fill-mode-forwards"},Gs={class:"w-12 h-12 rounded-full bg-primary/5 flex items-center justify-center mb-2"},qs={class:"grid grid-cols-1 gap-2 w-full max-w-xs mt-4"},Ds={class:"space-y-1"},Ns=["innerHTML"],Ws={key:1,class:"flex gap-3"},Ks={class:"w-8 h-8 rounded-full bg-muted flex items-center justify-center shrink-0"},Vs={class:"p-4 border-t border-border/50 bg-background/50 backdrop-blur-sm"},Qs={class:"relative"},Ys=Me({__name:"ManualChatSidebar",props:{messages:{},isLoading:{type:Boolean},analysis:{}},emits:["send","close"],setup(C,{emit:a}){const v=C,h=a,i=u(""),w=u(null),k=()=>{i.value.trim()&&!v.isLoading&&(h("send",i.value),i.value="")},I=c=>{c.key==="Enter"&&!c.shiftKey&&(c.preventDefault(),k())};return ne(()=>v.messages.length,async()=>{if(await Gt(),w.value){const c=w.value.$el.querySelector("[data-radix-scroll-area-viewport]");c&&(c.scrollTop=c.scrollHeight)}}),(c,d)=>(l(),_("div",Os,[o("div",Ls,[o("div",null,[o("div",Is,[o("div",Ps,[r(e(qt),{class:"w-4 h-4"})]),d[4]||(d[4]=o("h3",{class:"font-semibold text-foreground"},"AI Assistant",-1))]),d[5]||(d[5]=o("p",{class:"text-xs text-muted-foreground mt-1 ml-1"},"Context-aware writing companion",-1))]),r(e(f),{variant:"ghost",size:"icon",class:"h-8 w-8 -mr-2",onClick:d[0]||(d[0]=m=>c.$emit("close"))},{default:p(()=>[r(e(tt),{class:"w-4 h-4"})]),_:1})]),c.analysis?(l(),_("div",Fs,[o("span",null,x(c.analysis.word_count)+" words",1),d[6]||(d[6]=o("span",null,"â€¢",-1)),o("span",null,x(c.analysis.citation_count)+" citations",1),c.analysis.detected_issues.length>0?(l(),_("span",Bs,x(c.analysis.detected_issues.length)+" issues ",1)):z("",!0)])):z("",!0),r(e(ws),{ref_key:"messagesContainer",ref:w,class:"flex-1 p-4"},{default:p(()=>[o("div",Us,[c.messages.length===0?(l(),_("div",Hs,[o("div",Gs,[r(e(et),{class:"w-6 h-6 text-primary/60"})]),d[9]||(d[9]=o("div",{class:"space-y-1"},[o("h4",{class:"font-medium text-foreground"},"How can I help?"),o("p",{class:"text-sm text-muted-foreground max-w-[240px]"}," I can help you structure your arguments, find citations, or rephrase complex sentences. ")],-1)),o("div",qs,[r(e(f),{variant:"outline",size:"sm",class:"justify-start h-auto py-2 text-xs font-normal",onClick:d[1]||(d[1]=m=>{i.value="Analyze the structure of this chapter",k()})},{default:p(()=>[...d[7]||(d[7]=[H(' "Analyze the structure of this chapter" ',-1)])]),_:1}),r(e(f),{variant:"outline",size:"sm",class:"justify-start h-auto py-2 text-xs font-normal",onClick:d[2]||(d[2]=m=>{i.value="Suggest some relevant citations",k()})},{default:p(()=>[...d[8]||(d[8]=[H(' "Suggest some relevant citations" ',-1)])]),_:1})])])):z("",!0),(l(!0),_(st,null,Dt(c.messages,(m,g)=>(l(),_("div",{key:g,class:L(["flex gap-3 max-w-[90%]",m.role==="user"?"ml-auto flex-row-reverse":""])},[o("div",{class:L(["w-8 h-8 rounded-full flex items-center justify-center shrink-0 text-xs font-medium",m.role==="user"?"bg-primary text-primary-foreground":"bg-muted text-muted-foreground"])},x(m.role==="user"?"You":"AI"),3),o("div",Ds,[o("div",{class:L(["p-3 rounded-2xl text-sm shadow-sm",m.role==="user"?"bg-primary text-primary-foreground rounded-tr-sm":"bg-card border text-card-foreground rounded-tl-sm"])},[o("div",{innerHTML:m.content,class:"prose prose-sm dark:prose-invert max-w-none break-words"},null,8,Ns)],2),o("p",{class:L(["text-[10px] text-muted-foreground opacity-70 px-1",m.role==="user"?"text-right":""])},x(new Date(m.timestamp).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})),3)])],2))),128)),c.isLoading?(l(),_("div",Ws,[o("div",Ks,[r(e(ot),{class:"w-4 h-4 animate-spin text-muted-foreground"})]),d[10]||(d[10]=o("div",{class:"bg-card border px-4 py-3 rounded-2xl rounded-tl-sm text-sm text-muted-foreground shadow-sm"}," Thinking... ",-1))])):z("",!0)])]),_:1},512),o("div",Vs,[o("div",Qs,[r(e(xs),{modelValue:i.value,"onUpdate:modelValue":d[3]||(d[3]=m=>i.value=m),placeholder:"Ask anything about your chapter...",onKeydown:I,disabled:c.isLoading,class:"pr-10 py-6 bg-background/80 border-border/60 focus-visible:ring-primary/20 shadow-sm"},null,8,["modelValue","disabled"]),r(e(f),{onClick:k,disabled:c.isLoading||!i.value.trim(),size:"icon",class:L(["absolute right-1.5 top-1.5 h-9 w-9 transition-all duration-200",i.value.trim()?"opacity-100 scale-100":"opacity-70 scale-90"])},{default:p(()=>[r(e(Nt),{class:"w-4 h-4"})]),_:1},8,["disabled","class"])]),d[11]||(d[11]=o("p",{class:"text-[10px] text-center text-muted-foreground mt-2"}," AI can make mistakes. Review generated content. ",-1))])]))}});function Xs(C,a=[]){const v=u(!1),h=u(a),i=u(!1),w=u(null);return{isChatOpen:v,messages:h,isLoading:i,toggleChat:()=>{v.value=!v.value},sendMessage:async c=>{if(c.trim()){h.value.push({role:"user",content:c,timestamp:new Date}),i.value=!0;try{const m=(await ie.post(F("projects.manual-editor.chat",{project:C.project.slug,chapter:C.chapter_number}),{message:c,history:h.value})).data.message;h.value.push({role:"assistant",content:m,timestamp:new Date});const g=ms(m||"");if(g>0)try{await at(g,"Manual editor: Chat","chapter",C.id),await w.value?.()}catch(M){console.error("Failed to record word usage (manual chat):",M)}}catch(d){console.error("Failed to send chat message:",d),h.value.push({role:"assistant",content:"I'm having trouble responding right now. Please try again.",timestamp:new Date})}finally{i.value=!1}}},setOnUsageRecorded:c=>{w.value=c}}}const Zs=C=>C?C.replace(/<style[\s\S]*?<\/style>/gi,"").replace(/<script[\s\S]*?<\/script>/gi,"").replace(/<[^>]+>/g," ").replace(/&nbsp;/gi," ").replace(/\s+/g," ").trim():"",ke=C=>Zs(C).length===0,Js=C=>{const v=C.trim().match(/^```[a-zA-Z0-9_-]*\s*\n([\s\S]*?)\n?```$/);return v?v[1].trim():C};function eo(C,a,v,h){const i=u(null),w=u(!1),k=u(!1),I=async()=>{if(!w.value&&!(h?.canGenerate&&!h.canGenerate())&&ke(v.value)){w.value=!0;try{await ie.get("/sanctum/csrf-cookie");const m=await ie.post(F("api.projects.chapters.generate-starter",{project:C,chapter:a.chapter_number})),g=Js(String(m.data?.starter??"")).trim().replace(/^\s*html\s*/i,"");i.value=g||null,k.value=!!i.value}catch(m){throw i.value=null,k.value=!1,m}finally{w.value=!1}}},c=()=>{k.value=!1,i.value=null},d=()=>{k.value=!1,i.value=null};return he(()=>{ke(v.value)&&I().catch(()=>{})}),ne(v,m=>{ke(m)||(k.value=!1,i.value=null)},{flush:"post"}),{starterText:i,isGenerating:w,showStarter:k,generateStarter:I,acceptStarter:c,dismissStarter:d}}function to(C,a,v){const h=u(null),i=u(!1),w=u(0),k=u(null),I=async M=>{k.value=M;const E=++w.value;if(!M.textBefore.trim()){h.value=null;return}i.value=!0;try{await ie.get("/sanctum/csrf-cookie");const Z=await ie.post(F("api.projects.chapters.autocomplete",{project:C,chapter:a}),{text_before:M.textBefore,text_after:M.textAfter,chapter_number:M.chapterNumber,chapter_title:M.chapterTitle,chapter_outline:M.chapterOutline,section_heading:M.sectionHeading,section_outline:M.sectionOutline,project_topic:M.projectTopic});if(E!==w.value)return;const le=String(Z.data?.completion??"").replace(/\s+$/g,"");h.value=le||null}catch(Z){if(E!==w.value)return;throw h.value=null,Z}finally{E===w.value&&(i.value=!1)}},c=js(I,500);return{ghostText:h,isLoading:i,debouncedRequest:c,requestCompletion:I,acceptSuggestion:()=>{h.value=null},dismissSuggestion:()=>{h.value=null},triggerManually:async()=>{k.value&&await I(k.value)},editorRef:v}}const so={class:"manual-editor h-screen flex flex-col bg-background dark:bg-background transition-colors duration-300"},oo={class:"md:hidden border-b h-14 px-3 flex justify-between items-center bg-background/80 backdrop-blur-md sticky top-0 z-50 transition-all duration-200"},ro={class:"flex items-center gap-2"},ao={class:"flex flex-col justify-center min-w-0 flex-1 mx-2"},no={class:"items-center gap-2 text-xs font-medium text-muted-foreground mb-1 hidden sm:flex"},io={class:"flex items-center gap-2 -ml-1"},lo={class:"font-bold text-base text-foreground truncate"},co={class:"truncate"},uo={class:"flex gap-2 items-center"},po={class:"hidden md:flex flex-col w-full z-50 sticky top-0 bg-background/80 backdrop-blur-md transition-all duration-200 border-b"},mo={id:"editor-header",class:"h-10 border-b border-border/40 flex items-center justify-center px-4 bg-background/60 relative"},ho={class:"flex items-center gap-2"},go={id:"chapter-nav-buttons",class:"flex items-center gap-1 absolute right-4"},fo={class:"h-12 flex items-center justify-between px-4 bg-background/40"},vo={id:"left-controls",class:"flex items-center gap-3"},bo={class:"flex items-center gap-1"},xo={id:"save-status",class:"flex items-center gap-2 px-3 py-1.5 rounded-full bg-muted/30 border border-border/40"},wo={class:"flex items-center gap-1.5"},yo={class:"text-xs font-medium text-muted-foreground"},_o={key:0,class:"flex items-center gap-1.5"},Co={key:1,class:"text-xs text-muted-foreground"},ko={class:"flex items-center gap-3"},So={id:"view-controls",class:"flex items-center gap-1 bg-muted/30 p-1 rounded-full border border-border/40"},Mo={id:"credit-display"},To={id:"export-menu-container"},jo={class:"text-xs font-medium"},zo={id:"progress-bar-section",class:"w-full bg-background border-b px-3 md:px-6 py-2 flex flex-col gap-1"},Ao={class:"flex justify-between items-center text-xs text-muted-foreground mb-1"},$o={class:"flex-1 flex overflow-hidden"},Eo={key:0,id:"left-sidebar-panel",class:"w-[320px] border-r bg-background/80 backdrop-blur-xl border-border/50 shadow-xl z-20 overflow-y-auto custom-scrollbar"},Ro={class:"p-4"},Oo={class:"mb-3"},Lo={class:"text-xs text-muted-foreground"},Io={class:"flex-1 overflow-auto p-2 md:p-6 bg-background"},Po={key:0,class:"w-1/2 flex flex-col bg-background overflow-hidden"},Fo={class:"flex-1 overflow-y-auto custom-scrollbar"},Bo={key:0,id:"right-sidebar-panel",class:"w-[400px] border-l bg-background/80 backdrop-blur-xl border-border/50 shadow-2xl z-20 overflow-y-auto custom-scrollbar flex flex-col"},Uo={key:0,class:"flex-1 overflow-hidden"},Ho={class:"h-full border-b border-border/50"},Go={key:1,class:"p-4 space-y-6"},qo={key:0,class:"space-y-2"},Do={key:1,class:"space-y-2"},No={class:"flex items-center justify-between"},Wo={class:"text-xs whitespace-pre-wrap rounded-lg border border-border/50 bg-muted/30 p-3"},Ko={class:"space-y-2"},Vo={id:"editor-footer",class:"border-t p-2 md:p-3 flex flex-col gap-3 text-xs md:text-sm bg-muted/30"},Qo={class:"flex flex-col sm:flex-row justify-between gap-3 sm:gap-2 items-start sm:items-center w-full"},Yo={id:"footer-stats",class:"flex gap-2 md:gap-4 flex-wrap items-center"},Xo={class:"text-muted-foreground"},Zo={class:"text-foreground"},Jo={key:0,class:"text-muted-foreground hidden sm:inline"},er={class:"text-foreground"},tr={key:1,class:"text-muted-foreground hidden md:inline"},sr={class:"text-foreground"},or={key:2,class:"text-muted-foreground hidden lg:inline"},rr={class:"flex gap-2 items-center w-full sm:w-auto"},ar={class:"text-xs font-medium"},nr=Me({__name:"ManualEditor",props:{project:{},chapter:{},allChapters:{},facultyChapters:{},currentSuggestion:{},contextAnalysis:{},initialProgressGuidance:{},chatHistory:{}},setup(C){const a=C,v=Wt();ne(()=>v.props?.flash,t=>{t&&(t.success&&y.success(t.success),t.error&&y.error(t.error))},{deep:!0,immediate:!0});const{wordBalance:h,balance:i,showPurchaseModal:w,requiredWordsForModal:k,actionDescriptionForModal:I,checkAndPrompt:c,closePurchaseModal:d,refreshBalance:m}=Ts(),{content:g,isDirty:M,isSaving:E,lastSaved:Z,updateContent:Te,manualSave:le}=hs(a.chapter,a.project.slug),{currentSuggestion:ge,currentAnalysis:T,isAnalyzing:fe,saveSuggestion:je,clearSuggestion:ze,applySuggestion:Ae}=gs(a.chapter,a.project.slug,a.currentSuggestion,g,{onUsageRecorded:()=>m()}),{addToHistory:nt}=_s(a.chapter.content||""),V=u(null),{isChatOpen:$e,messages:it,isLoading:lt,toggleChat:ct,sendMessage:dt,setOnUsageRecorded:ut}=Xs(a.chapter,a.chatHistory||[]);ut(()=>m());const Ee=u(a.chapter.title||"");u(!1),u(!1),u("");const Re=()=>{ee.value&&Oe(),j.value=!0,ct()},J=t=>{Te(t),nt(t),Et()};N(()=>{const t=Ee.value?.trim(),s=g.value?.trim();return!!(t&&t.length>0&&s&&s.length>50)});const pt=()=>typeof window<"u"&&window.innerWidth<1024,ce=(t,s)=>{try{const n=localStorage.getItem(t);return n!==null?n==="true":s}catch{return s}},A=u(pt()),R=u(ce("manualEditor_showLeftSidebar",!A.value)),j=u(ce("manualEditor_showRightSidebar",!A.value)),ve=u(""),be=u(null),se=u("");u(!1),u([]),u(!1);const G=u(!0),ee=u((()=>{try{return localStorage.getItem("citationOperationMode")==="true"}catch{return!1}})()),mt=()=>{ee.value=!0,j.value=!1;try{localStorage.setItem("citationOperationMode","true")}catch{}},Oe=()=>{ee.value=!1,j.value=!0;try{localStorage.setItem("citationOperationMode","false")}catch{}},Le=u(!1),ht=async()=>{y.info("Fullscreen temporarily disabled")},gt=()=>{W.visit(F("projects.analysis",{project:a.project.slug}))};he(()=>{}),Ye(()=>{});const{isDark:Ie,toggle:ft}=ls(),vt=N(()=>{const t=T.value?.word_count??a.chapter.word_count,s=a.chapter.target_word_count||1e3;return Math.min(t/s*100,100)});N(()=>E.value?"Saving...":Z.value?`Saved ${Z.value}`:"Not saved");const bt=()=>{R.value=!R.value},xt=()=>{j.value=!j.value},wt=()=>c(200,"generate chapter starter"),{starterText:de,isGenerating:yt,showStarter:q,generateStarter:_t,acceptStarter:Ct,dismissStarter:Pe}=eo(a.project.slug,a.chapter,g,{canGenerate:wt}),kt=N(()=>{const t=a.facultyChapters||[],s=t.find(b=>b?.chapter_number===a.chapter.chapter_number)??t.find(b=>b?.number===a.chapter.chapter_number);if(!s)return"";const n=[];if(s.description&&n.push(String(s.description)),Array.isArray(s.sections))for(const b of s.sections){if(!b)continue;const P=(b.title??b.section_title??"").toString().trim(),Q=(b.description??b.section_description??"").toString().trim();P&&Q?n.push(`${P}: ${Q}`):P&&n.push(P)}return n.join(`
`)}),{ghostText:Fe,isLoading:St,debouncedRequest:Mt,requestCompletion:Tt,acceptSuggestion:jt,dismissSuggestion:zt}=to(a.project.slug,a.chapter.chapter_number,V),At=N(()=>q.value&&de.value?de.value:Fe.value),$t=N(()=>q.value&&de.value?"html":"text");function Be(){const t=V.value?.editor?.();if(!t)return null;const s=t.state.selection;if(!s.empty||q.value)return null;const n=t.state.doc,b=s.from,P=s.to,Q=Math.max(0,b-2500),me=Math.min(n.content.size,P+500),re=n.textBetween(Q,b,`
`,`
`),Qe=n.textBetween(P,me,`
`,`
`);let U="",te=0;const S=Math.max(0,b-8e3);n.nodesBetween(S,b,($,B)=>{$.type?.name==="heading"&&B<b&&(U=$.textContent||"",te=B)}),U&&b-te>2e3&&(U="");let Y="";if(U){const $=(a.facultyChapters||[]).find(D=>D?.chapter_number===a.chapter.chapter_number||D?.number===a.chapter.chapter_number),B=Array.isArray($?.sections)?$.sections:[],_e=U.trim().toLowerCase(),X=B.find(D=>{const ae=(D?.title??D?.section_title??"").toString().trim().toLowerCase();return ae&&ae===_e});if(X){const D=(X.title??X.section_title??"").toString().trim(),ae=(X.description??X.section_description??"").toString().trim();Y=ae?`${D}: ${ae}`:D}}return{textBefore:re,textAfter:Qe,chapterNumber:a.chapter.chapter_number,chapterTitle:Ee.value||a.chapter.title||"",chapterOutline:kt.value||"",sectionHeading:U.trim(),sectionOutline:Y.trim(),projectTopic:a.project?.topic||""}}function Et(){if(q.value||St.value||Fe.value)return;const t=Be();t&&Mt(t).catch(()=>{})}const Rt=async()=>{try{await _t()}catch(t){console.error("Failed to generate starter:",t),y.error("Failed to generate starter")}};ne(R,t=>{if(!A.value)try{localStorage.setItem("manualEditor_showLeftSidebar",String(t))}catch(s){console.error("Failed to save left sidebar state:",s)}}),ne(j,t=>{if(!A.value)try{localStorage.setItem("manualEditor_showRightSidebar",String(t))}catch(s){console.error("Failed to save right sidebar state:",s)}});const Ue=t=>{(t.ctrlKey||t.metaKey)&&t.key==="s"&&(t.preventDefault(),pe())};he(()=>{A.value=window.innerWidth<1024,A.value&&(R.value=!1,j.value=!1);const t=()=>{const s=A.value;A.value=window.innerWidth<1024,s!==A.value&&(A.value?(R.value=!1,j.value=!1):(R.value=ce("manualEditor_showLeftSidebar",!0),j.value=ce("manualEditor_showRightSidebar",!0)))};window.addEventListener("resize",t),window.addEventListener("keydown",Ue),Ye(()=>{window.removeEventListener("resize",t),window.removeEventListener("keydown",Ue)})});const He=t=>{J(t),y.success("Applied improved text")},Ge=t=>{if(V.value?.replaceSelection(t,be.value||void 0)??!1){y.success("Expanded selection");return}J(`${g.value}

${t}`),y.success("Added expanded text")},qe=t=>{se.value=t,G.value=!0;try{navigator.clipboard?.writeText(t)}catch{}y.success("Citation suggestions ready")},De=t=>{if(V.value?.replaceSelection(t,be.value||void 0)??!1){y.success("Applied rephrased text");return}J(`${g.value}

${t}`),y.success("Added rephrased text")},Ne=(t,s)=>c(t,s),ue=async(t,s)=>{const n=Math.max(0,Math.round(t||0));n&&(await at(n,s,"chapter",a.chapter.id),await m())},Ot=t=>t.replace(/<[^>]*>/g," "),Lt=t=>Ot(t).split(/\s+/).filter(Boolean).length,It=async t=>{const s=Lt(t);if(q.value){Ct(),await ue(s,"chapter starter accepted");return}jt(),await ue(s,"autocomplete accepted")},Pt=()=>{if(q.value){Pe();return}zt()},Ft=async()=>{if(q.value)return;const t=Be();if(t)try{await Tt(t)}catch(s){console.error("Failed to autocomplete:",s),y.error("Autocomplete failed")}},Bt=async()=>{if(se.value)try{await navigator.clipboard.writeText(se.value),y.success("Copied citation suggestions")}catch{y.error("Could not copy citation suggestions")}},xe=N(()=>a.allChapters.find(t=>t.chapter_number===a.chapter.chapter_number-1)),we=N(()=>a.allChapters.find(t=>t.chapter_number===a.chapter.chapter_number+1)),ye=(t,s)=>{if(s&&g.value){const b=s.trim(),P=document.createElement("div");P.innerHTML=g.value;const Q=P.textContent||P.innerText||"",me=Q.indexOf(b);if(me!==-1){const re=me+b.length,U=Q.substring(re).match(/^[^.!?]*[.!?]/);let te;U?te=re+U[0].length:te=re;let S=0,Y=0;const $=g.value;for(;S<$.length&&Y<te;)if($[S]==="<"){for(;S<$.length&&$[S]!==">";)S++;S++}else if($[S]==="&"){const B=$.indexOf(";",S);B!==-1&&B-S<10?(S=B+1,Y++):(S++,Y++)}else S++,Y++;if(S>0){const B=$.substring(0,S),_e=$.substring(S),X=`${B} ${t}${_e}`;J(X),y.success("Citation inserted at claim location");return}}}const n=V.value?.getCursorPosition?.();if(typeof n=="number"&&(V.value?.replaceTextAt?.({from:n,to:n},` ${t} `)??!1)){y.success("Citation inserted at cursor");return}J(`${g.value} ${t}`),y.success("Citation appended to content")},oe=t=>{M.value&&!confirm("You have unsaved changes. Are you sure you want to switch chapters?")||W.visit(F("projects.manual-editor.show",{project:a.project.slug,chapter:t}))},We=()=>{const t=a.chapter.chapter_number+1;a.allChapters.find(n=>n.chapter_number===t)?oe(t):y.info("Please create the next chapter from the dashboard first.")},Ke=t=>{confirm("Are you sure you want to delete this chapter?")&&W.delete(F("chapters.destroy",{project:a.project.slug,chapter:a.allChapters.find(s=>s.id===t)?.slug}),{onSuccess:()=>y.success("Chapter deleted")})},pe=async()=>{try{await le(),y.success("Chapter saved successfully")}catch{y.error("Failed to save chapter")}},Ut=async()=>{console.log("ðŸ”µ [MARK COMPLETE] Function called"),console.log("ðŸ”µ [MARK COMPLETE] Current word count:",T.value?.word_count??a.chapter.word_count);try{console.log("ðŸ”µ [MARK COMPLETE] Saving chapter..."),await le(),console.log("âœ… [MARK COMPLETE] Chapter saved");const t=F("projects.manual-editor.mark-complete",{project:a.project.slug,chapter:a.chapter.chapter_number});console.log("ðŸ”µ [MARK COMPLETE] Posting to:",t),W.post(t,{},{onSuccess:()=>{console.log("âœ… [MARK COMPLETE] Request successful")},onError:s=>{console.error("âŒ [MARK COMPLETE] Request failed:",s)}})}catch(t){console.error("âŒ [MARK COMPLETE] Error:",t),y.error("Failed to save chapter before marking complete")}},Ve=()=>{const t=[{popover:{title:"Welcome to the AI Assisted Editor",description:"Experience a powerful writing environment enhanced by AI. Use the Smart Chapter Starter to kickstart your writing, leverage auto-completion for faster drafting, and access a suite of AI tools to refine your content.",popoverClass:"driver-popover-welcome"}},{element:"#back-to-project-btn",popover:{title:"Back to Project",description:"Return to your project dashboard."}},{element:"#left-sidebar-panel",popover:{title:"Chapter Navigation",description:"Use the Table of Contents to switch between chapters."},onHighlightStarted:()=>{R.value=!0},showOnMobile:!1},{element:"#save-status",popover:{title:"Status & Word Count",description:"Check your save status and current word count at a glance."}},{element:"#manual-editor-toolbar",popover:{title:"Formatting Tools",description:"Use these tools to format your text, add links, headings, and lists."}},{element:"#view-controls",popover:{title:"View Options",description:"Customize your writing experience with dark mode, full screen, AI chat, and tool sidebars."}},{element:"#toggle-chat-mode",popover:{title:"AI Chat Assistant",description:"Open the AI assistant to help you write, brainstorm, or refine your content."}},{element:"#toggle-right-sidebar",popover:{title:"Writing Tools Sidebar",description:"Toggle this sidebar to access efficient writing tools."},showOnMobile:!1},{element:"#right-sidebar-panel",popover:{title:"Writing Tools",description:"Access quick tools like Smart Suggestions, Quick Actions (Expand, Rephrase), and more."},onHighlightStarted:()=>{j.value=!0},showOnMobile:!1},{element:"#credit-display",popover:{title:"Credits",description:"Keep track of your AI credits. Remember, using AI tools consumes credits."}},{element:"#top-up-btn",popover:{title:"Top Up",description:"Running low? Click here to purchase more credits."}},{element:"#export-menu-container",popover:{title:"Export",description:"Export your chapter or entire project in various formats."}},{element:"#analyze-button",popover:{title:"Bulk Analysis",description:"Analyze multiple chapters at once for comprehensive insights."}},{element:"#progress-bar-section",popover:{title:"Writing Progress",description:"Track your progress towards the chapter word count goal."}},{element:"#editor-footer",popover:{title:"Footer Controls",description:"View detailed stats like citations and quality metrics, and clear actions."}},{element:"#mark-complete-btn",popover:{title:"Mark as Complete",description:"Finished writing? Mark the chapter as complete to proceed."}},{element:"#save-button",popover:{title:"Save Work",description:"Manually save your chapter. Auto-save is also active!"}},{element:"#reset-tour-button",popover:{title:"Need Help?",description:"Click here anytime to restart this tour."}}];cs({showProgress:!0,animate:!0,steps:A.value?t.filter(b=>b.showOnMobile!==!1):t}).drive();const n=v.props.auth.user;n?.email&&localStorage.setItem(`manual_editor_tour_seen_${n.email}`,"true")};return he(()=>{const t=v.props.auth.user;t?.email&&(localStorage.getItem(`manual_editor_tour_seen_${t.email}`)||setTimeout(()=>{Ve()},1e3))}),(t,s)=>(l(),_(st,null,[r(e(Kt),{title:`${t.chapter.title} - Manual Editor`},null,8,["title"]),o("div",so,[o("header",oo,[o("div",ro,[r(e(f),{variant:"ghost",size:"icon",class:"h-8 w-8 text-zinc-700 dark:text-zinc-300 hover:text-foreground",onClick:s[0]||(s[0]=n=>e(W).visit(e(F)("projects.show",t.project.slug))),title:"Back to Project"},{default:p(()=>[r(e(Xe),{class:"w-4 h-4"})]),_:1}),r(e(K),{orientation:"vertical",class:"h-6"}),r(e(f),{onClick:s[1]||(s[1]=n=>R.value=!0),variant:"ghost",size:"icon",class:"h-8 w-8 lg:hidden text-muted-foreground hover:text-foreground",title:"Open Chapter Navigation"},{default:p(()=>[r(e(Vt),{class:"w-4 h-4"})]),_:1})]),o("div",ao,[o("div",no,[o("span",{class:"hover:text-foreground transition-colors cursor-pointer truncate",onClick:s[2]||(s[2]=n=>e(W).visit(e(F)("projects.show",t.project.slug)))},x(t.project.title),1)]),o("div",io,[o("div",lo,[o("span",co,"Ch. "+x(t.chapter.chapter_number),1)])])]),o("div",uo,[r(e(f),{variant:"ghost",size:"icon",class:"h-8 w-8",onClick:pe,disabled:e(E),title:"Save"},{default:p(()=>[r(e(Ce),{class:"w-4 h-4"})]),_:1},8,["disabled"]),r(e(K),{orientation:"vertical",class:"h-6 mx-1 opacity-50"}),r(e(f),{onClick:s[3]||(s[3]=n=>j.value=!0),variant:"ghost",size:"icon",class:"h-8 w-8 text-muted-foreground hover:text-foreground",title:"Open Tools"},{default:p(()=>[r(e(Ze),{class:"w-4 h-4"})]),_:1})])]),o("div",po,[o("div",mo,[o("div",ho,[o("h1",{id:"project-title-link",class:"text-sm font-bold text-foreground cursor-pointer hover:text-primary transition-colors",onClick:s[4]||(s[4]=n=>e(W).visit(e(F)("projects.show",t.project.slug)))},x(t.project.title),1),r(e(ds),{id:"chapter-badge",variant:"secondary",class:"h-5 px-2 text-[10px] rounded-full"},{default:p(()=>[H("Ch "+x(t.chapter.chapter_number),1)]),_:1})]),o("div",go,[xe.value?(l(),O(e(f),{key:0,variant:"ghost",size:"sm",class:"h-6 px-2 text-zinc-500 hover:text-foreground gap-1 rounded-full text-[10px]",onClick:s[5]||(s[5]=n=>oe(xe.value.chapter_number)),title:`Previous: ${xe.value.title}`},{default:p(()=>[r(e(Qt),{class:"w-3 h-3"}),s[17]||(s[17]=H(" Prev ",-1))]),_:1},8,["title"])):z("",!0),we.value?(l(),O(e(f),{key:1,variant:"ghost",size:"sm",class:"h-6 px-2 text-zinc-500 hover:text-foreground gap-1 rounded-full text-[10px]",onClick:s[6]||(s[6]=n=>oe(we.value.chapter_number)),title:`Next: ${we.value.title}`},{default:p(()=>[s[18]||(s[18]=H(" Next ",-1)),r(e(Yt),{class:"w-3 h-3"})]),_:1},8,["title"])):z("",!0)])]),o("div",fo,[o("div",vo,[o("div",bo,[r(e(f),{id:"back-to-project-btn",variant:"ghost",size:"icon",class:"h-8 w-8 text-zinc-700 dark:text-zinc-300 hover:text-foreground rounded-full",onClick:s[7]||(s[7]=n=>e(W).visit(e(F)("projects.show",t.project.slug))),title:"Back to Project"},{default:p(()=>[r(e(Xe),{class:"w-4 h-4"})]),_:1}),s[19]||(s[19]=o("div",{class:"h-4 w-px bg-border/50 mx-1"},null,-1)),r(e(f),{id:"toggle-left-sidebar",onClick:bt,variant:"ghost",size:"icon",class:L(["h-8 w-8 transition-all duration-300 rounded-full",R.value?"text-primary":"text-zinc-700 dark:text-zinc-300 hover:text-foreground"]),title:"Toggle Chapter Navigation"},{default:p(()=>[R.value?(l(),O(e(Xt),{key:0,class:"w-4 h-4"})):(l(),O(e(Zt),{key:1,class:"w-4 h-4"}))]),_:1},8,["class"])]),s[21]||(s[21]=o("div",{class:"h-4 w-px bg-border/50"},null,-1)),o("div",xo,[o("div",wo,[o("div",{class:L(["w-2 h-2 rounded-full transition-colors duration-300",e(M)?"bg-amber-500 animate-pulse":"bg-emerald-500"])},null,2),o("span",yo,x(e(M)?"Unsaved":"Saved"),1)]),r(e(K),{orientation:"vertical",class:"h-3"}),e(fe)?(l(),_("div",_o,[r(e(ot),{class:"w-3 h-3 animate-spin text-primary"}),s[20]||(s[20]=o("span",{class:"text-xs text-muted-foreground"},"Analyzing",-1))])):(l(),_("div",Co,x(e(T)?.word_count??t.chapter.word_count)+" words ",1))])]),s[24]||(s[24]=o("div",{class:"flex-1 px-4 min-w-0"},[o("div",{id:"manual-editor-toolbar",class:"mx-auto max-w-[950px]"})],-1)),o("div",ko,[o("div",So,[r(e(f),{variant:"ghost",size:"icon",class:"h-7 w-7 rounded-full text-zinc-700 dark:text-zinc-300 hover:text-foreground",onClick:e(ft),title:e(Ie)?"Switch to Light Mode":"Switch to Dark Mode"},{default:p(()=>[e(Ie)?(l(),O(e(Jt),{key:0,class:"w-4 h-4"})):(l(),O(e(es),{key:1,class:"w-4 h-4"}))]),_:1},8,["onClick","title"]),r(e(f),{variant:"ghost",size:"icon",class:"h-7 w-7 rounded-full text-zinc-700 dark:text-zinc-300 hover:text-foreground",onClick:ht,title:Le.value?"Exit Full Screen":"Enter Full Screen"},{default:p(()=>[Le.value?(l(),O(e(ts),{key:0,class:"w-4 h-4"})):(l(),O(e(ss),{key:1,class:"w-4 h-4"}))]),_:1},8,["title"]),r(e(f),{id:"toggle-chat-mode",onClick:Re,variant:"ghost",size:"icon",class:L(["h-7 w-7 rounded-full transition-all duration-300",e($e)?"bg-background shadow-sm text-primary":"text-zinc-700 dark:text-zinc-300 hover:text-foreground"]),title:"Toggle AI Chat Mode"},{default:p(()=>[r(e(Ze),{class:"w-4 h-4"})]),_:1},8,["class"]),r(e(f),{id:"toggle-right-sidebar",onClick:xt,variant:"ghost",size:"icon",class:L(["h-7 w-7 rounded-full transition-all duration-300",j.value?"bg-background shadow-sm text-primary":"text-zinc-700 dark:text-zinc-300 hover:text-foreground"]),title:"Toggle Tools Sidebar"},{default:p(()=>[j.value?(l(),O(e(os),{key:0,class:"w-4 h-4"})):(l(),O(e(rs),{key:1,class:"w-4 h-4"}))]),_:1},8,["class"])]),s[23]||(s[23]=o("div",{class:"w-px h-4 bg-border/50"},null,-1)),o("div",Mo,[e(h)?(l(),O(Ss,{key:0,balance:e(h),compact:""},null,8,["balance"])):z("",!0)]),o("div",To,[r(Cs,{project:t.project,"current-chapter":t.chapter,"all-chapters":t.allChapters,size:"sm",variant:"outline",class:"h-9","button-class":"rounded-full bg-background/50"},null,8,["project","current-chapter","all-chapters"])]),r(e(f),{id:"analyze-button",variant:"ghost",size:"sm",class:"h-9 gap-2 text-zinc-700 dark:text-zinc-300 hover:text-foreground rounded-full bg-background/50 border border-transparent hover:border-border/50",onClick:gt,title:"Open bulk analysis"},{default:p(()=>[r(e(as),{class:"w-4 h-4"}),s[22]||(s[22]=o("span",{class:"text-xs font-medium"},"Analyze",-1))]),_:1}),r(e(f),{id:"save-button",variant:"outline",size:"sm",class:"h-9 gap-2 text-zinc-700 dark:text-zinc-300 hover:text-foreground rounded-full bg-background/50",onClick:pe,disabled:e(E),title:"Save (Ctrl+S)"},{default:p(()=>[r(e(Ce),{class:"w-4 h-4"}),o("span",jo,x(e(E)?"Saving...":"Save"),1)]),_:1},8,["disabled"]),r(e(f),{id:"reset-tour-button",variant:"ghost",size:"icon",class:"h-8 w-8 text-muted-foreground",onClick:Ve,title:"Restart Tour"},{default:p(()=>[r(e(ns),{class:"w-4 h-4"})]),_:1})])])]),o("div",zo,[o("div",Ao,[s[25]||(s[25]=o("span",{class:"font-medium"},"Writing Progress",-1)),o("span",null,x(e(T)?.word_count??t.chapter.word_count)+" / "+x(t.chapter.target_word_count)+" words",1)]),r(e(us),{"model-value":vt.value,class:"h-1.5"},null,8,["model-value"])]),o("div",$o,[r(Se,{"enter-active-class":"transition-all duration-500 cubic-bezier(0.4, 0, 0.2, 1)","enter-from-class":"-ml-[320px] opacity-0","enter-to-class":"ml-0 opacity-100","leave-active-class":"transition-all duration-500 cubic-bezier(0.4, 0, 0.2, 1)","leave-from-class":"ml-0 opacity-100","leave-to-class":"-ml-[320px] opacity-0"},{default:p(()=>[R.value&&!A.value?(l(),_("aside",Eo,[o("div",Ro,[o("div",Oo,[s[26]||(s[26]=o("h2",{class:"text-sm font-semibold text-foreground mb-1"},"Table of Contents",-1)),o("p",Lo,x(t.allChapters.length)+" Chapters",1)]),r(ys,{"all-chapters":t.allChapters,"current-chapter":t.chapter,project:t.project,outlines:t.project.outlines||[],"faculty-chapters":t.facultyChapters||[],"current-word-count":e(T)?.word_count||t.chapter.word_count,"target-word-count":t.chapter.target_word_count,"writing-quality-score":0,"chapter-content-length":e(g)?.length||0,onGoToChapter:oe,onGenerateNextChapter:We,onDeleteChapter:Ke},null,8,["all-chapters","current-chapter","project","outlines","faculty-chapters","current-word-count","target-word-count","chapter-content-length"])])])):z("",!0)]),_:1}),o("div",{class:L(["flex-1 flex overflow-hidden",ee.value?"flex-row":"flex-col"])},[o("div",{class:L(["flex flex-col overflow-hidden",ee.value?"w-1/2 border-r border-border/50":"flex-1"])},[o("div",Io,[r(ps,{ref_key:"editorRef",ref:V,modelValue:e(g),"onUpdate:modelValue":J,"onUpdate:selectedText":s[8]||(s[8]=n=>ve.value=n),"onUpdate:selectionRange":s[9]||(s[9]=n=>be.value=n),"ghost-text":At.value,"ghost-text-format":$t.value,onGhostAccepted:It,onGhostDismissed:Pt,onGhostManualTrigger:Ft,"manual-mode":!0,"toolbar-teleport-target":A.value?"":"#manual-editor-toolbar",class:"min-h-full"},null,8,["modelValue","ghost-text","ghost-text-format","toolbar-teleport-target"])])],2),ee.value?(l(),_("div",Po,[o("div",Fo,[r(Je,{"show-citation-helper":G.value,"onUpdate:showCitationHelper":s[10]||(s[10]=n=>G.value=n),"chapter-content":e(g),"chapter-id":t.chapter.id,"citation-operation-mode":!0,onInsertCitation:ye,onExitOperationMode:Oe},null,8,["show-citation-helper","chapter-content","chapter-id"])])])):z("",!0)],2),r(Se,{"enter-active-class":"transition-all duration-500 cubic-bezier(0.4, 0, 0.2, 1)","enter-from-class":"-mr-[400px] opacity-0","enter-to-class":"mr-0 opacity-100","leave-active-class":"transition-all duration-500 cubic-bezier(0.4, 0, 0.2, 1)","leave-from-class":"mr-0 opacity-100","leave-to-class":"-mr-[400px] opacity-0"},{default:p(()=>[j.value&&!A.value?(l(),_("aside",Bo,[e($e)?(l(),_("div",Uo,[o("div",Ho,[r(Ys,{messages:e(it),"is-loading":e(lt),analysis:e(T),class:"h-full",onSend:e(dt),onClose:Re},null,8,["messages","is-loading","analysis","onSend"])])])):(l(),_("div",Go,[e(ge)?(l(),_("div",qo,[r(fs,{suggestion:e(ge),analysis:e(T),onSave:e(je),onClear:e(ze),onApply:e(Ae)},null,8,["suggestion","analysis","onSave","onClear","onApply"]),r(e(K),{class:"bg-border/50"})])):z("",!0),r(vs,{"project-slug":t.project.slug,"chapter-number":t.chapter.chapter_number,"selected-text":ve.value,"chapter-content":e(g),"is-processing":e(fe)||e(E),"ensure-balance":Ne,"on-usage":ue,onTextImproved:He,onTextExpanded:Ge,onCitationsSuggested:qe,onTextRephrased:De,onOpenCitationHelper:s[11]||(s[11]=n=>G.value=!0)},null,8,["project-slug","chapter-number","selected-text","chapter-content","is-processing"]),r(e(K),{class:"bg-border/50"}),se.value?(l(),_("div",Do,[o("div",No,[s[28]||(s[28]=o("h3",{class:"text-sm font-semibold text-foreground"},"Citation Suggestions",-1)),r(e(f),{size:"sm",variant:"outline",onClick:Bt},{default:p(()=>[...s[27]||(s[27]=[H(" Copy ",-1)])]),_:1})]),o("pre",Wo,x(se.value),1),r(e(K),{class:"bg-border/50"})])):z("",!0),o("div",Ko,[r(Je,{"show-citation-helper":G.value,"onUpdate:showCitationHelper":s[12]||(s[12]=n=>G.value=n),"chapter-content":e(g),"chapter-id":t.chapter.id,onInsertCitation:ye,onEnterOperationMode:mt},null,8,["show-citation-helper","chapter-content","chapter-id"])]),r(e(K),{class:"bg-border/50"}),r(e(K),{class:"bg-border/50"})]))])):z("",!0)]),_:1}),r(bs,{"show-left-sidebar":R.value,"show-right-sidebar":j.value,"is-mobile":A.value,"all-chapters":t.allChapters,"current-chapter":t.chapter,project:t.project,"faculty-chapters":t.facultyChapters,"current-word-count":e(T)?.word_count||t.chapter.word_count,"target-word-count":t.chapter.target_word_count,"chapter-content-length":e(g)?.length||0,"selected-text":ve.value,"is-analyzing":e(fe),"is-saving":e(E),"current-suggestion":e(ge),"current-analysis":e(T),"chapter-content":e(g),"show-citation-helper":G.value,"ensure-balance":Ne,"on-usage":ue,"onUpdate:showLeftSidebar":s[13]||(s[13]=n=>R.value=n),"onUpdate:showRightSidebar":s[14]||(s[14]=n=>j.value=n),"onUpdate:showCitationHelper":s[15]||(s[15]=n=>G.value=n),onGoToChapter:oe,onGenerateNextChapter:We,onDeleteChapter:Ke,onSaveSuggestion:e(je),onClearSuggestion:e(ze),onApplySuggestion:e(Ae),onTextImproved:He,onTextExpanded:Ge,onCitationsSuggested:qe,onTextRephrased:De,onInsertCitation:ye},null,8,["show-left-sidebar","show-right-sidebar","is-mobile","all-chapters","current-chapter","project","faculty-chapters","current-word-count","target-word-count","chapter-content-length","selected-text","is-analyzing","is-saving","current-suggestion","current-analysis","chapter-content","show-citation-helper","onSaveSuggestion","onClearSuggestion","onApplySuggestion"])]),o("footer",Vo,[o("div",Qo,[o("div",Yo,[o("span",Xo,[s[29]||(s[29]=o("span",{class:"hidden sm:inline"},"Words: ",-1)),o("strong",Zo,x(e(T)?.word_count??t.chapter.word_count),1),H(" / "+x(t.chapter.target_word_count),1)]),e(T)?(l(),_("span",Jo,[s[30]||(s[30]=H(" Citations: ",-1)),o("strong",er,x(e(T).citation_count),1)])):z("",!0),e(T)?(l(),_("span",tr,[s[31]||(s[31]=H(" Tables: ",-1)),o("strong",sr,x(e(T).table_count),1)])):z("",!0),e(T)?(l(),_("span",or," Quality: "+x(e(T).quality_metrics.reading_level),1)):z("",!0)]),o("div",rr,[r(e(f),{variant:"outline",size:"sm",class:"h-8 md:h-9 gap-2 flex-1 sm:flex-initial",onClick:pe,disabled:e(E),title:"Save chapter"},{default:p(()=>[r(e(Ce),{class:"w-3.5 h-3.5 md:w-4 md:h-4"}),o("span",ar,x(e(E)?"Saving...":"Save"),1)]),_:1},8,["disabled"]),r(e(f),{id:"mark-complete-btn",variant:"default",size:"sm",class:"h-8 md:h-9 gap-2 flex-1 sm:flex-initial",onClick:Ut,disabled:e(E),title:"Save and mark chapter as complete"},{default:p(()=>[r(e(is),{class:"w-3.5 h-3.5 md:w-4 md:h-4"}),s[32]||(s[32]=o("span",{class:"text-xs font-medium hidden sm:inline"},"Mark Complete",-1)),s[33]||(s[33]=o("span",{class:"text-xs font-medium sm:hidden"},"Complete",-1))]),_:1},8,["disabled"])])])]),r(Ms,{open:e(w),"current-balance":e(i),"required-words":e(k),action:e(I),"onUpdate:open":s[16]||(s[16]=n=>w.value=n),onClose:e(d)},null,8,["open","current-balance","required-words","action","onClose"]),r(e(ks),{position:"top-center"})]),r(Rs,{show:e(q)&&!!e(de),"is-generating":e(yt),onRegenerate:Rt,onDismiss:e(Pe)},null,8,["show","is-generating","onDismiss"])],64))}}),aa=rt(nr,[["__scopeId","data-v-e6b99424"]]);export{aa as default};
