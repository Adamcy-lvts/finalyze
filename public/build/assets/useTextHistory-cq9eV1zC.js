import{c as N,_ as x}from"./index-Bgg0nQk5.js";import{d as $e,b as k,e as Y,p as Ue,c as m,o as n,F as E,f as y,i as g,k as a,g as s,u as e,j as r,y as p,z as i,n as U,h as M,a2 as fe,a3 as oe,ad as q,U as re}from"./app-maMcu0uD.js";import{_ as z}from"./index-CiyIKZmL.js";import{_ as je,a as Se}from"./CardContent.vue_vue_type_script_setup_true_lang-2Nt8Lqji.js";import{_ as ze,a as Ae}from"./CardTitle.vue_vue_type_script_setup_true_lang-B6LOIMlz.js";import{_ as Me,a as Re,b as Le}from"./CollapsibleTrigger.vue_vue_type_script_setup_true_lang-Bbwvo7vp.js";import{_ as ve}from"./Input.vue_vue_type_script_setup_true_lang-Ct2B-tyf.js";import{a as ie}from"./ScrollArea.vue_vue_type_script_setup_true_lang-BAU-UIqN.js";import{_ as T}from"./Separator.vue_vue_type_script_setup_true_lang-CPTRM7cV.js";import{H as xe,_ as Ie,b as Oe,c as Te,d as He,e as Ne,f as Ve,g as qe,h as Be}from"./AlertDialogTitle.vue_vue_type_script_setup_true_lang-XyqkV86t.js";import{t as f}from"./index-XdoD1GEC.js";import{at as K}from"./RichTextEditor-Df06F1HU.js";import{X as Ge}from"./x-BB4bGFUz.js";import{B as ne}from"./book-open-OQk7EWl0.js";import{C as ee}from"./chevron-down-xhbGvclE.js";import{L as H}from"./loader-circle-CQZQKkU5.js";import{S as he}from"./search-C5TLqhPG.js";import{S as Q}from"./sparkles-DroARSRM.js";import{T as _e,f as Je,a as We,b as Ke,c as ge,d as ye,e as Qe}from"./DropdownMenuTrigger.vue_vue_type_script_setup_true_lang-B15b9auS.js";import{T as be}from"./trash-2-TboKVWDY.js";import{P as X}from"./plus-D7nSOrQf.js";import{C as Z}from"./type-CAhhrpGe.js";import{C as Xe}from"./chevron-right-C1YVBAOh.js";import{_ as Ze}from"./Checkbox.vue_vue_type_script_setup_true_lang-Bn43rVLr.js";import{_ as Ye,c as et,a as tt,b as st}from"./DialogTitle.vue_vue_type_script_setup_true_lang-zGttQgoX.js";import{_ as at}from"./DialogDescription.vue_vue_type_script_setup_true_lang-CGYwbIIR.js";import{_ as ot}from"./DialogFooter.vue_vue_type_script_setup_true_lang-CotaDSEp.js";import{D as le}from"./download-DKO3l3eQ.js";import{F as ke}from"./file-text-DdhmqBtq.js";/**
 * @license lucide-vue-next v0.468.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ce=N("ExternalLinkIcon",[["path",{d:"M15 3h6v6",key:"1q9fwt"}],["path",{d:"M10 14 21 3",key:"gplh6r"}],["path",{d:"M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6",key:"a6xqqp"}]]);/**
 * @license lucide-vue-next v0.468.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const rt=N("FileDownIcon",[["path",{d:"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z",key:"1rqfz7"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}],["path",{d:"M12 18v-6",key:"17g6i2"}],["path",{d:"m9 15 3 3 3-3",key:"1npd3o"}]]);/**
 * @license lucide-vue-next v0.468.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const nt=N("Maximize2Icon",[["polyline",{points:"15 3 21 3 21 9",key:"mznyad"}],["polyline",{points:"9 21 3 21 3 15",key:"1avn1i"}],["line",{x1:"21",x2:"14",y1:"3",y2:"10",key:"ota7mn"}],["line",{x1:"3",x2:"10",y1:"21",y2:"14",key:"1atl0r"}]]);/**
 * @license lucide-vue-next v0.468.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Na=N("PanelRightCloseIcon",[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",key:"afitv7"}],["path",{d:"M15 3v18",key:"14nvp0"}],["path",{d:"m8 9 3 3-3 3",key:"12hl5m"}]]);/**
 * @license lucide-vue-next v0.468.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Va=N("PanelRightOpenIcon",[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",key:"afitv7"}],["path",{d:"M15 3v18",key:"14nvp0"}],["path",{d:"m10 15-3-3 3-3",key:"1pgupc"}]]);/**
 * @license lucide-vue-next v0.468.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const we=N("WandSparklesIcon",[["path",{d:"m21.64 3.64-1.28-1.28a1.21 1.21 0 0 0-1.72 0L2.36 18.64a1.21 1.21 0 0 0 0 1.72l1.28 1.28a1.2 1.2 0 0 0 1.72 0L21.64 5.36a1.2 1.2 0 0 0 0-1.72",key:"ul74o6"}],["path",{d:"m14 7 3 3",key:"1r5n42"}],["path",{d:"M5 6v4",key:"ilb8ba"}],["path",{d:"M19 14v4",key:"blhpug"}],["path",{d:"M10 2v2",key:"7u0qdc"}],["path",{d:"M7 8H3",key:"zfb6yr"}],["path",{d:"M21 16h-4",key:"1cnmox"}],["path",{d:"M11 3H9",key:"1obp7u"}]]),lt={key:0,class:"sticky top-0 z-10 bg-background border-b border-border/60"},it={class:"flex items-center justify-between p-4"},dt={class:"flex items-center gap-3"},ct={key:1,class:"p-6 space-y-4"},ut={class:"space-y-2"},pt={class:"flex items-center gap-2"},mt={key:0,class:"space-y-2 pl-6"},ft={class:"flex gap-2"},vt={class:"text-xs text-muted-foreground"},xt={class:"space-y-2"},ht={class:"flex items-center gap-2"},_t={key:0,class:"pl-6"},gt={class:"flex gap-2"},yt={class:"space-y-4"},bt={class:"text-sm font-semibold text-foreground flex items-center gap-2"},kt={class:"font-medium"},Ct={key:0,class:"space-y-3 mt-4"},wt={class:"flex items-center justify-between"},$t={class:"text-sm font-medium text-amber-600 dark:text-amber-400 flex items-center gap-2"},jt={class:"flex gap-4 max-h-[500px]"},St={class:"w-1/2 overflow-y-auto pr-2 custom-scrollbar space-y-2"},Ft=["onClick"],Dt={class:"text-sm font-medium text-foreground leading-snug line-clamp-3"},Pt={class:"flex items-center gap-2 mt-2"},Et={key:0,class:"text-xs text-muted-foreground"},Ut={class:"w-1/2 overflow-y-auto pl-2 custom-scrollbar"},zt={key:0,class:"space-y-3"},At={class:"text-xs text-muted-foreground mb-2"},Mt={class:"text-sm font-medium text-foreground leading-snug"},Rt={class:"text-xs text-muted-foreground"},Lt={class:"flex items-center gap-2"},It={key:0,class:"text-xs text-muted-foreground"},Ot={class:"flex gap-2 mt-2"},Tt={key:0,class:"text-sm text-muted-foreground text-center py-4"},Ht={key:1,class:"flex items-center justify-center h-full text-muted-foreground"},Nt={class:"text-center py-8"},Vt={key:1,class:"text-center py-6"},qt={key:0,class:"space-y-3"},Bt={class:"flex items-center justify-between"},Gt={class:"text-sm font-semibold text-foreground flex items-center gap-2"},Jt={class:"space-y-2 max-h-[200px] overflow-y-auto pr-2 custom-scrollbar"},Wt=["onClick"],Kt={class:"text-sm font-medium text-foreground truncate"},Qt={class:"text-xs text-muted-foreground"},Xt={class:"flex items-center gap-2"},Zt={class:"flex items-center gap-1"},Yt={class:"rounded-lg bg-gradient-to-r from-amber-50 to-indigo-50 dark:from-amber-950/20 dark:to-indigo-950/20 border border-amber-200/50 dark:border-amber-800/50 p-3"},es={class:"flex items-start gap-2"},ts={class:"space-y-3"},ss={class:"space-y-2"},as={class:"text-xs font-medium text-muted-foreground flex items-center gap-1"},os={class:"flex gap-1"},rs={class:"rounded-lg bg-muted/30 p-2"},ns={class:"text-xs font-medium text-foreground mb-1"},ls={class:"text-xs text-muted-foreground mb-2"},is={class:"text-xs text-muted-foreground font-mono bg-background p-2 rounded border"},ds={class:"space-y-3"},cs={class:"text-xs font-medium text-muted-foreground flex items-center gap-1"},us={class:"flex gap-2"},ps={class:"space-y-3"},ms={class:"flex items-center justify-between"},fs={class:"text-xs font-medium text-muted-foreground flex items-center gap-1"},vs={class:"text-xs font-medium"},xs={key:0,class:"space-y-2 mt-3"},hs={class:"flex items-center justify-between"},_s={class:"text-xs font-medium text-amber-600 dark:text-amber-400 flex items-center gap-1"},gs={class:"space-y-2 pr-2"},ys=["onClick"],bs={class:"flex items-start gap-2"},ks={class:"flex-1 min-w-0"},Cs={class:"text-xs font-medium text-foreground line-clamp-2"},ws={class:"text-[10px] text-muted-foreground mt-1"},$s={class:"flex items-center gap-2 mt-1"},js={class:"text-[10px] text-muted-foreground"},Ss={key:0,class:"border-t bg-muted/10 p-3 space-y-2"},Fs={class:"text-xs font-medium text-foreground line-clamp-2"},Ds={class:"text-[10px] text-muted-foreground"},Ps={class:"flex items-center gap-2 mt-1"},Es={key:0,class:"text-[9px] text-muted-foreground"},Us={class:"flex gap-1 mt-2"},zs={key:1,class:"border-t bg-muted/10 p-3"},As={class:"text-xs text-muted-foreground text-center py-2"},Ms={class:"font-medium"},Rs={key:1,class:"text-center py-4"},Ls={key:0,class:"space-y-3"},Is={class:"flex items-center justify-between"},Os={class:"text-xs font-medium text-muted-foreground flex items-center gap-1"},Ts={class:"space-y-2 pr-2"},Hs=["onClick"],Ns={class:"flex items-start justify-between gap-2"},Vs={class:"flex-1 min-w-0"},qs={class:"text-xs font-medium text-foreground truncate"},Bs={class:"text-xs text-muted-foreground mt-1"},Gs={class:"flex items-center gap-2 mt-1"},Js={class:"text-xs text-muted-foreground"},Ws={class:"flex items-center gap-1 opacity-0 group-hover:opacity-100 transition-opacity"},Ks={key:0,class:"mt-3 pt-3 border-t"},Qs={class:"bg-muted/30 rounded p-2"},Xs={class:"text-xs font-medium text-foreground mb-1"},Zs={class:"text-xs text-muted-foreground font-mono leading-relaxed"},Ys={class:"flex gap-2 mt-3"},ea={key:1,class:"py-8 text-center"},qa=$e({__name:"CitationHelper",props:{showCitationHelper:{type:Boolean},chapterContent:{},chapterId:{},citationOperationMode:{type:Boolean,default:!1}},emits:["update:showCitationHelper","insert-citation","enter-operation-mode","exit-operation-mode"],setup(V,{emit:j}){const h=V,v=j,b=k("apa"),S=k(""),D=k(!1),A=k(!1),R=k(!1),w=k([]),O=k(null),P=k(!1),B=k(!1),c=k([]),l=k(!1),u=k(null),F=k(null),$=k(!0),C=k(!0),L=async()=>{if(h.chapterId){B.value=!0;try{const d=await q.get("/api/citations/detected-claims",{params:{chapter_id:h.chapterId}});d.data.success&&d.data.has_detection&&(c.value=d.data.claims||[],F.value=d.data.detected_at,l.value=c.value.length>0)}catch(d){console.error("Failed to load saved detections:",d)}finally{B.value=!1}}},I=async()=>{if(!h.chapterContent||h.chapterContent.trim().length<100){f.error("Please add more content before detecting citations (minimum 100 characters)");return}if(!h.chapterId){f.error("Chapter ID is required for detection");return}P.value=!0,c.value=[],l.value=!0;try{const d=await q.post("/api/citations/detect-claims",{content:h.chapterContent,chapter_id:h.chapterId});d.data.success?(c.value=d.data.claims||[],F.value=d.data.detected_at,c.value.length===0?f.info("No claims requiring citations were detected"):f.success(`Found ${c.value.length} claims that may need citations`)):f.error("Failed to detect claims")}catch(d){console.error("Failed to detect claims:",d),f.error("Failed to analyze content for citations")}finally{P.value=!1}},te=d=>{u.value=u.value===d?null:d},de=(d,t)=>{const o=d.style[b.value];v("insert-citation",o,t),f.success("Citation inserted into document")},ce=d=>{const t=d.style[b.value];navigator.clipboard.writeText(t),f.success("Citation copied to clipboard")},ue=d=>{d&&window.open(d,"_blank")},se={apa:{name:"APA Style",description:"American Psychological Association",example:"Smith, J. (2023). Research methods. Journal of Science, 15(3), 123-145."},harvard:{name:"Harvard Style",description:"Author-date referencing system",example:'Smith, J. (2023) "Research methods", Journal of Science, 15(3), pp. 123-145.'},ieee:{name:"IEEE Style",description:"Institute of Electrical and Electronics Engineers",example:'J. Smith, "Research methods," Journal of Science, vol. 15, no. 3, pp. 123-145, 2023.'}},G=Y(()=>se[b.value]),Fe=d=>{v("update:showCitationHelper",d)},De=d=>{O.value=O.value===d?null:d},J=async()=>{if(!S.value.trim()){f.error("Please enter a URL, DOI, or search term");return}D.value=!0;try{const d=await q.post("/api/citations/generate",{input:S.value.trim()});if(d.data.success){const t=d.data.citation,o={id:t.id.toString(),title:t.title,authors:t.authors,year:t.year,journal:t.journal,url:t.url,doi:t.doi,type:t.type,style:{apa:t.style.apa,harvard:t.style.harvard,ieee:t.style.ieee},createdAt:new Date(t.created_at)};w.value.unshift(o),S.value="",f.success("Citation generated successfully!")}else f.error("Failed to generate citation")}catch(d){console.error("Failed to search citation:",d),d.response?.status===422?f.error("Invalid input format"):f.error("Failed to generate citation")}finally{D.value=!1}},ae=d=>{const t=d.style[b.value];v("insert-citation",t),f.success("Citation inserted into document")},pe=d=>{const t=d.style[b.value];navigator.clipboard.writeText(t),f.success("Citation copied to clipboard")},me=()=>{if(!w.value.length){f.error("No citations to clear");return}R.value=!0},Pe=async()=>{A.value=!0,R.value=!1;try{(await q.delete("/api/citations/clear")).data.success?(w.value=[],O.value=null,f.success("All citations cleared successfully")):f.error("Failed to clear citations")}catch(d){console.error("Failed to clear citations:",d),f.error("Failed to clear citations")}finally{A.value=!1}},Ee=async()=>{try{const d=await q.get("/api/citations/recent",{params:{limit:10}});d.data.success&&(w.value=d.data.citations.map(t=>({id:t.id.toString(),title:t.title,authors:t.authors,year:t.year,journal:t.journal,url:t.url,doi:t.doi,type:t.type,style:{apa:t.style.apa,harvard:t.style.harvard,ieee:t.style.ieee},createdAt:new Date(t.created_at)})))}catch(d){console.error("Failed to load recent citations:",d)}};return Ue(()=>{Ee(),L()}),(d,t)=>(n(),m(E,null,[d.citationOperationMode?(n(),m("div",lt,[s("div",it,[s("div",dt,[a(e(K),{class:"h-5 w-5 text-primary"}),t[10]||(t[10]=s("h2",{class:"text-lg font-semibold text-foreground"},"Citation Helper",-1)),a(e(z),{variant:"secondary",class:"ml-1"},{default:r(()=>[p(i(b.value.toUpperCase()),1)]),_:1})]),a(e(x),{onClick:t[0]||(t[0]=o=>v("exit-operation-mode")),variant:"ghost",size:"sm",class:"gap-2 text-muted-foreground hover:text-foreground"},{default:r(()=>[a(e(Ge),{class:"h-4 w-4"}),t[11]||(t[11]=p(" Close ",-1))]),_:1})])])):y("",!0),d.citationOperationMode?(n(),m("div",ct,[s("div",ut,[s("button",{onClick:t[1]||(t[1]=o=>$.value=!$.value),class:"w-full flex items-center justify-between text-sm font-semibold text-foreground hover:text-primary transition-colors"},[s("span",pt,[a(e(ne),{class:"h-4 w-4"}),t[12]||(t[12]=p(" Citation Style ",-1)),a(e(z),{variant:"outline",class:"text-xs"},{default:r(()=>[p(i(b.value.toUpperCase()),1)]),_:1})]),a(e(ee),{class:U(["h-4 w-4 transition-transform",$.value?"rotate-180":""])},null,8,["class"])]),$.value?(n(),m("div",mt,[s("div",ft,[(n(!0),m(E,null,M(Object.keys(se),o=>(n(),g(e(x),{key:o,onClick:_=>b.value=o,variant:b.value===o?"default":"outline",size:"sm",class:"flex-1"},{default:r(()=>[p(i(o.toUpperCase()),1)]),_:2},1032,["onClick","variant"]))),128))]),s("p",vt,i(G.value.description),1)])):y("",!0)]),a(e(T)),s("div",xt,[s("button",{onClick:t[2]||(t[2]=o=>C.value=!C.value),class:"w-full flex items-center justify-between text-sm font-semibold text-foreground hover:text-primary transition-colors"},[s("span",ht,[a(e(we),{class:"h-4 w-4"}),t[13]||(t[13]=p(" Generate Citation ",-1))]),a(e(ee),{class:U(["h-4 w-4 transition-transform",C.value?"rotate-180":""])},null,8,["class"])]),C.value?(n(),m("div",_t,[s("div",gt,[a(e(ve),{modelValue:S.value,"onUpdate:modelValue":t[3]||(t[3]=o=>S.value=o),placeholder:"URL, DOI, or search...",class:"flex-1",onKeyup:fe(J,["enter"]),disabled:D.value},null,8,["modelValue","disabled"]),a(e(x),{onClick:J,disabled:D.value||!S.value.trim(),size:"sm"},{default:r(()=>[D.value?(n(),g(e(H),{key:0,class:"h-4 w-4 animate-spin"})):(n(),g(e(he),{key:1,class:"h-4 w-4"}))]),_:1},8,["disabled"])])])):y("",!0)]),a(e(T)),s("div",yt,[s("h3",bt,[a(e(Q),{class:"h-4 w-4 text-purple-500"}),t[14]||(t[14]=p(" Auto-Detect Citations ",-1))]),a(e(x),{onClick:I,disabled:P.value,class:"w-full gap-2 h-12 text-base bg-gradient-to-r from-purple-500 to-indigo-500 hover:from-purple-600 hover:to-indigo-600 text-white"},{default:r(()=>[P.value?(n(),g(e(H),{key:0,class:"h-5 w-5 animate-spin"})):(n(),g(e(Q),{key:1,class:"h-5 w-5"})),s("span",kt,i(P.value?"Scanning content for claims...":"Scan for Missing Citations"),1)]),_:1},8,["disabled"]),t[20]||(t[20]=s("p",{class:"text-sm text-muted-foreground"}," ðŸ” AI analyzes your chapter content to find claims that need academic references, then searches multiple databases for relevant papers. ",-1)),l.value&&c.value.length>0?(n(),m("div",Ct,[s("div",wt,[s("span",$t,[a(e(_e),{class:"h-4 w-4"}),p(" "+i(c.value.length)+" claims need citations ",1)]),a(e(x),{variant:"outline",size:"sm",onClick:t[4]||(t[4]=o=>{l.value=!1,c.value=[]})},{default:r(()=>[...t[15]||(t[15]=[p(" Clear Results ",-1)])]),_:1})]),s("div",jt,[s("div",St,[(n(!0),m(E,null,M(c.value,o=>(n(),m("div",{key:o.id,onClick:_=>u.value=u.value===o.id?null:o.id,class:U(["rounded-lg border p-3 cursor-pointer transition-all",u.value===o.id?"bg-primary/10 border-primary":"bg-card hover:bg-muted/50 border-border"])},[s("p",Dt,' "'+i(o.text)+'" ',1),s("div",Pt,[a(e(z),{variant:"outline",class:U([o.confidence>.8?"border-red-300 text-red-600":o.confidence>.6?"border-amber-300 text-amber-600":"border-gray-300 text-gray-600","text-xs"])},{default:r(()=>[p(i(Math.round(o.confidence*100))+"% ",1)]),_:2},1032,["class"]),o.suggestions?.length?(n(),m("span",Et,i(o.suggestions.length)+" suggestions ",1)):y("",!0)])],10,Ft))),128))]),s("div",Ut,[u.value&&c.value.find(o=>o.id===u.value)?(n(),m("div",zt,[s("div",At,i(c.value.find(o=>o.id===u.value)?.reason),1),t[17]||(t[17]=s("p",{class:"text-xs font-medium text-foreground"},"Suggested Citations:",-1)),(n(!0),m(E,null,M(c.value.find(o=>o.id===u.value)?.suggestions,o=>(n(),m("div",{key:o.id,class:"rounded-lg border bg-card p-3 space-y-2"},[s("p",Mt,i(o.title),1),s("p",Rt,i(o.authors?.join(", "))+" ("+i(o.year)+") ",1),s("div",Lt,[a(e(z),{variant:"secondary",class:"text-xs"},{default:r(()=>[p(i(o.source),1)]),_:2},1024),o.citation_count?(n(),m("span",It,i(o.citation_count)+" citations ",1)):y("",!0)]),s("div",Ot,[a(e(x),{onClick:_=>de(o,c.value.find(W=>W.id===u.value)?.text),size:"sm",class:"flex-1"},{default:r(()=>[a(e(X),{class:"h-4 w-4 mr-1"}),t[16]||(t[16]=p(" Insert ",-1))]),_:2},1032,["onClick"]),a(e(x),{onClick:_=>ce(o),size:"sm",variant:"outline"},{default:r(()=>[a(e(Z),{class:"h-4 w-4"})]),_:2},1032,["onClick"]),o.url?(n(),g(e(x),{key:0,onClick:_=>ue(o.url),size:"sm",variant:"outline"},{default:r(()=>[a(e(Ce),{class:"h-4 w-4"})]),_:2},1032,["onClick"])):y("",!0)])]))),128)),c.value.find(o=>o.id===u.value)?.suggestions?.length?y("",!0):(n(),m("div",Tt," No matching papers found. Try manual search. "))])):(n(),m("div",Ht,[s("div",Nt,[a(e(K),{class:"h-8 w-8 mx-auto mb-2 opacity-30"}),t[18]||(t[18]=s("p",{class:"text-sm"},"Select a claim to view suggestions",-1))])]))])])])):l.value&&c.value.length===0&&!P.value?(n(),m("div",Vt,[...t[19]||(t[19]=[s("p",{class:"text-sm text-green-600 dark:text-green-400"}," âœ… No claims requiring citations were detected in your content! ",-1)])])):y("",!0)]),a(e(T)),w.value.length?(n(),m("div",qt,[s("div",Bt,[s("h3",Gt,[a(e(xe),{class:"h-4 w-4"}),p(" Recent Citations ("+i(w.value.length)+") ",1)]),a(e(x),{onClick:me,disabled:A.value,variant:"ghost",size:"sm"},{default:r(()=>[A.value?(n(),g(e(H),{key:0,class:"h-4 w-4 animate-spin"})):(n(),g(e(be),{key:1,class:"h-4 w-4 mr-1"})),t[21]||(t[21]=p(" Clear All ",-1))]),_:1},8,["disabled"])]),s("div",Jt,[(n(!0),m(E,null,M(w.value,o=>(n(),m("div",{key:o.id,class:"rounded border bg-muted/30 p-3 cursor-pointer hover:bg-muted/50 transition-colors",onClick:_=>ae(o)},[s("p",Kt,i(o.title),1),s("p",Qt,i(o.authors.join(", "))+" ("+i(o.year)+") ",1)],8,Wt))),128))])])):y("",!0)])):y("",!0),d.citationOperationMode?y("",!0):(n(),g(e(je),{key:2,class:"border border-border/60 shadow-sm dark:border-border/50 dark:shadow-none transition-all duration-300 hover:shadow-md"},{default:r(()=>[a(e(Me),{open:d.showCitationHelper,"onUpdate:open":Fe},{default:r(()=>[a(e(Re),{class:"w-full"},{default:r(()=>[a(e(ze),{class:"pb-3 transition-colors bg-muted/40 hover:bg-muted/60 dark:bg-transparent dark:hover:bg-muted/30"},{default:r(()=>[a(e(Ae),{class:"flex items-center justify-between text-sm"},{default:r(()=>[s("span",Xt,[a(e(K),{class:"h-4 w-4 text-muted-foreground"}),t[22]||(t[22]=p(" Citation Helper ",-1)),a(e(z),{variant:"secondary",class:"ml-1 text-xs"},{default:r(()=>[p(i(b.value.toUpperCase()),1)]),_:1})]),s("div",Zt,[d.showCitationHelper?(n(),g(e(x),{key:0,onClick:t[5]||(t[5]=oe(o=>v("enter-operation-mode"),["stop"])),variant:"ghost",size:"icon",class:"h-6 w-6 text-muted-foreground hover:text-primary",title:"Expand to Split View"},{default:r(()=>[a(e(nt),{class:"h-3 w-3"})]),_:1})):y("",!0),a(e(ee),{class:U(["h-4 w-4 text-muted-foreground transition-transform",d.showCitationHelper?"rotate-180":""])},null,8,["class"])])]),_:1})]),_:1})]),_:1}),a(e(Le),null,{default:r(()=>[a(e(Se),{class:"space-y-4 pt-0"},{default:r(()=>[s("div",Yt,[s("div",es,[a(e(ne),{class:"h-4 w-4 text-amber-600 dark:text-amber-400 mt-0.5 flex-shrink-0"}),t[23]||(t[23]=s("div",{class:"text-xs leading-relaxed"},[s("p",{class:"font-medium text-amber-900 dark:text-amber-100 mb-1"},"Smart Citation Assistant "),s("p",{class:"text-amber-700 dark:text-amber-300"},"Automatically formats citations in your preferred academic style."),s("p",{class:"mt-1 text-amber-600 dark:text-amber-400"},"ðŸ’¡ Click citations to insert them directly into your document.")],-1))])]),s("div",ts,[s("div",ss,[s("h4",as,[a(e(ne),{class:"h-3 w-3"}),t[24]||(t[24]=p(" Citation Style ",-1))]),s("div",os,[(n(!0),m(E,null,M(Object.keys(se),o=>(n(),g(e(x),{key:o,onClick:_=>b.value=o,variant:b.value===o?"default":"outline",size:"sm",class:"text-xs flex-1"},{default:r(()=>[p(i(o.toUpperCase()),1)]),_:2},1032,["onClick","variant"]))),128))])]),s("div",rs,[s("p",ns,i(G.value.name),1),s("p",ls,i(G.value.description),1),s("p",is,i(G.value.example),1)])]),a(e(T)),s("div",ds,[s("h4",cs,[a(e(we),{class:"h-3 w-3"}),t[25]||(t[25]=p(" Generate Citation ",-1))]),s("div",us,[a(e(ve),{modelValue:S.value,"onUpdate:modelValue":t[6]||(t[6]=o=>S.value=o),placeholder:"Enter URL, DOI, or search term...",class:"text-xs",onKeyup:fe(J,["enter"]),disabled:D.value},null,8,["modelValue","disabled"]),a(e(x),{onClick:J,size:"sm",disabled:D.value||!S.value.trim()},{default:r(()=>[D.value?(n(),g(e(H),{key:0,class:"h-3 w-3 animate-spin"})):(n(),g(e(he),{key:1,class:"h-3 w-3"}))]),_:1},8,["disabled"])]),t[26]||(t[26]=s("p",{class:"text-xs text-muted-foreground"}," ðŸ’¡ Paste a journal URL, DOI, or search for papers by keywords ",-1))]),a(e(T)),s("div",ps,[s("div",ms,[s("h4",fs,[a(e(Q),{class:"h-3 w-3"}),t[27]||(t[27]=p(" Auto-Detect Citations ",-1))])]),a(e(x),{onClick:I,disabled:P.value,variant:"outline",class:"w-full gap-2 bg-gradient-to-r from-purple-500/10 to-indigo-500/10 border-purple-200/50 dark:border-purple-800/50 hover:from-purple-500/20 hover:to-indigo-500/20"},{default:r(()=>[P.value?(n(),g(e(H),{key:0,class:"h-4 w-4 animate-spin"})):(n(),g(e(Q),{key:1,class:"h-4 w-4 text-purple-500"})),s("span",vs,i(P.value?"Scanning content...":"Scan for Missing Citations"),1)]),_:1},8,["disabled"]),t[33]||(t[33]=s("p",{class:"text-xs text-muted-foreground"}," ðŸ” AI analyzes your content to find claims that need academic references ",-1)),l.value&&c.value.length>0?(n(),m("div",xs,[s("div",hs,[s("span",_s,[a(e(_e),{class:"h-3 w-3"}),p(" "+i(c.value.length)+" claims need citations ",1)]),a(e(x),{variant:"ghost",size:"sm",class:"h-6 text-xs",onClick:t[7]||(t[7]=o=>{l.value=!1,c.value=[]})},{default:r(()=>[...t[28]||(t[28]=[p(" Clear ",-1)])]),_:1})]),a(e(ie),{class:"h-[280px]"},{default:r(()=>[s("div",gs,[(n(!0),m(E,null,M(c.value,o=>(n(),m("div",{key:o.id,class:"rounded-lg border bg-background overflow-hidden"},[s("div",{onClick:_=>te(o.id),class:U(["cursor-pointer p-3 hover:bg-muted/30 transition-colors",u.value===o.id?"bg-muted/20":""])},[s("div",bs,[a(e(Xe),{class:U(["h-4 w-4 mt-0.5 text-muted-foreground transition-transform flex-shrink-0",u.value===o.id?"rotate-90":""])},null,8,["class"]),s("div",ks,[s("p",Cs,' "'+i(o.text)+'" ',1),s("p",ws,i(o.reason),1),s("div",$s,[a(e(z),{variant:"outline",class:U(["text-[10px] h-4",o.confidence>.8?"border-red-300 text-red-600":o.confidence>.6?"border-amber-300 text-amber-600":"border-gray-300 text-gray-600"])},{default:r(()=>[p(i(Math.round(o.confidence*100))+"% confidence ",1)]),_:2},1032,["class"]),s("span",js,i(o.suggestions?.length||0)+" suggestions ",1)])])])],10,ys),u.value===o.id&&o.suggestions?.length>0?(n(),m("div",Ss,[t[30]||(t[30]=s("p",{class:"text-[10px] font-medium text-muted-foreground mb-2"}," Suggested Citations: ",-1)),(n(!0),m(E,null,M(o.suggestions,_=>(n(),m("div",{key:_.id,class:"rounded border bg-background p-2 space-y-1"},[s("p",Fs,i(_.title),1),s("p",Ds,i(_.authors?.join(", "))+" ("+i(_.year)+") ",1),s("div",Ps,[a(e(z),{variant:"secondary",class:"text-[9px] h-4"},{default:r(()=>[p(i(_.source),1)]),_:2},1024),_.citation_count?(n(),m("span",Es,i(_.citation_count)+" citations ",1)):y("",!0)]),s("div",Us,[a(e(x),{onClick:W=>de(_,o.text),size:"sm",class:"flex-1 h-7 text-xs"},{default:r(()=>[a(e(X),{class:"h-3 w-3 mr-1"}),t[29]||(t[29]=p(" Insert ",-1))]),_:2},1032,["onClick"]),a(e(x),{onClick:W=>ce(_),size:"sm",variant:"outline",class:"h-7 text-xs"},{default:r(()=>[a(e(Z),{class:"h-3 w-3"})]),_:2},1032,["onClick"]),_.url?(n(),g(e(x),{key:0,onClick:W=>ue(_.url),size:"sm",variant:"outline",class:"h-7 text-xs"},{default:r(()=>[a(e(Ce),{class:"h-3 w-3"})]),_:2},1032,["onClick"])):y("",!0)])]))),128))])):y("",!0),u.value===o.id&&(!o.suggestions||o.suggestions.length===0)?(n(),m("div",zs,[s("p",As,[t[31]||(t[31]=p(" No suggestions found. Try searching manually with keywords: ",-1)),s("span",Ms,i(o.search_keywords?.join(", ")),1)])])):y("",!0)]))),128))])]),_:1})])):l.value&&c.value.length===0&&!P.value?(n(),m("div",Rs,[...t[32]||(t[32]=[s("p",{class:"text-xs text-green-600 dark:text-green-400"}," âœ… No claims requiring citations were detected! ",-1)])])):y("",!0)]),w.value.length?(n(),m("div",Ls,[a(e(T)),s("div",Is,[s("h4",Os,[a(e(xe),{class:"h-3 w-3"}),p(" Recent Citations ("+i(w.value.length)+") ",1)]),a(e(x),{onClick:me,disabled:A.value,variant:"ghost",size:"icon",class:"h-6 w-6 hover:bg-destructive/10 hover:text-destructive"},{default:r(()=>[A.value?(n(),g(e(H),{key:0,class:"h-3 w-3 animate-spin"})):(n(),g(e(be),{key:1,class:"h-3 w-3"}))]),_:1},8,["disabled"])]),a(e(ie),{class:"h-[300px]"},{default:r(()=>[s("div",Ts,[(n(!0),m(E,null,M(w.value,o=>(n(),m("div",{key:o.id,class:"group"},[s("div",{onClick:_=>De(o.id),class:U(["cursor-pointer rounded-lg border bg-background p-3 hover:bg-muted/30 transition-colors",O.value===o.id?"ring-2 ring-primary":""])},[s("div",Ns,[s("div",Vs,[s("p",qs,i(o.title),1),s("p",Bs,i(o.authors.join(", "))+" ("+i(o.year)+") ",1),s("div",Gs,[a(e(z),{variant:"outline",class:"text-xs"},{default:r(()=>[p(i(o.type),1)]),_:2},1024),s("span",Js,i(o.createdAt.toLocaleDateString()),1)])]),s("div",Ws,[a(e(x),{onClick:oe(_=>ae(o),["stop"]),variant:"ghost",size:"icon",class:"h-6 w-6"},{default:r(()=>[a(e(X),{class:"h-3 w-3"})]),_:2},1032,["onClick"]),a(e(x),{onClick:oe(_=>pe(o),["stop"]),variant:"ghost",size:"icon",class:"h-6 w-6"},{default:r(()=>[a(e(Z),{class:"h-3 w-3"})]),_:2},1032,["onClick"])])]),O.value===o.id?(n(),m("div",Ks,[s("div",Qs,[s("p",Xs,i(b.value.toUpperCase())+" Format: ",1),s("p",Zs,i(o.style[b.value]),1)]),s("div",Ys,[a(e(x),{onClick:_=>ae(o),size:"sm",class:"flex-1 text-xs"},{default:r(()=>[a(e(X),{class:"mr-1 h-3 w-3"}),t[34]||(t[34]=p(" Insert ",-1))]),_:2},1032,["onClick"]),a(e(x),{onClick:_=>pe(o),size:"sm",variant:"outline",class:"flex-1 text-xs"},{default:r(()=>[a(e(Z),{class:"mr-1 h-3 w-3"}),t[35]||(t[35]=p(" Copy ",-1))]),_:2},1032,["onClick"])])])):y("",!0)],10,Hs)]))),128))])]),_:1})])):(n(),m("div",ea,[a(e(K),{class:"mx-auto h-12 w-12 text-muted-foreground/30 mb-3"}),t[36]||(t[36]=s("p",{class:"text-xs text-muted-foreground mb-1"}," No citations yet ",-1)),t[37]||(t[37]=s("p",{class:"text-xs text-muted-foreground/80"}," Generate your first citation using the search above ",-1))]))]),_:1})]),_:1})]),_:1},8,["open"])]),_:1})),a(e(Ie),{open:R.value,"onUpdate:open":t[9]||(t[9]=o=>R.value=o)},{default:r(()=>[a(e(Oe),null,{default:r(()=>[a(e(Te),null,{default:r(()=>[a(e(He),null,{default:r(()=>[...t[38]||(t[38]=[p("Clear All Citations",-1)])]),_:1}),a(e(Ne),null,{default:r(()=>[p(" Are you sure you want to clear all "+i(w.value.length)+" citations? This action cannot be undone and will permanently remove all citations from your library. ",1)]),_:1})]),_:1}),a(e(Ve),null,{default:r(()=>[a(e(qe),{onClick:t[8]||(t[8]=o=>R.value=!1)},{default:r(()=>[...t[39]||(t[39]=[p("Cancel",-1)])]),_:1}),a(e(Be),{onClick:Pe,class:"bg-destructive text-destructive-foreground hover:bg-destructive/90"},{default:r(()=>[...t[40]||(t[40]=[p(" Clear All Citations ",-1)])]),_:1})]),_:1})]),_:1})]),_:1},8,["open"])],64))}}),ta={class:"inline-flex"},sa={class:"space-y-4"},aa={class:"flex items-center justify-between"},oa={class:"flex items-center gap-2 text-sm text-muted-foreground"},ra={class:"flex items-center gap-2"},na={class:"space-y-2"},la={class:"flex items-start gap-3"},ia={class:"flex-1 min-w-0"},da={class:"flex items-center gap-2 mb-1"},ca={class:"font-medium truncate"},ua={class:"flex items-center gap-4 text-sm text-muted-foreground"},pa={key:0},Ba=$e({__name:"ExportMenu",props:{project:{},currentChapter:{},allChapters:{},triggerElement:{default:"button"},size:{default:"default"},variant:{default:"outline"},buttonClass:{default:""}},setup(V){const j=V,h=k(!1),v=k([]),b=Y(()=>j.allChapters.filter(c=>c.content&&c.content.trim().length>0)),S=Y(()=>v.value.length),D=Y(()=>j.allChapters.filter(c=>v.value.includes(c.chapter_number)).reduce((c,l)=>c+l.word_count,0)),A=async()=>{f.loading("Generating project PDF...",{id:"export-project-pdf"});const c=re("export.project.pdf",{project:j.project.slug});try{const l=await fetch(c,{method:"GET",headers:{Accept:"application/pdf"}});if(l.ok){const u=l.headers.get("content-type");if(u&&u.includes("application/json")){const L=await l.json();f.error("Export Failed",{id:"export-project-pdf",description:L.message||"An error occurred during PDF export."});return}const F=await l.blob(),$=window.URL.createObjectURL(F),C=document.createElement("a");C.href=$,C.download=`${j.project.slug}_full_project.pdf`,document.body.appendChild(C),C.click(),document.body.removeChild(C),window.URL.revokeObjectURL($),f.success("Project PDF exported successfully!",{id:"export-project-pdf",description:`${j.project.title} has been downloaded as PDF.`})}else try{const u=await l.json();f.error("Export Failed",{id:"export-project-pdf",description:u.message||"An error occurred during PDF export."})}catch{f.error("Export Failed",{id:"export-project-pdf",description:"Unable to export project as PDF. Please try again."})}}catch{f.error("Export Failed",{id:"export-project-pdf",description:"Network error occurred. Please check your connection and try again."})}},R=async()=>{if(v.value.length===0){f.error("No chapters selected",{description:"Please select at least one chapter to export."});return}try{f.loading(`Exporting ${v.value.length} chapters...`,{id:"export-chapters"});const c=re("export.chapters.word",{project:j.project.slug}),l=new FormData;v.value.forEach($=>{l.append("chapters[]",$.toString())});const u=document.querySelector('meta[name="csrf-token"]')?.getAttribute("content");u&&l.append("_token",u);const F=await fetch(c,{method:"POST",body:l,headers:{Accept:"application/json"}});if(F.ok){const $=F.headers.get("content-type");if($&&$.includes("application/json")){const te=await F.json();f.error("Export Failed",{id:"export-chapters",description:te.message||"An error occurred during export."});return}const C=await F.blob(),L=window.URL.createObjectURL(C),I=document.createElement("a");I.href=L,I.download=`${j.project.slug}-chapters-${v.value.join("-")}.docx`,document.body.appendChild(I),I.click(),document.body.removeChild(I),window.URL.revokeObjectURL(L),f.success("Selected chapters exported successfully!",{id:"export-chapters",description:`${v.value.length} chapters exported to Word.`}),v.value=[],h.value=!1}else try{const $=await F.json();f.error("Export Failed",{id:"export-chapters",description:$.message||"An error occurred during export."})}catch{f.error("Export Failed",{id:"export-chapters",description:"Unable to export selected chapters. Please try again."})}}catch{f.error("Export Failed",{id:"export-chapters",description:"Network error occurred. Please check your connection and try again."})}},w=c=>{const l=v.value.indexOf(c);l>-1?v.value.splice(l,1):v.value.push(c)},O=()=>{v.value=b.value.map(c=>c.chapter_number)},P=()=>{v.value=[]},B=async()=>{f.loading("Generating PDF...",{id:"export-chapter-pdf"});const c=re("export.chapter.pdf",{project:j.project.slug,chapterNumber:j.currentChapter.chapter_number});try{const l=await fetch(c,{method:"GET",headers:{Accept:"application/pdf"}});if(l.ok){const u=l.headers.get("content-type");if(u&&u.includes("application/json")){const L=await l.json();f.error("Export Failed",{id:"export-chapter-pdf",description:L.message||"An error occurred during PDF export."});return}const F=await l.blob(),$=window.URL.createObjectURL(F),C=document.createElement("a");C.href=$,C.download=`chapter_${j.currentChapter.chapter_number}_${j.currentChapter.title.toLowerCase().replace(/\s+/g,"_")}.pdf`,document.body.appendChild(C),C.click(),document.body.removeChild(C),window.URL.revokeObjectURL($),f.success("PDF exported successfully!",{id:"export-chapter-pdf",description:`${j.currentChapter.title} has been downloaded as PDF.`})}else try{const u=await l.json();f.error("Export Failed",{id:"export-chapter-pdf",description:u.message||"An error occurred during PDF export."})}catch{f.error("Export Failed",{id:"export-chapter-pdf",description:"Unable to export chapter as PDF. Please try again."})}}catch{f.error("Export Failed",{id:"export-chapter-pdf",description:"Network error occurred. Please check your connection and try again."})}};return(c,l)=>(n(),m("div",ta,[a(e(Je),null,{default:r(()=>[a(e(We),{asChild:""},{default:r(()=>[a(e(x),{variant:c.variant,size:c.size,class:U(["gap-2",c.buttonClass])},{default:r(()=>[c.triggerElement==="button"?(n(),m(E,{key:0},[a(e(le),{class:"h-4 w-4"}),l[2]||(l[2]=p(" Export ",-1)),a(e(ee),{class:"h-3 w-3"})],64)):(n(),g(e(le),{key:1,class:"h-4 w-4"}))]),_:1},8,["variant","size","class"])]),_:1}),a(e(Ke),{align:"end",class:"w-64"},{default:r(()=>[a(e(ge),null,{default:r(()=>[...l[3]||(l[3]=[p("Current Chapter",-1)])]),_:1}),a(e(ye),{onClick:B,class:"gap-2"},{default:r(()=>[a(e(ke),{class:"h-4 w-4"}),l[4]||(l[4]=s("div",{class:"flex flex-col"},[s("span",{class:"font-medium"},"Export as PDF"),s("span",{class:"text-xs text-muted-foreground"}," Professional academic format ")],-1))]),_:1}),a(e(Qe)),a(e(ge),null,{default:r(()=>[...l[5]||(l[5]=[p("Full Project",-1)])]),_:1}),a(e(ye),{onClick:A,class:"gap-2"},{default:r(()=>[a(e(ke),{class:"h-4 w-4"}),l[6]||(l[6]=s("div",{class:"flex flex-col"},[s("span",{class:"font-medium"},"Export as PDF"),s("span",{class:"text-xs text-muted-foreground"}," Professional academic format with cover page ")],-1))]),_:1})]),_:1})]),_:1}),a(e(Ye),{open:h.value,"onUpdate:open":l[1]||(l[1]=u=>h.value=u)},{default:r(()=>[a(e(et),{class:"max-w-2xl"},{default:r(()=>[a(e(tt),null,{default:r(()=>[a(e(st),{class:"flex items-center gap-2"},{default:r(()=>[a(e(rt),{class:"h-5 w-5"}),l[7]||(l[7]=p(" Select Chapters to Export ",-1))]),_:1}),a(e(at),null,{default:r(()=>[...l[8]||(l[8]=[p(" Choose which chapters you want to include in your Word export. Only chapters with content can be exported. ",-1)])]),_:1})]),_:1}),s("div",sa,[s("div",aa,[s("div",oa,[s("span",null,i(S.value)+" of "+i(b.value.length)+" chapters selected",1),D.value>0?(n(),g(e(z),{key:0,variant:"outline",class:"text-xs"},{default:r(()=>[p(i(D.value.toLocaleString())+" words ",1)]),_:1})):y("",!0)]),s("div",ra,[a(e(x),{onClick:O,variant:"ghost",size:"sm"},{default:r(()=>[...l[9]||(l[9]=[p(" Select All ",-1)])]),_:1}),a(e(x),{onClick:P,variant:"ghost",size:"sm"},{default:r(()=>[...l[10]||(l[10]=[p(" Clear ",-1)])]),_:1})])]),a(e(T)),a(e(ie),{class:"h-[300px]"},{default:r(()=>[s("div",na,[(n(!0),m(E,null,M(b.value,u=>(n(),g(e(je),{key:u.id,class:U(["cursor-pointer transition-colors hover:bg-muted/50",{"ring-2 ring-primary":v.value.includes(u.chapter_number),"bg-muted/30":v.value.includes(u.chapter_number)}]),onClick:F=>w(u.chapter_number)},{default:r(()=>[a(e(Se),{class:"p-4"},{default:r(()=>[s("div",la,[a(e(Ze),{checked:v.value.includes(u.chapter_number),"onUpdate:checked":F=>w(u.chapter_number),class:"mt-1"},null,8,["checked","onUpdate:checked"]),s("div",ia,[s("div",da,[s("h4",ca," Chapter "+i(u.chapter_number)+": "+i(u.title),1),a(e(z),{variant:u.status==="approved"?"default":"secondary",class:"text-xs"},{default:r(()=>[p(i(u.status.replace("_"," ")),1)]),_:2},1032,["variant"])]),s("div",ua,[s("span",null,i(u.word_count.toLocaleString())+" words",1),u.word_count>0?(n(),m("span",pa,i(Math.ceil(u.word_count/250))+" pages approx. ",1)):y("",!0)])])])]),_:2},1024)]),_:2},1032,["class","onClick"]))),128))])]),_:1})]),a(e(ot),null,{default:r(()=>[a(e(x),{onClick:l[0]||(l[0]=u=>h.value=!1),variant:"outline"},{default:r(()=>[...l[11]||(l[11]=[p(" Cancel ",-1)])]),_:1}),a(e(x),{onClick:R,disabled:S.value===0,class:"gap-2"},{default:r(()=>[a(e(le),{class:"h-4 w-4"}),p(" Export "+i(S.value)+" Chapter"+i(S.value===1?"":"s"),1)]),_:1},8,["disabled"])]),_:1})]),_:1})]),_:1},8,["open"])]))}});function Ga(V="",j=50){const h=k([V]),v=k(0);return{contentHistory:h,historyIndex:v,addToHistory:w=>{h.value[v.value]!==w&&(h.value=h.value.slice(0,v.value+1),h.value.push(w),h.value.length>j?h.value.shift():v.value++)},undo:()=>v.value>0?(v.value--,h.value[v.value]):null,redo:()=>v.value<h.value.length-1?(v.value++,h.value[v.value]):null,canUndo:()=>v.value>0,canRedo:()=>v.value<h.value.length-1}}export{nt as M,Va as P,we as W,Ba as _,Na as a,qa as b,Ga as u};
