import{u as k,i as M,b as L,d as B,T as H,F as S,e as R,f as W,g as y,h as E,k as F}from"./vendor-tiptap-DuG0yIO_.js";import{M as I}from"./MermaidExtension-C8Xh9spG.js";import{bu as j,ff as q,bt as z,bB as V,ci as A,bC as N,cB as P,co as U,cq as D,bF as v,fw as G}from"./vendor-BJBNFzu6.js";import{_ as J}from"./_plugin-vue_export-helper-DlAUqK2U.js";const K={class:"bg-background"},O=j({__name:"RichTextViewer",props:{content:{},showFontControls:{type:Boolean,default:!0},viewerClass:{default:"prose-sm"}},setup(T){const C=q(G),g=T,f=t=>t?(t=t.replace(/```mermaid\n?([\s\S]*?)```/g,(a,e)=>{const r=e.trim();return`<div data-mermaid data-mermaid-code="${r.replace(/&/g,"&amp;").replace(/"/g,"&quot;").replace(/</g,"&lt;").replace(/>/g,"&gt;")}" data-view-mode="diagram"><pre><code class="language-mermaid">${r}</code></pre></div>`}),t=t.replace(/``mermaid\n?([\s\S]*?)``/g,(a,e)=>{const r=e.trim();return`<div data-mermaid data-mermaid-code="${r.replace(/&/g,"&amp;").replace(/"/g,"&quot;").replace(/</g,"&lt;").replace(/>/g,"&gt;")}" data-view-mode="diagram"><pre><code class="language-mermaid">${r}</code></pre></div>`}),t=t.replace(/`mermaid\n([\s\S]*?)`/g,(a,e)=>{const r=e.trim();return`<div data-mermaid data-mermaid-code="${r.replace(/&/g,"&amp;").replace(/"/g,"&quot;").replace(/</g,"&lt;").replace(/>/g,"&gt;")}" data-view-mode="diagram"><pre><code class="language-mermaid">${r}</code></pre></div>`}),t):"",b=t=>t?(t=t.replace(/```(\w+)\n?([\s\S]*?)```/g,(a,e,r)=>`<pre><code class="language-${e}">${r.trim()}</code></pre>`),t=t.replace(/```\n?([\s\S]*?)```/g,(a,e)=>`<pre><code>${e.trim()}</code></pre>`),t):"",w=t=>{if(!t)return"";const a=t.split(`
`);let e=[],r=0;for(;r<a.length;){const s=a[r];if(s.includes("|")){const n=_(a,r);if(n.html){e.push(n.html),r=n.nextIndex;continue}}e.push(s),r++}return e.join(`
`)},_=(t,a)=>{let e=t[a];if(!e||!e.includes("|"))return{html:null,nextIndex:a+1};const r=e.split("|").map(c=>c.trim()).filter(c=>c.length>0);if(r.length===0)return{html:null,nextIndex:a+1};const s=t[a+1];if(!s||!s.includes("|")||!s.includes("-"))return{html:null,nextIndex:a+1};let n=[],p=a+2;for(;p<t.length;){const c=t[p];if(!c||!c.includes("|"))break;const m=c.split("|").map(l=>l.trim()).filter(l=>l.length>0);m.length>0&&n.push(m),p++}let o='<div class="tableWrapper"><table>';return o+="<thead><tr>",r.forEach(c=>{o+=`<th>${c}</th>`}),o+="</tr></thead>",n.length>0&&(o+="<tbody>",n.forEach(c=>{o+="<tr>";for(let m=0;m<r.length;m++){const l=c[m]||"";o+=`<td>${l}</td>`}o+="</tr>"}),o+="</tbody>"),o+="</table></div>",{html:o,nextIndex:p}},$=t=>{if(!t)return"";if(t.includes("<p>")||t.includes("<h1>")||t.includes("<h2>")||t.includes("<div>")){let s=f(t);return s=b(s),s}let e=t;return e=f(e),e=b(e),e=e.replace(/^#### (.*$)/gim,"<h4>$1</h4>"),e=e.replace(/^### (.*$)/gim,"<h3>$1</h3>"),e=e.replace(/^## (.*$)/gim,"<h2>$1</h2>"),e=e.replace(/^# (.*$)/gim,"<h1>$1</h1>"),e=e.replace(/\*\*(.*?)\*\*/g,"<strong>$1</strong>"),e=e.replace(/(?<!\*)\*([^*\n]+?)\*(?!\*)/g,"<em>$1</em>"),e=e.replace(/`([^`]+)`/g,"<code>$1</code>"),e=w(e),e.split(/\n\s*\n/).filter(s=>s.trim()).map(s=>{const n=s.trim();if(n.startsWith("<h1>")||n.startsWith("<h2>")||n.startsWith("<h3>")||n.startsWith("<h4>"))return n;if(n.includes(`
`)){const o=n.split(`
`).map(l=>l.trim()).filter(l=>l),c=o.some(l=>l.match(/^\d+\.\s/)),m=o.some(l=>l.match(/^[-*]\s/));if(c||m){const l=o.map(i=>i.match(/^\d+\.\s/)?`<li>${i.replace(/^\d+\.\s/,"")}</li>`:i.match(/^[-*]\s/)?`<li>${i.replace(/^[-*]\s/,"")}</li>`:i);let h=[],u="";for(const i of l)i.startsWith("<li>")?(u&&h.push(u),u=i):u&&(u=u.replace("</li>",` ${i}</li>`));return u&&h.push(u),c?`<ol>${h.join("")}</ol>`:`<ul>${h.join("")}</ul>`}}return`<p>${n.replace(/\n/g,"<br>")}</p>`}).join("")},d=k({content:$(g.content),editable:!1,extensions:[M.configure({heading:{levels:[1,2,3]},codeBlock:!1}),L.configure({lowlight:C,HTMLAttributes:{class:"code-block-highlighted"}}),B,H,S,R.configure({resizable:!0}),W,y,E,I],editorProps:{attributes:{class:`prose dark:prose-invert max-w-none focus:outline-none ${g.viewerClass}`}}});return z("11.5"),V(()=>{setTimeout(()=>{d.value&&d.value.chain().selectAll().setFontSize("11.5pt").run()},100)}),A(()=>g.content,t=>{if(d.value&&d.value.getHTML()!==t){const a=$(t);d.value.commands.setContent(a)}}),N(()=>{d.value&&d.value.destroy()}),(t,a)=>(U(),P("div",K,[D(v(F),{editor:v(d)},null,8,["editor"])]))}}),x=J(O,[["__scopeId","data-v-a53f8007"]]);export{x as R};
