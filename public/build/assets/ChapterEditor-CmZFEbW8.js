const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/AISidebar-Dplm4LTi.js","assets/app-BI3B-WKV.js","assets/app-Btn_0iDD.css","assets/index-G9NCJgAI.js","assets/CardContent.vue_vue_type_script_setup_true_lang-Crb8HVKN.js","assets/CardTitle.vue_vue_type_script_setup_true_lang-DyR4agyE.js","assets/CollapsibleTrigger.vue_vue_type_script_setup_true_lang-Dx8cI0f1.js","assets/VisuallyHidden-WCocV3L8.js","assets/useForwardExpose-DM1p2FeE.js","assets/Separator.vue_vue_type_script_setup_true_lang-D3LZYNkd.js","assets/Separator-07uq3TSH.js","assets/Progress.vue_vue_type_script_setup_true_lang-UmgO_cJx.js","assets/nullish-CHIgUVhi.js","assets/Sonner.vue_vue_type_script_setup_true_lang-CCODHGN7.js","assets/DropdownMenuTrigger.vue_vue_type_script_setup_true_lang-BNjDpoNs.js","assets/triangle-alert-BySPhGmw.js","assets/circle-check-NO4dix3F.js","assets/CitationHelper.vue_vue_type_script_setup_true_lang-BhkgcmXf.js","assets/index-BVhQ2dbN.js","assets/Input.vue_vue_type_script_setup_true_lang-BHHItLpI.js","assets/useTextHistory-B0VbbFoI.js","assets/RichTextEditor-BaUnNdYI.js","assets/_plugin-vue_export-helper-DlAUqK2U.js","assets/step-BCSb7vJg.js","assets/DialogTitle.vue_vue_type_script_setup_true_lang-P43XVmo9.js","assets/Label.vue_vue_type_script_setup_true_lang-cISHM6IV.js","assets/type-Oxu0sV8-.js","assets/minus-BOlAe1oo.js","assets/list-Cx4tOFEw.js","assets/RichTextEditor-BDJ8Kfyb.css","assets/Checkbox.vue_vue_type_script_setup_true_lang-egSxNP0e.js","assets/ohash.D__AXeF1-C-E83dC9.js","assets/VisuallyHiddenInput-tdmgkkWj.js","assets/RovingFocusItem-DDCGRq06.js","assets/check-Dz3DOZKS.js","assets/useNonce-qa2o0k4f.js","assets/download-D5k4AGhu.js","assets/chevron-down-DmZrO0N0.js","assets/file-text-BAYJU_zM.js","assets/useTextHistory-BWcwai4o.css","assets/AlertDialogTitle.vue_vue_type_script_setup_true_lang-IvPGnnA0.js","assets/wand-sparkles-PPRn2mw8.js","assets/search-D3ywZ6hb.js","assets/trash-2-Ou0MLSoD.js","assets/copy-CaM9jdPt.js","assets/brain-CJEwxkqj.js","assets/zap-YtsEHZ04.js","assets/pen-tool-owDBRNiM.js","assets/refresh-cw-CAHrnovz.js","assets/sparkles-DDvjZHSj.js","assets/AISidebar-Ymbz_oju.css","assets/ChapterNavigation-DuiNzgIE.js","assets/ChapterNavigation.vue_vue_type_script_setup_true_lang-BGC02WH-.js","assets/DialogTrigger-ObIfqcY6.js","assets/chevron-right-Bxrlt0jD.js","assets/circle-check-big-BXcMOQn9.js","assets/lock-BRCV1ECq.js","assets/target-V7FSW6wF.js","assets/MobileNavOverlay-DlmuhQmM.js","assets/index-CVRpcFQ1.js","assets/DefensePreparationPanel.vue_vue_type_script_setup_true_lang--6-1649O.js","assets/thumbs-up-DQhRumkT.js","assets/lightbulb-CqKhF--C.js","assets/circle-alert-DGbsf_S3.js","assets/DataCollectionPanel.vue_vue_type_script_setup_true_lang-ByJaL6x6.js","assets/MobileNavOverlay-CN-XSdXy.css","assets/ChatModeLayout-CYI3_Ihr.js","assets/ChatModeLayout.vue_vue_type_script_setup_true_lang-DJQ_Zk9J.js","assets/loader-BuzQSvwA.js","assets/message-square-96bMajCQ.js","assets/chevron-left-qwk35q5J.js","assets/clock-B07YaaH8.js","assets/rotate-ccw-FE4eaL6D.js","assets/chart-column-C-E7FS4O.js","assets/eye-BiVsesPM.js","assets/ChatModeLayout-wjQGykpm.css","assets/CitationVerificationLayout-Dai6hmMa.js","assets/DefensePreparationPanel-CcXjnQTV.js","assets/DataCollectionPanel-Bcn7Ovgx.js"])))=>i.map(i=>d[i]);
import{ah as Yr,ab as Zr,d as pr,g as A,c as G,y as ce,o as y,u as t,w as o,k as s,e as r,s as N,n as oe,t as g,a as L,F as xt,z as _t,Q as Ne,E as c,D as Be,O as we,S as ne,h as at,p as st,j as ea,ai as $e,R as nt,V as Yt,aj as ot,b as Me,f as Fe,ak as Re}from"./app-BI3B-WKV.js";import{_ as Se}from"./index-BVhQ2dbN.js";import{_ as I}from"./index-G9NCJgAI.js";import{_ as Ct,a as St}from"./CardContent.vue_vue_type_script_setup_true_lang-Crb8HVKN.js";import{_ as Et,a as vr}from"./CardTitle.vue_vue_type_script_setup_true_lang-DyR4agyE.js";import{_ as Zt}from"./Input.vue_vue_type_script_setup_true_lang-BHHItLpI.js";import{_ as mt}from"./Label.vue_vue_type_script_setup_true_lang-cISHM6IV.js";import{_ as gr}from"./Progress.vue_vue_type_script_setup_true_lang-UmgO_cJx.js";import{B as Je,u as ta,M as er,a as bt,R as tr,b as ra,P as aa,c as sa,d as na,e as oa,_ as rr}from"./useTextHistory-B0VbbFoI.js";import{_ as re,a as ae,b as se}from"./UserInfo.vue_vue_type_script_setup_true_lang-DN1JgSYv.js";import{_ as la,a as ia}from"./AppLayout.vue_vue_type_script_setup_true_lang-DhTOwKc2.js";import{t as E}from"./Sonner.vue_vue_type_script_setup_true_lang-CCODHGN7.js";import{T as ua}from"./trending-up-DZh0NPgQ.js";import{C as ca}from"./circle-alert-DGbsf_S3.js";import{ar,aq as sr}from"./RichTextEditor-BaUnNdYI.js";import{t as nr}from"./toNumber-DIz-d-o5.js";import{A as or}from"./arrow-left-CfMQWqqv.js";import{B as lt}from"./brain-CJEwxkqj.js";import{T as lr}from"./target-V7FSW6wF.js";import{M as ir,S as ur}from"./sun-R-lryDIY.js";import{E as wt}from"./eye-BiVsesPM.js";import{C as cr}from"./circle-check-big-BXcMOQn9.js";import{M as da}from"./message-square-96bMajCQ.js";import{P as pa}from"./pen-tool-owDBRNiM.js";import"./useForwardExpose-DM1p2FeE.js";import"./VisuallyHidden-WCocV3L8.js";import"./nullish-CHIgUVhi.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";import"./Checkbox.vue_vue_type_script_setup_true_lang-egSxNP0e.js";import"./ohash.D__AXeF1-C-E83dC9.js";import"./VisuallyHiddenInput-tdmgkkWj.js";import"./RovingFocusItem-DDCGRq06.js";import"./minus-BOlAe1oo.js";import"./check-Dz3DOZKS.js";import"./DialogTitle.vue_vue_type_script_setup_true_lang-P43XVmo9.js";import"./DropdownMenuTrigger.vue_vue_type_script_setup_true_lang-BNjDpoNs.js";import"./useNonce-qa2o0k4f.js";import"./Separator.vue_vue_type_script_setup_true_lang-D3LZYNkd.js";import"./Separator-07uq3TSH.js";import"./download-D5k4AGhu.js";import"./chevron-down-DmZrO0N0.js";import"./file-text-BAYJU_zM.js";import"./AppLogoIcon.vue_vue_type_script_setup_true_lang-C5zVXWfQ.js";import"./chevron-right-Bxrlt0jD.js";import"./triangle-alert-BySPhGmw.js";import"./circle-check-NO4dix3F.js";import"./step-BCSb7vJg.js";import"./type-Oxu0sV8-.js";import"./list-Cx4tOFEw.js";var yt=function(){return Yr.Date.now()},va="Expected a function",ga=Math.max,ha=Math.min;function fa(D,S,$){var M,h,d,b,v,l,_=0,m=!1,O=!1,T=!0;if(typeof D!="function")throw new TypeError(va);S=nr(S)||0,Zr($)&&(m=!!$.leading,O="maxWait"in $,d=O?ga(nr($.maxWait)||0,S):d,T="trailing"in $?!!$.trailing:T);function p(f){var V=M,Q=h;return M=h=void 0,_=f,b=D.apply(Q,V),b}function R(f){return _=f,v=setTimeout(J,S),m?p(f):b}function U(f){var V=f-l,Q=f-_,te=S-V;return O?ha(te,d-Q):te}function K(f){var V=f-l,Q=f-_;return l===void 0||V>=S||V<0||O&&Q>=d}function J(){var f=yt();if(K(f))return pe(f);v=setTimeout(J,U(f))}function pe(f){return v=void 0,T&&M?p(f):(M=h=void 0,b)}function ye(){v!==void 0&&clearTimeout(v),_=0,M=l=h=v=void 0}function ve(){return v===void 0?b:pe(yt())}function ge(){var f=yt(),V=K(f);if(M=arguments,h=this,l=f,V){if(v===void 0)return R(l);if(O)return clearTimeout(v),v=setTimeout(J,S),p(l)}return v===void 0&&(v=setTimeout(J,S)),b}return ge.cancel=ye,ge.flush=ve,ge}const ma={class:"flex items-center justify-between mb-3"},ba={class:"flex items-center gap-3"},wa={class:"p-2 rounded-lg bg-blue-500/10"},ya={class:"text-right"},xa={class:"space-y-2"},_a={class:"flex justify-between items-center text-xs"},Ca={class:"relative"},Sa={key:0},Ea={class:"space-y-3"},ka={class:"flex-1"},Ta={class:"text-sm font-medium"},Aa={class:"text-xs text-muted-foreground"},$a={class:"w-20 h-2 bg-muted rounded-full overflow-hidden ml-3"},Ra={key:1},qa={class:"space-y-2"},Pa={class:"flex-1"},ja={class:"text-sm font-medium"},Da={class:"text-xs text-muted-foreground"},Ma={key:2,class:"flex items-center justify-center gap-3 p-4 rounded-lg bg-blue-50/50 border border-blue-200/50"},Fa={key:3,class:"text-center p-4 rounded-lg bg-muted/30"},dr=pr({__name:"WritingStatistics",props:{showStatistics:{type:Boolean},currentWordCount:{},writingStats:{},qualityAnalysis:{},isAnalyzing:{type:Boolean}},setup(D){const S=D;A(()=>{if(!S.qualityAnalysis?.quality_level)return"text-muted-foreground";switch(S.qualityAnalysis.quality_level){case"Excellent":return"text-green-600";case"Good":return"text-blue-600";case"Satisfactory":return"text-yellow-600";case"Needs Improvement":return"text-orange-600";case"Poor":return"text-red-600";default:return"text-muted-foreground"}});const $=A(()=>S.qualityAnalysis?.scores?Object.entries(S.qualityAnalysis.scores).filter(([,h])=>h.max>0).filter(([,h])=>h.percentage<75).sort(([,h],[,d])=>h.percentage-d.percentage).map(([h,d])=>({category:h.replace(" & "," & "),percentage:Math.round(d.percentage),score:d.score,max:d.max,status:d.percentage<40?"poor":d.percentage<60?"needs-work":"fair"})):[]),M=A(()=>{const h=S.qualityAnalysis?.total_score||0;return h>=80?{text:"Excellent",color:"text-green-600",bgColor:"bg-green-50"}:h>=70?{text:"Satisfactory",color:"text-yellow-600",bgColor:"bg-yellow-50"}:h>=60?{text:"Needs Work",color:"text-orange-600",bgColor:"bg-orange-50"}:{text:"Poor",color:"text-red-600",bgColor:"bg-red-50"}});return(h,d)=>h.showStatistics?(y(),G(t(Ct),{key:0,class:"border border-border/50 bg-gradient-to-br from-card/80 to-card/60 backdrop-blur-sm shadow-lg"},{default:o(()=>[h.qualityAnalysis?(y(),G(t(Et),{key:0,class:"pb-4 border-b border-border/50"},{default:o(()=>[r("div",ma,[r("div",ba,[r("div",wa,[s(t(Je),{class:"h-4 w-4 text-blue-600"})]),r("div",null,[s(t(vr),{class:"text-sm font-semibold"},{default:o(()=>[...d[0]||(d[0]=[N("Academic Quality",-1)])]),_:1}),d[1]||(d[1]=r("p",{class:"text-xs text-muted-foreground"},"AI-powered analysis",-1))])]),r("div",ya,[r("div",{class:oe(["text-2xl font-bold",M.value.color])},[N(g(h.qualityAnalysis.total_score),1),d[2]||(d[2]=r("span",{class:"text-sm text-muted-foreground"},"/100",-1))],2),s(t(Se),{class:oe([[M.value.color,M.value.bgColor],"text-xs font-medium"]),variant:"outline"},{default:o(()=>[N(g(M.value.text),1)]),_:1},8,["class"])])]),r("div",xa,[r("div",_a,[d[3]||(d[3]=r("span",{class:"text-muted-foreground"},"Overall Score",-1)),r("span",{class:oe(["font-medium",h.qualityAnalysis.meets_threshold?"text-green-600":"text-orange-600"])},g(h.qualityAnalysis.meets_threshold?"Meets threshold ‚úì":"Below 80% threshold"),3)]),r("div",Ca,[s(t(gr),{"model-value":Math.round(h.qualityAnalysis.total_score||0),class:oe(["h-2",{"[&>[data-slot=progress-indicator]]:bg-green-500":(h.qualityAnalysis.total_score||0)>=80,"[&>[data-slot=progress-indicator]]:bg-yellow-500":(h.qualityAnalysis.total_score||0)>=70&&(h.qualityAnalysis.total_score||0)<80,"[&>[data-slot=progress-indicator]]:bg-orange-500":(h.qualityAnalysis.total_score||0)>=60&&(h.qualityAnalysis.total_score||0)<70,"[&>[data-slot=progress-indicator]]:bg-red-500":(h.qualityAnalysis.total_score||0)<60}])},null,8,["model-value","class"]),d[4]||(d[4]=r("div",{class:"absolute inset-0 flex items-center justify-center"},[r("div",{class:"w-0.5 h-4 bg-orange-400/60 rounded-full",style:{"margin-left":"80%"}})],-1))])])]),_:1})):ce("",!0),s(t(St),{class:"p-4 space-y-4"},{default:o(()=>[h.qualityAnalysis?.scores?(y(),L("div",Sa,[d[5]||(d[5]=r("h4",{class:"text-xs font-semibold text-muted-foreground mb-3 flex items-center gap-2"},[r("div",{class:"w-1 h-4 bg-green-500 rounded-full"}),N(" Analysis Results ")],-1)),r("div",Ea,[(y(!0),L(xt,null,_t(Object.entries(h.qualityAnalysis.scores).filter(([,b])=>b.max>0),([b,v])=>(y(),L("div",{key:b,class:"flex items-center justify-between p-3 rounded-lg bg-muted/30 hover:bg-muted/40 transition-colors"},[r("div",ka,[r("div",Ta,g(b),1),r("div",Aa,[N(g(v.score)+"/"+g(v.max)+" points ",1),r("span",{class:oe(["ml-1",{"text-red-500":v.percentage<50,"text-orange-500":v.percentage>=50&&v.percentage<75,"text-blue-500":v.percentage>=75&&v.percentage<90,"text-green-500":v.percentage>=90}])}," ("+g(Math.round(v.percentage))+"%) ",3)])]),r("div",$a,[r("div",{class:oe(["h-full transition-all duration-500 rounded-full",{"bg-red-500":v.percentage<50,"bg-orange-500":v.percentage>=50&&v.percentage<75,"bg-blue-500":v.percentage>=75&&v.percentage<90,"bg-green-500":v.percentage>=90}]),style:Ne({width:`${v.percentage}%`})},null,6)])]))),128))])])):ce("",!0),$.value.length>0?(y(),L("div",Ra,[d[6]||(d[6]=r("h4",{class:"text-xs font-semibold text-muted-foreground mb-3 flex items-center gap-2"},[r("div",{class:"w-1 h-4 bg-orange-500 rounded-full"}),N(" Focus Areas ")],-1)),r("div",qa,[(y(!0),L(xt,null,_t($.value,b=>(y(),L("div",{key:b.category,class:"flex items-center gap-3 p-3 rounded-lg border border-orange-200/50 bg-orange-50/30"},[s(t(ca),{class:"h-4 w-4 text-orange-500 flex-shrink-0"}),r("div",Pa,[r("div",ja,g(b.category),1),r("div",Da,[N(g(b.score)+"/"+g(b.max)+" points - ",1),r("span",{class:oe({"text-red-600":b.status==="poor","text-orange-600":b.status==="needs-work","text-yellow-600":b.status==="fair"})},g(b.status==="poor"?"needs significant improvement":b.status==="needs-work"?"needs improvement":"fair, could be better"),3)])])]))),128))])])):ce("",!0),h.isAnalyzing?(y(),L("div",Ma,[s(t(ua),{class:"h-4 w-4 text-blue-500 animate-pulse"}),d[7]||(d[7]=r("span",{class:"text-sm text-blue-700 font-medium"},"Analyzing academic quality with AI...",-1))])):ce("",!0),!h.qualityAnalysis&&!h.isAnalyzing?(y(),L("div",Fa,[s(t(Je),{class:"h-8 w-8 text-muted-foreground mx-auto mb-2"}),d[8]||(d[8]=r("p",{class:"text-sm text-muted-foreground"},'Click "Analyze" to get AI-powered quality insights',-1))])):ce("",!0)]),_:1})]),_:1})):ce("",!0)}});function Na(D){const{delay:S=1e4,onSave:$}=D,M=c(!1),h=c(!1),d=c(null),b=()=>{M.value=!0,d.value&&clearTimeout(d.value),d.value=setTimeout(()=>{v(!0)},S)},v=async(_=!1)=>{if(!h.value){h.value=!0;try{await $(_),M.value=!1,d.value&&(clearTimeout(d.value),d.value=null)}finally{h.value=!1}}};return{hasUnsavedChanges:M,isSaving:h,triggerAutoSave:b,save:v,clearAutoSave:()=>{d.value&&(clearTimeout(d.value),d.value=null)}}}function Oa(D){const S=c({sentences:0,paragraphs:0,readingTime:0,avgWordLength:0,uniqueWords:0,commonWords:[]}),$=A(()=>D.value?D.value.split(/\s+/).filter(d=>d.length>0).length:0),M=()=>{if(!D.value){S.value={sentences:0,paragraphs:0,readingTime:0,avgWordLength:0,uniqueWords:0,commonWords:[]};return}const d=D.value,b=d.split(/\s+/).filter(T=>T.length>0),v=d.split(/[.!?]+/).filter(T=>T.trim().length>0),l=d.split(`

`).filter(T=>T.trim().length>0),_=new Map;b.forEach(T=>{const p=T.toLowerCase().replace(/[^a-z0-9]/g,"");p&&_.set(p,(_.get(p)||0)+1)});const m=new Set(["the","a","an","and","or","but","in","on","at","to","for","of","with","by","is","was","are","were"]),O=Array.from(_.entries()).filter(([T])=>!m.has(T)).sort((T,p)=>p[1]-T[1]).slice(0,5).map(([T])=>T);S.value={sentences:v.length,paragraphs:l.length,readingTime:Math.ceil(b.length/200),avgWordLength:b.reduce((T,p)=>T+p.length,0)/b.length,uniqueWords:_.size,commonWords:O}},h=A(()=>{if(!D.value)return 0;let d=0;const b=D.value;b.includes("##")&&(d+=20),b.length>1e3&&(d+=20),b.match(/\[.*?\]/g)&&(d+=15),(b.includes("**")||b.includes("*"))&&(d+=10);const v=b.split(/[.!?]+/).filter(_=>_.trim().length>0);if(v.length>0){const _=v.reduce((m,O)=>m+O.split(/\s+/).length,0)/v.length;_>10&&_<25&&(d+=20)}return b.split(`

`).filter(_=>_.trim().length>0).length>3&&(d+=15),Math.min(d,100)});return{writingStats:S,currentWordCount:$,writingQualityScore:h,calculateWritingStats:M}}function La(D,S=c(3e3),$=.8){const M=u=>{if(!u)return 0;const H=u.replace(/<[^>]*>/g,"").trim().replace(/\s+/g," ");if(!H)return 0;const q=H.match(/\b\w+\b/g);return q?q.length:0},h=u=>u?u.replace(/<[^>]*>/g,"").replace(/\r\n|\r/g,`
`).trim().split(/\n\s*\n/).filter(P=>P.trim().length>0).length:0,d=u=>{if(!u)return 0;const H=u.replace(/<[^>]*>/g,"").match(/[.!?]+/g);return H?H.length:0},b=u=>Math.round(u/200*10)/10,v=A(()=>M(D.value)),l=A(()=>D.value.length),_=A(()=>D.value.replace(/\s/g,"").length),m=A(()=>h(D.value)),O=A(()=>d(D.value)),T=A(()=>b(v.value)),p=A(()=>{const u=S.value;return!u||u<=0?0:Math.min(v.value/u*100,100)}),R=A(()=>v.value>=S.value*$),U=A(()=>{const u=S.value-v.value;return Math.max(u,0)}),K=A(()=>{const u=S.value*$-v.value;return Math.max(u,0)}),J=A(()=>({wordCount:v.value,characterCount:l.value,characterCountNoSpaces:_.value,paragraphCount:m.value,sentenceCount:O.value,readingTimeMinutes:T.value})),pe=A(()=>({current:v.value,target:S.value,percentage:p.value,isComplete:R.value,completionThreshold:$})),ye=u=>u>=1e3?`${Math.round(u/100)/10}k`:u.toString(),ve=(u=0)=>`${Math.round(p.value*Math.pow(10,u))/Math.pow(10,u)}%`,ge=()=>`${v.value} / ${S.value} words (${ve()}%)`,f=()=>{if(R.value)return`‚úÖ Complete (${ye(v.value)} words)`;const u=K.value;return`${ye(u)} more words to complete`},V=()=>{const u=v.value,w=S.value;return u===0?"empty":u<w*.25?"started":u<w*.75?"progressing":u<w*$?"near_complete":u<w?"complete":"exceeded"},Q=()=>{const u=V();return{empty:"text-gray-500",started:"text-blue-500",progressing:"text-yellow-500",near_complete:"text-orange-500",complete:"text-green-500",exceeded:"text-emerald-600"}[u]},te=()=>{const u=V();return{empty:"bg-gray-200",started:"bg-blue-200",progressing:"bg-yellow-200",near_complete:"bg-orange-200",complete:"bg-green-200",exceeded:"bg-emerald-200"}[u]},he=800,Ee=A(()=>v.value>=he),j=A(()=>Math.max(he-v.value,0)),k=A(()=>Math.min(v.value/he*100,100));return{currentWordCount:v,characterCount:l,characterCountNoSpaces:_,paragraphCount:m,sentenceCount:O,readingTimeMinutes:T,progressPercentage:p,isComplete:R,wordsRemaining:U,wordsToComplete:K,wordCountStats:J,wordCountProgress:pe,meetsDefenseThreshold:Ee,defenseWordsRemaining:j,defenseProgressPercentage:k,DEFENSE_THRESHOLD:he,formatWordCount:ye,formatProgress:ve,getProgressDisplay:ge,getCompletionDisplay:f,getWordCountStatus:V,getStatusColor:Q,getProgressBarColor:te,countWords:M}}function za(D,S,$,M){const d=c(!1),b=c(0),v=c(!1),l=f=>{if(!f)return 0;const Q=f.replace(/<[^>]*>/g,"").trim().replace(/\s+/g," ");if(!Q)return 0;const te=Q.match(/\b\w+\b/g);return te?te.length:0},_=A(()=>l($.value)),m=A(()=>_.value>=800),O=()=>`defense_generation_triggered_${D.id}_ch_${S.chapter_number}`,T=()=>{const f=O();return localStorage.getItem(f)==="true"},p=()=>{const f=O();localStorage.removeItem(f),d.value=!1,console.log(`üîÑ DEFENSE WATCHER: Reset generation trigger for Chapter ${S.chapter_number}`)},R=fa(async()=>{if(!v.value)return;const f=_.value;console.log(`üìä DEFENSE WATCHER: Word count check - Chapter ${S.chapter_number}: ${f} words`),f<800*.8&&d.value&&(console.log("‚¨áÔ∏è DEFENSE WATCHER: Content dropped below 80% of threshold, resetting trigger"),p()),b.value=f},2e3),U=()=>v.value?void 0:(v.value=!0,d.value=T(),b.value=_.value,console.log(`üëÄ DEFENSE WATCHER: Started watching Chapter ${S.chapter_number}`),console.log(`   Initial word count: ${b.value}`),console.log(`   Generation already triggered: ${d.value}`),console.log("   Threshold: 800 words"),Be($,(V,Q)=>{V!==Q&&R()},{immediate:!1})),K=()=>{v.value=!1,R.cancel(),console.log(`üõë DEFENSE WATCHER: Stopped watching Chapter ${S.chapter_number}`)},J=async()=>{console.log(`üîç DEFENSE WATCHER: Force checking Chapter ${S.chapter_number}`),await R(),R.flush()},pe=A(()=>{const f=_.value;return f>0&&f<800&&!d.value}),ye=A(()=>{const f=_.value/800*100;return Math.min(f,100)}),ve=A(()=>{const f=800-_.value;return Math.max(f,0)});return{isWatching:v,hasTriggeredGeneration:d,currentWordCount:_,lastWordCount:b,meetsThreshold:m,shouldShowProgressIndicator:pe,progressPercentage:ye,wordsRemaining:ve,startWatching:U,stopWatching:K,forceCheck:J,resetGenerationTrigger:p,getStatusMessage:()=>{const f=_.value;return d.value?`Defense questions available (${f} words)`:f>=800?`Ready for defense questions (${f} words)`:f>0?`${800-f} more words needed for defense questions`:"Start writing to enable defense questions (800 words needed)"},countWords:l,DEFENSE_WORD_COUNT_THRESHOLD:800}}function Ia(D){const S=c(!1),$=c(null),M=c([]),h=c(null),d=A(()=>{if(!$.value?.quality_level)return"text-muted-foreground";switch($.value.quality_level){case"Excellent":return"text-green-600";case"Good":return"text-blue-600";case"Satisfactory":return"text-yellow-600";case"Needs Improvement":return"text-orange-600";case"Poor":return"text-red-600";default:return"text-muted-foreground"}}),b=A(()=>$.value?.scores?Object.entries($.value.scores).sort(([,p],[,R])=>p.percentage-R.percentage).slice(0,3).map(([p,R])=>({category:p.replace(" & "," & "),percentage:Math.round(R.percentage),score:R.score,max:R.max})):[]),v=async()=>{try{S.value=!0,h.value=null,await we.get("/sanctum/csrf-cookie");const p=await we.post(ne("api.chapters.analysis.analyze",{chapter:D}));if(p.data.success)return $.value=p.data.analysis,p.data.analysis;throw new Error(p.data.error||"Analysis failed")}catch(p){return h.value=p.response?.data?.error||p.message||"Analysis failed",console.error("Chapter analysis failed:",p),null}finally{S.value=!1}};return{isAnalyzing:S,latestAnalysis:$,analysisHistory:M,error:h,qualityLevelColor:d,topImprovementAreas:b,analyzeChapter:v,getLatestAnalysis:async()=>{try{await we.get("/sanctum/csrf-cookie");const p=await we.get(ne("api.chapters.analysis.latest",{chapter:D}));return p.data.success?($.value=p.data.analysis,p.data.analysis):($.value=null,null)}catch(p){return p.response?.status!==404&&(h.value=p.response?.data?.error||p.message||"Failed to get analysis",console.error("Failed to get latest analysis:",p)),null}},getAnalysisHistory:async()=>{try{await we.get("/sanctum/csrf-cookie");const p=await we.get(ne("api.chapters.analysis.history",{chapter:D}));if(p.data.success)return M.value=p.data.analyses,p.data.analyses;throw new Error(p.data.error||"Failed to get history")}catch(p){return h.value=p.response?.data?.error||p.message||"Failed to get analysis history",console.error("Failed to get analysis history:",p),[]}},autoAnalyze:async(p,R=500)=>{p>=R&&await v()},getScoreColor:(p,R)=>{const U=p/R*100;return U>=80?"text-green-600":U>=70?"text-blue-600":U>=60?"text-yellow-600":U>=40?"text-orange-600":"text-red-600"},getProgressVariant:p=>p>=80?"success":p>=60?"default":"destructive"}}const Wa={key:2,class:"flex h-screen flex-col overflow-hidden bg-zinc-50 dark:bg-zinc-950 font-sans selection:bg-primary/20"},Ha={class:"relative z-20 flex flex-shrink-0 items-center justify-between border-b border-border/40 bg-background/60 p-4 backdrop-blur-xl supports-[backdrop-filter]:bg-background/40 transition-all duration-300"},Ga={class:"flex items-center gap-5"},Ua={class:"flex flex-col"},Va={class:"text-lg font-bold tracking-tight text-foreground/90 font-display"},Qa={class:"flex items-center gap-3 text-xs text-muted-foreground"},Ka={class:"flex items-center gap-1.5"},Ba={class:"flex items-center gap-4"},Ja={class:"flex items-center p-1 rounded-full border border-border/40 bg-background/50 backdrop-blur-sm shadow-sm"},Xa={class:"flex items-center gap-2"},Ya={class:"relative z-20 h-[2px] w-full bg-border/20"},Za={key:0,class:"mx-3 my-2"},es={class:"relative overflow-hidden rounded-xl border border-blue-200 bg-gradient-to-br from-blue-50 to-purple-50 p-3 shadow-sm dark:border-blue-800 dark:from-blue-950/30 dark:to-purple-950/30"},ts={class:"relative z-10 mb-2 flex items-center justify-between"},rs={class:"flex items-center gap-2"},as={class:"relative"},ss={class:"flex h-6 w-6 items-center justify-center rounded-full bg-gradient-to-br from-blue-500 to-purple-600"},ns={class:"text-xs text-blue-700 dark:text-blue-300"},os={class:"relative z-10 mb-2"},ls={class:"mb-1 flex items-center justify-between"},is={class:"text-xs text-blue-600 dark:text-blue-400"},us={class:"relative h-2 overflow-hidden rounded-full bg-blue-100 dark:bg-blue-900/50"},cs={class:"relative z-10 flex items-center gap-2"},ds={class:"flex-shrink-0"},ps={key:0,class:"h-2 w-2 animate-bounce rounded-full bg-blue-500"},vs={key:1,class:"flex gap-0.5"},gs={key:2,class:"h-2 w-2 animate-spin rounded-full border-2 border-blue-500 border-t-transparent"},hs={key:3,class:"h-2 w-2 rounded-full bg-green-500"},fs={key:4,class:"h-2 w-2 rounded-full bg-red-500"},ms={class:"flex-1 text-xs text-blue-800 dark:text-blue-200"},bs={class:"relative z-10 flex flex-1 overflow-hidden"},ws={key:0,class:"w-[320px] flex-shrink-0 border-r border-border/50 bg-background/80 backdrop-blur-xl shadow-xl z-20"},ys={class:"h-full overflow-y-auto custom-scrollbar"},xs={class:"p-4"},_s={class:"mb-3"},Cs={class:"text-xs text-muted-foreground"},Ss={class:"flex min-h-0 flex-1 flex-col bg-transparent relative"},Es={class:"flex-1 overflow-hidden relative"},ks={class:"absolute inset-0 overflow-y-auto custom-scrollbar flex flex-col items-center py-8 px-4 sm:px-8"},Ts={class:"flex items-center justify-between"},As={class:"space-y-1"},$s={class:"flex items-center gap-2"},Rs={class:"flex items-center justify-between px-6 py-2 border-b border-border/30 bg-muted/5"},qs={class:"flex items-center gap-2"},Ps={class:"space-y-1 relative z-10"},js={class:"text-sm font-medium text-foreground"},Ds={class:"text-[10px] text-muted-foreground line-clamp-2 leading-relaxed"},Ms={class:"flex-1 relative bg-background"},Fs={class:"px-12 py-10 min-h-[500px]"},Ns={class:"sticky bottom-0 z-10 border-t border-border/30 bg-background/80 backdrop-blur-md p-4 flex items-center justify-between"},Os={class:"text-xs text-muted-foreground"},Ls={class:"flex items-center gap-2"},zs={key:0,class:"w-72 flex-shrink-0 border-l border-border/40 bg-background/40 backdrop-blur-md"},Is={class:"h-full overflow-y-auto custom-scrollbar"},Ws={class:"space-y-6 p-4"},Hs={class:"min-h-screen bg-gradient-to-br from-background via-background to-muted/20"},Gs={class:"w-full px-4 py-6 transition-all duration-300"},Us={class:"mb-6 flex items-center justify-between"},Vs={class:"flex items-center gap-4"},Qs={class:"text-xl font-bold sm:text-2xl"},Ks={class:"text-sm text-muted-foreground"},Bs={class:"flex items-center gap-2"},Js={class:"hidden items-center gap-2 lg:flex"},Xs={class:"mb-6"},Ys={class:"mb-2 flex items-center justify-between"},Zs={class:"text-sm text-muted-foreground"},en={key:0,class:"mb-6"},tn={class:"relative overflow-hidden rounded-xl border border-blue-200 bg-gradient-to-br from-blue-50 to-purple-50 p-4 shadow-sm dark:border-blue-800 dark:from-blue-950/30 dark:to-purple-950/30"},rn={class:"relative z-10 mb-3 flex items-center justify-between"},an={class:"flex items-center gap-2"},sn={class:"relative"},nn={class:"flex h-8 w-8 items-center justify-center rounded-full bg-gradient-to-br from-blue-500 to-purple-600"},on={class:"text-xs text-blue-700 dark:text-blue-300"},ln={class:"relative z-10 mb-3"},un={class:"mb-1 flex items-center justify-between"},cn={class:"text-xs text-blue-600 dark:text-blue-400"},dn={class:"relative h-2 overflow-hidden rounded-full bg-blue-100 dark:bg-blue-900/50"},pn={class:"relative z-10 flex items-center gap-2"},vn={class:"flex-shrink-0"},gn={key:0,class:"h-3 w-3 animate-bounce rounded-full bg-blue-500"},hn={key:1,class:"flex gap-1"},fn={key:2,class:"h-3 w-3 animate-spin rounded-full border-2 border-blue-500 border-t-transparent"},mn={key:3,class:"h-3 w-3 rounded-full bg-green-500"},bn={key:4,class:"h-3 w-3 rounded-full bg-red-500"},wn={class:"flex-1 text-xs text-blue-800 dark:text-blue-200"},yn={key:0,class:"relative z-10 mt-3 border-t border-blue-200 pt-3 dark:border-blue-800"},xn={class:"flex items-center justify-between text-xs"},_n={class:"flex items-center gap-1"},Cn={class:"flex gap-0.5"},Sn={class:"ml-1 text-blue-600 dark:text-blue-400"},En={class:"grid grid-cols-1 gap-6 lg:grid-cols-12 transition-all duration-300"},kn={class:"hidden lg:block lg:col-span-2 transition-all duration-300"},Tn={class:"h-[calc(100vh-320px)] overflow-y-auto space-y-6 custom-scrollbar pr-1"},An={class:"flex items-center justify-between"},$n={class:"flex items-center gap-2"},Rn={class:"flex items-center gap-2"},qn={class:"space-y-2"},Pn={class:"space-y-2"},jn={class:"flex items-center justify-between"},Dn={class:"flex items-center gap-2"},Mn={class:"flex flex-col gap-2 pt-4 sm:flex-row"},Fn={class:"hidden sm:inline"},Nn={class:"sm:hidden"},On={class:"hidden sm:inline"},Ln={class:"sm:hidden"},zn={class:"hidden sm:inline"},In={class:"sm:hidden"},Wn={class:"hidden lg:block lg:col-span-3 transition-all duration-300"},Hn={class:"h-[calc(100vh-40px)] overflow-y-auto space-y-4 custom-scrollbar px-1"},Gn=1e3,Wo=pr({__name:"ChapterEditor",props:{project:{},chapter:{},allChapters:{},facultyChapters:{},mode:{}},setup(D){const S=$e(()=>Re(()=>import("./AISidebar-Dplm4LTi.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50]))),$=$e(()=>Re(()=>import("./ChapterNavigation-DuiNzgIE.js"),__vite__mapDeps([51,52,3,1,2,20,21,11,7,8,12,22,23,14,24,19,25,26,27,13,15,16,28,29,18,4,30,31,32,33,34,35,9,10,36,37,38,39,40,53,54,55,56,57,43]))),M=$e(()=>Re(()=>import("./MobileNavOverlay-DlmuhQmM.js"),__vite__mapDeps([58,1,2,59,3,0,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,52,53,54,55,56,57,60,61,62,63,64,65]))),h=$e(()=>Re(()=>import("./ChatModeLayout-CYI3_Ihr.js"),__vite__mapDeps([66,67,1,2,18,3,8,4,11,7,12,20,21,22,23,14,24,19,25,26,27,13,15,16,28,29,30,31,32,33,34,35,9,10,36,37,38,39,59,68,63,43,42,69,70,54,71,72,47,73,61,57,46,45,49,44,55,74,75]))),d=$e(()=>Re(()=>import("./CitationVerificationLayout-Dai6hmMa.js"),__vite__mapDeps([76,18,3,1,2,8,4,5,11,7,12,20,21,22,23,14,24,19,25,26,27,13,15,16,28,29,30,31,32,33,34,35,9,10,36,37,38,39,68,55]))),b=$e(()=>Re(()=>import("./DefensePreparationPanel-CcXjnQTV.js"),__vite__mapDeps([77,60,1,2,59,3,18,8,4,5,6,7,11,12,20,21,22,23,14,24,19,25,26,27,13,15,16,28,29,30,31,32,33,34,35,9,10,36,37,38,39,61,62,41,48,63]))),v=$e(()=>Re(()=>import("./DataCollectionPanel-Bcn7Ovgx.js"),__vite__mapDeps([78,64,1,2,13,3,14,8,7,15,16]))),l=D,_=c(l.chapter.title||""),m=c(l.chapter.content||""),O=c(!0),T=c(!1),p=c(!1);c(!1);const R=c(!1);c("write");const U=c("");c(0);const K=c(!1),J=c(!1),pe=c(!0),ye=()=>{try{return localStorage.getItem(`chatMode_${l.project.id}_${l.chapter.chapter_number}`)==="true"}catch(a){return console.warn("Failed to load chat mode from localStorage:",a),!1}},ve=a=>{try{localStorage.setItem(`chatMode_${l.project.id}_${l.chapter.chapter_number}`,String(a))}catch(e){console.warn("Failed to save chat mode to localStorage:",e)}},ge=c(!1),f=c(!1),V=c(!1),Q=c(!1),te=c(!1),he=c(!0),Ee=c(!0),j=c(!1),k=c(""),u=c(0),w=c(""),H=c(0),q=c(0),P=c(null),F=c(""),Xe=c(0),it=c(""),hr=c([]),Oe=c(!1),ke=c(!1),Le=c(!1),qe=c(""),Pe=c(""),fr=c(0),Te=c(null),mr=c(0),br=c(null),wr=c([]),yr=c([]),xr=c(null);c(null),c(null);const _r=c(),kt=c(),Cr=c(),Tt=c();c(null),c(null);const Y=c(!1),{hasUnsavedChanges:Sr,isSaving:je,triggerAutoSave:ze,save:fe,clearAutoSave:Er}=Na({delay:1e4,onSave:Rt});let At=0;const kr=()=>{const a=Date.now();a-At>Gn&&(At=a,E.success("Saved",{duration:2e3}))},{contentHistory:Tr,historyIndex:Ar,addToHistory:$r,undo:Rr,redo:qr}=ta(l.chapter.content||""),{writingStats:ut,writingQualityScore:xe,calculateWritingStats:Ye}=Oa(m),{isAnalyzing:_e,latestAnalysis:B,analyzeChapter:Ze,getLatestAnalysis:Pr}=Ia(l.chapter.id),ie=A(()=>{if(l.project?.outlines&&l.project.outlines.length>0){const e=l.project.outlines.find(n=>n.chapter_number===l.chapter.chapter_number);if(e?.target_word_count)return e.target_word_count}const a=l.project.type==="undergraduate"?2500:3500;return l.chapter.chapter_number===1||l.chapter.chapter_number===5?Math.round(a*.8):a}),{currentWordCount:W,progressPercentage:jr,meetsDefenseThreshold:Dr,defenseWordsRemaining:Mr,defenseProgressPercentage:Fr,DEFENSE_THRESHOLD:et,countWords:$t}=La(m,ie),Ie=jr,We=A(()=>{const a=_.value?.trim(),e=m.value?.trim();return a&&a.length>0&&e&&e.length>50}),me=A(()=>l.project),be=A(()=>l.chapter),Ae=A(()=>l.allChapters);async function Rt(a=!1){try{const e=await fetch(ne("chapters.save",{project:l.project.id}),{method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json","X-Requested-With":"XMLHttpRequest","X-CSRF-TOKEN":document.querySelector('meta[name="csrf-token"]')?.getAttribute("content")||""},body:JSON.stringify({project_id:l.project.id,chapter_number:l.chapter.chapter_number,title:_.value,content:m.value,auto_save:a,statistics:ut.value,quality_score:xe.value})});console.log("Response status:",e.status,e.statusText),console.log("Response headers:",e.headers);const n=await e.text();console.log("Raw response:",n);let i;try{i=JSON.parse(n)}catch(x){throw console.error("JSON parse error:",x),console.error("Response was:",n),new Error(`Server returned non-JSON response: ${e.status} ${e.statusText}`)}e.ok}catch(e){throw a||E.error("‚ùå Save Failed",{description:"Please try again or check your connection."}),e}}const qt=()=>{const a=Rr();a!==null&&(m.value=a,ze())},Pt=()=>{const a=qr();a!==null&&(m.value=a,ze())},He=a=>{Sr.value&&confirm("You have unsaved changes. Save before switching chapters?")&&fe();const e=l.allChapters.find(x=>x.chapter_number===a),i=e?.content&&e.content.trim()!==""?"chapters.edit":"chapters.write";nt.visit(ne(i,{project:l.project.slug,chapter:a}),{only:["chapter","mode","allChapters"],preserveState:!0,preserveScroll:!1})},ct=async()=>{await fe();const a=l.allChapters.map(i=>i.chapter_number).sort((i,x)=>i-x),e=a.indexOf(l.chapter.chapter_number);let n;if(e===-1||e===a.length-1)n=Math.max(...a)+1;else{const i=a[e+1];i===l.chapter.chapter_number+1?n=i:n=l.chapter.chapter_number+1}console.log("üìù Generating next chapter:",{currentChapter:l.chapter.chapter_number,existingChapters:a,nextChapterNumber:n});try{const i=ne("chapters.write",{project:l.project.slug,chapter:n});console.log("üîó Generated URL for next chapter:",i);const x=new URL(i,window.location.origin);x.searchParams.set("ai_generate","true"),x.searchParams.set("generation_type","progressive"),console.log("üöÄ Navigating to:",x.toString()),nt.visit(x.toString())}catch(i){console.error("‚ùå Error generating next chapter:",i),E.error("Navigation Error",{description:"Failed to navigate to next chapter. Please try again."})}},dt=(a,e)=>{a==="section"&&e?.section?Nr(e.section):a==="rephrase"&&e?.selectedText?Or(e.selectedText,e.style||"Academic Formal"):a==="expand"&&e?.selectedText?Lr(e.selectedText):pt(a)},Nr=async a=>{j.value=!0,F.value="",q.value=0,u.value=5,w.value="Papers",k.value="Checking for verified sources...",H.value=600,it.value=m.value||l.chapter.content||"",Y.value=!0;try{u.value=50,w.value="Papers",k.value="Using existing verified sources...",await new Promise(n=>setTimeout(n,500)),w.value="Section",k.value=`Generating ${a} section with verified sources...`,u.value=51;const e=ne("chapters.stream",{project:l.project.slug,chapter:l.chapter.chapter_number});P.value=new EventSource(`${e}?generation_type=section&section_type=${a}`),P.value.onmessage=n=>{const i=JSON.parse(n.data);switch(i.type){case"start":w.value="Generating Section",u.value=52,k.value=`Starting ${a} section generation...`;break;case"content":F.value+=i.content,q.value=i.word_count||$t(F.value);const x=Date.now();if(x-Xe.value>150){const z=F.value;m.value=it.value+`

`+z,Xe.value=x;const Z=Math.min(q.value/H.value*43,43);u.value=Math.max(52,52+Z),k.value=`Generating ${a} section... (${q.value} / ${H.value} words)`,Ye(),Ot()}break;case"complete":u.value=100,w.value="Complete",k.value=`‚úì Generated ${a} section (${q.value} words)`;const C=F.value;m.value=it.value+`

`+C,fe(!0),E.success("‚úÖ Section Generated Successfully",{description:`Added ${a} section with ${q.value} words and verified citations.`,duration:5e3}),j.value=!1,P.value?.close();break;case"error":throw new Error(i.message||"Section generation failed");case"heartbeat":u.value<95&&(u.value+=.5);break}},P.value.onerror=()=>{j.value=!1,w.value="Error",k.value="‚ùå Section generation failed",E.error("‚ùå Generation Failed",{description:"Unable to generate section. Please check your connection and try again."}),P.value?.close()}}catch(e){console.error("Section generation failed:",e),j.value=!1,w.value="Error",k.value="‚ùå Section generation error",E.error("‚ùå Generation Failed",{description:"Section generation encountered an error."})}},Or=async(a,e)=>{console.log("üöÄ ChapterEditor - Starting rephrase generation:",{selectedTextLength:a.length,selectedTextPreview:a.substring(0,100)+(a.length>100?"...":""),style:e,timestamp:new Date().toISOString()}),j.value=!0,F.value="",q.value=0,u.value=10,w.value="Rephrasing",k.value="Preparing to rephrase selected text...";const n=a.split(/\s+/).length;H.value=Math.max(n,50);const i=Ge.value||tt.value,x=i?.getSelectionRange();console.log("üìç ChapterEditor - Editor and selection info:",{hasActiveEditor:!!i,selectionRange:x,selectedWordCount:n,estimatedWords:H.value});const C={originalText:a,range:x,wordCount:n,style:e,startTime:Date.now()};console.log("üíæ ChapterEditor - Stored rephrase context:",C),Y.value=!0;try{u.value=20,k.value=`Rephrasing ${n} words in ${e} style...`;const Z=`${ne("chapters.stream",{project:l.project.slug,chapter:l.chapter.chapter_number})}?generation_type=rephrase&selected_text=${encodeURIComponent(a)}&style=${encodeURIComponent(e)}`;console.log("üåê ChapterEditor - Creating EventSource:",{url:Z,encodedTextLength:encodeURIComponent(a).length}),P.value=new EventSource(Z),P.value.onmessage=X=>{const ee=JSON.parse(X.data);switch(console.log("üì® ChapterEditor - EventSource message received:",{type:ee.type,hasContent:!!ee.content,contentLength:ee.content?.length||0,wordCount:ee.word_count}),ee.type){case"start":console.log("‚ñ∂Ô∏è ChapterEditor - Rephrase generation started"),w.value="Rephrasing Text",u.value=30,k.value=`Rephrasing text in ${e} style...`;break;case"content":F.value+=ee.content,q.value=ee.word_count||$t(F.value),console.log("üìù ChapterEditor - Content chunk received:",{chunkLength:ee.content?.length||0,totalBufferLength:F.value.length,totalWords:q.value});const de=Math.min(q.value/H.value*60,60);u.value=Math.max(30,30+de),k.value=`Rephrasing... (${q.value} words)`;break;case"complete":if(console.log("üèÅ ChapterEditor - Rephrase generation complete"),u.value=100,w.value="Complete",k.value=`‚úì Text rephrased successfully (${q.value} words)`,console.log("üîÑ ChapterEditor - Starting text replacement:",{hasRange:!!C.range,hasContent:!!F.value.trim(),range:C.range,newContentLength:F.value.trim().length,newContentPreview:F.value.trim().substring(0,100)+"..."}),C.range&&F.value.trim()){console.log("üéØ ChapterEditor - Attempting text replacement with activeEditor:",{editorType:i===Ge.value?"fullscreen":"normal",hasActiveEditor:!!i});const Ce=i?.replaceSelection(F.value.trim(),C.range);console.log("üìä ChapterEditor - Text replacement result:",{success:Ce}),Ce?(console.log("‚úÖ ChapterEditor - Text replacement successful, updating chapter content"),setTimeout(()=>{const rt=i?.getHTML()||m.value;console.log("üìÑ ChapterEditor - Updated chapter content length:",rt.length),m.value=rt},100)):(console.warn("‚ùå ChapterEditor - Failed to replace selected text, falling back to manual update"),E.warning("Please manually replace the selected text",{description:"The rephrased text is ready but couldn't be automatically replaced."}))}else console.error("‚ùå ChapterEditor - Cannot replace text:",{missingRange:!C.range,missingContent:!F.value.trim()});fe(!0),E.success("‚úÖ Text Rephrased Successfully",{description:`Rephrased ${n} words in ${e} style.`,duration:5e3}),j.value=!1,P.value?.close();break;case"error":throw new Error(ee.message||"Text rephrasing failed");case"heartbeat":u.value<95&&(u.value+=.5);break}},P.value.onerror=()=>{j.value=!1,w.value="Error",k.value="‚ùå Text rephrasing failed",E.error("‚ùå Rephrasing Failed",{description:"Unable to rephrase text. Please check your connection and try again."}),P.value?.close()}}catch(z){console.error("Text rephrasing failed:",z),j.value=!1,w.value="Error",k.value="‚ùå Rephrasing error",E.error("‚ùå Rephrasing Failed",{description:"Text rephrasing encountered an error."})}},Lr=async a=>{console.log("üìà ChapterEditor - Starting expand generation:",{selectedTextLength:a.length,selectedTextPreview:a.substring(0,100)+(a.length>100?"...":""),timestamp:new Date().toISOString()}),j.value=!0,F.value="",q.value=0,u.value=10,w.value="Expanding",k.value="Preparing to expand selected text...";const e=a.split(/\s+/).length;H.value=Math.max(e*2,100);const n=Ge.value||tt.value,i=n?.getSelectionRange();console.log("üìç ChapterEditor - Editor and selection info for expand:",{hasActiveEditor:!!n,selectionRange:i,selectedWordCount:e,estimatedWords:H.value});const x={originalText:a,range:i,wordCount:e,startTime:Date.now()};console.log("üíæ ChapterEditor - Stored expand context:",x);try{const z=`${ne("chapters.stream",{project:l.project.slug,chapter:l.chapter.chapter_number})}?generation_type=expand&selected_text=${encodeURIComponent(a)}`;console.log("üåê ChapterEditor - Creating EventSource for expand:",{url:z,encodedTextLength:encodeURIComponent(a).length}),P.value=new EventSource(z),P.value.onmessage=Z=>{const X=JSON.parse(Z.data);switch(console.log("üì® ChapterEditor - EventSource message received:",{type:X.type,hasContent:!!X.content,contentLength:X.content?.length||0,wordCount:X.word_count}),X.type){case"start":console.log("‚ñ∂Ô∏è ChapterEditor - Expand generation started"),w.value="Expanding Text",u.value=20,k.value="Starting text expansion...";break;case"content":F.value+=X.content,q.value=X.word_count||F.value.split(/\s+/).filter(de=>de.length>0).length;const ee=Math.min(q.value/H.value*90,90);u.value=Math.max(ee,25),k.value=`Expanding text... ${q.value}/${H.value} words`,console.log("üìù ChapterEditor - Expand content received:",{chunkLength:X.content?.length||0,totalWords:q.value,progress:u.value});break;case"complete":if(console.log("‚úÖ ChapterEditor - Expand generation complete"),w.value="Complete",k.value="‚úÖ Text expansion completed",u.value=100,x.range&&F.value.trim()){console.log("üéØ ChapterEditor - Attempting text replacement for expand");const de=n?.replaceSelection(F.value.trim(),x.range);console.log("üìä ChapterEditor - Expand text replacement result:",{success:de}),de?(console.log("‚úÖ ChapterEditor - Expand text replacement successful"),setTimeout(()=>{const Ce=n?.getHTML()||m.value;console.log("üìÑ ChapterEditor - Updated chapter content length after expand:",Ce.length),m.value=Ce},100)):(console.warn("‚ùå ChapterEditor - Failed to replace expanded text"),E.warning("Please manually replace the selected text",{description:"The expanded text is ready but couldn't be automatically replaced."}))}else console.error("‚ùå ChapterEditor - Cannot replace expanded text:",{missingRange:!x.range,missingContent:!F.value.trim()});fe(!0),E.success("‚úÖ Text Expanded Successfully",{description:`Expanded ${x.wordCount} words into ${q.value} words`}),j.value=!1,P.value?.close();break;case"error":console.error("‚ùå ChapterEditor - Expand generation error:",X.message),j.value=!1,w.value="Error",k.value="‚ùå Text expansion failed",E.error("‚ùå Expansion Failed",{description:X.message||"Text expansion encountered an error."}),P.value?.close();break}},P.value.onerror=()=>{console.error("‚ùå ChapterEditor - Expand stream error occurred"),j.value=!1,w.value="Error",k.value="‚ùå Text expansion failed",E.error("‚ùå Expansion Failed",{description:"Unable to expand text. Please check your connection and try again."}),P.value?.close()}}catch(C){console.error("Text expansion failed:",C),j.value=!1,w.value="Error",k.value="‚ùå Expansion error",E.error("‚ùå Expansion Failed",{description:"Text expansion encountered an error."})}},zr=async()=>{Le.value=!0,Pe.value="Starting",qe.value="Initializing source collection...",u.value=5;try{const a=document.querySelector('meta[name="csrf-token"]')?.content;if(!a)throw new Error("CSRF token not found - please refresh the page");const e=await fetch(ne("api.projects.paper-collection.start",{project:l.project.slug}),{method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json","X-CSRF-TOKEN":a,"X-Requested-With":"XMLHttpRequest"},credentials:"include"});if(!e.ok){const n=await e.text();if(console.error("API Error:",e.status,n),e.status===409)try{const i=JSON.parse(n);throw new Error(i.message||"Source collection is already in progress")}catch{throw new Error("Source collection is already in progress for this project")}throw new Error(`Failed to start source collection: ${e.status}`)}return await Ir()}catch(a){return console.error("Paper collection failed:",a),Pe.value="Error",qe.value="‚ùå Source collection failed",Le.value=!1,!1}},Ir=async()=>new Promise(a=>{let e=0;const n=120,i=async()=>{try{const C=await(await fetch(ne("api.projects.paper-collection.status",{project:l.project.slug}))).json();if(C.success&&C.data){xr.value=C.data;const z=C.data.status,Z=C.data.papers_count||C.data.count||0,X=C.data.message,ee=C.data.percentage||0,de=C.data.current_source,Ce=C.data.sources_completed||[],rt=C.data.papers_preview||[];if(fr.value=Z,mr.value=ee,br.value=de,wr.value=Ce,yr.value=rt,z==="completed"){Pe.value="Complete",qe.value=`‚úì Collected ${Z} verified sources from ${Ce.length} databases`,u.value=50,Le.value=!1,Te.value&&clearInterval(Te.value),a(!0);return}else if(z==="collecting_papers"||z==="initializing"||z==="processing"||z==="storing"){let Xt="";de&&(Xt={semantic_scholar:"Semantic Scholar",openalex:"OpenAlex",crossref:"CrossRef",pubmed:"PubMed"}[de]||de),Pe.value=Xt||"Collecting Sources",qe.value=X||"Collecting sources from academic databases...",u.value=Math.min(5+ee*.4,45)}else if(z==="collection_failed"){Pe.value="Error",qe.value=X||"‚ùå Source collection failed",Le.value=!1,Te.value&&clearInterval(Te.value),a(!1);return}}e++,e>=n&&(Pe.value="Timeout",qe.value="‚è±Ô∏è Source collection timed out",Le.value=!1,Te.value&&clearInterval(Te.value),a(!1))}catch(x){console.error("Error checking paper collection status:",x),e++}};i(),Te.value=setInterval(i,5e3)}),pt=async a=>{if(j.value=!0,F.value="",q.value=0,u.value=5,w.value="Papers",k.value="Checking for verified sources...",H.value=ie.value,Y.value=!0,!await zr()){E.error("Paper Collection Failed",{description:"Unable to collect verified papers. Please try again."}),j.value=!1,Y.value=!1;return}w.value="Initializing",k.value="Starting AI generation with verified sources...",u.value=51;const n=setInterval(()=>{u.value<52&&j.value?u.value+=.2:clearInterval(n)},100),i=ne("chapters.stream",{project:l.project.slug,chapter:l.chapter.chapter_number});P.value=new EventSource(`${i}?generation_type=${a}`),P.value.onmessage=x=>{const C=JSON.parse(x.data);switch(C.type){case"start":w.value="Connecting",u.value=52,k.value="Connecting to AI service...";break;case"content":w.value="Generating",F.value+=C.content,q.value=C.word_count||F.value.split(/\s+/).filter(Z=>Z.length>0).length;const z=Date.now();if(z-Xe.value>150){m.value=F.value,Xe.value=z;const Z=Math.min(q.value/H.value*43,43);u.value=Math.max(52,52+Z),k.value=`Generating chapter content... (${q.value} / ${H.value} words)`,Ye(),Ot()}break;case"heartbeat":u.value<95&&(u.value+=.5);break;case"complete":w.value="Complete",u.value=100,j.value=!1,m.value=F.value,k.value=`‚úì Generated ${C.final_word_count||q.value} words successfully`,setTimeout(()=>{ze()},500),P.value?.close(),P.value=null;break;case"error":w.value="Error",u.value=50,j.value=!1,C.code==="OFFLINE_MODE"?(k.value="üì° AI services offline",E.error("AI Services Offline",{description:"Please check your internet connection and try again."})):(k.value="‚ùå Generation failed",E.error("Generation Error",{description:C.message||"Please try again."})),P.value?.close(),P.value=null;break}},P.value.onerror=()=>{w.value="Error",u.value=50,j.value=!1,k.value="‚ùå Connection error",E.error("Connection Error",{description:"Please check your internet connection and try again."}),P.value?.close(),P.value=null}},vt=async()=>{if(U.value){Oe.value=!0;try{const e=await(await fetch(ne("chapters.suggestions",{project:l.project.slug,chapter:l.chapter.chapter_number}),{method:"POST",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":document.querySelector('meta[name="csrf-token"]')?.getAttribute("content")||""},body:JSON.stringify({selected_text:U.value,context:m.value})})).json();hr.value=e.suggestions||[]}catch{E.error("Error getting suggestions",{description:"Please try again."})}finally{Oe.value=!1}}},gt=()=>{ke.value=!0,E.success("Citation Manager opened!",{description:"Review and verify your citations in the panel below."})},jt=a=>{try{const e=Ge.value?.editor||tt.value?.editor;if(!e){E.error("Editor not found");return}const{from:n}=e.state.selection;e.chain().focus().insertContentAt(n,` ${a} `).run(),E.success("Citation inserted successfully")}catch(e){console.error("Failed to insert citation:",e),E.error("Failed to insert citation")}},tt=c(null),Ge=c(null),Wr=async()=>{try{const a=document.documentElement;a.requestFullscreen?await a.requestFullscreen():a.webkitRequestFullscreen?await a.webkitRequestFullscreen():a.msRequestFullscreen&&await a.msRequestFullscreen()}catch(a){console.error("Error entering fullscreen:",a),E.error("Fullscreen Error",{description:"Unable to enter fullscreen mode"})}},Hr=async()=>{try{document.exitFullscreen?await document.exitFullscreen():document.webkitExitFullscreen?await document.webkitExitFullscreen():document.msExitFullscreen&&await document.msExitFullscreen()}catch(a){console.error("Error exiting fullscreen:",a),E.error("Fullscreen Error",{description:"Unable to exit fullscreen mode"})}},Dt=async()=>{p.value?await Hr():await Wr()},De=()=>{const a=document.fullscreenElement||document.webkitFullscreenElement||document.msFullscreenElement;p.value=!!a},Mt=()=>{T.value=!T.value,document.documentElement.classList.toggle("dark",T.value),localStorage.setItem("darkMode",T.value.toString())},Gr=()=>{K.value=!K.value,K.value&&(J.value=!1),ve(K.value)},Ur=()=>{K.value=!1,ve(!1)},Vr=()=>{J.value=!J.value,J.value&&(K.value=!1,ve(!1))},Qr=()=>{J.value=!1},Ft=()=>{Y.value=!Y.value},Kr=()=>{$r(m.value),ze(),Ye()},Nt=a=>{(a.ctrlKey||a.metaKey)&&a.key==="s"&&(a.preventDefault(),fe(),kr()),(a.ctrlKey||a.metaKey)&&!a.shiftKey&&a.key==="z"&&(a.preventDefault(),qt()),(a.ctrlKey||a.metaKey)&&a.shiftKey&&a.key==="z"&&(a.preventDefault(),Pt()),a.key==="F11"&&(a.preventDefault(),Dt())};at(()=>{const a=()=>{V.value=window.innerWidth<1024};a(),window.addEventListener("resize",a);const e=localStorage.getItem("darkMode")==="true";T.value=e,document.documentElement.classList.toggle("dark",e),K.value=ye(),document.addEventListener("keydown",Lt),document.addEventListener("keydown",Nt),document.addEventListener("fullscreenchange",De),document.addEventListener("webkitfullscreenchange",De),document.addEventListener("msfullscreenchange",De),Ye(),Br()});const Ot=()=>{st(()=>{if(j.value){const a=Y.value?p.value?Tt.value:Cr.value:p.value?kt.value:_r.value;if(a)try{const e=a;if(!e)return;const n=e.$el||e;if(!n)return;let i=n.querySelector("[data-radix-scroll-area-viewport]");if(i||(i=n.querySelector("[data-viewport]")),i||(i=n.querySelector('[role="region"]')),i||(i=n.querySelector('div[style*="overflow"]')),i||(i=n.querySelector("[data-scrollable]")),!i){const x=n.querySelectorAll("div");for(const C of x){const z=window.getComputedStyle(C);if(z.overflow==="auto"||z.overflow==="scroll"||z.overflowY==="auto"||z.overflowY==="scroll"||C.scrollHeight>C.clientHeight){i=C;break}}}if(!i){const x=n.querySelector('.ProseMirror, [contenteditable="true"]');x&&(i=x.closest('div[style*="overflow"]')||x.closest("[data-radix-scroll-area-viewport]")||x.parentElement)}if(i){const x=i.scrollHeight-i.clientHeight;i.scrollTop=x,requestAnimationFrame(()=>{i.scrollTop=i.scrollHeight,i.scrollTo&&i.scrollTo({top:i.scrollHeight,behavior:"instant"})})}else console.warn("Could not find scrollable viewport in ScrollArea",{scrollAreaEl:n,children:n.children,mode:Y.value?"preview":"editor",fullscreen:p.value})}catch(e){console.warn("Auto-scroll failed:",e)}else{const e=document.querySelector(".ProseMirror");e&&e.scrollIntoView({behavior:"instant",block:"end"})}}})},Br=()=>{const a=new URLSearchParams(window.location.search),e=a.get("ai_generate")==="true",n=a.get("generation_type");e&&n&&setTimeout(()=>{if(n==="progressive"){pt("progressive");const i=new URL(window.location.href);i.searchParams.delete("ai_generate"),i.searchParams.delete("generation_type"),window.history.replaceState({},"",i.toString()),E.success("üöÄ AI Generation Started",{description:`Generating ${l.chapter.title} with AI assistance...`})}else if(n==="single"){pt("progressive");const i=new URL(window.location.href);i.searchParams.delete("ai_generate"),i.searchParams.delete("generation_type"),window.history.replaceState({},"",i.toString()),E.success("üöÄ AI Generation Started",{description:`Generating ${l.chapter.title} with AI assistance...`})}},1e3)},Lt=a=>{if((a.ctrlKey||a.metaKey)&&!["INPUT","TEXTAREA","SELECT"].includes(a.target?.tagName))switch(a.key){case"ArrowLeft":a.preventDefault();const e=l.chapter.chapter_number-1;l.allChapters.find(C=>C.chapter_number===e)&&He(e);break;case"ArrowRight":a.preventDefault();const i=l.chapter.chapter_number+1;l.allChapters.find(C=>C.chapter_number===i)&&He(i);break}};at(()=>{const a=e=>{const n=i=>{const{scrollTop:x,scrollHeight:C,clientHeight:z}=e,Z=i.deltaY,X=x<=0,ee=x+z>=C;Z<0&&X||Z>0&&ee||i.stopPropagation()};return e.addEventListener("wheel",n,{passive:!0}),()=>e.removeEventListener("wheel",n)};st(()=>{const e=document.querySelectorAll('[class*="overflow-y-auto"]'),n=[];e.forEach(i=>{if(i instanceof HTMLElement){const x=a(i);n.push(x)}}),window.__scrollChainCleanup=n})}),ea(()=>{Er(),P.value&&P.value.close(),document.removeEventListener("keydown",Nt),document.removeEventListener("keydown",Lt);const a=window.__scrollChainCleanup;a&&Array.isArray(a)&&(a.forEach(e=>e()),delete window.__scrollChainCleanup),document.removeEventListener("fullscreenchange",De),document.removeEventListener("webkitfullscreenchange",De),document.removeEventListener("msfullscreenchange",De)}),Be(m,Kr),Be(_,ze),Be(()=>l.chapter,async a=>{_.value=a.title||"",m.value=a.content||"",ue.value=[],Xr(),Wt(),await Ke(),await st(()=>{Ht()})},{immediate:!1});const ue=c([]),Ue=c(!1),Ve=c(!1),Qe=c(null),le=A(()=>l.chapter),zt=async a=>{pe.value=a,a&&Jr()&&await Ke()},Jr=()=>{if(!ue.value.length||!Qe.value)return!0;const a=new Date(Date.now()-360*60*1e3);return Qe.value<a},Ke=async(a=!1)=>{if(!Ue.value){Ue.value=!0;try{console.log("Loading defense questions with params:",{project_id:l.project.id,chapter_number:le.value?.chapter_number,limit:5,force_refresh:a});const e=await we.get(`/api/projects/${l.project.id}/defense/questions`,{params:{chapter_number:le.value?.chapter_number||null,limit:5,force_refresh:a?1:0},headers:{Accept:"application/json","X-Requested-With":"XMLHttpRequest"}});if(console.log("Defense questions loaded:",e.data),console.log("Questions array:",e.data.questions),console.log("Questions count:",e.data.questions?e.data.questions.length:0),ue.value=e.data.questions||[],Qe.value=new Date,e.data.questions&&e.data.questions.length>0){const n=`defense_questions_${l.project.id}_chapter_${le.value?.chapter_number}`;localStorage.setItem(n,JSON.stringify({questions:e.data.questions,chapter_number:le.value?.chapter_number,loaded_at:new Date().toISOString()}))}else a||(console.log("No existing questions found for this chapter"),console.log(`Current word count: ${W.value}/${et}`),console.log('User must click "Generate Questions" button to create defense questions'))}catch(e){if(console.error("Failed to load defense questions:",e),e.response)if(console.error("Response status:",e.response.status),console.error("Response data:",e.response.data),e.response.status===422){console.error("Validation errors:",e.response.data.errors);const n=Object.values(e.response.data.errors||{})[0];n&&Array.isArray(n)?E.error(`Validation Error: ${n[0]}`):E.error("Invalid request parameters. Please refresh the page.")}else e.response.status===500?E.error("Server error. Please try again later."):E.error("Failed to load defense questions");else e.request?(console.error("No response received:",e.request),E.error("Network error. Please check your connection.")):(console.error("Error setting up request:",e.message),E.error("An unexpected error occurred"));ue.value=[]}finally{Ue.value=!1}}},It=async()=>{if(!Ve.value){Ve.value=!0;try{const a=await we.post(`/api/projects/${l.project.id}/defense/questions/generate`,{chapter_number:le.value.chapter_number},{headers:{"X-CSRF-TOKEN":document.querySelector('meta[name="csrf-token"]')?.getAttribute("content"),Accept:"application/json","Content-Type":"application/json"}});if(a.data&&a.data.questions){ue.value=a.data.questions,Qe.value=new Date;const e=`defense_questions_${l.project.id}_chapter_${le.value?.chapter_number}`;localStorage.setItem(e,JSON.stringify({questions:a.data.questions,chapter_number:le.value?.chapter_number,loaded_at:new Date().toISOString()})),E.success(`Generated ${a.data.questions.length} new questions`)}}catch(a){console.error("Failed to generate defense questions:",a),E.error("Failed to generate defense questions")}finally{Ve.value=!1}}},{hasTriggeredGeneration:ht,startWatching:Wt,stopWatching:Xr,forceCheck:Ht,getStatusMessage:Gt}=za(l.project,l.chapter,m),Ut=Dr,Vt=A(()=>{const a=W.value;return a>0&&a<et&&!ht.value}),Qt=Fr,Kt=Mr,Bt=async(a,e)=>{try{await we.patch(`/api/projects/${l.project.id}/defense/questions/${a}`,{user_marked_helpful:e},{headers:{"X-CSRF-TOKEN":document.querySelector('meta[name="csrf-token"]')?.getAttribute("content"),Accept:"application/json","Content-Type":"application/json"}});const n=ue.value.find(i=>i.id===a);n&&(n.user_marked_helpful=e),E.success(e?"Question marked as helpful":"Removed helpful mark")}catch(n){console.error("Failed to mark question:",n),E.error("Failed to update question")}},Jt=async a=>{try{await we.delete(`/api/projects/${l.project.id}/defense/questions/${a}`,{headers:{"X-CSRF-TOKEN":document.querySelector('meta[name="csrf-token"]')?.getAttribute("content"),Accept:"application/json"}}),ue.value=ue.value.filter(e=>e.id!==a),localStorage.setItem(`defense_questions_${l.project.id}`,JSON.stringify({questions:ue.value,loaded_at:new Date().toISOString()})),E.success("Question hidden")}catch(e){console.error("Failed to hide question:",e),E.error("Failed to hide question")}};at(async()=>{const a=`defense_questions_${l.project.id}_chapter_${le.value?.chapter_number}`,e=localStorage.getItem(a);let n=!0;if(e){const i=JSON.parse(e),x=new Date(i.loaded_at),C=new Date(Date.now()-360*60*1e3);x>C&&i.chapter_number===le.value?.chapter_number&&(ue.value=i.questions,Qe.value=x,n=!1)}n&&await Ke(),Wt(),await st(()=>{Ht()})}),at(async()=>{await Pr(),W.value>=800&&await Ze()});let ft=null;return Be(W,(a,e)=>{ft&&clearTimeout(ft),a>=800&&Math.abs(a-e)>=100&&(ft=setTimeout(async()=>{await Ze()},5e3))}),(a,e)=>(y(),G(t(ia),null,{default:o(()=>[K.value?(y(),G(t(h),{key:0,project:me.value,chapter:be.value,"chapter-title":_.value,"chapter-content":m.value,"current-word-count":t(W),"target-word-count":ie.value,"progress-percentage":t(Ie),"writing-quality-score":t(xe),"is-valid":We.value,"is-saving":t(je),"show-preview":O.value,"is-generating":j.value,"generation-progress":k.value,"history-index":t(Ar),"content-history-length":t(Tr).length,"selected-text":U.value,"onUpdate:chapterTitle":e[0]||(e[0]=n=>_.value=n),"onUpdate:chapterContent":e[1]||(e[1]=n=>m.value=n),"onUpdate:selectedText":e[2]||(e[2]=n=>U.value=n),"onUpdate:showPreview":e[3]||(e[3]=n=>O.value=n),onSave:e[4]||(e[4]=n=>Rt(n)),onUndo:qt,onRedo:Pt,onExitChatMode:Ur},null,8,["project","chapter","chapter-title","chapter-content","current-word-count","target-word-count","progress-percentage","writing-quality-score","is-valid","is-saving","show-preview","is-generating","generation-progress","history-index","content-history-length","selected-text"])):J.value?(y(),G(t(d),{key:1,project:me.value,chapter:be.value,"chapter-title":_.value,"chapter-content":m.value,"current-word-count":t(W),"target-word-count":ie.value,"progress-percentage":t(Ie),onExitCitationMode:Qr},null,8,["project","chapter","chapter-title","chapter-content","current-word-count","target-word-count","progress-percentage"])):p.value?(y(),L("div",Wa,[e[55]||(e[55]=r("div",{class:"absolute inset-0 z-0 overflow-hidden pointer-events-none"},[r("div",{class:"absolute top-[-20%] left-[-10%] w-[50%] h-[50%] rounded-full bg-blue-500/5 blur-[120px]"}),r("div",{class:"absolute bottom-[-20%] right-[-10%] w-[50%] h-[50%] rounded-full bg-purple-500/5 blur-[120px]"})],-1)),r("div",Ha,[r("div",Ga,[s(t(re),null,{default:o(()=>[s(t(ae),{asChild:""},{default:o(()=>[s(t(I),{onClick:e[5]||(e[5]=n=>t(nt).visit(t(ne)("projects.show",l.project.slug))),variant:"ghost",size:"icon",class:"h-10 w-10 rounded-full hover:bg-primary/10 hover:text-primary transition-all duration-300"},{default:o(()=>[s(t(or),{class:"h-5 w-5"})]),_:1})]),_:1}),s(t(se),null,{default:o(()=>[...e[33]||(e[33]=[r("p",null,"Back to Project",-1)])]),_:1})]),_:1}),r("div",Ua,[r("h1",Va,g(l.project.title),1),r("div",Qa,[s(t(Se),{variant:"outline",class:"h-5 px-2 rounded-full border-primary/20 bg-primary/5 text-primary font-medium"},{default:o(()=>[N(" Chapter "+g(l.chapter.chapter_number),1)]),_:1}),r("span",Ka,[e[34]||(e[34]=r("span",{class:"h-1.5 w-1.5 rounded-full bg-green-500 animate-pulse"},null,-1)),N(" "+g(t(W))+" words ",1)])])])]),r("div",Ba,[r("div",Ja,[s(t(I),{onClick:e[6]||(e[6]=n=>he.value=!he.value),variant:he.value?"secondary":"ghost",size:"sm",class:oe(["h-8 px-4 rounded-full text-xs font-medium transition-all duration-300",he.value?"bg-primary/10 text-primary hover:bg-primary/15":"hover:bg-muted"])},{default:o(()=>[s(t(er),{class:"mr-2 h-3.5 w-3.5"}),e[35]||(e[35]=N(" Outline ",-1))]),_:1},8,["variant","class"]),e[37]||(e[37]=r("div",{class:"w-px h-4 bg-border/50 mx-1"},null,-1)),s(t(I),{onClick:e[7]||(e[7]=n=>Ee.value=!Ee.value),variant:Ee.value?"secondary":"ghost",size:"sm",class:oe(["h-8 px-4 rounded-full text-xs font-medium transition-all duration-300",Ee.value?"bg-primary/10 text-primary hover:bg-primary/15":"hover:bg-muted"])},{default:o(()=>[s(t(lt),{class:"mr-2 h-3.5 w-3.5"}),e[36]||(e[36]=N(" Assistant ",-1))]),_:1},8,["variant","class"])]),r("div",Xa,[s(t(re),null,{default:o(()=>[s(t(ae),{asChild:""},{default:o(()=>[s(t(I),{onClick:e[8]||(e[8]=n=>R.value=!R.value),variant:R.value?"secondary":"ghost",size:"icon",class:"h-9 w-9 rounded-full transition-all hover:bg-muted"},{default:o(()=>[s(t(lr),{class:"h-4.5 w-4.5 text-muted-foreground"})]),_:1},8,["variant"])]),_:1}),s(t(se),null,{default:o(()=>[r("p",null,g(R.value?"Hide":"Show")+" Statistics",1)]),_:1})]),_:1}),s(t(re),null,{default:o(()=>[s(t(ae),{asChild:""},{default:o(()=>[s(t(I),{onClick:Mt,variant:"ghost",size:"icon",class:"h-9 w-9 rounded-full transition-all hover:bg-muted"},{default:o(()=>[T.value?(y(),G(t(ur),{key:1,class:"h-4.5 w-4.5 text-muted-foreground"})):(y(),G(t(ir),{key:0,class:"h-4.5 w-4.5 text-muted-foreground"}))]),_:1})]),_:1}),s(t(se),null,{default:o(()=>[...e[38]||(e[38]=[r("p",null,"Toggle Theme",-1)])]),_:1})]),_:1}),s(bt,{project:me.value,"current-chapter":be.value,"all-chapters":Ae.value,size:"icon",variant:"ghost",class:"h-9 w-9 rounded-full hover:bg-muted"},null,8,["project","current-chapter","all-chapters"])])])]),r("div",Ya,[r("div",{class:"absolute top-0 left-0 h-full bg-gradient-to-r from-blue-500 via-purple-500 to-pink-500 transition-all duration-700 ease-out shadow-[0_0_10px_rgba(59,130,246,0.5)]",style:Ne({width:`${Math.min(t(Ie),100)}%`})},null,4)]),j.value?(y(),L("div",Za,[r("div",es,[e[44]||(e[44]=r("div",{class:"absolute inset-0 -skew-x-12 animate-pulse bg-gradient-to-r from-transparent via-white/10 to-transparent"},null,-1)),r("div",ts,[r("div",rs,[r("div",as,[r("div",ss,[s(t(lt),{class:"h-3 w-3 text-white"})]),e[39]||(e[39]=r("div",{class:"absolute inset-0 h-6 w-6 animate-ping rounded-full bg-gradient-to-br from-blue-500 to-purple-600 opacity-20"},null,-1))]),r("div",null,[e[40]||(e[40]=r("h4",{class:"text-xs font-semibold text-blue-900 dark:text-blue-100"},"AI Generator",-1)),r("p",ns,g(w.value),1)])]),s(t(Se),{variant:"outline",class:"border-blue-300 text-xs text-blue-700 dark:border-blue-700 dark:text-blue-300"},{default:o(()=>[N(g(Math.round(u.value))+"% ",1)]),_:1})]),r("div",os,[r("div",ls,[e[41]||(e[41]=r("span",{class:"text-xs text-blue-800 dark:text-blue-200"},"Generation Progress",-1)),r("span",is,g(q.value)+" / "+g(H.value)+" words",1)]),r("div",us,[r("div",{class:"absolute top-0 left-0 h-full rounded-full bg-gradient-to-r from-blue-500 to-purple-500 transition-all duration-500 ease-out",style:Ne({width:`${u.value}%`})},[...e[42]||(e[42]=[r("div",{class:"absolute inset-0 animate-pulse bg-gradient-to-r from-transparent via-white/30 to-transparent"},null,-1)])],4),r("div",{class:"absolute top-0 left-0 h-full rounded-full bg-gradient-to-r from-blue-400 to-purple-400 opacity-50 blur-sm transition-all duration-500",style:Ne({width:`${u.value}%`})},null,4)])]),r("div",cs,[r("div",ds,[w.value==="Initializing"?(y(),L("div",ps)):w.value==="Connecting"?(y(),L("div",vs,[...e[43]||(e[43]=[r("div",{class:"h-2 w-0.5 animate-pulse rounded-full bg-blue-500"},null,-1),r("div",{class:"h-2 w-0.5 animate-pulse rounded-full bg-purple-500",style:{"animation-delay":"0.2s"}},null,-1),r("div",{class:"h-2 w-0.5 animate-pulse rounded-full bg-blue-500",style:{"animation-delay":"0.4s"}},null,-1)])])):w.value==="Generating"?(y(),L("div",gs)):w.value==="Complete"?(y(),L("div",hs)):(y(),L("div",fs))]),r("p",ms,g(k.value),1)])])])):ce("",!0),R.value?(y(),G(dr,{key:1,"show-statistics":R.value,"current-word-count":t(W),"writing-stats":t(ut),"quality-analysis":t(B),"is-analyzing":t(_e),class:"relative z-20 mx-4 mt-2 rounded-lg border border-border/40 bg-background/60 backdrop-blur-md"},null,8,["show-statistics","current-word-count","writing-stats","quality-analysis","is-analyzing"])):ce("",!0),r("div",bs,[s(Yt,{"enter-active-class":"transition-all duration-300 ease-in-out","enter-from-class":"-ml-72 opacity-0","enter-to-class":"ml-0 opacity-100","leave-active-class":"transition-all duration-300 ease-in-out","leave-from-class":"ml-0 opacity-100","leave-to-class":"-ml-72 opacity-0"},{default:o(()=>[he.value?(y(),L("div",ws,[r("div",ys,[r("div",xs,[r("div",_s,[e[45]||(e[45]=r("h2",{class:"text-sm font-semibold text-foreground mb-1"},"Table of Contents",-1)),r("p",Cs,g(Ae.value.length)+" Chapters ",1)]),(y(),G(ot,null,{fallback:o(()=>[...e[46]||(e[46]=[r("div",{class:"flex items-center justify-center p-8"},[r("div",{class:"h-6 w-6 animate-spin rounded-full border-2 border-primary border-t-transparent"})],-1)])]),default:o(()=>[s(t($),{"all-chapters":Ae.value,"current-chapter":be.value,project:me.value,outlines:a.project.outlines||[],"faculty-chapters":a.facultyChapters||[],"current-word-count":t(W),"target-word-count":ie.value,"writing-quality-score":t(xe),"chapter-content-length":m.value.length,onGoToChapter:He,onGenerateNextChapter:ct},null,8,["all-chapters","current-chapter","project","outlines","faculty-chapters","current-word-count","target-word-count","writing-quality-score","chapter-content-length"])]),_:1}))])])])):ce("",!0)]),_:1}),r("div",Ss,[r("div",Es,[r("div",ks,[s(t(Ct),{class:"w-full max-w-[850px] min-h-[calc(100vh-180px)] flex flex-col bg-background shadow-xl shadow-black/5 ring-1 ring-black/5 dark:ring-white/10 rounded-xl overflow-hidden transition-all duration-300"},{default:o(()=>[s(t(Et),{class:"flex-shrink-0 border-b border-border/30 px-8 py-6 bg-background/50 backdrop-blur-sm sticky top-0 z-10"},{default:o(()=>[r("div",Ts,[r("div",As,[s(t(mt),{for:"chapter-title-fs",class:"text-xs font-medium text-muted-foreground uppercase tracking-wider"},{default:o(()=>[...e[47]||(e[47]=[N("Chapter Title",-1)])]),_:1}),s(t(Zt),{id:"chapter-title-fs",modelValue:_.value,"onUpdate:modelValue":e[9]||(e[9]=n=>_.value=n),placeholder:"Enter chapter title...",class:"h-auto p-0 border-0 bg-transparent text-2xl font-bold placeholder:text-muted-foreground/40 focus-visible:ring-0 px-0"},null,8,["modelValue"])]),r("div",$s,[s(t(Se),{variant:a.chapter.status==="approved"?"default":"secondary",class:"rounded-full px-3"},{default:o(()=>[N(g(a.chapter.status.replace("_"," ")),1)]),_:1},8,["variant"]),s(t(Se),{variant:"outline",class:oe(["rounded-full px-3 transition-colors",{"text-green-600 border-green-200 bg-green-50 dark:bg-green-900/20 dark:border-green-800":(t(B)?.total_score||0)>=80,"text-yellow-600 border-yellow-200 bg-yellow-50 dark:bg-yellow-900/20 dark:border-yellow-800":(t(B)?.total_score||0)>=70&&(t(B)?.total_score||0)<80,"text-orange-600 border-orange-200 bg-orange-50 dark:bg-orange-900/20 dark:border-orange-800":(t(B)?.total_score||0)>=60&&(t(B)?.total_score||0)<70,"text-red-600 border-red-200 bg-red-50 dark:bg-red-900/20 dark:border-red-800":(t(B)?.total_score||0)<60}])},{default:o(()=>[N(g(t(B)?.total_score?Math.round(t(B).total_score):t(xe))+"% Quality ",1)]),_:1},8,["class"])])])]),_:1}),s(t(St),{class:"flex min-h-0 flex-1 flex-col p-0"},{default:o(()=>[r("div",Rs,[r("div",qs,[s(t(I),{onClick:Ft,variant:Y.value?"default":"ghost",size:"sm",class:"h-7 text-xs rounded-full"},{default:o(()=>[s(t(wt),{class:"mr-1.5 h-3.5 w-3.5"}),N(" "+g(Y.value?"Edit":"Preview"),1)]),_:1},8,["variant"])]),r("div",Ps,[r("div",js,g(a.aiChapterAnalysis?.section.name||a.getSectionInfo(a.nextSection).name),1),r("div",Ds,g(a.aiChapterAnalysis?.section.description||a.getSectionInfo(a.nextSection).description),1)])]),r("div",Ms,[Me(s(ar,{modelValue:m.value,"onUpdate:modelValue":e[10]||(e[10]=n=>m.value=n),placeholder:"Start writing your chapter...","min-height":"500px",class:"min-h-[500px] px-8 py-6",ref_key:"richTextEditor",ref:tt,"show-toolbar":!0,"onUpdate:selectedText":e[11]||(e[11]=n=>{U.value=n})},null,8,["modelValue"]),[[Fe,!Y.value]]),Me(r("div",Fs,[s(tr,{content:m.value,"show-font-controls":!1,class:"prose-lg mx-auto",style:{"font-family":"'Times New Roman', serif","line-height":"1.8"}},null,8,["content"])],512),[[Fe,Y.value]])])]),_:1}),r("div",Ns,[r("div",Os,g(t(je)?"Saving...":"All changes saved"),1),r("div",Ls,[s(t(I),{onClick:e[12]||(e[12]=n=>t(fe)(!1)),disabled:!We.value||t(je),size:"sm",variant:"ghost",class:"h-8 rounded-full"},{default:o(()=>[s(t(sr),{class:"mr-2 h-3.5 w-3.5"}),e[48]||(e[48]=N(" Save Draft ",-1))]),_:1},8,["disabled"]),s(t(I),{onClick:t(Ze),disabled:t(_e)||t(W)<100,variant:"outline",size:"sm",class:"h-8 rounded-full"},{default:o(()=>[s(t(Je),{class:oe(["mr-2 h-3.5 w-3.5",{"animate-pulse":t(_e)}])},null,8,["class"]),e[49]||(e[49]=N(" Analyze ",-1))]),_:1},8,["onClick","disabled"]),s(t(I),{onClick:e[13]||(e[13]=n=>t(fe)(!1)),disabled:!We.value||t(W)<ie.value*.8,size:"sm",class:"h-8 rounded-full bg-gradient-to-r from-primary to-primary/90 shadow-sm hover:shadow-md transition-all"},{default:o(()=>[s(t(cr),{class:"mr-2 h-3.5 w-3.5"}),e[50]||(e[50]=N(" Complete ",-1))]),_:1},8,["disabled"])])])]),_:1}),e[51]||(e[51]=r("div",{class:"h-12"},null,-1))])])]),s(Yt,{"enter-active-class":"transition-all duration-300 ease-in-out","enter-from-class":"-mr-72 opacity-0","enter-to-class":"mr-0 opacity-100","leave-active-class":"transition-all duration-300 ease-in-out","leave-from-class":"mr-0 opacity-100","leave-to-class":"-mr-72 opacity-0"},{default:o(()=>[Ee.value?(y(),L("div",zs,[r("div",Is,[r("div",Ws,[(y(),G(ot,null,{fallback:o(()=>[...e[52]||(e[52]=[r("div",{class:"flex items-center justify-center p-8"},[r("div",{class:"h-6 w-6 animate-spin rounded-full border-2 border-primary border-t-transparent"})],-1)])]),default:o(()=>[s(t(S),{project:me.value,chapter:be.value,"is-generating":j.value,"selected-text":U.value,"is-loading-suggestions":Oe.value,"show-citation-helper":ke.value,"chapter-content":m.value,"current-word-count":t(W),"target-word-count":ie.value,onStartStreamingGeneration:dt,onGetAiSuggestions:vt,"onUpdate:showCitationHelper":e[14]||(e[14]=n=>ke.value=n),onInsertCitation:jt,onCheckCitations:gt},null,8,["project","chapter","is-generating","selected-text","is-loading-suggestions","show-citation-helper","chapter-content","current-word-count","target-word-count"])]),_:1})),(y(),G(ot,null,{fallback:o(()=>[...e[53]||(e[53]=[r("div",{class:"flex items-center justify-center p-4"},[r("div",{class:"h-4 w-4 animate-spin rounded-full border-2 border-muted border-t-transparent"})],-1)])]),default:o(()=>[s(t(b),{"show-defense-prep":pe.value,questions:ue.value,"is-loading":Ue.value,"is-generating":Ve.value,"chapter-context":{chapter_number:le.value.chapter_number,chapter_title:le.value.title,word_count:t(W)},"defense-watcher":{meetsThreshold:t(Ut),shouldShowProgress:Vt.value,progressPercentage:t(Qt),wordsRemaining:t(Kt),hasTriggeredGeneration:t(ht),threshold:t(et),statusMessage:t(Gt)()},"onUpdate:showDefensePrep":zt,onGenerateMore:It,onRefresh:e[15]||(e[15]=()=>Ke(!0)),onMarkHelpful:Bt,onHideQuestion:Jt},null,8,["show-defense-prep","questions","is-loading","is-generating","chapter-context","defense-watcher"])]),_:1})),(y(),G(ot,null,{fallback:o(()=>[...e[54]||(e[54]=[r("div",{class:"flex items-center justify-center p-4"},[r("div",{class:"h-4 w-4 animate-spin rounded-full border-2 border-muted border-t-transparent"})],-1)])]),default:o(()=>[s(t(v),{"chapter-id":le.value.id,content:m.value},null,8,["chapter-id","content"])]),_:1}))])])])):ce("",!0)]),_:1})])])):(y(),G(la,{key:3,class:"h-screen overflow-hidden"},{default:o(()=>[r("div",Hs,[r("div",Gs,[r("div",Us,[r("div",Vs,[s(t(re),null,{default:o(()=>[s(t(ae),{asChild:""},{default:o(()=>[s(t(I),{onClick:e[16]||(e[16]=n=>t(nt).visit(t(ne)("projects.show",l.project.slug))),variant:"ghost",size:"icon",class:"hidden sm:flex"},{default:o(()=>[s(t(or),{class:"h-4 w-4"})]),_:1})]),_:1}),s(t(se),null,{default:o(()=>[...e[56]||(e[56]=[r("p",null,"Back to Project",-1)])]),_:1})]),_:1}),r("div",null,[r("h1",Qs,g(l.project.title),1),r("p",Ks," Chapter "+g(l.chapter.chapter_number)+" ‚Ä¢ "+g(t(W))+" / "+g(ie.value)+" words ",1)])]),r("div",Bs,[s(t(re),null,{default:o(()=>[s(t(ae),{asChild:""},{default:o(()=>[s(t(I),{onClick:e[17]||(e[17]=n=>ge.value=!0),variant:"outline",size:"icon",class:"lg:hidden"},{default:o(()=>[s(t(er),{class:"h-4 w-4"})]),_:1})]),_:1}),s(t(se),null,{default:o(()=>[...e[57]||(e[57]=[r("p",null,"Chapter Navigation",-1)])]),_:1})]),_:1}),s(t(re),null,{default:o(()=>[s(t(ae),{asChild:""},{default:o(()=>[s(t(I),{onClick:e[18]||(e[18]=n=>f.value=!0),variant:"outline",size:"icon",class:"lg:hidden"},{default:o(()=>[s(t(lt),{class:"h-4 w-4"})]),_:1})]),_:1}),s(t(se),null,{default:o(()=>[...e[58]||(e[58]=[r("p",null,"AI Tools & Defense Prep",-1)])]),_:1})]),_:1}),r("div",Js,[s(t(re),null,{default:o(()=>[s(t(ae),{asChild:""},{default:o(()=>[s(t(I),{onClick:Gr,variant:K.value?"default":"outline",size:"sm"},{default:o(()=>[s(t(da),{class:"h-4 w-4"})]),_:1},8,["variant"])]),_:1}),s(t(se),null,{default:o(()=>[r("p",null,g(K.value?"Exit":"Open")+" AI Chat Assistant",1)]),_:1})]),_:1}),s(t(re),null,{default:o(()=>[s(t(ae),{asChild:""},{default:o(()=>[s(t(I),{onClick:Vr,variant:J.value?"default":"outline",size:"sm"},{default:o(()=>[s(t(Je),{class:"h-4 w-4"})]),_:1},8,["variant"])]),_:1}),s(t(se),null,{default:o(()=>[r("p",null,g(J.value?"Exit":"Open")+" Citation Verification",1)]),_:1})]),_:1}),s(t(re),null,{default:o(()=>[s(t(ae),{asChild:""},{default:o(()=>[s(t(I),{onClick:e[19]||(e[19]=n=>R.value=!R.value),variant:R.value?"default":"outline",size:"sm"},{default:o(()=>[s(t(lr),{class:"h-4 w-4"})]),_:1},8,["variant"])]),_:1}),s(t(se),null,{default:o(()=>[r("p",null,g(R.value?"Hide":"Show")+" Writing Statistics",1)]),_:1})]),_:1}),s(t(re),null,{default:o(()=>[s(t(ae),{asChild:""},{default:o(()=>[s(t(I),{onClick:Mt,variant:"outline",size:"sm"},{default:o(()=>[T.value?(y(),G(t(ur),{key:1,class:"h-4 w-4"})):(y(),G(t(ir),{key:0,class:"h-4 w-4"}))]),_:1})]),_:1}),s(t(se),null,{default:o(()=>[r("p",null,"Switch to "+g(T.value?"Light":"Dark")+" Mode",1)]),_:1})]),_:1}),s(t(re),null,{default:o(()=>[s(t(ae),{asChild:""},{default:o(()=>[s(t(I),{onClick:Dt,variant:p.value?"default":"outline",size:"sm"},{default:o(()=>[s(t(ra),{class:"h-4 w-4"})]),_:1},8,["variant"])]),_:1}),s(t(se),null,{default:o(()=>[r("p",null,g(p.value?"Exit":"Enter")+" Fullscreen Mode (F11)",1)]),_:1})]),_:1}),s(bt,{project:me.value,"current-chapter":be.value,"all-chapters":Ae.value,size:"sm"},null,8,["project","current-chapter","all-chapters"])])])]),r("div",Xs,[r("div",Ys,[e[59]||(e[59]=r("span",{class:"text-sm font-medium"},"Writing Progress",-1)),r("span",Zs,g(t(W))+" / "+g(ie.value)+" words ("+g(Math.round(t(Ie)))+"%)",1)]),s(t(gr),{"model-value":Number(t(Ie)),class:"h-2"},null,8,["model-value"])]),j.value?(y(),L("div",en,[r("div",tn,[e[66]||(e[66]=r("div",{class:"absolute inset-0 -skew-x-12 animate-pulse bg-gradient-to-r from-transparent via-white/10 to-transparent"},null,-1)),r("div",rn,[r("div",an,[r("div",sn,[r("div",nn,[s(t(lt),{class:"h-4 w-4 text-white"})]),e[60]||(e[60]=r("div",{class:"absolute inset-0 h-8 w-8 animate-ping rounded-full bg-gradient-to-br from-blue-500 to-purple-600 opacity-20"},null,-1))]),r("div",null,[e[61]||(e[61]=r("h4",{class:"text-sm font-semibold text-blue-900 dark:text-blue-100"},"AI Chapter Generator ",-1)),r("p",on,g(w.value),1)])]),s(t(Se),{variant:"outline",class:"border-blue-300 text-xs text-blue-700 dark:border-blue-700 dark:text-blue-300"},{default:o(()=>[N(g(Math.round(u.value))+"% ",1)]),_:1})]),r("div",ln,[r("div",un,[e[62]||(e[62]=r("span",{class:"text-xs text-blue-800 dark:text-blue-200"},"Generation Progress",-1)),r("span",cn,g(q.value)+" / "+g(H.value)+" words",1)]),r("div",dn,[r("div",{class:"absolute top-0 left-0 h-full rounded-full bg-gradient-to-r from-blue-500 to-purple-500 transition-all duration-500 ease-out",style:Ne({width:`${u.value}%`})},[...e[63]||(e[63]=[r("div",{class:"absolute inset-0 animate-pulse bg-gradient-to-r from-transparent via-white/30 to-transparent"},null,-1)])],4),r("div",{class:"absolute top-0 left-0 h-full rounded-full bg-gradient-to-r from-blue-400 to-purple-400 opacity-50 blur-sm transition-all duration-500",style:Ne({width:`${u.value}%`})},null,4)])]),r("div",pn,[r("div",vn,[w.value==="Initializing"?(y(),L("div",gn)):w.value==="Connecting"?(y(),L("div",hn,[...e[64]||(e[64]=[r("div",{class:"h-3 w-1 animate-pulse rounded-full bg-blue-500"},null,-1),r("div",{class:"h-3 w-1 animate-pulse rounded-full bg-purple-500",style:{"animation-delay":"0.2s"}},null,-1),r("div",{class:"h-3 w-1 animate-pulse rounded-full bg-blue-500",style:{"animation-delay":"0.4s"}},null,-1)])])):w.value==="Generating"?(y(),L("div",fn)):w.value==="Complete"?(y(),L("div",mn)):(y(),L("div",bn))]),r("p",wn,g(k.value),1)]),w.value==="Generating"&&q.value>50?(y(),L("div",yn,[r("div",xn,[e[65]||(e[65]=r("span",{class:"text-blue-700 dark:text-blue-300"},"Writing Quality",-1)),r("div",_n,[r("div",Cn,[(y(),L(xt,null,_t(5,n=>r("div",{key:n,class:oe(["h-2 w-2 rounded-full",n<=Math.ceil(t(xe)/20)?"bg-yellow-400":"bg-blue-200 dark:bg-blue-800"])},null,2)),64))]),r("span",Sn,g(t(xe))+"%",1)])])])):ce("",!0)])])):ce("",!0),s(dr,{"show-statistics":R.value,"current-word-count":t(W),"writing-stats":t(ut),"quality-analysis":t(B),"is-analyzing":t(_e)},null,8,["show-statistics","current-word-count","writing-stats","quality-analysis","is-analyzing"]),r("div",En,[Me(r("div",kn,[r("div",Tn,[s(t($),{"all-chapters":Ae.value,"current-chapter":be.value,project:me.value,outlines:a.project.outlines||[],"faculty-chapters":a.facultyChapters||[],"current-word-count":t(W),"target-word-count":ie.value,"writing-quality-score":t(xe),"chapter-content-length":m.value.length,onGoToChapter:He,onGenerateNextChapter:ct},null,8,["all-chapters","current-chapter","project","outlines","faculty-chapters","current-word-count","target-word-count","writing-quality-score","chapter-content-length"])])],512),[[Fe,!Q.value]]),r("div",{class:oe(["transition-all duration-300",Q.value&&te.value?"lg:col-span-12":Q.value?"lg:col-span-9":te.value?"lg:col-span-10":"lg:col-span-7"])},[s(t(Ct),{class:"border-[0.5px] border-border/50 transition-all duration-300"},{default:o(()=>[s(t(Et),{class:"pb-4"},{default:o(()=>[r("div",An,[r("div",$n,[s(t(I),{variant:"ghost",size:"icon",class:"h-6 w-6 hidden lg:flex mr-1 text-muted-foreground hover:text-foreground",onClick:e[20]||(e[20]=n=>Q.value=!Q.value),title:Q.value?"Expand Sidebar":"Collapse Sidebar"},{default:o(()=>[Q.value?(y(),G(t(sa),{key:1,class:"h-4 w-4"})):(y(),G(t(aa),{key:0,class:"h-4 w-4"}))]),_:1},8,["title"]),s(t(vr),{class:"text-lg"},{default:o(()=>[N("Chapter "+g(a.chapter.chapter_number),1)]),_:1})]),r("div",Rn,[s(t(Se),{variant:a.chapter.status==="approved"?"default":"secondary"},{default:o(()=>[N(g(a.chapter.status.replace("_"," ")),1)]),_:1},8,["variant"]),s(t(Se),{variant:"outline",class:oe(["text-xs",{"text-green-600 border-green-200 bg-green-50":(t(B)?.total_score||0)>=80,"text-yellow-600 border-yellow-200 bg-yellow-50":(t(B)?.total_score||0)>=70&&(t(B)?.total_score||0)<80,"text-orange-600 border-orange-200 bg-orange-50":(t(B)?.total_score||0)>=60&&(t(B)?.total_score||0)<70,"text-red-600 border-red-200 bg-red-50":(t(B)?.total_score||0)<60}])},{default:o(()=>[N(g(t(B)?.total_score?Math.round(t(B).total_score):t(xe))+"% Quality ",1)]),_:1},8,["class"]),s(t(I),{variant:"ghost",size:"icon",class:"h-6 w-6 hidden lg:flex ml-1 text-muted-foreground hover:text-foreground",onClick:e[21]||(e[21]=n=>te.value=!te.value),title:te.value?"Expand Tools":"Collapse Tools"},{default:o(()=>[te.value?(y(),G(t(oa),{key:1,class:"h-4 w-4"})):(y(),G(t(na),{key:0,class:"h-4 w-4"}))]),_:1},8,["title"])])])]),_:1}),s(t(St),{class:"space-y-4"},{default:o(()=>[r("div",qn,[s(t(mt),{for:"chapter-title"},{default:o(()=>[...e[67]||(e[67]=[N("Chapter Title",-1)])]),_:1}),s(t(Zt),{id:"chapter-title",modelValue:_.value,"onUpdate:modelValue":e[22]||(e[22]=n=>_.value=n),placeholder:"Enter chapter title...",class:"text-lg font-medium"},null,8,["modelValue"])]),r("div",Pn,[r("div",jn,[s(t(mt),{for:"chapter-content"},{default:o(()=>[...e[68]||(e[68]=[N("Content",-1)])]),_:1}),r("div",Dn,[s(t(I),{onClick:Ft,variant:Y.value?"default":"outline",size:"sm"},{default:o(()=>[s(t(wt),{class:"mr-1 h-4 w-4"}),N(" "+g(Y.value?"Edit Mode":"Preview Mode"),1)]),_:1},8,["variant"])])]),Me(s(t(rr),{ref_key:"editorFullscreenScrollRef",ref:kt,class:"h-[calc(100vh-320px)] w-full"},{default:o(()=>[s(ar,{modelValue:m.value,"onUpdate:modelValue":e[23]||(e[23]=n=>m.value=n),placeholder:"Start writing your chapter...","min-height":"600px",class:"text-base leading-relaxed",ref_key:"richTextEditorFullscreen",ref:Ge,"onUpdate:selectedText":e[24]||(e[24]=n=>{U.value=n,console.log("üìã ChapterEditor Fullscreen - Selected text updated:",{length:n.length,preview:n.substring(0,50)+(n.length>50?"...":"")})})},null,8,["modelValue"])]),_:1},512),[[Fe,!Y.value]]),Me(s(t(rr),{ref_key:"previewFullscreenScrollRef",ref:Tt,class:"h-[calc(100vh-320px)] w-full"},{default:o(()=>[s(tr,{content:m.value,"show-font-controls":!1,class:"min-h-[600px] rounded-md border border-border/50 bg-background p-6",style:{"font-family":"'Times New Roman', serif","line-height":"1.8"}},null,8,["content"])]),_:1},512),[[Fe,Y.value]])]),r("div",Mn,[s(t(re),null,{default:o(()=>[s(t(ae),{asChild:""},{default:o(()=>[s(t(I),{onClick:e[25]||(e[25]=n=>t(fe)(!1)),disabled:!We.value||t(je),size:"sm",class:"flex-1 sm:flex-none"},{default:o(()=>[s(t(sr),{class:"mr-1 h-3 w-3 sm:mr-2 sm:h-4 sm:w-4"}),r("span",Fn,g(t(je)?"Saving...":"Save Draft"),1),r("span",Nn,g(t(je)?"Saving...":"Save"),1)]),_:1},8,["disabled"])]),_:1}),s(t(se),null,{default:o(()=>[...e[69]||(e[69]=[r("p",null,"Save chapter as draft (Ctrl+S)",-1)])]),_:1})]),_:1}),s(t(re),null,{default:o(()=>[s(t(ae),{asChild:""},{default:o(()=>[s(t(I),{onClick:t(Ze),disabled:t(_e)||t(W)<100,variant:"outline",size:"sm",class:"flex-1 sm:flex-none"},{default:o(()=>[s(t(Je),{class:oe(["mr-1 h-3 w-3 sm:mr-2 sm:h-4 sm:w-4",{"animate-pulse":t(_e)}])},null,8,["class"]),r("span",On,g(t(_e)?"Analyzing...":"Analyze Quality"),1),r("span",Ln,g(t(_e)?"Analyzing...":"Analyze"),1)]),_:1},8,["onClick","disabled"])]),_:1}),s(t(se),null,{default:o(()=>[r("p",null,"Run academic quality analysis ("+g(t(W))+"/100 words min) ",1)]),_:1})]),_:1}),s(t(re),null,{default:o(()=>[s(t(ae),{asChild:""},{default:o(()=>[s(t(I),{onClick:e[26]||(e[26]=n=>O.value=!O.value),variant:"outline",size:"sm",class:"flex-1 sm:flex-none"},{default:o(()=>[O.value?(y(),G(t(pa),{key:1,class:"mr-1 h-3 w-3 sm:mr-2 sm:h-4 sm:w-4"})):(y(),G(t(wt),{key:0,class:"mr-1 h-3 w-3 sm:mr-2 sm:h-4 sm:w-4"})),r("span",zn,g(O.value?"Edit":"Preview"),1),r("span",In,g(O.value?"Edit":"Preview"),1)]),_:1})]),_:1}),s(t(se),null,{default:o(()=>[r("p",null,g(O.value?"Switch to edit mode":"Switch to preview mode"),1)]),_:1})]),_:1}),s(t(re),null,{default:o(()=>[s(t(ae),{asChild:""},{default:o(()=>[s(t(I),{onClick:e[27]||(e[27]=n=>t(fe)(!1)),disabled:!We.value||t(W)<ie.value*.8,size:"sm",class:"flex-1 sm:flex-none"},{default:o(()=>[s(t(cr),{class:"mr-1 h-3 w-3 sm:mr-2 sm:h-4 sm:w-4"}),e[70]||(e[70]=r("span",{class:"hidden sm:inline"},"Save & Mark Complete",-1)),e[71]||(e[71]=r("span",{class:"sm:hidden"},"Complete",-1))]),_:1},8,["disabled"])]),_:1}),s(t(se),null,{default:o(()=>[...e[72]||(e[72]=[r("p",null,"Mark chapter as complete (requires 80% of target word count)",-1)])]),_:1})]),_:1}),s(bt,{project:me.value,"current-chapter":be.value,"all-chapters":Ae.value,size:"sm",variant:"outline",class:"flex-1 sm:flex-none"},null,8,["project","current-chapter","all-chapters"])])]),_:1})]),_:1})],2),Me(r("div",Wn,[r("div",Hn,[s(t(S),{project:me.value,chapter:be.value,"is-generating":j.value,"selected-text":U.value,"is-loading-suggestions":Oe.value,"show-citation-helper":ke.value,"chapter-content":m.value,"current-word-count":t(W),"target-word-count":ie.value,onStartStreamingGeneration:dt,onGetAiSuggestions:vt,"onUpdate:showCitationHelper":e[28]||(e[28]=n=>ke.value=n),onInsertCitation:jt,onCheckCitations:gt},null,8,["project","chapter","is-generating","selected-text","is-loading-suggestions","show-citation-helper","chapter-content","current-word-count","target-word-count"]),s(t(b),{"show-defense-prep":pe.value,questions:ue.value,"is-loading":Ue.value,"is-generating":Ve.value,"chapter-context":{chapter_number:le.value.chapter_number,chapter_title:le.value.title,word_count:t(W)},"defense-watcher":{meetsThreshold:t(Ut),shouldShowProgress:Vt.value,progressPercentage:t(Qt),wordsRemaining:t(Kt),hasTriggeredGeneration:t(ht),threshold:t(et),statusMessage:t(Gt)()},"onUpdate:showDefensePrep":zt,onGenerateMore:It,onRefresh:e[29]||(e[29]=()=>Ke(!0)),onMarkHelpful:Bt,onHideQuestion:Jt},null,8,["show-defense-prep","questions","is-loading","is-generating","chapter-context","defense-watcher"])])],512),[[Fe,!te.value]])]),s(t(M),{"show-left-sidebar":ge.value,"show-right-sidebar":f.value,"is-mobile":V.value,"all-chapters":Ae.value,"current-chapter":be.value,project:me.value,"current-word-count":t(W),"target-word-count":ie.value,"writing-quality-score":t(xe),"chapter-content-length":m.value.length,"is-generating":j.value,"selected-text":U.value,"is-loading-suggestions":Oe.value,"show-citation-helper":ke.value,"chapter-content":m.value,"onUpdate:showLeftSidebar":e[30]||(e[30]=n=>ge.value=n),"onUpdate:showRightSidebar":e[31]||(e[31]=n=>f.value=n),onGoToChapter:He,onGenerateNextChapter:ct,onStartStreamingGeneration:dt,onGetAiSuggestions:vt,"onUpdate:showCitationHelper":e[32]||(e[32]=n=>ke.value=n),onCheckCitations:gt},null,8,["show-left-sidebar","show-right-sidebar","is-mobile","all-chapters","current-chapter","project","current-word-count","target-word-count","writing-quality-score","chapter-content-length","is-generating","selected-text","is-loading-suggestions","show-citation-helper","chapter-content"])])])]),_:1}))]),_:1}))}});export{Wo as default};
