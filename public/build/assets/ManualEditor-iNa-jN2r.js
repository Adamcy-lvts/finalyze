import{bt as $e,cn as L,co as u,cp as p,cB as k,cG as A,cr as o,cq as r,bE as t,cL as ut,cI as rs,cu as F,eK as pt,cF as Ae,bs as l,ci as re,bD as as,g$ as ns,ct as y,cs as D,cS as mt,df as is,du as ht,ia as ls,cb as ce,cl as z,bA as ge,ds as cs,ch as ds,ck as P,cj as w,cR as nt,gN as us,cU as it,ce as W,cV as ps,cy as Te,cW as lt,da as ms,db as hs,d3 as gs,d4 as fs,cZ as vs,c_ as bs,cX as xs,cY as ws,d7 as ys,d8 as ks,cC as _s,d6 as Cs,cA as Ss,dc as js}from"./vendor-DTjPma1U.js";import{_ as v}from"./index-mwxrBKxi.js";import{_ as Ts}from"./index-3KGx5n4o.js";import{_ as V}from"./Separator.vue_vue_type_script_setup_true_lang-BR3TqgAU.js";import{_ as Ms}from"./Progress.vue_vue_type_script_setup_true_lang-C4cUO6LH.js";import{R as As}from"./RichTextEditor-B1rQ9kh3.js";import{c as $s,u as zs,a as Es,_ as Rs,b as Os,M as Ls}from"./useManualEditorSuggestions-D_HSJcnn.js";import{_ as gt}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{_ as Fs}from"./Input.vue_vue_type_script_setup_true_lang-DAeY8mMm.js";import{_ as Is}from"./ScrollArea.vue_vue_type_script_setup_true_lang-BYcw9oF-.js";import{_ as Ps}from"./ChapterNavigation.vue_vue_type_script_setup_true_lang-DLgUgJDB.js";import{u as Us,a as qs,_ as ct}from"./useTextHistory-L8YuMbaR.js";import{f as Bs}from"./Sonner.vue_vue_type_script_setup_true_lang-D0ynKKgD.js";import{a as Ns}from"./WordBalanceDisplay.vue_vue_type_script_setup_true_lang-9Gi9MMOg.js";import{_ as Ds}from"./PurchaseModal.vue_vue_type_script_setup_true_lang-CvI4ReC7.js";import{r as ft,u as Gs}from"./useWordBalance-CuedtyJP.js";import{_ as Hs}from"./FeedbackPromptModal.vue_vue_type_script_setup_true_lang-DQUDiGJ9.js";import{u as Ks}from"./useAppearance-C_-cKrTG.js";import"./vendor-tiptap-CWuLaYAE.js";import"./MermaidExtension-DGYp9fUY.js";import"./vendor-mermaid-Du3yPSaw.js";import"./DialogContent.vue_vue_type_script_setup_true_lang-3pmUscSv.js";import"./DialogDescription.vue_vue_type_script_setup_true_lang-krf9iH0t.js";import"./DialogFooter.vue_vue_type_script_setup_true_lang-Djbi9e8D.js";import"./DialogTitle.vue_vue_type_script_setup_true_lang-DT1UgW8j.js";import"./Label.vue_vue_type_script_setup_true_lang-D84UGLqY.js";import"./CollapsibleTrigger.vue_vue_type_script_setup_true_lang-DUd-t3t3.js";import"./SafeHtmlText.vue_vue_type_script_setup_true_lang-BDeaTbZR.js";import"./DefensePreparationPanel.vue_vue_type_script_setup_true_lang-Dy4WtmVn.js";import"./index-flAI1UrP.js";import"./CardContent.vue_vue_type_script_setup_true_lang-I4CEGKdn.js";import"./CardTitle.vue_vue_type_script_setup_true_lang-CV0UXs4e.js";import"./Switch.vue_vue_type_script_setup_true_lang-BrRclsbs.js";import"./AlertDialogTitle.vue_vue_type_script_setup_true_lang-DLCPkSzL.js";import"./AlertDialogTrigger.vue_vue_type_script_setup_true_lang-Dsx0HQe9.js";import"./Checkbox.vue_vue_type_script_setup_true_lang-Z5kjwJ2x.js";import"./TooltipTrigger.vue_vue_type_script_setup_true_lang-DunnpUO7.js";import"./Textarea.vue_vue_type_script_setup_true_lang-B2qCjWbq.js";const Ws={key:0,class:"fixed bottom-20 left-1/2 z-50 -translate-x-1/2 px-3"},Vs={class:"flex items-center gap-3 rounded-full border bg-background/95 px-4 py-2 shadow-lg backdrop-blur"},Xs={class:"ml-1 flex items-center gap-1"},Qs=$e({__name:"ChapterStarterOverlay",props:{show:{type:Boolean},isGenerating:{type:Boolean}},emits:["regenerate","dismiss"],setup(_,{emit:n}){const b=n;return(m,i)=>(u(),L(Ae,{name:"slide-up"},{default:p(()=>[m.show?(u(),k("div",Ws,[o("div",Vs,[r(t(ut),{class:"h-4 w-4 shrink-0 text-primary"}),i[2]||(i[2]=o("span",{class:"text-sm"},"AI suggests an opening",-1)),i[3]||(i[3]=o("kbd",{class:"rounded bg-muted px-1.5 py-0.5 text-xs"},"Tab",-1)),i[4]||(i[4]=o("span",{class:"text-xs text-muted-foreground"},"to accept",-1)),o("div",Xs,[r(t(v),{variant:"ghost",size:"icon",class:"h-6 w-6",disabled:m.isGenerating,title:"Regenerate",onClick:i[0]||(i[0]=h=>b("regenerate"))},{default:p(()=>[r(t(rs),{class:F(["h-3 w-3",{"animate-spin":m.isGenerating}])},null,8,["class"])]),_:1},8,["disabled"]),r(t(v),{variant:"ghost",size:"icon",class:"h-6 w-6",title:"Dismiss",onClick:i[1]||(i[1]=h=>b("dismiss"))},{default:p(()=>[r(t(pt),{class:"h-3 w-3"})]),_:1})])])])):A("",!0)]),_:1}))}}),Ys=gt(Qs,[["__scopeId","data-v-d5492de7"]]),Js={class:"flex flex-col h-full bg-transparent"},Zs={class:"p-4 border-b border-border/50 flex justify-between items-start bg-background/50 backdrop-blur-sm"},eo={class:"flex items-center gap-2"},to={class:"p-1.5 rounded-md bg-primary/10 text-primary"},so={key:0,class:"px-4 py-2 bg-muted/30 border-b border-border/50 text-xs flex gap-3 text-muted-foreground"},oo={key:0,class:"ml-auto text-amber-600 dark:text-amber-400 font-medium flex items-center gap-1"},ro={class:"space-y-6"},ao={key:0,class:"flex flex-col items-center justify-center text-center py-12 px-4 space-y-4 opacity-0 animate-in fade-in slide-in-from-bottom-4 duration-700 fill-mode-forwards"},no={class:"w-12 h-12 rounded-full bg-primary/5 flex items-center justify-center mb-2"},io={class:"grid grid-cols-1 gap-2 w-full max-w-xs mt-4"},lo={class:"space-y-1"},co=["innerHTML"],uo={key:1,class:"flex gap-3"},po={class:"w-8 h-8 rounded-full bg-muted flex items-center justify-center shrink-0"},mo={class:"p-4 border-t border-border/50 bg-background/50 backdrop-blur-sm"},ho={class:"relative"},go=$e({__name:"ManualChatSidebar",props:{messages:{},isLoading:{type:Boolean},analysis:{}},emits:["send","close"],setup(_,{emit:n}){const b=_,m=n,i=l(""),h=l(null),x=()=>{i.value.trim()&&!b.isLoading&&(m("send",i.value),i.value="")},C=d=>{d.key==="Enter"&&!d.shiftKey&&(d.preventDefault(),x())};return re(()=>b.messages.length,async()=>{if(await as(),h.value){const d=h.value.$el.querySelector("[data-radix-scroll-area-viewport]");d&&(d.scrollTop=d.scrollHeight)}}),(d,c)=>(u(),k("div",Js,[o("div",Zs,[o("div",null,[o("div",eo,[o("div",to,[r(t(ns),{class:"w-4 h-4"})]),c[4]||(c[4]=o("h3",{class:"font-semibold text-foreground"},"AI Assistant",-1))]),c[5]||(c[5]=o("p",{class:"text-xs text-muted-foreground mt-1 ml-1"},"Context-aware writing companion",-1))]),r(t(v),{variant:"ghost",size:"icon",class:"h-8 w-8 -mr-2",onClick:c[0]||(c[0]=g=>d.$emit("close"))},{default:p(()=>[r(t(pt),{class:"w-4 h-4"})]),_:1})]),d.analysis?(u(),k("div",so,[o("span",null,y(d.analysis.word_count)+" words",1),c[6]||(c[6]=o("span",null,"â€¢",-1)),o("span",null,y(d.analysis.citation_count)+" citations",1),d.analysis.detected_issues.length>0?(u(),k("span",oo,y(d.analysis.detected_issues.length)+" issues ",1)):A("",!0)])):A("",!0),r(t(Is),{ref_key:"messagesContainer",ref:h,class:"flex-1 p-4"},{default:p(()=>[o("div",ro,[d.messages.length===0?(u(),k("div",ao,[o("div",no,[r(t(ut),{class:"w-6 h-6 text-primary/60"})]),c[9]||(c[9]=o("div",{class:"space-y-1"},[o("h4",{class:"font-medium text-foreground"},"How can I help?"),o("p",{class:"text-sm text-muted-foreground max-w-[240px]"}," I can help you structure your arguments, find citations, or rephrase complex sentences. ")],-1)),o("div",io,[r(t(v),{variant:"outline",size:"sm",class:"justify-start h-auto py-2 text-xs font-normal",onClick:c[1]||(c[1]=g=>{i.value="Analyze the structure of this chapter",x()})},{default:p(()=>[...c[7]||(c[7]=[D(' "Analyze the structure of this chapter" ',-1)])]),_:1}),r(t(v),{variant:"outline",size:"sm",class:"justify-start h-auto py-2 text-xs font-normal",onClick:c[2]||(c[2]=g=>{i.value="Suggest some relevant citations",x()})},{default:p(()=>[...c[8]||(c[8]=[D(' "Suggest some relevant citations" ',-1)])]),_:1})])])):A("",!0),(u(!0),k(mt,null,is(d.messages,(g,U)=>(u(),k("div",{key:U,class:F(["flex gap-3 max-w-[90%]",g.role==="user"?"ml-auto flex-row-reverse":""])},[o("div",{class:F(["w-8 h-8 rounded-full flex items-center justify-center shrink-0 text-xs font-medium",g.role==="user"?"bg-primary text-primary-foreground":"bg-muted text-muted-foreground"])},y(g.role==="user"?"You":"AI"),3),o("div",lo,[o("div",{class:F(["p-3 rounded-2xl text-sm shadow-sm",g.role==="user"?"bg-primary text-primary-foreground rounded-tr-sm":"bg-card border text-card-foreground rounded-tl-sm"])},[o("div",{innerHTML:g.content,class:"prose prose-sm dark:prose-invert max-w-none break-words"},null,8,co)],2),o("p",{class:F(["text-[10px] text-muted-foreground opacity-70 px-1",g.role==="user"?"text-right":""])},y(new Date(g.timestamp).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})),3)])],2))),128)),d.isLoading?(u(),k("div",uo,[o("div",po,[r(t(ht),{class:"w-4 h-4 animate-spin text-muted-foreground"})]),c[10]||(c[10]=o("div",{class:"bg-card border px-4 py-3 rounded-2xl rounded-tl-sm text-sm text-muted-foreground shadow-sm"}," Thinking... ",-1))])):A("",!0)])]),_:1},512),o("div",mo,[o("div",ho,[r(t(Fs),{modelValue:i.value,"onUpdate:modelValue":c[3]||(c[3]=g=>i.value=g),placeholder:"Ask anything about your chapter...",onKeydown:C,disabled:d.isLoading,class:"pr-10 py-6 bg-background/80 border-border/60 focus-visible:ring-primary/20 shadow-sm"},null,8,["modelValue","disabled"]),r(t(v),{onClick:x,disabled:d.isLoading||!i.value.trim(),size:"icon",class:F(["absolute right-1.5 top-1.5 h-9 w-9 transition-all duration-200",i.value.trim()?"opacity-100 scale-100":"opacity-70 scale-90"])},{default:p(()=>[r(t(ls),{class:"w-4 h-4"})]),_:1},8,["disabled","class"])]),c[11]||(c[11]=o("p",{class:"text-[10px] text-center text-muted-foreground mt-2"}," AI can make mistakes. Review generated content. ",-1))])]))}});function fo(_,n=[]){const b=l(!1),m=l(n),i=l(!1),h=l(null);return{isChatOpen:b,messages:m,isLoading:i,toggleChat:()=>{b.value=!b.value},sendMessage:async d=>{if(d.trim()){m.value.push({role:"user",content:d,timestamp:new Date}),i.value=!0;try{const g=(await ce.post(z("projects.manual-editor.chat",{project:_.project.slug,chapter:_.chapter_number}),{message:d,history:m.value})).data.message;m.value.push({role:"assistant",content:g,timestamp:new Date});const U=$s(g||"");if(U>0)try{await ft(U,"Manual editor: Chat","chapter",_.id),await h.value?.()}catch(E){console.error("Failed to record word usage (manual chat):",E)}}catch(c){console.error("Failed to send chat message:",c),m.value.push({role:"assistant",content:"I'm having trouble responding right now. Please try again.",timestamp:new Date})}finally{i.value=!1}}},setOnUsageRecorded:d=>{h.value=d}}}const vo=_=>_?_.replace(/<style[\s\S]*?<\/style>/gi,"").replace(/<script[\s\S]*?<\/script>/gi,"").replace(/<[^>]+>/g," ").replace(/&nbsp;/gi," ").replace(/\s+/g," ").trim():"",Me=_=>vo(_).length===0,bo=_=>{const b=_.trim().match(/^```[a-zA-Z0-9_-]*\s*\n([\s\S]*?)\n?```$/);return b?b[1].trim():_};function xo(_,n,b,m){const i=l(null),h=l(!1),x=l(!1),C=async()=>{if(!h.value&&!(m?.canGenerate&&!m.canGenerate())&&Me(b.value)){h.value=!0;try{await ce.get("/sanctum/csrf-cookie");const g=await ce.post(z("api.projects.chapters.generate-starter",{project:_,chapter:n.chapter_number})),U=bo(String(g.data?.starter??"")).trim().replace(/^\s*html\s*/i,"");i.value=U||null,x.value=!!i.value}catch(g){throw i.value=null,x.value=!1,g}finally{h.value=!1}}},d=()=>{x.value=!1,i.value=null},c=()=>{x.value=!1,i.value=null};return ge(()=>{Me(b.value)&&C().catch(()=>{})}),re(b,g=>{Me(g)||(x.value=!1,i.value=null)},{flush:"post"}),{starterText:i,isGenerating:h,showStarter:x,generateStarter:C,acceptStarter:d,dismissStarter:c}}function wo(_,n,b){const m=l(null),i=l(!1),h=l(0),x=l(null),C=async E=>{x.value=E;const X=++h.value;if(!E.textBefore.trim()){m.value=null;return}i.value=!0;try{await ce.get("/sanctum/csrf-cookie");const Q=await ce.post(z("api.projects.chapters.autocomplete",{project:_,chapter:n}),{text_before:E.textBefore,text_after:E.textAfter,chapter_number:E.chapterNumber,chapter_title:E.chapterTitle,chapter_outline:E.chapterOutline,section_heading:E.sectionHeading,section_outline:E.sectionOutline,project_topic:E.projectTopic});if(X!==h.value)return;const fe=String(Q.data?.completion??"").replace(/\s+$/g,"");m.value=fe||null}catch(Q){if(X!==h.value)return;throw m.value=null,Q}finally{X===h.value&&(i.value=!1)}},d=cs(C,500);return{ghostText:m,isLoading:i,debouncedRequest:d,requestCompletion:C,acceptSuggestion:()=>{m.value=null},dismissSuggestion:()=>{m.value=null},triggerManually:async()=>{x.value&&await C(x.value)},editorRef:b}}const yo={class:"manual-editor h-screen flex flex-col bg-background dark:bg-background transition-colors duration-300"},ko={class:"md:hidden border-b h-14 px-3 flex justify-between items-center bg-background/80 backdrop-blur-md sticky top-0 z-50 transition-all duration-200"},_o={class:"flex items-center gap-2"},Co={class:"flex flex-col justify-center min-w-0 flex-1 mx-2"},So={class:"items-center gap-2 text-xs font-medium text-muted-foreground mb-1 hidden sm:flex"},jo={class:"flex items-center gap-2 -ml-1"},To={class:"font-bold text-base text-foreground truncate"},Mo={class:"truncate"},Ao={class:"flex gap-2 items-center"},$o={class:"hidden md:flex flex-col w-full z-50 sticky top-0 bg-background/80 backdrop-blur-md transition-all duration-200 border-b"},zo={id:"editor-header",class:"h-10 border-b border-border/40 flex items-center justify-center px-4 bg-background/60 relative"},Eo={class:"flex items-center gap-2"},Ro={id:"chapter-nav-buttons",class:"flex items-center gap-1 absolute right-4"},Oo={class:"h-12 flex items-center justify-between px-4 bg-background/40"},Lo={id:"left-controls",class:"flex items-center gap-3"},Fo={class:"flex items-center gap-1"},Io={id:"save-status",class:"flex items-center gap-2 px-3 py-1.5 rounded-full bg-muted/30 border border-border/40"},Po={class:"flex items-center gap-1.5"},Uo={class:"text-xs font-medium text-muted-foreground"},qo={key:0,class:"flex items-center gap-1.5"},Bo={key:1,class:"text-xs text-muted-foreground"},No={class:"flex items-center gap-3"},Do={id:"view-controls",class:"flex items-center gap-1 bg-muted/30 p-1 rounded-full border border-border/40"},Go={id:"credit-display"},Ho={id:"export-menu-container"},Ko={class:"text-xs font-medium"},Wo={id:"progress-bar-section",class:"w-full bg-background border-b px-3 md:px-6 py-2 flex flex-col gap-1"},Vo={class:"flex justify-between items-center text-xs text-muted-foreground mb-1"},Xo={class:"flex-1 flex overflow-hidden"},Qo={key:0,id:"left-sidebar-panel",class:"w-[320px] border-r bg-background/80 backdrop-blur-xl border-border/50 shadow-xl z-20 overflow-y-auto custom-scrollbar"},Yo={class:"p-4"},Jo={class:"mb-3"},Zo={class:"text-xs text-muted-foreground"},er={class:"flex-1 overflow-auto p-2 md:p-6 bg-background"},tr={key:0,class:"w-1/2 flex flex-col bg-background overflow-hidden"},sr={class:"flex-1 overflow-y-auto custom-scrollbar"},or={key:0,id:"right-sidebar-panel",class:"w-[400px] border-l bg-background/80 backdrop-blur-xl border-border/50 shadow-2xl z-20 overflow-y-auto custom-scrollbar flex flex-col"},rr={key:0,class:"flex-1 overflow-hidden"},ar={class:"h-full border-b border-border/50"},nr={key:1,class:"p-4 space-y-6"},ir={key:0,class:"space-y-2"},lr={key:1,class:"space-y-2"},cr={class:"flex items-center justify-between"},dr={class:"text-xs whitespace-pre-wrap rounded-lg border border-border/50 bg-muted/30 p-3"},ur={class:"space-y-2"},pr={id:"editor-footer",class:"border-t p-2 md:p-3 flex flex-col gap-3 text-xs md:text-sm bg-muted/30"},mr={class:"flex flex-col sm:flex-row justify-between gap-3 sm:gap-2 items-start sm:items-center w-full"},hr={id:"footer-stats",class:"flex gap-2 md:gap-4 flex-wrap items-center"},gr={class:"text-muted-foreground"},fr={class:"text-foreground"},vr={key:0,class:"text-muted-foreground hidden sm:inline"},br={class:"text-foreground"},xr={key:1,class:"text-muted-foreground hidden md:inline"},wr={class:"text-foreground"},yr={key:2,class:"text-muted-foreground hidden lg:inline"},kr={class:"flex gap-2 items-center w-full sm:w-auto"},_r={class:"text-xs font-medium"},dt="manual_editor",Cr=$e({__name:"ManualEditor",props:{project:{},chapter:{},allChapters:{},facultyChapters:{},currentSuggestion:{},contextAnalysis:{},initialProgressGuidance:{},chatHistory:{}},setup(_){const n=_,b=ds(),m=l(!1),i=l(null),h=l(null),x=l(""),C=l(""),d=l(!1),c=l(!1),g=P(()=>d.value||c.value),U=P(()=>h.value===null?!1:h.value<3?x.value.trim().length>0:!0),E=P(()=>({page:"manual_editor",project_id:n.project?.id,chapter_id:n.chapter?.id,path:typeof window<"u"?window.location.pathname:null})),X=()=>document.querySelector('meta[name="csrf-token"]')?.getAttribute("content")||"",Q=()=>{m.value=!1,i.value=null,h.value=null,x.value="",C.value=""},ze=async()=>{if(!(!b.props.auth?.user||!n.project?.id))try{const e=await fetch(z("api.feedback.eligibility",{project_id:n.project.id,source:dt}));if(!e.ok)return;const s=await e.json();if(!s.eligible)return;if(s.existing_request_id){i.value=s.existing_request_id,m.value=!0;return}const a=await fetch(z("api.feedback.requests.store"),{method:"POST",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":X()},body:JSON.stringify({project_id:n.project.id,source:dt,context:E.value})});if(!a.ok)return;const f=await a.json();i.value=f.id,m.value=!0}catch(e){console.error("Failed to check feedback eligibility:",e)}},fe=async()=>{if(!i.value||!U.value){C.value=h.value&&h.value<3?"Please add a short comment.":"";return}d.value=!0,C.value="";try{const e=await fetch(z("api.feedback.requests.submit",{feedbackRequest:i.value}),{method:"POST",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":X()},body:JSON.stringify({rating:h.value,comment:x.value.trim()||null})});if(!e.ok){const s=await e.json().catch(()=>({}));C.value=s?.errors?.comment?.[0]??"";return}Q(),w.success("Thanks for the feedback!")}catch(e){console.error("Failed to submit feedback:",e)}finally{d.value=!1}},Ee=async()=>{if(!i.value){Q();return}c.value=!0;try{await fetch(z("api.feedback.requests.dismiss",{feedbackRequest:i.value}),{method:"POST",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":X()}})}catch(e){console.error("Failed to dismiss feedback prompt:",e)}finally{c.value=!1,Q()}},vt=e=>{if(e){m.value=!0;return}if(d.value||c.value){m.value=e;return}Ee()};re([h,x],()=>{C.value&&(C.value="")}),re(()=>b.props?.flash,e=>{e&&(e.success&&w.success(e.success),e.error&&w.error(e.error))},{deep:!0,immediate:!0});const{wordBalance:Re,balance:bt,showPurchaseModal:Oe,requiredWordsForModal:xt,actionDescriptionForModal:wt,checkAndPrompt:Le,closePurchaseModal:yt,refreshBalance:ve}=Gs(),{content:j,isDirty:be,isSaving:B,lastSaved:Fe,updateContent:kt,manualSave:Ie}=zs(n.chapter,n.project.slug),{currentSuggestion:xe,currentAnalysis:T,isAnalyzing:we,saveSuggestion:Pe,clearSuggestion:Ue,applySuggestion:qe}=Es(n.chapter,n.project.slug,n.currentSuggestion,j,{onUsageRecorded:()=>ve()}),{addToHistory:_t}=Us(n.chapter.content||""),Y=l(null),{isChatOpen:Be,messages:Ct,isLoading:St,toggleChat:jt,sendMessage:Tt,setOnUsageRecorded:Mt}=fo(n.chapter,n.chatHistory||[]);Mt(()=>ve());const Ne=l(n.chapter.title||"");l(!1),l(!1),l("");const De=()=>{se.value&&Ge(),M.value=!0,jt()},te=e=>{kt(e),_t(e),Xt()};P(()=>{const e=Ne.value?.trim(),s=j.value?.trim();return!!(e&&e.length>0&&s&&s.length>50)});const At=()=>typeof window<"u"&&window.innerWidth<1024,de=(e,s)=>{try{const a=localStorage.getItem(e);return a!==null?a==="true":s}catch{return s}},$=l(At()),O=l(de("manualEditor_showLeftSidebar",!$.value)),M=l(de("manualEditor_showRightSidebar",!$.value)),ye=l(""),ke=l(null),ae=l("");l(!1),l([]),l(!1);const G=l(!0),se=l((()=>{try{return localStorage.getItem("citationOperationMode")==="true"}catch{return!1}})()),$t=()=>{se.value=!0,M.value=!1;try{localStorage.setItem("citationOperationMode","true")}catch{}},Ge=()=>{se.value=!1,M.value=!0;try{localStorage.setItem("citationOperationMode","false")}catch{}},He=l(!1),zt=async()=>{w.info("Fullscreen temporarily disabled")},Et=()=>{W.visit(z("projects.analysis",{project:n.project.slug}))};ge(()=>{}),nt(()=>{});const{isDark:Ke,toggle:Rt}=Ks(),Ot=P(()=>{const e=T.value?.word_count??n.chapter.word_count,s=n.chapter.target_word_count||1e3;return Math.min(e/s*100,100)});P(()=>B.value?"Saving...":Fe.value?`Saved ${Fe.value}`:"Not saved");const Lt=()=>{O.value=!O.value},Ft=()=>{M.value=!M.value},It=()=>Le(200,"generate chapter starter"),{starterText:ue,isGenerating:Pt,showStarter:H,generateStarter:Ut,acceptStarter:qt,dismissStarter:We}=xo(n.project.slug,n.chapter,j,{canGenerate:It}),Bt=P(()=>{const e=n.facultyChapters||[],s=e.find(f=>f?.chapter_number===n.chapter.chapter_number)??e.find(f=>f?.number===n.chapter.chapter_number);if(!s)return"";const a=[];if(s.description&&a.push(String(s.description)),Array.isArray(s.sections))for(const f of s.sections){if(!f)continue;const I=(f.title??f.section_title??"").toString().trim(),J=(f.description??f.section_description??"").toString().trim();I&&J?a.push(`${I}: ${J}`):I&&a.push(I)}return a.join(`
`)}),{ghostText:Ve,isLoading:Nt,debouncedRequest:Dt,requestCompletion:Gt,acceptSuggestion:Ht,dismissSuggestion:Kt}=wo(n.project.slug,n.chapter.chapter_number,Y),Wt=P(()=>H.value&&ue.value?ue.value:Ve.value),Vt=P(()=>H.value&&ue.value?"html":"text");function Xe(){const e=Y.value?.editor?.();if(!e)return null;const s=e.state.selection;if(!s.empty||H.value)return null;const a=e.state.doc,f=s.from,I=s.to,J=Math.max(0,f-2500),he=Math.min(a.content.size,I+500),ie=a.textBetween(J,f,`
`,`
`),at=a.textBetween(I,he,`
`,`
`);let N="",oe=0;const S=Math.max(0,f-8e3);a.nodesBetween(S,f,(R,q)=>{R.type?.name==="heading"&&q<f&&(N=R.textContent||"",oe=q)}),N&&f-oe>2e3&&(N="");let Z="";if(N){const R=(n.facultyChapters||[]).find(K=>K?.chapter_number===n.chapter.chapter_number||K?.number===n.chapter.chapter_number),q=Array.isArray(R?.sections)?R.sections:[],je=N.trim().toLowerCase(),ee=q.find(K=>{const le=(K?.title??K?.section_title??"").toString().trim().toLowerCase();return le&&le===je});if(ee){const K=(ee.title??ee.section_title??"").toString().trim(),le=(ee.description??ee.section_description??"").toString().trim();Z=le?`${K}: ${le}`:K}}return{textBefore:ie,textAfter:at,chapterNumber:n.chapter.chapter_number,chapterTitle:Ne.value||n.chapter.title||"",chapterOutline:Bt.value||"",sectionHeading:N.trim(),sectionOutline:Z.trim(),projectTopic:n.project?.topic||""}}function Xt(){if(H.value||Nt.value||Ve.value)return;const e=Xe();e&&Dt(e).catch(()=>{})}const Qt=async()=>{try{await Ut()}catch(e){console.error("Failed to generate starter:",e),w.error("Failed to generate starter")}};re(O,e=>{if(!$.value)try{localStorage.setItem("manualEditor_showLeftSidebar",String(e))}catch(s){console.error("Failed to save left sidebar state:",s)}}),re(M,e=>{if(!$.value)try{localStorage.setItem("manualEditor_showRightSidebar",String(e))}catch(s){console.error("Failed to save right sidebar state:",s)}});const Qe=e=>{(e.ctrlKey||e.metaKey)&&e.key==="s"&&(e.preventDefault(),me())};ge(()=>{$.value=window.innerWidth<1024,$.value&&(O.value=!1,M.value=!1);const e=()=>{const s=$.value;$.value=window.innerWidth<1024,s!==$.value&&($.value?(O.value=!1,M.value=!1):(O.value=de("manualEditor_showLeftSidebar",!0),M.value=de("manualEditor_showRightSidebar",!0)))};window.addEventListener("resize",e),window.addEventListener("keydown",Qe),ze(),nt(()=>{window.removeEventListener("resize",e),window.removeEventListener("keydown",Qe)})});const Ye=e=>{te(e),w.success("Applied improved text")},Je=e=>{if(Y.value?.replaceSelection(e,ke.value||void 0)??!1){w.success("Expanded selection");return}te(`${j.value}

${e}`),w.success("Added expanded text")},Ze=e=>{ae.value=e,G.value=!0;try{navigator.clipboard?.writeText(e)}catch{}w.success("Citation suggestions ready")},et=e=>{if(Y.value?.replaceSelection(e,ke.value||void 0)??!1){w.success("Applied rephrased text");return}te(`${j.value}

${e}`),w.success("Added rephrased text")},tt=(e,s)=>Le(e,s),pe=async(e,s)=>{const a=Math.max(0,Math.round(e||0));a&&(await ft(a,s,"chapter",n.chapter.id),await ve())},Yt=e=>e.replace(/<[^>]*>/g," "),Jt=e=>Yt(e).split(/\s+/).filter(Boolean).length,Zt=async e=>{const s=Jt(e);if(H.value){qt(),await pe(s,"chapter starter accepted");return}Ht(),await pe(s,"autocomplete accepted")},es=()=>{if(H.value){We();return}Kt()},ts=async()=>{if(H.value)return;const e=Xe();if(e)try{await Gt(e)}catch(s){console.error("Failed to autocomplete:",s),w.error("Autocomplete failed")}},ss=async()=>{if(ae.value)try{await navigator.clipboard.writeText(ae.value),w.success("Copied citation suggestions")}catch{w.error("Could not copy citation suggestions")}},_e=P(()=>n.allChapters.find(e=>e.chapter_number===n.chapter.chapter_number-1)),Ce=P(()=>n.allChapters.find(e=>e.chapter_number===n.chapter.chapter_number+1)),Se=(e,s)=>{if(s&&j.value){const f=s.trim(),I=document.createElement("div");I.innerHTML=j.value;const J=I.textContent||I.innerText||"",he=J.indexOf(f);if(he!==-1){const ie=he+f.length,N=J.substring(ie).match(/^[^.!?]*[.!?]/);let oe;N?oe=ie+N[0].length:oe=ie;let S=0,Z=0;const R=j.value;for(;S<R.length&&Z<oe;)if(R[S]==="<"){for(;S<R.length&&R[S]!==">";)S++;S++}else if(R[S]==="&"){const q=R.indexOf(";",S);q!==-1&&q-S<10?(S=q+1,Z++):(S++,Z++)}else S++,Z++;if(S>0){const q=R.substring(0,S),je=R.substring(S),ee=`${q} ${e}${je}`;te(ee),w.success("Citation inserted at claim location");return}}}const a=Y.value?.getCursorPosition?.();if(typeof a=="number"&&(Y.value?.replaceTextAt?.({from:a,to:a},` ${e} `)??!1)){w.success("Citation inserted at cursor");return}te(`${j.value} ${e}`),w.success("Citation appended to content")},ne=e=>{be.value&&!confirm("You have unsaved changes. Are you sure you want to switch chapters?")||W.visit(z("projects.manual-editor.show",{project:n.project.slug,chapter:e}))},st=()=>{const e=n.chapter.chapter_number+1;n.allChapters.find(a=>a.chapter_number===e)?ne(e):w.info("Please create the next chapter from the dashboard first.")},ot=e=>{confirm("Are you sure you want to delete this chapter?")&&W.delete(z("chapters.destroy",{project:n.project.slug,chapter:n.allChapters.find(s=>s.id===e)?.slug}),{onSuccess:()=>w.success("Chapter deleted")})},me=async()=>{try{await Ie(),w.success("Chapter saved successfully")}catch{w.error("Failed to save chapter")}},os=async()=>{console.log("ðŸ”µ [MARK COMPLETE] Function called"),console.log("ðŸ”µ [MARK COMPLETE] Current word count:",T.value?.word_count??n.chapter.word_count);try{console.log("ðŸ”µ [MARK COMPLETE] Saving chapter..."),await Ie(),console.log("âœ… [MARK COMPLETE] Chapter saved");const e=z("projects.manual-editor.mark-complete",{project:n.project.slug,chapter:n.chapter.chapter_number});console.log("ðŸ”µ [MARK COMPLETE] Posting to:",e),W.post(e,{},{onSuccess:()=>{console.log("âœ… [MARK COMPLETE] Request successful")},onError:s=>{console.error("âŒ [MARK COMPLETE] Request failed:",s)}})}catch(e){console.error("âŒ [MARK COMPLETE] Error:",e),w.error("Failed to save chapter before marking complete")}},rt=()=>{const e=[{popover:{title:"Welcome to the AI Assisted Editor",description:"Experience a powerful writing environment enhanced by AI. Use the Smart Chapter Starter to kickstart your writing, leverage auto-completion for faster drafting, and access a suite of AI tools to refine your content.",popoverClass:"driver-popover-welcome"}},{element:"#back-to-project-btn",popover:{title:"Back to Project",description:"Return to your project dashboard."}},{element:"#left-sidebar-panel",popover:{title:"Chapter Navigation",description:"Use the Table of Contents to switch between chapters."},onHighlightStarted:()=>{O.value=!0},showOnMobile:!1},{element:"#save-status",popover:{title:"Status & Word Count",description:"Check your save status and current word count at a glance."}},{element:"#manual-editor-toolbar",popover:{title:"Formatting Tools",description:"Use these tools to format your text, add links, headings, and lists."}},{element:"#view-controls",popover:{title:"View Options",description:"Customize your writing experience with dark mode, full screen, AI chat, and tool sidebars."}},{element:"#toggle-chat-mode",popover:{title:"AI Chat Assistant",description:"Open the AI assistant to help you write, brainstorm, or refine your content."}},{element:"#toggle-right-sidebar",popover:{title:"Writing Tools Sidebar",description:"Toggle this sidebar to access efficient writing tools."},showOnMobile:!1},{element:"#right-sidebar-panel",popover:{title:"Writing Tools",description:"Access quick tools like Smart Suggestions, Quick Actions (Expand, Rephrase), and more."},onHighlightStarted:()=>{M.value=!0},showOnMobile:!1},{element:"#credit-display",popover:{title:"Credits",description:"Keep track of your AI credits. Remember, using AI tools consumes credits."}},{element:"#top-up-btn",popover:{title:"Top Up",description:"Running low? Click here to purchase more credits."}},{element:"#export-menu-container",popover:{title:"Export",description:"Export your chapter or entire project in various formats."}},{element:"#analyze-button",popover:{title:"Bulk Analysis",description:"Analyze multiple chapters at once for comprehensive insights."}},{element:"#progress-bar-section",popover:{title:"Writing Progress",description:"Track your progress towards the chapter word count goal."}},{element:"#editor-footer",popover:{title:"Footer Controls",description:"View detailed stats like citations and quality metrics, and clear actions."}},{element:"#mark-complete-btn",popover:{title:"Mark as Complete",description:"Finished writing? Mark the chapter as complete to proceed."}},{element:"#save-button",popover:{title:"Save Work",description:"Manually save your chapter. Auto-save is also active!"}},{element:"#reset-tour-button",popover:{title:"Need Help?",description:"Click here anytime to restart this tour."}}];js({showProgress:!0,animate:!0,steps:$.value?e.filter(f=>f.showOnMobile!==!1):e}).drive();const a=b.props.auth.user;a?.email&&localStorage.setItem(`manual_editor_tour_seen_${a.email}`,"true")};return ge(()=>{const e=b.props.auth.user;e?.email&&(localStorage.getItem(`manual_editor_tour_seen_${e.email}`)||setTimeout(()=>{rt()},1e3))}),(e,s)=>(u(),k(mt,null,[r(t(us),{title:`${e.chapter.title} - Manual Editor`},null,8,["title"]),r(Hs,{open:m.value,rating:h.value,comment:x.value,"is-submitting":g.value,"comment-error":C.value,"can-submit":U.value,"onUpdate:open":vt,"onUpdate:rating":s[0]||(s[0]=a=>h.value=a),"onUpdate:comment":s[1]||(s[1]=a=>x.value=a),onSubmit:fe,onDismiss:Ee},null,8,["open","rating","comment","is-submitting","comment-error","can-submit"]),o("div",yo,[o("header",ko,[o("div",_o,[r(t(v),{variant:"ghost",size:"icon",class:"h-8 w-8 text-zinc-700 dark:text-zinc-300 hover:text-foreground",onClick:s[2]||(s[2]=a=>t(W).visit(t(z)("projects.show",e.project.slug))),title:"Back to Project"},{default:p(()=>[r(t(it),{class:"w-4 h-4"})]),_:1}),r(t(V),{orientation:"vertical",class:"h-6"}),r(t(v),{onClick:s[3]||(s[3]=a=>O.value=!0),variant:"ghost",size:"icon",class:"h-8 w-8 lg:hidden text-muted-foreground hover:text-foreground",title:"Open Chapter Navigation"},{default:p(()=>[r(t(ps),{class:"w-4 h-4"})]),_:1})]),o("div",Co,[o("div",So,[o("span",{class:"hover:text-foreground transition-colors cursor-pointer truncate",onClick:s[4]||(s[4]=a=>t(W).visit(t(z)("projects.show",e.project.slug)))},y(e.project.title),1)]),o("div",jo,[o("div",To,[o("span",Mo,"Ch. "+y(e.chapter.chapter_number),1)])])]),o("div",Ao,[r(t(v),{variant:"ghost",size:"icon",class:"h-8 w-8",onClick:me,disabled:t(B),title:"Save"},{default:p(()=>[r(t(Te),{class:"w-4 h-4"})]),_:1},8,["disabled"]),r(t(V),{orientation:"vertical",class:"h-6 mx-1 opacity-50"}),r(t(v),{onClick:s[5]||(s[5]=a=>M.value=!0),variant:"ghost",size:"icon",class:"h-8 w-8 text-muted-foreground hover:text-foreground",title:"Open Tools"},{default:p(()=>[r(t(lt),{class:"w-4 h-4"})]),_:1})])]),o("div",$o,[o("div",zo,[o("div",Eo,[o("h1",{id:"project-title-link",class:"text-sm font-bold text-foreground cursor-pointer hover:text-primary transition-colors",onClick:s[6]||(s[6]=a=>t(W).visit(t(z)("projects.show",e.project.slug)))},y(e.project.title),1),r(t(Ts),{id:"chapter-badge",variant:"secondary",class:"h-5 px-2 text-[10px] rounded-full"},{default:p(()=>[D("Ch "+y(e.chapter.chapter_number),1)]),_:1})]),o("div",Ro,[_e.value?(u(),L(t(v),{key:0,variant:"ghost",size:"sm",class:"h-6 px-2 text-zinc-500 hover:text-foreground gap-1 rounded-full text-[10px]",onClick:s[7]||(s[7]=a=>ne(_e.value.chapter_number)),title:`Previous: ${_e.value.title}`},{default:p(()=>[r(t(ms),{class:"w-3 h-3"}),s[19]||(s[19]=D(" Prev ",-1))]),_:1},8,["title"])):A("",!0),Ce.value?(u(),L(t(v),{key:1,variant:"ghost",size:"sm",class:"h-6 px-2 text-zinc-500 hover:text-foreground gap-1 rounded-full text-[10px]",onClick:s[8]||(s[8]=a=>ne(Ce.value.chapter_number)),title:`Next: ${Ce.value.title}`},{default:p(()=>[s[20]||(s[20]=D(" Next ",-1)),r(t(hs),{class:"w-3 h-3"})]),_:1},8,["title"])):A("",!0)])]),o("div",Oo,[o("div",Lo,[o("div",Fo,[r(t(v),{id:"back-to-project-btn",variant:"ghost",size:"icon",class:"h-8 w-8 text-zinc-700 dark:text-zinc-300 hover:text-foreground rounded-full",onClick:s[9]||(s[9]=a=>t(W).visit(t(z)("projects.show",e.project.slug))),title:"Back to Project"},{default:p(()=>[r(t(it),{class:"w-4 h-4"})]),_:1}),s[21]||(s[21]=o("div",{class:"h-4 w-px bg-border/50 mx-1"},null,-1)),r(t(v),{id:"toggle-left-sidebar",onClick:Lt,variant:"ghost",size:"icon",class:F(["h-8 w-8 transition-all duration-300 rounded-full",O.value?"text-primary":"text-zinc-700 dark:text-zinc-300 hover:text-foreground"]),title:"Toggle Chapter Navigation"},{default:p(()=>[O.value?(u(),L(t(gs),{key:0,class:"w-4 h-4"})):(u(),L(t(fs),{key:1,class:"w-4 h-4"}))]),_:1},8,["class"])]),s[23]||(s[23]=o("div",{class:"h-4 w-px bg-border/50"},null,-1)),o("div",Io,[o("div",Po,[o("div",{class:F(["w-2 h-2 rounded-full transition-colors duration-300",t(be)?"bg-amber-500 animate-pulse":"bg-emerald-500"])},null,2),o("span",Uo,y(t(be)?"Unsaved":"Saved"),1)]),r(t(V),{orientation:"vertical",class:"h-3"}),t(we)?(u(),k("div",qo,[r(t(ht),{class:"w-3 h-3 animate-spin text-primary"}),s[22]||(s[22]=o("span",{class:"text-xs text-muted-foreground"},"Analyzing",-1))])):(u(),k("div",Bo,y(t(T)?.word_count??e.chapter.word_count)+" words ",1))])]),s[26]||(s[26]=o("div",{class:"flex-1 px-4 min-w-0"},[o("div",{id:"manual-editor-toolbar",class:"mx-auto max-w-[950px]"})],-1)),o("div",No,[o("div",Do,[r(t(v),{variant:"ghost",size:"icon",class:"h-7 w-7 rounded-full text-zinc-700 dark:text-zinc-300 hover:text-foreground",onClick:t(Rt),title:t(Ke)?"Switch to Light Mode":"Switch to Dark Mode"},{default:p(()=>[t(Ke)?(u(),L(t(vs),{key:0,class:"w-4 h-4"})):(u(),L(t(bs),{key:1,class:"w-4 h-4"}))]),_:1},8,["onClick","title"]),r(t(v),{variant:"ghost",size:"icon",class:"h-7 w-7 rounded-full text-zinc-700 dark:text-zinc-300 hover:text-foreground",onClick:zt,title:He.value?"Exit Full Screen":"Enter Full Screen"},{default:p(()=>[He.value?(u(),L(t(xs),{key:0,class:"w-4 h-4"})):(u(),L(t(ws),{key:1,class:"w-4 h-4"}))]),_:1},8,["title"]),r(t(v),{id:"toggle-chat-mode",onClick:De,variant:"ghost",size:"icon",class:F(["h-7 w-7 rounded-full transition-all duration-300",t(Be)?"bg-background shadow-sm text-primary":"text-zinc-700 dark:text-zinc-300 hover:text-foreground"]),title:"Toggle AI Chat Mode"},{default:p(()=>[r(t(lt),{class:"w-4 h-4"})]),_:1},8,["class"]),r(t(v),{id:"toggle-right-sidebar",onClick:Ft,variant:"ghost",size:"icon",class:F(["h-7 w-7 rounded-full transition-all duration-300",M.value?"bg-background shadow-sm text-primary":"text-zinc-700 dark:text-zinc-300 hover:text-foreground"]),title:"Toggle Tools Sidebar"},{default:p(()=>[M.value?(u(),L(t(ys),{key:0,class:"w-4 h-4"})):(u(),L(t(ks),{key:1,class:"w-4 h-4"}))]),_:1},8,["class"])]),s[25]||(s[25]=o("div",{class:"w-px h-4 bg-border/50"},null,-1)),o("div",Go,[t(Re)?(u(),L(Ns,{key:0,balance:t(Re),compact:""},null,8,["balance"])):A("",!0)]),o("div",Ho,[r(qs,{project:e.project,"current-chapter":e.chapter,"all-chapters":e.allChapters,size:"sm",variant:"outline",class:"h-9","button-class":"rounded-full bg-background/50"},null,8,["project","current-chapter","all-chapters"])]),r(t(v),{id:"analyze-button",variant:"ghost",size:"sm",class:"h-9 gap-2 text-zinc-700 dark:text-zinc-300 hover:text-foreground rounded-full bg-background/50 border border-transparent hover:border-border/50",onClick:Et,title:"Open bulk analysis"},{default:p(()=>[r(t(_s),{class:"w-4 h-4"}),s[24]||(s[24]=o("span",{class:"text-xs font-medium"},"Analyze",-1))]),_:1}),r(t(v),{id:"save-button",variant:"outline",size:"sm",class:"h-9 gap-2 text-zinc-700 dark:text-zinc-300 hover:text-foreground rounded-full bg-background/50",onClick:me,disabled:t(B),title:"Save (Ctrl+S)"},{default:p(()=>[r(t(Te),{class:"w-4 h-4"}),o("span",Ko,y(t(B)?"Saving...":"Save"),1)]),_:1},8,["disabled"]),r(t(v),{id:"reset-tour-button",variant:"ghost",size:"icon",class:"h-8 w-8 text-muted-foreground",onClick:rt,title:"Restart Tour"},{default:p(()=>[r(t(Cs),{class:"w-4 h-4"})]),_:1})])])]),o("div",Wo,[o("div",Vo,[s[27]||(s[27]=o("span",{class:"font-medium"},"Writing Progress",-1)),o("span",null,y(t(T)?.word_count??e.chapter.word_count)+" / "+y(e.chapter.target_word_count)+" words",1)]),r(t(Ms),{"model-value":Ot.value,class:"h-1.5"},null,8,["model-value"])]),o("div",Xo,[r(Ae,{"enter-active-class":"transition-all duration-500 cubic-bezier(0.4, 0, 0.2, 1)","enter-from-class":"-ml-[320px] opacity-0","enter-to-class":"ml-0 opacity-100","leave-active-class":"transition-all duration-500 cubic-bezier(0.4, 0, 0.2, 1)","leave-from-class":"ml-0 opacity-100","leave-to-class":"-ml-[320px] opacity-0"},{default:p(()=>[O.value&&!$.value?(u(),k("aside",Qo,[o("div",Yo,[o("div",Jo,[s[28]||(s[28]=o("h2",{class:"text-sm font-semibold text-foreground mb-1"},"Table of Contents",-1)),o("p",Zo,y(e.allChapters.length)+" Chapters",1)]),r(Ps,{"all-chapters":e.allChapters,"current-chapter":e.chapter,project:e.project,outlines:e.project.outlines||[],"faculty-chapters":e.facultyChapters||[],"current-word-count":t(T)?.word_count||e.chapter.word_count,"target-word-count":e.chapter.target_word_count,"writing-quality-score":0,"chapter-content-length":t(j)?.length||0,onGoToChapter:ne,onGenerateNextChapter:st,onDeleteChapter:ot},null,8,["all-chapters","current-chapter","project","outlines","faculty-chapters","current-word-count","target-word-count","chapter-content-length"])])])):A("",!0)]),_:1}),o("div",{class:F(["flex-1 flex overflow-hidden",se.value?"flex-row":"flex-col"])},[o("div",{class:F(["flex flex-col overflow-hidden",se.value?"w-1/2 border-r border-border/50":"flex-1"])},[o("div",er,[r(As,{ref_key:"editorRef",ref:Y,modelValue:t(j),"onUpdate:modelValue":te,"onUpdate:selectedText":s[10]||(s[10]=a=>ye.value=a),"onUpdate:selectionRange":s[11]||(s[11]=a=>ke.value=a),"ghost-text":Wt.value,"ghost-text-format":Vt.value,onGhostAccepted:Zt,onGhostDismissed:es,onGhostManualTrigger:ts,"manual-mode":!0,"toolbar-teleport-target":$.value?"":"#manual-editor-toolbar",class:"min-h-full"},null,8,["modelValue","ghost-text","ghost-text-format","toolbar-teleport-target"])])],2),se.value?(u(),k("div",tr,[o("div",sr,[r(ct,{"show-citation-helper":G.value,"onUpdate:showCitationHelper":s[12]||(s[12]=a=>G.value=a),"chapter-content":t(j),"chapter-id":e.chapter.id,"citation-operation-mode":!0,onInsertCitation:Se,onExitOperationMode:Ge},null,8,["show-citation-helper","chapter-content","chapter-id"])])])):A("",!0)],2),r(Ae,{"enter-active-class":"transition-all duration-500 cubic-bezier(0.4, 0, 0.2, 1)","enter-from-class":"-mr-[400px] opacity-0","enter-to-class":"mr-0 opacity-100","leave-active-class":"transition-all duration-500 cubic-bezier(0.4, 0, 0.2, 1)","leave-from-class":"mr-0 opacity-100","leave-to-class":"-mr-[400px] opacity-0"},{default:p(()=>[M.value&&!$.value?(u(),k("aside",or,[t(Be)?(u(),k("div",rr,[o("div",ar,[r(go,{messages:t(Ct),"is-loading":t(St),analysis:t(T),class:"h-full",onSend:t(Tt),onClose:De},null,8,["messages","is-loading","analysis","onSend"])])])):(u(),k("div",nr,[t(xe)?(u(),k("div",ir,[r(Rs,{suggestion:t(xe),analysis:t(T),onSave:t(Pe),onClear:t(Ue),onApply:t(qe)},null,8,["suggestion","analysis","onSave","onClear","onApply"]),r(t(V),{class:"bg-border/50"})])):A("",!0),r(Os,{"project-slug":e.project.slug,"chapter-number":e.chapter.chapter_number,"selected-text":ye.value,"chapter-content":t(j),"is-processing":t(we)||t(B),"ensure-balance":tt,"on-usage":pe,onTextImproved:Ye,onTextExpanded:Je,onCitationsSuggested:Ze,onTextRephrased:et,onOpenCitationHelper:s[13]||(s[13]=a=>G.value=!0)},null,8,["project-slug","chapter-number","selected-text","chapter-content","is-processing"]),r(t(V),{class:"bg-border/50"}),ae.value?(u(),k("div",lr,[o("div",cr,[s[30]||(s[30]=o("h3",{class:"text-sm font-semibold text-foreground"},"Citation Suggestions",-1)),r(t(v),{size:"sm",variant:"outline",onClick:ss},{default:p(()=>[...s[29]||(s[29]=[D(" Copy ",-1)])]),_:1})]),o("pre",dr,y(ae.value),1),r(t(V),{class:"bg-border/50"})])):A("",!0),o("div",ur,[r(ct,{"show-citation-helper":G.value,"onUpdate:showCitationHelper":s[14]||(s[14]=a=>G.value=a),"chapter-content":t(j),"chapter-id":e.chapter.id,onInsertCitation:Se,onEnterOperationMode:$t},null,8,["show-citation-helper","chapter-content","chapter-id"])]),r(t(V),{class:"bg-border/50"}),r(t(V),{class:"bg-border/50"})]))])):A("",!0)]),_:1}),r(Ls,{"show-left-sidebar":O.value,"show-right-sidebar":M.value,"is-mobile":$.value,"all-chapters":e.allChapters,"current-chapter":e.chapter,project:e.project,"faculty-chapters":e.facultyChapters,"current-word-count":t(T)?.word_count||e.chapter.word_count,"target-word-count":e.chapter.target_word_count,"chapter-content-length":t(j)?.length||0,"selected-text":ye.value,"is-analyzing":t(we),"is-saving":t(B),"current-suggestion":t(xe),"current-analysis":t(T),"chapter-content":t(j),"show-citation-helper":G.value,"ensure-balance":tt,"on-usage":pe,"onUpdate:showLeftSidebar":s[15]||(s[15]=a=>O.value=a),"onUpdate:showRightSidebar":s[16]||(s[16]=a=>M.value=a),"onUpdate:showCitationHelper":s[17]||(s[17]=a=>G.value=a),onGoToChapter:ne,onGenerateNextChapter:st,onDeleteChapter:ot,onSaveSuggestion:t(Pe),onClearSuggestion:t(Ue),onApplySuggestion:t(qe),onTextImproved:Ye,onTextExpanded:Je,onCitationsSuggested:Ze,onTextRephrased:et,onInsertCitation:Se},null,8,["show-left-sidebar","show-right-sidebar","is-mobile","all-chapters","current-chapter","project","faculty-chapters","current-word-count","target-word-count","chapter-content-length","selected-text","is-analyzing","is-saving","current-suggestion","current-analysis","chapter-content","show-citation-helper","onSaveSuggestion","onClearSuggestion","onApplySuggestion"])]),o("footer",pr,[o("div",mr,[o("div",hr,[o("span",gr,[s[31]||(s[31]=o("span",{class:"hidden sm:inline"},"Words: ",-1)),o("strong",fr,y(t(T)?.word_count??e.chapter.word_count),1),D(" / "+y(e.chapter.target_word_count),1)]),t(T)?(u(),k("span",vr,[s[32]||(s[32]=D(" Citations: ",-1)),o("strong",br,y(t(T).citation_count),1)])):A("",!0),t(T)?(u(),k("span",xr,[s[33]||(s[33]=D(" Tables: ",-1)),o("strong",wr,y(t(T).table_count),1)])):A("",!0),t(T)?(u(),k("span",yr," Quality: "+y(t(T).quality_metrics.reading_level),1)):A("",!0)]),o("div",kr,[r(t(v),{variant:"outline",size:"sm",class:"h-8 md:h-9 gap-2 flex-1 sm:flex-initial",onClick:me,disabled:t(B),title:"Save chapter"},{default:p(()=>[r(t(Te),{class:"w-3.5 h-3.5 md:w-4 md:h-4"}),o("span",_r,y(t(B)?"Saving...":"Save"),1)]),_:1},8,["disabled"]),r(t(v),{id:"mark-complete-btn",variant:"default",size:"sm",class:"h-8 md:h-9 gap-2 flex-1 sm:flex-initial",onClick:os,disabled:t(B),title:"Save and mark chapter as complete"},{default:p(()=>[r(t(Ss),{class:"w-3.5 h-3.5 md:w-4 md:h-4"}),s[34]||(s[34]=o("span",{class:"text-xs font-medium hidden sm:inline"},"Mark Complete",-1)),s[35]||(s[35]=o("span",{class:"text-xs font-medium sm:hidden"},"Complete",-1))]),_:1},8,["disabled"])])])]),r(Ds,{open:t(Oe),"current-balance":t(bt),"required-words":t(xt),action:t(wt),"onUpdate:open":s[18]||(s[18]=a=>Oe.value=a),onClose:t(yt)},null,8,["open","current-balance","required-words","action","onClose"]),r(t(Bs),{position:"top-center"})]),r(Ys,{show:t(H)&&!!t(ue),"is-generating":t(Pt),onRegenerate:Qt,onDismiss:t(We)},null,8,["show","is-generating","onDismiss"])],64))}}),da=gt(Cr,[["__scopeId","data-v-a885833e"]]);export{da as default};
