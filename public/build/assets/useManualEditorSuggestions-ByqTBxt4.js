import{d as M,c as y,o as x,g as s,f as j,k as a,u as r,j as b,y as S,z as w,b as _,e as F,n as L,F as B,h as W,i as D,a3 as ee,v as te,U as T,t as O,aa as A,X as se,s as ae,af as z}from"./app-D0iA28mB.js";import{c as ne,_ as $}from"./index-BJDWSSx2.js";import{_ as oe}from"./ChapterNavigation.vue_vue_type_script_setup_true_lang-Cj3pVkNu.js";import{_ as G}from"./index-DRa6cDnc.js";import{L as K}from"./lightbulb-DJAiXzp2.js";import{X as R}from"./x-B_lKCfQu.js";import{_ as Q,a as V,b as X}from"./CollapsibleTrigger.vue_vue_type_script_setup_true_lang-BYji8sjU.js";import{_ as re}from"./Progress.vue_vue_type_script_setup_true_lang-r6y1O8i4.js";import{_ as ie}from"./Checkbox.vue_vue_type_script_setup_true_lang-C8KjYNy5.js";import{_ as I}from"./Separator.vue_vue_type_script_setup_true_lang-DyIyV7Sg.js";import{T as N}from"./target-DnCEEMiZ.js";import{C as Y}from"./chevron-down-B3BfxGoG.js";import{L as le}from"./loader-circle-BoEULsCu.js";import{C as H}from"./DropdownMenuTrigger.vue_vue_type_script_setup_true_lang-C179DBP2.js";import{C as ce}from"./circle-DpWeSqCQ.js";import{t as C}from"./index-DqbJQ_3x.js";import{W as de,b as ue}from"./useTextHistory-CxEFf12R.js";import{S as pe}from"./sparkles-C5iYqP00.js";import{au as ge,at as me}from"./RichTextEditor-Cmz55-Pv.js";import{T as fe}from"./type-BOkyDG_G.js";import{_ as he}from"./DefensePreparationPanel.vue_vue_type_script_setup_true_lang-B1OCPfOe.js";import{_ as ve}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{u as Z}from"./index-DXgKZ3Xd.js";import{r as be}from"./useWordBalance-yFc2QOVb.js";/**
 * @license lucide-vue-next v0.468.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const xe=ne("BookmarkIcon",[["path",{d:"m19 21-7-4-7 4V5a2 2 0 0 1 2-2h10a2 2 0 0 1 2 2v16z",key:"1fy3hk"}]]),ye={class:"bg-card/50 backdrop-blur-sm border rounded-xl p-4 shadow-sm transition-all hover:shadow-md"},we={class:"flex items-start justify-between gap-4"},_e={class:"flex-1 space-y-3"},Ce={class:"flex items-center gap-2"},ke={class:"p-1.5 rounded-md bg-primary/10 text-primary"},Se=["innerHTML"],$e={key:0,class:"pt-2 border-t border-border/50"},Te={class:"text-xs text-amber-600 dark:text-amber-400 flex items-center gap-1.5"},je={class:"flex flex-col gap-1"},Ae={class:"mt-4 flex justify-end"},Le=M({__name:"SmartSuggestionPanel",props:{suggestion:{},analysis:{}},emits:["save","clear","apply"],setup(f,{emit:i}){const l=f,t=i,c=(m=>({writing_guide:{label:"Writing Guide",variant:"default"},claims_without_evidence:{label:"Evidence Needed",variant:"destructive"},insufficient_citations:{label:"Add Citations",variant:"warning"},insufficient_tables:{label:"Add Data",variant:"secondary"},weak_arguments:{label:"Strengthen Arguments",variant:"warning"},insufficient_content:{label:"Expand Content",variant:"secondary"}})[m]||{label:m,variant:"default"})(l.suggestion.suggestion_type);return(m,g)=>(x(),y("div",ye,[s("div",we,[s("div",_e,[s("div",Ce,[s("div",ke,[a(r(K),{class:"w-4 h-4"})]),g[3]||(g[3]=s("h3",{class:"font-semibold text-sm"},"Smart Suggestion",-1)),a(r(G),{variant:r(c).variant,class:"text-[10px] px-2 py-0.5 h-5"},{default:b(()=>[S(w(r(c).label),1)]),_:1},8,["variant"])]),s("div",{class:"prose prose-sm dark:prose-invert max-w-none text-sm text-muted-foreground leading-relaxed",innerHTML:m.suggestion.suggestion_content},null,8,Se),m.analysis&&m.analysis.detected_issues.length>0?(x(),y("div",$e,[s("p",Te,[g[4]||(g[4]=s("span",{class:"w-1.5 h-1.5 rounded-full bg-amber-500"},null,-1)),S(" Issues: "+w(m.analysis.detected_issues.join(", ").replace(/_/g," ")),1)])])):j("",!0)]),s("div",je,[a(r($),{size:"icon",variant:"ghost",class:"h-7 w-7",onClick:g[0]||(g[0]=p=>t("clear")),title:"Dismiss"},{default:b(()=>[a(r(R),{class:"w-4 h-4"})]),_:1}),a(r($),{size:"icon",variant:"ghost",class:"h-7 w-7",onClick:g[1]||(g[1]=p=>t("save")),title:"Save for later"},{default:b(()=>[a(r(xe),{class:"w-4 h-4"})]),_:1})])]),s("div",Ae,[a(r($),{size:"sm",variant:"default",onClick:g[2]||(g[2]=p=>t("apply")),class:"w-full sm:w-auto"},{default:b(()=>[...g[5]||(g[5]=[S(" Apply Suggestion ",-1)])]),_:1})])]))}}),ze={class:"space-y-2"},Ie={class:"flex items-center gap-3"},Be={class:"flex flex-col items-start gap-1"},Pe={key:0,class:"text-[10px] text-muted-foreground"},Me={key:0,class:"flex items-center justify-center py-8"},Ee={class:"space-y-2"},Fe={class:"flex justify-between text-xs"},Ne={class:"text-muted-foreground"},Re={class:"space-y-3"},Ue={class:"flex items-center justify-between"},We={class:"text-sm font-semibold flex items-center gap-2"},De={class:"space-y-2"},He=["onClick"],qe={key:0,class:"p-3 rounded-lg bg-blue-500/10 border border-blue-500/20"},Oe={class:"flex items-start gap-2"},Ge={class:"flex-1"},Ke={class:"text-xs leading-relaxed text-foreground"},Qe={class:"space-y-3"},Ve={class:"text-sm font-semibold flex items-center gap-2"},Xe={class:"space-y-2"},Ye={key:2,class:"text-center py-8"},Ze={class:"text-sm text-muted-foreground"},Je=M({__name:"ProgressiveGuidancePanel",props:{guidance:{},isLoading:{type:Boolean},hasContent:{type:Boolean}},emits:["toggleStep","guidanceAction"],setup(f,{emit:i}){const l=f,t=i,u=_(!0),c=F(()=>{const p=l.guidance?.stage||"planning",o={planning:"bg-blue-500/10 text-blue-600 dark:text-blue-400",introduction:"bg-purple-500/10 text-purple-600 dark:text-purple-400",body_development:"bg-amber-500/10 text-amber-600 dark:text-amber-400",body_advanced:"bg-orange-500/10 text-orange-600 dark:text-orange-400",refinement:"bg-green-500/10 text-green-600 dark:text-green-400"};return o[p]||o.planning}),m=F(()=>l.guidance?l.guidance.next_steps.filter(p=>p.completed).length:0),g=F(()=>l.guidance?.next_steps.length||0);return(p,o)=>(x(),y("div",ze,[a(r(Q),{open:u.value,"onUpdate:open":o[0]||(o[0]=n=>u.value=n),class:"space-y-2"},{default:b(()=>[a(r(V),{class:"flex w-full items-center justify-between rounded-xl p-4 hover:bg-accent/50 transition-colors duration-200 group"},{default:b(()=>[s("div",Ie,[s("div",{class:L(["p-2 rounded-lg",c.value])},[a(r(N),{class:"h-4 w-4"})],2),s("div",Be,[o[1]||(o[1]=s("span",{class:"text-sm font-semibold"},"Writing Progress",-1)),p.guidance?(x(),y("span",Pe,w(p.guidance.stage_label),1)):j("",!0)])]),a(r(Y),{class:L(["h-4 w-4 text-muted-foreground transition-transform duration-200",u.value?"rotate-180":""])},null,8,["class"])]),_:1}),a(r(X),{class:"space-y-4 px-4 pb-4"},{default:b(()=>[p.isLoading?(x(),y("div",Me,[a(r(le),{class:"h-6 w-6 animate-spin text-muted-foreground"})])):p.guidance?(x(),y(B,{key:1},[s("div",Ee,[s("div",Fe,[o[2]||(o[2]=s("span",{class:"font-medium text-foreground"},"Overall Progress",-1)),s("span",Ne,w(p.guidance.completion_percentage)+"% ",1)]),a(r(re),{"model-value":p.guidance.completion_percentage,class:"h-2"},null,8,["model-value"])]),a(r(I),{class:"bg-border/50"}),s("div",Re,[s("div",Ue,[s("h4",We,[a(r(H),{class:"h-4 w-4 text-primary"}),o[3]||(o[3]=S(" Next Steps ",-1))]),a(r(G),{variant:"secondary",class:"text-[10px] px-2 py-0.5"},{default:b(()=>[S(w(m.value)+" / "+w(g.value),1)]),_:1})]),s("div",De,[(x(!0),y(B,null,W(p.guidance.next_steps,n=>(x(),y("div",{key:n.id,class:"flex items-start gap-3 p-3 rounded-lg hover:bg-accent/30 transition-colors duration-200 cursor-pointer group",onClick:h=>t("toggleStep",n.id)},[a(r(ie),{checked:n.completed,"onUpdate:checked":h=>t("toggleStep",n.id),class:"mt-0.5"},null,8,["checked","onUpdate:checked"]),s("span",{class:L(["text-xs leading-relaxed flex-1",n.completed?"line-through text-muted-foreground":"text-foreground"])},w(n.text),3),n.action&&n.action!=="none"?(x(),D(r($),{key:0,type:"button",size:"sm",variant:"ghost",class:"h-7 px-2 text-[11px] text-primary hover:bg-primary/10",onClick:ee(h=>t("guidanceAction",n.id),["stop"])},{default:b(()=>[S(w(n.action==="open_citation_helper"?"Citations":"Insert"),1)]),_:2},1032,["onClick"])):j("",!0)],8,He))),128))])]),p.guidance.contextual_tip?(x(),y("div",qe,[s("div",Oe,[a(r(K),{class:"h-4 w-4 text-blue-600 dark:text-blue-400 mt-0.5 flex-shrink-0"}),s("div",Ge,[s("p",Ke,w(p.guidance.contextual_tip),1)])])])):j("",!0),a(r(I),{class:"bg-border/50"}),s("div",Qe,[s("h4",Ve,[a(r(N),{class:"h-4 w-4 text-primary"}),o[4]||(o[4]=S(" Milestones ",-1))]),s("div",Xe,[(x(!0),y(B,null,W(p.guidance.writing_milestones,n=>(x(),y("div",{key:n.id,class:"flex items-center gap-3 p-2 rounded-lg"},[(x(),D(te(n.completed?r(H):r(ce)),{class:L(["h-4 w-4",n.completed?"text-green-600 dark:text-green-400":"text-muted-foreground"])},null,8,["class"])),s("span",{class:L(["text-xs",n.completed?"text-foreground font-medium":"text-muted-foreground"])},w(n.label),3)]))),128))])])],64)):(x(),y("div",Ye,[a(r(N),{class:"h-12 w-12 mx-auto text-muted-foreground/50 mb-3"}),s("p",Ze,[p.hasContent?(x(),y(B,{key:0},[S(" Analyzing your chapter to generate personalized guidanceâ€¦ ")],64)):(x(),y(B,{key:1},[S(" Start writing to get personalized guidance ")],64))])]))]),_:1})]),_:1},8,["open"])]))}});function P(f){if(!f)return 0;const l=String(f).replace(/<[^>]*>/g,"").trim().replace(/\s+/g," ");if(!l)return 0;const t=l.match(/\b\w+\b/g);return t?t.length:0}const et={class:"space-y-2"},tt={class:"flex items-center gap-3"},st={class:"p-2 rounded-lg bg-purple-500/10 text-purple-600 dark:text-purple-400"},at={class:"grid grid-cols-2 gap-2"},nt={class:"p-1.5 rounded-full bg-blue-500/10 text-blue-500"},ot={class:"text-xs font-medium"},rt={class:"p-1.5 rounded-full bg-purple-500/10 text-purple-500"},it={class:"text-xs font-medium"},lt={class:"p-1.5 rounded-full bg-orange-500/10 text-orange-500"},ct={class:"text-xs font-medium"},dt={class:"p-1.5 rounded-full bg-emerald-500/10 text-emerald-500"},ut={class:"text-xs font-medium"},pt=M({__name:"QuickActionsPanel",props:{projectSlug:{},chapterNumber:{},selectedText:{},chapterContent:{},isProcessing:{type:Boolean},ensureBalance:{type:Function},onUsage:{type:Function}},emits:["textImproved","textExpanded","citationsSuggested","textRephrased","customPromptExecuted","openCitationHelper"],setup(f,{emit:i}){const l=f,t=i,u=_(!0),c=_({improve:!1,expand:!1,cite:!1,rephrase:!1,custom:!1}),m=o=>{const n=l.selectedText?.trim()||"",h=l.chapterContent?.trim()||"";return o==="expand"||o==="rephrase"?n:h||n},g=async o=>{try{const n=await o.json();return n?.message||n?.error||`HTTP ${o.status}`}catch{return`HTTP ${o.status}`}},p=async o=>{if(l.ensureBalance&&!l.ensureBalance(300,"use quick actions"))return;const n=m(o);if(!n){C.error(o==="expand"||o==="rephrase"?"Please select some text first":"Please add some content first");return}if(!l.selectedText&&(o==="expand"||o==="rephrase")){C.error("Please select some text first");return}if(o==="cite"){t("openCitationHelper"),C("Opening citation helper...");return}c.value[o]=!0;try{let h="",k;switch(o){case"improve":h="projects.manual-editor.improve-text",k="textImproved";break;case"expand":h="projects.manual-editor.expand-text",k="textExpanded";break;case"rephrase":h="projects.manual-editor.rephrase-text",k="textRephrased";break}const e=await fetch(T(h,{project:l.projectSlug,chapter:l.chapterNumber}),{method:"POST",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":document.querySelector('meta[name="csrf-token"]')?.content||"",Accept:"application/json"},body:JSON.stringify({text:n})});if(!e.ok){const v=await g(e);throw new Error(v)}const d=await e.json();o==="improve"&&d.improvedText?(t("textImproved",d.improvedText),await l.onUsage?.(P(d.improvedText),"Manual editor: Improve"),C.success("Text improved successfully!")):o==="expand"&&d.expandedText?(t("textExpanded",d.expandedText),await l.onUsage?.(P(d.expandedText),"Manual editor: Expand"),C.success("Text expanded successfully!")):o==="rephrase"&&d.alternatives&&(t("textRephrased",d.alternatives),await l.onUsage?.(P(d.alternatives),"Manual editor: Rephrase"),C.success("Alternative phrasings generated!"))}catch(h){console.error(`Failed to ${o} text:`,h);const k=h instanceof Error?h.message:"";C.error(`Failed to ${o} text. Please try again.`,k?{description:k}:void 0)}finally{c.value[o]=!1}};return(o,n)=>(x(),y("div",et,[a(r(Q),{open:u.value,"onUpdate:open":n[4]||(n[4]=h=>u.value=h),class:"space-y-2"},{default:b(()=>[a(r(V),{class:"flex w-full items-center justify-between rounded-xl p-4 hover:bg-accent/50 transition-colors duration-200 group"},{default:b(()=>[s("div",tt,[s("div",st,[a(r(de),{class:"h-4 w-4"})]),n[5]||(n[5]=s("div",{class:"flex flex-col items-start gap-1"},[s("span",{class:"text-sm font-semibold"},"Quick Actions"),s("span",{class:"text-[10px] text-muted-foreground"}," AI-powered writing tools ")],-1))]),a(r(Y),{class:L(["h-4 w-4 text-muted-foreground transition-transform duration-200",u.value?"rotate-180":""])},null,8,["class"])]),_:1}),a(r(X),{class:"space-y-4 px-4 pb-4"},{default:b(()=>[s("div",at,[a(r($),{onClick:n[0]||(n[0]=h=>p("improve")),disabled:o.isProcessing||c.value.improve,variant:"outline",class:"h-20 flex-col gap-2 rounded-xl border-border/50 bg-background/50 hover:bg-accent hover:border-accent transition-all duration-300"},{default:b(()=>[s("div",nt,[a(r(pe),{class:"h-4 w-4"})]),s("span",ot,w(c.value.improve?"Improving...":"Improve"),1)]),_:1},8,["disabled"]),a(r($),{onClick:n[1]||(n[1]=h=>p("expand")),disabled:!o.selectedText||o.isProcessing||c.value.expand,variant:"outline",class:"h-20 flex-col gap-2 rounded-xl border-border/50 bg-background/50 hover:bg-accent hover:border-accent transition-all duration-300"},{default:b(()=>[s("div",rt,[a(r(ge),{class:"h-4 w-4"})]),s("span",it,w(c.value.expand?"Expanding...":"Expand"),1)]),_:1},8,["disabled"]),a(r($),{onClick:n[2]||(n[2]=h=>p("cite")),disabled:o.isProcessing||c.value.cite,variant:"outline",class:"h-20 flex-col gap-2 rounded-xl border-border/50 bg-background/50 hover:bg-accent hover:border-accent transition-all duration-300"},{default:b(()=>[s("div",lt,[a(r(me),{class:"h-4 w-4"})]),s("span",ct,w(c.value.cite?"Citing...":"Cite"),1)]),_:1},8,["disabled"]),a(r($),{onClick:n[3]||(n[3]=h=>p("rephrase")),disabled:!o.selectedText||o.isProcessing||c.value.rephrase,variant:"outline",class:"h-20 flex-col gap-2 rounded-xl border-border/50 bg-background/50 hover:bg-accent hover:border-accent transition-all duration-300"},{default:b(()=>[s("div",dt,[a(r(fe),{class:"h-4 w-4"})]),s("span",ut,w(c.value.rephrase?"Rephrasing...":"Rephrase"),1)]),_:1},8,["disabled"])]),n[6]||(n[6]=s("div",{class:"p-3 rounded-lg bg-muted/50 border border-border/50"},[s("p",{class:"text-[10px] text-muted-foreground leading-relaxed"},[s("strong",null,"Tip:"),S(" Select text before using Expand or Rephrase. Improve and Cite work on your entire content. ")])],-1))]),_:1})]),_:1},8,["open"])]))}}),gt={key:0,class:"fixed inset-0 z-50 lg:hidden"},mt={class:"fixed top-0 left-0 h-full w-80 overflow-y-auto border-r bg-background shadow-xl transform transition-transform"},ft={class:"border-b p-3"},ht={class:"flex items-center justify-between"},vt={class:"space-y-4 p-4 mobile-enhanced"},bt={key:0,class:"fixed inset-0 z-50 lg:hidden"},xt={class:"fixed top-0 right-0 h-full w-96 overflow-y-auto border-l bg-background shadow-xl transform transition-transform"},yt={class:"border-b p-3"},wt={class:"flex items-center justify-between"},_t={class:"space-y-4 p-4 mobile-enhanced"},Ct={key:0,class:"space-y-2"},kt=M({__name:"MobileNavOverlay",props:{showLeftSidebar:{type:Boolean},showRightSidebar:{type:Boolean},isMobile:{type:Boolean},allChapters:{},currentChapter:{},project:{},facultyChapters:{},currentWordCount:{},targetWordCount:{},chapterContentLength:{},selectedText:{},isAnalyzing:{type:Boolean},isSaving:{type:Boolean},currentSuggestion:{},currentAnalysis:{},guidance:{},isLoadingGuidance:{type:Boolean},chapterContent:{},showCitationHelper:{type:Boolean},ensureBalance:{type:Function},onUsage:{type:Function}},emits:["update:showLeftSidebar","update:showRightSidebar","update:showCitationHelper","goToChapter","generateNextChapter","deleteChapter","saveSuggestion","clearSuggestion","applySuggestion","toggleStep","textImproved","textExpanded","citationsSuggested","textRephrased","insertCitation"],setup(f,{emit:i}){const l=f,t=i,u=_(!0),c=_(l.showCitationHelper);O(()=>l.showCitationHelper,e=>{c.value=e});const m=()=>t("update:showLeftSidebar",!1),g=()=>t("update:showRightSidebar",!1),p=e=>{c.value=e,t("update:showCitationHelper",e)},o=e=>{t("goToChapter",e),m()},n=()=>t("generateNextChapter"),h=e=>t("deleteChapter",e),k=e=>t("insertCitation",e);return(e,d)=>(x(),y("div",null,[a(A,{"enter-active-class":"duration-300 ease-out","enter-from-class":"opacity-0","enter-to-class":"opacity-100","leave-active-class":"duration-200 ease-in","leave-from-class":"opacity-100","leave-to-class":"opacity-0"},{default:b(()=>[e.showLeftSidebar&&e.isMobile?(x(),y("div",gt,[a(A,{"enter-active-class":"duration-300 ease-out","enter-from-class":"opacity-0","enter-to-class":"opacity-100","leave-active-class":"duration-200 ease-in","leave-from-class":"opacity-100","leave-to-class":"opacity-0"},{default:b(()=>[s("div",{class:"fixed inset-0 bg-black/50",onClick:m})]),_:1}),a(A,{"enter-active-class":"duration-300 ease-out","enter-from-class":"-translate-x-full","enter-to-class":"translate-x-0","leave-active-class":"duration-200 ease-in","leave-from-class":"translate-x-0","leave-to-class":"-translate-x-full"},{default:b(()=>[s("div",mt,[s("div",ft,[s("div",ht,[d[10]||(d[10]=s("h2",{class:"text-base font-semibold"},"Table of Contents",-1)),a(r($),{onClick:m,variant:"ghost",size:"sm",class:"h-8 w-8"},{default:b(()=>[a(r(R),{class:"h-4 w-4"})]),_:1})])]),s("div",vt,[a(oe,{"all-chapters":e.allChapters,"current-chapter":e.currentChapter,project:e.project,outlines:e.project.outlines||[],"faculty-chapters":e.facultyChapters||[],"current-word-count":e.currentWordCount,"target-word-count":e.targetWordCount,"writing-quality-score":0,"chapter-content-length":e.chapterContentLength,onGoToChapter:o,onGenerateNextChapter:n,onDeleteChapter:h},null,8,["all-chapters","current-chapter","project","outlines","faculty-chapters","current-word-count","target-word-count","chapter-content-length"])])])]),_:1})])):j("",!0)]),_:1}),a(A,{"enter-active-class":"duration-300 ease-out","enter-from-class":"opacity-0","enter-to-class":"opacity-100","leave-active-class":"duration-200 ease-in","leave-from-class":"opacity-100","leave-to-class":"opacity-0"},{default:b(()=>[e.showRightSidebar&&e.isMobile?(x(),y("div",bt,[a(A,{"enter-active-class":"duration-300 ease-out","enter-from-class":"opacity-0","enter-to-class":"opacity-100","leave-active-class":"duration-200 ease-in","leave-from-class":"opacity-100","leave-to-class":"opacity-0"},{default:b(()=>[s("div",{class:"fixed inset-0 bg-black/50",onClick:g})]),_:1}),a(A,{"enter-active-class":"duration-300 ease-out","enter-from-class":"translate-x-full","enter-to-class":"translate-x-0","leave-active-class":"duration-200 ease-in","leave-from-class":"translate-x-0","leave-to-class":"translate-x-full"},{default:b(()=>[s("div",xt,[s("div",yt,[s("div",wt,[d[11]||(d[11]=s("h2",{class:"text-base font-semibold"},"AI Tools",-1)),a(r($),{onClick:g,variant:"ghost",size:"sm",class:"h-8 w-8"},{default:b(()=>[a(r(R),{class:"h-4 w-4"})]),_:1})])]),s("div",_t,[e.currentSuggestion?(x(),y("div",Ct,[a(Le,{suggestion:e.currentSuggestion,analysis:e.currentAnalysis,onSave:d[0]||(d[0]=v=>e.$emit("saveSuggestion",v)),onClear:d[1]||(d[1]=v=>e.$emit("clearSuggestion")),onApply:d[2]||(d[2]=v=>e.$emit("applySuggestion"))},null,8,["suggestion","analysis"]),a(r(I),{class:"bg-border/50"})])):j("",!0),a(Je,{guidance:e.guidance,"is-loading":e.isLoadingGuidance,onToggleStep:d[3]||(d[3]=v=>e.$emit("toggleStep",v))},null,8,["guidance","is-loading"]),a(r(I),{class:"bg-border/50"}),a(pt,{"project-slug":e.project.slug,"chapter-number":e.currentChapter.chapter_number,"selected-text":e.selectedText,"chapter-content":e.chapterContent,"is-processing":e.isAnalyzing||e.isSaving,"ensure-balance":e.ensureBalance,"on-usage":e.onUsage,onTextImproved:d[4]||(d[4]=v=>e.$emit("textImproved",v)),onTextExpanded:d[5]||(d[5]=v=>e.$emit("textExpanded",v)),onCitationsSuggested:d[6]||(d[6]=v=>e.$emit("citationsSuggested",v)),onTextRephrased:d[7]||(d[7]=v=>e.$emit("textRephrased",v))},null,8,["project-slug","chapter-number","selected-text","chapter-content","is-processing","ensure-balance","on-usage"]),a(r(I),{class:"bg-border/50"}),a(ue,{"show-citation-helper":c.value,"onUpdate:showCitationHelper":[d[8]||(d[8]=v=>c.value=v),p],"chapter-content":e.chapterContent,onInsertCitation:k},null,8,["show-citation-helper","chapter-content"]),a(r(I),{class:"bg-border/50"}),a(he,{"show-defense-prep":u.value,"onUpdate:showDefensePrep":d[9]||(d[9]=v=>u.value=v),questions:[],"is-loading":!1,"is-generating":!1,"chapter-context":{project:e.project,chapter:e.currentChapter,wordCount:e.currentWordCount},onGenerateMore:()=>{},onRefresh:()=>{}},null,8,["show-defense-prep","chapter-context"])])])]),_:1})])):j("",!0)]),_:1})]))}}),Vt=ve(kt,[["__scopeId","data-v-4ca5dd74"]]);function Xt(f,i){const l=_(f.content||""),t=_(!1),u=_(!1),c=_(null),m=e=>{l.value=e,t.value=!0,p()},g=async()=>{if(!(!t.value||u.value)){u.value=!0;try{await z.post(T("projects.manual-editor.save",{project:i,chapter:f.chapter_number}),{content:l.value}),t.value=!1,c.value=new Date().toLocaleTimeString()}catch(e){throw console.error("Failed to save chapter:",e),e}finally{u.value=!1}}},p=Z(g,2e3),o=async()=>{if(!u.value){u.value=!0;try{return await z.post(T("projects.manual-editor.save",{project:i,chapter:f.chapter_number}),{content:l.value}),t.value=!1,c.value=new Date().toLocaleTimeString(),!0}catch(e){throw console.error("Failed to save chapter:",e),e}finally{u.value=!1}}},n=e=>{t.value&&(e.preventDefault(),e.returnValue="")},h=e=>{t.value&&!confirm("You have unsaved changes. Are you sure you want to leave?")&&e.preventDefault()};window.addEventListener("beforeunload",n);const k=se.on("before",h);return ae(()=>{window.removeEventListener("beforeunload",n),k(),t.value&&g()}),{content:l,isDirty:t,isSaving:u,lastSaved:c,updateContent:m,save:g,manualSave:o}}class q{static analyze(i){const t=new DOMParser().parseFromString(i,"text/html");return{word_count:this.countWords(t),citation_count:this.countCitations(t),table_count:this.countTables(t),figure_count:this.countFigures(t),claim_count:this.countClaims(t),has_introduction:this.hasIntroduction(t),has_conclusion:this.hasConclusion(t),detected_issues:this.detectIssues(t),quality_metrics:this.calculateQualityMetrics(t)}}static countWords(i){return(i.body.textContent||"").trim().split(/\s+/).filter(t=>t.length>0).length}static countCitations(i){const l=i.body.textContent||"",t=[/\([A-Z][a-z]+,?\s+\d{4}\)/g,/\[[0-9]+\]/g,/\([A-Z][a-z]+\s+et al\.,?\s+\d{4}\)/g];let u=0;return t.forEach(c=>{const m=l.match(c);m&&(u+=m.length)}),u+=i.querySelectorAll("cite, [data-citation]").length,u}static countTables(i){return i.querySelectorAll("table").length}static countFigures(i){return i.querySelectorAll("img, figure").length}static countClaims(i){const t=(i.body.textContent||"").split(/[.!?]+/),u=["demonstrates","proves","shows","indicates","reveals","confirms","establishes","suggests","implies","evidences"];return t.filter(c=>u.some(m=>c.toLowerCase().includes(m))).length}static hasIntroduction(i){const l=(i.body.textContent||"").toLowerCase();return["introduction","background","overview"].some(u=>l.includes(u))}static hasConclusion(i){const l=(i.body.textContent||"").toLowerCase();return["conclusion","summary","in summary"].some(u=>l.includes(u))}static detectIssues(i){const l=[],t=i.body.textContent||"",u=this.countClaims(i),c=this.countCitations(i);return u>0&&c===0&&l.push("claims_without_evidence"),u>c*2&&l.push("insufficient_citations"),t.toLowerCase().includes("methodology")&&this.countTables(i)===0&&l.push("insufficient_tables"),["maybe","might","could possibly","seems to"].some(n=>t.toLowerCase().includes(n))&&u>3&&l.push("weak_arguments"),this.countWords(i)<100&&l.push("insufficient_content"),l}static calculateQualityMetrics(i){const t=(i.body.textContent||"").split(/[.!?]+/).filter(m=>m.trim().length>0),u=i.querySelectorAll("p").length,c=t.length>0?this.countWords(i)/t.length:0;return{avg_sentence_length:Math.round(c),paragraph_count:u,reading_level:c>25?"complex":c>15?"moderate":"simple"}}}function Yt(f,i,l,t,u){const c=_(l),m=_(null),g=_(!1),p=_(new Set),n=Z(async()=>{if(!(t.value.length<100)&&!(!i||!f?.chapter_number)){g.value=!0;try{const d=q.analyze(t.value);if(m.value=d,d.detected_issues.length===0){g.value=!1;return}const v=await z.post(T("projects.manual-editor.analyze",{project:i,chapter:f.chapter_number}),{analysis:d});if(v.data.suggestion){c.value=v.data.suggestion;const E=Number(v.data.suggestion?.id);if(E&&!p.value.has(E)){const U=P(v.data.suggestion?.suggestion_content||"");U>0&&(p.value.add(E),be(U,"Manual editor: Smart suggestion","chapter",f.id).then(()=>u?.onUsageRecorded?.()).catch(J=>console.error("Failed to record word usage (manual suggestion):",J)))}}}catch(d){console.error("Failed to analyze and request suggestion:",d)}finally{g.value=!1}}},5e3);return O(t,()=>{t.value.length>0&&(m.value=q.analyze(t.value)),n()}),{currentSuggestion:c,currentAnalysis:m,isAnalyzing:g,saveSuggestion:async()=>{if(c.value&&!(!i||!f?.chapter_number))try{await z.post(T("projects.manual-editor.suggestion.save",{project:i,chapter:f.chapter_number,suggestion:c.value.id})),C("Suggestion saved",{description:"You can refer to this suggestion later."})}catch{C("Failed to save suggestion",{description:"Please try again."})}},clearSuggestion:async()=>{if(c.value&&!(!i||!f?.chapter_number))try{await z.post(T("projects.manual-editor.suggestion.clear",{project:i,chapter:f.chapter_number,suggestion:c.value.id})),c.value=null}catch{C("Failed to clear suggestion",{description:"Please try again."})}},applySuggestion:async()=>{if(c.value&&!(!i||!f?.chapter_number))try{await z.post(T("projects.manual-editor.suggestion.apply",{project:i,chapter:f.chapter_number,suggestion:c.value.id})),C("Suggestion applied",{description:"The suggestion has been marked as applied."}),c.value=null}catch{C("Failed to apply suggestion",{description:"Please try again."})}}}}export{Vt as M,pt as _,Yt as a,Je as b,Le as c,P as d,Xt as u};
