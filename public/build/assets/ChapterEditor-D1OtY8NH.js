const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/ChapterNavigation-C_ROOVdz.js","assets/ChapterNavigation.vue_vue_type_script_setup_true_lang-C7c8E1ku.js","assets/index-CwD5qkLf.js","assets/vendor-H8yUxHVJ.js","assets/ScrollArea.vue_vue_type_script_setup_true_lang-LIFwRXiL.js","assets/Presence-Cn1h4MwK.js","assets/useForwardExpose-CEOuSuYA.js","assets/index-CZRrGrlM.js","assets/useNonce-DREsFUzM.js","assets/AlertDialogTitle.vue_vue_type_script_setup_true_lang-Cl9cN4K9.js","assets/DialogTitle-FvR-dACM.js","assets/DialogTrigger-Di-hhkc3.js","assets/index-CiWGHnJL.js","assets/useAppearance-DRazjLJ1.js","assets/MobileNavOverlay-CZYu4yXy.js","assets/index-DHzEmSrj.js","assets/DefensePreparationPanel.vue_vue_type_script_setup_true_lang-CkGWB1gK.js","assets/CardContent.vue_vue_type_script_setup_true_lang-DTkdfvuV.js","assets/CardTitle.vue_vue_type_script_setup_true_lang-B5y-_hAe.js","assets/CollapsibleTrigger.vue_vue_type_script_setup_true_lang-BXeGqnTB.js","assets/CollapsibleTrigger-BfLHHp56.js","assets/Progress.vue_vue_type_script_setup_true_lang-BEO86XnR.js","assets/nullish-CHIgUVhi.js","assets/Separator.vue_vue_type_script_setup_true_lang-CQwVu7eO.js","assets/Separator-BJVyT-Jr.js","assets/Switch.vue_vue_type_script_setup_true_lang-DCko7Dmp.js","assets/useFormControl-BAvnyqrf.js","assets/VisuallyHiddenInput-Bdtjo0T1.js","assets/VisuallyHidden-BvUOvbOk.js","assets/_plugin-vue_export-helper-DlAUqK2U.js","assets/TooltipTrigger.vue_vue_type_script_setup_true_lang-ev0g6x5g.js","assets/Sonner.vue_vue_type_script_setup_true_lang-a4iHnNww.js","assets/WordBalanceDisplay.vue_vue_type_script_setup_true_lang-BbR_80zF.js","assets/AppLayout.vue_vue_type_script_setup_true_lang-B_2lTwBH.js","assets/UserInfo.vue_vue_type_script_setup_true_lang-B2g6QnB0.js","assets/AppLogo.vue_vue_type_script_setup_true_lang-D_e9DFFg.js","assets/useWordBalance-C1hXK7OD.js","assets/PWAInstallPrompt.vue_vue_type_script_setup_true_lang-DBvrqREh.js","assets/driver-B4w0q6_T.js","assets/driver-DB0Q8XAf.css","assets/PurchaseModal.vue_vue_type_script_setup_true_lang-C2jaO2Qs.js","assets/DialogContent.vue_vue_type_script_setup_true_lang-Dw7gJkgN.js","assets/DialogDescription.vue_vue_type_script_setup_true_lang-nvWA5ydV.js","assets/DialogFooter.vue_vue_type_script_setup_true_lang-DjMQinTr.js","assets/DialogTitle.vue_vue_type_script_setup_true_lang-Biexvk_x.js","assets/useChapterWordCount-EdL0jc5R.js","assets/Input.vue_vue_type_script_setup_true_lang-DRx-Lc7N.js","assets/Label.vue_vue_type_script_setup_true_lang-PAGjh1rG.js","assets/RichTextEditor-nW-jbWTT.js","assets/index-C7juShHH.js","assets/purify.es-DxJI3Wx7.js","assets/step-CXjX0ghh.js","assets/index-BtQV9efE.css","assets/RichTextEditor-lu3-cOx4.css","assets/RichTextViewer-CQFJwJ3K.js","assets/RichTextViewer-DtmUEoMb.css","assets/useTextHistory-DHSBZqEV.js","assets/Checkbox.vue_vue_type_script_setup_true_lang-DRWhnreH.js","assets/isValueEqualOrExist-DSClXoPv.js","assets/ohash.D__AXeF1-C-E83dC9.js","assets/RovingFocusItem-B851wM0P.js","assets/MobileNavOverlay-CN-XSdXy.css","assets/ChatModeLayout-Bjn_rZBh.js","assets/ChatModeLayout-Dr0PWGkM.css","assets/CitationVerificationLayout-DHBucKRH.js","assets/SafeHtmlText.vue_vue_type_script_setup_true_lang-EuopzgQ8.js"])))=>i.map(i=>d[i]);
import{u as Yt,s as K,_ as Qe}from"./useAppearance-DRazjLJ1.js";import{s as Zt,G as ue,aI as P,r as b,l as D,q as te,cq as er,J as Ae,v as Te,bh as de,d as Xe,g as F,o as v,u as e,w as o,e as r,b as s,h as i,t as c,W as He,b9 as es,X as Se,Z as De,bi as ut,bD as ts,bk as Je,c as N,bc as Ge,at as tr,a0 as Rt,b2 as $e,a as V,aK as Mt,a5 as sr,a4 as rr,bg as or,p as nr,ct as ar,bR as lr,az as ir,cy as dr,aJ as ur,x as cr,F as Ft,cz as Ke,bb as it,aR as zt,by as Lt,cx as Nt,bT as Ot,b7 as Wt,b6 as qt,av as Ve,cA as pr,m as Gt,S as It,br as gr,bq as fr,cB as mr,a2 as hr,bt as vr,bs as br,M as xr}from"./vendor-H8yUxHVJ.js";import{_ as Ce}from"./index-CiWGHnJL.js";import{_}from"./index-CwD5qkLf.js";import{_ as se,a as re}from"./CardContent.vue_vue_type_script_setup_true_lang-DTkdfvuV.js";import{_ as oe,a as ie}from"./CardTitle.vue_vue_type_script_setup_true_lang-B5y-_hAe.js";import{_ as Ht}from"./ScrollArea.vue_vue_type_script_setup_true_lang-LIFwRXiL.js";import{_ as Ie}from"./Separator.vue_vue_type_script_setup_true_lang-CQwVu7eO.js";import{a as J,b as X,_ as Y}from"./TooltipTrigger.vue_vue_type_script_setup_true_lang-ev0g6x5g.js";import{_ as wr}from"./WordBalanceDisplay.vue_vue_type_script_setup_true_lang-BbR_80zF.js";import{a as Bt,_ as Ut}from"./AppLayout.vue_vue_type_script_setup_true_lang-B_2lTwBH.js";import{A as yr}from"./driver-B4w0q6_T.js";import{_ as _r}from"./PurchaseModal.vue_vue_type_script_setup_true_lang-C2jaO2Qs.js";import{r as kr,u as Cr}from"./useWordBalance-C1hXK7OD.js";import{a as Sr,u as Er,b as Tr}from"./useChapterWordCount-EdL0jc5R.js";import{_ as Ar}from"./Input.vue_vue_type_script_setup_true_lang-DRx-Lc7N.js";import{_ as Dr}from"./Label.vue_vue_type_script_setup_true_lang-PAGjh1rG.js";import{R as ss}from"./RichTextEditor-nW-jbWTT.js";import{R as rs}from"./RichTextViewer-CQFJwJ3K.js";import{_ as Qt,a as Kt,b as Vt}from"./CollapsibleTrigger.vue_vue_type_script_setup_true_lang-BXeGqnTB.js";import{_ as $r}from"./Progress.vue_vue_type_script_setup_true_lang-BEO86XnR.js";import{a as jr,u as Pr,_ as dt}from"./useTextHistory-DHSBZqEV.js";import{_ as os}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./index-CZRrGrlM.js";import"./Presence-Cn1h4MwK.js";import"./useForwardExpose-CEOuSuYA.js";import"./useNonce-DREsFUzM.js";import"./Separator-BJVyT-Jr.js";import"./Sonner.vue_vue_type_script_setup_true_lang-a4iHnNww.js";import"./DialogTitle-FvR-dACM.js";import"./VisuallyHidden-BvUOvbOk.js";import"./UserInfo.vue_vue_type_script_setup_true_lang-B2g6QnB0.js";import"./AppLogo.vue_vue_type_script_setup_true_lang-D_e9DFFg.js";import"./PWAInstallPrompt.vue_vue_type_script_setup_true_lang-DBvrqREh.js";import"./DialogContent.vue_vue_type_script_setup_true_lang-Dw7gJkgN.js";import"./DialogDescription.vue_vue_type_script_setup_true_lang-nvWA5ydV.js";import"./DialogFooter.vue_vue_type_script_setup_true_lang-DjMQinTr.js";import"./DialogTitle.vue_vue_type_script_setup_true_lang-Biexvk_x.js";import"./index-C7juShHH.js";import"./purify.es-DxJI3Wx7.js";import"./step-CXjX0ghh.js";import"./CollapsibleTrigger-BfLHHp56.js";import"./nullish-CHIgUVhi.js";import"./AlertDialogTitle.vue_vue_type_script_setup_true_lang-Cl9cN4K9.js";import"./Checkbox.vue_vue_type_script_setup_true_lang-DRWhnreH.js";import"./isValueEqualOrExist-DSClXoPv.js";import"./ohash.D__AXeF1-C-E83dC9.js";import"./useFormControl-BAvnyqrf.js";import"./RovingFocusItem-B851wM0P.js";import"./VisuallyHiddenInput-Bdtjo0T1.js";function Rr(m){const w=Zt();ue(()=>w.props?.flash,G=>{G&&(G.success&&P.success(G.success),G.error&&P.error(G.error))},{deep:!0,immediate:!0});const l=b(m.chapter.title||""),$=b(m.chapter.content||""),z=b(!0),{isDark:n,toggle:k}=Yt(),g=D(()=>n.value),j=()=>{},y=()=>{k()},R=b(!1),E=b(!1),T=b(!1),p=b("write"),h=b(""),L=b(0),B=b(!1),U=b(!1),x=b(!0),d=()=>{try{return localStorage.getItem(`chatMode_${m.project.id}_${m.chapter.chapter_number}`)==="true"}catch(G){return console.warn("Failed to load chat mode from localStorage:",G),!1}},f=G=>{try{localStorage.setItem(`chatMode_${m.project.id}_${m.chapter.chapter_number}`,String(G))}catch(ae){console.warn("Failed to save chat mode to localStorage:",ae)}},ce=b(!1),ne=b(!1),S=b(!1),Z=b(!1),O=b(!1),q=b(!0),Q=b(!0);return{chapterTitle:l,chapterContent:$,showPreview:z,isEditorDark:g,initChapterTheme:j,toggleChapterTheme:y,isNativeFullscreen:R,showAISidebar:E,showStatistics:T,activeTab:p,selectedText:h,cursorPosition:L,showChatMode:B,showCitationMode:U,showDefensePrep:x,loadChatModeFromStorage:d,saveChatModeToStorage:f,showLeftSidebar:ce,showRightSidebar:ne,isMobile:S,isLeftSidebarCollapsed:Z,isRightSidebarCollapsed:O,showLeftSidebarInFullscreen:q,showRightSidebarInFullscreen:Q}}function Mr({props:m,allChapters:w,targetWordCount:l,estimates:$,ensureBalance:z,save:n}){return{generateNextChapter:async()=>{const g=$.chapter(l.value||0);if(!z(g,"generate the next chapter with AI"))return;await n();const j=w.map(E=>E.chapter_number).sort((E,T)=>E-T),y=j.indexOf(m.chapter.chapter_number);let R;if(y===-1||y===j.length-1)R=Math.max(...j)+1;else{const E=j[y+1];E===m.chapter.chapter_number+1?R=E:R=m.chapter.chapter_number+1}try{const E=K("chapters.write",{project:m.project.slug,chapter:R}),T=new URL(E,window.location.origin);T.searchParams.set("ai_generate","true"),T.searchParams.set("generation_type","progressive"),te.visit(T.toString())}catch(E){console.error("âŒ Error generating next chapter:",E)}}}}function Fr(m,w,l,$){const n=b(!1),k=b(0),g=b(!1),j=S=>{if(!S)return 0;const O=S.replace(/<[^>]*>/g,"").trim().replace(/\s+/g," ");if(!O)return 0;const q=O.match(/\b\w+\b/g);return q?q.length:0},y=D(()=>j(l.value)),R=D(()=>y.value>=800),E=()=>`defense_generation_triggered_${m.id}_ch_${w.chapter_number}`,T=()=>{const S=E();return localStorage.getItem(S)==="true"},p=()=>{const S=E();localStorage.setItem(S,"true"),n.value=!0},h=()=>{const S=E();localStorage.removeItem(S),n.value=!1,console.log(`ðŸ”„ DEFENSE WATCHER: Reset generation trigger for Chapter ${w.chapter_number}`)},L=er(async()=>{if(!g.value)return;const S=y.value;console.log(`ðŸ“Š DEFENSE WATCHER: Word count check - Chapter ${w.chapter_number}: ${S} words`),S<800*.8&&n.value&&(console.log("â¬‡ï¸ DEFENSE WATCHER: Content dropped below 80% of threshold, resetting trigger"),h()),k.value=S},2e3),B=()=>g.value?void 0:(g.value=!0,n.value=T(),k.value=y.value,console.log(`ðŸ‘€ DEFENSE WATCHER: Started watching Chapter ${w.chapter_number}`),console.log(`   Initial word count: ${k.value}`),console.log(`   Generation already triggered: ${n.value}`),console.log("   Threshold: 800 words"),ue(l,(Z,O)=>{Z!==O&&L()},{immediate:!1})),U=()=>{g.value=!1,L.cancel(),console.log(`ðŸ›‘ DEFENSE WATCHER: Stopped watching Chapter ${w.chapter_number}`)},x=async()=>{console.log(`ðŸ” DEFENSE WATCHER: Force checking Chapter ${w.chapter_number}`),await L(),L.flush()},d=D(()=>{const S=y.value;return S>0&&S<800&&!n.value}),f=D(()=>{const S=y.value/800*100;return Math.min(S,100)}),ce=D(()=>{const S=800-y.value;return Math.max(S,0)});return{isWatching:g,hasTriggeredGeneration:n,currentWordCount:y,lastWordCount:k,meetsThreshold:R,shouldShowProgressIndicator:d,progressPercentage:f,wordsRemaining:ce,startWatching:B,stopWatching:U,forceCheck:x,resetGenerationTrigger:h,markGenerationTriggered:p,getStatusMessage:()=>{const S=y.value;return n.value?`Defense questions available (${S} words)`:S>=800?`Ready for defense questions (${S} words)`:S>0?`${800-S} more words needed for defense questions`:"Start writing to enable defense questions (800 words needed)"},countWords:j,DEFENSE_WORD_COUNT_THRESHOLD:800}}function zr({props:m,chapterContent:w,currentWordCount:l,ensureBalance:$,estimates:z}){const n=b([]),k=b(!1),g=b(!1),j=b(null),y=b(!1),R=D(()=>m.chapter),{hasTriggeredGeneration:E,startWatching:T,stopWatching:p,forceCheck:h,getStatusMessage:L,markGenerationTriggered:B,meetsThreshold:U,shouldShowProgressIndicator:x,progressPercentage:d,wordsRemaining:f,DEFENSE_WORD_COUNT_THRESHOLD:ce}=Fr(m.project,m.chapter,w),ne=(A,M)=>`defense_auto_generate_${A}_ch_${M}`,S=()=>{try{return localStorage.getItem(ne(m.project.id,m.chapter.chapter_number))==="true"}catch(A){return console.warn("Failed to load defense auto-generation preference:",A),!1}},Z=A=>{try{localStorage.setItem(ne(m.project.id,m.chapter.chapter_number),String(A))}catch(M){console.warn("Failed to save defense auto-generation preference:",M)}};y.value=S();const O=()=>{if(!n.value.length||!j.value)return!0;const A=new Date(Date.now()-360*60*1e3);return j.value<A},q=async(A=!1,M={})=>{if(k.value)return;const W=M.skipGeneration??!0;k.value=!0;try{console.log("Loading defense questions with params:",{project_id:m.project.id,chapter_number:R.value?.chapter_number,limit:5,force_refresh:A,skip_generation:W});const C=await de.get(`/api/projects/${m.project.id}/defense/questions`,{params:{chapter_number:R.value?.chapter_number||null,limit:5,force_refresh:A?1:0,skip_generation:W?1:0},headers:{Accept:"application/json","X-Requested-With":"XMLHttpRequest"}});if(console.log("Defense questions loaded:",C.data),n.value=C.data.questions||[],j.value=new Date,C.data.questions&&C.data.questions.length>0){const I=`defense_questions_${m.project.id}_chapter_${R.value?.chapter_number}`;localStorage.setItem(I,JSON.stringify({questions:C.data.questions,chapter_number:R.value?.chapter_number,loaded_at:new Date().toISOString()}))}else A||(console.log("No existing questions found for this chapter"),console.log(`Current word count: ${l.value}/${ce}`),console.log('User must click "Generate Questions" button to create defense questions'))}catch(C){if(console.error("Failed to load defense questions:",C),C.response)if(console.error("Response status:",C.response.status),console.error("Response data:",C.response.data),C.response.status===422){const I=Object.values(C.response.data.errors||{})[0];I&&Array.isArray(I)?P.error(`Validation Error: ${I[0]}`):P.error("Invalid request parameters. Please refresh the page.")}else C.response.status===500?P.error("Server error. Please try again later."):P.error("Failed to load defense questions");else C.request?(console.error("No response received:",C.request),P.error("Network error. Please check your connection.")):(console.error("Error setting up request:",C.message),P.error("An unexpected error occurred"));n.value=[]}finally{k.value=!1}},Q=A=>A?A.replace(/<[^>]*>/g," ").trim().split(/\s+/).filter(M=>M.length>0).length:0,G=async(A={})=>{if(g.value)return;const M=A.autoTriggered??!1,W=z.defense();if($(W,"generate defense questions")){g.value=!0;try{const C=await de.post(`/api/projects/${m.project.id}/defense/questions/generate`,{chapter_number:R.value.chapter_number},{headers:{"X-CSRF-TOKEN":document.querySelector('meta[name="csrf-token"]')?.getAttribute("content"),Accept:"application/json","Content-Type":"application/json"}});if(C.data&&C.data.questions){n.value=C.data.questions,j.value=new Date;const I=C.data.questions.reduce((Ee,Me)=>{const Ze=Q(Me.question),et=Q(Me.suggested_answer),tt=(Me.key_points||[]).reduce((Fe,ze)=>Fe+Q(ze),0);return Ee+Ze+et+tt},0),Re=`defense_questions_${m.project.id}_chapter_${R.value?.chapter_number}`;localStorage.setItem(Re,JSON.stringify({questions:C.data.questions,chapter_number:R.value?.chapter_number,loaded_at:new Date().toISOString()})),P.success(`Generated ${C.data.questions.length} new questions`),kr(I||z.defense(),"Defense questions","chapter",m.chapter.id).catch(Ee=>console.error("Failed to record word usage (defense):",Ee)),E.value=!0,B(),M&&console.log("Auto-generated defense questions after meeting threshold.")}}catch(C){console.error("Failed to generate defense questions:",C),P.error("Failed to generate defense questions")}finally{g.value=!1}}},ae=async()=>{!y.value||g.value||k.value||E.value||!U.value||n.value.length>0||await G({autoTriggered:!0})},Ye=A=>{y.value=A,Z(A),A&&ae()},Be=async(A,M)=>{try{await de.patch(`/api/projects/${m.project.id}/defense/questions/${A}`,{user_marked_helpful:M},{headers:{"X-CSRF-TOKEN":document.querySelector('meta[name="csrf-token"]')?.getAttribute("content"),Accept:"application/json","Content-Type":"application/json"}});const W=n.value.find(C=>C.id===A);W&&(W.user_marked_helpful=M),P.success(M?"Question marked as helpful":"Removed helpful mark")}catch(W){console.error("Failed to mark question:",W),P.error("Failed to update question")}},je=async A=>{try{await de.delete(`/api/projects/${m.project.id}/defense/questions/${A}`,{headers:{"X-CSRF-TOKEN":document.querySelector('meta[name="csrf-token"]')?.getAttribute("content"),Accept:"application/json"}}),n.value=n.value.filter(M=>M.id!==A),localStorage.setItem(`defense_questions_${m.project.id}`,JSON.stringify({questions:n.value,loaded_at:new Date().toISOString()})),P.success("Question hidden")}catch(M){console.error("Failed to hide question:",M),P.error("Failed to hide question")}},Pe=async()=>{const A=`defense_questions_${m.project.id}_chapter_${R.value?.chapter_number}`,M=localStorage.getItem(A);let W=!0;if(M){const C=JSON.parse(M),I=new Date(C.loaded_at),Re=new Date(Date.now()-360*60*1e3);I>Re&&C.chapter_number===R.value?.chapter_number&&(n.value=C.questions,j.value=I,W=!1)}W&&await q(!1,{skipGeneration:!0})};return ue(()=>m.chapter,async()=>{n.value=[],p(),T(),y.value=S(),await q(!1,{skipGeneration:!0}),await Ae(()=>{h(),ae()})},{immediate:!1}),ue([l,y],()=>{ae()}),Te(async()=>{await Pe(),T(),await Ae(()=>{h(),ae()})}),{defenseQuestions:n,isLoadingDefenseQuestions:k,isGeneratingDefenseQuestions:g,autoGenerateDefense:y,shouldLoadDefenseQuestions:O,loadDefenseQuestions:q,generateNewDefenseQuestions:G,markQuestionHelpful:Be,hideQuestion:je,handleDefenseAutoToggle:Ye,attemptAutoGenerateDefense:ae,getDefenseStatusMessage:L,shouldShowDefenseProgress:x,defenseProgressPercentage:d,defenseWordsRemaining:f,hasTriggeredGeneration:E,meetsDefenseThreshold:U}}const Lr={class:"flex items-center justify-between"},Nr={class:"space-y-1 w-full max-w-[520px]"},Or={class:"flex items-center justify-between gap-3"},Wr={class:"flex flex-col"},qr={class:"flex items-center gap-2"},Gr={class:"flex items-center justify-between px-6 py-2 border-b border-border/30 bg-muted/5"},Ir={class:"flex items-center gap-2"},Hr={class:"space-y-1 relative z-10"},Br={class:"text-sm font-medium text-foreground"},Ur={class:"text-[10px] text-muted-foreground line-clamp-2 leading-relaxed"},Qr={class:"flex-1 relative bg-background"},Kr={class:"px-12 py-10 min-h-[500px]"},Vr={class:"sticky bottom-0 z-10 border-t border-border/30 bg-background/80 backdrop-blur-md p-4 flex items-center justify-between"},Jr={class:"text-xs text-muted-foreground"},Xr={class:"flex items-center gap-2"},Jt=Xe({__name:"ChapterEditorPaperCard",props:{context:{}},setup(m){const l=m.context,$=D(()=>{const k=l.getSectionInfo(l.nextSection);return l.aiChapterAnalysis?.section||k}),z=D(()=>$.value?.name||""),n=D(()=>$.value?.description||"");return(k,g)=>(v(),F(e(se),{class:"w-full max-w-[850px] min-h-[calc(100vh-180px)] flex flex-col bg-background shadow-xl shadow-black/5 ring-1 ring-black/5 dark:ring-white/10 rounded-xl overflow-hidden transition-all duration-300"},{default:o(()=>[r(e(oe),{class:"flex-shrink-0 border-b border-border/30 px-8 py-6 bg-background/50 backdrop-blur-sm sticky top-0 z-10"},{default:o(()=>[s("div",Lr,[s("div",Nr,[s("div",Or,[s("div",Wr,[r(e(Dr),{for:"chapter-title",class:"text-xs font-medium text-zinc-500 dark:text-zinc-400 uppercase tracking-wider"},{default:o(()=>[...g[3]||(g[3]=[i("Chapter Title",-1)])]),_:1}),r(e(Ar),{id:"chapter-title",modelValue:e(l).chapterTitle,"onUpdate:modelValue":g[0]||(g[0]=j=>e(l).chapterTitle=j),placeholder:"Enter chapter title...",class:"h-auto p-0 border-0 bg-transparent text-2xl font-bold placeholder:text-muted-foreground/40 focus-visible:ring-0 px-0 text-foreground"},null,8,["modelValue"])]),s("div",qr,[r(e(Ce),{variant:e(l).chapter.status==="approved"?"default":"secondary",class:"rounded-full px-3"},{default:o(()=>[i(c(e(l).chapter.status.replace("_"," ")),1)]),_:1},8,["variant"]),r(e(Ce),{variant:"outline",class:He(["rounded-full px-3 transition-colors",{"text-green-600 border-green-200 bg-green-50 dark:bg-green-900/20 dark:border-green-800":(e(l).latestAnalysis?.total_score||0)>=80,"text-yellow-600 border-yellow-200 bg-yellow-50 dark:bg-yellow-900/20 dark:border-yellow-800":(e(l).latestAnalysis?.total_score||0)>=70&&(e(l).latestAnalysis?.total_score||0)<80,"text-orange-600 border-orange-200 bg-orange-50 dark:bg-orange-900/20 dark:border-orange-800":(e(l).latestAnalysis?.total_score||0)>=60&&(e(l).latestAnalysis?.total_score||0)<70,"text-red-600 border-red-200 bg-red-50 dark:bg-red-900/20 dark:border-red-800":(e(l).latestAnalysis?.total_score||0)<60}])},{default:o(()=>[i(c(e(l).latestAnalysis?.total_score?Math.round(e(l).latestAnalysis.total_score):e(l).writingQualityScore)+"% Quality ",1)]),_:1},8,["class"])])])])])]),_:1}),r(e(re),{class:"flex min-h-0 flex-1 flex-col p-0"},{default:o(()=>[s("div",Gr,[s("div",Ir,[r(e(_),{onClick:e(l).togglePresentationMode,variant:e(l).showPresentationMode?"default":"ghost",size:"sm",class:"h-7 text-xs rounded-full text-zinc-700 dark:text-zinc-300 hover:text-foreground"},{default:o(()=>[r(e(es),{class:"mr-1.5 h-3.5 w-3.5"}),i(" "+c(e(l).showPresentationMode?"Edit":"Preview"),1)]),_:1},8,["onClick","variant"])]),s("div",Hr,[s("div",Br,c(z.value),1),s("div",Ur,c(n.value),1)])]),s("div",Qr,[Se(r(ss,{modelValue:e(l).chapterContent,"onUpdate:modelValue":g[1]||(g[1]=j=>e(l).chapterContent=j),placeholder:"Start writing your chapter...","min-height":"500px",class:"min-h-[500px] px-8 py-6",ref:e(l).richTextEditor,"show-toolbar":!0,"streaming-mode":e(l).isStreamingMode,"is-generating":e(l).isGenerating,"generation-progress":e(l).generationProgress,"generation-percentage":e(l).generationPercentage,"generation-phase":e(l).generationPhase,"onUpdate:selectedText":e(l).setSelectedText},null,8,["modelValue","streaming-mode","is-generating","generation-progress","generation-percentage","generation-phase","onUpdate:selectedText"]),[[De,!e(l).showPresentationMode]]),Se(s("div",Kr,[r(rs,{content:e(l).chapterContent,"show-font-controls":!1,class:"prose-lg mx-auto",style:{"font-family":"'Times New Roman', serif","line-height":"1.8"}},null,8,["content"])],512),[[De,e(l).showPresentationMode]])])]),_:1}),s("div",Vr,[s("div",Jr,c(e(l).isSaving?"Saving...":"All changes saved"),1),s("div",Xr,[r(e(_),{onClick:g[2]||(g[2]=()=>e(l).save(!1)),disabled:!e(l).isValid||e(l).isSaving,size:"sm",variant:"ghost",class:"h-8 rounded-full text-zinc-700 dark:text-zinc-300 hover:text-foreground"},{default:o(()=>[r(e(ut),{class:"mr-2 h-3.5 w-3.5"}),g[4]||(g[4]=i(" Save Draft ",-1))]),_:1},8,["disabled"]),r(e(_),{onClick:e(l).goToBulkAnalysis,variant:"outline",size:"sm",class:"h-8 rounded-full"},{default:o(()=>[r(e(ts),{class:"mr-2 h-3.5 w-3.5"}),g[5]||(g[5]=i(" Run Bulk Analysis ",-1))]),_:1},8,["onClick"]),r(e(_),{onClick:e(l).markAsComplete,disabled:e(l).isSaving,size:"sm",class:"h-8 rounded-full bg-gradient-to-r from-primary to-primary/90 shadow-sm hover:shadow-md transition-all"},{default:o(()=>[r(e(Je),{class:"mr-2 h-3.5 w-3.5"}),g[6]||(g[6]=i(" Complete ",-1))]),_:1},8,["onClick","disabled"])])])]),_:1}))}}),Yr={class:"flex flex-col gap-4 p-1"},Zr={class:"p-1.5 rounded-lg bg-primary/10 text-primary"},eo={class:"flex items-center gap-2"},to={class:"space-y-3"},so={key:0,class:"space-y-2"},ro={class:"flex items-center justify-between w-full relative z-10"},oo={class:"flex items-center gap-2 text-primary"},no={class:"space-y-1 relative z-10"},ao={class:"text-sm font-medium text-foreground"},lo={class:"text-[10px] text-muted-foreground line-clamp-2 leading-relaxed"},io={key:0,class:"p-4 rounded-xl bg-green-500/10 border border-green-500/20 space-y-3"},uo={class:"flex items-center gap-2 text-green-600 dark:text-green-400"},co={class:"space-y-2"},po={class:"flex justify-between text-[10px] font-medium text-muted-foreground"},go={class:"grid grid-cols-2 gap-2 mt-2"},fo={class:"p-1.5 rounded-full bg-blue-500/10 text-blue-500"},mo={class:"p-1.5 rounded-full bg-purple-500/10 text-purple-500"},ho={class:"p-1.5 rounded-full bg-orange-500/10 text-orange-500"},vo={class:"p-1.5 rounded-full bg-emerald-500/10 text-emerald-500"},bo={class:"p-1.5 rounded-full bg-amber-500/10 text-amber-500"},xo={class:"flex items-center gap-2"},wo={class:"p-1 rounded-xl bg-muted/30 border border-border/50"},yo=Xe({__name:"AISidebar",props:{project:{},chapter:{},isGenerating:{type:Boolean},selectedText:{},isLoadingSuggestions:{type:Boolean},showCitationHelper:{type:Boolean},chapterContent:{},cursorPosition:{},currentWordCount:{},targetWordCount:{},canUndo:{type:Boolean}},emits:["startStreamingGeneration","getAISuggestions","update:showCitationHelper","insert-citation","checkCitations","undoLastAction"],setup(m,{emit:w}){const l=m,$=w,z=b("Academic Formal"),n=b(null),k=b(!1),g=b({expand:!1,improve:!1,rephrase:!1,cite:!1,"generate-full":!1,"generate-section":!1,custom:!1}),j=D(()=>!!l.chapter?.id&&!!l.chapter?.chapter_number),y=D(()=>l.chapterContent&&l.chapterContent.trim().length>0);D(()=>!y.value&&j.value),D(()=>!n.value&&j.value);const R=D(()=>!l.isGenerating&&!!l.chapterContent);D(()=>!l.isLoadingSuggestions&&!!l.selectedText);const E=D(()=>n.value&&n.value.section.name!=="NONE"?n.value.section.name.toLowerCase().replace(/\s+/g,"_"):L()),T=D(()=>!l.isGenerating&&!!l.chapter?.id),p=()=>[{id:"introduction",name:"Introduction",description:"Overview and objectives of this chapter"},{id:"content",name:"Main Content",description:"Chapter main content"},{id:"conclusion",name:"Conclusion",description:"Summary and transition to next chapter"}],h=async(x,d)=>{if(Object.values(g.value).some(f=>f)){P("Please wait for the current action to complete");return}try{switch(x in g.value&&(g.value[x]=!0),x){case"expand":l.selectedText?($("startStreamingGeneration","expand",{selectedText:l.selectedText}),P("Expanding selected text...")):P.error("Please select text to expand");break;case"improve":$("startStreamingGeneration","improve"),P("Improving chapter content...");break;case"rephrase":l.selectedText?($("startStreamingGeneration","rephrase",{selectedText:l.selectedText,style:z.value}),P("Rephrasing selected text...")):P.error("Please select text to rephrase");break;case"cite":$("update:showCitationHelper",!0),P("Opening citation helper...");break;case"generate-full":$("startStreamingGeneration","progressive"),P("Generating complete chapter...");break;case"generate-section":const f=d?.section||E.value;$("startStreamingGeneration","section",{section:f,mode:"progressive"}),P(`Generating ${f} section...`);break;default:throw new Error(`Unknown action: ${x}`)}}catch(f){console.error(`Quick action '${x}' failed:`,f),P.error(`Failed to ${x.replace("-"," ")}. Please try again.`)}finally{setTimeout(()=>{x in g.value&&(g.value[x]=!1)},1e3)}},L=()=>{if(!y.value)return"introduction";const x=l.chapterContent.toLowerCase(),d=p();for(const f of d)if(![f.name.toLowerCase(),f.id.replace("_"," ")].some(S=>x.includes(S)))return f.id;return"conclusion"},B=x=>{const d=p();return d.find(f=>f.id===x)||d[0]},U=x=>{$("insert-citation",x)};return ue(()=>l.chapter,x=>{x?.id&&(n.value=null)},{immediate:!1}),ue(()=>l.chapterContent,x=>{n.value&&(!x||x.trim().length===0)&&(n.value=null)},{immediate:!1}),(x,d)=>(v(),N("div",Yr,[r(e(se),{class:"border-none shadow-none bg-transparent"},{default:o(()=>[r(e(oe),{class:"px-2 py-3"},{default:o(()=>[r(e(ie),{class:"flex items-center gap-2 text-sm font-semibold text-foreground/80"},{default:o(()=>[s("div",Zr,[r(e(Ge),{class:"h-4 w-4"})]),d[9]||(d[9]=i(" AI Assistant ",-1))]),_:1})]),_:1}),r(e(re),{class:"px-2 space-y-6"},{default:o(()=>[r(e(Qt),{open:!0,class:"space-y-2"},{default:o(()=>[r(e(Kt),{class:"flex w-full items-center justify-between text-xs font-medium text-muted-foreground hover:text-foreground transition-colors group"},{default:o(()=>[s("span",eo,[r(e(tr),{class:"h-3.5 w-3.5 text-amber-500/70 group-hover:text-amber-500 transition-colors"}),d[10]||(d[10]=i(" QUICK ACTIONS ",-1))]),r(e(Rt),{class:"h-3 w-3 transition-transform duration-200 group-data-[state=open]:rotate-180"})]),_:1}),r(e(Vt),{class:"space-y-3 pt-1"},{default:o(()=>[s("div",to,[r($e,{"enter-active-class":"transition-all duration-300 ease-out","enter-from-class":"opacity-0 scale-95 translate-y-1","enter-to-class":"opacity-100 scale-100 translate-y-0"},{default:o(()=>[n.value&&n.value.show_section_button?(v(),N("div",so,[r(e(_),{onClick:d[0]||(d[0]=f=>h("generate-section")),disabled:!T.value||k.value||x.isGenerating||g.value["generate-section"],variant:"outline",class:"w-full h-auto flex-col items-start gap-2 p-3 rounded-xl border-primary/20 bg-background/50 hover:bg-primary/5 hover:border-primary/40 transition-all duration-300 text-left group relative overflow-hidden"},{default:o(()=>[d[12]||(d[12]=s("div",{class:"absolute inset-0 bg-gradient-to-r from-primary/5 to-transparent opacity-0 group-hover:opacity-100 transition-opacity"},null,-1)),s("div",ro,[s("div",oo,[r(e(Mt),{class:"h-3.5 w-3.5"}),d[11]||(d[11]=s("span",{class:"text-xs font-semibold"},"Write Next Section",-1))]),g.value["generate-section"]?(v(),F(e(sr),{key:0,class:"h-3 w-3 animate-spin text-primary"})):V("",!0)]),s("div",no,[s("div",ao,c(n.value?.section.name||B(E.value).name),1),s("div",lo,c(n.value?.section.description||B(E.value).description),1)])]),_:1},8,["disabled"])])):V("",!0)]),_:1}),r($e,{"enter-active-class":"transition-all duration-300 ease-out","enter-from-class":"opacity-0 scale-95 translate-y-1","enter-to-class":"opacity-100 scale-100 translate-y-0"},{default:o(()=>[n.value&&n.value.show_full_chapter_button?(v(),F(e(_),{key:0,onClick:d[1]||(d[1]=f=>h("generate-full")),disabled:x.isGenerating||k.value||g.value["generate-full"],variant:"ghost",class:"w-full h-9 justify-start gap-2 px-3 rounded-lg text-xs text-muted-foreground hover:text-primary hover:bg-primary/5"},{default:o(()=>[r(e(rr),{class:"h-3.5 w-3.5"}),d[13]||(d[13]=s("span",null,"Generate Complete Chapter",-1))]),_:1},8,["disabled"])):V("",!0)]),_:1}),r($e,{"enter-active-class":"transition-all duration-500 ease-out","enter-from-class":"opacity-0 scale-95 translate-y-2","enter-to-class":"opacity-100 scale-100 translate-y-0"},{default:o(()=>[n.value&&n.value.status==="COMPLETE"?(v(),N("div",io,[s("div",uo,[r(e(or),{class:"h-4 w-4"}),d[14]||(d[14]=s("span",{class:"text-sm font-semibold"},"Chapter Complete",-1))]),s("div",co,[s("div",po,[d[15]||(d[15]=s("span",null,"Progress",-1)),s("span",null,c(n.value.completion_percentage)+"%",1)]),r(e($r),{"model-value":n.value.completion_percentage,class:"h-1.5"},null,8,["model-value"])])])):V("",!0)]),_:1})]),s("div",go,[r(e(_),{onClick:d[2]||(d[2]=f=>h("improve")),disabled:!R.value||x.isGenerating||g.value.improve,variant:"outline",class:"h-20 flex-col gap-2 rounded-xl border-border/50 bg-background/50 hover:bg-accent hover:border-accent transition-all duration-300"},{default:o(()=>[s("div",fo,[r(e(nr),{class:"h-4 w-4"})]),d[16]||(d[16]=s("span",{class:"text-xs font-medium"},"Improve",-1))]),_:1},8,["disabled"]),r(e(_),{onClick:d[3]||(d[3]=f=>h("expand")),disabled:!x.selectedText||x.isGenerating||g.value.expand,variant:"outline",class:"h-20 flex-col gap-2 rounded-xl border-border/50 bg-background/50 hover:bg-accent hover:border-accent transition-all duration-300"},{default:o(()=>[s("div",mo,[r(e(ar),{class:"h-4 w-4"})]),d[17]||(d[17]=s("span",{class:"text-xs font-medium"},"Expand",-1))]),_:1},8,["disabled"]),r(e(_),{onClick:d[4]||(d[4]=f=>h("cite")),disabled:x.isGenerating||g.value.cite,variant:"outline",class:"h-20 flex-col gap-2 rounded-xl border-border/50 bg-background/50 hover:bg-accent hover:border-accent transition-all duration-300"},{default:o(()=>[s("div",ho,[r(e(lr),{class:"h-4 w-4"})]),d[18]||(d[18]=s("span",{class:"text-xs font-medium"},"Cite",-1))]),_:1},8,["disabled"]),r(e(_),{onClick:d[5]||(d[5]=f=>h("rephrase")),disabled:!x.selectedText||x.isGenerating||g.value.rephrase,variant:"outline",class:"h-20 flex-col gap-2 rounded-xl border-border/50 bg-background/50 hover:bg-accent hover:border-accent transition-all duration-300"},{default:o(()=>[s("div",vo,[r(e(ir),{class:"h-4 w-4"})]),d[19]||(d[19]=s("span",{class:"text-xs font-medium"},"Rephrase",-1))]),_:1},8,["disabled"]),x.canUndo?(v(),F(e(_),{key:0,onClick:d[6]||(d[6]=f=>$("undoLastAction")),variant:"outline",class:"h-20 flex-col gap-2 rounded-xl border-border/50 bg-background/50 hover:bg-amber-500/10 hover:border-amber-500/30 transition-all duration-300 col-span-2"},{default:o(()=>[s("div",bo,[r(e(dr),{class:"h-4 w-4"})]),d[20]||(d[20]=s("span",{class:"text-xs font-medium"},"Undo Last AI Change",-1))]),_:1})):V("",!0)])]),_:1})]),_:1}),r(e(Ie),{class:"bg-border/50"}),r(e(Qt),{open:!0,class:"space-y-2"},{default:o(()=>[r(e(Kt),{class:"flex w-full items-center justify-between text-xs font-medium text-muted-foreground hover:text-foreground transition-colors group"},{default:o(()=>[s("span",xo,[r(e(Mt),{class:"h-3.5 w-3.5 text-indigo-500/70 group-hover:text-indigo-500 transition-colors"}),d[21]||(d[21]=i(" WRITING STYLE ",-1))]),r(e(Rt),{class:"h-3 w-3 transition-transform duration-200 group-data-[state=open]:rotate-180"})]),_:1}),r(e(Vt),{class:"pt-1"},{default:o(()=>[s("div",wo,[Se(s("select",{"onUpdate:modelValue":d[7]||(d[7]=f=>z.value=f),class:"w-full bg-transparent border-none text-xs font-medium focus:ring-0 cursor-pointer py-1.5 px-2"},[...d[22]||(d[22]=[s("option",{value:"Academic Formal"},"Academic Formal",-1),s("option",{value:"Academic Casual"},"Academic Casual",-1),s("option",{value:"Technical"},"Technical",-1),s("option",{value:"Analytical"},"Analytical",-1),s("option",{value:"Research-Heavy"},"Research-Heavy",-1)])],512),[[ur,z.value]])])]),_:1})]),_:1})]),_:1})]),_:1}),r(jr,{"show-citation-helper":x.showCitationHelper,"chapter-content":x.chapterContent,"chapter-id":x.chapter?.id||0,"onUpdate:showCitationHelper":d[8]||(d[8]=f=>$("update:showCitationHelper",f)),onInsertCitation:U},null,8,["show-citation-helper","chapter-content","chapter-id"])]))}}),_o=os(yo,[["__scopeId","data-v-8c5c841d"]]),ko={class:"h-14 flex items-center justify-between px-4 border-b border-border/40 shrink-0"},Co={class:"flex-1 overflow-y-auto custom-scrollbar"},So={class:"p-4 space-y-6"},Xt=Xe({__name:"ChapterEditorRightSidebar",props:{project:{},chapter:{},isGenerating:{type:Boolean},selectedText:{},isLoadingSuggestions:{type:Boolean},showCitationHelper:{type:Boolean},chapterContent:{},currentWordCount:{},targetWordCount:{},handleAIGeneration:{type:Function},getAISuggestions:{type:Function},updateCitationHelper:{type:Function},insertCitation:{type:Function},checkCitations:{type:Function},showDefensePrep:{type:Boolean},defenseQuestions:{},isLoadingDefenseQuestions:{type:Boolean},isGeneratingDefenseQuestions:{type:Boolean},chapterContext:{},defenseWatcher:{},autoGenerateDefense:{type:Boolean},handleDefensePanelToggle:{type:Function},generateNewDefenseQuestions:{type:Function},handleDefenseAutoToggle:{type:Function},refreshDefenseQuestions:{type:Function},markQuestionHelpful:{type:Function},hideQuestion:{type:Function},isCollapsed:{type:Boolean},containerClass:{}},setup(m){const w=m;return(l,$)=>Se((v(),N("aside",{class:He(w.containerClass)},[s("div",ko,[$[1]||($[1]=s("span",{class:"text-sm font-semibold tracking-tight text-foreground"},"Writing Assistant",-1)),r(e(Y),null,{default:o(()=>[r(e(J),{asChild:""},{default:o(()=>[r(e(_),{variant:"ghost",size:"icon",class:"h-7 w-7"},{default:o(()=>[r(e(ts),{class:"h-3.5 w-3.5"})]),_:1})]),_:1}),r(e(X),null,{default:o(()=>[...$[0]||($[0]=[i("Manage Citations",-1)])]),_:1})]),_:1})]),s("div",Co,[s("div",So,[r(_o,{project:w.project,chapter:w.chapter,"is-generating":w.isGenerating,"selected-text":w.selectedText,"is-loading-suggestions":w.isLoadingSuggestions,"show-citation-helper":w.showCitationHelper,"chapter-content":w.chapterContent,"current-word-count":w.currentWordCount,"target-word-count":w.targetWordCount,onStartStreamingGeneration:w.handleAIGeneration,onGetAiSuggestions:w.getAISuggestions,"onUpdate:showCitationHelper":w.updateCitationHelper,onInsertCitation:w.insertCitation,onCheckCitations:w.checkCitations},null,8,["project","chapter","is-generating","selected-text","is-loading-suggestions","show-citation-helper","chapter-content","current-word-count","target-word-count","onStartStreamingGeneration","onGetAiSuggestions","onUpdate:showCitationHelper","onInsertCitation","onCheckCitations"])])])],2)),[[De,!w.isCollapsed]])}});function Eo(m){const w=b({sentences:0,paragraphs:0,readingTime:0,avgWordLength:0,uniqueWords:0,commonWords:[]}),l=D(()=>m.value?m.value.split(/\s+/).filter(n=>n.length>0).length:0),$=()=>{if(!m.value){w.value={sentences:0,paragraphs:0,readingTime:0,avgWordLength:0,uniqueWords:0,commonWords:[]};return}const n=m.value,k=n.split(/\s+/).filter(T=>T.length>0),g=n.split(/[.!?]+/).filter(T=>T.trim().length>0),j=n.split(`

`).filter(T=>T.trim().length>0),y=new Map;k.forEach(T=>{const p=T.toLowerCase().replace(/[^a-z0-9]/g,"");p&&y.set(p,(y.get(p)||0)+1)});const R=new Set(["the","a","an","and","or","but","in","on","at","to","for","of","with","by","is","was","are","were"]),E=Array.from(y.entries()).filter(([T])=>!R.has(T)).sort((T,p)=>p[1]-T[1]).slice(0,5).map(([T])=>T);w.value={sentences:g.length,paragraphs:j.length,readingTime:Math.ceil(k.length/200),avgWordLength:k.reduce((T,p)=>T+p.length,0)/k.length,uniqueWords:y.size,commonWords:E}},z=D(()=>{if(!m.value)return 0;let n=0;const k=m.value;k.includes("##")&&(n+=20),k.length>1e3&&(n+=20),k.match(/\[.*?\]/g)&&(n+=15),(k.includes("**")||k.includes("*"))&&(n+=10);const g=k.split(/[.!?]+/).filter(y=>y.trim().length>0);if(g.length>0){const y=g.reduce((R,E)=>R+E.split(/\s+/).length,0)/g.length;y>10&&y<25&&(n+=20)}return k.split(`

`).filter(y=>y.trim().length>0).length>3&&(n+=15),Math.min(n,100)});return{writingStats:w,currentWordCount:l,writingQualityScore:z,calculateWritingStats:$}}function To(m){const w=b(!1),l=b(null),$=b([]),z=b(null),n=D(()=>{if(!l.value?.quality_level)return"text-muted-foreground";switch(l.value.quality_level){case"Excellent":return"text-green-600";case"Good":return"text-blue-600";case"Satisfactory":return"text-yellow-600";case"Needs Improvement":return"text-orange-600";case"Poor":return"text-red-600";default:return"text-muted-foreground"}}),k=D(()=>l.value?.scores?Object.entries(l.value.scores).sort(([,p],[,h])=>p.percentage-h.percentage).slice(0,3).map(([p,h])=>({category:p.replace(" & "," & "),percentage:Math.round(h.percentage),score:h.score,max:h.max})):[]),g=async()=>{try{w.value=!0,z.value=null,await de.get("/sanctum/csrf-cookie");const p=await de.post(K("api.chapters.analysis.analyze",{chapter:m}));if(p.data.success)return l.value=p.data.analysis,p.data.analysis;throw new Error(p.data.error||"Analysis failed")}catch(p){return z.value=p.response?.data?.error||p.message||"Analysis failed",console.error("Chapter analysis failed:",p),null}finally{w.value=!1}};return{isAnalyzing:w,latestAnalysis:l,analysisHistory:$,error:z,qualityLevelColor:n,topImprovementAreas:k,analyzeChapter:g,getLatestAnalysis:async()=>{try{await de.get("/sanctum/csrf-cookie");const p=await de.get(K("api.chapters.analysis.latest",{chapter:m}));return p.data.success?(l.value=p.data.analysis,p.data.analysis):(l.value=null,null)}catch(p){return p.response?.status!==404&&(z.value=p.response?.data?.error||p.message||"Failed to get analysis",console.error("Failed to get latest analysis:",p)),null}},getAnalysisHistory:async()=>{try{await de.get("/sanctum/csrf-cookie");const p=await de.get(K("api.chapters.analysis.history",{chapter:m}));if(p.data.success)return $.value=p.data.analyses,p.data.analyses;throw new Error(p.data.error||"Failed to get history")}catch(p){return z.value=p.response?.data?.error||p.message||"Failed to get analysis history",console.error("Failed to get analysis history:",p),[]}},autoAnalyze:async(p,h=500)=>{p>=h&&await g()},getScoreColor:(p,h)=>{const L=p/h*100;return L>=80?"text-green-600":L>=70?"text-blue-600":L>=60?"text-yellow-600":L>=40?"text-orange-600":"text-red-600"},getProgressVariant:p=>p>=80?"success":p>=60?"default":"destructive"}}const Ao={key:0,class:"min-h-screen bg-background text-foreground"},Do={class:"mx-auto max-w-5xl p-6"},$o={class:"flex items-center justify-between gap-4"},jo={class:"flex items-center gap-3"},Po={class:"mt-6 grid gap-4"},Ro={class:"flex flex-wrap gap-x-6 gap-y-1"},Mo={class:"grid gap-1"},Fo={class:"grid gap-1"},zo={class:"grid gap-4 md:grid-cols-3"},Lo={class:"mx-auto w-full max-w-5xl p-6"},No={class:"flex items-center justify-between gap-4"},Oo={class:"flex items-center gap-3"},Wo={class:"mt-6 grid gap-4"},qo={class:"flex flex-wrap gap-x-6 gap-y-1"},Go={class:"grid gap-1"},Io={class:"grid gap-1"},Ho={class:"grid gap-4 md:grid-cols-3"},Bo={key:0,class:"rounded-xl border border-border bg-card p-4"},Uo={key:2,class:"flex h-screen flex-col overflow-hidden bg-background dark:bg-background font-sans selection:bg-primary/20 transition-colors duration-300"},Qo={class:"relative z-20 flex flex-shrink-0 items-center justify-between border-b border-border/40 bg-background/60 p-4 backdrop-blur-xl supports-[backdrop-filter]:bg-background/40 transition-all duration-300"},Ko={class:"flex items-center gap-5"},Vo={class:"flex flex-col"},Jo={class:"text-lg font-bold tracking-tight text-foreground/90 font-display"},Xo={class:"flex items-center gap-3 text-xs text-muted-foreground"},Yo={class:"flex items-center gap-1.5"},Zo={class:"flex items-center gap-4"},en={class:"flex items-center p-1 rounded-full border border-border/40 bg-background/50 backdrop-blur-sm shadow-sm"},tn={class:"flex items-center gap-2"},sn={class:"relative z-20 h-[2px] w-full bg-border/20"},rn={key:0,class:"mx-3 my-2"},on={class:"relative overflow-hidden rounded-xl border border-blue-200 bg-gradient-to-br from-blue-50 to-purple-50 p-3 shadow-sm dark:border-blue-800 dark:from-blue-950/30 dark:to-purple-950/30"},nn={class:"relative z-10 mb-2 flex items-center justify-between"},an={class:"flex items-center gap-2"},ln={class:"relative"},dn={class:"flex h-6 w-6 items-center justify-center rounded-full bg-gradient-to-br from-blue-500 to-purple-600"},un={class:"text-xs text-blue-700 dark:text-blue-300"},cn={class:"relative z-10 mb-2"},pn={class:"mb-1 flex items-center justify-between"},gn={class:"text-xs text-blue-600 dark:text-blue-400"},fn={class:"relative h-2 overflow-hidden rounded-full bg-blue-100 dark:bg-blue-900/50"},mn={class:"relative z-10 flex items-center gap-2"},hn={class:"flex-shrink-0"},vn={key:0,class:"h-2 w-2 animate-bounce rounded-full bg-blue-500"},bn={key:1,class:"flex gap-0.5"},xn={key:2,class:"h-2 w-2 animate-spin rounded-full border-2 border-blue-500 border-t-transparent"},wn={key:3,class:"h-2 w-2 rounded-full bg-green-500"},yn={key:4,class:"h-2 w-2 rounded-full bg-red-500"},_n={class:"flex-1 text-xs text-blue-800 dark:text-blue-200"},kn={class:"relative z-10 flex flex-1 overflow-hidden"},Cn={key:0,class:"w-[320px] flex-shrink-0 border-r border-border/50 bg-background/80 backdrop-blur-xl shadow-xl z-20"},Sn={class:"h-full overflow-y-auto custom-scrollbar"},En={class:"p-4"},Tn={class:"mb-3"},An={class:"text-xs text-muted-foreground"},Dn={class:"flex min-h-0 flex-1 flex-col bg-transparent relative"},$n={class:"flex-1 overflow-hidden relative"},jn={class:"absolute inset-0 overflow-y-auto custom-scrollbar flex flex-col items-center py-8 px-4 sm:px-8"},Pn={class:"flex h-full w-full overflow-hidden relative"},Rn={id:"left-sidebar-panel",class:"hidden lg:flex w-80 flex-col border-r border-border/40 bg-background/60 backdrop-blur-xl z-20 transition-all duration-300"},Mn={class:"h-14 flex items-center justify-between px-4 border-b border-border/40 shrink-0"},Fn={class:"p-4"},zn={class:"flex-1 flex flex-col relative z-10 min-w-0 bg-background/30 dark:bg-background transition-all duration-300"},Ln={class:"md:hidden flex flex-wrap items-start justify-between border-b border-border/40 bg-background/60 backdrop-blur-md px-4 py-3 relative z-30 transition-all duration-300 gap-y-2"},Nn={class:"flex items-center gap-2 flex-shrink-0 order-1"},On={class:"flex items-center order-2"},Wn={class:"order-3 w-full flex flex-col gap-3"},qn={class:"flex items-start gap-3 w-full min-w-0"},Gn={class:"flex items-center gap-2 justify-between mt-1"},In={class:"flex items-center gap-2"},Hn={class:"flex items-center gap-2"},Bn={key:0,class:"inline"},Un={class:"hidden md:flex flex-col w-full z-30 bg-background/60 backdrop-blur-md transition-all duration-300 relative"},Qn={class:"h-10 border-b border-border/40 flex items-left justify-left px-4 bg-background/40"},Kn={class:"flex items-left gap-3"},Vn=["innerHTML"],Jn={class:"h-12 border-b border-border/40 flex items-center justify-between px-4 gap-3 bg-muted/10"},Xn={class:"flex items-center gap-1"},Yn={class:"flex items-center gap-3"},Zn={id:"view-controls",class:"flex items-center bg-background/50 rounded-full border border-border/50 p-1 backdrop-blur-sm shadow-sm"},ea={class:"hidden xl:inline"},ta={class:"hidden xl:inline"},sa={class:"flex items-center gap-2"},ra={class:"flex items-center gap-2 pl-2 border-l border-border/50"},oa={class:"inline"},na={class:"flex-1 overflow-hidden relative group bg-background/20"},aa={key:0,class:"absolute top-6 left-0 right-0 z-40 px-4 flex justify-center pointer-events-none"},la={class:"w-full max-w-lg pointer-events-auto"},ia={class:"relative overflow-hidden rounded-xl border border-blue-200 bg-gradient-to-br from-blue-50/95 to-purple-50/95 p-3 shadow-lg backdrop-blur-lg dark:border-blue-800 dark:from-blue-950/90 dark:to-purple-950/90"},da={class:"flex items-center gap-3"},ua={class:"relative flex h-8 w-8 items-center justify-center rounded-full bg-gradient-to-br from-blue-500 to-purple-600 shadow-md"},ca={class:"flex-1 min-w-0"},pa={class:"flex items-center justify-between mb-1"},ga={class:"text-xs font-mono text-muted-foreground"},fa={class:"h-1.5 w-full bg-blue-100 dark:bg-blue-900/40 rounded-full overflow-hidden"},ma={class:"mt-2 text-xs text-muted-foreground ml-11 truncate"},ha={class:"mx-auto py-12 px-6 sm:px-10 min-h-full"},va={class:"min-h-[600px] pb-32"},ba={class:"pb-32"},xa={id:"editor-footer",class:"h-7 border-t border-border/30 bg-background/40 backdrop-blur-sm flex items-center justify-between px-4 text-[10px] text-muted-foreground shrink-0"},wa={class:"flex items-center gap-3"},ya={class:"hidden sm:inline"},_a={class:"flex items-center gap-2"},ka={key:0,class:"text-green-500 flex items-center gap-1 ml-2"},Ca={key:0,class:"fixed inset-0 bg-black/50 flex items-center justify-center z-50"},Sa={class:"text-slate-600 dark:text-slate-300 mb-4"},Ea={class:"font-semibold text-amber-600 dark:text-amber-400"},Ta={class:"flex flex-col sm:flex-row gap-3"},Aa=1e3,Da=Xe({__name:"ChapterEditor",props:{project:{},chapter:{},allChapters:{},facultyChapters:{},mode:{}},setup(m){const w=Ke(()=>Qe(()=>import("./ChapterNavigation-C_ROOVdz.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13]))),l=Ke(()=>Qe(()=>import("./MobileNavOverlay-CZYu4yXy.js"),__vite__mapDeps([14,3,15,2,1,4,5,6,7,8,9,10,11,12,13,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61]))),$=Ke(()=>Qe(()=>import("./ChatModeLayout-Bjn_rZBh.js"),__vite__mapDeps([62,3,12,2,7,17,21,5,6,22,4,8,49,13,50,51,29,52,48,46,41,10,42,43,44,47,31,28,53,54,55,15,63]))),z=Ke(()=>Qe(()=>import("./CitationVerificationLayout-DHBucKRH.js"),__vite__mapDeps([64,12,2,3,7,17,18,21,5,6,22,4,8,65,50,54,49,13,51,29,52,55]))),n=m,k=Zt(),g=b(null),j=b(null),y=b(!1),R=b(!1),E=b(0);if(typeof window<"u"){const a=new URLSearchParams(window.location.search);y.value=a.has("theme_sandbox"),R.value=a.get("theme_sandbox")==="nolayout"||a.has("theme_sandbox_nolayout");const t=a.get("theme_sandbox_step"),u=t?Number.parseInt(t,10):0;E.value=Number.isFinite(u)?u:0}const{appearance:T,isDark:p}=Yt(),h=b({htmlHasDark:!1,background:"",foreground:"",card:"",sidebarBackground:"",bodyBg:"",insetBg:"",sampleBgBackground:"",sampleBgCard:"",sampleBgMuted:""}),L=b(null),B=b(null),U=b(null);function x(){if(typeof window>"u")return;const a=document.documentElement,t=window.getComputedStyle(a),u=document.querySelector('[data-slot="sidebar-inset"]'),H=u?window.getComputedStyle(u).backgroundColor:"";h.value={htmlHasDark:a.classList.contains("dark"),background:t.getPropertyValue("--background").trim(),foreground:t.getPropertyValue("--foreground").trim(),card:t.getPropertyValue("--card").trim(),sidebarBackground:t.getPropertyValue("--sidebar-background").trim(),bodyBg:window.getComputedStyle(document.body).backgroundColor,insetBg:H,sampleBgBackground:L.value?window.getComputedStyle(L.value).backgroundColor:"",sampleBgCard:B.value?window.getComputedStyle(B.value).backgroundColor:"",sampleBgMuted:U.value?window.getComputedStyle(U.value).backgroundColor:""}}const{chapterTitle:d,chapterContent:f,showPreview:ce,isEditorDark:ne,initChapterTheme:S,toggleChapterTheme:Z,isNativeFullscreen:O,selectedText:q,showChatMode:Q,showCitationMode:G,showDefensePrep:ae,loadChatModeFromStorage:Ye,saveChatModeToStorage:Be,showLeftSidebar:je,showRightSidebar:Pe,isMobile:A,isLeftSidebarCollapsed:M,isRightSidebarCollapsed:W,showLeftSidebarInFullscreen:C,showRightSidebarInFullscreen:I}=Rr(n),{balance:Re,showPurchaseModal:Ee,requiredWordsForModal:Me,actionDescriptionForModal:Ze,checkAndPrompt:et,closePurchaseModal:tt,estimates:Fe}=Cr(),ze=(a,t)=>et(Math.max(1,Math.round(a)),t),{hasUnsavedChanges:ns,isSaving:pe,triggerAutoSave:Le,save:he,clearAutoSave:as}=Sr({delay:1e4,onSave:kt});let ct=0;const ls=()=>{const a=Date.now();a-ct>Aa&&(ct=a,P.success("Saved",{duration:2e3}))},{contentHistory:is,historyIndex:ds,addToHistory:us,undo:cs,redo:ps}=Pr(n.chapter.content||""),{writingStats:pt,writingQualityScore:ve,calculateWritingStats:st}=Eo(f),{isAnalyzing:gs,latestAnalysis:fs,getLatestAnalysis:ms}=To(n.chapter.id),le=D(()=>{if(n.facultyChapters&&n.facultyChapters.length>0){const t=n.facultyChapters.find(u=>u.number===n.chapter.chapter_number);if(t?.word_count)return t.word_count}if(n.project?.outlines&&n.project.outlines.length>0){const t=n.project.outlines.find(u=>u.chapter_number===n.chapter.chapter_number);if(t?.target_word_count)return t.target_word_count}const a=n.project.type==="undergraduate"?2500:3500;return n.chapter.chapter_number===1||n.chapter.chapter_number===5?Math.round(a*.8):a}),{generateNextChapter:rt}=Mr({props:n,allChapters:n.allChapters,targetWordCount:le,estimates:Fe,ensureBalance:ze,save:he}),{currentWordCount:ee,progressPercentage:hs,DEFENSE_THRESHOLD:vs,countWords:bs}=Er(f,le),ot=hs,gt=D(()=>({chapter:n.chapter,chapterTitle:d,chapterContent:f,showPresentationMode:be,togglePresentationMode:At,isStreamingMode:vt,isGenerating:we,generationProgress:Ne,generationPercentage:ye,generationPhase:_e,aiChapterAnalysis,nextSection,getSectionInfo,writingStats:pt,latestAnalysis:fs,isAnalyzing:gs,writingQualityScore:ve,isSaving:pe,isValid:Oe,save:he,goToBulkAnalysis:at,markAsComplete:lt,richTextEditor:g,richTextEditorFullscreen:j,selectedText:q,setSelectedText:a=>{q.value=a}})),xs=D(()=>({chapter_number:_t.value.chapter_number,chapter_title:_t.value.title,word_count:ee.value})),ws=D(()=>({meetsThreshold:Fs.value,shouldShowProgress:js.value,progressPercentage:Ps.value,wordsRemaining:Rs.value,hasTriggeredGeneration:Ms,threshold:vs,statusMessage:$s()})),ft=D(()=>({project:ge.value,chapter:fe.value,isGenerating:we.value,selectedText:q.value,isLoadingSuggestions:ht.value,showCitationHelper:Ue.value,chapterContent:f.value,currentWordCount:ee.value,targetWordCount:le.value,handleAIGeneration:xt,getAISuggestions:wt,updateCitationHelper:a=>{Ue.value=a},insertCitation:qs,checkCitations:yt,showDefensePrep:ae.value,defenseQuestions:ys.value??[],isLoadingDefenseQuestions:_s.value,isGeneratingDefenseQuestions:ks.value,chapterContext:xs.value,defenseWatcher:ws.value,autoGenerateDefense:Cs.value,handleDefensePanelToggle:Js,generateNewDefenseQuestions:Es,handleDefenseAutoToggle:Ds,refreshDefenseQuestions:()=>mt(!0,{skipGeneration:!0}),markQuestionHelpful:Ts,hideQuestion:As})),{defenseQuestions:ys,isLoadingDefenseQuestions:_s,isGeneratingDefenseQuestions:ks,autoGenerateDefense:Cs,shouldLoadDefenseQuestions:Ss,loadDefenseQuestions:mt,generateNewDefenseQuestions:Es,markQuestionHelpful:Ts,hideQuestion:As,handleDefenseAutoToggle:Ds,getDefenseStatusMessage:$s,shouldShowDefenseProgress:js,defenseProgressPercentage:Ps,defenseWordsRemaining:Rs,hasTriggeredGeneration:Ms,meetsDefenseThreshold:Fs}=zr({props:n,chapterContent:f,currentWordCount:ee,ensureBalance:ze,estimates:Fe}),{isGenerating:we,generationProgress:Ne,generationPercentage:ye,generationPhase:_e,estimatedTotalWords:zs,streamWordCount:Ls,streamBuffer:ja,lastStreamUpdate:Pa,originalContentForAppend:Ra,aiSuggestions:Ma,isLoadingSuggestions:ht,showCitationHelper:Ue,showPresentationMode:be,isStreamingMode:vt,showRecoveryDialog:Ns,partialContentSaved:Fa,savedWordCountOnError:Os,isCollectingPapers:za,paperCollectionProgress:La,paperCollectionPhase:Na,collectedPapersCount:Oa,paperCollectionPercentage:Wa,currentSource:qa,sourcesCompleted:Ga,papersPreview:Ia,paperCollectionData:Ha,paperCollectionInterval:Ba,reconnectAttempts:Ua,reconnectDelay:Qa,isReconnecting:Ka,currentGenerationId:Va,currentGenerationType:Ja,eventSource:bt,editorScrollRef:Ws,attachScroller:Xa,smoothScrollToBottom:Ya,forceScrollToBottom:Za,resetScroller:el,isAutoScrollActive:tl,isUserScrollingScroller:sl,scrollToBottom:rl,checkConnectionQuality:ol,handleAIGeneration:xt,getAISuggestions:wt,checkCitations:yt,insertCitation:qs,resumeGeneration:Gs,dismissRecovery:Is,checkForAutoGeneration:Hs}=Tr({props:n,chapterContent:f,targetWordCount:le,estimates:Fe,ensureBalance:ze,save:he,triggerAutoSave:Le,calculateWritingStats:st,countWords:bs,selectedText:q,richTextEditor:g,richTextEditorFullscreen:j,isNativeFullscreen:O}),Oe=D(()=>{const a=d.value?.trim(),t=f.value?.trim();return a&&a.length>0&&t&&t.length>50}),ge=D(()=>n.project),fe=D(()=>n.chapter),xe=D(()=>n.allChapters),_t=D(()=>n.chapter);async function kt(a=!1){try{const t=await fetch(K("chapters.save",{project:n.project.id}),{method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json","X-Requested-With":"XMLHttpRequest","X-CSRF-TOKEN":document.querySelector('meta[name="csrf-token"]')?.getAttribute("content")||""},body:JSON.stringify({project_id:n.project.id,chapter_number:n.chapter.chapter_number,title:d.value,content:f.value,auto_save:a,statistics:pt.value,quality_score:ve.value})});console.log("Response status:",t.status,t.statusText),console.log("Response headers:",t.headers);const u=await t.text();console.log("Raw response:",u);let H;try{H=JSON.parse(u)}catch(me){throw console.error("JSON parse error:",me),console.error("Response was:",u),new Error(`Server returned non-JSON response: ${t.status} ${t.statusText}`)}t.ok}catch(t){throw a||P.error("âŒ Save Failed",{description:"Please try again or check your connection."}),t}}const Ct=()=>{const a=cs();a!==null&&(f.value=a,Le())},St=()=>{const a=ps();a!==null&&(f.value=a,Le())},We=a=>{ns.value&&confirm("You have unsaved changes. Save before switching chapters?")&&he();const t=n.allChapters.find(me=>me.chapter_number===a),H=t?.content&&t.content.trim()!==""?"chapters.edit":"chapters.write";te.visit(K(H,{project:n.project.slug,chapter:a}),{only:["chapter","mode","allChapters"],preserveState:!0,preserveScroll:!1})},Et=()=>document.fullscreenElement||document.webkitFullscreenElement||document.msFullscreenElement||null,Bs=async()=>{try{const a=document.documentElement;a.requestFullscreen?await a.requestFullscreen({navigationUI:"hide"}):a.webkitRequestFullscreen?await a.webkitRequestFullscreen():a.msRequestFullscreen&&await a.msRequestFullscreen()}catch(a){console.error("Error entering fullscreen:",a),P.error("Fullscreen Error",{description:"Unable to enter fullscreen mode"})}},Us=async()=>{try{document.exitFullscreen?await document.exitFullscreen():document.webkitExitFullscreen?await document.webkitExitFullscreen():document.msExitFullscreen&&await document.msExitFullscreen()}catch(a){console.error("Error exiting fullscreen:",a),P.error("Fullscreen Error",{description:"Unable to exit fullscreen mode"})}},nt=async()=>{if(Et()){await Us();return}await Bs()},ke=()=>{O.value=!!Et(),Ae(()=>{S(),y.value&&x()})},Tt=()=>{Q.value=!Q.value,Q.value&&(G.value=!1),Be(Q.value)},Qs=()=>{Q.value=!1,Be(!1)},Ks=()=>{G.value=!1},At=()=>{be.value=!be.value},at=()=>{te.visit(K("projects.analysis",{project:n.project.slug}))},Vs=()=>{us(f.value),Le(),st()},Dt=a=>{(a.ctrlKey||a.metaKey)&&a.key==="s"&&(a.preventDefault(),he(),ls()),(a.ctrlKey||a.metaKey)&&!a.shiftKey&&a.key==="z"&&(a.preventDefault(),Ct()),(a.ctrlKey||a.metaKey)&&a.shiftKey&&a.key==="z"&&(a.preventDefault(),St()),(a.ctrlKey||a.metaKey)&&a.shiftKey&&(a.key==="f"||a.key==="F")&&(a.preventDefault(),nt())};Te(()=>{const a=()=>{A.value=window.innerWidth<1024};a(),window.addEventListener("resize",a),Q.value=Ye(),document.addEventListener("keydown",$t),document.addEventListener("keydown",Dt),document.addEventListener("fullscreenchange",ke),document.addEventListener("webkitfullscreenchange",ke),document.addEventListener("msfullscreenchange",ke),ke(),st(),Hs(),S()});const $t=a=>{if((a.ctrlKey||a.metaKey)&&!["INPUT","TEXTAREA","SELECT"].includes(a.target?.tagName))switch(a.key){case"ArrowLeft":a.preventDefault();const t=n.chapter.chapter_number-1;n.allChapters.find(qe=>qe.chapter_number===t)&&We(t);break;case"ArrowRight":a.preventDefault();const H=n.chapter.chapter_number+1;n.allChapters.find(qe=>qe.chapter_number===H)&&We(H);break}};Te(()=>{const a=t=>{const u=H=>{const{scrollTop:me,scrollHeight:qe,clientHeight:Xs}=t,Pt=H.deltaY,Ys=me<=0,Zs=me+Xs>=qe;Pt<0&&Ys||Pt>0&&Zs||H.stopPropagation()};return t.addEventListener("wheel",u,{passive:!0}),()=>t.removeEventListener("wheel",u)};Ae(()=>{const t=document.querySelectorAll('[class*="overflow-y-auto"]'),u=[];t.forEach(H=>{if(H instanceof HTMLElement){const me=a(H);u.push(me)}}),window.__scrollChainCleanup=u})}),cr(()=>{as(),bt.value&&bt.value.close(),document.removeEventListener("keydown",Dt),document.removeEventListener("keydown",$t);const a=window.__scrollChainCleanup;a&&Array.isArray(a)&&(a.forEach(t=>t()),delete window.__scrollChainCleanup),document.removeEventListener("fullscreenchange",ke),document.removeEventListener("webkitfullscreenchange",ke),document.removeEventListener("msfullscreenchange",ke)}),ue(()=>n.chapter,async a=>{d.value=a.title||"",f.value=a.content||""},{immediate:!1});const Js=async a=>{ae.value=a,a&&Ss()&&await mt(!1,{skipGeneration:!0})},jt=()=>{const a=[{popover:{title:"Welcome to the AI Assisted Editor",description:"Experience a powerful writing environment enhanced by AI. Generate an entire chapter with one click and access a suite of AI tools to refine your content.",popoverClass:"driver-popover-welcome"}},{element:"#back-to-project-btn",popover:{title:"Back to Project",description:"Return to your project dashboard."}},{element:"#left-sidebar-panel",popover:{title:"Chapter Navigation",description:"Use the Table of Contents to switch between chapters."},onHighlightStarted:()=>{M.value=!1},showOnMobile:!1},{element:"#view-controls",popover:{title:"View Options",description:"Customize your view with Preview, AI Chat, Fullscreen, and Dark Mode."}},{element:"#toggle-chat-mode",popover:{title:"AI Chat Assistant",description:"Open the AI assistant to help you write, brainstorm, or refine your content."}},{element:"#export-menu-container",popover:{title:"Export",description:"Export your chapter or entire project."}},{element:"#analyze-button",popover:{title:"Bulk Analysis",description:"Analyze content across chapters."}},{element:"#save-button",popover:{title:"Save Work",description:"Manually save your chapter. Auto-save is also active!"}},{element:"#mark-complete-btn",popover:{title:"Mark as Complete",description:"Finished writing? Mark the chapter as complete."}},{element:"#toggle-right-sidebar",popover:{title:"AI Tools Sidebar",description:"Toggle the sidebar to access AI tools like Smart Suggestions and Citation Helper."},showOnMobile:!1},{element:"#right-sidebar-panel",popover:{title:"AI Assistant Tools",description:"Access powerful AI features here."},onHighlightStarted:()=>{W.value=!1},showOnMobile:!1},{element:"#editor-footer",popover:{title:"Writing Stats",description:"Track your word count, quality score, and readiness."}},{element:"#reset-tour-button",popover:{title:"Need Help?",description:"Click here anytime to restart this tour."}}];yr({showProgress:!0,animate:!0,steps:A.value?a.filter(u=>u.showOnMobile!==!1):a}).drive()};Te(()=>{if(k.props.auth?.user?.email){const a=`chapter_editor_tour_seen_${k.props.auth.user.email}`;localStorage.getItem(a)||setTimeout(()=>{jt(),localStorage.setItem(a,"true")},1e3)}}),ue(f,Vs),ue(d,Le);const lt=async()=>{console.log("ðŸ”µ [MARK COMPLETE] Function called"),console.log("ðŸ”µ [MARK COMPLETE] Current word count:",ee.value);try{console.log("ðŸ”µ [MARK COMPLETE] Saving chapter..."),await he(!1),console.log("âœ… [MARK COMPLETE] Chapter saved");const a=K("chapters.mark-complete",{project:n.project.slug,chapter:n.chapter.chapter_number});console.log("ðŸ”µ [MARK COMPLETE] Posting to:",a),te.post(a,{},{onSuccess:()=>{console.log("âœ… [MARK COMPLETE] Request successful")},onError:t=>{console.error("âŒ [MARK COMPLETE] Request failed:",t)}})}catch(a){console.error("âŒ [MARK COMPLETE] Error:",a),P.error("Failed to save chapter before marking complete")}};return Te(async()=>{await ms()}),Te(()=>{y.value&&Ae(()=>x())}),ue(p,()=>{y.value&&Ae(()=>x())},{flush:"post"}),(a,t)=>(v(),F(e(wr),null,{default:o(()=>[y.value?(v(),N(Ft,{key:0},[R.value?(v(),N("div",Ao,[s("div",Do,[s("div",$o,[t[28]||(t[28]=s("div",null,[s("h1",{class:"text-lg font-semibold"},"ChapterEditor Theme Sandbox"),s("p",{class:"text-sm text-muted-foreground"},"No layout mode. Use `?theme_sandbox=nolayout`.")],-1)),s("div",jo,[r(Bt),r(e(_),{variant:"outline",size:"sm",onClick:x},{default:o(()=>[...t[26]||(t[26]=[i("Refresh",-1)])]),_:1}),r(e(_),{variant:"outline",size:"sm",onClick:t[0]||(t[0]=u=>e(te).visit(a.window.location.pathname))},{default:o(()=>[...t[27]||(t[27]=[i("Exit",-1)])]),_:1})])]),s("div",Po,[r(e(se),{class:"bg-card text-card-foreground"},{default:o(()=>[r(e(oe),null,{default:o(()=>[r(e(ie),{class:"text-base"},{default:o(()=>[...t[29]||(t[29]=[i("Theme State",-1)])]),_:1})]),_:1}),r(e(re),{class:"space-y-2 text-sm"},{default:o(()=>[s("div",Ro,[s("div",null,[t[30]||(t[30]=s("span",{class:"text-muted-foreground"},"appearance:",-1)),i(" "+c(e(T)),1)]),s("div",null,[t[31]||(t[31]=s("span",{class:"text-muted-foreground"},"isDark:",-1)),i(" "+c(e(p)),1)]),s("div",null,[t[32]||(t[32]=s("span",{class:"text-muted-foreground"},"html.dark:",-1)),i(" "+c(h.value.htmlHasDark),1)]),s("div",null,[t[33]||(t[33]=s("span",{class:"text-muted-foreground"},"step:",-1)),i(" "+c(E.value),1)])]),r(e(Ie)),s("div",Mo,[s("div",null,[t[34]||(t[34]=s("span",{class:"text-muted-foreground"},"--background:",-1)),i(" "+c(h.value.background),1)]),s("div",null,[t[35]||(t[35]=s("span",{class:"text-muted-foreground"},"--foreground:",-1)),i(" "+c(h.value.foreground),1)]),s("div",null,[t[36]||(t[36]=s("span",{class:"text-muted-foreground"},"--card:",-1)),i(" "+c(h.value.card),1)]),s("div",null,[t[37]||(t[37]=s("span",{class:"text-muted-foreground"},"--sidebar-background:",-1)),i(" "+c(h.value.sidebarBackground),1)])]),r(e(Ie)),s("div",Fo,[s("div",null,[t[38]||(t[38]=s("span",{class:"text-muted-foreground"},"body bg:",-1)),i(" "+c(h.value.bodyBg),1)]),s("div",null,[t[39]||(t[39]=s("span",{class:"text-muted-foreground"},"inset bg:",-1)),i(" "+c(h.value.insetBg),1)]),s("div",null,[t[40]||(t[40]=s("span",{class:"text-muted-foreground"},"sample bg-background:",-1)),i(" "+c(h.value.sampleBgBackground),1)]),s("div",null,[t[41]||(t[41]=s("span",{class:"text-muted-foreground"},"sample bg-card:",-1)),i(" "+c(h.value.sampleBgCard),1)]),s("div",null,[t[42]||(t[42]=s("span",{class:"text-muted-foreground"},"sample bg-muted:",-1)),i(" "+c(h.value.sampleBgMuted),1)])])]),_:1})]),_:1}),s("div",zo,[r(e(se),{ref_key:"sampleBgBackgroundEl",ref:L,class:"bg-background"},{default:o(()=>[r(e(oe),null,{default:o(()=>[r(e(ie),{class:"text-base"},{default:o(()=>[...t[43]||(t[43]=[i("bg-background",-1)])]),_:1})]),_:1}),r(e(re),{class:"text-sm text-muted-foreground"},{default:o(()=>[...t[44]||(t[44]=[i("Should flip with theme.",-1)])]),_:1})]),_:1},512),r(e(se),{ref_key:"sampleBgCardEl",ref:B,class:"bg-card"},{default:o(()=>[r(e(oe),null,{default:o(()=>[r(e(ie),{class:"text-base"},{default:o(()=>[...t[45]||(t[45]=[i("bg-card",-1)])]),_:1})]),_:1}),r(e(re),{class:"text-sm text-muted-foreground"},{default:o(()=>[...t[46]||(t[46]=[i("Card surface color.",-1)])]),_:1})]),_:1},512),r(e(se),{ref_key:"sampleBgMutedEl",ref:U,class:"bg-muted"},{default:o(()=>[r(e(oe),null,{default:o(()=>[r(e(ie),{class:"text-base"},{default:o(()=>[...t[47]||(t[47]=[i("bg-muted",-1)])]),_:1})]),_:1}),r(e(re),{class:"text-sm text-muted-foreground"},{default:o(()=>[...t[48]||(t[48]=[i("Muted surface color.",-1)])]),_:1})]),_:1},512)])])])])):(v(),F(Ut,{key:1,class:"h-screen overflow-hidden bg-background text-foreground"},{default:o(()=>[s("div",Lo,[s("div",No,[t[51]||(t[51]=s("div",null,[s("h1",{class:"text-lg font-semibold"},"ChapterEditor Theme Sandbox"),s("p",{class:"text-sm text-muted-foreground"}," Use `?theme_sandbox=1` (with layout) or `?theme_sandbox=nolayout`. ")],-1)),s("div",Oo,[r(Bt),r(e(_),{variant:"outline",size:"sm",onClick:x},{default:o(()=>[...t[49]||(t[49]=[i("Refresh",-1)])]),_:1}),r(e(_),{variant:"outline",size:"sm",onClick:t[1]||(t[1]=u=>e(te).visit(a.window.location.pathname))},{default:o(()=>[...t[50]||(t[50]=[i("Exit",-1)])]),_:1})])]),s("div",Wo,[r(e(se),{class:"bg-card text-card-foreground"},{default:o(()=>[r(e(oe),null,{default:o(()=>[r(e(ie),{class:"text-base"},{default:o(()=>[...t[52]||(t[52]=[i("Theme State",-1)])]),_:1})]),_:1}),r(e(re),{class:"space-y-2 text-sm"},{default:o(()=>[s("div",qo,[s("div",null,[t[53]||(t[53]=s("span",{class:"text-muted-foreground"},"appearance:",-1)),i(" "+c(e(T)),1)]),s("div",null,[t[54]||(t[54]=s("span",{class:"text-muted-foreground"},"isDark:",-1)),i(" "+c(e(p)),1)]),s("div",null,[t[55]||(t[55]=s("span",{class:"text-muted-foreground"},"html.dark:",-1)),i(" "+c(h.value.htmlHasDark),1)]),s("div",null,[t[56]||(t[56]=s("span",{class:"text-muted-foreground"},"step:",-1)),i(" "+c(E.value),1)])]),r(e(Ie)),s("div",Go,[s("div",null,[t[57]||(t[57]=s("span",{class:"text-muted-foreground"},"--background:",-1)),i(" "+c(h.value.background),1)]),s("div",null,[t[58]||(t[58]=s("span",{class:"text-muted-foreground"},"--foreground:",-1)),i(" "+c(h.value.foreground),1)]),s("div",null,[t[59]||(t[59]=s("span",{class:"text-muted-foreground"},"--card:",-1)),i(" "+c(h.value.card),1)]),s("div",null,[t[60]||(t[60]=s("span",{class:"text-muted-foreground"},"--sidebar-background:",-1)),i(" "+c(h.value.sidebarBackground),1)])]),r(e(Ie)),s("div",Io,[s("div",null,[t[61]||(t[61]=s("span",{class:"text-muted-foreground"},"body bg:",-1)),i(" "+c(h.value.bodyBg),1)]),s("div",null,[t[62]||(t[62]=s("span",{class:"text-muted-foreground"},"inset bg:",-1)),i(" "+c(h.value.insetBg),1)]),s("div",null,[t[63]||(t[63]=s("span",{class:"text-muted-foreground"},"sample bg-background:",-1)),i(" "+c(h.value.sampleBgBackground),1)]),s("div",null,[t[64]||(t[64]=s("span",{class:"text-muted-foreground"},"sample bg-card:",-1)),i(" "+c(h.value.sampleBgCard),1)]),s("div",null,[t[65]||(t[65]=s("span",{class:"text-muted-foreground"},"sample bg-muted:",-1)),i(" "+c(h.value.sampleBgMuted),1)])])]),_:1})]),_:1}),s("div",Ho,[r(e(se),{ref_key:"sampleBgBackgroundEl",ref:L,class:"bg-background"},{default:o(()=>[r(e(oe),null,{default:o(()=>[r(e(ie),{class:"text-base"},{default:o(()=>[...t[66]||(t[66]=[i("bg-background",-1)])]),_:1})]),_:1}),r(e(re),{class:"text-sm text-muted-foreground"},{default:o(()=>[...t[67]||(t[67]=[i("Should flip with theme.",-1)])]),_:1})]),_:1},512),r(e(se),{ref_key:"sampleBgCardEl",ref:B,class:"bg-card"},{default:o(()=>[r(e(oe),null,{default:o(()=>[r(e(ie),{class:"text-base"},{default:o(()=>[...t[68]||(t[68]=[i("bg-card",-1)])]),_:1})]),_:1}),r(e(re),{class:"text-sm text-muted-foreground"},{default:o(()=>[...t[69]||(t[69]=[i("Card surface color.",-1)])]),_:1})]),_:1},512),r(e(se),{ref_key:"sampleBgMutedEl",ref:U,class:"bg-muted"},{default:o(()=>[r(e(oe),null,{default:o(()=>[r(e(ie),{class:"text-base"},{default:o(()=>[...t[70]||(t[70]=[i("bg-muted",-1)])]),_:1})]),_:1}),r(e(re),{class:"text-sm text-muted-foreground"},{default:o(()=>[...t[71]||(t[71]=[i("Muted surface color.",-1)])]),_:1})]),_:1},512)]),E.value>=1?(v(),N("div",Bo,[t[72]||(t[72]=s("div",{class:"text-sm font-medium"},"Step 1: Paper Card only",-1)),t[73]||(t[73]=s("div",{class:"text-xs text-muted-foreground mb-3"},"Adds `ChapterEditorPaperCard` only.",-1)),r(Jt,{context:gt.value},null,8,["context"])])):V("",!0)])])]),_:1}))],64)):(v(),N(Ft,{key:1},[e(Q)?(v(),F(e($),{key:0,project:ge.value,chapter:fe.value,"chapter-title":e(d),"chapter-content":e(f),"current-word-count":e(ee),"target-word-count":le.value,"progress-percentage":e(ot),"writing-quality-score":e(ve),"is-valid":Oe.value,"is-saving":e(pe),"show-preview":e(ce),"is-generating":e(we),"generation-progress":e(Ne),"history-index":e(ds),"content-history-length":e(is).length,"selected-text":e(q),"onUpdate:chapterTitle":t[2]||(t[2]=u=>d.value=u),"onUpdate:chapterContent":t[3]||(t[3]=u=>f.value=u),"onUpdate:selectedText":t[4]||(t[4]=u=>q.value=u),"onUpdate:showPreview":t[5]||(t[5]=u=>ce.value=u),onSave:t[6]||(t[6]=u=>kt(u)),onUndo:Ct,onRedo:St,onExitChatMode:Qs},null,8,["project","chapter","chapter-title","chapter-content","current-word-count","target-word-count","progress-percentage","writing-quality-score","is-valid","is-saving","show-preview","is-generating","generation-progress","history-index","content-history-length","selected-text"])):e(G)?(v(),F(e(z),{key:1,project:ge.value,chapter:fe.value,"chapter-title":e(d),"chapter-content":e(f),"current-word-count":e(ee),"target-word-count":le.value,"progress-percentage":e(ot),onExitCitationMode:Ks},null,8,["project","chapter","chapter-title","chapter-content","current-word-count","target-word-count","progress-percentage"])):e(O)?(v(),N("div",Uo,[t[90]||(t[90]=s("div",{class:"absolute inset-0 z-0 overflow-hidden pointer-events-none"},[s("div",{class:"absolute top-[-20%] left-[-10%] w-[50%] h-[50%] rounded-full bg-blue-500/5 blur-[120px]"}),s("div",{class:"absolute bottom-[-20%] right-[-10%] w-[50%] h-[50%] rounded-full bg-purple-500/5 blur-[120px]"})],-1)),s("div",Qo,[s("div",Ko,[r(e(Y),null,{default:o(()=>[r(e(J),{asChild:""},{default:o(()=>[r(e(_),{onClick:t[7]||(t[7]=u=>e(te).visit(e(K)("projects.show",n.project.slug))),variant:"ghost",size:"icon",class:"h-10 w-10 rounded-full hover:bg-primary/10 hover:text-primary transition-all duration-300"},{default:o(()=>[r(e(it),{class:"h-5 w-5"})]),_:1})]),_:1}),r(e(X),null,{default:o(()=>[...t[74]||(t[74]=[s("p",null,"Back to Project",-1)])]),_:1})]),_:1}),s("div",Vo,[s("h1",Jo,c(n.project.title),1),s("div",Xo,[r(e(Ce),{variant:"outline",class:"h-5 px-2 rounded-full border-primary/20 bg-primary/5 text-primary font-medium"},{default:o(()=>[i(" Chapter "+c(n.chapter.chapter_number),1)]),_:1}),s("span",Yo,[t[75]||(t[75]=s("span",{class:"h-1.5 w-1.5 rounded-full bg-green-500 animate-pulse"},null,-1)),i(" "+c(e(ee))+" words ",1)])])])]),s("div",Zo,[s("div",en,[r(e(_),{onClick:t[8]||(t[8]=u=>C.value=!e(C)),variant:e(C)?"secondary":"ghost",size:"sm",class:He(["h-8 px-4 rounded-full text-xs font-medium transition-all duration-300",e(C)?"bg-primary/10 text-primary hover:bg-primary/15":"hover:bg-muted"])},{default:o(()=>[r(e(zt),{class:"mr-2 h-3.5 w-3.5"}),t[76]||(t[76]=i(" Outline ",-1))]),_:1},8,["variant","class"]),t[78]||(t[78]=s("div",{class:"w-px h-4 bg-border/50 mx-1"},null,-1)),r(e(_),{onClick:t[9]||(t[9]=u=>I.value=!e(I)),variant:e(I)?"secondary":"ghost",size:"sm",class:He(["h-8 px-4 rounded-full text-xs font-medium transition-all duration-300",e(I)?"bg-primary/10 text-primary hover:bg-primary/15":"hover:bg-muted"])},{default:o(()=>[r(e(Ge),{class:"mr-2 h-3.5 w-3.5"}),t[77]||(t[77]=i(" Assistant ",-1))]),_:1},8,["variant","class"])]),s("div",tn,[r(e(Y),null,{default:o(()=>[r(e(J),{asChild:""},{default:o(()=>[r(e(_),{onClick:Tt,variant:"ghost",size:"icon",class:"h-9 w-9 rounded-full transition-all hover:bg-muted"},{default:o(()=>[r(e(Lt),{class:"h-4.5 w-4.5 text-blue-500"})]),_:1})]),_:1}),r(e(X),null,{default:o(()=>[...t[79]||(t[79]=[s("p",null,"Open AI Chat",-1)])]),_:1})]),_:1}),r(e(Y),null,{default:o(()=>[r(e(J),{asChild:""},{default:o(()=>[r(e(_),{onClick:nt,variant:e(O)?"secondary":"ghost",size:"icon",class:"h-9 w-9 rounded-full transition-all hover:bg-muted"},{default:o(()=>[e(O)?(v(),F(e(Nt),{key:0,class:"h-4.5 w-4.5"})):(v(),F(e(Ot),{key:1,class:"h-4.5 w-4.5"}))]),_:1},8,["variant"])]),_:1}),r(e(X),null,{default:o(()=>[s("p",null,c(e(O)?"Exit fullscreen":"Enter fullscreen"),1)]),_:1})]),_:1}),r(e(Y),null,{default:o(()=>[r(e(J),{asChild:""},{default:o(()=>[r(e(_),{onClick:e(Z),variant:e(ne)?"secondary":"ghost",size:"icon",class:"h-9 w-9 rounded-full transition-all hover:bg-muted"},{default:o(()=>[e(ne)?(v(),F(e(Wt),{key:0,class:"h-4.5 w-4.5 text-foreground"})):(v(),F(e(qt),{key:1,class:"h-4.5 w-4.5 text-muted-foreground"}))]),_:1},8,["onClick","variant"])]),_:1}),r(e(X),null,{default:o(()=>[...t[80]||(t[80]=[s("p",null,"Toggle Dark Mode",-1)])]),_:1})]),_:1}),r(dt,{project:ge.value,"current-chapter":fe.value,"all-chapters":xe.value,size:"icon",variant:"ghost",class:"h-9 w-9 rounded-full hover:bg-muted"},null,8,["project","current-chapter","all-chapters"])])])]),s("div",sn,[s("div",{class:"absolute top-0 left-0 h-full bg-gradient-to-r from-blue-500 via-purple-500 to-pink-500 transition-all duration-700 ease-out shadow-[0_0_10px_rgba(59,130,246,0.5)]",style:Ve({width:`${Math.min(e(ot),100)}%`})},null,4)]),e(we)?(v(),N("div",rn,[s("div",on,[t[86]||(t[86]=s("div",{class:"absolute inset-0 -skew-x-12 animate-pulse bg-gradient-to-r from-transparent via-white/10 to-transparent"},null,-1)),s("div",nn,[s("div",an,[s("div",ln,[s("div",dn,[r(e(Ge),{class:"h-3 w-3 text-white"})]),t[81]||(t[81]=s("div",{class:"absolute inset-0 h-6 w-6 animate-ping rounded-full bg-gradient-to-br from-blue-500 to-purple-600 opacity-20"},null,-1))]),s("div",null,[t[82]||(t[82]=s("h4",{class:"text-xs font-semibold text-blue-900 dark:text-blue-100"},"AI Generator",-1)),s("p",un,c(e(_e)),1)])]),r(e(Ce),{variant:"outline",class:"border-blue-300 text-xs text-blue-700 dark:border-blue-700 dark:text-blue-300"},{default:o(()=>[i(c(Math.round(e(ye)))+"% ",1)]),_:1})]),s("div",cn,[s("div",pn,[t[83]||(t[83]=s("span",{class:"text-xs text-blue-800 dark:text-blue-200"},"Generation Progress",-1)),s("span",gn,c(e(Ls))+" / "+c(e(zs))+" words",1)]),s("div",fn,[s("div",{class:"absolute top-0 left-0 h-full rounded-full bg-gradient-to-r from-blue-500 to-purple-500 transition-all duration-500 ease-out",style:Ve({width:`${e(ye)}%`})},[...t[84]||(t[84]=[s("div",{class:"absolute inset-0 animate-pulse bg-gradient-to-r from-transparent via-white/30 to-transparent"},null,-1)])],4),s("div",{class:"absolute top-0 left-0 h-full rounded-full bg-gradient-to-r from-blue-400 to-purple-400 opacity-50 blur-sm transition-all duration-500",style:Ve({width:`${e(ye)}%`})},null,4)])]),s("div",mn,[s("div",hn,[e(_e)==="Initializing"?(v(),N("div",vn)):e(_e)==="Connecting"?(v(),N("div",bn,[...t[85]||(t[85]=[s("div",{class:"h-2 w-0.5 animate-pulse rounded-full bg-blue-500"},null,-1),s("div",{class:"h-2 w-0.5 animate-pulse rounded-full bg-purple-500",style:{"animation-delay":"0.2s"}},null,-1),s("div",{class:"h-2 w-0.5 animate-pulse rounded-full bg-blue-500",style:{"animation-delay":"0.4s"}},null,-1)])])):e(_e)==="Generating"?(v(),N("div",xn)):e(_e)==="Complete"?(v(),N("div",wn)):(v(),N("div",yn))]),s("p",_n,c(e(Ne)),1)])])])):V("",!0),s("div",kn,[r($e,{"enter-active-class":"transition-all duration-300 ease-in-out","enter-from-class":"-ml-72 opacity-0","enter-to-class":"ml-0 opacity-100","leave-active-class":"transition-all duration-300 ease-in-out","leave-from-class":"ml-0 opacity-100","leave-to-class":"-ml-72 opacity-0"},{default:o(()=>[e(C)?(v(),N("div",Cn,[s("div",Sn,[s("div",En,[s("div",Tn,[t[87]||(t[87]=s("h2",{class:"text-sm font-semibold text-foreground mb-1"},"Table of Contents",-1)),s("p",An,c(xe.value.length)+" Chapters ",1)]),(v(),F(pr,null,{fallback:o(()=>[...t[88]||(t[88]=[s("div",{class:"flex items-center justify-center p-8"},[s("div",{class:"h-6 w-6 animate-spin rounded-full border-2 border-primary border-t-transparent"})],-1)])]),default:o(()=>[r(e(w),{"all-chapters":xe.value,"current-chapter":fe.value,project:ge.value,outlines:a.project.outlines||[],"faculty-chapters":a.facultyChapters||[],"current-word-count":e(ee),"target-word-count":le.value,"writing-quality-score":e(ve),"chapter-content-length":e(f).length,onGoToChapter:We,onGenerateNextChapter:e(rt)},null,8,["all-chapters","current-chapter","project","outlines","faculty-chapters","current-word-count","target-word-count","writing-quality-score","chapter-content-length","onGenerateNextChapter"])]),_:1}))])])])):V("",!0)]),_:1}),s("div",Dn,[s("div",$n,[s("div",jn,[r(Jt,{context:gt.value},null,8,["context"]),t[89]||(t[89]=s("div",{class:"h-12"},null,-1))])])]),r($e,{"enter-active-class":"transition-all duration-300 ease-in-out","enter-from-class":"-mr-72 opacity-0","enter-to-class":"mr-0 opacity-100","leave-active-class":"transition-all duration-300 ease-in-out","leave-from-class":"mr-0 opacity-100","leave-to-class":"-mr-72 opacity-0"},{default:o(()=>[e(I)?(v(),F(Xt,Gt({key:0,"container-class":"w-72 flex-shrink-0 border-l border-border/40 bg-background/40 backdrop-blur-md"},ft.value),null,16)):V("",!0)]),_:1})])])):(v(),F(Ut,{key:3,class:"h-screen overflow-hidden bg-background dark:bg-background transition-colors duration-300"},{default:o(()=>[s("div",Pn,[t[112]||(t[112]=s("div",{class:"absolute inset-0 z-0 overflow-hidden pointer-events-none"},[s("div",{class:"absolute top-[-10%] left-[-10%] w-[40%] h-[40%] rounded-full bg-blue-500/5 blur-[100px]"}),s("div",{class:"absolute bottom-[-10%] right-[-10%] w-[40%] h-[40%] rounded-full bg-purple-500/5 blur-[100px]"})],-1)),Se(s("aside",Rn,[s("div",Mn,[t[91]||(t[91]=s("span",{class:"text-sm font-semibold tracking-tight text-foreground"},"Navigation",-1)),r(e(Ce),{variant:"outline",class:"text-[10px] h-5 px-1.5"},{default:o(()=>[i(c(xe.value.length)+" Chapters ",1)]),_:1})]),r(e(Ht),{class:"flex-1"},{default:o(()=>[s("div",Fn,[r(e(w),{"all-chapters":xe.value,"current-chapter":fe.value,project:ge.value,outlines:a.project.outlines||[],"faculty-chapters":a.facultyChapters||[],"current-word-count":e(ee),"target-word-count":le.value,"writing-quality-score":e(ve),"chapter-content-length":e(f).length,onGoToChapter:We,onGenerateNextChapter:e(rt)},null,8,["all-chapters","current-chapter","project","outlines","faculty-chapters","current-word-count","target-word-count","writing-quality-score","chapter-content-length","onGenerateNextChapter"])])]),_:1})],512),[[De,!e(M)]]),s("main",zn,[s("header",Ln,[s("div",Nn,[r(e(Y),null,{default:o(()=>[r(e(J),{asChild:""},{default:o(()=>[r(e(_),{id:"back-to-project-btn-mobile",variant:"ghost",size:"icon",class:"h-9 w-9 text-zinc-700 dark:text-zinc-300 hover:text-foreground hover:bg-muted/50 rounded-full",onClick:t[10]||(t[10]=u=>e(te).visit(e(K)("projects.writing",n.project.slug)))},{default:o(()=>[r(e(it),{class:"w-4 h-4"})]),_:1})]),_:1}),r(e(X),null,{default:o(()=>[...t[92]||(t[92]=[i("Back to Writing",-1)])]),_:1})]),_:1}),t[93]||(t[93]=s("div",{class:"h-6 w-px bg-border/50 mx-1 hidden lg:block"},null,-1)),r(e(_),{variant:"ghost",size:"icon",onClick:t[11]||(t[11]=u=>je.value=!0),class:"lg:hidden text-muted-foreground hover:text-foreground h-9 w-9 hover:bg-muted/50 rounded-full"},{default:o(()=>[r(e(zt),{class:"h-4.5 w-4.5"})]),_:1})]),s("div",On,[r(e(_),{variant:"ghost",size:"icon",onClick:t[12]||(t[12]=u=>Pe.value=!0),class:"text-muted-foreground hover:text-foreground h-9 w-9 hover:bg-muted/50 rounded-full"},{default:o(()=>[r(e(Ge),{class:"h-4.5 w-4.5"})]),_:1})]),s("div",Wn,[s("div",qn,[s("h1",{class:"text-xl font-bold tracking-tight text-foreground leading-snug cursor-pointer hover:text-primary/80 transition-colors break-words",onClick:t[13]||(t[13]=u=>e(te).visit(e(K)("projects.show",n.project.slug)))},c(n.project.title),1),r(e(Ce),{variant:"secondary",class:"shrink-0 h-5 px-2 text-[10px] font-medium rounded-full bg-secondary/50 border border-border/50 mt-1"},{default:o(()=>[i(" Ch "+c(n.chapter.chapter_number),1)]),_:1})]),s("div",Gn,[s("div",In,[r(dt,{project:ge.value,"current-chapter":fe.value,"all-chapters":xe.value,size:"icon",variant:"outline","trigger-element":"icon","button-class":"h-8 w-8 rounded-full bg-background/50 backdrop-blur-sm",class:"text-zinc-700 dark:text-zinc-300"},null,8,["project","current-chapter","all-chapters"]),r(e(_),{variant:"outline",size:"icon",class:"h-8 w-8 gap-2 text-zinc-700 dark:text-zinc-300 hover:text-foreground bg-background/50 backdrop-blur-sm rounded-full",onClick:at},{default:o(()=>[r(e(It),{class:"w-4 h-4"})]),_:1})]),s("div",Hn,[r(e(_),{onClick:t[14]||(t[14]=u=>e(he)(!1)),disabled:e(pe),variant:Oe.value?"default":"secondary",size:"sm",class:"h-8 px-3 text-xs shadow-sm gap-2 rounded-full min-w-[32px]"},{default:o(()=>[r(e(ut),{class:"h-3.5 w-3.5"}),e(pe)?(v(),N("span",Bn,"Saving")):V("",!0)]),_:1},8,["disabled","variant"]),r(e(_),{onClick:lt,disabled:e(pe),size:"sm",class:"h-8 px-3 text-xs shadow-sm gap-2 rounded-full"},{default:o(()=>[r(e(Je),{class:"h-3.5 w-3.5"}),t[94]||(t[94]=s("span",{class:"sm:hidden"},"Done",-1))]),_:1},8,["disabled"])])])])]),s("div",Un,[s("div",Qn,[s("div",Kn,[s("h1",{class:"text-sm font-bold text-foreground cursor-pointer hover:text-primary transition-colors flex items-center",onClick:t[15]||(t[15]=u=>e(te).visit(e(K)("projects.show",n.project.slug)))},[s("div",{innerHTML:n.project.title,class:"inline-block"},null,8,Vn)]),r(e(Ce),{variant:"secondary",class:"h-5 px-2 text-[10px] font-medium rounded-full bg-secondary/50 border border-border/50"},{default:o(()=>[i(" Ch "+c(n.chapter.chapter_number),1)]),_:1})])]),s("div",Jn,[s("div",Xn,[r(e(Y),null,{default:o(()=>[r(e(J),{asChild:""},{default:o(()=>[r(e(_),{id:"back-to-project-btn",variant:"ghost",size:"icon",class:"h-8 w-8 text-zinc-700 dark:text-zinc-300 hover:text-foreground rounded-full",onClick:t[16]||(t[16]=u=>e(te).visit(e(K)("projects.writing",n.project.slug)))},{default:o(()=>[r(e(it),{class:"w-4 h-4"})]),_:1})]),_:1}),r(e(X),null,{default:o(()=>[...t[95]||(t[95]=[i("Back to Writing",-1)])]),_:1})]),_:1}),t[96]||(t[96]=s("div",{class:"h-4 w-px bg-border/50 mx-1"},null,-1)),r(e(_),{id:"toggle-left-sidebar",variant:"ghost",size:"icon",onClick:t[17]||(t[17]=u=>M.value=!e(M)),class:"text-muted-foreground hover:text-foreground h-8 w-8 rounded-full"},{default:o(()=>[e(M)?(v(),F(e(fr),{key:1,class:"h-4 w-4"})):(v(),F(e(gr),{key:0,class:"h-4 w-4"}))]),_:1})]),s("div",Yn,[s("div",Zn,[r(e(Y),null,{default:o(()=>[r(e(J),{asChild:""},{default:o(()=>[r(e(_),{onClick:At,variant:e(be)?"secondary":"ghost",size:"sm",class:"h-7 px-3 text-xs gap-2 text-zinc-700 dark:text-zinc-300 hover:text-foreground rounded-full"},{default:o(()=>[e(be)?(v(),F(e(mr),{key:1,class:"h-3.5 w-3.5"})):(v(),F(e(es),{key:0,class:"h-3.5 w-3.5"})),s("span",ea,c(e(be)?"Edit":"Preview"),1)]),_:1},8,["variant"])]),_:1}),r(e(X),null,{default:o(()=>[...t[97]||(t[97]=[i("Toggle Preview Mode",-1)])]),_:1})]),_:1}),t[101]||(t[101]=s("div",{class:"w-px h-3 bg-border/50 mx-0.5"},null,-1)),r(e(Y),null,{default:o(()=>[r(e(J),{asChild:""},{default:o(()=>[r(e(_),{id:"toggle-chat-mode",onClick:Tt,variant:"ghost",size:"sm",class:"h-7 px-3 text-xs gap-2 text-muted-foreground hover:text-foreground rounded-full"},{default:o(()=>[r(e(Lt),{class:"h-3.5 w-3.5 text-blue-500"}),t[98]||(t[98]=s("span",{class:"hidden xl:inline text-foreground"},"AI Chat",-1))]),_:1})]),_:1}),r(e(X),null,{default:o(()=>[...t[99]||(t[99]=[i("Open AI Assistant",-1)])]),_:1})]),_:1}),t[102]||(t[102]=s("div",{class:"w-px h-3 bg-border/50 mx-0.5"},null,-1)),r(e(Y),null,{default:o(()=>[r(e(J),{asChild:""},{default:o(()=>[r(e(_),{onClick:nt,variant:"ghost",size:"sm",class:"h-7 px-3 text-xs gap-2 text-muted-foreground hover:text-foreground rounded-full"},{default:o(()=>[e(O)?(v(),F(e(Nt),{key:0,class:"h-3.5 w-3.5"})):(v(),F(e(Ot),{key:1,class:"h-3.5 w-3.5"})),s("span",ta,c(e(O)?`Exit
                                                        Fullscreen`:"Fullscreen"),1)]),_:1})]),_:1}),r(e(X),null,{default:o(()=>[s("p",null,c(e(O)?"Exit fullscreen":"Enter fullscreen"),1)]),_:1})]),_:1}),t[103]||(t[103]=s("div",{class:"w-px h-3 bg-border/50 mx-0.5"},null,-1)),r(e(Y),null,{default:o(()=>[r(e(J),{asChild:""},{default:o(()=>[r(e(_),{onClick:e(Z),variant:"ghost",size:"sm",class:"h-7 px-3 text-xs gap-2 text-zinc-700 dark:text-zinc-300 hover:text-foreground rounded-full"},{default:o(()=>[e(ne)?(v(),F(e(Wt),{key:0,class:"h-3.5 w-3.5 text-foreground"})):(v(),F(e(qt),{key:1,class:"h-3.5 w-3.5"}))]),_:1},8,["onClick"])]),_:1}),r(e(X),null,{default:o(()=>[...t[100]||(t[100]=[i("Toggle Dark Mode",-1)])]),_:1})]),_:1})]),s("div",sa,[r(dt,{id:"export-menu-container",project:ge.value,"current-chapter":fe.value,"all-chapters":xe.value,size:"sm",variant:"outline","trigger-element":"button","button-class":"h-9 gap-2 px-3 rounded-full bg-background/50 backdrop-blur-sm",class:"text-zinc-700 dark:text-zinc-300"},null,8,["project","current-chapter","all-chapters"]),r(e(_),{id:"analyze-button",variant:"outline",size:"sm",class:"h-9 gap-2 text-zinc-700 dark:text-zinc-300 hover:text-foreground bg-background/50 backdrop-blur-sm rounded-full",onClick:at,title:"Open bulk analysis"},{default:o(()=>[r(e(It),{class:"w-4 h-4"}),t[104]||(t[104]=s("span",{class:"text-xs font-medium"},"Analyze",-1))]),_:1})]),s("div",ra,[r(e(_),{id:"save-button",onClick:t[18]||(t[18]=u=>e(he)(!1)),disabled:e(pe),variant:Oe.value?"default":"secondary",size:"sm",class:"h-9 px-4 text-xs shadow-sm gap-2 rounded-full min-w-[32px]"},{default:o(()=>[r(e(ut),{class:"h-3.5 w-3.5"}),s("span",oa,c(e(pe)?"Saving":"Save"),1)]),_:1},8,["disabled","variant"]),r(e(_),{id:"mark-complete-btn",onClick:lt,disabled:e(pe),size:"sm",class:"h-9 px-4 text-xs shadow-sm gap-2 rounded-full"},{default:o(()=>[r(e(Je),{class:"h-3.5 w-3.5"}),t[105]||(t[105]=s("span",null,"Mark Complete",-1))]),_:1},8,["disabled"]),t[107]||(t[107]=s("div",{class:"w-px h-4 bg-border/50 mx-1"},null,-1)),t[108]||(t[108]=s("div",{class:"w-px h-4 bg-border/50 mx-1"},null,-1)),r(e(Y),null,{default:o(()=>[r(e(J),{asChild:""},{default:o(()=>[r(e(_),{id:"reset-tour-button",variant:"ghost",size:"icon",onClick:jt,class:"text-muted-foreground hover:text-foreground h-9 w-9 hover:bg-muted/50 rounded-full"},{default:o(()=>[r(e(hr),{class:"h-4.5 w-4.5"})]),_:1})]),_:1}),r(e(X),null,{default:o(()=>[...t[106]||(t[106]=[i("Restart Tutorial",-1)])]),_:1})]),_:1}),r(e(_),{id:"toggle-right-sidebar",variant:"ghost",size:"icon",onClick:t[19]||(t[19]=u=>W.value=!e(W)),class:"hidden lg:flex text-muted-foreground hover:text-foreground h-9 w-9 hover:bg-muted/50 rounded-full"},{default:o(()=>[e(W)?(v(),F(e(br),{key:1,class:"h-4.5 w-4.5"})):(v(),F(e(vr),{key:0,class:"h-4.5 w-4.5"}))]),_:1})])])])]),s("div",na,[r($e,{"enter-active-class":"transition-all duration-300 ease-out","enter-from-class":"opacity-0 -translate-y-4","enter-to-class":"opacity-100 translate-y-0","leave-active-class":"transition-all duration-200 ease-in","leave-from-class":"opacity-100 translate-y-0","leave-to-class":"opacity-0 -translate-y-4"},{default:o(()=>[e(we)?(v(),N("div",aa,[s("div",la,[s("div",ia,[s("div",da,[s("div",ua,[r(e(Ge),{class:"h-4 w-4 text-white animate-pulse"})]),s("div",ca,[s("div",pa,[t[109]||(t[109]=s("h4",{class:"text-xs font-semibold text-foreground"}," Generating Content...",-1)),s("span",ga,c(Math.round(e(ye)))+"%",1)]),s("div",fa,[s("div",{class:"h-full bg-gradient-to-r from-blue-500 to-purple-500 transition-all duration-300",style:Ve({width:`${e(ye)}%`})},null,4)])])]),s("p",ma,c(e(Ne)),1)])])])):V("",!0)]),_:1}),r(e(Ht),{ref_key:"editorScrollRef",ref:Ws,class:"h-full w-full"},{default:o(()=>[s("div",ha,[Se(s("div",va,[r(ss,{ref_key:"richTextEditorFullscreen",ref:j,modelValue:e(f),"onUpdate:modelValue":t[20]||(t[20]=u=>xr(f)?f.value=u:null),placeholder:"Start writing your chapter...",class:"prose prose-slate dark:prose-invert prose-lg max-w-none focus:outline-none min-h-[500px]","streaming-mode":e(vt),"is-generating":e(we),"generation-progress":e(Ne),"generation-percentage":e(ye),"generation-phase":e(_e),"onUpdate:selectedText":t[21]||(t[21]=u=>q.value=u),"min-height":"500px"},null,8,["modelValue","streaming-mode","is-generating","generation-progress","generation-percentage","generation-phase"])],512),[[De,!e(be)]]),Se(s("div",ba,[r(rs,{content:e(f),class:"prose prose-slate dark:prose-invert prose-lg max-w-none"},null,8,["content"])],512),[[De,e(be)]])])]),_:1},512)]),s("div",xa,[s("div",wa,[s("span",null,"Words: "+c(e(ee))+" / "+c(le.value),1),s("span",ya,"Last saved: "+c(e(pe)?"Saving...":`Just
                                    now`),1)]),s("div",_a,[s("span",null,[t[110]||(t[110]=i("Quality: ",-1)),s("span",{class:He(e(ve)>70?"text-green-500":"text-amber-500")},c(e(ve))+"%",3)]),Oe.value?(v(),N("span",ka,[r(e(Je),{class:"h-3 w-3"}),t[111]||(t[111]=i(" Ready ",-1))])):V("",!0)])])]),r(Xt,Gt({id:"right-sidebar-panel","is-collapsed":e(W),"container-class":"hidden lg:flex w-96 flex-col border-l border-border/40 bg-background/60 backdrop-blur-xl z-20 transition-all duration-300"},ft.value),null,16,["is-collapsed"])]),r(e(l),{"show-left-sidebar":e(je),"show-right-sidebar":e(Pe),"is-mobile":e(A),"all-chapters":xe.value,"current-chapter":fe.value,project:ge.value,"current-word-count":e(ee),"target-word-count":le.value,"writing-quality-score":e(ve),"chapter-content-length":e(f).length,"is-generating":e(we),"selected-text":e(q),"is-loading-suggestions":e(ht),"show-citation-helper":e(Ue),"chapter-content":e(f),"onUpdate:showLeftSidebar":t[22]||(t[22]=u=>je.value=u),"onUpdate:showRightSidebar":t[23]||(t[23]=u=>Pe.value=u),onGoToChapter:We,onGenerateNextChapter:e(rt),onStartStreamingGeneration:e(xt),onGetAiSuggestions:e(wt),"onUpdate:showCitationHelper":t[24]||(t[24]=u=>Ue.value=u),onCheckCitations:e(yt)},null,8,["show-left-sidebar","show-right-sidebar","is-mobile","all-chapters","current-chapter","project","current-word-count","target-word-count","writing-quality-score","chapter-content-length","is-generating","selected-text","is-loading-suggestions","show-citation-helper","chapter-content","onGenerateNextChapter","onStartStreamingGeneration","onGetAiSuggestions","onCheckCitations"]),r(_r,{open:e(Ee),"current-balance":e(Re),"required-words":e(Me),action:e(Ze),"onUpdate:open":t[25]||(t[25]=u=>Ee.value=u),onClose:e(tt)},null,8,["open","current-balance","required-words","action","onClose"]),e(Ns)?(v(),N("div",Ca,[r(e(se),{class:"w-full max-w-md mx-4 bg-white dark:bg-slate-900 border-amber-500/50 shadow-2xl"},{default:o(()=>[r(e(oe),null,{default:o(()=>[r(e(ie),{class:"flex items-center gap-2 text-amber-600 dark:text-amber-400"},{default:o(()=>[...t[113]||(t[113]=[s("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[s("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"})],-1),i(" Generation Interrupted ",-1)])]),_:1})]),_:1}),r(e(re),null,{default:o(()=>[s("p",Sa,[t[114]||(t[114]=i(" Connection lost. ",-1)),s("span",Ea,c(e(Os))+" words",1),t[115]||(t[115]=i(" may have been saved. ",-1))]),s("div",Ta,[r(e(_),{onClick:e(Gs),class:"flex-1 bg-amber-600 hover:bg-amber-700 text-white"},{default:o(()=>[...t[116]||(t[116]=[s("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-4 w-4 mr-2",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[s("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"})],-1),i(" Reload & Recover ",-1)])]),_:1},8,["onClick"]),r(e(_),{onClick:e(Is),variant:"outline",class:"flex-1"},{default:o(()=>[...t[117]||(t[117]=[i(" Dismiss ",-1)])]),_:1},8,["onClick"])])]),_:1})]),_:1})])):V("",!0)]),_:1}))],64))]),_:1}))}}),$a=os(Da,[["__scopeId","data-v-c7cd804d"]]),ti=Object.freeze(Object.defineProperty({__proto__:null,default:$a},Symbol.toStringTag,{value:"Module"}));export{_o as A,ti as C};
