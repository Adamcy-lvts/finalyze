import{d as q,z as y,g as p,Q as L,a as S,o as v,k as a,w as l,u as r,e as t,s as T,c as $,q as x,t as b,T as G,b as K,ac as Y,C as J}from"./app-cHOgrRFA.js";import{_ as f}from"./index-Cij16i_Y.js";import{a as X,_ as ee}from"./CardContent.vue_vue_type_script_setup_true_lang-DxPuR9AP.js";import{_ as te,a as ae}from"./CardTitle.vue_vue_type_script_setup_true_lang-DmmzP4UZ.js";import{_ as j,a as z,b as B}from"./CollapsibleTrigger.vue_vue_type_script_setup_true_lang-ClZDz4PK.js";import{_ as se}from"./Separator.vue_vue_type_script_setup_true_lang-CAJO-YUk.js";import{_ as re}from"./Progress.vue_vue_type_script_setup_true_lang-BXgomMmL.js";import{t as c}from"./Sonner.vue_vue_type_script_setup_true_lang-C8EcJHsM.js";import{_ as oe}from"./CitationHelper.vue_vue_type_script_setup_true_lang-wBIzFZSV.js";import{B as N}from"./brain-BDL84Fi_.js";import{Z as ne}from"./zap-D3s8OyvD.js";import{C as E}from"./chevron-down-Bs-GcsgS.js";import{P as F}from"./pen-tool-CIMafnCi.js";import{R as ie}from"./refresh-cw-DcQcQBfN.js";import{W as le}from"./wand-sparkles-xopuRznE.js";import{C as ce}from"./circle-check-DiXTSre3.js";import{S as de}from"./sparkles-CfCd3OeD.js";import{ap as ue,Q as pe}from"./RichTextEditor-CpjugFaH.js";import{T as me}from"./type-jyCTt5uC.js";import{_ as fe}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./VisuallyHidden-CxNh-b-f.js";import"./useForwardExpose-cTfuBZO2.js";import"./Separator-DYSqUweG.js";import"./nullish-CHIgUVhi.js";import"./DropdownMenuTrigger.vue_vue_type_script_setup_true_lang-CGdQfbe-.js";import"./triangle-alert-DQ2ymt66.js";import"./index-BGU5Obtq.js";import"./Input.vue_vue_type_script_setup_true_lang-BDdhe0ST.js";import"./ScrollArea.vue_vue_type_script_setup_true_lang-rJ336vrN.js";import"./useNonce-D5LWr9IL.js";import"./AlertDialogTitle.vue_vue_type_script_setup_true_lang-DhX_PnJg.js";import"./search-DMAgT1ax.js";import"./history-BhWvCUg_.js";import"./trash-2-DQa6t8J6.js";import"./plus-qvDwOpBM.js";import"./copy-8n_I0j-e.js";import"./SafeHtmlText.vue_vue_type_script_setup_true_lang-B4WJxQg3.js";import"./index-BWEDi_FC.js";import"./step-DrZ9DcYd.js";import"./DialogTitle.vue_vue_type_script_setup_true_lang-NwgvWXcM.js";import"./DialogFooter.vue_vue_type_script_setup_true_lang-C1v4zLaJ.js";import"./Label.vue_vue_type_script_setup_true_lang-untXYf29.js";import"./minus-CR3YqhFd.js";import"./list-C6u3NJnp.js";const ge={class:"flex flex-col gap-4 p-1"},ve={class:"p-1.5 rounded-lg bg-primary/10 text-primary"},he={class:"flex items-center gap-2"},xe={class:"space-y-3"},be={class:"flex items-center gap-2"},ye={class:"font-semibold"},_e={class:"text-[10px] opacity-70 font-normal"},we={key:0,class:"space-y-2"},Ce={class:"flex items-center justify-between w-full relative z-10"},ke={class:"flex items-center gap-2 text-primary"},Se={class:"space-y-1 relative z-10"},Te={class:"text-sm font-medium text-foreground"},$e={class:"text-[10px] text-muted-foreground line-clamp-2 leading-relaxed"},Ge={key:0,class:"p-4 rounded-xl bg-green-500/10 border border-green-500/20 space-y-3"},Ae={class:"flex items-center gap-2 text-green-600 dark:text-green-400"},Ie={class:"space-y-2"},We={class:"flex justify-between text-[10px] font-medium text-muted-foreground"},Pe={class:"grid grid-cols-2 gap-2 mt-2"},Le={class:"p-1.5 rounded-full bg-blue-500/10 text-blue-500"},je={class:"p-1.5 rounded-full bg-purple-500/10 text-purple-500"},ze={class:"p-1.5 rounded-full bg-orange-500/10 text-orange-500"},Be={class:"p-1.5 rounded-full bg-emerald-500/10 text-emerald-500"},Ne={class:"flex items-center gap-2"},Ee={class:"p-1 rounded-xl bg-muted/30 border border-border/50"},Fe=q({__name:"AISidebar",props:{project:{},chapter:{},isGenerating:{type:Boolean},selectedText:{},isLoadingSuggestions:{type:Boolean},showCitationHelper:{type:Boolean},chapterContent:{},cursorPosition:{},currentWordCount:{},targetWordCount:{}},emits:["startStreamingGeneration","getAISuggestions","update:showCitationHelper","insert-citation","checkCitations"],setup(H,{emit:D}){const o=H,u=D,_=y("Academic Formal"),i=y(null),m=y(!1),d=y({expand:!1,improve:!1,rephrase:!1,cite:!1,"generate-full":!1,"generate-section":!1}),w=p(()=>!!o.chapter?.id&&!!o.chapter?.chapter_number),A=p(()=>o.chapterContent&&o.chapterContent.trim().length>0),I=p(()=>!A.value&&w.value),R=p(()=>!i.value&&w.value),O=p(()=>!o.isGenerating&&!!o.chapterContent);p(()=>!o.isLoadingSuggestions&&!!o.selectedText);const C=p(()=>i.value&&i.value.section.name!=="NONE"?i.value.section.name.toLowerCase().replace(/\s+/g,"_"):V()),Q=p(()=>!o.isGenerating&&!!o.chapter?.id),W=()=>[{id:"introduction",name:"Introduction",description:"Overview and objectives of this chapter"},{id:"content",name:"Main Content",description:"Chapter main content"},{id:"conclusion",name:"Conclusion",description:"Summary and transition to next chapter"}],g=async(s,e)=>{if(Object.values(d.value).some(n=>n)){c("Please wait for the current action to complete");return}try{switch(s in d.value&&(d.value[s]=!0),s){case"expand":o.selectedText?(u("startStreamingGeneration","expand",{selectedText:o.selectedText}),c("Expanding selected text...")):c.error("Please select text to expand");break;case"improve":u("startStreamingGeneration","improve"),c("Improving chapter content...");break;case"rephrase":o.selectedText?(u("startStreamingGeneration","rephrase",{selectedText:o.selectedText,style:_.value}),c("Rephrasing selected text...")):c.error("Please select text to rephrase");break;case"cite":u("update:showCitationHelper",!0),c("Opening citation helper...");break;case"generate-full":u("startStreamingGeneration","progressive"),c("Generating complete chapter...");break;case"generate-section":const n=e?.section||C.value;u("startStreamingGeneration","section",{section:n,mode:"progressive"}),c(`Generating ${n} section...`);break;default:throw new Error(`Unknown action: ${s}`)}}catch(n){console.error(`Quick action '${s}' failed:`,n),c.error(`Failed to ${s.replace("-"," ")}. Please try again.`)}finally{setTimeout(()=>{s in d.value&&(d.value[s]=!1)},1e3)}},V=()=>{if(!A.value)return"introduction";const s=o.chapterContent.toLowerCase(),e=W();for(const n of e)if(![n.name.toLowerCase(),n.id.replace("_"," ")].some(Z=>s.includes(Z)))return n.id;return"conclusion"},P=s=>{const e=W();return e.find(n=>n.id===s)||e[0]},M=async()=>{if(m.value||!w.value)return;m.value=!0;const s=Date.now();try{const{data:e}=await J.post(`/api/projects/${o.project.id}/chapters/${o.chapter.id}/suggest-section?t=${Date.now()}`,{current_content:o.chapterContent||""}),n=Date.now()-s,k=Math.max(0,800-n);if(k>0&&await new Promise(h=>setTimeout(h,k)),e.success&&e.analysis){if(i.value=e.analysis,i.value.word_count_progress&&o.currentWordCount!==void 0){const h=o.targetWordCount||i.value.word_count_progress.target;i.value.word_count_progress.current=o.currentWordCount,i.value.word_count_progress.percentage=h>0?Math.round(o.currentWordCount/h*100*100)/100:0}console.log("âœ… Fresh chapter analysis complete:",{status:e.analysis.status,completion:e.analysis.completion_percentage,wordProgress:i.value.word_count_progress,usingLiveWordCount:o.currentWordCount!==void 0,usingStructuredData:e.structured||!0,cached:!1}),c.success("Chapter analyzed successfully")}else c.error("Failed to analyze chapter")}catch(e){console.error("Chapter analysis failed:",e),c.error("Failed to analyze chapter. Please try again.")}finally{m.value=!1}},U=s=>{u("insert-citation",s)};return L(()=>o.chapter,s=>{s?.id&&(i.value=null)},{immediate:!1}),L(()=>o.chapterContent,s=>{i.value&&(!s||s.trim().length===0)&&(i.value=null)},{immediate:!1}),(s,e)=>(v(),S("div",ge,[a(r(ee),{class:"border-none shadow-none bg-transparent"},{default:l(()=>[a(r(te),{class:"px-2 py-3"},{default:l(()=>[a(r(ae),{class:"flex items-center gap-2 text-sm font-semibold text-foreground/80"},{default:l(()=>[t("div",ve,[a(r(N),{class:"h-4 w-4"})]),e[8]||(e[8]=T(" AI Assistant ",-1))]),_:1})]),_:1}),a(r(X),{class:"px-2 space-y-6"},{default:l(()=>[a(r(j),{open:!0,class:"space-y-2"},{default:l(()=>[a(r(z),{class:"flex w-full items-center justify-between text-xs font-medium text-muted-foreground hover:text-foreground transition-colors group"},{default:l(()=>[t("span",he,[a(r(ne),{class:"h-3.5 w-3.5 text-amber-500/70 group-hover:text-amber-500 transition-colors"}),e[9]||(e[9]=T(" QUICK ACTIONS ",-1))]),a(r(E),{class:"h-3 w-3 transition-transform duration-200 group-data-[state=open]:rotate-180"})]),_:1}),a(r(B),{class:"space-y-3 pt-1"},{default:l(()=>[t("div",xe,[R.value?(v(),$(r(f),{key:0,onClick:M,disabled:s.isGenerating||m.value,class:"w-full h-auto flex-col gap-1.5 p-4 rounded-xl bg-gradient-to-br from-primary/10 via-primary/5 to-transparent border border-primary/10 hover:border-primary/30 text-primary hover:from-primary/15 transition-all duration-300 shadow-sm"},{default:l(()=>[t("div",be,[a(r(N),{class:"h-4 w-4"}),t("span",ye,b(m.value?"Analyzing...":I.value?"Start Writing":"Analyze Chapter"),1)]),t("span",_e,b(I.value?"Get AI suggestions to begin":"Generate next steps & suggestions"),1)]),_:1},8,["disabled"])):x("",!0),a(G,{"enter-active-class":"transition-all duration-300 ease-out","enter-from-class":"opacity-0 scale-95 translate-y-1","enter-to-class":"opacity-100 scale-100 translate-y-0"},{default:l(()=>[i.value&&i.value.show_section_button?(v(),S("div",we,[a(r(f),{onClick:e[0]||(e[0]=n=>g("generate-section")),disabled:!Q.value||m.value||s.isGenerating||d.value["generate-section"],variant:"outline",class:"w-full h-auto flex-col items-start gap-2 p-3 rounded-xl border-primary/20 bg-background/50 hover:bg-primary/5 hover:border-primary/40 transition-all duration-300 text-left group relative overflow-hidden"},{default:l(()=>[e[11]||(e[11]=t("div",{class:"absolute inset-0 bg-gradient-to-r from-primary/5 to-transparent opacity-0 group-hover:opacity-100 transition-opacity"},null,-1)),t("div",Ce,[t("div",ke,[a(r(F),{class:"h-3.5 w-3.5"}),e[10]||(e[10]=t("span",{class:"text-xs font-semibold"},"Write Next Section",-1))]),d.value["generate-section"]?(v(),$(r(ie),{key:0,class:"h-3 w-3 animate-spin text-primary"})):x("",!0)]),t("div",Se,[t("div",Te,b(i.value?.section.name||P(C.value).name),1),t("div",$e,b(i.value?.section.description||P(C.value).description),1)])]),_:1},8,["disabled"])])):x("",!0)]),_:1}),a(G,{"enter-active-class":"transition-all duration-300 ease-out","enter-from-class":"opacity-0 scale-95 translate-y-1","enter-to-class":"opacity-100 scale-100 translate-y-0"},{default:l(()=>[i.value&&i.value.show_full_chapter_button?(v(),$(r(f),{key:0,onClick:e[1]||(e[1]=n=>g("generate-full")),disabled:s.isGenerating||m.value||d.value["generate-full"],variant:"ghost",class:"w-full h-9 justify-start gap-2 px-3 rounded-lg text-xs text-muted-foreground hover:text-primary hover:bg-primary/5"},{default:l(()=>[a(r(le),{class:"h-3.5 w-3.5"}),e[12]||(e[12]=t("span",null,"Generate Complete Chapter",-1))]),_:1},8,["disabled"])):x("",!0)]),_:1}),a(G,{"enter-active-class":"transition-all duration-500 ease-out","enter-from-class":"opacity-0 scale-95 translate-y-2","enter-to-class":"opacity-100 scale-100 translate-y-0"},{default:l(()=>[i.value&&i.value.status==="COMPLETE"?(v(),S("div",Ge,[t("div",Ae,[a(r(ce),{class:"h-4 w-4"}),e[13]||(e[13]=t("span",{class:"text-sm font-semibold"},"Chapter Complete",-1))]),t("div",Ie,[t("div",We,[e[14]||(e[14]=t("span",null,"Progress",-1)),t("span",null,b(i.value.completion_percentage)+"%",1)]),a(r(re),{"model-value":i.value.completion_percentage,class:"h-1.5"},null,8,["model-value"])])])):x("",!0)]),_:1})]),t("div",Pe,[a(r(f),{onClick:e[2]||(e[2]=n=>g("improve")),disabled:!O.value||s.isGenerating||d.value.improve,variant:"outline",class:"h-20 flex-col gap-2 rounded-xl border-border/50 bg-background/50 hover:bg-accent hover:border-accent transition-all duration-300"},{default:l(()=>[t("div",Le,[a(r(de),{class:"h-4 w-4"})]),e[15]||(e[15]=t("span",{class:"text-xs font-medium"},"Improve",-1))]),_:1},8,["disabled"]),a(r(f),{onClick:e[3]||(e[3]=n=>g("expand")),disabled:!s.selectedText||s.isGenerating||d.value.expand,variant:"outline",class:"h-20 flex-col gap-2 rounded-xl border-border/50 bg-background/50 hover:bg-accent hover:border-accent transition-all duration-300"},{default:l(()=>[t("div",je,[a(r(ue),{class:"h-4 w-4"})]),e[16]||(e[16]=t("span",{class:"text-xs font-medium"},"Expand",-1))]),_:1},8,["disabled"]),a(r(f),{onClick:e[4]||(e[4]=n=>g("cite")),disabled:s.isGenerating||d.value.cite,variant:"outline",class:"h-20 flex-col gap-2 rounded-xl border-border/50 bg-background/50 hover:bg-accent hover:border-accent transition-all duration-300"},{default:l(()=>[t("div",ze,[a(r(pe),{class:"h-4 w-4"})]),e[17]||(e[17]=t("span",{class:"text-xs font-medium"},"Cite",-1))]),_:1},8,["disabled"]),a(r(f),{onClick:e[5]||(e[5]=n=>g("rephrase")),disabled:!s.selectedText||s.isGenerating||d.value.rephrase,variant:"outline",class:"h-20 flex-col gap-2 rounded-xl border-border/50 bg-background/50 hover:bg-accent hover:border-accent transition-all duration-300"},{default:l(()=>[t("div",Be,[a(r(me),{class:"h-4 w-4"})]),e[18]||(e[18]=t("span",{class:"text-xs font-medium"},"Rephrase",-1))]),_:1},8,["disabled"])])]),_:1})]),_:1}),a(r(se),{class:"bg-border/50"}),a(r(j),{open:!0,class:"space-y-2"},{default:l(()=>[a(r(z),{class:"flex w-full items-center justify-between text-xs font-medium text-muted-foreground hover:text-foreground transition-colors group"},{default:l(()=>[t("span",Ne,[a(r(F),{class:"h-3.5 w-3.5 text-indigo-500/70 group-hover:text-indigo-500 transition-colors"}),e[19]||(e[19]=T(" WRITING STYLE ",-1))]),a(r(E),{class:"h-3 w-3 transition-transform duration-200 group-data-[state=open]:rotate-180"})]),_:1}),a(r(B),{class:"pt-1"},{default:l(()=>[t("div",Ee,[K(t("select",{"onUpdate:modelValue":e[6]||(e[6]=n=>_.value=n),class:"w-full bg-transparent border-none text-xs font-medium focus:ring-0 cursor-pointer py-1.5 px-2"},[...e[20]||(e[20]=[t("option",{value:"Academic Formal"},"Academic Formal",-1),t("option",{value:"Academic Casual"},"Academic Casual",-1),t("option",{value:"Technical"},"Technical",-1),t("option",{value:"Analytical"},"Analytical",-1),t("option",{value:"Research-Heavy"},"Research-Heavy",-1)])],512),[[Y,_.value]])])]),_:1})]),_:1})]),_:1})]),_:1}),a(oe,{"show-citation-helper":s.showCitationHelper,"chapter-content":s.chapterContent,"onUpdate:showCitationHelper":e[7]||(e[7]=n=>u("update:showCitationHelper",n)),onInsertCitation:U},null,8,["show-citation-helper","chapter-content"])]))}}),It=fe(Fe,[["__scopeId","data-v-03da2601"]]);export{It as default};
