import{bt as We,bs as h,ck as B,bA as Oe,cQ as Ft,cn as de,co as z,cp as l,cr as d,cB as I,cG as P,cu as w,ct as V,bE as t,eQ as Wt,eR as Nt,eS as qt,c_ as pe,ci as le,bB as tt,cq as a,cw as Ke,dv as jt,cx as Xt,eT as at,eU as Gt,cR as Fe,cM as rt,eV as nt,eW as ot,cs as b,cO as st,dV as Yt,cb as lt,aO as it,aP as dt,bN as Kt,bM as Qt,eX as Jt,bD as Be,eY as Zt,eZ as ea,e_ as ta,e$ as aa,f0 as ra,dM as na,f1 as oa,f2 as sa,f3 as la,f4 as ia,f5 as da,f6 as ua,f7 as ca,cN as ga,f8 as fa,dO as ma,f9 as pa,fa as va,fb as ha,fc as xa,cF as ba,dg as wa,fd as ya,fe as ka}from"./vendor-CugNIqr3.js";import{N as ut,a as ct,V as gt,m as ft,E as mt,i as Ca,b as za,c as Ta,d as Aa,T as Ma,C as Sa,H as La,L as _a,e as $a,f as Ea,g as Ra,h as Ha,M as Ia,j as Va,u as Da,k as Pa}from"./vendor-tiptap-BY1aFJq1.js";import{_ as Ua}from"./Progress.vue_vue_type_script_setup_true_lang-CrvPUv9L.js";import{_ as Ne}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{M as Ba}from"./MermaidExtension-D_RXIhuX.js";import{_ as v}from"./index-Ia6CVdS0.js";import{_ as ie}from"./Input.vue_vue_type_script_setup_true_lang-ASyfdFt6.js";import{_ as Le,a as _e}from"./DialogContent.vue_vue_type_script_setup_true_lang-CJcqQR4M.js";import{_ as $e}from"./DialogDescription.vue_vue_type_script_setup_true_lang-B73YHsAb.js";import{_ as Ee}from"./DialogFooter.vue_vue_type_script_setup_true_lang-DOvydC-g.js";import{_ as Re,a as He}from"./DialogTitle.vue_vue_type_script_setup_true_lang-DUiYGDJZ.js";import{_ as me}from"./Label.vue_vue_type_script_setup_true_lang-BAVAvlHZ.js";import{_ as Qe,a as Je,c as N,d as Se,e as Ze}from"./Sonner.vue_vue_type_script_setup_true_lang-DLPHW2_2.js";const Oa={class:"space-y-2"},Fa={class:"font-semibold text-sm"},Wa={key:0,class:"text-xs text-gray-600 dark:text-gray-300"},Na={class:"flex items-center space-x-2 text-xs"},qa={key:0,class:"text-gray-500"},ja={key:1,class:"text-xs text-blue-600 dark:text-blue-400"},Xa={class:"flex space-x-2 pt-2 border-t"},Ga=We({__name:"CitationNodeView",props:{node:{type:Object,required:!0},editor:{type:Object,required:!0},getPos:{type:Function,required:!0},updateAttributes:{type:Function,required:!0}},emits:["verify","edit","remove"],setup(i,{emit:s}){const f=i,k=s,m=h(!1),T=h({top:"0px",left:"0px"}),U=B(()=>f.node.attrs.text||"[Citation]"),C=B(()=>f.node.attrs.verified===!1&&f.node.attrs.confidence<.8),M=B(()=>({"citation-verified":f.node.attrs.verified,"citation-unverified":C.value,"citation-pending":!f.node.attrs.verified&&!C.value})),S=B(()=>f.node.attrs.verified?"bg-green-100 dark:bg-green-900 text-green-800 dark:text-green-200 border border-green-300 dark:border-green-700":C.value?"bg-red-100 dark:bg-red-900 text-red-800 dark:text-red-200 border border-red-300 dark:border-red-700":"bg-yellow-100 dark:bg-yellow-900 text-yellow-800 dark:text-yellow-200 border border-yellow-300 dark:border-yellow-700"),O=B(()=>f.node.attrs.verified?"text-green-600 dark:text-green-400":C.value?"text-red-600 dark:text-red-400":"text-yellow-600 dark:text-yellow-400"),F=B(()=>f.node.attrs.verified?"Verified":C.value?"Needs Review":"Pending"),G=B(()=>f.node.attrs.verified?"bg-green-100 dark:bg-green-900 text-green-800 dark:text-green-200":C.value?"bg-red-100 dark:bg-red-900 text-red-800 dark:text-red-200":"bg-yellow-100 dark:bg-yellow-900 text-yellow-800 dark:text-yellow-200"),W=y=>{if(y.stopPropagation(),m.value)$();else{const ue=y.target.getBoundingClientRect();T.value={top:`${ue.height+5}px`,left:"0px"},m.value=!0}},$=()=>{m.value=!1},ae=async()=>{try{const y=await axios.post("/api/citations/verify",{citation_id:f.node.attrs.id,citation_text:f.node.attrs.text});y.data.verified&&f.updateAttributes({verified:!0,confidence:y.data.confidence,data:y.data.citation,doi:y.data.citation.doi}),k("verify",y.data),$()}catch(y){console.error("Failed to verify citation:",y)}},Y=()=>{k("edit",{id:f.node.attrs.id,text:f.node.attrs.text,attributes:f.node.attrs}),$()},n=()=>{if(confirm("Are you sure you want to remove this citation?")){const y=f.getPos();f.editor.commands.deleteRange({from:y,to:y+1}),k("remove",f.node.attrs.id)}$()},re=y=>{y.key==="Enter"||y.key===" "?(y.preventDefault(),W(y)):y.key==="Escape"&&$()};return Oe(()=>{document.addEventListener("keydown",re)}),Ft(()=>{document.removeEventListener("keydown",re)}),(y,ue)=>(z(),de(t(ut),{class:w(["citation-node inline-block relative cursor-pointer",M.value]),onClick:W},{default:l(()=>[d("span",{class:w(["citation-text px-2 py-1 rounded text-sm font-medium transition-all duration-200",S.value])},V(U.value),3),d("span",{class:w(["verification-indicator ml-1",O.value])},[i.node.attrs.verified?(z(),de(t(Wt),{key:0,class:"w-3 h-3"})):C.value?(z(),de(t(Nt),{key:1,class:"w-3 h-3"})):(z(),de(t(qt),{key:2,class:"w-3 h-3"}))],2),m.value?(z(),I("div",{key:0,class:"citation-popover absolute z-50 mt-2 p-4 bg-white dark:bg-gray-800 rounded-lg shadow-lg border max-w-sm",style:pe(T.value)},[d("div",Oa,[d("div",Fa,V(i.node.attrs.text||"[Citation]"),1),i.node.attrs.data&&i.node.attrs.data.title?(z(),I("div",Wa,V(i.node.attrs.data.title),1)):P("",!0),d("div",Na,[d("span",{class:w(["px-2 py-1 rounded",G.value])},V(F.value),3),i.node.attrs.confidence?(z(),I("span",qa,V(Math.round(i.node.attrs.confidence*100))+"% confidence ",1)):P("",!0)]),i.node.attrs.doi?(z(),I("div",ja," DOI: "+V(i.node.attrs.doi),1)):P("",!0),d("div",Xa,[i.node.attrs.verified?P("",!0):(z(),I("button",{key:0,onClick:ae,class:"text-xs px-2 py-1 bg-blue-600 text-white rounded hover:bg-blue-700"}," Verify ")),d("button",{onClick:Y,class:"text-xs px-2 py-1 bg-gray-600 text-white rounded hover:bg-gray-700"}," Edit "),d("button",{onClick:n,class:"text-xs px-2 py-1 bg-red-600 text-white rounded hover:bg-red-700"}," Remove ")])])],4)):P("",!0),m.value?(z(),I("div",{key:1,class:"fixed inset-0 z-40",onClick:$})):P("",!0)]),_:1},8,["class"]))}}),Ya=Ne(Ga,[["__scopeId","data-v-4fc4981e"]]),Ka=ct.create({name:"citation",group:"inline",inline:!0,atom:!0,addAttributes(){return{id:{default:null},text:{default:""},verified:{default:!1},confidence:{default:0},format:{default:"apa"},doi:{default:null},data:{default:{}}}},parseHTML(){return[{tag:"span[data-citation]"}]},renderHTML({HTMLAttributes:i}){return["span",ft(i,{"data-citation":""})]},addNodeView(){return gt(Ya)},addCommands(){return{insertCitation:i=>({commands:s})=>s.insertContent({type:this.name,attrs:i}),updateCitation:(i,s)=>({state:f,dispatch:k})=>{const{doc:m,tr:T}=f;let U=!1;return m.descendants((C,M)=>{if(C.type.name===this.name&&C.attrs.id===i)return T.setNodeMarkup(M,null,{...C.attrs,...s}),U=!0,!1}),U?(k(T),!0):!1}}},addKeyboardShortcuts(){return{"Mod-Shift-c":()=>this.editor.commands.insertCitation({text:"[Citation]",verified:!1})}}}),Qa={class:"text-muted-foreground text-xs mt-1 truncate max-w-full"},Ja=["src","alt","title"],Za={key:2,class:"mt-2 w-full"},er={key:3,class:"mt-2 text-center text-sm text-muted-foreground italic"},tr={key:5,class:"absolute -top-12 left-1/2 -translate-x-1/2 flex items-center gap-1.5 px-3 py-1.5 bg-background/95 backdrop-blur-md rounded-lg border border-border shadow-lg z-10 min-w-max"},ar={class:"text-xs text-muted-foreground whitespace-nowrap"},rr={class:"grid gap-4 py-4"},nr={class:"grid gap-2"},or={class:"grid gap-2"},sr=We({__name:"ImageNodeView",props:{node:{},updateAttributes:{type:Function},deleteNode:{type:Function},selected:{type:Boolean},editor:{}},setup(i){const s=i,f=h(null),k=h(null),m=h(!1),T=h(null),U=h(0),C=h(0),M=h(0),S=h(0),O=h(s.node.attrs.width||400),F=h(s.node.attrs.height||300),G=h(!0),W=h(!1),$=h(!1),ae=h(""),Y=h(""),n=h(s.node.attrs.caption||""),re=B(()=>{switch(s.node.attrs.alignment){case"left":return"mr-auto";case"right":return"ml-auto";default:return"mx-auto"}}),y=B(()=>({width:`${O.value}px`,height:`${F.value}px`,maxWidth:"100%"})),ue=()=>{if(G.value=!1,W.value=!1,f.value&&!s.node.attrs.width){const p=f.value.naturalWidth,o=f.value.naturalHeight,g=600;if(p>g){const q=g/p;O.value=g,F.value=Math.round(o*q)}else O.value=p,F.value=o;s.updateAttributes({width:O.value,height:F.value,aspectRatio:p/o})}},ve=()=>{G.value=!1,W.value=!0},L=(p,o)=>{if(!s.selected)return;o.preventDefault(),o.stopPropagation(),m.value=!0,T.value=p;const g="touches"in o?o.touches[0].clientX:o.clientX,q="touches"in o?o.touches[0].clientY:o.clientY;U.value=g,C.value=q,M.value=O.value,S.value=F.value,document.addEventListener("mousemove",K),document.addEventListener("mouseup",Q),document.addEventListener("touchmove",K),document.addEventListener("touchend",Q)},K=p=>{if(!m.value)return;const o="touches"in p?p.touches[0].clientX:p.clientX,g="touches"in p?p.touches[0].clientY:p.clientY,q=o-U.value,J=g-C.value,Z=s.node.attrs.aspectRatio||M.value/S.value,ne=T.value;let X=M.value,ee=S.value;ne?.includes("e")&&(X=Math.max(100,M.value+q)),ne?.includes("w")&&(X=Math.max(100,M.value-q)),ne?.includes("s")&&(ee=Math.max(100,S.value+J)),ne?.includes("n")&&(ee=Math.max(100,S.value-J)),ne?.length===2&&(Math.abs(q)>Math.abs(J)?ee=Math.round(X/Z):X=Math.round(ee*Z));const Ce=800;X>Ce&&(X=Ce,ee=Math.round(X/Z)),O.value=X,F.value=ee},Q=()=>{m.value&&(m.value=!1,T.value=null,s.updateAttributes({width:O.value,height:F.value}),document.removeEventListener("mousemove",K),document.removeEventListener("mouseup",Q),document.removeEventListener("touchmove",K),document.removeEventListener("touchend",Q))},he=p=>{s.updateAttributes({alignment:p})},Ie=()=>{ae.value=s.node.attrs.alt||"",Y.value=s.node.attrs.title||"",$.value=!0},Ve=()=>{s.updateAttributes({alt:ae.value,title:Y.value}),$.value=!1},ke=()=>{s.updateAttributes({caption:n.value})},De=async()=>{const p=s.node.attrs.src;if(p&&p.startsWith("/storage/"))try{await lt.delete("/editor/images",{data:{url:p}})}catch(o){console.warn("Failed to delete image from storage:",o)}s.deleteNode()};return le(()=>s.node.attrs.caption,p=>{p!==n.value&&(n.value=p||"")}),le(()=>[s.node.attrs.width,s.node.attrs.height],([p,o])=>{p&&!m.value&&(O.value=p),o&&!m.value&&(F.value=o)},{immediate:!0}),tt(()=>{document.removeEventListener("mousemove",K),document.removeEventListener("mouseup",Q),document.removeEventListener("touchmove",K),document.removeEventListener("touchend",Q)}),(p,o)=>(z(),de(t(ut),{class:"resizable-image-wrapper my-4"},{default:l(()=>[d("figure",{ref_key:"containerRef",ref:k,class:w(["relative inline-block",[re.value,{"ring-2 ring-primary ring-offset-2":p.selected}]])},[G.value?(z(),I("div",{key:0,class:"flex items-center justify-center bg-muted/50 rounded-lg",style:pe(y.value)},[a(t(jt),{class:"w-8 h-8 animate-spin text-muted-foreground"})],4)):W.value?(z(),I("div",{key:1,class:"flex flex-col items-center justify-center bg-destructive/10 border border-destructive/30 rounded-lg p-4",style:pe(y.value)},[o[24]||(o[24]=d("span",{class:"text-destructive text-sm"},"Failed to load image",-1)),d("span",Qa,V(p.node.attrs.src),1)],4)):P("",!0),Ke(d("img",{ref_key:"imageRef",ref:f,src:p.node.attrs.src,alt:p.node.attrs.alt,title:p.node.attrs.title,style:pe(y.value),class:w(["block rounded-lg object-contain",{"cursor-move":p.selected}]),onLoad:ue,onError:ve,draggable:"false"},null,46,Ja),[[Xt,!G.value&&!W.value]]),p.selected&&!W.value?(z(),I("div",Za,[Ke(d("input",{"onUpdate:modelValue":o[0]||(o[0]=g=>n.value=g),type:"text",placeholder:"Add a caption...",class:"w-full text-center text-sm text-muted-foreground bg-transparent border-none focus:outline-none focus:ring-0 placeholder:text-muted-foreground/50",onBlur:ke,onKeydown:at(ke,["enter"])},null,544),[[Gt,n.value]])])):p.node.attrs.caption&&!W.value?(z(),I("figcaption",er,V(p.node.attrs.caption),1)):P("",!0),p.selected&&!W.value&&!G.value?(z(),I(Fe,{key:4},[d("div",{class:"absolute -top-1.5 -left-1.5 w-3 h-3 bg-primary border-2 border-background rounded-full cursor-nw-resize z-20 hover:scale-125 transition-transform",onMousedown:o[1]||(o[1]=g=>L("nw",g)),onTouchstart:o[2]||(o[2]=g=>L("nw",g))},null,32),d("div",{class:"absolute -top-1.5 -right-1.5 w-3 h-3 bg-primary border-2 border-background rounded-full cursor-ne-resize z-20 hover:scale-125 transition-transform",onMousedown:o[3]||(o[3]=g=>L("ne",g)),onTouchstart:o[4]||(o[4]=g=>L("ne",g))},null,32),d("div",{class:"absolute -bottom-1.5 -left-1.5 w-3 h-3 bg-primary border-2 border-background rounded-full cursor-sw-resize z-20 hover:scale-125 transition-transform",onMousedown:o[5]||(o[5]=g=>L("sw",g)),onTouchstart:o[6]||(o[6]=g=>L("sw",g))},null,32),d("div",{class:"absolute -bottom-1.5 -right-1.5 w-3 h-3 bg-primary border-2 border-background rounded-full cursor-se-resize z-20 hover:scale-125 transition-transform",onMousedown:o[7]||(o[7]=g=>L("se",g)),onTouchstart:o[8]||(o[8]=g=>L("se",g))},null,32),d("div",{class:"absolute top-1/2 -left-1.5 w-3 h-3 bg-primary border-2 border-background rounded-full cursor-w-resize z-20 -translate-y-1/2 hover:scale-125 transition-transform",onMousedown:o[9]||(o[9]=g=>L("w",g)),onTouchstart:o[10]||(o[10]=g=>L("w",g))},null,32),d("div",{class:"absolute top-1/2 -right-1.5 w-3 h-3 bg-primary border-2 border-background rounded-full cursor-e-resize z-20 -translate-y-1/2 hover:scale-125 transition-transform",onMousedown:o[11]||(o[11]=g=>L("e",g)),onTouchstart:o[12]||(o[12]=g=>L("e",g))},null,32),d("div",{class:"absolute -top-1.5 left-1/2 w-3 h-3 bg-primary border-2 border-background rounded-full cursor-n-resize z-20 -translate-x-1/2 hover:scale-125 transition-transform",onMousedown:o[13]||(o[13]=g=>L("n",g)),onTouchstart:o[14]||(o[14]=g=>L("n",g))},null,32),d("div",{class:"absolute -bottom-1.5 left-1/2 w-3 h-3 bg-primary border-2 border-background rounded-full cursor-s-resize z-20 -translate-x-1/2 hover:scale-125 transition-transform",onMousedown:o[15]||(o[15]=g=>L("s",g)),onTouchstart:o[16]||(o[16]=g=>L("s",g))},null,32)],64)):P("",!0),p.selected?(z(),I("div",tr,[W.value?P("",!0):(z(),I(Fe,{key:0},[a(t(v),{variant:"ghost",size:"sm",class:w(["h-7 w-7 p-0",{"bg-primary/10 text-primary":p.node.attrs.alignment==="left"}]),onClick:o[17]||(o[17]=g=>he("left"))},{default:l(()=>[a(t(rt),{class:"w-4 h-4"})]),_:1},8,["class"]),a(t(v),{variant:"ghost",size:"sm",class:w(["h-7 w-7 p-0",{"bg-primary/10 text-primary":p.node.attrs.alignment==="center"}]),onClick:o[18]||(o[18]=g=>he("center"))},{default:l(()=>[a(t(nt),{class:"w-4 h-4"})]),_:1},8,["class"]),a(t(v),{variant:"ghost",size:"sm",class:w(["h-7 w-7 p-0",{"bg-primary/10 text-primary":p.node.attrs.alignment==="right"}]),onClick:o[19]||(o[19]=g=>he("right"))},{default:l(()=>[a(t(ot),{class:"w-4 h-4"})]),_:1},8,["class"]),o[26]||(o[26]=d("div",{class:"w-px h-5 bg-border mx-1"},null,-1)),a(t(v),{variant:"ghost",size:"sm",class:"h-7 px-2 text-xs gap-1",onClick:Ie},{default:l(()=>[a(t(st),{class:"w-3 h-3"}),o[25]||(o[25]=b(" Alt ",-1))]),_:1}),o[27]||(o[27]=d("div",{class:"w-px h-5 bg-border mx-1"},null,-1)),d("span",ar,V(Math.round(O.value))+" x "+V(Math.round(F.value)),1),o[28]||(o[28]=d("div",{class:"w-px h-5 bg-border mx-1"},null,-1))],64)),a(t(v),{variant:"ghost",size:"sm",class:"h-7 w-7 p-0 text-destructive hover:text-destructive",onClick:De},{default:l(()=>[a(t(Yt),{class:"w-4 h-4"})]),_:1})])):P("",!0)],2),a(t(Le),{open:$.value,"onUpdate:open":o[23]||(o[23]=g=>$.value=g)},{default:l(()=>[a(t(_e),null,{default:l(()=>[a(t(Re),null,{default:l(()=>[a(t(He),null,{default:l(()=>[...o[29]||(o[29]=[b("Image Properties",-1)])]),_:1}),a(t($e),null,{default:l(()=>[...o[30]||(o[30]=[b("Edit the alt text and title for this image.",-1)])]),_:1})]),_:1}),d("div",rr,[d("div",nr,[a(t(me),{for:"alt-text"},{default:l(()=>[...o[31]||(o[31]=[b("Alt Text",-1)])]),_:1}),a(t(ie),{id:"alt-text",modelValue:ae.value,"onUpdate:modelValue":o[20]||(o[20]=g=>ae.value=g),placeholder:"Describe this image for accessibility..."},null,8,["modelValue"]),o[32]||(o[32]=d("p",{class:"text-xs text-muted-foreground"}," Alt text helps screen readers describe the image to visually impaired users. ",-1))]),d("div",or,[a(t(me),{for:"title-text"},{default:l(()=>[...o[33]||(o[33]=[b("Title",-1)])]),_:1}),a(t(ie),{id:"title-text",modelValue:Y.value,"onUpdate:modelValue":o[21]||(o[21]=g=>Y.value=g),placeholder:"Optional title shown on hover..."},null,8,["modelValue"])])]),a(t(Ee),null,{default:l(()=>[a(t(v),{variant:"outline",onClick:o[22]||(o[22]=g=>$.value=!1)},{default:l(()=>[...o[34]||(o[34]=[b("Cancel",-1)])]),_:1}),a(t(v),{onClick:Ve},{default:l(()=>[...o[35]||(o[35]=[b("Save",-1)])]),_:1})]),_:1})]),_:1})]),_:1},8,["open"])]),_:1}))}}),lr=Ne(sr,[["__scopeId","data-v-bc29ad5b"]]),ir=ct.create({name:"resizableImage",group:"block",atom:!0,draggable:!0,addOptions(){return{HTMLAttributes:{class:"resizable-image-block"},maxWidth:800}},addAttributes(){return{src:{default:null,parseHTML:i=>i.querySelector("img")?.getAttribute("src")||i.getAttribute("src")},alt:{default:"",parseHTML:i=>i.querySelector("img")?.getAttribute("alt")||i.getAttribute("alt")||""},title:{default:"",parseHTML:i=>i.querySelector("img")?.getAttribute("title")||i.getAttribute("title")||""},width:{default:null,parseHTML:i=>{const f=i.querySelector("img")?.getAttribute("width")||i.getAttribute("data-width");return f?parseInt(f,10):null}},height:{default:null,parseHTML:i=>{const f=i.querySelector("img")?.getAttribute("height")||i.getAttribute("data-height");return f?parseInt(f,10):null}},alignment:{default:"center",parseHTML:i=>i.getAttribute("data-alignment")||"center"},aspectRatio:{default:null,parseHTML:i=>{const s=i.getAttribute("data-aspect-ratio");return s?parseFloat(s):null}},caption:{default:"",parseHTML:i=>i.querySelector("figcaption")?.textContent||i.getAttribute("data-caption")||""}}},parseHTML(){return[{tag:"figure[data-resizable-image]"},{tag:"div[data-resizable-image]"},{tag:"img[src]",getAttrs:i=>{if(typeof i=="string")return!1;const s=i;return{src:s.getAttribute("src"),alt:s.getAttribute("alt"),title:s.getAttribute("title"),width:s.getAttribute("width")?parseInt(s.getAttribute("width"),10):null,height:s.getAttribute("height")?parseInt(s.getAttribute("height"),10):null}}}]},renderHTML({HTMLAttributes:i,node:s}){const f=ft(this.options.HTMLAttributes,{"data-resizable-image":"","data-alignment":s.attrs.alignment,"data-width":s.attrs.width,"data-height":s.attrs.height,"data-aspect-ratio":s.attrs.aspectRatio,"data-caption":s.attrs.caption||""}),k={src:i.src||s.attrs.src,alt:s.attrs.alt||"",title:s.attrs.title||""};s.attrs.width&&(k.width=s.attrs.width),s.attrs.height&&(k.height=s.attrs.height);const m=[["img",k]];return s.attrs.caption&&m.push(["figcaption",{},s.attrs.caption]),["figure",f,...m]},addNodeView(){return gt(lr)},addCommands(){return{setImage:i=>({commands:s})=>s.insertContent({type:this.name,attrs:{src:i.src,alt:i.alt||"",title:i.title||"",width:i.width||null,height:i.height||null,caption:i.caption||"",aspectRatio:i.width&&i.height?i.width/i.height:null}}),updateImageSize:i=>({commands:s})=>s.updateAttributes(this.name,{width:i.width,height:i.height}),setImageAlignment:i=>({commands:s})=>s.updateAttributes(this.name,{alignment:i})}},addProseMirrorPlugins(){return[new it({key:new dt("resizableImageDropPaste"),props:{handleDrop:(i,s,f,k)=>{if(k||!s.dataTransfer?.files?.length)return!1;const m=s.dataTransfer.files[0];return m.type.startsWith("image/")?(s.preventDefault(),document.dispatchEvent(new CustomEvent("tiptap-image-drop",{detail:{file:m,view:i,pos:i.posAtCoords({left:s.clientX,top:s.clientY})}})),!0):!1},handlePaste:(i,s)=>{const f=s.clipboardData?.items;if(!f)return!1;for(const k of f)if(k.type.startsWith("image/")){s.preventDefault();const m=k.getAsFile();return m&&document.dispatchEvent(new CustomEvent("tiptap-image-paste",{detail:{file:m,view:i}})),!0}return!1}}})]}}),te=new dt("ghostText"),dr=mt.create({name:"ghostText",addOptions(){return{onManualTrigger:null,onAccepted:null,onDismissed:null}},addCommands(){return{setGhostText:({text:i,position:s,format:f})=>({tr:k,state:m,dispatch:T})=>{const U=typeof s=="number"?s:m.selection.to;return k.setMeta(te,{type:"set",text:i,format:f??"text",position:U}),T?.(k),!0},clearGhostText:()=>({tr:i,dispatch:s})=>(i.setMeta(te,{type:"clear"}),s?.(i),!0)}},addKeyboardShortcuts(){return{Tab:()=>{const i=te.getState(this.editor.state);if(!i?.isVisible||!i.text||!this.editor.state.selection.empty)return!1;const s=i.position,f=i.text;return this.editor.chain().focus().insertContentAt({from:s,to:s},f).command(({tr:k,dispatch:m})=>(k.setMeta(te,{type:"clear"}),m?.(k),!0)).run(),this.options.onAccepted?.(f),!0},Escape:()=>te.getState(this.editor.state)?.isVisible?(this.editor.commands.clearGhostText(),this.options.onDismissed?.(),!0):!1,"Mod-Space":()=>(this.options.onManualTrigger?.(),!0)}},addProseMirrorPlugins(){return[new it({key:te,state:{init:()=>({text:null,format:"text",position:0,isVisible:!1}),apply:(i,s)=>{const f=i.getMeta(te);return f?.type==="clear"?{text:null,format:"text",position:0,isVisible:!1}:f?.type==="set"?{text:f.text,format:f.format,position:f.position,isVisible:!0}:i.docChanged?(s.isVisible&&this.options.onDismissed?.(),{text:null,format:"text",position:0,isVisible:!1}):i.selectionSet&&s.isVisible?(this.options.onDismissed?.(),{text:null,format:"text",position:0,isVisible:!1}):s}},props:{decorations:i=>{const s=te.getState(i);if(!s?.isVisible||!s.text)return null;const f=Math.min(Math.max(0,s.position),i.doc.content.size),k=Kt.widget(f,()=>{const m=document.createElement("span");if(m.className="tiptap-ghost-text",s.format==="html"&&s.text.includes("<")){const T=document.createElement("div");T.innerHTML=s.text,m.textContent=(T.textContent||"").trim()}else m.textContent=s.text??"";return m},{side:1});return Qt.create(i.doc,[k])}}})]}}),ur={class:"relative flex flex-col w-full h-full group bg-background"},cr={class:"flex items-center gap-0.5 border-r border-border/40 pr-1.5 mr-1.5 flex-shrink-0"},gr={class:"flex items-center gap-0.5 border-r border-border/40 pr-1.5 mr-1.5 flex-shrink-0"},fr={class:"text-xs text-zinc-700 dark:text-zinc-100"},mr={class:"flex items-center gap-0.5"},pr={class:"flex h-8 w-9 items-center justify-center border-y border-border/20 bg-muted/20 text-xs font-medium text-foreground"},vr={class:"flex items-center gap-0.5 border-r border-border/40 pr-1.5 mr-1.5 flex-shrink-0"},hr={class:"flex items-center gap-0.5 border-r border-border/40 pr-1.5 mr-1.5 flex-shrink-0"},xr={class:"flex items-center gap-0.5 border-l border-border/20 ml-0.5 pl-0.5"},br={class:"flex items-center gap-0.5 flex-shrink-0"},wr={class:"relative flex-1 min-h-0"},yr={key:0,class:"absolute top-4 left-1/2 -translate-x-1/2 z-20 pointer-events-none"},kr={class:"flex items-center gap-3 pl-3 pr-4 py-2 bg-indigo-950/90 text-white dark:bg-indigo-500/10 dark:text-indigo-100 dark:border-indigo-400/20 backdrop-blur-md border border-indigo-200/20 rounded-full shadow-[0_8px_32px_rgba(79,70,229,0.25)] pointer-events-auto ring-1 ring-white/10"},Cr={class:"relative flex items-center justify-center w-5 h-5"},zr={class:"flex flex-col gap-0.5 min-w-[140px]"},Tr={class:"flex items-center justify-between gap-4"},Ar={class:"text-[11px] font-semibold tracking-wide uppercase text-indigo-100/90 dark:text-indigo-200"},Mr={class:"text-[10px] font-mono tabular-nums opacity-80"},Sr={class:"h-1 w-full bg-indigo-900/50 dark:bg-indigo-950/50 rounded-full overflow-hidden"},Lr={class:"flex flex-col items-end"},_r={class:"text-xs font-bold font-mono tracking-tight leading-none text-white dark:text-indigo-50"},$r={class:"grid gap-4 py-4"},Er={class:"grid gap-2"},Rr={class:"grid gap-2"},Hr={class:"grid gap-4 py-4"},Ir={class:"flex items-center gap-4"},Vr={class:"flex flex-wrap gap-2"},Dr=["onClick"],Pr={class:"grid gap-4 py-4"},Ur={class:"grid gap-2"},Br={class:"flex items-center gap-2"},Or={key:1,class:"text-sm text-destructive"},Fr={class:"grid gap-2"},Wr={class:"flex gap-2"},et=300,Nr=We({__name:"RichTextEditor",props:{modelValue:{},placeholder:{default:"Start writing..."},readonly:{type:Boolean,default:!1},minHeight:{default:"200px"},showToolbar:{type:Boolean,default:!0},toolbarTeleportTarget:{default:""},isGenerating:{type:Boolean,default:!1},generationProgress:{default:""},generationPercentage:{default:0},generationPhase:{default:""},streamingMode:{type:Boolean,default:!1},ghostText:{default:null},ghostTextFormat:{default:"text"},ghostTextPosition:{default:null}},emits:["update:modelValue","update:selectedText","update:selectionRange","ghost-manual-trigger","ghost-accepted","ghost-dismissed"],setup(i,{expose:s,emit:f}){const k=Jt(ka),m=i,T=h(!1),U=h(0),C=h(""),M=h(null),S=f,O=mt.create({name:"fontSize",addOptions(){return{types:["textStyle"]}},addGlobalAttributes(){return[{types:this.options.types,attributes:{fontSize:{default:null,parseHTML:r=>{const e=r.style.fontSize;return e||null},renderHTML:r=>r.fontSize?{style:`font-size: ${r.fontSize}`}:{}}}}]},addCommands(){return{setFontSize:r=>({chain:e})=>e().setMark("textStyle",{fontSize:r}).run(),unsetFontSize:()=>({chain:r})=>r().setMark("textStyle",{fontSize:null}).removeEmptyTextStyle().run()}}}),F=r=>{if(!r)return"";const e=r.split(`
`);let u=[],c=0;for(;c<e.length;){const _=e[c];if(_.includes("|")){const E=G(e,c);if(E.html){u.push(E.html),c=E.nextIndex;continue}}u.push(_),c++}return u.join(`
`)},G=(r,e)=>{let u=r[e];if(!u||!u.includes("|"))return{html:null,nextIndex:e+1};const c=u.split("|").map(R=>R.trim()).filter(R=>R.length>0);if(c.length===0)return{html:null,nextIndex:e+1};const _=r[e+1];if(!_||!_.includes("|")||!_.includes("-"))return{html:null,nextIndex:e+1};let E=[],x=e+2;for(;x<r.length;){const R=r[x];if(!R||!R.includes("|"))break;const D=R.split("|").map(H=>H.trim()).filter(H=>H.length>0);D.length>0&&E.push(D),x++}let A='<div class="tableWrapper"><table>';return A+="<thead><tr>",c.forEach(R=>{A+=`<th>${R}</th>`}),A+="</tr></thead>",E.length>0&&(A+="<tbody>",E.forEach(R=>{A+="<tr>";for(let D=0;D<c.length;D++){const H=R[D]||"";A+=`<td>${H}</td>`}A+="</tr>"}),A+="</tbody>"),A+="</table></div>",{html:A,nextIndex:x}},W=r=>r?(r=r.replace(/```(\w+)\n?([\s\S]*?)```/g,(e,u,c)=>`<pre><code class="language-${u}">${c.trim()}</code></pre>`),r=r.replace(/```\n?([\s\S]*?)```/g,(e,u)=>`<pre><code>${u.trim()}</code></pre>`),r):"",$=r=>{if(!r)return"";if(r.includes("<p>")||r.includes("<h1>")||r.includes("<h2>")||r.includes("<div>")||r.includes("<div "))return r;let e=r;const u=[];e=e.replace(/```mermaid\n?([\s\S]*?)```/g,(E,x)=>{const A=x.trim(),D=`<div data-mermaid data-mermaid-code="${A.replace(/&/g,"&amp;").replace(/"/g,"&quot;").replace(/</g,"&lt;").replace(/>/g,"&gt;")}" data-view-mode="diagram"><pre><code class="language-mermaid">${A}</code></pre></div>`,H=u.length;return u.push(D),`__MERMAID_PLACEHOLDER_${H}__`}),e=e.replace(/``mermaid\n?([\s\S]*?)``/g,(E,x)=>{const A=x.trim(),D=`<div data-mermaid data-mermaid-code="${A.replace(/&/g,"&amp;").replace(/"/g,"&quot;").replace(/</g,"&lt;").replace(/>/g,"&gt;")}" data-view-mode="diagram"><pre><code class="language-mermaid">${A}</code></pre></div>`,H=u.length;return u.push(D),`__MERMAID_PLACEHOLDER_${H}__`}),e=e.replace(/`mermaid\n([\s\S]*?)`/g,(E,x)=>{const A=x.trim(),D=`<div data-mermaid data-mermaid-code="${A.replace(/&/g,"&amp;").replace(/"/g,"&quot;").replace(/</g,"&lt;").replace(/>/g,"&gt;")}" data-view-mode="diagram"><pre><code class="language-mermaid">${A}</code></pre></div>`,H=u.length;return u.push(D),`__MERMAID_PLACEHOLDER_${H}__`}),e=W(e),e=e.replace(/^### (.*$)/gim,"<h3>$1</h3>"),e=e.replace(/^## (.*$)/gim,"<h2>$1</h2>"),e=e.replace(/^# (.*$)/gim,"<h1>$1</h1>"),e=e.replace(/\*\*(.*?)\*\*/g,"<strong>$1</strong>"),e=e.replace(/\*(.*?)\*/g,"<em>$1</em>"),e=e.replace(/`([^`]+)`/g,"<code>$1</code>"),e=F(e);let _=e.split(`

`).filter(E=>E.trim()).map(E=>{const x=E.trim();if(x.startsWith("<h1>")||x.startsWith("<h2>")||x.startsWith("<h3>")||x.startsWith("<div")||x.startsWith("<table")||x.startsWith("<pre")||x.startsWith("<ul")||x.startsWith("<ol")||x.startsWith("<blockquote")||x.startsWith("__MERMAID_PLACEHOLDER_"))return x;if(x.includes(`
`)&&(x.match(/^\d+\./)||x.match(/^-\s/)||x.match(/^\*\s/))){const R=x.split(`
`).map(D=>{const H=D.trim();return H.match(/^\d+\.\s/)?`<li>${H.replace(/^\d+\.\s/,"")}</li>`:H.match(/^[-*]\s/)?`<li>${H.replace(/^[-*]\s/,"")}</li>`:H}).filter(D=>D.startsWith("<li>"));return x.match(/^\d+\./)?`<ol>${R.join("")}</ol>`:`<ul>${R.join("")}</ul>`}return`<p>${x.replace(/\n/g,"<br>")}</p>`}).join("");return u.forEach((E,x)=>{_=_.replace(`__MERMAID_PLACEHOLDER_${x}__`,E)}),_},Y=[Ca.configure({heading:{levels:[1,2,3]},codeBlock:!1,link:!1}),za.configure({lowlight:k,HTMLAttributes:{class:"code-block-highlighted"}}),Ta.configure({placeholder:m.placeholder}),Aa,Ma,O,Sa,La.configure({multicolor:!0}),_a.configure({openOnClick:!1,HTMLAttributes:{class:"prose-link text-primary hover:text-primary/80 underline decoration-primary/50"}}),$a.configure({resizable:!0}),Ea,Ra,Ha,Ia.configure({inlineOptions:{onClick:(r,e)=>{const u=n.value;if(!u)return;const c=window.prompt("Edit inline math (LaTeX):",r.attrs.latex);c&&u.chain().setNodeSelection(e).updateInlineMath({latex:c}).focus().run()}},blockOptions:{onClick:(r,e)=>{const u=n.value;if(!u)return;const c=window.prompt("Edit block math (LaTeX):",r.attrs.latex);c&&u.chain().setNodeSelection(e).updateBlockMath({latex:c}).focus().run()}},katexOptions:{throwOnError:!1}}),Ka,Ba,ir.configure({maxWidth:800}),Va.configure({types:["heading","paragraph"]}),dr.configure({onManualTrigger:()=>S("ghost-manual-trigger"),onAccepted:r=>S("ghost-accepted",r),onDismissed:()=>S("ghost-dismissed")})].filter((r,e,u)=>e===u.findIndex(c=>c.name===r.name)),n=Da({content:$(m.modelValue),editable:!m.readonly,extensions:Y,editorProps:{attributes:{class:"prose prose-sm dark:prose-invert max-w-none focus:outline-none",style:`min-height: ${m.minHeight}; padding: 12px;`}},onUpdate:({editor:r})=>{S("update:modelValue",r.getHTML()),ye()},onSelectionUpdate:({editor:r})=>{ye();const{from:e,to:u,empty:c}=r.state.selection;if(c)S("update:selectedText",""),S("update:selectionRange",null),console.log("ðŸ”„ RichTextEditor - No selection, cleared");else{if(!r.state.doc)return;const _=r.state.doc.textBetween(e,u);_.split(/\s+/).filter(x=>x.length>0).length<=200?(S("update:selectedText",_),S("update:selectionRange",{from:e,to:u}),console.log("âœ… RichTextEditor - Selection emitted to parent")):(S("update:selectedText",""),S("update:selectionRange",null),console.log("âŒ RichTextEditor - Selection too long, cleared"))}}});le(()=>m.modelValue,r=>{if(n.value){if(m.streamingMode&&T.value){ue(r);return}if(n.value.getHTML()!==r){const e=$(r);n.value.commands.setContent(e,{emitUpdate:!1}),Be(()=>{n.value&&S("update:modelValue",n.value.getHTML())})}}}),le([()=>m.ghostText,()=>m.ghostTextFormat,()=>m.ghostTextPosition],([r,e,u])=>{if(!n.value)return;const c=(r??"").toString();if(!c){n.value.commands.clearGhostText?.();return}n.value.commands.setGhostText?.({text:c,format:e??"text",position:typeof u=="number"?u:void 0})},{immediate:!0}),le(()=>m.streamingMode,r=>{r?re():y()});function re(){T.value=!0,U.value=0,C.value="",console.log("RichTextEditor: Streaming mode started (throttled)")}function y(){M.value&&(clearTimeout(M.value),M.value=null),C.value&&n.value&&ve(C.value),T.value=!1,C.value="",U.value=0,console.log("RichTextEditor: Streaming mode ended")}function ue(r){if(!n.value||!T.value)return;C.value=r;const u=Date.now()-U.value;if(u>=et){ve(r);return}if(!M.value){const c=et-u;M.value=setTimeout(()=>{M.value=null,T.value&&C.value&&ve(C.value)},c)}}function ve(r){if(!n.value)return;U.value=Date.now();const e=$(r);n.value.getHTML()!==e&&n.value.commands.setContent(e,{emitUpdate:!1})}function L(){if(!n.value)return;const r=C.value||m.modelValue,e=$(r);n.value.commands.setContent(e,{emitUpdate:!1})}function K(){const r=C.value||m.modelValue;return{length:r.length,wordCount:r.split(/\s+/).filter(e=>e.length>0).length}}le(()=>m.readonly,r=>{n.value&&n.value.setEditable(!r)}),Oe(()=>{setTimeout(()=>{n.value&&ye()},100),document.addEventListener("tiptap-image-drop",je),document.addEventListener("tiptap-image-paste",Xe)}),tt(()=>{M.value&&(clearTimeout(M.value),M.value=null),n.value&&n.value.destroy(),document.removeEventListener("tiptap-image-drop",je),document.removeEventListener("tiptap-image-paste",Xe),q()});const Q=()=>n.value?.chain().focus().toggleBold().run(),he=()=>n.value?.chain().focus().toggleItalic().run(),Ie=()=>n.value?.chain().focus().toggleStrike().run(),Ve=()=>n.value?.chain().focus().toggleCode().run(),ke=()=>{const r=n.value;if(!r)return;if(!r.state.selection.empty){r.chain().focus().setInlineMath().run();return}const e=window.prompt("Enter inline math (LaTeX):","");e&&r.chain().focus().insertInlineMath({latex:e}).run()},De=()=>{const r=n.value;if(!r)return;if(!r.state.selection.empty){r.chain().focus().setBlockMath().run();return}const e=window.prompt("Enter block math (LaTeX):","");e&&r.chain().focus().insertBlockMath({latex:e}).run()},p=()=>{n.value?.chain().focus().insertMermaid().run()},o=h(!1);let g=null;const q=()=>{g&&(g.disconnect(),g=null)},J=()=>{if(typeof document>"u"){o.value=!1;return}o.value=!!(m.toolbarTeleportTarget&&document.querySelector(m.toolbarTeleportTarget))};typeof document<"u"&&J();const Z=B(()=>!m.toolbarTeleportTarget||!o.value);B(()=>!Z.value);const ne=B(()=>Z.value?"body":m.toolbarTeleportTarget||"body"),X=B(()=>{const r="z-20 flex items-center gap-1 border-border/40 bg-background/95 p-1.5 shadow-sm backdrop-blur-md transition-all duration-200 supports-[backdrop-filter]:bg-background/80 overflow-x-auto no-scrollbar mask-gradient-right";return Z.value?`sticky top-0 mx-0 sm:mx-2 md:mx-4 mt-0 sm:mt-1 md:mt-2 mb-2 md:mb-4 rounded-none sm:rounded-lg md:rounded-xl border-y sm:border ${r}`:`w-full ${r} rounded-lg border`});le(()=>m.toolbarTeleportTarget,async()=>{await Be(),J()},{flush:"post"}),Oe(async()=>{await Be(),J(),!o.value&&m.toolbarTeleportTarget&&typeof MutationObserver<"u"&&typeof document<"u"&&document.body&&(q(),g=new MutationObserver(()=>{J(),o.value&&q()}),g.observe(document.body,{childList:!0,subtree:!0}))});const ee=()=>n.value?.chain().focus().toggleUnderline().run(),Ce=()=>n.value?.chain().focus().toggleHeading({level:1}).run(),pt=()=>n.value?.chain().focus().toggleHeading({level:2}).run(),vt=()=>n.value?.chain().focus().toggleHeading({level:3}).run(),ht=()=>n.value?.chain().focus().toggleBulletList().run(),xt=()=>n.value?.chain().focus().toggleOrderedList().run(),bt=()=>n.value?.chain().focus().toggleBlockquote().run(),wt=()=>n.value?.chain().focus().setParagraph().run(),yt=()=>n.value?.chain().focus().undo().run(),kt=()=>n.value?.chain().focus().redo().run(),xe=h(!1),ze=h(!1),j=h({url:"",text:""}),oe=h({color:"#000000"}),Ct=()=>{const{from:r,to:e}=n.value?.state.selection||{from:0,to:0},u=n.value?.state.doc.textBetween(r,e)||"";n.value?.isActive("link")?n.value.chain().focus().unsetLink().run():(j.value.text=u,j.value.url="",xe.value=!0)},zt=()=>{if(j.value.url){if(j.value.text){const{from:r,to:e}=n.value?.state.selection||{from:0,to:0};n.value?.chain().focus().deleteRange({from:r,to:e}).insertContent(`<a href="${j.value.url}">${j.value.text}</a>`).run()}else n.value?.chain().focus().setLink({href:j.value.url}).run();xe.value=!1}},Tt=()=>{ze.value=!0},At=()=>{oe.value.color&&n.value?.chain().focus().setColor(oe.value.color).run(),ze.value=!1},Mt=()=>{n.value?.chain().focus().unsetColor().run()},ce=h(!1),ge=h(""),be=h(!1),Te=h(0),fe=h(""),Ae=h(null),St=()=>{ge.value="",fe.value="",ce.value=!0},qe=()=>{ge.value&&(n.value?.chain().focus().setImage({src:ge.value}).run(),ce.value=!1)},Lt=r=>{const u=r.target.files?.[0];u&&Pe(u)},Pe=async r=>{if(!r.type.startsWith("image/")){fe.value="Please select an image file";return}be.value=!0,fe.value="",Te.value=0;try{const e=new FormData;e.append("image",r);const u=await lt.post("/editor/images",e,{headers:{"Content-Type":"multipart/form-data"},onUploadProgress:c=>{c.total&&(Te.value=Math.round(c.loaded*100/c.total))}});u.data.success&&(n.value?.chain().focus().setImage({src:u.data.url,width:u.data.width,height:u.data.height}).run(),ce.value=!1)}catch(e){fe.value=e.response?.data?.message||"Upload failed"}finally{be.value=!1,Te.value=0,Ae.value&&(Ae.value.value="")}},je=r=>{const{file:e}=r.detail;Pe(e)},Xe=r=>{const{file:e}=r.detail;Pe(e)},Ge=h("#ffff00"),_t=()=>{if(n.value?.isActive("highlight"))n.value.chain().focus().unsetHighlight().run();else{const r=prompt("Enter highlight color (hex, rgb, or color name):",Ge.value);r?(Ge.value=r,n.value?.chain().focus().setHighlight({color:r}).run()):n.value?.chain().focus().setHighlight().run()}},Me=r=>{n.value?.chain().focus().setTextAlign(r).run()},$t=()=>{n.value?.chain().focus().insertTable({rows:3,cols:3,withHeaderRow:!0}).run()},Et=()=>{n.value?.chain().focus().addColumnBefore().run()},Rt=()=>{n.value?.chain().focus().addColumnAfter().run()},Ht=()=>{n.value?.chain().focus().deleteColumn().run()},It=()=>{n.value?.chain().focus().addRowBefore().run()},Vt=()=>{n.value?.chain().focus().addRowAfter().run()},Dt=()=>{n.value?.chain().focus().deleteRow().run()},Pt=()=>{n.value?.chain().focus().deleteTable().run()},se=()=>n.value?.isActive("table")??!1,Ye=h("12pt"),we=["8pt","9pt","10pt","11pt","12pt","14pt","16pt","18pt","20pt","24pt","28pt","36pt","48pt","72pt"],Ut=()=>{const r=Ue(),e=we.indexOf(r);if(e===-1)n.value?.chain().focus().setFontSize("14pt").run();else if(e<we.length-1){const u=we[e+1];n.value?.chain().focus().setFontSize(u).run()}ye()},Bt=()=>{const r=Ue(),e=we.indexOf(r);if(e===-1)n.value?.chain().focus().setFontSize("11pt").run();else if(e>0){const u=we[e-1];n.value?.chain().focus().setFontSize(u).run()}ye()},Ue=()=>{const{from:r,to:e}=n.value?.state.selection||{from:0,to:0};let u="";return n.value?.state.doc.nodesBetween(r,e,c=>{c.marks&&c.marks.forEach(_=>{_.type.name==="textStyle"&&_.attrs.fontSize&&(u=_.attrs.fontSize)})}),u||"12pt"},ye=()=>{const r=Ue();Ye.value=r},Ot=B(()=>n.value?n.value.state.doc.textContent.split(/\s+/).filter(e=>e.length>0).length:0);return s({getSelectionRange:()=>{if(!n.value)return null;const{from:r,to:e,empty:u}=n.value.state.selection;return u?null:{from:r,to:e}},getSelectedText:()=>{if(!n.value)return"";const{from:r,to:e}=n.value.state.selection;return n.value.state.doc.textBetween(r,e)},replaceSelection:(r,e)=>{if(!n.value)return console.error("âŒ RichTextEditor - Cannot replace selection: editor not available"),!1;try{const u=e||n.value.state.selection;return console.log("ðŸ”„ RichTextEditor - Starting text replacement:",{range:u,newTextLength:r.length,newTextPreview:r.substring(0,100)+(r.length>100?"...":"")}),n.value.chain().focus().insertContentAt({from:u.from,to:u.to},r,{parseOptions:{preserveWhitespace:"full"}}).run(),console.log("âœ… RichTextEditor - Text replacement successful"),!0}catch(u){return console.error("âŒ RichTextEditor - Error replacing selection:",u),!1}},replaceTextAt:(r,e)=>{if(!n.value)return!1;try{return n.value.chain().focus().insertContentAt(r,e).run(),!0}catch(u){return console.error("Error replacing text at position:",u),!1}},getCursorPosition:()=>n.value?n.value.state.selection.anchor:0,setCursorPosition:r=>{if(!n.value)return!1;try{return n.value.commands.setTextSelection(r),!0}catch(e){return console.error("Error setting cursor position:",e),!1}},focus:()=>n.value?.commands.focus(),blur:()=>n.value?.commands.blur(),getHTML:()=>n.value?.getHTML()||"",getText:()=>n.value?.getText()||"",wordCount:Ot,startStreamingMode:re,endStreamingMode:y,refreshContent:L,getStreamingInfo:K,isStreamingActive:()=>T.value,editor:()=>n.value}),(r,e)=>{const u=Zt("Sparkles");return z(),I("div",ur,[r.showToolbar&&!r.readonly?(z(),de(ea,{key:0,to:ne.value,disabled:Z.value},[d("div",{class:w(X.value)},[d("div",cr,[a(t(v),{variant:"ghost",size:"icon",class:"h-8 w-8 rounded-lg hover:bg-muted/80 text-zinc-700 dark:text-zinc-300 hover:text-foreground",onClick:yt,disabled:!t(n)?.can().undo()},{default:l(()=>[a(t(ta),{class:"h-4 w-4"})]),_:1},8,["disabled"]),a(t(v),{variant:"ghost",size:"icon",class:"h-8 w-8 rounded-lg hover:bg-muted/80 text-zinc-700 dark:text-zinc-300 hover:text-foreground",onClick:kt,disabled:!t(n)?.can().redo()},{default:l(()=>[a(t(aa),{class:"h-4 w-4"})]),_:1},8,["disabled"])]),d("div",gr,[a(t(Ze),null,{default:l(()=>[a(t(Qe),{asChild:""},{default:l(()=>[a(t(v),{variant:"ghost",size:"sm",class:"h-8 gap-1 px-2 font-medium text-zinc-700 dark:text-zinc-300 hover:text-foreground hover:bg-muted/80"},{default:l(()=>[d("span",fr,V(t(n)?.isActive("heading",{level:1})?"H1":t(n)?.isActive("heading",{level:2})?"H2":t(n)?.isActive("heading",{level:3})?"H3":"Paragraph"),1),a(t(st),{class:"h-3.5 w-3.5 opacity-70"})]),_:1})]),_:1}),a(t(Je),{align:"start"},{default:l(()=>[a(t(N),{onClick:wt,class:w({"bg-accent":t(n)?.isActive("paragraph")})},{default:l(()=>[...e[15]||(e[15]=[d("span",{class:"text-sm"},"Paragraph",-1)])]),_:1},8,["class"]),a(t(Se)),a(t(N),{onClick:Ce,class:w({"bg-accent":t(n)?.isActive("heading",{level:1})})},{default:l(()=>[...e[16]||(e[16]=[d("span",{class:"text-lg font-bold"},"Heading 1",-1)])]),_:1},8,["class"]),a(t(N),{onClick:pt,class:w({"bg-accent":t(n)?.isActive("heading",{level:2})})},{default:l(()=>[...e[17]||(e[17]=[d("span",{class:"text-base font-bold"},"Heading 2",-1)])]),_:1},8,["class"]),a(t(N),{onClick:vt,class:w({"bg-accent":t(n)?.isActive("heading",{level:3})})},{default:l(()=>[...e[18]||(e[18]=[d("span",{class:"text-sm font-bold"},"Heading 3",-1)])]),_:1},8,["class"])]),_:1})]),_:1}),d("div",mr,[a(t(v),{variant:"ghost",size:"icon",class:"h-8 w-6 rounded-l-lg text-zinc-700 dark:text-zinc-300 hover:text-foreground hover:bg-muted/80",onClick:Bt},{default:l(()=>[a(t(ra),{class:"h-3 w-3"})]),_:1}),d("div",pr,V(Ye.value.replace("pt","")),1),a(t(v),{variant:"ghost",size:"icon",class:"h-8 w-6 rounded-r-lg text-zinc-700 dark:text-zinc-300 hover:text-foreground hover:bg-muted/80",onClick:Ut},{default:l(()=>[a(t(na),{class:"h-3 w-3"})]),_:1})])]),d("div",vr,[a(t(v),{variant:"ghost",size:"icon",class:w(["h-8 w-8 rounded-lg text-zinc-700 dark:text-zinc-300 hover:text-foreground hover:bg-muted/80",{"bg-primary/10 text-primary":t(n)?.isActive("bold")}]),onClick:Q},{default:l(()=>[a(t(oa),{class:"h-4 w-4"})]),_:1},8,["class"]),a(t(v),{variant:"ghost",size:"icon",class:w(["h-8 w-8 rounded-lg text-zinc-700 dark:text-zinc-300 hover:text-foreground hover:bg-muted/80",{"bg-primary/10 text-primary":t(n)?.isActive("italic")}]),onClick:he},{default:l(()=>[a(t(sa),{class:"h-4 w-4"})]),_:1},8,["class"]),a(t(v),{variant:"ghost",size:"icon",class:w(["h-8 w-8 rounded-lg text-zinc-700 dark:text-zinc-300 hover:text-foreground hover:bg-muted/80",{"bg-primary/10 text-primary":t(n)?.isActive("underline")}]),onClick:ee},{default:l(()=>[a(t(la),{class:"h-4 w-4"})]),_:1},8,["class"]),a(t(v),{variant:"ghost",size:"icon",class:w(["h-8 w-8 rounded-lg text-zinc-700 dark:text-zinc-300 hover:text-foreground hover:bg-muted/80",{"bg-primary/10 text-primary":t(n)?.isActive("strike")}]),onClick:Ie},{default:l(()=>[a(t(ia),{class:"h-4 w-4"})]),_:1},8,["class"]),a(t(v),{variant:"ghost",size:"icon",class:w(["h-8 w-8 rounded-lg text-zinc-700 dark:text-zinc-300 hover:text-foreground hover:bg-muted/80",{"bg-primary/10 text-primary":t(n)?.isActive("code")}]),onClick:Ve},{default:l(()=>[a(t(da),{class:"h-4 w-4"})]),_:1},8,["class"])]),d("div",hr,[a(t(v),{variant:"ghost",size:"icon",class:w(["h-8 w-8 rounded-lg text-zinc-700 dark:text-zinc-300 hover:text-foreground hover:bg-muted/80",{"bg-primary/10 text-primary":t(n)?.isActive("bulletList")}]),onClick:ht},{default:l(()=>[a(t(ua),{class:"h-4 w-4"})]),_:1},8,["class"]),a(t(v),{variant:"ghost",size:"icon",class:w(["h-8 w-8 rounded-lg text-zinc-700 dark:text-zinc-300 hover:text-foreground hover:bg-muted/80",{"bg-primary/10 text-primary":t(n)?.isActive("orderedList")}]),onClick:xt},{default:l(()=>[a(t(ca),{class:"h-4 w-4"})]),_:1},8,["class"]),a(t(v),{variant:"ghost",size:"icon",class:w(["h-8 w-8 rounded-lg text-zinc-700 dark:text-zinc-300 hover:text-foreground hover:bg-muted/80",{"bg-primary/10 text-primary":t(n)?.isActive("blockquote")}]),onClick:bt},{default:l(()=>[a(t(ga),{class:"h-4 w-4"})]),_:1},8,["class"]),d("div",xr,[a(t(v),{variant:"ghost",size:"icon",class:w(["h-8 w-8 rounded-lg text-zinc-700 dark:text-zinc-300 hover:text-foreground hover:bg-muted/80",{"bg-primary/10 text-primary":t(n)?.isActive({textAlign:"left"})}]),onClick:e[0]||(e[0]=c=>Me("left"))},{default:l(()=>[a(t(rt),{class:"h-4 w-4"})]),_:1},8,["class"]),a(t(v),{variant:"ghost",size:"icon",class:w(["h-8 w-8 rounded-lg text-zinc-700 dark:text-zinc-300 hover:text-foreground hover:bg-muted/80",{"bg-primary/10 text-primary":t(n)?.isActive({textAlign:"center"})}]),onClick:e[1]||(e[1]=c=>Me("center"))},{default:l(()=>[a(t(nt),{class:"h-4 w-4"})]),_:1},8,["class"]),a(t(v),{variant:"ghost",size:"icon",class:w(["h-8 w-8 rounded-lg text-zinc-700 dark:text-zinc-300 hover:text-foreground hover:bg-muted/80",{"bg-primary/10 text-primary":t(n)?.isActive({textAlign:"right"})}]),onClick:e[2]||(e[2]=c=>Me("right"))},{default:l(()=>[a(t(ot),{class:"h-4 w-4"})]),_:1},8,["class"]),a(t(v),{variant:"ghost",size:"icon",class:w(["h-8 w-8 rounded-lg text-zinc-700 dark:text-zinc-300 hover:text-foreground hover:bg-muted/80",{"bg-primary/10 text-primary":t(n)?.isActive({textAlign:"justify"})}]),onClick:e[3]||(e[3]=c=>Me("justify"))},{default:l(()=>[a(t(fa),{class:"h-4 w-4"})]),_:1},8,["class"])])]),d("div",br,[a(t(v),{variant:"ghost",size:"icon",class:"h-8 w-8 rounded-lg text-zinc-700 dark:text-zinc-300 hover:text-foreground hover:bg-muted/80",title:"Insert Mermaid diagram (Ctrl/Cmd+Alt+M)",onClick:p},{default:l(()=>[...e[19]||(e[19]=[d("span",{class:"text-[11px] font-semibold"},"M",-1)])]),_:1}),a(t(v),{variant:"ghost",size:"icon",class:"h-8 w-8 rounded-lg text-zinc-700 dark:text-zinc-300 hover:text-foreground hover:bg-muted/80",title:"Insert inline math",onClick:ke},{default:l(()=>[...e[20]||(e[20]=[d("span",{class:"text-[11px] font-semibold"},"fx",-1)])]),_:1}),a(t(v),{variant:"ghost",size:"icon",class:"h-8 w-8 rounded-lg text-zinc-700 dark:text-zinc-300 hover:text-foreground hover:bg-muted/80",title:"Insert block math",onClick:De},{default:l(()=>[...e[21]||(e[21]=[d("span",{class:"text-[11px] font-semibold"},"FX",-1)])]),_:1}),a(t(v),{variant:"ghost",size:"icon",class:w(["h-8 w-8 rounded-lg text-zinc-700 dark:text-zinc-300 hover:text-foreground hover:bg-muted/80",{"bg-primary/10 text-primary":t(n)?.isActive("link")}]),onClick:Ct},{default:l(()=>[a(t(ma),{class:"h-4 w-4"})]),_:1},8,["class"]),a(t(v),{variant:"ghost",size:"icon",class:"h-8 w-8 rounded-lg text-zinc-700 dark:text-zinc-300 hover:text-foreground hover:bg-muted/80",title:"Insert image",onClick:St},{default:l(()=>[a(t(pa),{class:"h-4 w-4"})]),_:1}),a(t(Ze),null,{default:l(()=>[a(t(Qe),{asChild:""},{default:l(()=>[a(t(v),{variant:"ghost",size:"icon",class:w(["h-8 w-8 rounded-lg text-zinc-700 dark:text-zinc-300 hover:text-foreground hover:bg-muted/80",{"bg-primary/10 text-primary":t(n)?.isActive("table")}])},{default:l(()=>[a(t(va),{class:"h-4 w-4"})]),_:1},8,["class"])]),_:1}),a(t(Je),null,{default:l(()=>[a(t(N),{onClick:$t},{default:l(()=>[...e[22]||(e[22]=[b("Insert Table (3x3)",-1)])]),_:1}),a(t(Se)),a(t(N),{onClick:Et,disabled:!se()},{default:l(()=>[...e[23]||(e[23]=[b("Add Column Before",-1)])]),_:1},8,["disabled"]),a(t(N),{onClick:Rt,disabled:!se()},{default:l(()=>[...e[24]||(e[24]=[b("Add Column After",-1)])]),_:1},8,["disabled"]),a(t(N),{onClick:Ht,disabled:!se()},{default:l(()=>[...e[25]||(e[25]=[b("Delete Column",-1)])]),_:1},8,["disabled"]),a(t(Se)),a(t(N),{onClick:It,disabled:!se()},{default:l(()=>[...e[26]||(e[26]=[b("Add Row Before",-1)])]),_:1},8,["disabled"]),a(t(N),{onClick:Vt,disabled:!se()},{default:l(()=>[...e[27]||(e[27]=[b("Add Row After",-1)])]),_:1},8,["disabled"]),a(t(N),{onClick:Dt,disabled:!se()},{default:l(()=>[...e[28]||(e[28]=[b("Delete Row",-1)])]),_:1},8,["disabled"]),a(t(Se)),a(t(N),{onClick:Pt,disabled:!se(),class:"text-destructive"},{default:l(()=>[...e[29]||(e[29]=[b("Delete Table ",-1)])]),_:1},8,["disabled"])]),_:1})]),_:1}),a(t(v),{variant:"ghost",size:"icon",class:w(["h-8 w-8 rounded-lg text-zinc-700 dark:text-zinc-300 hover:text-foreground hover:bg-muted/80",{"bg-primary/10 text-primary":t(n)?.isActive("highlight")}]),onClick:_t},{default:l(()=>[a(t(ha),{class:"h-4 w-4"})]),_:1},8,["class"]),a(t(v),{variant:"ghost",size:"icon",class:w(["h-8 w-8 rounded-lg text-zinc-700 dark:text-zinc-300 hover:text-foreground hover:bg-muted/80",{"bg-primary/10 text-primary":t(n)?.getAttributes("textStyle").color}]),onClick:Tt},{default:l(()=>[a(t(xa),{class:"h-4 w-4"})]),_:1},8,["class"])])],2)],8,["to","disabled"])):P("",!0),d("div",wr,[a(t(Pa),{editor:t(n),class:"h-full w-full outline-none"},null,8,["editor"]),a(ba,{"enter-active-class":"transition-all duration-300 cubic-bezier(0.34, 1.56, 0.64, 1)","enter-from-class":"opacity-0 -translate-y-4 scale-95","enter-to-class":"opacity-100 translate-y-0 scale-100","leave-active-class":"transition-all duration-200 cubic-bezier(0.4, 0, 0.2, 1)","leave-from-class":"opacity-100 translate-y-0 scale-100","leave-to-class":"opacity-0 -translate-y-4 scale-95"},{default:l(()=>[r.isGenerating?(z(),I("div",yr,[d("div",kr,[d("div",Cr,[e[30]||(e[30]=d("div",{class:"absolute inset-0 rounded-full bg-indigo-400/30 animate-ping"},null,-1)),a(u,{class:"w-4 h-4 text-indigo-300 animate-pulse relative z-10"})]),d("div",zr,[d("div",Tr,[d("span",Ar,V(r.generationPhase||"Writing..."),1),d("span",Mr,V(r.generationPercentage)+"% ",1)]),d("div",Sr,[d("div",{class:"h-full bg-gradient-to-r from-indigo-400 to-purple-400 transition-all duration-300 ease-out",style:pe({width:`${r.generationPercentage}%`})},[...e[31]||(e[31]=[d("div",{class:"absolute inset-0 bg-white/20 animate-[shimmer_2s_infinite]"},null,-1)])],4)])]),e[33]||(e[33]=d("div",{class:"w-px h-6 bg-white/10 mx-1"},null,-1)),d("div",Lr,[e[32]||(e[32]=d("span",{class:"text-[10px] font-medium text-indigo-200/80"}," Word Count ",-1)),d("span",_r,V(r.generationProgress?.match(/\d+/)?.[0]||"..."),1)])])])):P("",!0)]),_:1})]),a(t(Le),{open:xe.value,"onUpdate:open":e[7]||(e[7]=c=>xe.value=c)},{default:l(()=>[a(t(_e),null,{default:l(()=>[a(t(Re),null,{default:l(()=>[a(t(He),null,{default:l(()=>[...e[34]||(e[34]=[b("Insert Link",-1)])]),_:1}),a(t($e),null,{default:l(()=>[...e[35]||(e[35]=[b("Enter the URL for the link.",-1)])]),_:1})]),_:1}),d("div",$r,[d("div",Er,[a(t(me),{htmlFor:"link-text"},{default:l(()=>[...e[36]||(e[36]=[b("Text",-1)])]),_:1}),a(t(ie),{id:"link-text",modelValue:j.value.text,"onUpdate:modelValue":e[4]||(e[4]=c=>j.value.text=c),placeholder:"Link text"},null,8,["modelValue"])]),d("div",Rr,[a(t(me),{htmlFor:"link-url"},{default:l(()=>[...e[37]||(e[37]=[b("URL",-1)])]),_:1}),a(t(ie),{id:"link-url",modelValue:j.value.url,"onUpdate:modelValue":e[5]||(e[5]=c=>j.value.url=c),placeholder:"https://example.com"},null,8,["modelValue"])])]),a(t(Ee),null,{default:l(()=>[a(t(v),{variant:"outline",onClick:e[6]||(e[6]=c=>xe.value=!1)},{default:l(()=>[...e[38]||(e[38]=[b("Cancel",-1)])]),_:1}),a(t(v),{onClick:zt},{default:l(()=>[...e[39]||(e[39]=[b("Insert",-1)])]),_:1})]),_:1})]),_:1})]),_:1},8,["open"]),a(t(Le),{open:ze.value,"onUpdate:open":e[10]||(e[10]=c=>ze.value=c)},{default:l(()=>[a(t(_e),null,{default:l(()=>[a(t(Re),null,{default:l(()=>[a(t(He),null,{default:l(()=>[...e[40]||(e[40]=[b("Text Color",-1)])]),_:1}),a(t($e),null,{default:l(()=>[...e[41]||(e[41]=[b("Choose a color for the selected text.",-1)])]),_:1})]),_:1}),d("div",Hr,[d("div",Ir,[a(t(ie),{type:"color",modelValue:oe.value.color,"onUpdate:modelValue":e[8]||(e[8]=c=>oe.value.color=c),class:"h-12 w-12 p-1"},null,8,["modelValue"]),a(t(ie),{modelValue:oe.value.color,"onUpdate:modelValue":e[9]||(e[9]=c=>oe.value.color=c),placeholder:"#000000",class:"flex-1"},null,8,["modelValue"])]),d("div",Vr,[(z(),I(Fe,null,wa(["#000000","#ef4444","#f97316","#eab308","#22c55e","#3b82f6","#a855f7","#ec4899"],c=>d("button",{key:c,class:"h-8 w-8 rounded-full border border-border shadow-sm transition-transform hover:scale-110 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2",style:pe({backgroundColor:c}),onClick:_=>oe.value.color=c},null,12,Dr)),64))])]),a(t(Ee),null,{default:l(()=>[a(t(v),{variant:"outline",onClick:Mt},{default:l(()=>[...e[42]||(e[42]=[b("Reset",-1)])]),_:1}),a(t(v),{onClick:At},{default:l(()=>[...e[43]||(e[43]=[b("Apply",-1)])]),_:1})]),_:1})]),_:1})]),_:1},8,["open"]),a(t(Le),{open:ce.value,"onUpdate:open":e[14]||(e[14]=c=>ce.value=c)},{default:l(()=>[a(t(_e),{class:"sm:max-w-md"},{default:l(()=>[a(t(Re),null,{default:l(()=>[a(t(He),null,{default:l(()=>[...e[44]||(e[44]=[b("Insert Image",-1)])]),_:1}),a(t($e),null,{default:l(()=>[...e[45]||(e[45]=[b("Upload an image or enter a URL.",-1)])]),_:1})]),_:1}),d("div",Pr,[d("div",Ur,[a(t(me),null,{default:l(()=>[...e[46]||(e[46]=[b("Upload from computer",-1)])]),_:1}),d("div",Br,[d("input",{ref_key:"imageFileInput",ref:Ae,type:"file",accept:"image/*",class:"hidden",onChange:Lt},null,544),a(t(v),{variant:"outline",class:"w-full",disabled:be.value,onClick:e[11]||(e[11]=c=>Ae.value?.click())},{default:l(()=>[a(t(ya),{class:"w-4 h-4 mr-2"}),b(" "+V(be.value?"Uploading...":"Choose File"),1)]),_:1},8,["disabled"])]),be.value?(z(),de(t(Ua),{key:0,"model-value":Te.value,class:"h-2"},null,8,["model-value"])):P("",!0),fe.value?(z(),I("p",Or,V(fe.value),1)):P("",!0)]),e[49]||(e[49]=d("div",{class:"relative"},[d("div",{class:"absolute inset-0 flex items-center"},[d("span",{class:"w-full border-t"})]),d("div",{class:"relative flex justify-center text-xs uppercase"},[d("span",{class:"bg-background px-2 text-muted-foreground"},"Or")])],-1)),d("div",Fr,[a(t(me),{for:"image-url"},{default:l(()=>[...e[47]||(e[47]=[b("Image URL",-1)])]),_:1}),d("div",Wr,[a(t(ie),{id:"image-url",modelValue:ge.value,"onUpdate:modelValue":e[12]||(e[12]=c=>ge.value=c),placeholder:"https://example.com/image.jpg",onKeydown:at(qe,["enter"])},null,8,["modelValue"]),a(t(v),{onClick:qe,disabled:!ge.value},{default:l(()=>[...e[48]||(e[48]=[b(" Insert ",-1)])]),_:1},8,["disabled"])])])]),a(t(Ee),null,{default:l(()=>[a(t(v),{variant:"outline",onClick:e[13]||(e[13]=c=>ce.value=!1)},{default:l(()=>[...e[50]||(e[50]=[b("Cancel",-1)])]),_:1})]),_:1})]),_:1})]),_:1},8,["open"])])}}}),cn=Ne(Nr,[["__scopeId","data-v-22aadeb7"]]);export{cn as R};
