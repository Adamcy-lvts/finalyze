import{d as R,e as M,c as x,o as b,g as n,k as o,f as L,u as i,j as v,y as $,z as _,b as C,n as B,F as E,h as H,i as q,a3 as te,v as se,U as A,t as K,aa as z,X as ae,s as ne,af as I}from"./app-BBTgw0VQ.js";import{c as oe,_ as T}from"./index-rcRsnuzV.js";import{_ as re}from"./ChapterNavigation.vue_vue_type_script_setup_true_lang-DgX9vlUh.js";import{_ as Q}from"./index-CkracbfL.js";import{h as ie,_ as le}from"./SafeHtmlText.vue_vue_type_script_setup_true_lang-CLsECFII.js";import{L as V}from"./lightbulb-BUve5Qh5.js";import{X as D}from"./x-BLMrPA5s.js";import{_ as X,a as Z,b as Y}from"./CollapsibleTrigger.vue_vue_type_script_setup_true_lang-P__UlkQA.js";import{_ as ce}from"./Progress.vue_vue_type_script_setup_true_lang-C3HU9bTt.js";import{_ as de}from"./Checkbox.vue_vue_type_script_setup_true_lang-D3b8A7oA.js";import{_ as P}from"./Separator.vue_vue_type_script_setup_true_lang-C7LVdJaG.js";import{T as W}from"./target-Dlv2nb8E.js";import{C as J}from"./chevron-down-BXCOFeb4.js";import{L as ue}from"./loader-circle-MNktTO90.js";import{C as O}from"./DropdownMenuTrigger.vue_vue_type_script_setup_true_lang-D46Clpxu.js";import{C as pe}from"./circle-BBSWVwIE.js";import{t as k}from"./index-Bggf1O4m.js";import{W as ge,b as me}from"./useTextHistory-DZtwmufS.js";import{S as fe}from"./sparkles-i6FSwsm_.js";import{au as he,at as ve}from"./RichTextEditor-jdkzAzxe.js";import{T as be}from"./type-B4Dl0Efx.js";import{_ as xe}from"./DefensePreparationPanel.vue_vue_type_script_setup_true_lang-C9-V8jQ7.js";import{_ as ye}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{u as ee}from"./index-BDHVX6zL.js";import{r as we}from"./useWordBalance-BEefHXiv.js";/**
 * @license lucide-vue-next v0.468.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const _e=oe("BookmarkIcon",[["path",{d:"m19 21-7-4-7 4V5a2 2 0 0 1 2-2h10a2 2 0 0 1 2 2v16z",key:"1fy3hk"}]]),Ce={class:"bg-card/50 backdrop-blur-sm border rounded-xl p-4 shadow-sm transition-all hover:shadow-md"},ke={class:"flex items-start justify-between gap-4"},Se={class:"flex-1 space-y-3"},$e={class:"flex items-center gap-2"},Te={class:"p-1.5 rounded-md bg-primary/10 text-primary"},je={key:0,class:"pt-2 border-t border-border/50"},Ae={class:"text-xs text-amber-600 dark:text-amber-400 flex items-center gap-1.5"},Le={class:"flex flex-col gap-1"},ze={class:"mt-4 flex justify-end"},Be=R({__name:"SmartSuggestionPanel",props:{suggestion:{},analysis:{}},emits:["save","clear","apply"],setup(f,{emit:l}){const r=f,a=l,d=(s=>({writing_guide:{label:"Writing Guide",variant:"default"},claims_without_evidence:{label:"Evidence Needed",variant:"destructive"},insufficient_citations:{label:"Add Citations",variant:"warning"},insufficient_tables:{label:"Add Data",variant:"secondary"},weak_arguments:{label:"Strengthen Arguments",variant:"warning"},insufficient_content:{label:"Expand Content",variant:"secondary"}})[s]||{label:s,variant:"default"})(r.suggestion.suggestion_type),h=s=>{const p=s.trim().match(/^```[a-zA-Z0-9_-]*\s*\n([\s\S]*?)\n?```$/);return p?p[1].trim():s},y=s=>{const e=h(s).trim();return e?e.split(/\n\s*\n/).filter(w=>w.trim()).map(w=>{const t=w.trim(),c=t.split(`
`).map(S=>S.trim()).filter(Boolean),m=c.some(S=>/^[-*•]\s+/.test(S)),j=c.some(S=>/^\d+\.\s+/.test(S));if(m||j){const S=c.map(F=>j&&/^\d+\.\s+/.test(F)?`<li>${F.replace(/^\d+\.\s+/,"")}</li>`:m&&/^[-*•]\s+/.test(F)?`<li>${F.replace(/^[-*•]\s+/,"")}</li>`:"").filter(Boolean);return j?`<ol>${S.join("")}</ol>`:`<ul>${S.join("")}</ul>`}return`<p>${t.replace(/\n/g,"<br>")}</p>`}).join(""):""},g=M(()=>{const s=r.suggestion?.suggestion_content||"";if(!s)return"";const e=h(s);return ie(e)?e:y(e)});return(s,e)=>(b(),x("div",Ce,[n("div",ke,[n("div",Se,[n("div",$e,[n("div",Te,[o(i(V),{class:"w-4 h-4"})]),e[3]||(e[3]=n("h3",{class:"font-semibold text-sm"},"Smart Suggestion",-1)),o(i(Q),{variant:i(d).variant,class:"text-[10px] px-2 py-0.5 h-5"},{default:v(()=>[$(_(i(d).label),1)]),_:1},8,["variant"])]),o(le,{as:"div",content:g.value,class:"prose prose-sm dark:prose-invert max-w-none text-sm text-muted-foreground leading-relaxed prose-p:my-2 prose-ul:my-2 prose-ol:my-2 prose-li:my-1 prose-pre:my-2 prose-code:text-xs"},null,8,["content"]),s.analysis&&s.analysis.detected_issues.length>0?(b(),x("div",je,[n("p",Ae,[e[4]||(e[4]=n("span",{class:"w-1.5 h-1.5 rounded-full bg-amber-500"},null,-1)),$(" Issues: "+_(s.analysis.detected_issues.join(", ").replace(/_/g," ")),1)])])):L("",!0)]),n("div",Le,[o(i(T),{size:"icon",variant:"ghost",class:"h-7 w-7",onClick:e[0]||(e[0]=p=>a("clear")),title:"Dismiss"},{default:v(()=>[o(i(D),{class:"w-4 h-4"})]),_:1}),o(i(T),{size:"icon",variant:"ghost",class:"h-7 w-7",onClick:e[1]||(e[1]=p=>a("save")),title:"Save for later"},{default:v(()=>[o(i(_e),{class:"w-4 h-4"})]),_:1})])]),n("div",ze,[o(i(T),{size:"sm",variant:"default",onClick:e[2]||(e[2]=p=>a("apply")),class:"w-full sm:w-auto"},{default:v(()=>[...e[5]||(e[5]=[$(" Apply Suggestion ",-1)])]),_:1})])]))}}),Ie={class:"space-y-2"},Pe={class:"flex items-center gap-3"},Ee={class:"flex flex-col items-start gap-1"},Fe={key:0,class:"text-[10px] text-muted-foreground"},Me={key:0,class:"flex items-center justify-center py-8"},Ne={class:"space-y-2"},Re={class:"flex justify-between text-xs"},Ue={class:"text-muted-foreground"},We={class:"space-y-3"},De={class:"flex items-center justify-between"},He={class:"text-sm font-semibold flex items-center gap-2"},qe={class:"space-y-2"},Oe=["onClick"],Ge={key:0,class:"p-3 rounded-lg bg-blue-500/10 border border-blue-500/20"},Ke={class:"flex items-start gap-2"},Qe={class:"flex-1"},Ve={class:"text-xs leading-relaxed text-foreground"},Xe={class:"space-y-3"},Ze={class:"text-sm font-semibold flex items-center gap-2"},Ye={class:"space-y-2"},Je={key:2,class:"text-center py-8"},et={class:"text-sm text-muted-foreground"},tt=R({__name:"ProgressiveGuidancePanel",props:{guidance:{},isLoading:{type:Boolean},hasContent:{type:Boolean}},emits:["toggleStep","guidanceAction"],setup(f,{emit:l}){const r=f,a=l,u=C(!0),d=M(()=>{const g=r.guidance?.stage||"planning",s={planning:"bg-blue-500/10 text-blue-600 dark:text-blue-400",introduction:"bg-purple-500/10 text-purple-600 dark:text-purple-400",body_development:"bg-amber-500/10 text-amber-600 dark:text-amber-400",body_advanced:"bg-orange-500/10 text-orange-600 dark:text-orange-400",refinement:"bg-green-500/10 text-green-600 dark:text-green-400"};return s[g]||s.planning}),h=M(()=>r.guidance?r.guidance.next_steps.filter(g=>g.completed).length:0),y=M(()=>r.guidance?.next_steps.length||0);return(g,s)=>(b(),x("div",Ie,[o(i(X),{open:u.value,"onUpdate:open":s[0]||(s[0]=e=>u.value=e),class:"space-y-2"},{default:v(()=>[o(i(Z),{class:"flex w-full items-center justify-between rounded-xl p-4 hover:bg-accent/50 transition-colors duration-200 group"},{default:v(()=>[n("div",Pe,[n("div",{class:B(["p-2 rounded-lg",d.value])},[o(i(W),{class:"h-4 w-4"})],2),n("div",Ee,[s[1]||(s[1]=n("span",{class:"text-sm font-semibold"},"Writing Progress",-1)),g.guidance?(b(),x("span",Fe,_(g.guidance.stage_label),1)):L("",!0)])]),o(i(J),{class:B(["h-4 w-4 text-muted-foreground transition-transform duration-200",u.value?"rotate-180":""])},null,8,["class"])]),_:1}),o(i(Y),{class:"space-y-4 px-4 pb-4"},{default:v(()=>[g.isLoading?(b(),x("div",Me,[o(i(ue),{class:"h-6 w-6 animate-spin text-muted-foreground"})])):g.guidance?(b(),x(E,{key:1},[n("div",Ne,[n("div",Re,[s[2]||(s[2]=n("span",{class:"font-medium text-foreground"},"Overall Progress",-1)),n("span",Ue,_(g.guidance.completion_percentage)+"% ",1)]),o(i(ce),{"model-value":g.guidance.completion_percentage,class:"h-2"},null,8,["model-value"])]),o(i(P),{class:"bg-border/50"}),n("div",We,[n("div",De,[n("h4",He,[o(i(O),{class:"h-4 w-4 text-primary"}),s[3]||(s[3]=$(" Next Steps ",-1))]),o(i(Q),{variant:"secondary",class:"text-[10px] px-2 py-0.5"},{default:v(()=>[$(_(h.value)+" / "+_(y.value),1)]),_:1})]),n("div",qe,[(b(!0),x(E,null,H(g.guidance.next_steps,e=>(b(),x("div",{key:e.id,class:"flex items-start gap-3 p-3 rounded-lg hover:bg-accent/30 transition-colors duration-200 cursor-pointer group",onClick:p=>a("toggleStep",e.id)},[o(i(de),{checked:e.completed,"onUpdate:checked":p=>a("toggleStep",e.id),class:"mt-0.5"},null,8,["checked","onUpdate:checked"]),n("span",{class:B(["text-xs leading-relaxed flex-1",e.completed?"line-through text-muted-foreground":"text-foreground"])},_(e.text),3),e.action&&e.action!=="none"?(b(),q(i(T),{key:0,type:"button",size:"sm",variant:"ghost",class:"h-7 px-2 text-[11px] text-primary hover:bg-primary/10",onClick:te(p=>a("guidanceAction",e.id),["stop"])},{default:v(()=>[$(_(e.action==="open_citation_helper"?"Citations":"Insert"),1)]),_:2},1032,["onClick"])):L("",!0)],8,Oe))),128))])]),g.guidance.contextual_tip?(b(),x("div",Ge,[n("div",Ke,[o(i(V),{class:"h-4 w-4 text-blue-600 dark:text-blue-400 mt-0.5 flex-shrink-0"}),n("div",Qe,[n("p",Ve,_(g.guidance.contextual_tip),1)])])])):L("",!0),o(i(P),{class:"bg-border/50"}),n("div",Xe,[n("h4",Ze,[o(i(W),{class:"h-4 w-4 text-primary"}),s[4]||(s[4]=$(" Milestones ",-1))]),n("div",Ye,[(b(!0),x(E,null,H(g.guidance.writing_milestones,e=>(b(),x("div",{key:e.id,class:"flex items-center gap-3 p-2 rounded-lg"},[(b(),q(se(e.completed?i(O):i(pe)),{class:B(["h-4 w-4",e.completed?"text-green-600 dark:text-green-400":"text-muted-foreground"])},null,8,["class"])),n("span",{class:B(["text-xs",e.completed?"text-foreground font-medium":"text-muted-foreground"])},_(e.label),3)]))),128))])])],64)):(b(),x("div",Je,[o(i(W),{class:"h-12 w-12 mx-auto text-muted-foreground/50 mb-3"}),n("p",et,[g.hasContent?(b(),x(E,{key:0},[$(" Analyzing your chapter to generate personalized guidance… ")],64)):(b(),x(E,{key:1},[$(" Start writing to get personalized guidance ")],64))])]))]),_:1})]),_:1},8,["open"])]))}});function N(f){if(!f)return 0;const r=String(f).replace(/<[^>]*>/g,"").trim().replace(/\s+/g," ");if(!r)return 0;const a=r.match(/\b\w+\b/g);return a?a.length:0}const st={class:"space-y-2"},at={class:"flex items-center gap-3"},nt={class:"p-2 rounded-lg bg-purple-500/10 text-purple-600 dark:text-purple-400"},ot={class:"grid grid-cols-2 gap-2"},rt={class:"p-1.5 rounded-full bg-blue-500/10 text-blue-500"},it={class:"text-xs font-medium"},lt={class:"p-1.5 rounded-full bg-purple-500/10 text-purple-500"},ct={class:"text-xs font-medium"},dt={class:"p-1.5 rounded-full bg-orange-500/10 text-orange-500"},ut={class:"text-xs font-medium"},pt={class:"p-1.5 rounded-full bg-emerald-500/10 text-emerald-500"},gt={class:"text-xs font-medium"},mt=R({__name:"QuickActionsPanel",props:{projectSlug:{},chapterNumber:{},selectedText:{},chapterContent:{},isProcessing:{type:Boolean},ensureBalance:{type:Function},onUsage:{type:Function}},emits:["textImproved","textExpanded","citationsSuggested","textRephrased","customPromptExecuted","openCitationHelper"],setup(f,{emit:l}){const r=f,a=l,u=C(!0),d=C({improve:!1,expand:!1,cite:!1,rephrase:!1,custom:!1}),h=s=>{const e=r.selectedText?.trim()||"",p=r.chapterContent?.trim()||"";return s==="expand"||s==="rephrase"?e:p||e},y=async s=>{try{const e=await s.json();return e?.message||e?.error||`HTTP ${s.status}`}catch{return`HTTP ${s.status}`}},g=async s=>{if(r.ensureBalance&&!r.ensureBalance(300,"use quick actions"))return;const e=h(s);if(!e){k.error(s==="expand"||s==="rephrase"?"Please select some text first":"Please add some content first");return}if(!r.selectedText&&(s==="expand"||s==="rephrase")){k.error("Please select some text first");return}if(s==="cite"){a("openCitationHelper"),k("Opening citation helper...");return}d.value[s]=!0;try{let p="",w;switch(s){case"improve":p="projects.manual-editor.improve-text",w="textImproved";break;case"expand":p="projects.manual-editor.expand-text",w="textExpanded";break;case"rephrase":p="projects.manual-editor.rephrase-text",w="textRephrased";break}const t=await fetch(A(p,{project:r.projectSlug,chapter:r.chapterNumber}),{method:"POST",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":document.querySelector('meta[name="csrf-token"]')?.content||"",Accept:"application/json"},body:JSON.stringify({text:e})});if(!t.ok){const m=await y(t);throw new Error(m)}const c=await t.json();s==="improve"&&c.improvedText?(a("textImproved",c.improvedText),await r.onUsage?.(N(c.improvedText),"Manual editor: Improve"),k.success("Text improved successfully!")):s==="expand"&&c.expandedText?(a("textExpanded",c.expandedText),await r.onUsage?.(N(c.expandedText),"Manual editor: Expand"),k.success("Text expanded successfully!")):s==="rephrase"&&c.alternatives&&(a("textRephrased",c.alternatives),await r.onUsage?.(N(c.alternatives),"Manual editor: Rephrase"),k.success("Alternative phrasings generated!"))}catch(p){console.error(`Failed to ${s} text:`,p);const w=p instanceof Error?p.message:"";k.error(`Failed to ${s} text. Please try again.`,w?{description:w}:void 0)}finally{d.value[s]=!1}};return(s,e)=>(b(),x("div",st,[o(i(X),{open:u.value,"onUpdate:open":e[4]||(e[4]=p=>u.value=p),class:"space-y-2"},{default:v(()=>[o(i(Z),{class:"flex w-full items-center justify-between rounded-xl p-4 hover:bg-accent/50 transition-colors duration-200 group"},{default:v(()=>[n("div",at,[n("div",nt,[o(i(ge),{class:"h-4 w-4"})]),e[5]||(e[5]=n("div",{class:"flex flex-col items-start gap-1"},[n("span",{class:"text-sm font-semibold"},"Quick Actions"),n("span",{class:"text-[10px] text-muted-foreground"}," AI-powered writing tools ")],-1))]),o(i(J),{class:B(["h-4 w-4 text-muted-foreground transition-transform duration-200",u.value?"rotate-180":""])},null,8,["class"])]),_:1}),o(i(Y),{class:"space-y-4 px-4 pb-4"},{default:v(()=>[n("div",ot,[o(i(T),{onClick:e[0]||(e[0]=p=>g("improve")),disabled:s.isProcessing||d.value.improve,variant:"outline",class:"h-20 flex-col gap-2 rounded-xl border-border/50 bg-background/50 hover:bg-accent hover:border-accent transition-all duration-300"},{default:v(()=>[n("div",rt,[o(i(fe),{class:"h-4 w-4"})]),n("span",it,_(d.value.improve?"Improving...":"Improve"),1)]),_:1},8,["disabled"]),o(i(T),{onClick:e[1]||(e[1]=p=>g("expand")),disabled:!s.selectedText||s.isProcessing||d.value.expand,variant:"outline",class:"h-20 flex-col gap-2 rounded-xl border-border/50 bg-background/50 hover:bg-accent hover:border-accent transition-all duration-300"},{default:v(()=>[n("div",lt,[o(i(he),{class:"h-4 w-4"})]),n("span",ct,_(d.value.expand?"Expanding...":"Expand"),1)]),_:1},8,["disabled"]),o(i(T),{onClick:e[2]||(e[2]=p=>g("cite")),disabled:s.isProcessing||d.value.cite,variant:"outline",class:"h-20 flex-col gap-2 rounded-xl border-border/50 bg-background/50 hover:bg-accent hover:border-accent transition-all duration-300"},{default:v(()=>[n("div",dt,[o(i(ve),{class:"h-4 w-4"})]),n("span",ut,_(d.value.cite?"Citing...":"Cite"),1)]),_:1},8,["disabled"]),o(i(T),{onClick:e[3]||(e[3]=p=>g("rephrase")),disabled:!s.selectedText||s.isProcessing||d.value.rephrase,variant:"outline",class:"h-20 flex-col gap-2 rounded-xl border-border/50 bg-background/50 hover:bg-accent hover:border-accent transition-all duration-300"},{default:v(()=>[n("div",pt,[o(i(be),{class:"h-4 w-4"})]),n("span",gt,_(d.value.rephrase?"Rephrasing...":"Rephrase"),1)]),_:1},8,["disabled"])]),e[6]||(e[6]=n("div",{class:"p-3 rounded-lg bg-muted/50 border border-border/50"},[n("p",{class:"text-[10px] text-muted-foreground leading-relaxed"},[n("strong",null,"Tip:"),$(" Select text before using Expand or Rephrase. Improve and Cite work on your entire content. ")])],-1))]),_:1})]),_:1},8,["open"])]))}}),ft={key:0,class:"fixed inset-0 z-50 lg:hidden"},ht={class:"fixed top-0 left-0 h-full w-80 overflow-y-auto border-r bg-background shadow-xl transform transition-transform"},vt={class:"border-b p-3"},bt={class:"flex items-center justify-between"},xt={class:"space-y-4 p-4 mobile-enhanced"},yt={key:0,class:"fixed inset-0 z-50 lg:hidden"},wt={class:"fixed top-0 right-0 h-full w-96 overflow-y-auto border-l bg-background shadow-xl transform transition-transform"},_t={class:"border-b p-3"},Ct={class:"flex items-center justify-between"},kt={class:"space-y-4 p-4 mobile-enhanced"},St={key:0,class:"space-y-2"},$t=R({__name:"MobileNavOverlay",props:{showLeftSidebar:{type:Boolean},showRightSidebar:{type:Boolean},isMobile:{type:Boolean},allChapters:{},currentChapter:{},project:{},facultyChapters:{},currentWordCount:{},targetWordCount:{},chapterContentLength:{},selectedText:{},isAnalyzing:{type:Boolean},isSaving:{type:Boolean},currentSuggestion:{},currentAnalysis:{},guidance:{},isLoadingGuidance:{type:Boolean},chapterContent:{},showCitationHelper:{type:Boolean},ensureBalance:{type:Function},onUsage:{type:Function}},emits:["update:showLeftSidebar","update:showRightSidebar","update:showCitationHelper","goToChapter","generateNextChapter","deleteChapter","saveSuggestion","clearSuggestion","applySuggestion","toggleStep","textImproved","textExpanded","citationsSuggested","textRephrased","insertCitation"],setup(f,{emit:l}){const r=f,a=l,u=C(!0),d=C(r.showCitationHelper);K(()=>r.showCitationHelper,t=>{d.value=t});const h=()=>a("update:showLeftSidebar",!1),y=()=>a("update:showRightSidebar",!1),g=t=>{d.value=t,a("update:showCitationHelper",t)},s=t=>{a("goToChapter",t),h()},e=()=>a("generateNextChapter"),p=t=>a("deleteChapter",t),w=t=>a("insertCitation",t);return(t,c)=>(b(),x("div",null,[o(z,{"enter-active-class":"duration-300 ease-out","enter-from-class":"opacity-0","enter-to-class":"opacity-100","leave-active-class":"duration-200 ease-in","leave-from-class":"opacity-100","leave-to-class":"opacity-0"},{default:v(()=>[t.showLeftSidebar&&t.isMobile?(b(),x("div",ft,[o(z,{"enter-active-class":"duration-300 ease-out","enter-from-class":"opacity-0","enter-to-class":"opacity-100","leave-active-class":"duration-200 ease-in","leave-from-class":"opacity-100","leave-to-class":"opacity-0"},{default:v(()=>[n("div",{class:"fixed inset-0 bg-black/50",onClick:h})]),_:1}),o(z,{"enter-active-class":"duration-300 ease-out","enter-from-class":"-translate-x-full","enter-to-class":"translate-x-0","leave-active-class":"duration-200 ease-in","leave-from-class":"translate-x-0","leave-to-class":"-translate-x-full"},{default:v(()=>[n("div",ht,[n("div",vt,[n("div",bt,[c[10]||(c[10]=n("h2",{class:"text-base font-semibold"},"Table of Contents",-1)),o(i(T),{onClick:h,variant:"ghost",size:"sm",class:"h-8 w-8"},{default:v(()=>[o(i(D),{class:"h-4 w-4"})]),_:1})])]),n("div",xt,[o(re,{"all-chapters":t.allChapters,"current-chapter":t.currentChapter,project:t.project,outlines:t.project.outlines||[],"faculty-chapters":t.facultyChapters||[],"current-word-count":t.currentWordCount,"target-word-count":t.targetWordCount,"writing-quality-score":0,"chapter-content-length":t.chapterContentLength,onGoToChapter:s,onGenerateNextChapter:e,onDeleteChapter:p},null,8,["all-chapters","current-chapter","project","outlines","faculty-chapters","current-word-count","target-word-count","chapter-content-length"])])])]),_:1})])):L("",!0)]),_:1}),o(z,{"enter-active-class":"duration-300 ease-out","enter-from-class":"opacity-0","enter-to-class":"opacity-100","leave-active-class":"duration-200 ease-in","leave-from-class":"opacity-100","leave-to-class":"opacity-0"},{default:v(()=>[t.showRightSidebar&&t.isMobile?(b(),x("div",yt,[o(z,{"enter-active-class":"duration-300 ease-out","enter-from-class":"opacity-0","enter-to-class":"opacity-100","leave-active-class":"duration-200 ease-in","leave-from-class":"opacity-100","leave-to-class":"opacity-0"},{default:v(()=>[n("div",{class:"fixed inset-0 bg-black/50",onClick:y})]),_:1}),o(z,{"enter-active-class":"duration-300 ease-out","enter-from-class":"translate-x-full","enter-to-class":"translate-x-0","leave-active-class":"duration-200 ease-in","leave-from-class":"translate-x-0","leave-to-class":"translate-x-full"},{default:v(()=>[n("div",wt,[n("div",_t,[n("div",Ct,[c[11]||(c[11]=n("h2",{class:"text-base font-semibold"},"AI Tools",-1)),o(i(T),{onClick:y,variant:"ghost",size:"sm",class:"h-8 w-8"},{default:v(()=>[o(i(D),{class:"h-4 w-4"})]),_:1})])]),n("div",kt,[t.currentSuggestion?(b(),x("div",St,[o(Be,{suggestion:t.currentSuggestion,analysis:t.currentAnalysis,onSave:c[0]||(c[0]=m=>t.$emit("saveSuggestion",m)),onClear:c[1]||(c[1]=m=>t.$emit("clearSuggestion")),onApply:c[2]||(c[2]=m=>t.$emit("applySuggestion"))},null,8,["suggestion","analysis"]),o(i(P),{class:"bg-border/50"})])):L("",!0),o(tt,{guidance:t.guidance,"is-loading":t.isLoadingGuidance,onToggleStep:c[3]||(c[3]=m=>t.$emit("toggleStep",m))},null,8,["guidance","is-loading"]),o(i(P),{class:"bg-border/50"}),o(mt,{"project-slug":t.project.slug,"chapter-number":t.currentChapter.chapter_number,"selected-text":t.selectedText,"chapter-content":t.chapterContent,"is-processing":t.isAnalyzing||t.isSaving,"ensure-balance":t.ensureBalance,"on-usage":t.onUsage,onTextImproved:c[4]||(c[4]=m=>t.$emit("textImproved",m)),onTextExpanded:c[5]||(c[5]=m=>t.$emit("textExpanded",m)),onCitationsSuggested:c[6]||(c[6]=m=>t.$emit("citationsSuggested",m)),onTextRephrased:c[7]||(c[7]=m=>t.$emit("textRephrased",m))},null,8,["project-slug","chapter-number","selected-text","chapter-content","is-processing","ensure-balance","on-usage"]),o(i(P),{class:"bg-border/50"}),o(me,{"show-citation-helper":d.value,"onUpdate:showCitationHelper":[c[8]||(c[8]=m=>d.value=m),g],"chapter-content":t.chapterContent,onInsertCitation:w},null,8,["show-citation-helper","chapter-content"]),o(i(P),{class:"bg-border/50"}),o(xe,{"show-defense-prep":u.value,"onUpdate:showDefensePrep":c[9]||(c[9]=m=>u.value=m),questions:[],"is-loading":!1,"is-generating":!1,"chapter-context":{project:t.project,chapter:t.currentChapter,wordCount:t.currentWordCount},onGenerateMore:()=>{},onRefresh:()=>{}},null,8,["show-defense-prep","chapter-context"])])])]),_:1})])):L("",!0)]),_:1})]))}}),Yt=ye($t,[["__scopeId","data-v-4ca5dd74"]]);function Jt(f,l){const r=C(f.content||""),a=C(!1),u=C(!1),d=C(null),h=t=>{r.value=t,a.value=!0,g()},y=async()=>{if(!(!a.value||u.value)){u.value=!0;try{await I.post(A("projects.manual-editor.save",{project:l,chapter:f.chapter_number}),{content:r.value}),a.value=!1,d.value=new Date().toLocaleTimeString()}catch(t){throw console.error("Failed to save chapter:",t),t}finally{u.value=!1}}},g=ee(y,2e3),s=async()=>{if(!u.value){u.value=!0;try{return await I.post(A("projects.manual-editor.save",{project:l,chapter:f.chapter_number}),{content:r.value}),a.value=!1,d.value=new Date().toLocaleTimeString(),!0}catch(t){throw console.error("Failed to save chapter:",t),t}finally{u.value=!1}}},e=t=>{a.value&&(t.preventDefault(),t.returnValue="")},p=t=>{a.value&&!confirm("You have unsaved changes. Are you sure you want to leave?")&&t.preventDefault()};window.addEventListener("beforeunload",e);const w=ae.on("before",p);return ne(()=>{window.removeEventListener("beforeunload",e),w(),a.value&&y()}),{content:r,isDirty:a,isSaving:u,lastSaved:d,updateContent:h,save:y,manualSave:s}}class G{static analyze(l){const a=new DOMParser().parseFromString(l,"text/html");return{word_count:this.countWords(a),citation_count:this.countCitations(a),table_count:this.countTables(a),figure_count:this.countFigures(a),claim_count:this.countClaims(a),has_introduction:this.hasIntroduction(a),has_conclusion:this.hasConclusion(a),detected_issues:this.detectIssues(a),quality_metrics:this.calculateQualityMetrics(a)}}static countWords(l){return(l.body.textContent||"").trim().split(/\s+/).filter(a=>a.length>0).length}static countCitations(l){const r=l.body.textContent||"",a=[/\([A-Z][a-z]+,?\s+\d{4}\)/g,/\[[0-9]+\]/g,/\([A-Z][a-z]+\s+et al\.,?\s+\d{4}\)/g];let u=0;return a.forEach(d=>{const h=r.match(d);h&&(u+=h.length)}),u+=l.querySelectorAll("cite, [data-citation]").length,u}static countTables(l){return l.querySelectorAll("table").length}static countFigures(l){return l.querySelectorAll("img, figure").length}static countClaims(l){const a=(l.body.textContent||"").split(/[.!?]+/),u=["demonstrates","proves","shows","indicates","reveals","confirms","establishes","suggests","implies","evidences"];return a.filter(d=>u.some(h=>d.toLowerCase().includes(h))).length}static hasIntroduction(l){const r=(l.body.textContent||"").toLowerCase();return["introduction","background","overview"].some(u=>r.includes(u))}static hasConclusion(l){const r=(l.body.textContent||"").toLowerCase();return["conclusion","summary","in summary"].some(u=>r.includes(u))}static detectIssues(l){const r=[],a=l.body.textContent||"",u=this.countClaims(l),d=this.countCitations(l);return u>0&&d===0&&r.push("claims_without_evidence"),u>d*2&&r.push("insufficient_citations"),a.toLowerCase().includes("methodology")&&this.countTables(l)===0&&r.push("insufficient_tables"),["maybe","might","could possibly","seems to"].some(e=>a.toLowerCase().includes(e))&&u>3&&r.push("weak_arguments"),this.countWords(l)<100&&r.push("insufficient_content"),r}static calculateQualityMetrics(l){const a=(l.body.textContent||"").split(/[.!?]+/).filter(h=>h.trim().length>0),u=l.querySelectorAll("p").length,d=a.length>0?this.countWords(l)/a.length:0;return{avg_sentence_length:Math.round(d),paragraph_count:u,reading_level:d>25?"complex":d>15?"moderate":"simple"}}}function es(f,l,r,a,u){const d=C(r),h=C(null),y=C(!1),g=C(new Set),e=ee(async()=>{if(!(a.value.length<100)&&!(!l||!f?.chapter_number)){y.value=!0;try{const c=G.analyze(a.value);if(h.value=c,c.detected_issues.length===0){y.value=!1;return}const m=await I.post(A("projects.manual-editor.analyze",{project:l,chapter:f.chapter_number}),{analysis:c});if(m.data.suggestion){d.value=m.data.suggestion;const j=Number(m.data.suggestion?.id);if(j&&!g.value.has(j)){const U=N(m.data.suggestion?.suggestion_content||"");U>0&&(g.value.add(j),we(U,"Manual editor: Smart suggestion","chapter",f.id).then(()=>u?.onUsageRecorded?.()).catch(S=>console.error("Failed to record word usage (manual suggestion):",S)))}}}catch(c){console.error("Failed to analyze and request suggestion:",c)}finally{y.value=!1}}},5e3);return K(a,()=>{a.value.length>0&&(h.value=G.analyze(a.value)),e()}),{currentSuggestion:d,currentAnalysis:h,isAnalyzing:y,saveSuggestion:async()=>{if(d.value&&!(!l||!f?.chapter_number))try{await I.post(A("projects.manual-editor.suggestion.save",{project:l,chapter:f.chapter_number,suggestion:d.value.id})),k("Suggestion saved",{description:"You can refer to this suggestion later."})}catch{k("Failed to save suggestion",{description:"Please try again."})}},clearSuggestion:async()=>{if(d.value&&!(!l||!f?.chapter_number))try{await I.post(A("projects.manual-editor.suggestion.clear",{project:l,chapter:f.chapter_number,suggestion:d.value.id})),d.value=null}catch{k("Failed to clear suggestion",{description:"Please try again."})}},applySuggestion:async()=>{if(d.value&&!(!l||!f?.chapter_number))try{await I.post(A("projects.manual-editor.suggestion.apply",{project:l,chapter:f.chapter_number,suggestion:d.value.id})),k("Suggestion applied",{description:"The suggestion has been marked as applied."}),d.value=null}catch{k("Failed to apply suggestion",{description:"Please try again."})}}}}export{Yt as M,mt as _,es as a,tt as b,Be as c,N as d,Jt as u};
