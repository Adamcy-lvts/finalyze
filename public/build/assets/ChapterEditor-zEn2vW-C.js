const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/ChapterNavigation-C8s9l8Fw.js","assets/ChapterNavigation.vue_vue_type_script_setup_true_lang-D5D8e1nH.js","assets/index-Ia6CVdS0.js","assets/vendor-CugNIqr3.js","assets/vendor-CzjmNn-c.css","assets/ScrollArea.vue_vue_type_script_setup_true_lang-Dluje1jX.js","assets/AlertDialogTitle.vue_vue_type_script_setup_true_lang-BFjWMqjg.js","assets/index-DBZ0Wbkn.js","assets/MobileNavOverlay-CidJnbiO.js","assets/index-DmVOSInm.js","assets/DefensePreparationPanel.vue_vue_type_script_setup_true_lang-Cbr9IfEb.js","assets/CardContent.vue_vue_type_script_setup_true_lang-Ds49DaDx.js","assets/CardTitle.vue_vue_type_script_setup_true_lang-IDxgLF4I.js","assets/CollapsibleTrigger.vue_vue_type_script_setup_true_lang-QRORreyc.js","assets/Progress.vue_vue_type_script_setup_true_lang-CrvPUv9L.js","assets/Separator.vue_vue_type_script_setup_true_lang-Da5nPKun.js","assets/Switch.vue_vue_type_script_setup_true_lang-8gXU-sap.js","assets/_plugin-vue_export-helper-DlAUqK2U.js","assets/TooltipTrigger.vue_vue_type_script_setup_true_lang-C8jiVShk.js","assets/WordBalanceDisplay.vue_vue_type_script_setup_true_lang-D_W9GzUS.js","assets/AppLayout.vue_vue_type_script_setup_true_lang-CWOKT1Zf.js","assets/UserInfo.vue_vue_type_script_setup_true_lang-DoXK2xYg.js","assets/Sonner.vue_vue_type_script_setup_true_lang-DLPHW2_2.js","assets/AppLogo.vue_vue_type_script_setup_true_lang-QE2E2BkN.js","assets/useAppearance-B04txQuA.js","assets/useWordBalance-BDnAc3AF.js","assets/PWAInstallPrompt.vue_vue_type_script_setup_true_lang-CT_GbF6b.js","assets/AppLayout-Z7jpYWR6.css","assets/PurchaseModal.vue_vue_type_script_setup_true_lang-DcZR85h4.js","assets/DialogContent.vue_vue_type_script_setup_true_lang-CJcqQR4M.js","assets/DialogDescription.vue_vue_type_script_setup_true_lang-B73YHsAb.js","assets/DialogFooter.vue_vue_type_script_setup_true_lang-DOvydC-g.js","assets/DialogTitle.vue_vue_type_script_setup_true_lang-DUiYGDJZ.js","assets/useChapterWordCount-CRByR7nE.js","assets/Input.vue_vue_type_script_setup_true_lang-ASyfdFt6.js","assets/Label.vue_vue_type_script_setup_true_lang-BAVAvlHZ.js","assets/RichTextEditor-BRPAbfuP.js","assets/vendor-tiptap-BY1aFJq1.js","assets/MermaidExtension-D_RXIhuX.js","assets/vendor-mermaid-DBX3Zf7t.js","assets/MermaidExtension-DI7x6sFR.css","assets/RichTextEditor-uTOv0crC.css","assets/SelectLabel.vue_vue_type_script_setup_true_lang-CCdQ9tvi.js","assets/SelectLabel-BFh8wlm9.css","assets/SelectValue.vue_vue_type_script_setup_true_lang-CxW9RkuN.js","assets/SelectGroup.vue_vue_type_script_setup_true_lang-CGP1uAop.js","assets/useTextHistory-BzrI3yHD.js","assets/Checkbox.vue_vue_type_script_setup_true_lang-C4h7wFib.js","assets/FeedbackPromptModal.vue_vue_type_script_setup_true_lang-Df-_LMYW.js","assets/Textarea.vue_vue_type_script_setup_true_lang-zAj9xt1j.js","assets/MobileNavOverlay-CiJwra5Q.css","assets/ChatModeLayout-BoRud7lo.js","assets/ChatModeLayout-Dr0PWGkM.css","assets/CitationVerificationLayout-DIz0rwuK.js","assets/SafeHtmlText.vue_vue_type_script_setup_true_lang-CVKuHuDj.js"])))=>i.map(i=>d[i]);
import{ch as Rs,ci as te,cj as D,bs as g,ck as k,cl as I,ce as J,cm as Br,bD as Ne,bA as Pe,cb as ie,bt as ct,cn as P,co as b,bE as e,cp as n,cq as r,cr as s,cs as l,ct as c,cu as Ze,cv as Fs,cw as Le,cx as Oe,cy as At,cz as zs,cA as dt,cB as O,cC as Me,cD as Hr,cE as rs,cF as We,cG as K,cH as ns,cI as ut,cJ as Ur,cK as Qr,cL as Kr,cM as Vr,cN as Xr,cO as Jr,cP as Yr,cQ as Zr,cR as os,cS as lt,cT as St,cU as as,cV as ls,cW as is,cX as ds,cY as us,cZ as cs,c_ as Et,c$ as en,d0 as tn,d1 as ps,d2 as gs,d3 as fs,d4 as sn,d5 as rn,d6 as nn,d7 as on,d8 as an,d9 as ln,da as dn,db as un,dc as cn,dd as pn,_ as it}from"./vendor-CugNIqr3.js";import{_ as je}from"./index-DBZ0Wbkn.js";import{_ as v}from"./index-Ia6CVdS0.js";import{_ as oe,a as ae}from"./CardContent.vue_vue_type_script_setup_true_lang-Ds49DaDx.js";import{_ as le,a as me}from"./CardTitle.vue_vue_type_script_setup_true_lang-IDxgLF4I.js";import{_ as ms}from"./ScrollArea.vue_vue_type_script_setup_true_lang-Dluje1jX.js";import{_ as Ye}from"./Separator.vue_vue_type_script_setup_true_lang-Da5nPKun.js";import{_ as H,a as U,b as Q}from"./TooltipTrigger.vue_vue_type_script_setup_true_lang-C8jiVShk.js";import{_ as gn}from"./WordBalanceDisplay.vue_vue_type_script_setup_true_lang-D_W9GzUS.js";import{_ as hs,a as vs,b as bs,c as xs,d as ws,e as ys,f as _s,g as ks}from"./AlertDialogTitle.vue_vue_type_script_setup_true_lang-BFjWMqjg.js";import{_ as Cs,a as Ss}from"./AppLayout.vue_vue_type_script_setup_true_lang-CWOKT1Zf.js";import{_ as fn}from"./PurchaseModal.vue_vue_type_script_setup_true_lang-DcZR85h4.js";import{r as mn,u as hn}from"./useWordBalance-BDnAc3AF.js";import{u as Ps}from"./useAppearance-B04txQuA.js";import{u as vn,a as bn,b as xn}from"./useChapterWordCount-CRByR7nE.js";import{_ as wn}from"./Input.vue_vue_type_script_setup_true_lang-ASyfdFt6.js";import{_ as yn}from"./Label.vue_vue_type_script_setup_true_lang-BAVAvlHZ.js";import{R as Ms}from"./RichTextEditor-BRPAbfuP.js";import{R as Ns,_ as _n}from"./SelectLabel.vue_vue_type_script_setup_true_lang-CCdQ9tvi.js";import{_ as Es,a as Ts,b as As}from"./CollapsibleTrigger.vue_vue_type_script_setup_true_lang-QRORreyc.js";import{_ as kn}from"./Progress.vue_vue_type_script_setup_true_lang-CrvPUv9L.js";import{_ as Cn,a as Sn,b as En,c as Tn,d as ze}from"./SelectValue.vue_vue_type_script_setup_true_lang-CxW9RkuN.js";import{_ as An}from"./SelectGroup.vue_vue_type_script_setup_true_lang-CGP1uAop.js";import{_ as $n,u as jn,a as Tt}from"./useTextHistory-BzrI3yHD.js";import{_ as Ls}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{_ as Dn}from"./FeedbackPromptModal.vue_vue_type_script_setup_true_lang-Df-_LMYW.js";import"./UserInfo.vue_vue_type_script_setup_true_lang-DoXK2xYg.js";import"./Sonner.vue_vue_type_script_setup_true_lang-DLPHW2_2.js";import"./AppLogo.vue_vue_type_script_setup_true_lang-QE2E2BkN.js";import"./PWAInstallPrompt.vue_vue_type_script_setup_true_lang-CT_GbF6b.js";import"./DialogContent.vue_vue_type_script_setup_true_lang-CJcqQR4M.js";import"./DialogDescription.vue_vue_type_script_setup_true_lang-B73YHsAb.js";import"./DialogFooter.vue_vue_type_script_setup_true_lang-DOvydC-g.js";import"./DialogTitle.vue_vue_type_script_setup_true_lang-DUiYGDJZ.js";import"./vendor-tiptap-BY1aFJq1.js";import"./MermaidExtension-D_RXIhuX.js";import"./vendor-mermaid-DBX3Zf7t.js";import"./Checkbox.vue_vue_type_script_setup_true_lang-C4h7wFib.js";import"./Textarea.vue_vue_type_script_setup_true_lang-zAj9xt1j.js";function Rn(m){const x=Rs();te(()=>x.props?.flash,W=>{W&&(W.success&&D.success(W.success),W.error&&D.error(W.error))},{deep:!0,immediate:!0});const i=g(m.chapter.title||""),R=g(m.chapter.content||""),M=g(!0),{isDark:a,toggle:C}=Ps(),f=k(()=>a.value),F=()=>{},w=()=>{C()},$=g(!1),S=g(!1),_=g(!1),p=g("write"),j=g(""),L=g(0),V=g(!1),de=g(!1),y=g(!0),u=()=>{try{return localStorage.getItem(`chatMode_${m.project.id}_${m.chapter.chapter_number}`)==="true"}catch(W){return console.warn("Failed to load chat mode from localStorage:",W),!1}},A=W=>{try{localStorage.setItem(`chatMode_${m.project.id}_${m.chapter.chapter_number}`,String(W))}catch(X){console.warn("Failed to save chat mode to localStorage:",X)}},Y=g(!1),ue=g(!1),E=g(!1),ce=g(!1),pe=g(!1),se=g(!0),Se=g(!0);return{chapterTitle:i,chapterContent:R,showPreview:M,isEditorDark:f,initChapterTheme:F,toggleChapterTheme:w,isNativeFullscreen:$,showAISidebar:S,showStatistics:_,activeTab:p,selectedText:j,cursorPosition:L,showChatMode:V,showCitationMode:de,showDefensePrep:y,loadChatModeFromStorage:u,saveChatModeToStorage:A,showLeftSidebar:Y,showRightSidebar:ue,isMobile:E,isLeftSidebarCollapsed:ce,isRightSidebarCollapsed:pe,showLeftSidebarInFullscreen:se,showRightSidebarInFullscreen:Se}}function Fn({props:m,allChapters:x,targetWordCount:i,estimates:R,ensureBalance:M,save:a}){return{generateNextChapter:async()=>{const f=R.chapter(i.value||0);if(!M(f,"generate the next chapter with AI"))return;await a();const F=x.map(S=>S.chapter_number).sort((S,_)=>S-_),w=F.indexOf(m.chapter.chapter_number);let $;if(w===-1||w===F.length-1)$=Math.max(...F)+1;else{const S=F[w+1];S===m.chapter.chapter_number+1?$=S:$=m.chapter.chapter_number+1}try{const S=I("chapters.write",{project:m.project.slug,chapter:$}),_=new URL(S,window.location.origin);_.searchParams.set("ai_generate","true"),_.searchParams.set("generation_type","progressive"),J.visit(_.toString())}catch(S){console.error("âŒ Error generating next chapter:",S)}}}}function zn(m,x,i,R){const a=g(!1),C=g(0),f=g(!1),F=E=>{if(!E)return 0;const pe=E.replace(/<[^>]*>/g,"").trim().replace(/\s+/g," ");if(!pe)return 0;const se=pe.match(/\b\w+\b/g);return se?se.length:0},w=k(()=>F(i.value)),$=k(()=>w.value>=800),S=()=>`defense_generation_triggered_${m.id}_ch_${x.chapter_number}`,_=()=>{const E=S();return localStorage.getItem(E)==="true"},p=()=>{const E=S();localStorage.setItem(E,"true"),a.value=!0},j=()=>{const E=S();localStorage.removeItem(E),a.value=!1,console.log(`ðŸ”„ DEFENSE WATCHER: Reset generation trigger for Chapter ${x.chapter_number}`)},L=Br(async()=>{if(!f.value)return;const E=w.value;console.log(`ðŸ“Š DEFENSE WATCHER: Word count check - Chapter ${x.chapter_number}: ${E} words`),E<800*.8&&a.value&&(console.log("â¬‡ï¸ DEFENSE WATCHER: Content dropped below 80% of threshold, resetting trigger"),j()),C.value=E},2e3),V=()=>f.value?void 0:(f.value=!0,a.value=_(),C.value=w.value,console.log(`ðŸ‘€ DEFENSE WATCHER: Started watching Chapter ${x.chapter_number}`),console.log(`   Initial word count: ${C.value}`),console.log(`   Generation already triggered: ${a.value}`),console.log("   Threshold: 800 words"),te(i,(ce,pe)=>{ce!==pe&&L()},{immediate:!1})),de=()=>{f.value=!1,L.cancel(),console.log(`ðŸ›‘ DEFENSE WATCHER: Stopped watching Chapter ${x.chapter_number}`)},y=async()=>{console.log(`ðŸ” DEFENSE WATCHER: Force checking Chapter ${x.chapter_number}`),await L(),L.flush()},u=k(()=>{const E=w.value;return E>0&&E<800&&!a.value}),A=k(()=>{const E=w.value/800*100;return Math.min(E,100)}),Y=k(()=>{const E=800-w.value;return Math.max(E,0)});return{isWatching:f,hasTriggeredGeneration:a,currentWordCount:w,lastWordCount:C,meetsThreshold:$,shouldShowProgressIndicator:u,progressPercentage:A,wordsRemaining:Y,startWatching:V,stopWatching:de,forceCheck:y,resetGenerationTrigger:j,markGenerationTriggered:p,getStatusMessage:()=>{const E=w.value;return a.value?`Defense questions available (${E} words)`:E>=800?`Ready for defense questions (${E} words)`:E>0?`${800-E} more words needed for defense questions`:"Start writing to enable defense questions (800 words needed)"},countWords:F,DEFENSE_WORD_COUNT_THRESHOLD:800}}function Pn({props:m,chapterContent:x,currentWordCount:i,ensureBalance:R,estimates:M}){const a=g([]),C=g(!1),f=g(!1),F=g(null),w=g(!1),$=k(()=>m.chapter),{hasTriggeredGeneration:S,startWatching:_,stopWatching:p,forceCheck:j,getStatusMessage:L,markGenerationTriggered:V,meetsThreshold:de,shouldShowProgressIndicator:y,progressPercentage:u,wordsRemaining:A,DEFENSE_WORD_COUNT_THRESHOLD:Y}=zn(m.project,m.chapter,x),ue=(h,N)=>`defense_auto_generate_${h}_ch_${N}`,E=()=>{try{return localStorage.getItem(ue(m.project.id,m.chapter.chapter_number))==="true"}catch(h){return console.warn("Failed to load defense auto-generation preference:",h),!1}},ce=h=>{try{localStorage.setItem(ue(m.project.id,m.chapter.chapter_number),String(h))}catch(N){console.warn("Failed to save defense auto-generation preference:",N)}};w.value=E();const pe=()=>{if(!a.value.length||!F.value)return!0;const h=new Date(Date.now()-360*60*1e3);return F.value<h},se=async(h=!1,N={})=>{if(C.value)return;const q=N.skipGeneration??!0;C.value=!0;try{console.log("Loading defense questions with params:",{project_id:m.project.id,chapter_number:$.value?.chapter_number,limit:5,force_refresh:h,skip_generation:q});const T=await ie.get(`/api/projects/${m.project.id}/defense/questions`,{params:{chapter_number:$.value?.chapter_number||null,limit:5,force_refresh:h?1:0,skip_generation:q?1:0},headers:{Accept:"application/json","X-Requested-With":"XMLHttpRequest"}});if(console.log("Defense questions loaded:",T.data),a.value=T.data.questions||[],F.value=new Date,T.data.questions&&T.data.questions.length>0){const G=`defense_questions_${m.project.id}_chapter_${$.value?.chapter_number}`;localStorage.setItem(G,JSON.stringify({questions:T.data.questions,chapter_number:$.value?.chapter_number,loaded_at:new Date().toISOString()}))}else h||(console.log("No existing questions found for this chapter"),console.log(`Current word count: ${i.value}/${Y}`),console.log('User must click "Generate Questions" button to create defense questions'))}catch(T){if(console.error("Failed to load defense questions:",T),T.response)if(console.error("Response status:",T.response.status),console.error("Response data:",T.response.data),T.response.status===422){const G=Object.values(T.response.data.errors||{})[0];G&&Array.isArray(G)?D.error(`Validation Error: ${G[0]}`):D.error("Invalid request parameters. Please refresh the page.")}else T.response.status===500?D.error("Server error. Please try again later."):D.error("Failed to load defense questions");else T.request?(console.error("No response received:",T.request),D.error("Network error. Please check your connection.")):(console.error("Error setting up request:",T.message),D.error("An unexpected error occurred"));a.value=[]}finally{C.value=!1}},Se=h=>h?h.replace(/<[^>]*>/g," ").trim().split(/\s+/).filter(N=>N.length>0).length:0,W=async(h={})=>{if(f.value)return;const N=h.autoTriggered??!1,q=M.defense();if(R(q,"generate defense questions")){f.value=!0;try{const T=await ie.post(`/api/projects/${m.project.id}/defense/questions/generate`,{chapter_number:$.value.chapter_number},{headers:{"X-CSRF-TOKEN":document.querySelector('meta[name="csrf-token"]')?.getAttribute("content"),Accept:"application/json","Content-Type":"application/json"}});if(T.data&&T.data.questions){a.value=T.data.questions,F.value=new Date;const G=T.data.questions.reduce((z,Re)=>{const Ie=Se(Re.question),st=Se(Re.suggested_answer),rt=(Re.key_points||[]).reduce((re,ge)=>re+Se(ge),0);return z+Ie+st+rt},0),Z=`defense_questions_${m.project.id}_chapter_${$.value?.chapter_number}`;localStorage.setItem(Z,JSON.stringify({questions:T.data.questions,chapter_number:$.value?.chapter_number,loaded_at:new Date().toISOString()})),D.success(`Generated ${T.data.questions.length} new questions`),mn(G||M.defense(),"Defense questions","chapter",m.chapter.id).catch(z=>console.error("Failed to record word usage (defense):",z)),S.value=!0,V(),N&&console.log("Auto-generated defense questions after meeting threshold.")}}catch(T){console.error("Failed to generate defense questions:",T),D.error("Failed to generate defense questions")}finally{f.value=!1}}},X=async()=>{!w.value||f.value||C.value||S.value||!de.value||a.value.length>0||await W({autoTriggered:!0})},et=h=>{w.value=h,ce(h),h&&X()},De=async(h,N)=>{try{await ie.patch(`/api/projects/${m.project.id}/defense/questions/${h}`,{user_marked_helpful:N},{headers:{"X-CSRF-TOKEN":document.querySelector('meta[name="csrf-token"]')?.getAttribute("content"),Accept:"application/json","Content-Type":"application/json"}});const q=a.value.find(T=>T.id===h);q&&(q.user_marked_helpful=N),D.success(N?"Question marked as helpful":"Removed helpful mark")}catch(q){console.error("Failed to mark question:",q),D.error("Failed to update question")}},tt=async h=>{try{await ie.delete(`/api/projects/${m.project.id}/defense/questions/${h}`,{headers:{"X-CSRF-TOKEN":document.querySelector('meta[name="csrf-token"]')?.getAttribute("content"),Accept:"application/json"}}),a.value=a.value.filter(N=>N.id!==h),localStorage.setItem(`defense_questions_${m.project.id}`,JSON.stringify({questions:a.value,loaded_at:new Date().toISOString()})),D.success("Question hidden")}catch(N){console.error("Failed to hide question:",N),D.error("Failed to hide question")}},qe=async()=>{const h=`defense_questions_${m.project.id}_chapter_${$.value?.chapter_number}`,N=localStorage.getItem(h);let q=!0;if(N){const T=JSON.parse(N),G=new Date(T.loaded_at),Z=new Date(Date.now()-360*60*1e3);G>Z&&T.chapter_number===$.value?.chapter_number&&(a.value=T.questions,F.value=G,q=!1)}q&&await se(!1,{skipGeneration:!0})};return te(()=>m.chapter,async()=>{a.value=[],p(),_(),w.value=E(),await se(!1,{skipGeneration:!0}),await Ne(()=>{j(),X()})},{immediate:!1}),te([i,w],()=>{X()}),Pe(async()=>{await qe(),_(),await Ne(()=>{j(),X()})}),{defenseQuestions:a,isLoadingDefenseQuestions:C,isGeneratingDefenseQuestions:f,autoGenerateDefense:w,shouldLoadDefenseQuestions:pe,loadDefenseQuestions:se,generateNewDefenseQuestions:W,markQuestionHelpful:De,hideQuestion:tt,handleDefenseAutoToggle:et,attemptAutoGenerateDefense:X,getDefenseStatusMessage:L,shouldShowDefenseProgress:y,defenseProgressPercentage:u,defenseWordsRemaining:A,hasTriggeredGeneration:S,meetsDefenseThreshold:de}}const Mn={class:"flex items-center justify-between"},Nn={class:"space-y-1 w-full max-w-[520px]"},Ln={class:"flex items-center justify-between gap-3"},On={class:"flex flex-col"},Wn={class:"flex items-center gap-2"},qn={class:"flex items-center justify-between px-6 py-2 border-b border-border/30 bg-muted/5"},In={class:"flex items-center gap-2"},Gn={class:"space-y-1 relative z-10"},Bn={class:"text-sm font-medium text-foreground"},Hn={class:"text-[10px] text-muted-foreground line-clamp-2 leading-relaxed"},Un={class:"flex-1 relative bg-background"},Qn={class:"px-12 py-10 min-h-[500px]"},Kn={class:"sticky bottom-0 z-10 border-t border-border/30 bg-background/80 backdrop-blur-md p-4 flex items-center justify-between"},Vn={class:"text-xs text-muted-foreground"},Xn={class:"flex items-center gap-2"},$s=ct({__name:"ChapterEditorPaperCard",props:{context:{}},setup(m){const i=m.context,R=k(()=>{const C=i.getSectionInfo(i.nextSection);return i.aiChapterAnalysis?.section||C}),M=k(()=>R.value?.name||""),a=k(()=>R.value?.description||"");return(C,f)=>(b(),P(e(oe),{class:"w-full max-w-[850px] min-h-[calc(100vh-180px)] flex flex-col bg-background shadow-xl shadow-black/5 ring-1 ring-black/5 dark:ring-white/10 rounded-xl overflow-hidden transition-all duration-300"},{default:n(()=>[r(e(le),{class:"flex-shrink-0 border-b border-border/30 px-8 py-6 bg-background/50 backdrop-blur-sm sticky top-0 z-10"},{default:n(()=>[s("div",Mn,[s("div",Nn,[s("div",Ln,[s("div",On,[r(e(yn),{for:"chapter-title",class:"text-xs font-medium text-zinc-500 dark:text-zinc-400 uppercase tracking-wider"},{default:n(()=>[...f[3]||(f[3]=[l("Chapter Title",-1)])]),_:1}),r(e(wn),{id:"chapter-title",modelValue:e(i).chapterTitle,"onUpdate:modelValue":f[0]||(f[0]=F=>e(i).chapterTitle=F),placeholder:"Enter chapter title...",class:"h-auto p-0 border-0 bg-transparent text-2xl font-bold placeholder:text-muted-foreground/40 focus-visible:ring-0 px-0 text-foreground"},null,8,["modelValue"])]),s("div",Wn,[r(e(je),{variant:e(i).chapter.status==="approved"?"default":"secondary",class:"rounded-full px-3"},{default:n(()=>[l(c(e(i).chapter.status.replace("_"," ")),1)]),_:1},8,["variant"]),r(e(je),{variant:"outline",class:Ze(["rounded-full px-3 transition-colors",{"text-green-600 border-green-200 bg-green-50 dark:bg-green-900/20 dark:border-green-800":(e(i).latestAnalysis?.total_score||0)>=80,"text-yellow-600 border-yellow-200 bg-yellow-50 dark:bg-yellow-900/20 dark:border-yellow-800":(e(i).latestAnalysis?.total_score||0)>=70&&(e(i).latestAnalysis?.total_score||0)<80,"text-orange-600 border-orange-200 bg-orange-50 dark:bg-orange-900/20 dark:border-orange-800":(e(i).latestAnalysis?.total_score||0)>=60&&(e(i).latestAnalysis?.total_score||0)<70,"text-red-600 border-red-200 bg-red-50 dark:bg-red-900/20 dark:border-red-800":(e(i).latestAnalysis?.total_score||0)<60}])},{default:n(()=>[l(c(e(i).latestAnalysis?.total_score?Math.round(e(i).latestAnalysis.total_score):e(i).writingQualityScore)+"% Quality ",1)]),_:1},8,["class"])])])])])]),_:1}),r(e(ae),{class:"flex min-h-0 flex-1 flex-col p-0"},{default:n(()=>[s("div",qn,[s("div",In,[r(e(v),{onClick:e(i).togglePresentationMode,variant:e(i).showPresentationMode?"default":"ghost",size:"sm",class:"h-7 text-xs rounded-full text-zinc-700 dark:text-zinc-300 hover:text-foreground"},{default:n(()=>[r(e(Fs),{class:"mr-1.5 h-3.5 w-3.5"}),l(" "+c(e(i).showPresentationMode?"Edit":"Preview"),1)]),_:1},8,["onClick","variant"])]),s("div",Gn,[s("div",Bn,c(M.value),1),s("div",Hn,c(a.value),1)])]),s("div",Un,[Le(r(Ms,{modelValue:e(i).chapterContent,"onUpdate:modelValue":f[1]||(f[1]=F=>e(i).chapterContent=F),placeholder:"Start writing your chapter...","min-height":"500px",class:"min-h-[500px] px-8 py-6",ref:e(i).richTextEditor,"show-toolbar":!0,"streaming-mode":e(i).isStreamingMode,"is-generating":e(i).isGenerating,"generation-progress":e(i).generationProgress,"generation-percentage":e(i).generationPercentage,"generation-phase":e(i).generationPhase,"onUpdate:selectedText":e(i).setSelectedText},null,8,["modelValue","streaming-mode","is-generating","generation-progress","generation-percentage","generation-phase","onUpdate:selectedText"]),[[Oe,!e(i).showPresentationMode]]),Le(s("div",Qn,[r(Ns,{content:e(i).chapterContent,"show-font-controls":!1,class:"prose-lg mx-auto",style:{"font-family":"'Times New Roman', serif","line-height":"1.8"}},null,8,["content"])],512),[[Oe,e(i).showPresentationMode]])])]),_:1}),s("div",Kn,[s("div",Vn,c(e(i).isSaving?"Saving...":"All changes saved"),1),s("div",Xn,[r(e(v),{onClick:f[2]||(f[2]=()=>e(i).save(!1)),disabled:!e(i).isValid||e(i).isSaving,size:"sm",variant:"ghost",class:"h-8 rounded-full text-zinc-700 dark:text-zinc-300 hover:text-foreground"},{default:n(()=>[r(e(At),{class:"mr-2 h-3.5 w-3.5"}),f[4]||(f[4]=l(" Save Draft ",-1))]),_:1},8,["disabled"]),r(e(v),{onClick:e(i).goToBulkAnalysis,variant:"outline",size:"sm",class:"h-8 rounded-full"},{default:n(()=>[r(e(zs),{class:"mr-2 h-3.5 w-3.5"}),f[5]||(f[5]=l(" Run Bulk Analysis ",-1))]),_:1},8,["onClick"]),r(e(v),{onClick:e(i).markAsComplete,disabled:e(i).isSaving,size:"sm",class:"h-8 rounded-full bg-gradient-to-r from-primary to-primary/90 shadow-sm hover:shadow-md transition-all"},{default:n(()=>[r(e(dt),{class:"mr-2 h-3.5 w-3.5"}),f[6]||(f[6]=l(" Complete ",-1))]),_:1},8,["onClick","disabled"])])])]),_:1}))}}),Jn={class:"flex flex-col gap-4 p-1"},Yn={class:"p-1.5 rounded-lg bg-primary/10 text-primary"},Zn={class:"flex items-center gap-2"},eo={class:"space-y-3"},to={key:0,class:"space-y-2"},so={class:"flex items-center justify-between w-full relative z-10"},ro={class:"flex items-center gap-2 text-primary"},no={class:"space-y-1 relative z-10"},oo={class:"text-sm font-medium text-foreground"},ao={class:"text-[10px] text-muted-foreground line-clamp-2 leading-relaxed"},lo={key:0,class:"p-4 rounded-xl bg-green-500/10 border border-green-500/20 space-y-3"},io={class:"flex items-center gap-2 text-green-600 dark:text-green-400"},uo={class:"space-y-2"},co={class:"flex justify-between text-[10px] font-medium text-muted-foreground"},po={class:"grid grid-cols-2 gap-2 mt-2"},go={class:"p-1.5 rounded-full bg-blue-500/10 text-blue-500"},fo={class:"p-1.5 rounded-full bg-purple-500/10 text-purple-500"},mo={class:"p-1.5 rounded-full bg-orange-500/10 text-orange-500"},ho={class:"p-1.5 rounded-full bg-emerald-500/10 text-emerald-500"},vo={class:"p-1.5 rounded-full bg-amber-500/10 text-amber-500"},bo={class:"flex items-center gap-2"},xo={class:"p-1"},wo=ct({__name:"AISidebar",props:{project:{},chapter:{},isGenerating:{type:Boolean},selectedText:{},isLoadingSuggestions:{type:Boolean},showCitationHelper:{type:Boolean},chapterContent:{},cursorPosition:{},currentWordCount:{},targetWordCount:{},canUndo:{type:Boolean}},emits:["startStreamingGeneration","getAISuggestions","update:showCitationHelper","insert-citation","checkCitations","undoLastAction"],setup(m,{emit:x}){const i=m,R=x,M=g(i.project.settings?.writing_style||"Auto"),a=g(null),C=g(!1),f=g({expand:!1,improve:!1,rephrase:!1,cite:!1,"generate-full":!1,"generate-section":!1,custom:!1});te(M,async y=>{try{await ie.patch(route("projects.update",i.project.slug),{settings:{...i.project.settings||{},writing_style:y}}),D.success("Writing style saved")}catch(u){console.error("Failed to save writing style:",u),D.error("Failed to save preferences")}});const F=k(()=>!!i.chapter?.id&&!!i.chapter?.chapter_number),w=k(()=>i.chapterContent&&i.chapterContent.trim().length>0);k(()=>!w.value&&F.value),k(()=>!a.value&&F.value);const $=k(()=>!i.isGenerating&&!!i.chapterContent);k(()=>!i.isLoadingSuggestions&&!!i.selectedText);const S=k(()=>a.value&&a.value.section.name!=="NONE"?a.value.section.name.toLowerCase().replace(/\s+/g,"_"):L()),_=k(()=>!i.isGenerating&&!!i.chapter?.id),p=()=>[{id:"introduction",name:"Introduction",description:"Overview and objectives of this chapter"},{id:"content",name:"Main Content",description:"Chapter main content"},{id:"conclusion",name:"Conclusion",description:"Summary and transition to next chapter"}],j=async(y,u)=>{if(Object.values(f.value).some(A=>A)){D("Please wait for the current action to complete");return}try{switch(y in f.value&&(f.value[y]=!0),y){case"expand":i.selectedText?(R("startStreamingGeneration","expand",{selectedText:i.selectedText,style:M.value}),D("Expanding selected text...")):D.error("Please select text to expand");break;case"improve":R("startStreamingGeneration","improve",{style:M.value}),D("Improving chapter content...");break;case"rephrase":i.selectedText?(R("startStreamingGeneration","rephrase",{selectedText:i.selectedText,style:M.value}),D("Rephrasing selected text...")):D.error("Please select text to rephrase");break;case"cite":R("update:showCitationHelper",!0),D("Opening citation helper...");break;case"generate-full":R("startStreamingGeneration","progressive"),D("Generating complete chapter...");break;case"generate-section":const A=u?.section||S.value;R("startStreamingGeneration","section",{section:A,mode:"progressive"}),D(`Generating ${A} section...`);break;default:throw new Error(`Unknown action: ${y}`)}}catch(A){console.error(`Quick action '${y}' failed:`,A),D.error(`Failed to ${y.replace("-"," ")}. Please try again.`)}finally{setTimeout(()=>{y in f.value&&(f.value[y]=!1)},1e3)}},L=()=>{if(!w.value)return"introduction";const y=i.chapterContent.toLowerCase(),u=p();for(const A of u)if(![A.name.toLowerCase(),A.id.replace("_"," ")].some(E=>y.includes(E)))return A.id;return"conclusion"},V=y=>{const u=p();return u.find(A=>A.id===y)||u[0]},de=y=>{R("insert-citation",y)};return te(()=>i.chapter,y=>{y?.id&&(a.value=null)},{immediate:!1}),te(()=>i.chapterContent,y=>{a.value&&(!y||y.trim().length===0)&&(a.value=null)},{immediate:!1}),(y,u)=>(b(),O("div",Jn,[r(e(oe),{class:"border-none shadow-none bg-transparent"},{default:n(()=>[r(e(le),{class:"px-2 py-3"},{default:n(()=>[r(e(me),{class:"flex items-center gap-2 text-sm font-semibold text-foreground/80"},{default:n(()=>[s("div",Yn,[r(e(Me),{class:"h-4 w-4"})]),u[9]||(u[9]=l(" AI Assistant ",-1))]),_:1})]),_:1}),r(e(ae),{class:"px-2 space-y-6"},{default:n(()=>[r(e(Es),{open:!0,class:"space-y-2"},{default:n(()=>[r(e(Ts),{class:"flex w-full items-center justify-between text-xs font-medium text-muted-foreground hover:text-foreground transition-colors group"},{default:n(()=>[s("span",Zn,[r(e(Hr),{class:"h-3.5 w-3.5 text-amber-500/70 group-hover:text-amber-500 transition-colors"}),u[10]||(u[10]=l(" QUICK ACTIONS ",-1))]),r(e(rs),{class:"h-3 w-3 transition-transform duration-200 group-data-[state=open]:rotate-180"})]),_:1}),r(e(As),{class:"space-y-3 pt-1"},{default:n(()=>[s("div",eo,[r(We,{"enter-active-class":"transition-all duration-300 ease-out","enter-from-class":"opacity-0 scale-95 translate-y-1","enter-to-class":"opacity-100 scale-100 translate-y-0"},{default:n(()=>[a.value&&a.value.show_section_button?(b(),O("div",to,[r(e(v),{onClick:u[0]||(u[0]=A=>j("generate-section")),disabled:!_.value||C.value||y.isGenerating||f.value["generate-section"],variant:"outline",class:"w-full h-auto flex-col items-start gap-2 p-3 rounded-xl border-primary/20 bg-background/50 hover:bg-primary/5 hover:border-primary/40 transition-all duration-300 text-left group relative overflow-hidden"},{default:n(()=>[u[12]||(u[12]=s("div",{class:"absolute inset-0 bg-gradient-to-r from-primary/5 to-transparent opacity-0 group-hover:opacity-100 transition-opacity"},null,-1)),s("div",so,[s("div",ro,[r(e(ns),{class:"h-3.5 w-3.5"}),u[11]||(u[11]=s("span",{class:"text-xs font-semibold"},"Write Next Section",-1))]),f.value["generate-section"]?(b(),P(e(ut),{key:0,class:"h-3 w-3 animate-spin text-primary"})):K("",!0)]),s("div",no,[s("div",oo,c(a.value?.section.name||V(S.value).name),1),s("div",ao,c(a.value?.section.description||V(S.value).description),1)])]),_:1},8,["disabled"])])):K("",!0)]),_:1}),r(We,{"enter-active-class":"transition-all duration-300 ease-out","enter-from-class":"opacity-0 scale-95 translate-y-1","enter-to-class":"opacity-100 scale-100 translate-y-0"},{default:n(()=>[a.value&&a.value.show_full_chapter_button?(b(),P(e(v),{key:0,onClick:u[1]||(u[1]=A=>j("generate-full")),disabled:y.isGenerating||C.value||f.value["generate-full"],variant:"ghost",class:"w-full h-9 justify-start gap-2 px-3 rounded-lg text-xs text-muted-foreground hover:text-primary hover:bg-primary/5"},{default:n(()=>[r(e(Ur),{class:"h-3.5 w-3.5"}),u[13]||(u[13]=s("span",null,"Generate Complete Chapter",-1))]),_:1},8,["disabled"])):K("",!0)]),_:1}),r(We,{"enter-active-class":"transition-all duration-500 ease-out","enter-from-class":"opacity-0 scale-95 translate-y-2","enter-to-class":"opacity-100 scale-100 translate-y-0"},{default:n(()=>[a.value&&a.value.status==="COMPLETE"?(b(),O("div",lo,[s("div",io,[r(e(Qr),{class:"h-4 w-4"}),u[14]||(u[14]=s("span",{class:"text-sm font-semibold"},"Chapter Complete",-1))]),s("div",uo,[s("div",co,[u[15]||(u[15]=s("span",null,"Progress",-1)),s("span",null,c(a.value.completion_percentage)+"%",1)]),r(e(kn),{"model-value":a.value.completion_percentage,class:"h-1.5"},null,8,["model-value"])])])):K("",!0)]),_:1})]),s("div",po,[r(e(v),{onClick:u[2]||(u[2]=A=>j("improve")),disabled:!$.value||y.isGenerating||f.value.improve,variant:"outline",class:"h-20 flex-col gap-2 rounded-xl border-border/50 bg-background/50 hover:bg-accent hover:border-accent transition-all duration-300"},{default:n(()=>[s("div",go,[r(e(Kr),{class:"h-4 w-4"})]),u[16]||(u[16]=s("span",{class:"text-xs font-medium"},"Improve",-1))]),_:1},8,["disabled"]),r(e(v),{onClick:u[3]||(u[3]=A=>j("expand")),disabled:!y.selectedText||y.isGenerating||f.value.expand,variant:"outline",class:"h-20 flex-col gap-2 rounded-xl border-border/50 bg-background/50 hover:bg-accent hover:border-accent transition-all duration-300"},{default:n(()=>[s("div",fo,[r(e(Vr),{class:"h-4 w-4"})]),u[17]||(u[17]=s("span",{class:"text-xs font-medium"},"Expand",-1))]),_:1},8,["disabled"]),r(e(v),{onClick:u[4]||(u[4]=A=>j("cite")),disabled:y.isGenerating||f.value.cite,variant:"outline",class:"h-20 flex-col gap-2 rounded-xl border-border/50 bg-background/50 hover:bg-accent hover:border-accent transition-all duration-300"},{default:n(()=>[s("div",mo,[r(e(Xr),{class:"h-4 w-4"})]),u[18]||(u[18]=s("span",{class:"text-xs font-medium"},"Cite",-1))]),_:1},8,["disabled"]),r(e(v),{onClick:u[5]||(u[5]=A=>j("rephrase")),disabled:!y.selectedText||y.isGenerating||f.value.rephrase,variant:"outline",class:"h-20 flex-col gap-2 rounded-xl border-border/50 bg-background/50 hover:bg-accent hover:border-accent transition-all duration-300"},{default:n(()=>[s("div",ho,[r(e(Jr),{class:"h-4 w-4"})]),u[19]||(u[19]=s("span",{class:"text-xs font-medium"},"Rephrase",-1))]),_:1},8,["disabled"]),y.canUndo?(b(),P(e(v),{key:0,onClick:u[6]||(u[6]=A=>R("undoLastAction")),variant:"outline",class:"h-20 flex-col gap-2 rounded-xl border-border/50 bg-background/50 hover:bg-amber-500/10 hover:border-amber-500/30 transition-all duration-300 col-span-2"},{default:n(()=>[s("div",vo,[r(e(Yr),{class:"h-4 w-4"})]),u[20]||(u[20]=s("span",{class:"text-xs font-medium"},"Undo Last AI Change",-1))]),_:1})):K("",!0)])]),_:1})]),_:1}),r(e(Ye),{class:"bg-border/50"}),r(e(Es),{open:!0,class:"space-y-2"},{default:n(()=>[r(e(Ts),{class:"flex w-full items-center justify-between text-xs font-medium text-muted-foreground hover:text-foreground transition-colors group"},{default:n(()=>[s("span",bo,[r(e(ns),{class:"h-3.5 w-3.5 text-indigo-500/70 group-hover:text-indigo-500 transition-colors"}),u[21]||(u[21]=l(" WRITING STYLE ",-1))]),r(e(rs),{class:"h-3 w-3 transition-transform duration-200 group-data-[state=open]:rotate-180"})]),_:1}),r(e(As),{class:"pt-1"},{default:n(()=>[s("div",xo,[r(e(Cn),{modelValue:M.value,"onUpdate:modelValue":u[7]||(u[7]=A=>M.value=A)},{default:n(()=>[r(e(Sn),{class:"w-full bg-muted/30 border-border/50 text-xs font-medium h-9"},{default:n(()=>[r(e(En),{placeholder:"Select style"})]),_:1}),r(e(Tn),null,{default:n(()=>[r(e(An),null,{default:n(()=>[r(e(_n),{class:"text-[10px] text-muted-foreground uppercase tracking-wider"},{default:n(()=>[...u[22]||(u[22]=[l(" Style Preference",-1)])]),_:1}),r(e(ze),{value:"Auto"},{default:n(()=>[...u[23]||(u[23]=[s("div",{class:"flex flex-col gap-0.5"},[s("span",{class:"font-medium"},"Auto (AI Decides)"),s("span",{class:"text-[10px] text-muted-foreground"},"Best fit for the content")],-1)])]),_:1}),r(e(ze),{value:"Academic Formal"},{default:n(()=>[...u[24]||(u[24]=[l("Academic Formal",-1)])]),_:1}),r(e(ze),{value:"Academic Casual"},{default:n(()=>[...u[25]||(u[25]=[l("Academic Casual",-1)])]),_:1}),r(e(ze),{value:"Technical"},{default:n(()=>[...u[26]||(u[26]=[l("Technical",-1)])]),_:1}),r(e(ze),{value:"Analytical"},{default:n(()=>[...u[27]||(u[27]=[l("Analytical",-1)])]),_:1}),r(e(ze),{value:"Research-Heavy"},{default:n(()=>[...u[28]||(u[28]=[l("Research-Heavy",-1)])]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"])])]),_:1})]),_:1})]),_:1})]),_:1}),r($n,{"show-citation-helper":y.showCitationHelper,"chapter-content":y.chapterContent,"chapter-id":y.chapter?.id||0,"onUpdate:showCitationHelper":u[8]||(u[8]=A=>R("update:showCitationHelper",A)),onInsertCitation:de},null,8,["show-citation-helper","chapter-content","chapter-id"])]))}}),yo=Ls(wo,[["__scopeId","data-v-e30bcf5b"]]),_o={class:"h-14 flex items-center justify-between px-4 border-b border-border/40 shrink-0"},ko={class:"flex-1 overflow-y-auto custom-scrollbar"},Co={class:"p-4 space-y-6"},js=ct({__name:"ChapterEditorRightSidebar",props:{project:{},chapter:{},isGenerating:{type:Boolean},selectedText:{},isLoadingSuggestions:{type:Boolean},showCitationHelper:{type:Boolean},chapterContent:{},currentWordCount:{},targetWordCount:{},handleAIGeneration:{type:Function},getAISuggestions:{type:Function},updateCitationHelper:{type:Function},insertCitation:{type:Function},checkCitations:{type:Function},showDefensePrep:{type:Boolean},defenseQuestions:{},isLoadingDefenseQuestions:{type:Boolean},isGeneratingDefenseQuestions:{type:Boolean},chapterContext:{},defenseWatcher:{},autoGenerateDefense:{type:Boolean},handleDefensePanelToggle:{type:Function},generateNewDefenseQuestions:{type:Function},handleDefenseAutoToggle:{type:Function},refreshDefenseQuestions:{type:Function},markQuestionHelpful:{type:Function},hideQuestion:{type:Function},isCollapsed:{type:Boolean},containerClass:{}},setup(m){const x=m;return(i,R)=>Le((b(),O("aside",{class:Ze(x.containerClass)},[s("div",_o,[R[1]||(R[1]=s("span",{class:"text-sm font-semibold tracking-tight text-foreground"},"Writing Assistant",-1)),r(e(Q),null,{default:n(()=>[r(e(H),{asChild:""},{default:n(()=>[r(e(v),{variant:"ghost",size:"icon",class:"h-7 w-7"},{default:n(()=>[r(e(zs),{class:"h-3.5 w-3.5"})]),_:1})]),_:1}),r(e(U),null,{default:n(()=>[...R[0]||(R[0]=[l("Manage Citations",-1)])]),_:1})]),_:1})]),s("div",ko,[s("div",Co,[r(yo,{project:x.project,chapter:x.chapter,"is-generating":x.isGenerating,"selected-text":x.selectedText,"is-loading-suggestions":x.isLoadingSuggestions,"show-citation-helper":x.showCitationHelper,"chapter-content":x.chapterContent,"current-word-count":x.currentWordCount,"target-word-count":x.targetWordCount,onStartStreamingGeneration:x.handleAIGeneration,onGetAiSuggestions:x.getAISuggestions,"onUpdate:showCitationHelper":x.updateCitationHelper,onInsertCitation:x.insertCitation,onCheckCitations:x.checkCitations},null,8,["project","chapter","is-generating","selected-text","is-loading-suggestions","show-citation-helper","chapter-content","current-word-count","target-word-count","onStartStreamingGeneration","onGetAiSuggestions","onUpdate:showCitationHelper","onInsertCitation","onCheckCitations"])])])],2)),[[Oe,!x.isCollapsed]])}});function So(m){const x=g({sentences:0,paragraphs:0,readingTime:0,avgWordLength:0,uniqueWords:0,commonWords:[]}),i=k(()=>m.value?m.value.split(/\s+/).filter(a=>a.length>0).length:0),R=()=>{if(!m.value){x.value={sentences:0,paragraphs:0,readingTime:0,avgWordLength:0,uniqueWords:0,commonWords:[]};return}const a=m.value,C=a.split(/\s+/).filter(_=>_.length>0),f=a.split(/[.!?]+/).filter(_=>_.trim().length>0),F=a.split(`

`).filter(_=>_.trim().length>0),w=new Map;C.forEach(_=>{const p=_.toLowerCase().replace(/[^a-z0-9]/g,"");p&&w.set(p,(w.get(p)||0)+1)});const $=new Set(["the","a","an","and","or","but","in","on","at","to","for","of","with","by","is","was","are","were"]),S=Array.from(w.entries()).filter(([_])=>!$.has(_)).sort((_,p)=>p[1]-_[1]).slice(0,5).map(([_])=>_);x.value={sentences:f.length,paragraphs:F.length,readingTime:Math.ceil(C.length/200),avgWordLength:C.reduce((_,p)=>_+p.length,0)/C.length,uniqueWords:w.size,commonWords:S}},M=k(()=>{if(!m.value)return 0;let a=0;const C=m.value;C.includes("##")&&(a+=20),C.length>1e3&&(a+=20),C.match(/\[.*?\]/g)&&(a+=15),(C.includes("**")||C.includes("*"))&&(a+=10);const f=C.split(/[.!?]+/).filter(w=>w.trim().length>0);if(f.length>0){const w=f.reduce(($,S)=>$+S.split(/\s+/).length,0)/f.length;w>10&&w<25&&(a+=20)}return C.split(`

`).filter(w=>w.trim().length>0).length>3&&(a+=15),Math.min(a,100)});return{writingStats:x,currentWordCount:i,writingQualityScore:M,calculateWritingStats:R}}function Eo(m){const x=g(!1),i=g(null),R=g([]),M=g(null),a=k(()=>{if(!i.value?.quality_level)return"text-muted-foreground";switch(i.value.quality_level){case"Excellent":return"text-green-600";case"Good":return"text-blue-600";case"Satisfactory":return"text-yellow-600";case"Needs Improvement":return"text-orange-600";case"Poor":return"text-red-600";default:return"text-muted-foreground"}}),C=k(()=>i.value?.scores?Object.entries(i.value.scores).sort(([,p],[,j])=>p.percentage-j.percentage).slice(0,3).map(([p,j])=>({category:p.replace(" & "," & "),percentage:Math.round(j.percentage),score:j.score,max:j.max})):[]),f=async()=>{try{x.value=!0,M.value=null,await ie.get("/sanctum/csrf-cookie");const p=await ie.post(I("api.chapters.analysis.analyze",{chapter:m}));if(p.data.success)return i.value=p.data.analysis,p.data.analysis;throw new Error(p.data.error||"Analysis failed")}catch(p){return M.value=p.response?.data?.error||p.message||"Analysis failed",console.error("Chapter analysis failed:",p),null}finally{x.value=!1}};return{isAnalyzing:x,latestAnalysis:i,analysisHistory:R,error:M,qualityLevelColor:a,topImprovementAreas:C,analyzeChapter:f,getLatestAnalysis:async()=>{try{await ie.get("/sanctum/csrf-cookie");const p=await ie.get(I("api.chapters.analysis.latest",{chapter:m}));return p.data.success?(i.value=p.data.analysis,p.data.analysis):(i.value=null,null)}catch(p){return p.response?.status!==404&&(M.value=p.response?.data?.error||p.message||"Failed to get analysis",console.error("Failed to get latest analysis:",p)),null}},getAnalysisHistory:async()=>{try{await ie.get("/sanctum/csrf-cookie");const p=await ie.get(I("api.chapters.analysis.history",{chapter:m}));if(p.data.success)return R.value=p.data.analyses,p.data.analyses;throw new Error(p.data.error||"Failed to get history")}catch(p){return M.value=p.response?.data?.error||p.message||"Failed to get analysis history",console.error("Failed to get analysis history:",p),[]}},autoAnalyze:async(p,j=500)=>{p>=j&&await f()},getScoreColor:(p,j)=>{const L=p/j*100;return L>=80?"text-green-600":L>=70?"text-blue-600":L>=60?"text-yellow-600":L>=40?"text-orange-600":"text-red-600"},getProgressVariant:p=>p>=80?"success":p>=60?"default":"destructive"}}const To={key:0,class:"min-h-screen bg-background text-foreground"},Ao={class:"mx-auto max-w-5xl p-6"},$o={class:"flex items-center justify-between gap-4"},jo={class:"flex items-center gap-3"},Do={class:"mt-6 grid gap-4"},Ro={class:"flex flex-wrap gap-x-6 gap-y-1"},Fo={class:"grid gap-1"},zo={class:"grid gap-1"},Po={class:"grid gap-4 md:grid-cols-3"},Mo={class:"mx-auto w-full max-w-5xl p-6"},No={class:"flex items-center justify-between gap-4"},Lo={class:"flex items-center gap-3"},Oo={class:"mt-6 grid gap-4"},Wo={class:"flex flex-wrap gap-x-6 gap-y-1"},qo={class:"grid gap-1"},Io={class:"grid gap-1"},Go={class:"grid gap-4 md:grid-cols-3"},Bo={key:0,class:"rounded-xl border border-border bg-card p-4"},Ho={key:2,class:"flex h-screen flex-col overflow-hidden bg-background dark:bg-background font-sans selection:bg-primary/20 transition-colors duration-300"},Uo={class:"relative z-20 flex flex-shrink-0 items-center justify-between border-b border-border/40 bg-background/60 p-4 backdrop-blur-xl supports-[backdrop-filter]:bg-background/40 transition-all duration-300"},Qo={class:"flex items-center gap-5"},Ko={class:"flex flex-col"},Vo={class:"text-lg font-bold tracking-tight text-foreground/90 font-display"},Xo={class:"flex items-center gap-3 text-xs text-muted-foreground"},Jo={class:"flex items-center gap-1.5"},Yo={class:"flex items-center gap-4"},Zo={class:"flex items-center p-1 rounded-full border border-border/40 bg-background/50 backdrop-blur-sm shadow-sm"},ea={class:"flex items-center gap-2"},ta={class:"relative z-20 h-[2px] w-full bg-border/20"},sa={key:0,class:"mx-3 my-2"},ra={class:"relative overflow-hidden rounded-xl border border-blue-200 bg-gradient-to-br from-blue-50 to-purple-50 p-3 shadow-sm dark:border-blue-800 dark:from-blue-950/30 dark:to-purple-950/30"},na={class:"relative z-10 mb-2 flex items-center justify-between"},oa={class:"flex items-center gap-2"},aa={class:"relative"},la={class:"flex h-6 w-6 items-center justify-center rounded-full bg-gradient-to-br from-blue-500 to-purple-600"},ia={class:"text-[10px] text-indigo-700 dark:text-indigo-300 font-medium tracking-wide uppercase"},da={class:"flex items-center gap-2"},ua={class:"relative z-10 mb-2"},ca={class:"mb-1.5 flex items-center justify-between"},pa={class:"text-[10px] tabular-nums text-indigo-600 dark:text-indigo-400 font-mono"},ga={class:"relative h-1.5 overflow-hidden rounded-full bg-indigo-100 dark:bg-indigo-950/50"},fa={class:"relative z-10 flex items-center gap-2.5 bg-indigo-50 dark:bg-indigo-900/20 p-2 rounded-lg border border-indigo-100 dark:border-indigo-800/30"},ma={class:"flex-shrink-0"},ha={key:0,class:"h-2 w-2 animate-bounce rounded-full bg-blue-500"},va={key:1,class:"flex gap-0.5"},ba={key:2,class:"h-2 w-2 animate-spin rounded-full border-2 border-blue-500 border-t-transparent"},xa={key:3,class:"h-2 w-2 rounded-full bg-green-500"},wa={key:4,class:"h-2 w-2 rounded-full bg-red-500"},ya={class:"flex-1 text-xs text-blue-800 dark:text-blue-200"},_a={class:"relative z-10 flex flex-1 overflow-hidden"},ka={key:0,class:"w-[320px] flex-shrink-0 border-r border-border/50 bg-background/80 backdrop-blur-xl shadow-xl z-20"},Ca={class:"h-full overflow-y-auto custom-scrollbar"},Sa={class:"p-4"},Ea={class:"mb-3"},Ta={class:"text-xs text-muted-foreground"},Aa={class:"flex min-h-0 flex-1 flex-col bg-transparent relative"},$a={class:"flex-1 overflow-hidden relative"},ja={"data-editor-scroll-container":"",class:"absolute inset-0 overflow-y-auto custom-scrollbar flex flex-col items-center py-8 px-4 sm:px-8"},Da={class:"flex h-full w-full overflow-hidden relative"},Ra={id:"left-sidebar-panel",class:"hidden lg:flex w-80 flex-col border-r border-border/40 bg-background/60 backdrop-blur-xl z-20 transition-all duration-300"},Fa={class:"h-14 flex items-center justify-between px-4 border-b border-border/40 shrink-0"},za={class:"p-4"},Pa={class:"flex-1 flex flex-col relative z-10 min-w-0 bg-background/30 dark:bg-background transition-all duration-300"},Ma={class:"md:hidden flex flex-wrap items-start justify-between border-b border-border/40 bg-background/60 backdrop-blur-md px-4 py-3 relative z-30 transition-all duration-300 gap-y-2"},Na={class:"flex items-center gap-2 flex-shrink-0 order-1"},La={class:"flex items-center order-2"},Oa={class:"order-3 w-full flex flex-col gap-3"},Wa={class:"flex items-start gap-3 w-full min-w-0"},qa={class:"flex items-center gap-2 justify-between mt-1"},Ia={class:"flex items-center gap-2"},Ga={class:"flex items-center gap-2"},Ba={key:0,class:"inline"},Ha={class:"hidden md:flex flex-col w-full z-30 bg-background/60 backdrop-blur-md transition-all duration-300 relative"},Ua={class:"h-10 border-b border-border/40 flex items-left justify-left px-4 bg-background/40"},Qa={class:"flex items-left gap-3"},Ka=["innerHTML"],Va={class:"h-12 border-b border-border/40 flex items-center justify-between px-4 gap-3 bg-muted/10"},Xa={class:"flex items-center gap-1"},Ja={class:"flex items-center gap-3"},Ya={id:"view-controls",class:"flex items-center bg-background/50 rounded-full border border-border/50 p-1 backdrop-blur-sm shadow-sm"},Za={class:"hidden xl:inline"},el={class:"hidden xl:inline"},tl={class:"flex items-center gap-2"},sl={class:"flex items-center gap-2 pl-2 border-l border-border/50"},rl={class:"inline"},nl={class:"flex-1 overflow-hidden relative group bg-background/20"},ol={key:0,class:"absolute top-8 left-0 right-0 z-40 px-4 flex justify-center pointer-events-none"},al={class:"w-full max-w-md pointer-events-auto"},ll={class:"group relative overflow-hidden rounded-2xl border border-white/20 bg-white/80 dark:bg-zinc-900/80 p-5 shadow-2xl backdrop-blur-xl transition-all duration-300 dark:border-white/10 ring-1 ring-black/5 dark:ring-white/5"},il={class:"relative flex items-center gap-4"},dl={class:"relative flex-shrink-0"},ul={class:"h-10 w-10 rounded-full bg-gradient-to-br from-blue-600 to-purple-600 flex items-center justify-center shadow-lg shadow-blue-500/20 z-10 relative"},cl={class:"flex-1 min-w-0"},pl={class:"flex items-center justify-between mb-2"},gl={class:"text-xs font-mono font-bold text-primary bg-primary/10 px-2 py-0.5 rounded-md border border-primary/20"},fl={class:"h-1.5 w-full bg-zinc-200 dark:bg-zinc-800 rounded-full overflow-hidden backdrop-blur-sm"},ml={class:"mt-2.5 flex items-center justify-between"},hl={class:"text-[10px] font-medium text-muted-foreground truncate max-w-[200px] flex items-center gap-1.5"},vl={class:"mx-auto py-12 px-6 sm:px-10 min-h-full"},bl={class:"min-h-[600px] pb-32"},xl={class:"pb-32"},wl={id:"editor-footer",class:"h-10 border-t border-border/30 bg-background/40 backdrop-blur-sm flex items-center justify-between px-4 text-[10px] text-muted-foreground shrink-0 relative"},yl={class:"hidden sm:flex items-center gap-3"},_l={class:"hidden md:inline"},kl={class:"absolute left-1/2 -translate-x-1/2 flex items-center bg-background/50 rounded-full border border-border/40 p-0.5 shadow-sm"},Cl={class:"px-3 font-bold text-[11px] min-w-[80px] text-center border-l border-r border-border/40 text-foreground/80"},Sl={class:"hidden sm:flex items-center gap-2"},El={key:0,class:"text-green-500 flex items-center gap-1 ml-2"},Tl={class:"flex items-center gap-3 mb-2"},Al={class:"w-10 h-10 rounded-full bg-amber-500/20 flex items-center justify-center"},$l={class:"list-disc list-inside text-muted-foreground space-y-1 ml-2"},jl={key:0,class:"fixed inset-0 bg-black/50 flex items-center justify-center z-50"},Dl={class:"text-slate-600 dark:text-slate-300 mb-4"},Rl={class:"font-semibold text-amber-600 dark:text-amber-400"},Fl={class:"flex flex-col sm:flex-row gap-3"},Ds="chapter_editor",zl=1e3,Pl=ct({__name:"ChapterEditor",props:{project:{},chapter:{},allChapters:{},facultyChapters:{},mode:{}},setup(m){const x=lt(()=>it(()=>import("./ChapterNavigation-C8s9l8Fw.js"),__vite__mapDeps([0,1,2,3,4,5,6,7]))),i=lt(()=>it(()=>import("./MobileNavOverlay-CidJnbiO.js"),__vite__mapDeps([8,3,4,9,2,1,5,6,7,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50]))),R=lt(()=>it(()=>import("./ChatModeLayout-BoRud7lo.js"),__vite__mapDeps([51,3,4,7,2,11,14,5,37,17,42,38,39,40,43,9,34,29,30,31,32,36,35,22,41,52]))),M=lt(()=>it(()=>import("./CitationVerificationLayout-DIz0rwuK.js"),__vite__mapDeps([53,7,3,4,2,11,12,14,5,54,42,37,38,39,17,40,43]))),a=m,C=Rs(),f=g(null),F=g(null),w=g(!1),$=g(!1),S=g(null),_=g(null),p=g(""),j=g(""),L=g(!1),V=g(!1),de=k(()=>L.value||V.value),y=k(()=>_.value===null?!1:_.value<3?p.value.trim().length>0:!0),u=k(()=>({page:"chapter_editor",project_id:a.project?.id,chapter_id:a.chapter?.id,path:typeof window<"u"?window.location.pathname:null})),A=g(!1),Y=g(null),ue=()=>document.querySelector('meta[name="csrf-token"]')?.getAttribute("content")||"",E=()=>{$.value=!1,S.value=null,_.value=null,p.value="",j.value=""},ce=async()=>{if(!(!C.props.auth?.user||!a.project?.id))try{const o=await fetch(I("api.feedback.eligibility",{project_id:a.project.id,source:Ds}));if(!o.ok)return;const t=await o.json();if(!t.eligible)return;if(t.existing_request_id){S.value=t.existing_request_id,$.value=!0;return}const d=await fetch(I("api.feedback.requests.store"),{method:"POST",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":ue()},body:JSON.stringify({project_id:a.project.id,source:Ds,context:u.value})});if(!d.ok)return;const B=await d.json();S.value=B.id,$.value=!0}catch(o){console.error("Failed to check feedback eligibility:",o)}},pe=async()=>{if(!S.value||!y.value){j.value=_.value&&_.value<3?"Please add a short comment.":"";return}L.value=!0,j.value="";try{const o=await fetch(I("api.feedback.requests.submit",{feedbackRequest:S.value}),{method:"POST",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":ue()},body:JSON.stringify({rating:_.value,comment:p.value.trim()||null})});if(!o.ok){const t=await o.json().catch(()=>({}));j.value=t?.errors?.comment?.[0]??"";return}E(),D.success("Thanks for the feedback!")}catch(o){console.error("Failed to submit feedback:",o)}finally{L.value=!1}},se=async()=>{if(!S.value){E();return}V.value=!0;try{await fetch(I("api.feedback.requests.dismiss",{feedbackRequest:S.value}),{method:"POST",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":ue()}})}catch(o){console.error("Failed to dismiss feedback prompt:",o)}finally{V.value=!1,E()}},Se=o=>{if(o){$.value=!0;return}if(L.value||V.value){$.value=o;return}se()};te([_,p],()=>{j.value&&(j.value="")});const W=g(!1),X=g(!1),et=g(!1),De=g(0);if(typeof window<"u"){const o=new URLSearchParams(window.location.search);X.value=o.has("theme_sandbox"),et.value=o.get("theme_sandbox")==="nolayout"||o.has("theme_sandbox_nolayout");const t=o.get("theme_sandbox_step"),d=t?Number.parseInt(t,10):0;De.value=Number.isFinite(d)?d:0}const{appearance:tt,isDark:qe}=Ps(),h=g({htmlHasDark:!1,background:"",foreground:"",card:"",sidebarBackground:"",bodyBg:"",insetBg:"",sampleBgBackground:"",sampleBgCard:"",sampleBgMuted:""}),N=g(null),q=g(null),T=g(null);function G(){if(typeof window>"u")return;const o=document.documentElement,t=window.getComputedStyle(o),d=document.querySelector('[data-slot="sidebar-inset"]'),B=d?window.getComputedStyle(d).backgroundColor:"";h.value={htmlHasDark:o.classList.contains("dark"),background:t.getPropertyValue("--background").trim(),foreground:t.getPropertyValue("--foreground").trim(),card:t.getPropertyValue("--card").trim(),sidebarBackground:t.getPropertyValue("--sidebar-background").trim(),bodyBg:window.getComputedStyle(document.body).backgroundColor,insetBg:B,sampleBgBackground:N.value?window.getComputedStyle(N.value).backgroundColor:"",sampleBgCard:q.value?window.getComputedStyle(q.value).backgroundColor:"",sampleBgMuted:T.value?window.getComputedStyle(T.value).backgroundColor:""}}const{chapterTitle:Z,chapterContent:z,showPreview:Re,isEditorDark:Ie,initChapterTheme:st,toggleChapterTheme:rt,isNativeFullscreen:re,selectedText:ge,showChatMode:Ee,showCitationMode:pt,showDefensePrep:$t,loadChatModeFromStorage:Os,saveChatModeToStorage:jt,showLeftSidebar:gt,showRightSidebar:ft,isMobile:mt,isLeftSidebarCollapsed:Ge,isRightSidebarCollapsed:Be,showLeftSidebarInFullscreen:He,showRightSidebarInFullscreen:Ue}=Rn(a),{balance:Ws,showPurchaseModal:Dt,requiredWordsForModal:qs,actionDescriptionForModal:Is,checkAndPrompt:Gs,closePurchaseModal:Bs,estimates:ht}=hn(),vt=(o,t)=>Gs(Math.max(1,Math.round(o)),t),{hasUnsavedChanges:Hs,isSaving:he,triggerAutoSave:Qe,save:we,clearAutoSave:Us}=vn({delay:1e4,onSave:Qt});let Rt=0;const Qs=()=>{const o=Date.now();o-Rt>zl&&(Rt=o,D.success("Saved",{duration:2e3}))},{contentHistory:Ks,historyIndex:Vs,addToHistory:Xs,undo:Js,redo:Ys}=jn(a.chapter.content||""),{writingStats:Ft,writingQualityScore:ye,calculateWritingStats:bt}=So(z),{isAnalyzing:Zs,latestAnalysis:er,getLatestAnalysis:tr}=Eo(a.chapter.id),fe=k(()=>{if(a.facultyChapters&&a.facultyChapters.length>0){const t=a.facultyChapters.find(d=>d.number===a.chapter.chapter_number);if(t?.word_count)return t.word_count}if(a.project?.outlines&&a.project.outlines.length>0){const t=a.project.outlines.find(d=>d.chapter_number===a.chapter.chapter_number);if(t?.target_word_count)return t.target_word_count}const o=a.project.type==="undergraduate"?2500:3500;return a.chapter.chapter_number===1||a.chapter.chapter_number===5?Math.round(o*.8):o}),{generateNextChapter:nt}=Fn({props:a,allChapters:a.allChapters,targetWordCount:fe,estimates:ht,ensureBalance:vt,save:we}),{currentWordCount:ne,progressPercentage:sr,DEFENSE_THRESHOLD:rr,countWords:nr}=bn(z,fe),xt=sr,zt=k(()=>({chapter:a.chapter,chapterTitle:Z,chapterContent:z,showPresentationMode:ke,togglePresentationMode:Yt,isStreamingMode:Lt,isGenerating:ee,generationProgress:Ke,generationPercentage:Fe,generationPhase:_e,aiChapterAnalysis,nextSection,getSectionInfo,writingStats:Ft,latestAnalysis:er,isAnalyzing:Zs,writingQualityScore:ye,isSaving:he,isValid:Xe,save:we,goToBulkAnalysis:kt,markAsComplete:Ct,richTextEditor:f,richTextEditorFullscreen:F,selectedText:ge,setSelectedText:o=>{ge.value=o}})),or=k(()=>({chapter_number:Bt.value.chapter_number,chapter_title:Bt.value.title,word_count:ne.value})),ar=k(()=>({meetsThreshold:yr.value,shouldShowProgress:vr.value,progressPercentage:br.value,wordsRemaining:xr.value,hasTriggeredGeneration:wr,threshold:rr,statusMessage:hr()})),Pt=k(()=>({project:ve.value,chapter:be.value,isGenerating:ee.value,selectedText:ge.value,isLoadingSuggestions:Nt.value,showCitationHelper:ot.value,chapterContent:z.value,currentWordCount:ne.value,targetWordCount:fe.value,handleAIGeneration:Wt,getAISuggestions:qt,updateCitationHelper:o=>{ot.value=o},insertCitation:Tr,checkCitations:It,showDefensePrep:$t.value,defenseQuestions:lr.value??[],isLoadingDefenseQuestions:ir.value,isGeneratingDefenseQuestions:dr.value,chapterContext:or.value,defenseWatcher:ar.value,autoGenerateDefense:ur.value,handleDefensePanelToggle:Wr,generateNewDefenseQuestions:pr,handleDefenseAutoToggle:mr,refreshDefenseQuestions:()=>Mt(!0,{skipGeneration:!0}),markQuestionHelpful:gr,hideQuestion:fr})),{defenseQuestions:lr,isLoadingDefenseQuestions:ir,isGeneratingDefenseQuestions:dr,autoGenerateDefense:ur,shouldLoadDefenseQuestions:cr,loadDefenseQuestions:Mt,generateNewDefenseQuestions:pr,markQuestionHelpful:gr,hideQuestion:fr,handleDefenseAutoToggle:mr,getDefenseStatusMessage:hr,shouldShowDefenseProgress:vr,defenseProgressPercentage:br,defenseWordsRemaining:xr,hasTriggeredGeneration:wr,meetsDefenseThreshold:yr}=Pn({props:a,chapterContent:z,currentWordCount:ne,ensureBalance:vt,estimates:ht}),{isGenerating:ee,generationProgress:Ke,generationPercentage:Fe,generationPhase:_e,estimatedTotalWords:_r,streamWordCount:wt,streamBuffer:Nl,lastStreamUpdate:Ll,originalContentForAppend:Ol,aiSuggestions:Wl,isLoadingSuggestions:Nt,showCitationHelper:ot,showPresentationMode:ke,isStreamingMode:Lt,showRecoveryDialog:kr,partialContentSaved:ql,savedWordCountOnError:Cr,isCollectingPapers:Il,paperCollectionProgress:Gl,paperCollectionPhase:Bl,collectedPapersCount:Hl,paperCollectionPercentage:Ul,currentSource:Ql,sourcesCompleted:Kl,papersPreview:Vl,paperCollectionData:Xl,paperCollectionInterval:Jl,reconnectAttempts:Yl,reconnectDelay:Zl,isReconnecting:ei,currentGenerationId:ti,currentGenerationType:si,eventSource:Ot,editorScrollRef:Sr,attachScroller:ri,smoothScrollToBottom:ni,forceScrollToBottom:oi,resetScroller:ai,isAutoScrollActive:li,isUserScrollingScroller:ii,scrollToBottom:di,checkConnectionQuality:ui,handleAIGeneration:Wt,handleRegenerateChapter:Er,getAISuggestions:qt,checkCitations:It,insertCitation:Tr,resumeGeneration:Ar,dismissRecovery:$r,checkForAutoGeneration:jr,stopGeneration:Ve,cleanupGenerationProtection:Gt}=xn({props:a,chapterContent:z,targetWordCount:fe,estimates:ht,ensureBalance:vt,save:we,triggerAutoSave:Qe,calculateWritingStats:bt,countWords:nr,selectedText:ge,richTextEditor:f,richTextEditorFullscreen:F,isNativeFullscreen:re}),Xe=k(()=>{const o=Z.value?.trim(),t=z.value?.trim();return o&&o.length>0&&t&&t.length>50}),ve=k(()=>a.project),be=k(()=>a.chapter),Ce=k(()=>a.allChapters),Bt=k(()=>a.chapter),Ht=k(()=>a.facultyChapters&&a.facultyChapters.length>0?a.facultyChapters.map(o=>{const t=a.allChapters.find(d=>d.chapter_number===o.number);return{chapter_number:o.number,title:o.title,exists:!!t,content:t?.content||null,status:t?t.status:"not_started"}}):a.project.outlines&&a.project.outlines.length>0?a.project.outlines.map(o=>{const t=a.allChapters.find(d=>d.chapter_number===o.chapter_number);return{chapter_number:o.chapter_number,title:o.chapter_title,exists:!!t,content:t?.content||null,status:t?t.status:"not_started"}}):a.allChapters.map(o=>({chapter_number:o.chapter_number,title:o.title,exists:!0,content:o.content,status:o.status}))),Te=k(()=>{const o=a.chapter.chapter_number;return Ht.value.find(t=>t.chapter_number===o+1)||null}),at=k(()=>{const o=a.chapter.chapter_number;return Ht.value.find(t=>t.chapter_number===o-1)||null}),Ut=k(()=>!Te.value||ee.value?!1:!Te.value.content||Te.value.content.trim().length<10),yt=()=>{Te.value&&(Te.value.exists?Ae(Te.value.chapter_number):nt())},Dr=()=>{at.value&&at.value.exists&&Ae(at.value.chapter_number)};async function Qt(o=!1){try{const t=await fetch(I("chapters.save",{project:a.project.id}),{method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json","X-Requested-With":"XMLHttpRequest","X-CSRF-TOKEN":document.querySelector('meta[name="csrf-token"]')?.getAttribute("content")||""},body:JSON.stringify({project_id:a.project.id,chapter_number:a.chapter.chapter_number,title:Z.value,content:z.value,auto_save:o,statistics:Ft.value,quality_score:ye.value})});console.log("Response status:",t.status,t.statusText),console.log("Response headers:",t.headers);const d=await t.text();console.log("Raw response:",d);let B;try{B=JSON.parse(d)}catch(xe){throw console.error("JSON parse error:",xe),console.error("Response was:",d),new Error(`Server returned non-JSON response: ${t.status} ${t.statusText}`)}t.ok}catch(t){throw o||D.error("âŒ Save Failed",{description:"Please try again or check your connection."}),t}}const Kt=()=>{const o=Js();o!==null&&(z.value=o,Qe())},Vt=()=>{const o=Ys();o!==null&&(z.value=o,Qe())},Rr=async()=>{w.value=!1,await Er(!0)},Ae=o=>{!ee.value&&Hs.value&&confirm("You have unsaved changes. Save before switching chapters?")&&we();const t=a.allChapters.find(xe=>xe.chapter_number===o),B=t?.content&&t.content.trim()!==""?"chapters.edit":"chapters.write";J.visit(I(B,{project:a.project.slug,chapter:o}),{only:["chapter","mode","allChapters"],preserveState:!0,preserveScroll:!1})},Xt=()=>document.fullscreenElement||document.webkitFullscreenElement||document.msFullscreenElement||null,Fr=async()=>{try{const o=document.documentElement;o.requestFullscreen?await o.requestFullscreen({navigationUI:"hide"}):o.webkitRequestFullscreen?await o.webkitRequestFullscreen():o.msRequestFullscreen&&await o.msRequestFullscreen()}catch(o){console.error("Error entering fullscreen:",o),D.error("Fullscreen Error",{description:"Unable to enter fullscreen mode"})}},zr=async()=>{try{document.exitFullscreen?await document.exitFullscreen():document.webkitExitFullscreen?await document.webkitExitFullscreen():document.msExitFullscreen&&await document.msExitFullscreen()}catch(o){console.error("Error exiting fullscreen:",o),D.error("Fullscreen Error",{description:"Unable to exit fullscreen mode"})}},_t=async()=>{if(Xt()){await zr();return}await Fr()},$e=()=>{re.value=!!Xt(),Ne(()=>{st(),X.value&&G()})},Jt=()=>{Ee.value=!Ee.value,Ee.value&&(pt.value=!1),jt(Ee.value)},Pr=()=>{Ee.value=!1,jt(!1)},Mr=()=>{pt.value=!1},Yt=()=>{ke.value=!ke.value},kt=()=>{J.visit(I("projects.analysis",{project:a.project.slug}))},Nr=()=>{Xs(z.value),Qe(),bt()},Zt=o=>{(o.ctrlKey||o.metaKey)&&o.key==="s"&&(o.preventDefault(),we(),Qs()),(o.ctrlKey||o.metaKey)&&!o.shiftKey&&o.key==="z"&&(o.preventDefault(),Kt()),(o.ctrlKey||o.metaKey)&&o.shiftKey&&o.key==="z"&&(o.preventDefault(),Vt()),(o.ctrlKey||o.metaKey)&&o.shiftKey&&(o.key==="f"||o.key==="F")&&(o.preventDefault(),_t())};Pe(()=>{const o=()=>{mt.value=window.innerWidth<1024};o(),window.addEventListener("resize",o),Ee.value=Os(),document.addEventListener("keydown",es),document.addEventListener("keydown",Zt),document.addEventListener("fullscreenchange",$e),document.addEventListener("webkitfullscreenchange",$e),document.addEventListener("msfullscreenchange",$e),$e(),bt(),jr(),st(),ce(),J.on("before",t=>W.value?!0:ee.value&&wt.value>0?(Y.value={url:t.detail.visit.url.href,event:t},A.value=!0,!1):!0)});const Lr=()=>{A.value=!1,W.value=!0,Ve&&Ve(),Gt(),Y.value&&J.visit(Y.value.url),Y.value=null,setTimeout(()=>{W.value=!1},1e3)},Or=()=>{A.value=!1,Y.value=null},es=o=>{if((o.ctrlKey||o.metaKey)&&!["INPUT","TEXTAREA","SELECT"].includes(o.target?.tagName))switch(o.key){case"ArrowLeft":o.preventDefault();const t=a.chapter.chapter_number-1;a.allChapters.find(Je=>Je.chapter_number===t)&&Ae(t);break;case"ArrowRight":o.preventDefault();const B=a.chapter.chapter_number+1;a.allChapters.find(Je=>Je.chapter_number===B)&&Ae(B);break}};Pe(()=>{const o=t=>{const d=B=>{const{scrollTop:xe,scrollHeight:Je,clientHeight:qr}=t,ss=B.deltaY,Ir=xe<=0,Gr=xe+qr>=Je;ss<0&&Ir||ss>0&&Gr||B.stopPropagation()};return t.addEventListener("wheel",d,{passive:!0}),()=>t.removeEventListener("wheel",d)};Ne(()=>{const t=document.querySelectorAll('[class*="overflow-y-auto"]'),d=[];t.forEach(B=>{if(B instanceof HTMLElement){const xe=o(B);d.push(xe)}}),window.__scrollChainCleanup=d})}),Zr(()=>{Us(),Ot.value&&Ot.value.close(),Gt(),document.removeEventListener("keydown",Zt),document.removeEventListener("keydown",es);const o=window.__scrollChainCleanup;o&&Array.isArray(o)&&(o.forEach(t=>t()),delete window.__scrollChainCleanup),document.removeEventListener("fullscreenchange",$e),document.removeEventListener("webkitfullscreenchange",$e),document.removeEventListener("msfullscreenchange",$e)}),te(()=>a.chapter,async o=>{Z.value=o.title||"",z.value=o.content||""},{immediate:!1});const Wr=async o=>{$t.value=o,o&&cr()&&await Mt(!1,{skipGeneration:!0})},ts=()=>{const o=[{popover:{title:"Welcome to the AI Assisted Editor",description:"Experience a powerful writing environment enhanced by AI. Generate an entire chapter with one click and access a suite of AI tools to refine your content.",popoverClass:"driver-popover-welcome"}},{element:"#back-to-project-btn",popover:{title:"Back to Project",description:"Return to your project dashboard."}},{element:"#left-sidebar-panel",popover:{title:"Chapter Navigation",description:"Use the Table of Contents to switch between chapters."},onHighlightStarted:()=>{Ge.value=!1},showOnMobile:!1},{element:"#view-controls",popover:{title:"View Options",description:"Customize your view with Preview, AI Chat, Fullscreen, and Dark Mode."}},{element:"#toggle-chat-mode",popover:{title:"AI Chat Assistant",description:"Open the AI assistant to help you write, brainstorm, or refine your content."}},{element:"#export-menu-container",popover:{title:"Export",description:"Export your chapter or entire project."}},{element:"#analyze-button",popover:{title:"Bulk Analysis",description:"Analyze content across chapters."}},{element:"#save-button",popover:{title:"Save Work",description:"Manually save your chapter. Auto-save is also active!"}},{element:"#mark-complete-btn",popover:{title:"Mark as Complete",description:"Finished writing? Mark the chapter as complete."}},{element:"#toggle-right-sidebar",popover:{title:"AI Tools Sidebar",description:"Toggle the sidebar to access AI tools like Smart Suggestions and Citation Helper."},showOnMobile:!1},{element:"#right-sidebar-panel",popover:{title:"AI Assistant Tools",description:"Access powerful AI features here."},onHighlightStarted:()=>{Be.value=!1},showOnMobile:!1},{element:"#editor-footer",popover:{title:"Writing Stats",description:"Track your word count, quality score, and readiness."}},{element:"#reset-tour-button",popover:{title:"Need Help?",description:"Click here anytime to restart this tour."}}];pn({showProgress:!0,animate:!0,steps:mt.value?o.filter(d=>d.showOnMobile!==!1):o}).drive()};Pe(()=>{if(C.props.auth?.user?.email){const o=`chapter_editor_tour_seen_${C.props.auth.user.email}`;localStorage.getItem(o)||setTimeout(()=>{ts(),localStorage.setItem(o,"true")},1e3)}}),te(z,Nr),te(Z,Qe);const Ct=async()=>{console.log("ðŸ”µ [MARK COMPLETE] Function called"),console.log("ðŸ”µ [MARK COMPLETE] Current word count:",ne.value);try{console.log("ðŸ”µ [MARK COMPLETE] Saving chapter..."),await we(!1),console.log("âœ… [MARK COMPLETE] Chapter saved");const o=I("chapters.mark-complete",{project:a.project.slug,chapter:a.chapter.chapter_number});console.log("ðŸ”µ [MARK COMPLETE] Posting to:",o),J.post(o,{},{onSuccess:()=>{console.log("âœ… [MARK COMPLETE] Request successful")},onError:t=>{console.error("âŒ [MARK COMPLETE] Request failed:",t)}})}catch(o){console.error("âŒ [MARK COMPLETE] Error:",o),D.error("Failed to save chapter before marking complete")}};return Pe(async()=>{await tr()}),Pe(()=>{X.value&&Ne(()=>G())}),te(qe,()=>{X.value&&Ne(()=>G())},{flush:"post"}),(o,t)=>(b(),P(e(gn),null,{default:n(()=>[r(Dn,{open:$.value,rating:_.value,comment:p.value,"is-submitting":de.value,"comment-error":j.value,"can-submit":y.value,"onUpdate:open":Se,"onUpdate:rating":t[0]||(t[0]=d=>_.value=d),"onUpdate:comment":t[1]||(t[1]=d=>p.value=d),onSubmit:pe,onDismiss:se},null,8,["open","rating","comment","is-submitting","comment-error","can-submit"]),X.value?(b(),O(os,{key:0},[et.value?(b(),O("div",To,[s("div",Ao,[s("div",$o,[t[35]||(t[35]=s("div",null,[s("h1",{class:"text-lg font-semibold"},"ChapterEditor Theme Sandbox"),s("p",{class:"text-sm text-muted-foreground"},"No layout mode. Use `?theme_sandbox=nolayout`.")],-1)),s("div",jo,[r(Cs),r(e(v),{variant:"outline",size:"sm",onClick:G},{default:n(()=>[...t[33]||(t[33]=[l("Refresh",-1)])]),_:1}),r(e(v),{variant:"outline",size:"sm",onClick:t[2]||(t[2]=d=>e(J).visit(o.window.location.pathname))},{default:n(()=>[...t[34]||(t[34]=[l("Exit",-1)])]),_:1})])]),s("div",Do,[r(e(oe),{class:"bg-card text-card-foreground"},{default:n(()=>[r(e(le),null,{default:n(()=>[r(e(me),{class:"text-base"},{default:n(()=>[...t[36]||(t[36]=[l("Theme State",-1)])]),_:1})]),_:1}),r(e(ae),{class:"space-y-2 text-sm"},{default:n(()=>[s("div",Ro,[s("div",null,[t[37]||(t[37]=s("span",{class:"text-muted-foreground"},"appearance:",-1)),l(" "+c(e(tt)),1)]),s("div",null,[t[38]||(t[38]=s("span",{class:"text-muted-foreground"},"isDark:",-1)),l(" "+c(e(qe)),1)]),s("div",null,[t[39]||(t[39]=s("span",{class:"text-muted-foreground"},"html.dark:",-1)),l(" "+c(h.value.htmlHasDark),1)]),s("div",null,[t[40]||(t[40]=s("span",{class:"text-muted-foreground"},"step:",-1)),l(" "+c(De.value),1)])]),r(e(Ye)),s("div",Fo,[s("div",null,[t[41]||(t[41]=s("span",{class:"text-muted-foreground"},"--background:",-1)),l(" "+c(h.value.background),1)]),s("div",null,[t[42]||(t[42]=s("span",{class:"text-muted-foreground"},"--foreground:",-1)),l(" "+c(h.value.foreground),1)]),s("div",null,[t[43]||(t[43]=s("span",{class:"text-muted-foreground"},"--card:",-1)),l(" "+c(h.value.card),1)]),s("div",null,[t[44]||(t[44]=s("span",{class:"text-muted-foreground"},"--sidebar-background:",-1)),l(" "+c(h.value.sidebarBackground),1)])]),r(e(Ye)),s("div",zo,[s("div",null,[t[45]||(t[45]=s("span",{class:"text-muted-foreground"},"body bg:",-1)),l(" "+c(h.value.bodyBg),1)]),s("div",null,[t[46]||(t[46]=s("span",{class:"text-muted-foreground"},"inset bg:",-1)),l(" "+c(h.value.insetBg),1)]),s("div",null,[t[47]||(t[47]=s("span",{class:"text-muted-foreground"},"sample bg-background:",-1)),l(" "+c(h.value.sampleBgBackground),1)]),s("div",null,[t[48]||(t[48]=s("span",{class:"text-muted-foreground"},"sample bg-card:",-1)),l(" "+c(h.value.sampleBgCard),1)]),s("div",null,[t[49]||(t[49]=s("span",{class:"text-muted-foreground"},"sample bg-muted:",-1)),l(" "+c(h.value.sampleBgMuted),1)])])]),_:1})]),_:1}),s("div",Po,[r(e(oe),{ref_key:"sampleBgBackgroundEl",ref:N,class:"bg-background"},{default:n(()=>[r(e(le),null,{default:n(()=>[r(e(me),{class:"text-base"},{default:n(()=>[...t[50]||(t[50]=[l("bg-background",-1)])]),_:1})]),_:1}),r(e(ae),{class:"text-sm text-muted-foreground"},{default:n(()=>[...t[51]||(t[51]=[l("Should flip with theme.",-1)])]),_:1})]),_:1},512),r(e(oe),{ref_key:"sampleBgCardEl",ref:q,class:"bg-card"},{default:n(()=>[r(e(le),null,{default:n(()=>[r(e(me),{class:"text-base"},{default:n(()=>[...t[52]||(t[52]=[l("bg-card",-1)])]),_:1})]),_:1}),r(e(ae),{class:"text-sm text-muted-foreground"},{default:n(()=>[...t[53]||(t[53]=[l("Card surface color.",-1)])]),_:1})]),_:1},512),r(e(oe),{ref_key:"sampleBgMutedEl",ref:T,class:"bg-muted"},{default:n(()=>[r(e(le),null,{default:n(()=>[r(e(me),{class:"text-base"},{default:n(()=>[...t[54]||(t[54]=[l("bg-muted",-1)])]),_:1})]),_:1}),r(e(ae),{class:"text-sm text-muted-foreground"},{default:n(()=>[...t[55]||(t[55]=[l("Muted surface color.",-1)])]),_:1})]),_:1},512)])])])])):(b(),P(Ss,{key:1,class:"h-screen overflow-hidden bg-background text-foreground"},{default:n(()=>[s("div",Mo,[s("div",No,[t[58]||(t[58]=s("div",null,[s("h1",{class:"text-lg font-semibold"},"ChapterEditor Theme Sandbox"),s("p",{class:"text-sm text-muted-foreground"}," Use `?theme_sandbox=1` (with layout) or `?theme_sandbox=nolayout`. ")],-1)),s("div",Lo,[r(Cs),r(e(v),{variant:"outline",size:"sm",onClick:G},{default:n(()=>[...t[56]||(t[56]=[l("Refresh",-1)])]),_:1}),r(e(v),{variant:"outline",size:"sm",onClick:t[3]||(t[3]=d=>e(J).visit(o.window.location.pathname))},{default:n(()=>[...t[57]||(t[57]=[l("Exit",-1)])]),_:1})])]),s("div",Oo,[r(e(oe),{class:"bg-card text-card-foreground"},{default:n(()=>[r(e(le),null,{default:n(()=>[r(e(me),{class:"text-base"},{default:n(()=>[...t[59]||(t[59]=[l("Theme State",-1)])]),_:1})]),_:1}),r(e(ae),{class:"space-y-2 text-sm"},{default:n(()=>[s("div",Wo,[s("div",null,[t[60]||(t[60]=s("span",{class:"text-muted-foreground"},"appearance:",-1)),l(" "+c(e(tt)),1)]),s("div",null,[t[61]||(t[61]=s("span",{class:"text-muted-foreground"},"isDark:",-1)),l(" "+c(e(qe)),1)]),s("div",null,[t[62]||(t[62]=s("span",{class:"text-muted-foreground"},"html.dark:",-1)),l(" "+c(h.value.htmlHasDark),1)]),s("div",null,[t[63]||(t[63]=s("span",{class:"text-muted-foreground"},"step:",-1)),l(" "+c(De.value),1)])]),r(e(Ye)),s("div",qo,[s("div",null,[t[64]||(t[64]=s("span",{class:"text-muted-foreground"},"--background:",-1)),l(" "+c(h.value.background),1)]),s("div",null,[t[65]||(t[65]=s("span",{class:"text-muted-foreground"},"--foreground:",-1)),l(" "+c(h.value.foreground),1)]),s("div",null,[t[66]||(t[66]=s("span",{class:"text-muted-foreground"},"--card:",-1)),l(" "+c(h.value.card),1)]),s("div",null,[t[67]||(t[67]=s("span",{class:"text-muted-foreground"},"--sidebar-background:",-1)),l(" "+c(h.value.sidebarBackground),1)])]),r(e(Ye)),s("div",Io,[s("div",null,[t[68]||(t[68]=s("span",{class:"text-muted-foreground"},"body bg:",-1)),l(" "+c(h.value.bodyBg),1)]),s("div",null,[t[69]||(t[69]=s("span",{class:"text-muted-foreground"},"inset bg:",-1)),l(" "+c(h.value.insetBg),1)]),s("div",null,[t[70]||(t[70]=s("span",{class:"text-muted-foreground"},"sample bg-background:",-1)),l(" "+c(h.value.sampleBgBackground),1)]),s("div",null,[t[71]||(t[71]=s("span",{class:"text-muted-foreground"},"sample bg-card:",-1)),l(" "+c(h.value.sampleBgCard),1)]),s("div",null,[t[72]||(t[72]=s("span",{class:"text-muted-foreground"},"sample bg-muted:",-1)),l(" "+c(h.value.sampleBgMuted),1)])])]),_:1})]),_:1}),s("div",Go,[r(e(oe),{ref_key:"sampleBgBackgroundEl",ref:N,class:"bg-background"},{default:n(()=>[r(e(le),null,{default:n(()=>[r(e(me),{class:"text-base"},{default:n(()=>[...t[73]||(t[73]=[l("bg-background",-1)])]),_:1})]),_:1}),r(e(ae),{class:"text-sm text-muted-foreground"},{default:n(()=>[...t[74]||(t[74]=[l("Should flip with theme.",-1)])]),_:1})]),_:1},512),r(e(oe),{ref_key:"sampleBgCardEl",ref:q,class:"bg-card"},{default:n(()=>[r(e(le),null,{default:n(()=>[r(e(me),{class:"text-base"},{default:n(()=>[...t[75]||(t[75]=[l("bg-card",-1)])]),_:1})]),_:1}),r(e(ae),{class:"text-sm text-muted-foreground"},{default:n(()=>[...t[76]||(t[76]=[l("Card surface color.",-1)])]),_:1})]),_:1},512),r(e(oe),{ref_key:"sampleBgMutedEl",ref:T,class:"bg-muted"},{default:n(()=>[r(e(le),null,{default:n(()=>[r(e(me),{class:"text-base"},{default:n(()=>[...t[77]||(t[77]=[l("bg-muted",-1)])]),_:1})]),_:1}),r(e(ae),{class:"text-sm text-muted-foreground"},{default:n(()=>[...t[78]||(t[78]=[l("Muted surface color.",-1)])]),_:1})]),_:1},512)]),De.value>=1?(b(),O("div",Bo,[t[79]||(t[79]=s("div",{class:"text-sm font-medium"},"Step 1: Paper Card only",-1)),t[80]||(t[80]=s("div",{class:"text-xs text-muted-foreground mb-3"},"Adds `ChapterEditorPaperCard` only.",-1)),r($s,{context:zt.value},null,8,["context"])])):K("",!0)])])]),_:1}))],64)):(b(),O(os,{key:1},[e(Ee)?(b(),P(e(R),{key:0,project:ve.value,chapter:be.value,"chapter-title":e(Z),"chapter-content":e(z),"current-word-count":e(ne),"target-word-count":fe.value,"progress-percentage":e(xt),"writing-quality-score":e(ye),"is-valid":Xe.value,"is-saving":e(he),"show-preview":e(Re),"is-generating":e(ee),"generation-progress":e(Ke),"history-index":e(Vs),"content-history-length":e(Ks).length,"selected-text":e(ge),"onUpdate:chapterTitle":t[4]||(t[4]=d=>Z.value=d),"onUpdate:chapterContent":t[5]||(t[5]=d=>z.value=d),"onUpdate:selectedText":t[6]||(t[6]=d=>ge.value=d),"onUpdate:showPreview":t[7]||(t[7]=d=>Re.value=d),onSave:t[8]||(t[8]=d=>Qt(d)),onUndo:Kt,onRedo:Vt,onExitChatMode:Pr},null,8,["project","chapter","chapter-title","chapter-content","current-word-count","target-word-count","progress-percentage","writing-quality-score","is-valid","is-saving","show-preview","is-generating","generation-progress","history-index","content-history-length","selected-text"])):e(pt)?(b(),P(e(M),{key:1,project:ve.value,chapter:be.value,"chapter-title":e(Z),"chapter-content":e(z),"current-word-count":e(ne),"target-word-count":fe.value,"progress-percentage":e(xt),onExitCitationMode:Mr},null,8,["project","chapter","chapter-title","chapter-content","current-word-count","target-word-count","progress-percentage"])):e(re)?(b(),O("div",Ho,[t[97]||(t[97]=s("div",{class:"absolute inset-0 z-0 overflow-hidden pointer-events-none"},[s("div",{class:"absolute top-[-20%] left-[-10%] w-[50%] h-[50%] rounded-full bg-blue-500/5 blur-[120px]"}),s("div",{class:"absolute bottom-[-20%] right-[-10%] w-[50%] h-[50%] rounded-full bg-purple-500/5 blur-[120px]"})],-1)),s("div",Uo,[s("div",Qo,[r(e(Q),null,{default:n(()=>[r(e(H),{asChild:""},{default:n(()=>[r(e(v),{onClick:t[9]||(t[9]=d=>e(J).visit(e(I)("projects.show",a.project.slug))),variant:"ghost",size:"icon",class:"h-10 w-10 rounded-full hover:bg-primary/10 hover:text-primary transition-all duration-300"},{default:n(()=>[r(e(St),{class:"h-5 w-5"})]),_:1})]),_:1}),r(e(U),null,{default:n(()=>[...t[81]||(t[81]=[s("p",null,"Back to Project",-1)])]),_:1})]),_:1}),s("div",Ko,[s("h1",Vo,c(a.project.title),1),s("div",Xo,[r(e(je),{variant:"outline",class:"h-5 px-2 rounded-full border-primary/20 bg-primary/5 text-primary font-medium"},{default:n(()=>[l(" Chapter "+c(a.chapter.chapter_number),1)]),_:1}),s("span",Jo,[t[82]||(t[82]=s("span",{class:"h-1.5 w-1.5 rounded-full bg-green-500 animate-pulse"},null,-1)),l(" "+c(e(ne))+" words ",1)])])])]),s("div",Yo,[s("div",Zo,[r(e(v),{onClick:t[10]||(t[10]=d=>He.value=!e(He)),variant:e(He)?"secondary":"ghost",size:"sm",class:Ze(["h-8 px-4 rounded-full text-xs font-medium transition-all duration-300",e(He)?"bg-primary/10 text-primary hover:bg-primary/15":"hover:bg-muted"])},{default:n(()=>[r(e(as),{class:"mr-2 h-3.5 w-3.5"}),t[83]||(t[83]=l(" Outline ",-1))]),_:1},8,["variant","class"]),t[85]||(t[85]=s("div",{class:"w-px h-4 bg-border/50 mx-1"},null,-1)),r(e(v),{onClick:t[11]||(t[11]=d=>Ue.value=!e(Ue)),variant:e(Ue)?"secondary":"ghost",size:"sm",class:Ze(["h-8 px-4 rounded-full text-xs font-medium transition-all duration-300",e(Ue)?"bg-primary/10 text-primary hover:bg-primary/15":"hover:bg-muted"])},{default:n(()=>[r(e(Me),{class:"mr-2 h-3.5 w-3.5"}),t[84]||(t[84]=l(" Assistant ",-1))]),_:1},8,["variant","class"])]),s("div",ea,[r(e(Q),null,{default:n(()=>[r(e(H),{asChild:""},{default:n(()=>[r(e(v),{onClick:Jt,variant:"ghost",size:"icon",class:"h-9 w-9 rounded-full transition-all hover:bg-muted"},{default:n(()=>[r(e(ls),{class:"h-4.5 w-4.5 text-blue-500"})]),_:1})]),_:1}),r(e(U),null,{default:n(()=>[...t[86]||(t[86]=[s("p",null,"Open AI Chat",-1)])]),_:1})]),_:1}),r(e(Q),null,{default:n(()=>[r(e(H),{asChild:""},{default:n(()=>[r(e(v),{onClick:_t,variant:e(re)?"secondary":"ghost",size:"icon",class:"h-9 w-9 rounded-full transition-all hover:bg-muted"},{default:n(()=>[e(re)?(b(),P(e(is),{key:0,class:"h-4.5 w-4.5"})):(b(),P(e(ds),{key:1,class:"h-4.5 w-4.5"}))]),_:1},8,["variant"])]),_:1}),r(e(U),null,{default:n(()=>[s("p",null,c(e(re)?"Exit fullscreen":"Enter fullscreen"),1)]),_:1})]),_:1}),r(e(Q),null,{default:n(()=>[r(e(H),{asChild:""},{default:n(()=>[r(e(v),{onClick:e(rt),variant:e(Ie)?"secondary":"ghost",size:"icon",class:"h-9 w-9 rounded-full transition-all hover:bg-muted"},{default:n(()=>[e(Ie)?(b(),P(e(us),{key:0,class:"h-4.5 w-4.5 text-foreground"})):(b(),P(e(cs),{key:1,class:"h-4.5 w-4.5 text-muted-foreground"}))]),_:1},8,["onClick","variant"])]),_:1}),r(e(U),null,{default:n(()=>[...t[87]||(t[87]=[s("p",null,"Toggle Dark Mode",-1)])]),_:1})]),_:1}),r(Tt,{project:ve.value,"current-chapter":be.value,"all-chapters":Ce.value,size:"icon",variant:"ghost",class:"h-9 w-9 rounded-full hover:bg-muted"},null,8,["project","current-chapter","all-chapters"])])])]),s("div",ta,[s("div",{class:"absolute top-0 left-0 h-full bg-gradient-to-r from-blue-500 via-purple-500 to-pink-500 transition-all duration-700 ease-out shadow-[0_0_10px_rgba(59,130,246,0.5)]",style:Et({width:`${Math.min(e(xt),100)}%`})},null,4)]),e(ee)?(b(),O("div",sa,[s("div",ra,[t[93]||(t[93]=s("div",{class:"absolute inset-0 -skew-x-12 animate-pulse bg-gradient-to-r from-transparent via-white/10 to-transparent"},null,-1)),s("div",na,[s("div",oa,[s("div",aa,[s("div",la,[r(e(Me),{class:"h-3 w-3 text-white"})]),t[88]||(t[88]=s("div",{class:"absolute inset-0 h-6 w-6 animate-ping rounded-full bg-gradient-to-br from-indigo-500 to-purple-600 opacity-20"},null,-1))]),s("div",null,[t[89]||(t[89]=s("h4",{class:"text-xs font-semibold text-indigo-900 dark:text-indigo-100"},"AI Writing Assistant",-1)),s("p",ia,c(e(_e)),1)])]),s("div",da,[r(e(v),{variant:"ghost",size:"icon",class:"h-7 w-7 rounded-full hover:bg-red-100 dark:hover:bg-red-900/20 transition-colors",onClick:e(Ve),title:"Stop writing"},{default:n(()=>[r(e(en),{class:"h-4 w-4 text-red-600 dark:text-red-400"})]),_:1},8,["onClick"]),r(e(je),{variant:"secondary",class:"bg-indigo-100 text-indigo-700 dark:bg-indigo-900/40 dark:text-indigo-300 border-0"},{default:n(()=>[l(c(Math.round(e(Fe)))+"% ",1)]),_:1})])]),s("div",ua,[s("div",ca,[t[90]||(t[90]=s("span",{class:"text-[10px] font-medium text-indigo-800 dark:text-indigo-200 uppercase tracking-wider"},"Writing Progress",-1)),s("span",pa,c(e(wt))+" / "+c(e(_r))+" words",1)]),s("div",ga,[s("div",{class:"absolute top-0 left-0 h-full rounded-full bg-gradient-to-r from-indigo-500 via-purple-500 to-pink-500 transition-all duration-500 ease-out shadow-[0_0_10px_rgba(99,102,241,0.5)]",style:Et({width:`${e(Fe)}%`})},[...t[91]||(t[91]=[s("div",{class:"absolute inset-0 animate-pulse bg-gradient-to-r from-transparent via-white/40 to-transparent"},null,-1)])],4)])]),s("div",fa,[s("div",ma,[e(_e)==="Initializing"?(b(),O("div",ha)):e(_e)==="Connecting"?(b(),O("div",va,[...t[92]||(t[92]=[s("div",{class:"h-2 w-0.5 animate-pulse rounded-full bg-blue-500"},null,-1),s("div",{class:"h-2 w-0.5 animate-pulse rounded-full bg-purple-500",style:{"animation-delay":"0.2s"}},null,-1),s("div",{class:"h-2 w-0.5 animate-pulse rounded-full bg-blue-500",style:{"animation-delay":"0.4s"}},null,-1)])])):e(_e)==="Writing"||e(_e)==="Writing Section"?(b(),O("div",ba)):e(_e)==="Complete"?(b(),O("div",xa)):(b(),O("div",wa))]),s("p",ya,c(e(Ke)),1)])])])):K("",!0),s("div",_a,[r(We,{"enter-active-class":"transition-all duration-300 ease-in-out","enter-from-class":"-ml-72 opacity-0","enter-to-class":"ml-0 opacity-100","leave-active-class":"transition-all duration-300 ease-in-out","leave-from-class":"ml-0 opacity-100","leave-to-class":"-ml-72 opacity-0"},{default:n(()=>[e(He)?(b(),O("div",ka,[s("div",Ca,[s("div",Sa,[s("div",Ea,[t[94]||(t[94]=s("h2",{class:"text-sm font-semibold text-foreground mb-1"},"Table of Contents",-1)),s("p",Ta,c(Ce.value.length)+" Chapters ",1)]),(b(),P(tn,null,{fallback:n(()=>[...t[95]||(t[95]=[s("div",{class:"flex items-center justify-center p-8"},[s("div",{class:"h-6 w-6 animate-spin rounded-full border-2 border-primary border-t-transparent"})],-1)])]),default:n(()=>[r(e(x),{"all-chapters":Ce.value,"current-chapter":be.value,project:ve.value,outlines:o.project.outlines||[],"faculty-chapters":o.facultyChapters||[],"current-word-count":e(ne),"target-word-count":fe.value,"writing-quality-score":e(ye),"chapter-content-length":e(z).length,onGoToChapter:Ae,onGenerateNextChapter:e(nt)},null,8,["all-chapters","current-chapter","project","outlines","faculty-chapters","current-word-count","target-word-count","writing-quality-score","chapter-content-length","onGenerateNextChapter"])]),_:1}))])])])):K("",!0)]),_:1}),s("div",Aa,[s("div",$a,[s("div",ja,[r($s,{context:zt.value},null,8,["context"]),t[96]||(t[96]=s("div",{class:"h-12"},null,-1))])])]),r(We,{"enter-active-class":"transition-all duration-300 ease-in-out","enter-from-class":"-mr-72 opacity-0","enter-to-class":"mr-0 opacity-100","leave-active-class":"transition-all duration-300 ease-in-out","leave-from-class":"mr-0 opacity-100","leave-to-class":"-mr-72 opacity-0"},{default:n(()=>[e(Ue)?(b(),P(js,ps({key:0,"container-class":"w-72 flex-shrink-0 border-l border-border/40 bg-background/40 backdrop-blur-md"},Pt.value),null,16)):K("",!0)]),_:1})])])):(b(),P(Ss,{key:3,class:"h-screen overflow-hidden bg-background dark:bg-background transition-colors duration-300"},{default:n(()=>[s("div",Da,[t[128]||(t[128]=s("div",{class:"absolute inset-0 z-0 overflow-hidden pointer-events-none"},[s("div",{class:"absolute top-[-10%] left-[-10%] w-[40%] h-[40%] rounded-full bg-blue-500/5 blur-[100px]"}),s("div",{class:"absolute bottom-[-10%] right-[-10%] w-[40%] h-[40%] rounded-full bg-purple-500/5 blur-[100px]"})],-1)),Le(s("aside",Ra,[s("div",Fa,[t[98]||(t[98]=s("span",{class:"text-sm font-semibold tracking-tight text-foreground"},"Navigation",-1)),r(e(je),{variant:"outline",class:"text-[10px] h-5 px-1.5"},{default:n(()=>[l(c(Ce.value.length)+" Chapters ",1)]),_:1})]),r(e(ms),{class:"flex-1"},{default:n(()=>[s("div",za,[r(e(x),{"all-chapters":Ce.value,"current-chapter":be.value,project:ve.value,outlines:o.project.outlines||[],"faculty-chapters":o.facultyChapters||[],"current-word-count":e(ne),"target-word-count":fe.value,"writing-quality-score":e(ye),"chapter-content-length":e(z).length,onGoToChapter:Ae,onGenerateNextChapter:e(nt)},null,8,["all-chapters","current-chapter","project","outlines","faculty-chapters","current-word-count","target-word-count","writing-quality-score","chapter-content-length","onGenerateNextChapter"])])]),_:1})],512),[[Oe,!e(Ge)]]),s("main",Pa,[s("header",Ma,[s("div",Na,[r(e(Q),null,{default:n(()=>[r(e(H),{asChild:""},{default:n(()=>[r(e(v),{id:"back-to-project-btn-mobile",variant:"ghost",size:"icon",class:"h-9 w-9 text-zinc-700 dark:text-zinc-300 hover:text-foreground hover:bg-muted/50 rounded-full",onClick:t[12]||(t[12]=d=>e(J).visit(e(I)("projects.writing",a.project.slug)))},{default:n(()=>[r(e(St),{class:"w-4 h-4"})]),_:1})]),_:1}),r(e(U),null,{default:n(()=>[...t[99]||(t[99]=[l("Back to Writing",-1)])]),_:1})]),_:1}),t[100]||(t[100]=s("div",{class:"h-6 w-px bg-border/50 mx-1 hidden lg:block"},null,-1)),r(e(v),{variant:"ghost",size:"icon",onClick:t[13]||(t[13]=d=>gt.value=!0),class:"lg:hidden text-muted-foreground hover:text-foreground h-9 w-9 hover:bg-muted/50 rounded-full"},{default:n(()=>[r(e(as),{class:"h-4.5 w-4.5"})]),_:1})]),s("div",La,[r(e(v),{variant:"ghost",size:"icon",onClick:t[14]||(t[14]=d=>ft.value=!0),class:"text-muted-foreground hover:text-foreground h-9 w-9 hover:bg-muted/50 rounded-full"},{default:n(()=>[r(e(Me),{class:"h-4.5 w-4.5"})]),_:1})]),s("div",Oa,[s("div",Wa,[s("h1",{class:"text-xl font-bold tracking-tight text-foreground leading-snug cursor-pointer hover:text-primary/80 transition-colors break-words",onClick:t[15]||(t[15]=d=>e(J).visit(e(I)("projects.show",a.project.slug)))},c(a.project.title),1),r(e(je),{variant:"secondary",class:"shrink-0 h-5 px-2 text-[10px] font-medium rounded-full bg-secondary/50 border border-border/50 mt-1"},{default:n(()=>[l(" Ch "+c(a.chapter.chapter_number),1)]),_:1})]),s("div",qa,[s("div",Ia,[r(Tt,{project:ve.value,"current-chapter":be.value,"all-chapters":Ce.value,size:"icon",variant:"outline","trigger-element":"icon","button-class":"h-8 w-8 rounded-full bg-background/50 backdrop-blur-sm",class:"text-zinc-700 dark:text-zinc-300"},null,8,["project","current-chapter","all-chapters"]),r(e(v),{variant:"outline",size:"icon",class:"h-8 w-8 gap-2 text-zinc-700 dark:text-zinc-300 hover:text-foreground bg-background/50 backdrop-blur-sm rounded-full",onClick:kt},{default:n(()=>[r(e(gs),{class:"w-4 h-4"})]),_:1}),r(e(v),{variant:"outline",size:"icon",class:"h-8 w-8 gap-2 text-zinc-700 dark:text-zinc-300 hover:text-foreground bg-background/50 backdrop-blur-sm rounded-full",disabled:e(ee),onClick:t[16]||(t[16]=d=>w.value=!0),title:"Regenerate chapter"},{default:n(()=>[r(e(ut),{class:"w-4 h-4"})]),_:1},8,["disabled"])]),s("div",Ga,[Ut.value?(b(),P(e(Q),{key:0},{default:n(()=>[r(e(H),{asChild:""},{default:n(()=>[r(e(v),{onClick:yt,size:"icon",variant:"ghost",class:"h-9 w-9 rounded-full hover:bg-muted/50 transition-all active:scale-90"},{default:n(()=>[r(e(fs),{class:"h-4.5 w-4.5 text-foreground/70"})]),_:1})]),_:1}),r(e(U),null,{default:n(()=>[...t[101]||(t[101]=[l("Start writing next chapter",-1)])]),_:1})]),_:1})):K("",!0),r(e(v),{onClick:t[17]||(t[17]=d=>e(we)(!1)),disabled:e(he),variant:Xe.value?"default":"secondary",size:"sm",class:"h-8 px-3 text-xs shadow-sm gap-2 rounded-full min-w-[32px]"},{default:n(()=>[r(e(At),{class:"h-3.5 w-3.5"}),e(he)?(b(),O("span",Ba,"Saving")):K("",!0)]),_:1},8,["disabled","variant"]),r(e(v),{onClick:Ct,disabled:e(he),size:"sm",class:"h-8 px-3 text-xs shadow-sm gap-2 rounded-full"},{default:n(()=>[r(e(dt),{class:"h-3.5 w-3.5"}),t[102]||(t[102]=s("span",{class:"sm:hidden"},"Done",-1))]),_:1},8,["disabled"])])])])]),s("div",Ha,[s("div",Ua,[s("div",Qa,[s("h1",{class:"text-sm font-bold text-foreground cursor-pointer hover:text-primary transition-colors flex items-center",onClick:t[18]||(t[18]=d=>e(J).visit(e(I)("projects.show",a.project.slug)))},[s("div",{innerHTML:a.project.title,class:"inline-block"},null,8,Ka)]),r(e(je),{variant:"secondary",class:"h-5 px-2 text-[10px] font-medium rounded-full bg-secondary/50 border border-border/50"},{default:n(()=>[l(" Ch "+c(a.chapter.chapter_number),1)]),_:1})])]),s("div",Va,[s("div",Xa,[r(e(Q),null,{default:n(()=>[r(e(H),{asChild:""},{default:n(()=>[r(e(v),{id:"back-to-project-btn",variant:"ghost",size:"icon",class:"h-8 w-8 text-zinc-700 dark:text-zinc-300 hover:text-foreground rounded-full",onClick:t[19]||(t[19]=d=>e(J).visit(e(I)("projects.writing",a.project.slug)))},{default:n(()=>[r(e(St),{class:"w-4 h-4"})]),_:1})]),_:1}),r(e(U),null,{default:n(()=>[...t[103]||(t[103]=[l("Back to Writing",-1)])]),_:1})]),_:1}),t[104]||(t[104]=s("div",{class:"h-4 w-px bg-border/50 mx-1"},null,-1)),r(e(v),{id:"toggle-left-sidebar",variant:"ghost",size:"icon",onClick:t[20]||(t[20]=d=>Ge.value=!e(Ge)),class:"text-muted-foreground hover:text-foreground h-8 w-8 rounded-full"},{default:n(()=>[e(Ge)?(b(),P(e(rn),{key:1,class:"h-4 w-4"})):(b(),P(e(sn),{key:0,class:"h-4 w-4"}))]),_:1})]),s("div",Ja,[s("div",Ya,[r(e(Q),null,{default:n(()=>[r(e(H),{asChild:""},{default:n(()=>[r(e(v),{onClick:Yt,variant:e(ke)?"secondary":"ghost",size:"sm",class:"h-7 px-3 text-xs gap-2 text-zinc-700 dark:text-zinc-300 hover:text-foreground rounded-full"},{default:n(()=>[e(ke)?(b(),P(e(nn),{key:1,class:"h-3.5 w-3.5"})):(b(),P(e(Fs),{key:0,class:"h-3.5 w-3.5"})),s("span",Za,c(e(ke)?"Edit":"Preview"),1)]),_:1},8,["variant"])]),_:1}),r(e(U),null,{default:n(()=>[...t[105]||(t[105]=[l("Toggle Preview Mode",-1)])]),_:1})]),_:1}),t[109]||(t[109]=s("div",{class:"w-px h-3 bg-border/50 mx-0.5"},null,-1)),r(e(Q),null,{default:n(()=>[r(e(H),{asChild:""},{default:n(()=>[r(e(v),{id:"toggle-chat-mode",onClick:Jt,variant:"ghost",size:"sm",class:"h-7 px-3 text-xs gap-2 text-muted-foreground hover:text-foreground rounded-full"},{default:n(()=>[r(e(ls),{class:"h-3.5 w-3.5 text-blue-500"}),t[106]||(t[106]=s("span",{class:"hidden xl:inline text-foreground"},"AI Chat",-1))]),_:1})]),_:1}),r(e(U),null,{default:n(()=>[...t[107]||(t[107]=[l("Open AI Assistant",-1)])]),_:1})]),_:1}),t[110]||(t[110]=s("div",{class:"w-px h-3 bg-border/50 mx-0.5"},null,-1)),r(e(Q),null,{default:n(()=>[r(e(H),{asChild:""},{default:n(()=>[r(e(v),{onClick:_t,variant:"ghost",size:"sm",class:"h-7 px-3 text-xs gap-2 text-muted-foreground hover:text-foreground rounded-full"},{default:n(()=>[e(re)?(b(),P(e(is),{key:0,class:"h-3.5 w-3.5"})):(b(),P(e(ds),{key:1,class:"h-3.5 w-3.5"})),s("span",el,c(e(re)?`Exit
                                                        Fullscreen`:"Fullscreen"),1)]),_:1})]),_:1}),r(e(U),null,{default:n(()=>[s("p",null,c(e(re)?"Exit fullscreen":"Enter fullscreen"),1)]),_:1})]),_:1}),t[111]||(t[111]=s("div",{class:"w-px h-3 bg-border/50 mx-0.5"},null,-1)),r(e(Q),null,{default:n(()=>[r(e(H),{asChild:""},{default:n(()=>[r(e(v),{onClick:e(rt),variant:"ghost",size:"sm",class:"h-7 px-3 text-xs gap-2 text-zinc-700 dark:text-zinc-300 hover:text-foreground rounded-full"},{default:n(()=>[e(Ie)?(b(),P(e(us),{key:0,class:"h-3.5 w-3.5 text-foreground"})):(b(),P(e(cs),{key:1,class:"h-3.5 w-3.5"}))]),_:1},8,["onClick"])]),_:1}),r(e(U),null,{default:n(()=>[...t[108]||(t[108]=[l("Toggle Dark Mode",-1)])]),_:1})]),_:1})]),s("div",tl,[r(Tt,{id:"export-menu-container",project:ve.value,"current-chapter":be.value,"all-chapters":Ce.value,size:"sm",variant:"outline","trigger-element":"button","button-class":"h-9 gap-2 px-3 rounded-full bg-background/50 backdrop-blur-sm",class:"text-zinc-700 dark:text-zinc-300"},null,8,["project","current-chapter","all-chapters"]),r(e(v),{id:"analyze-button",variant:"outline",size:"sm",class:"h-9 gap-2 text-zinc-700 dark:text-zinc-300 hover:text-foreground bg-background/50 backdrop-blur-sm rounded-full",onClick:kt,title:"Open bulk analysis"},{default:n(()=>[r(e(gs),{class:"w-4 h-4"}),t[112]||(t[112]=s("span",{class:"text-xs font-medium"},"Analyze",-1))]),_:1}),r(e(Q),null,{default:n(()=>[r(e(H),{asChild:""},{default:n(()=>[r(e(v),{id:"regenerate-button",variant:"outline",size:"sm",class:"h-9 gap-2 text-zinc-700 dark:text-zinc-300 hover:text-foreground bg-background/50 backdrop-blur-sm rounded-full",disabled:e(ee),onClick:t[21]||(t[21]=d=>w.value=!0)},{default:n(()=>[r(e(ut),{class:"w-4 h-4"}),t[113]||(t[113]=s("span",{class:"text-xs font-medium"},"Regenerate",-1))]),_:1},8,["disabled"])]),_:1}),r(e(U),null,{default:n(()=>[...t[114]||(t[114]=[l("Regenerate chapter content",-1)])]),_:1})]),_:1})]),s("div",sl,[Ut.value?(b(),P(e(Q),{key:0},{default:n(()=>[r(e(H),{asChild:""},{default:n(()=>[r(e(v),{onClick:yt,size:"icon",variant:"ghost",class:"h-9 w-9 rounded-full hover:bg-muted/50 transition-all active:scale-90"},{default:n(()=>[r(e(fs),{class:"h-5 w-5 text-foreground/70"})]),_:1})]),_:1}),r(e(U),null,{default:n(()=>[...t[115]||(t[115]=[l("Start writing next chapter",-1)])]),_:1})]),_:1})):K("",!0),r(e(v),{id:"save-button",onClick:t[22]||(t[22]=d=>e(we)(!1)),disabled:e(he),variant:Xe.value?"default":"secondary",size:"sm",class:"h-9 px-4 text-xs shadow-sm gap-2 rounded-full min-w-[32px]"},{default:n(()=>[r(e(At),{class:"h-3.5 w-3.5"}),s("span",rl,c(e(he)?"Saving":"Save"),1)]),_:1},8,["disabled","variant"]),r(e(v),{id:"mark-complete-btn",onClick:Ct,disabled:e(he),size:"sm",class:"h-9 px-4 text-xs shadow-sm gap-2 rounded-full"},{default:n(()=>[r(e(dt),{class:"h-3.5 w-3.5"}),t[116]||(t[116]=s("span",null,"Mark Complete",-1))]),_:1},8,["disabled"]),t[118]||(t[118]=s("div",{class:"w-px h-4 bg-border/50 mx-1"},null,-1)),t[119]||(t[119]=s("div",{class:"w-px h-4 bg-border/50 mx-1"},null,-1)),r(e(Q),null,{default:n(()=>[r(e(H),{asChild:""},{default:n(()=>[r(e(v),{id:"reset-tour-button",variant:"ghost",size:"icon",onClick:ts,class:"text-muted-foreground hover:text-foreground h-9 w-9 hover:bg-muted/50 rounded-full"},{default:n(()=>[r(e(on),{class:"h-4.5 w-4.5"})]),_:1})]),_:1}),r(e(U),null,{default:n(()=>[...t[117]||(t[117]=[l("Restart Tutorial",-1)])]),_:1})]),_:1}),r(e(v),{id:"toggle-right-sidebar",variant:"ghost",size:"icon",onClick:t[23]||(t[23]=d=>Be.value=!e(Be)),class:"hidden lg:flex text-muted-foreground hover:text-foreground h-9 w-9 hover:bg-muted/50 rounded-full"},{default:n(()=>[e(Be)?(b(),P(e(ln),{key:1,class:"h-4.5 w-4.5"})):(b(),P(e(an),{key:0,class:"h-4.5 w-4.5"}))]),_:1})])])])]),s("div",nl,[r(We,{"enter-active-class":"transition-all duration-300 ease-out","enter-from-class":"opacity-0 -translate-y-4","enter-to-class":"opacity-100 translate-y-0","leave-active-class":"transition-all duration-200 ease-in","leave-from-class":"opacity-100 translate-y-0","leave-to-class":"opacity-0 -translate-y-4"},{default:n(()=>[e(ee)?(b(),O("div",ol,[s("div",al,[s("div",ll,[t[124]||(t[124]=s("div",{class:"absolute -top-24 -right-24 h-48 w-48 rounded-full bg-blue-500/20 blur-3xl animate-pulse"},null,-1)),t[125]||(t[125]=s("div",{class:"absolute -bottom-24 -left-24 h-48 w-48 rounded-full bg-purple-500/20 blur-3xl animate-pulse delay-1000"},null,-1)),s("div",il,[s("div",dl,[t[120]||(t[120]=s("div",{class:"absolute inset-0 -m-1.5 rounded-full border-2 border-transparent border-t-blue-500 border-r-purple-500 animate-spin [animation-duration:2s]"},null,-1)),s("div",ul,[r(e(Me),{class:"h-5 w-5 text-white animate-pulse"})])]),s("div",cl,[s("div",pl,[t[121]||(t[121]=s("div",{class:"flex flex-col"},[s("h4",{class:"text-sm font-bold text-foreground tracking-tight flex items-center gap-2"},[l(" Writing Chapter "),s("span",{class:"flex h-1.5 w-1.5 rounded-full bg-green-500 animate-pulse shadow-[0_0_8px_rgba(34,197,94,0.6)]"})])],-1)),s("span",gl,c(Math.round(e(Fe)))+"% ",1)]),s("div",fl,[s("div",{class:"h-full bg-gradient-to-r from-blue-500 via-purple-500 to-pink-500 transition-all duration-300 ease-out shadow-[0_0_10px_rgba(59,130,246,0.5)] relative",style:Et({width:`${e(Fe)}%`})},[...t[122]||(t[122]=[s("div",{class:"absolute inset-0 bg-white/30 w-full animate-shimmer -skew-x-12 translate-x-[-100%]"},null,-1)])],4)]),s("div",ml,[s("p",hl,[t[123]||(t[123]=s("span",{class:"w-1 h-1 rounded-full bg-blue-500"},null,-1)),l(" "+c(e(Ke)||"Initializing writer..."),1)]),s("button",{onClick:t[24]||(t[24]=(...d)=>e(Ve)&&e(Ve)(...d)),class:"text-[10px] font-semibold text-red-500 hover:text-red-600 dark:text-red-400 dark:hover:text-red-300 transition-colors uppercase tracking-wider flex items-center gap-1 hover:bg-red-50 dark:hover:bg-red-900/10 px-2 py-0.5 rounded-full"}," Stop ")])])])])])])):K("",!0)]),_:1}),r(e(ms),{ref_key:"editorScrollRef",ref:Sr,class:"h-full w-full","data-editor-scroll-container":""},{default:n(()=>[s("div",vl,[Le(s("div",bl,[r(Ms,{ref_key:"richTextEditorFullscreen",ref:F,modelValue:e(z),"onUpdate:modelValue":t[25]||(t[25]=d=>dn(z)?z.value=d:null),placeholder:"Start writing your chapter...",class:"prose prose-slate dark:prose-invert prose-lg max-w-none focus:outline-none min-h-[500px]","streaming-mode":e(Lt),"is-generating":e(ee),"generation-progress":e(Ke),"generation-percentage":e(Fe),"generation-phase":e(_e),"onUpdate:selectedText":t[26]||(t[26]=d=>ge.value=d),"min-height":"500px"},null,8,["modelValue","streaming-mode","is-generating","generation-progress","generation-percentage","generation-phase"])],512),[[Oe,!e(ke)]]),Le(s("div",xl,[r(Ns,{content:e(z),class:"prose prose-slate dark:prose-invert prose-lg max-w-none"},null,8,["content"])],512),[[Oe,e(ke)]])])]),_:1},512)]),s("div",wl,[s("div",yl,[s("span",null,"Words: "+c(e(ne))+" / "+c(fe.value),1),s("span",_l,"Last saved: "+c(e(he)?"Saving...":"Just now"),1)]),s("div",kl,[r(e(v),{disabled:!at.value?.exists,onClick:Dr,variant:"ghost",size:"icon",class:"h-8 w-8 rounded-full hover:bg-muted/50 disabled:opacity-30"},{default:n(()=>[r(e(un),{class:"h-4 w-4 text-foreground/60"})]),_:1},8,["disabled"]),s("div",Cl," Chapter "+c(a.chapter.chapter_number),1),r(e(v),{disabled:!Te.value,onClick:yt,variant:"ghost",size:"icon",class:"h-8 w-8 rounded-full hover:bg-muted/50 disabled:opacity-30"},{default:n(()=>[r(e(cn),{class:"h-4 w-4 text-foreground/60"})]),_:1},8,["disabled"])]),s("div",Sl,[s("span",null,[t[126]||(t[126]=l("Quality: ",-1)),s("span",{class:Ze(e(ye)>70?"text-green-500":"text-amber-500")},c(e(ye))+"%",3)]),Xe.value?(b(),O("span",El,[r(e(dt),{class:"h-3 w-3"}),t[127]||(t[127]=l(" Ready ",-1))])):K("",!0)])])]),r(js,ps({id:"right-sidebar-panel","is-collapsed":e(Be),"container-class":"hidden lg:flex w-96 flex-col border-l border-border/40 bg-background/60 backdrop-blur-xl z-20 transition-all duration-300"},Pt.value),null,16,["is-collapsed"])]),r(e(i),{"show-left-sidebar":e(gt),"show-right-sidebar":e(ft),"is-mobile":e(mt),"all-chapters":Ce.value,"current-chapter":be.value,project:ve.value,"current-word-count":e(ne),"target-word-count":fe.value,"writing-quality-score":e(ye),"chapter-content-length":e(z).length,"is-generating":e(ee),"selected-text":e(ge),"is-loading-suggestions":e(Nt),"show-citation-helper":e(ot),"chapter-content":e(z),outlines:o.project.outlines||[],"faculty-chapters":o.facultyChapters||[],"onUpdate:showLeftSidebar":t[27]||(t[27]=d=>gt.value=d),"onUpdate:showRightSidebar":t[28]||(t[28]=d=>ft.value=d),onGoToChapter:Ae,onGenerateNextChapter:e(nt),onStartStreamingGeneration:e(Wt),onGetAiSuggestions:e(qt),"onUpdate:showCitationHelper":t[29]||(t[29]=d=>ot.value=d),onCheckCitations:e(It)},null,8,["show-left-sidebar","show-right-sidebar","is-mobile","all-chapters","current-chapter","project","current-word-count","target-word-count","writing-quality-score","chapter-content-length","is-generating","selected-text","is-loading-suggestions","show-citation-helper","chapter-content","outlines","faculty-chapters","onGenerateNextChapter","onStartStreamingGeneration","onGetAiSuggestions","onCheckCitations"]),r(e(hs),{open:w.value,"onUpdate:open":t[30]||(t[30]=d=>w.value=d)},{default:n(()=>[r(e(vs),null,{default:n(()=>[r(e(bs),null,{default:n(()=>[r(e(xs),null,{default:n(()=>[...t[129]||(t[129]=[l("Regenerate Chapter?",-1)])]),_:1}),r(e(ws),null,{default:n(()=>[...t[130]||(t[130]=[l(" This will replace all existing content with freshly generated content. Your current content will be saved to history, so you can undo if needed. ",-1)])]),_:1})]),_:1}),r(e(ys),null,{default:n(()=>[r(e(_s),null,{default:n(()=>[...t[131]||(t[131]=[l("Cancel",-1)])]),_:1}),r(e(ks),{onClick:Rr,class:"bg-primary hover:bg-primary/90"},{default:n(()=>[r(e(ut),{class:"w-4 h-4 mr-2"}),t[132]||(t[132]=l(" Regenerate ",-1))]),_:1})]),_:1})]),_:1})]),_:1},8,["open"]),r(e(hs),{open:A.value,"onUpdate:open":t[31]||(t[31]=d=>A.value=d)},{default:n(()=>[r(e(vs),{class:"max-w-md"},{default:n(()=>[r(e(bs),null,{default:n(()=>[s("div",Tl,[s("div",Al,[r(e(Me),{class:"w-5 h-5 text-amber-500"})]),r(e(xs),{class:"text-lg"},{default:n(()=>[...t[133]||(t[133]=[l("AI is Writing Your Chapter",-1)])]),_:1})]),r(e(ws),{class:"text-sm space-y-2"},{default:n(()=>[t[135]||(t[135]=s("p",null,"Your chapter is currently being written by AI. Leaving now will:",-1)),s("ul",$l,[t[134]||(t[134]=s("li",null,"Stop the writing process immediately",-1)),s("li",null,"Lose any unsaved content ("+c(e(wt))+" words written so far)",1)]),t[136]||(t[136]=s("p",{class:"font-medium text-foreground pt-2"},"Are you sure you want to leave?",-1))]),_:1})]),_:1}),r(e(ys),{class:"gap-2 sm:gap-0"},{default:n(()=>[r(e(_s),{onClick:Or,class:"flex-1 sm:flex-none"},{default:n(()=>[...t[137]||(t[137]=[l(" Stay on Page ",-1)])]),_:1}),r(e(ks),{onClick:Lr,class:"flex-1 sm:flex-none bg-destructive hover:bg-destructive/90 text-destructive-foreground"},{default:n(()=>[...t[138]||(t[138]=[l(" Leave Anyway ",-1)])]),_:1})]),_:1})]),_:1})]),_:1},8,["open"]),r(fn,{open:e(Dt),"current-balance":e(Ws),"required-words":e(qs),action:e(Is),"onUpdate:open":t[32]||(t[32]=d=>Dt.value=d),onClose:e(Bs)},null,8,["open","current-balance","required-words","action","onClose"]),e(kr)?(b(),O("div",jl,[r(e(oe),{class:"w-full max-w-md mx-4 bg-white dark:bg-slate-900 border-amber-500/50 shadow-2xl"},{default:n(()=>[r(e(le),null,{default:n(()=>[r(e(me),{class:"flex items-center gap-2 text-amber-600 dark:text-amber-400"},{default:n(()=>[...t[139]||(t[139]=[s("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[s("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"})],-1),l(" Generation Interrupted ",-1)])]),_:1})]),_:1}),r(e(ae),null,{default:n(()=>[s("p",Dl,[t[140]||(t[140]=l(" Connection lost. ",-1)),s("span",Rl,c(e(Cr))+" words",1),t[141]||(t[141]=l(" may have been saved. ",-1))]),s("div",Fl,[r(e(v),{onClick:e(Ar),class:"flex-1 bg-amber-600 hover:bg-amber-700 text-white"},{default:n(()=>[...t[142]||(t[142]=[s("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-4 w-4 mr-2",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[s("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"})],-1),l(" Reload & Recover ",-1)])]),_:1},8,["onClick"]),r(e(v),{onClick:e($r),variant:"outline",class:"flex-1"},{default:n(()=>[...t[143]||(t[143]=[l(" Dismiss ",-1)])]),_:1},8,["onClick"])])]),_:1})]),_:1})])):K("",!0)]),_:1}))],64))]),_:1}))}}),Ml=Ls(Pl,[["__scopeId","data-v-def6bb75"]]),Xi=Object.freeze(Object.defineProperty({__proto__:null,default:Ml},Symbol.toStringTag,{value:"Module"}));export{yo as A,Xi as C};
