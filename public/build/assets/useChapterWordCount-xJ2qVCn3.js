import{B as o,J as Pe,f as ke,P as B,i as Me,b as _}from"./app-Cz7LEwRO.js";import{t as h}from"./index-Cq9Q2HS5.js";import{r as ce}from"./Sonner.vue_vue_type_script_setup_true_lang-DHOFxAL9.js";function We(l){const{delay:a=1e4,onSave:b}=l,E=o(!1),A=o(!1),y=o(null),F=()=>{E.value=!0,y.value&&clearTimeout(y.value),y.value=setTimeout(()=>{p(!0)},a)},p=async(U=!1)=>{if(!A.value){A.value=!0;try{await b(U),E.value=!1,y.value&&(clearTimeout(y.value),y.value=null)}finally{A.value=!1}}};return{hasUnsavedChanges:E,isSaving:A,triggerAutoSave:F,save:p,clearAutoSave:()=>{y.value&&(clearTimeout(y.value),y.value=null)}}}const Re={userScrollTimeout:2e3,scrollBehavior:"smooth",bottomThreshold:100};class Ie{scrollContainer=null;isUserScrolling=!1;userScrollTimeout=null;isEnabled=!0;isDestroyed=!1;config;wasAtBottom=!0;rafId=null;handleWheel;handleTouchStart;handleTouchMove;handleScroll;handleKeydown;constructor(a={}){this.config={...Re,...a},this.handleWheel=this.onUserScroll.bind(this),this.handleTouchStart=this.onUserScroll.bind(this),this.handleTouchMove=this.onUserScroll.bind(this),this.handleScroll=this.onScroll.bind(this),this.handleKeydown=this.onKeydown.bind(this)}attach(a){this.isDestroyed||(this.detach(),this.scrollContainer=a,this.setupEventListeners(),this.wasAtBottom=this.isAtBottom())}detach(){this.scrollContainer&&(this.scrollContainer.removeEventListener("wheel",this.handleWheel),this.scrollContainer.removeEventListener("touchstart",this.handleTouchStart),this.scrollContainer.removeEventListener("touchmove",this.handleTouchMove),this.scrollContainer.removeEventListener("scroll",this.handleScroll),this.scrollContainer.removeEventListener("keydown",this.handleKeydown)),this.userScrollTimeout&&(clearTimeout(this.userScrollTimeout),this.userScrollTimeout=null),this.rafId&&(cancelAnimationFrame(this.rafId),this.rafId=null),this.scrollContainer=null}setupEventListeners(){this.scrollContainer&&(this.scrollContainer.addEventListener("wheel",this.handleWheel,{passive:!0}),this.scrollContainer.addEventListener("touchstart",this.handleTouchStart,{passive:!0}),this.scrollContainer.addEventListener("touchmove",this.handleTouchMove,{passive:!0}),this.scrollContainer.addEventListener("scroll",this.handleScroll,{passive:!0}),this.scrollContainer.addEventListener("keydown",this.handleKeydown))}onUserScroll(){this.isEnabled&&(this.isUserScrolling=!0,this.userScrollTimeout&&clearTimeout(this.userScrollTimeout),this.userScrollTimeout=setTimeout(()=>{this.isUserScrolling=!1,this.isAtBottom()&&(this.wasAtBottom=!0)},this.config.userScrollTimeout))}onScroll(){this.wasAtBottom=this.isAtBottom()}onKeydown(a){["ArrowUp","ArrowDown","PageUp","PageDown","Home","End"].includes(a.key)&&this.onUserScroll()}isAtBottom(){if(!this.scrollContainer)return!0;const{scrollTop:a,scrollHeight:b,clientHeight:E}=this.scrollContainer;return b-a-E<=this.config.bottomThreshold}scrollToBottom(){!this.scrollContainer||!this.isEnabled||this.isDestroyed||this.isUserScrolling||!this.wasAtBottom||(this.rafId&&cancelAnimationFrame(this.rafId),this.rafId=requestAnimationFrame(()=>{if(this.rafId=null,!this.scrollContainer||this.isDestroyed)return;const a=this.scrollContainer.scrollHeight-this.scrollContainer.clientHeight;this.config.scrollBehavior==="instant"?this.scrollContainer.scrollTop=a:this.scrollContainer.scrollTo({top:a,behavior:"smooth"}),this.wasAtBottom=!0}))}forceScrollToBottom(){!this.scrollContainer||this.isDestroyed||(this.isUserScrolling=!1,this.wasAtBottom=!0,this.userScrollTimeout&&(clearTimeout(this.userScrollTimeout),this.userScrollTimeout=null),this.scrollToBottom())}enable(){this.isEnabled=!0}disable(){this.isEnabled=!1}isAutoScrollActive(){return this.isEnabled&&!this.isUserScrolling&&this.wasAtBottom}isUserScrollingNow(){return this.isUserScrolling}reset(){this.isUserScrolling=!1,this.wasAtBottom=!0,this.userScrollTimeout&&(clearTimeout(this.userScrollTimeout),this.userScrollTimeout=null)}destroy(){this.isDestroyed=!0,this.detach()}}function Ge(l={}){const a=new Ie(l),b=o(!0),E=o(!1);let A=null;function y(n){n?(a.attach(n),p()):(a.detach(),R())}function F(n){ke(n,i=>{y(i)},{immediate:!0})}function p(){R(),A=setInterval(()=>{b.value=a.isAutoScrollActive(),E.value=a.isUserScrollingNow()},100)}function R(){A&&(clearInterval(A),A=null)}function U(){a.scrollToBottom()}function q(){a.forceScrollToBottom()}function O(){a.enable()}function X(){a.disable()}function d(){a.reset(),b.value=!0,E.value=!1}return Pe(()=>{R(),a.destroy()}),{attach:y,attachRef:F,scrollToBottom:U,forceScrollToBottom:q,enable:O,disable:X,reset:d,isAutoScrollActive:b,isUserScrolling:E}}function Ke({props:l,chapterContent:a,targetWordCount:b,estimates:E,ensureBalance:A,save:y,triggerAutoSave:F,calculateWritingStats:p,countWords:R,selectedText:U,richTextEditor:q,richTextEditorFullscreen:O,isNativeFullscreen:X}){const d=o(!1),n=o(""),i=o(0),v=o(""),x=o(0),g=o(0),w=o(""),I=o(0),Y=o(""),V=o([]),N=o(!1),ae=o(!1),H=o(!1),j=o(!1),L=o(!1),W=o(!1),Q=o(0),r=o(!1),C=o(""),$=o(""),Z=o(0),oe=o(0),he=o(null),ge=o([]),fe=o([]),pe=o(null),D=o(null),P=o(0),ne=3,se=o(2e3),K=o(!1),ee=o(null),Ae=o("progressive"),c=o(null),me=o(),{attach:we,scrollToBottom:Se,forceScrollToBottom:_e,reset:ye,isAutoScrollActive:$e,isUserScrolling:Ce}=Ge({userScrollTimeout:2e3,scrollBehavior:"smooth",bottomThreshold:100}),le=()=>{d.value&&Me(()=>{let t=null;if(X.value){const e=me.value;if(e){const u=e.$el||e;t=u?.querySelector("[data-radix-scroll-area-viewport]")||u?.querySelector("[data-viewport]")||u?.querySelector('[role="region"]')}}else t=document.querySelector(".overflow-y-auto.custom-scrollbar");if(!t){const e=document.querySelector("main");if(e){const u=e.querySelectorAll("div");for(const s of u)if(s.scrollHeight>s.clientHeight&&s.classList.contains("overflow-y-auto")){t=s;break}}}t&&(we(t),Se(),requestAnimationFrame(()=>{!Ce.value&&t&&t.scrollTo({top:t.scrollHeight,behavior:"smooth"})}))})},Te=async()=>{if(!navigator.onLine)return h.error("No Internet Connection",{description:"Please check your internet connection and try again."}),!1;const t=navigator.connection||navigator.mozConnection||navigator.webkitConnection;if(t){const e=t.effectiveType;(e==="slow-2g"||e==="2g")&&h.warning("Slow Connection Detected",{description:"Your connection is slow. Content will be auto-saved during generation.",duration:4e3})}try{const e=new AbortController,u=setTimeout(()=>e.abort(),5e3),s=performance.now();await fetch(B("api.ping"),{method:"HEAD",cache:"no-cache",signal:e.signal}),clearTimeout(u);const S=performance.now()-s;console.log("ðŸ“¡ Server latency:",S.toFixed(0),"ms"),S>2e3&&h.info("Connection is slow",{description:"Content will be auto-saved during generation to prevent data loss.",duration:3e3})}catch(e){console.warn("Connection check ping failed:",e),h.info("Connection check skipped",{description:"Content will be auto-saved during generation.",duration:2e3})}return!0},xe=async()=>new Promise(t=>{let e=0;const u=120,s=async()=>{try{const m=await(await fetch(B("api.projects.paper-collection.status",{project:l.project.slug}))).json();if(m.success&&m.data){pe.value=m.data;const G=m.data.status,T=m.data.papers_count||m.data.count||0,f=m.data.message,z=m.data.percentage||0,k=m.data.current_source,M=m.data.sources_completed||[],te=m.data.papers_preview||[];if(Z.value=T,oe.value=z,he.value=k,ge.value=M,fe.value=te,G==="completed"){$.value="Complete",C.value=`âœ“ Collected ${T} verified sources from ${M.length} databases`,i.value=50,r.value=!1,D.value&&clearInterval(D.value),t(!0);return}else if(["collecting_papers","initializing","processing","storing"].includes(G)){let ie="";k&&(ie={semantic_scholar:"Semantic Scholar",openalex:"OpenAlex",crossref:"CrossRef",pubmed:"PubMed"}[k]||k),$.value=ie||"Collecting Sources",C.value=f||"Collecting sources from academic databases...",i.value=Math.min(5+z*.4,45)}else if(G==="collection_failed"){$.value="Error",C.value=f||"âŒ Source collection failed",r.value=!1,D.value&&clearInterval(D.value),t(!1);return}}e++,e>=u&&($.value="Timeout",C.value="â±ï¸ Source collection timed out",r.value=!1,D.value&&clearInterval(D.value),t(!1))}catch(S){console.error("Error checking paper collection status:",S),e++}};s(),D.value=setInterval(s,5e3)}),be=async()=>{r.value=!0,$.value="Starting",C.value="Initializing source collection...",i.value=5;try{const t=document.querySelector('meta[name="csrf-token"]')?.content;if(!t)throw new Error("CSRF token not found - please refresh the page");const e=await fetch(B("api.projects.paper-collection.start",{project:l.project.slug}),{method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json","X-CSRF-TOKEN":t,"X-Requested-With":"XMLHttpRequest"},credentials:"include"});if(!e.ok){const u=await e.text();if(console.error("API Error:",e.status,u),e.status===409)try{const s=JSON.parse(u);throw new Error(s.message||"Source collection is already in progress")}catch{throw new Error("Source collection is already in progress for this project")}throw new Error(`Failed to start source collection: ${e.status}`)}return await xe()}catch(t){return console.error("Paper collection failed:",t),$.value="Error",C.value="âŒ Source collection failed",r.value=!1,!1}},ue=async t=>{const e=t==="improve"?300:E.chapter(b.value||0);if(!A(e,t==="improve"?"improve this chapter":"generate this chapter with AI")||!await Te())return;if(d.value=!0,w.value="",g.value=0,i.value=5,v.value="Papers",n.value="Checking for verified sources...",j.value=!0,ye(),x.value=b.value||0,H.value=!0,!await be()){h.error("Paper Collection Failed",{description:"Unable to collect verified papers. Please try again."}),d.value=!1,H.value=!1;return}v.value="Initializing",n.value="Starting AI generation with verified sources...",i.value=51;const m=setInterval(()=>{i.value<52&&d.value?i.value+=.2:clearInterval(m)},100),G=B("chapters.stream",{project:l.project.slug,chapter:l.chapter.chapter_number});c.value=new EventSource(`${G}?generation_type=${t}`),c.value.onmessage=T=>{const f=JSON.parse(T.data);switch(f.type){case"start":v.value="Connecting",i.value=52,n.value="Connecting to AI service...";break;case"content":v.value="Generating",w.value+=f.content,g.value=f.word_count||w.value.split(/\s+/).filter(M=>M.length>0).length;const z=Date.now();if(z-I.value>200){a.value=w.value,I.value=z;const M=Math.min(g.value/Math.max(x.value,1)*43,43);i.value=Math.max(52,52+M),n.value=`Generating chapter content... (${g.value} / ${x.value} words)`,le()}break;case"heartbeat":i.value<95&&(i.value+=.5);break;case"complete":v.value="Complete",i.value=100,d.value=!1,j.value=!1,a.value=w.value;const k=f.final_word_count||g.value;n.value=`âœ“ Generated ${k} words successfully`,p(),ce(k,`Chapter generation (${l.chapter.chapter_number})`,"chapter",l.chapter.id).catch(M=>console.error("Failed to record word usage (chapter generation):",M)),setTimeout(()=>{F()},500),c.value?.close(),c.value=null;break;case"error":v.value="Error",i.value=50,j.value=!1,f.partial_saved&&(W.value=!0,Q.value=f.saved_word_count||0),f.code==="OFFLINE_MODE"?(n.value="ðŸ“¡ AI services offline",d.value=!1,h.error("AI Services Offline",{description:"Please check your internet connection and try again."})):f.can_resume?(n.value=`âš ï¸ Generation interrupted (${f.saved_word_count} words saved)`,d.value=!1,L.value=!0,h.warning("Generation Interrupted",{description:`${f.saved_word_count} words were saved. You can resume generation.`,duration:8e3})):(n.value="âŒ Generation failed",d.value=!1,h.error("Generation Error",{description:f.message||"Please try again."})),c.value?.close(),c.value=null;break;case"autosave":f.word_count&&f.generation_id&&(ee.value=f.generation_id);break}},c.value.onerror=()=>{if(P.value<ne){P.value++,K.value=!0,v.value="Reconnecting",n.value=`ðŸ”„ Connection lost. Reconnecting... (${P.value}/${ne})`,c.value?.close(),c.value=null;const T=se.value*Math.pow(2,P.value-1);setTimeout(()=>ve(t),T)}else v.value="Error",i.value=50,d.value=!1,K.value=!1,n.value="âŒ Connection failed after multiple attempts",g.value>100?(W.value=!0,Q.value=g.value,L.value=!0,h.warning("Connection Lost",{description:`${g.value} words may have been saved. Check and resume if needed.`,duration:8e3})):h.error("Connection Error",{description:"Please check your internet connection and try again."}),c.value?.close(),c.value=null,P.value=0,se.value=2e3}},ve=t=>{c.value&&(c.value.close(),c.value=null);const e=B("chapters.stream",{project:l.project.slug,chapter:l.chapter.chapter_number}),u=new URLSearchParams({generation_type:t,resume_from:g.value.toString()});ee.value&&u.set("generation_id",ee.value),c.value=new EventSource(`${e}?${u}`),c.value.onmessage=s=>{const S=JSON.parse(s.data);switch(["content","start"].includes(S.type)&&(K.value=!1,P.value=0,v.value="Generating"),S.type){case"start":n.value="âœ… Reconnected! Continuing generation...",h.success("Reconnected",{description:"Generation resumed successfully.",duration:3e3});break;case"content":v.value="Generating",w.value+=S.content,g.value=S.word_count||w.value.split(/\s+/).filter(T=>T.length>0).length;const m=Date.now();if(m-I.value>150){a.value=w.value,I.value=m;const T=Math.min(g.value/Math.max(x.value,1)*43,43);i.value=Math.max(52,52+T),n.value=`Generating chapter content... (${g.value} / ${x.value} words)`,le()}break;case"complete":v.value="Complete",i.value=100,d.value=!1,K.value=!1,a.value=w.value;const G=S.final_word_count||g.value;n.value=`âœ“ Generated ${G} words successfully`,ce(G,`Chapter generation (${l.chapter.chapter_number})`,"chapter",l.chapter.id).catch(T=>console.error("Failed to record word usage:",T)),setTimeout(()=>{F()},500),c.value?.close(),c.value=null;break;case"error":v.value="Error",d.value=!1,K.value=!1,n.value="âŒ Generation failed",h.error("Generation Error",{description:S.message||"Please try again."}),c.value?.close(),c.value=null;break;case"autosave":S.generation_id&&(ee.value=S.generation_id);break}},c.value.onerror=()=>{if(P.value<ne){P.value++;const s=se.value*Math.pow(2,P.value-1);n.value=`ðŸ”„ Reconnecting... (${P.value}/${ne})`,c.value?.close(),setTimeout(()=>ve(t),s)}else v.value="Error",d.value=!1,K.value=!1,n.value="âŒ Connection failed",g.value>100?(L.value=!0,h.warning("Connection Lost",{description:`${g.value} words may be saved. Refresh to recover.`})):h.error("Connection Error",{description:"Please check your connection and try again."}),c.value?.close(),c.value=null,P.value=0}},Ee=async t=>{d.value=!0,w.value="",g.value=0,i.value=5,v.value="Papers",n.value="Checking for verified sources...",x.value=600,Y.value=a.value||l.chapter.content||"",H.value=!0;try{i.value=50,v.value="Papers",n.value="Using existing verified sources...",await new Promise(u=>setTimeout(u,500)),v.value="Section",n.value=`Generating ${t} section with verified sources...`,i.value=51;const e=B("chapters.stream",{project:l.project.slug,chapter:l.chapter.chapter_number});c.value=new EventSource(`${e}?generation_type=section&section_type=${t}`),c.value.onmessage=u=>{const s=JSON.parse(u.data);switch(s.type){case"start":v.value="Generating Section",i.value=52,n.value=`Starting ${t} section generation...`;break;case"content":w.value+=s.content,g.value=s.word_count||R(w.value);const S=Date.now();if(S-I.value>150){a.value=Y.value+`

`+w.value,I.value=S;const m=Math.min(g.value/x.value*43,43);i.value=Math.max(52,52+m),n.value=`Generating ${t} section... (${g.value} / ${x.value} words)`,p(),le()}break;case"complete":i.value=100,v.value="Complete",n.value=`âœ“ Generated ${t} section (${g.value} words)`,a.value=Y.value+`

`+w.value,y(!0),h.success("âœ… Section Generated Successfully",{description:`Added ${t} section with ${g.value} words and verified citations.`,duration:5e3}),d.value=!1,c.value?.close();break;case"error":throw new Error(s.message||"Section generation failed");case"heartbeat":i.value<95&&(i.value+=.5);break}},c.value.onerror=()=>{d.value=!1,v.value="Error",n.value="âŒ Section generation failed",h.error("âŒ Generation Failed",{description:"Unable to generate section. Please check your connection and try again."}),c.value?.close()}}catch(e){console.error("Section generation failed:",e),d.value=!1,v.value="Error",n.value="âŒ Section generation error",h.error("âŒ Generation Failed",{description:"Section generation encountered an error."})}},de=async(t,e,u)=>{const s=t.split(/\s+/).length;if(!A(300,`${e} selected text`))return;d.value=!0,w.value="",g.value=0,i.value=10,v.value=e==="rephrase"?"Rephrasing":"Expanding",n.value=`${e==="rephrase"?"Rephrasing":"Expanding"} selected text...`,x.value=Math.max(s*(e==="expand"?2:1),100);const m=O.value||q.value,G=m?.getSelectionRange(),T={originalText:t,range:G,wordCount:s,style:u||"Academic Formal",startTime:Date.now()};H.value=!0;try{const f=document.querySelector('meta[name="csrf-token"]')?.content;if(!f)throw new Error("CSRF token not found - please refresh the page");const z=e==="rephrase"?B("chapters.quick-actions.rephrase",{project:l.project.slug,chapter:l.chapter.chapter_number}):B("chapters.quick-actions.expand",{project:l.project.slug,chapter:l.chapter.chapter_number});i.value=35;const k=await fetch(z,{method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json","X-CSRF-TOKEN":f,"X-Requested-With":"XMLHttpRequest"},credentials:"include",body:JSON.stringify({text:t,...e==="rephrase"?{style:T.style}:{}})});if(!k.ok){let J=`Request failed (${k.status})`;try{const re=await k.json();J=re?.message||re?.error||re?.data?.message||J}catch{}throw new Error(J)}const M=await k.json(),te=String(M?.text||"").trim();if(!te)throw new Error("Empty response from AI service");i.value=100,v.value="Complete",n.value=`âœ“ Text ${e==="rephrase"?"rephrased":"expanded"} successfully`,T.range&&(m?.replaceSelection(te,T.range)?setTimeout(()=>{const re=m?.getHTML()||a.value;a.value=re},50):h.warning("Please manually replace the selected text",{description:"The generated text is ready but could not be automatically inserted."})),y(!0),h.success(`âœ… Text ${e==="rephrase"?"Rephrased":"Expanded"} Successfully`,{description:`${e==="rephrase"?"Rephrased":"Expanded"} selection (${s} words).`});const ie=Number(M?.word_count)||R(te)||(e==="expand"?s*2:s);ce(ie,e==="rephrase"?`Rephrase (${T.style})`:"Expand text","chapter",l.chapter.id).catch(J=>console.error(`Failed to record word usage (${e}):`,J)),d.value=!1}catch(f){console.error("Selection generation failed:",f),d.value=!1,v.value="Error",n.value=`âŒ Text ${e==="rephrase"?"rephrasing":"expansion"} error`,h.error(`âŒ ${e==="rephrase"?"Rephrasing":"Expansion"} Failed`,{description:f instanceof Error?f.message:"Text generation encountered an error."})}};return{isGenerating:d,generationProgress:n,generationPercentage:i,generationPhase:v,estimatedTotalWords:x,streamWordCount:g,streamBuffer:w,lastStreamUpdate:I,originalContentForAppend:Y,aiSuggestions:V,isLoadingSuggestions:N,showCitationHelper:ae,showPresentationMode:H,isStreamingMode:j,showRecoveryDialog:L,partialContentSaved:W,savedWordCountOnError:Q,isCollectingPapers:r,paperCollectionProgress:C,paperCollectionPhase:$,collectedPapersCount:Z,paperCollectionPercentage:oe,currentSource:he,sourcesCompleted:ge,papersPreview:fe,paperCollectionData:pe,paperCollectionInterval:D,reconnectAttempts:P,reconnectDelay:se,isReconnecting:K,currentGenerationId:ee,currentGenerationType:Ae,eventSource:c,editorScrollRef:me,attachScroller:we,smoothScrollToBottom:Se,forceScrollToBottom:_e,resetScroller:ye,isAutoScrollActive:$e,isUserScrollingScroller:Ce,scrollToBottom:le,checkConnectionQuality:Te,startPaperCollection:be,startStreamingGeneration:ue,attemptReconnection:ve,startSectionGeneration:Ee,handleSelectionGeneration:de,handleAIGeneration:(t,e)=>{t==="section"&&e?.section?Ee(e.section):t==="rephrase"&&e?.selectedText?de(e.selectedText,"rephrase",e.style):t==="expand"&&e?.selectedText?de(e.selectedText,"expand"):ue(t)},getAISuggestions:async()=>{if(!U.value)return;const t=E.suggestion();if(A(t,"get AI suggestions")){N.value=!0;try{const u=await(await fetch(B("chapters.suggestions",{project:l.project.slug,chapter:l.chapter.chapter_number}),{method:"POST",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":document.querySelector('meta[name="csrf-token"]')?.getAttribute("content")||""},body:JSON.stringify({selected_text:U.value,context:a.value})})).json();V.value=u.suggestions||[],V.value.length&&ce(E.suggestion(),"AI suggestions","chapter",l.chapter.id).catch(s=>console.error("Failed to record word usage (suggestions):",s))}catch{h.error("Error getting suggestions",{description:"Please try again."})}finally{N.value=!1}}},checkCitations:()=>{ae.value=!0,h.success("Citation Manager opened!",{description:"Review and verify your citations in the panel below."})},insertCitation:t=>{try{const e=O.value?.editor||q.value?.editor;if(!e){h.error("Editor not found");return}const{from:u}=e.state.selection;e.chain().focus().insertContentAt(u,` ${t} `).run(),h.success("Citation inserted successfully")}catch(e){console.error("Failed to insert citation:",e),h.error("Failed to insert citation")}},resumeGeneration:()=>{L.value=!1,W.value=!1,window.location.reload()},dismissRecovery:()=>{L.value=!1,W.value=!1,Q.value=0},checkForAutoGeneration:()=>{const t=new URLSearchParams(window.location.search),e=t.get("ai_generate")==="true",u=t.get("generation_type");!e||!u||setTimeout(()=>{ue("progressive");const s=new URL(window.location.href);s.searchParams.delete("ai_generate"),s.searchParams.delete("generation_type"),window.history.replaceState({},"",s.toString()),h.success("ðŸš€ AI Generation Started",{description:`Generating ${l.chapter.title} with AI assistance...`})},1e3)}}}function ze(l,a=o(3e3),b=.8){const E=r=>{if(!r)return 0;const $=r.replace(/<[^>]*>/g,"").trim().replace(/\s+/g," ");if(!$)return 0;const Z=$.match(/\b\w+\b/g);return Z?Z.length:0},A=r=>r?r.replace(/<[^>]*>/g,"").replace(/\r\n|\r/g,`
`).trim().split(/\n\s*\n/).filter(oe=>oe.trim().length>0).length:0,y=r=>{if(!r)return 0;const $=r.replace(/<[^>]*>/g,"").match(/[.!?]+/g);return $?$.length:0},F=r=>Math.round(r/200*10)/10,p=_(()=>E(l.value)),R=_(()=>l.value.length),U=_(()=>l.value.replace(/\s/g,"").length),q=_(()=>A(l.value)),O=_(()=>y(l.value)),X=_(()=>F(p.value)),d=_(()=>{const r=a.value;return!r||r<=0?0:Math.min(p.value/r*100,100)}),n=_(()=>p.value>=a.value*b),i=_(()=>{const r=a.value-p.value;return Math.max(r,0)}),v=_(()=>{const r=a.value*b-p.value;return Math.max(r,0)}),x=_(()=>({wordCount:p.value,characterCount:R.value,characterCountNoSpaces:U.value,paragraphCount:q.value,sentenceCount:O.value,readingTimeMinutes:X.value})),g=_(()=>({current:p.value,target:a.value,percentage:d.value,isComplete:n.value,completionThreshold:b})),w=r=>r>=1e3?`${Math.round(r/100)/10}k`:r.toString(),I=(r=0)=>`${Math.round(d.value*Math.pow(10,r))/Math.pow(10,r)}%`,Y=()=>`${p.value} / ${a.value} words (${I()}%)`,V=()=>{if(n.value)return`âœ… Complete (${w(p.value)} words)`;const r=v.value;return`${w(r)} more words to complete`},N=()=>{const r=p.value,C=a.value;return r===0?"empty":r<C*.25?"started":r<C*.75?"progressing":r<C*b?"near_complete":r<C?"complete":"exceeded"},ae=()=>{const r=N();return{empty:"text-gray-500",started:"text-blue-500",progressing:"text-yellow-500",near_complete:"text-orange-500",complete:"text-green-500",exceeded:"text-emerald-600"}[r]},H=()=>{const r=N();return{empty:"bg-gray-200",started:"bg-blue-200",progressing:"bg-yellow-200",near_complete:"bg-orange-200",complete:"bg-green-200",exceeded:"bg-emerald-200"}[r]},j=800,L=_(()=>p.value>=j),W=_(()=>Math.max(j-p.value,0)),Q=_(()=>Math.min(p.value/j*100,100));return{currentWordCount:p,characterCount:R,characterCountNoSpaces:U,paragraphCount:q,sentenceCount:O,readingTimeMinutes:X,progressPercentage:d,isComplete:n,wordsRemaining:i,wordsToComplete:v,wordCountStats:x,wordCountProgress:g,meetsDefenseThreshold:L,defenseWordsRemaining:W,defenseProgressPercentage:Q,DEFENSE_THRESHOLD:j,formatWordCount:w,formatProgress:I,getProgressDisplay:Y,getCompletionDisplay:V,getWordCountStatus:N,getStatusColor:ae,getProgressBarColor:H,countWords:E}}export{We as a,Ke as b,ze as u};
