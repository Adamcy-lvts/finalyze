import{d as H,y as g,a as V,C as J,o as c,E as r,K as t,H as o,u as a,P as n,c as v,O as R,A as x,Q as E,S as M,M as _,Y as h}from"./app-Drfb5vhD.js";import{_ as D}from"./AdminLayout.vue_vue_type_script_setup_true_lang-ZXaw-6m7.js";import{_ as k,a as S}from"./CardContent.vue_vue_type_script_setup_true_lang-LKRtVKVi.js";import{_ as j}from"./CardDescription.vue_vue_type_script_setup_true_lang-rjuNZDG_.js";import{_ as N,a as C}from"./CardTitle.vue_vue_type_script_setup_true_lang-C6oNPW71.js";import{_ as T}from"./index-Cn9MYLLD.js";import{_ as y}from"./Input.vue_vue_type_script_setup_true_lang-xNcvjKz2.js";import{_ as w}from"./Textarea.vue_vue_type_script_setup_true_lang-CUpvNJt9.js";import{_ as p}from"./Label.vue_vue_type_script_setup_true_lang-CDQJdcf8.js";import"./DropdownMenuTrigger.vue_vue_type_script_setup_true_lang-Dv_0pwze.js";import"./index-D8sJQrjD.js";import"./index-BUawP80q.js";import"./loader-circle-BCOmBCcX.js";import"./Presence-Cd6ATzLy.js";import"./useForwardExpose-Mg-D3WOz.js";import"./DialogTitle-DfpKTmmm.js";import"./VisuallyHidden-Ds1ee0_t.js";import"./UserInfo.vue_vue_type_script_setup_true_lang-BLlNb5W3.js";import"./TooltipTrigger.vue_vue_type_script_setup_true_lang-D5qL88rB.js";import"./users-BGbO8TZC.js";import"./chart-column-CjpHg4iR.js";import"./book-open-CioXM-hZ.js";import"./file-text-BXPzIbHp.js";import"./list-BmfygvNF.js";import"./log-out-Dd5j-65E.js";const q={class:"space-y-6"},B={class:"grid gap-4 md:grid-cols-2"},L={class:"space-y-2"},K=["value"],X={class:"space-y-2"},Q={key:0,class:"grid gap-4 md:grid-cols-2"},W={class:"space-y-2"},Y={key:1,class:"space-y-4"},z={class:"grid gap-4 md:grid-cols-2"},G={class:"space-y-2"},Z={class:"space-y-2"},ee={class:"space-y-2"},te={class:"grid gap-4 md:grid-cols-2"},se={class:"space-y-2"},oe={key:2,class:"space-y-4"},ae={class:"grid gap-4 md:grid-cols-2"},le={class:"space-y-2"},re={class:"space-y-2"},ie={class:"space-y-2"},de={key:3,class:"space-y-4"},ne={class:"grid gap-4 md:grid-cols-2"},ue={class:"space-y-2"},pe={class:"space-y-2"},me={class:"flex items-center justify-end gap-2"},ce={key:0},ve={key:1},_e={class:"grid gap-4 md:grid-cols-3"},ye={class:"rounded-md border border-border p-3 text-sm"},fe={class:"font-semibold"},be={class:"font-semibold"},ge={class:"font-semibold"},xe={class:"md:col-span-2 rounded-md border border-border p-3 text-sm"},he={class:"mt-2 whitespace-pre-wrap break-words font-mono text-xs"},we={class:"space-y-2"},Ve={class:"space-y-2"},We=H({__name:"PromptPreview",props:{projects:{}},setup(U){const I=U,f=g(!1),m=g(null),s=g({type:"chapter",project_id:"",chapter_number:1,chapter_id:"",editor_action:"rephrase",style:"Academic Formal",selected_text:"",chat_message:"How can I improve this section?",analysis_kind:"structure"}),b=g("[]"),P=V(()=>I.projects??[]),F=V(()=>{try{return JSON.stringify(m.value?.meta??{},null,2)}catch{return"{}"}}),A=()=>{m.value=null,s.value.chapter_number=1,s.value.chapter_id="",s.value.editor_action="rephrase",s.value.style="Academic Formal",s.value.selected_text="",s.value.chat_message="How can I improve this section?",s.value.analysis_kind="structure",b.value="[]"},O=async()=>{try{f.value=!0;const i={type:String(s.value.type??"chapter"),project_id:Number(s.value.project_id)};if((!Number.isFinite(i.project_id)||i.project_id<=0)&&delete i.project_id,i.type==="chapter")i.chapter_number=Number(s.value.chapter_number??1);else if(i.type==="editor"){i.editor_action=String(s.value.editor_action??"rephrase"),i.style=String(s.value.style??"Academic Formal"),i.selected_text=String(s.value.selected_text??"");const d=s.value.chapter_id;if(d!=null&&d!==""){const u=Number(d);Number.isFinite(u)&&u>0&&(i.chapter_id=u)}}else if(i.type==="chat"){i.chat_message=String(s.value.chat_message??"How can I improve this section?");const d=s.value.chapter_id;if(d!=null&&d!==""){const u=Number(d);Number.isFinite(u)&&u>0&&(i.chapter_id=u)}try{i.chat_history=JSON.parse(b.value||"[]")}catch{i.chat_history=[]}}else if(i.type==="analysis"){i.analysis_kind=String(s.value.analysis_kind??"structure");const d=s.value.chapter_id;if(d!=null&&d!==""){const u=Number(d);Number.isFinite(u)&&u>0&&(i.chapter_id=u)}}const e=await fetch("/admin/system/prompt-preview",{method:"POST",credentials:"same-origin",headers:{"Content-Type":"application/json",Accept:"application/json","X-Requested-With":"XMLHttpRequest","X-CSRF-TOKEN":document.querySelector('meta[name="csrf-token"]')?.getAttribute("content")||""},body:JSON.stringify(i)}),l=e.headers.get("content-type")||"";if(!e.ok){const d=await e.text(),u=(()=>{if(!l.includes("application/json"))return null;try{return JSON.parse(d)}catch{return null}})();m.value={success:!1,system_prompt:"",user_prompt:"",meta:{status:e.status,statusText:e.statusText,errors:u?.errors??void 0},estimates:{system:0,user:0,total:0},error:u?.message??(l.includes("application/json")?d:"Request failed. Check server logs.")};return}if(!l.includes("application/json")){const d=await e.text();m.value={success:!1,system_prompt:"",user_prompt:"",meta:{status:e.status,statusText:e.statusText},estimates:{system:0,user:0,total:0},error:"Server did not return JSON. This is usually a 419/500 HTML response. Check server logs.",body_preview:d.slice(0,500)};return}const $=await e.json();m.value=$}finally{f.value=!1}};return(i,e)=>(c(),J(D,{title:"Prompt Preview",subtitle:"Inspect the exact system/user prompts used for a project."},{default:r(()=>[t("div",q,[o(a(k),{class:"border border-border bg-card shadow-sm"},{default:r(()=>[o(a(N),null,{default:r(()=>[o(a(C),{class:"text-base font-semibold"},{default:r(()=>[...e[12]||(e[12]=[n("Preview Inputs",-1)])]),_:1}),o(a(j),null,{default:r(()=>[...e[13]||(e[13]=[n("Select a project and prompt type, then preview the resolved prompts.",-1)])]),_:1})]),_:1}),o(a(S),{class:"space-y-4"},{default:r(()=>[t("div",B,[t("div",L,[o(a(p),null,{default:r(()=>[...e[14]||(e[14]=[n("Project",-1)])]),_:1}),x(t("select",{"onUpdate:modelValue":e[0]||(e[0]=l=>s.value.project_id=l),class:"h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-sm"},[e[15]||(e[15]=t("option",{value:"",disabled:""},"Select a project…",-1)),(c(!0),v(E,null,M(P.value,l=>(c(),v("option",{key:l.id,value:l.id}," #"+_(l.id)+" · "+_(l.title||l.topic||l.slug)+" · "+_(l.user?.email||"—"),9,K))),128))],512),[[h,s.value.project_id]])]),t("div",X,[o(a(p),null,{default:r(()=>[...e[16]||(e[16]=[n("Type",-1)])]),_:1}),x(t("select",{"onUpdate:modelValue":e[1]||(e[1]=l=>s.value.type=l),class:"h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-sm"},[...e[17]||(e[17]=[t("option",{value:"chapter"},"Chapter",-1),t("option",{value:"editor"},"Editor (rephrase/expand/improve)",-1),t("option",{value:"chat"},"Chat",-1),t("option",{value:"analysis"},"Analysis",-1)])],512),[[h,s.value.type]])])]),s.value.type==="chapter"?(c(),v("div",Q,[t("div",W,[o(a(p),null,{default:r(()=>[...e[18]||(e[18]=[n("Chapter Number",-1)])]),_:1}),o(a(y),{modelValue:s.value.chapter_number,"onUpdate:modelValue":e[2]||(e[2]=l=>s.value.chapter_number=l),type:"number",min:"1",max:"20"},null,8,["modelValue"])])])):s.value.type==="editor"?(c(),v("div",Y,[t("div",z,[t("div",G,[o(a(p),null,{default:r(()=>[...e[19]||(e[19]=[n("Action",-1)])]),_:1}),x(t("select",{"onUpdate:modelValue":e[3]||(e[3]=l=>s.value.editor_action=l),class:"h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-sm"},[...e[20]||(e[20]=[t("option",{value:"rephrase"},"Rephrase",-1),t("option",{value:"expand"},"Expand",-1),t("option",{value:"improve"},"Improve",-1)])],512),[[h,s.value.editor_action]])]),t("div",Z,[o(a(p),null,{default:r(()=>[...e[21]||(e[21]=[n("Style (rephrase only)",-1)])]),_:1}),o(a(y),{modelValue:s.value.style,"onUpdate:modelValue":e[4]||(e[4]=l=>s.value.style=l),placeholder:"Academic Formal"},null,8,["modelValue"])])]),t("div",ee,[o(a(p),null,{default:r(()=>[...e[22]||(e[22]=[n("Selected Text",-1)])]),_:1}),o(a(w),{modelValue:s.value.selected_text,"onUpdate:modelValue":e[5]||(e[5]=l=>s.value.selected_text=l),rows:"6",class:"font-mono text-sm"},null,8,["modelValue"])]),t("div",te,[t("div",se,[o(a(p),null,{default:r(()=>[...e[23]||(e[23]=[n("Chapter ID (optional)",-1)])]),_:1}),o(a(y),{modelValue:s.value.chapter_id,"onUpdate:modelValue":e[6]||(e[6]=l=>s.value.chapter_id=l),type:"number",min:"1"},null,8,["modelValue"])])])])):s.value.type==="chat"?(c(),v("div",oe,[t("div",ae,[t("div",le,[o(a(p),null,{default:r(()=>[...e[24]||(e[24]=[n("Chapter ID (optional)",-1)])]),_:1}),o(a(y),{modelValue:s.value.chapter_id,"onUpdate:modelValue":e[7]||(e[7]=l=>s.value.chapter_id=l),type:"number",min:"1"},null,8,["modelValue"])])]),t("div",re,[o(a(p),null,{default:r(()=>[...e[25]||(e[25]=[n("Message",-1)])]),_:1}),o(a(y),{modelValue:s.value.chat_message,"onUpdate:modelValue":e[8]||(e[8]=l=>s.value.chat_message=l),placeholder:"How can I improve this section?"},null,8,["modelValue"])]),t("div",ie,[o(a(p),null,{default:r(()=>[...e[26]||(e[26]=[n("History (JSON array, optional)",-1)])]),_:1}),o(a(w),{modelValue:b.value,"onUpdate:modelValue":e[9]||(e[9]=l=>b.value=l),rows:"6",class:"font-mono text-sm"},null,8,["modelValue"]),e[27]||(e[27]=t("p",{class:"text-xs text-muted-foreground"},'Format: [{ "role": "user|assistant", "content": "..." }, ...]',-1))])])):s.value.type==="analysis"?(c(),v("div",de,[t("div",ne,[t("div",ue,[o(a(p),null,{default:r(()=>[...e[28]||(e[28]=[n("Kind",-1)])]),_:1}),x(t("select",{"onUpdate:modelValue":e[10]||(e[10]=l=>s.value.analysis_kind=l),class:"h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-sm"},[...e[29]||(e[29]=[t("option",{value:"structure"},"Structure",-1),t("option",{value:"citations"},"Citations",-1),t("option",{value:"originality"},"Originality",-1),t("option",{value:"argument"},"Argument",-1)])],512),[[h,s.value.analysis_kind]])]),t("div",pe,[o(a(p),null,{default:r(()=>[...e[30]||(e[30]=[n("Chapter ID (optional)",-1)])]),_:1}),o(a(y),{modelValue:s.value.chapter_id,"onUpdate:modelValue":e[11]||(e[11]=l=>s.value.chapter_id=l),type:"number",min:"1"},null,8,["modelValue"])])])])):R("",!0),t("div",me,[o(a(T),{variant:"outline",disabled:f.value,onClick:A},{default:r(()=>[...e[31]||(e[31]=[n("Reset",-1)])]),_:1},8,["disabled"]),o(a(T),{disabled:f.value||!s.value.project_id,onClick:O},{default:r(()=>[f.value?(c(),v("span",ce,"Previewing…")):(c(),v("span",ve,"Preview"))]),_:1},8,["disabled"])])]),_:1})]),_:1}),o(a(k),{class:"border border-border bg-card shadow-sm"},{default:r(()=>[o(a(N),null,{default:r(()=>[o(a(C),{class:"text-base font-semibold"},{default:r(()=>[...e[32]||(e[32]=[n("Resolved Prompts",-1)])]),_:1}),o(a(j),null,{default:r(()=>[...e[33]||(e[33]=[n("System prompt + user prompt sent to the model.",-1)])]),_:1})]),_:1}),o(a(S),{class:"space-y-4"},{default:r(()=>[t("div",_e,[t("div",ye,[e[34]||(e[34]=t("div",{class:"text-xs text-muted-foreground"},"Estimated tokens",-1)),t("div",fe,"System: "+_(m.value?.estimates?.system??0),1),t("div",be,"User: "+_(m.value?.estimates?.user??0),1),t("div",ge,"Total: "+_(m.value?.estimates?.total??0),1)]),t("div",xe,[e[35]||(e[35]=t("div",{class:"text-xs text-muted-foreground"},"Meta",-1)),t("pre",he,_(F.value),1)])]),t("div",we,[o(a(p),null,{default:r(()=>[...e[36]||(e[36]=[n("System Prompt",-1)])]),_:1}),o(a(w),{"model-value":m.value?.system_prompt??"",rows:"10",class:"font-mono text-sm",readonly:""},null,8,["model-value"])]),t("div",Ve,[o(a(p),null,{default:r(()=>[...e[37]||(e[37]=[n("User Prompt",-1)])]),_:1}),o(a(w),{"model-value":m.value?.user_prompt??"",rows:"14",class:"font-mono text-sm",readonly:""},null,8,["model-value"])])]),_:1})]),_:1})])]),_:1}))}});export{We as default};
