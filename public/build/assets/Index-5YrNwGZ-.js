import{d as T,P as X,g as C,o as c,w as l,e as t,u as e,b as d,c1 as Y,h as i,aq as Z,bo as ee,q as M,aw as x,bG as te,s as se,l as h,r as U,ax as ae,c2 as le,a as v,bN as re,t as m,bk as oe,p as de,aD as ne,c as g,F as K,f as q,a1 as ie}from"./vendor-H8yUxHVJ.js";import{s as E}from"./useAppearance-DRazjLJ1.js";import{_ as ue}from"./AdminLayout.vue_vue_type_script_setup_true_lang-CCjfYqFc.js";import{_ as me}from"./DataTable.vue_vue_type_script_setup_true_lang-CRoS6mHF.js";import{_ as z}from"./Switch.vue_vue_type_script_setup_true_lang-DCko7Dmp.js";import{_ as S}from"./index-CwD5qkLf.js";import{a as ce,b as pe,e as fe,c as L,f as _e,_ as ge}from"./Sonner.vue_vue_type_script_setup_true_lang-a4iHnNww.js";import{_ as j,a as I}from"./CardContent.vue_vue_type_script_setup_true_lang-DTkdfvuV.js";import{_ as ve}from"./CardDescription.vue_vue_type_script_setup_true_lang-BbSl0Z72.js";import{_ as N,a as B}from"./CardTitle.vue_vue_type_script_setup_true_lang-B5y-_hAe.js";import{_ as A}from"./Input.vue_vue_type_script_setup_true_lang-DRx-Lc7N.js";import{_ as b}from"./Label.vue_vue_type_script_setup_true_lang-PAGjh1rG.js";import{_ as ye}from"./Textarea.vue_vue_type_script_setup_true_lang-DS0pc_gN.js";import{_ as xe}from"./Checkbox.vue_vue_type_script_setup_true_lang-DRWhnreH.js";import{_ as be,a as $e}from"./index-DHzEmSrj.js";import{_ as ke}from"./AlertTitle.vue_vue_type_script_setup_true_lang-C9ZZR0lx.js";import{_ as we,a as Ve}from"./DialogContent.vue_vue_type_script_setup_true_lang-Dw7gJkgN.js";import{_ as he}from"./DialogDescription.vue_vue_type_script_setup_true_lang-nvWA5ydV.js";import{_ as Ce,a as Se}from"./DialogTitle.vue_vue_type_script_setup_true_lang-Biexvk_x.js";import{_ as Fe,a as De,b as Ue,c as Ae,d as Ee}from"./SelectValue.vue_vue_type_script_setup_true_lang-9plmDTMM.js";import"./UserInfo.vue_vue_type_script_setup_true_lang-B2g6QnB0.js";import"./Presence-Cn1h4MwK.js";import"./useForwardExpose-CEOuSuYA.js";import"./index-CZRrGrlM.js";import"./DialogTitle-FvR-dACM.js";import"./TooltipTrigger.vue_vue_type_script_setup_true_lang-ev0g6x5g.js";import"./VisuallyHidden-BvUOvbOk.js";import"./index-JqClP2ZZ.js";import"./TableHeader.vue_vue_type_script_setup_true_lang-BhA0_Tu7.js";import"./useFormControl-BAvnyqrf.js";import"./VisuallyHiddenInput-Bdtjo0T1.js";import"./nullish-CHIgUVhi.js";import"./isValueEqualOrExist-DSClXoPv.js";import"./ohash.D__AXeF1-C-E83dC9.js";import"./RovingFocusItem-B851wM0P.js";import"./useNonce-DREsFUzM.js";const je=T({__name:"DepartmentActions",props:{department:{}},setup(n){const f=n,$=X("onEditDepartment"),y=()=>{confirm(`Delete ${f.department.name}?`)&&M.delete(E("admin.system.departments.destroy",{department:f.department.id}),{preserveScroll:!0})};return(F,p)=>(c(),C(e(ge),null,{default:l(()=>[t(e(ce),{"as-child":""},{default:l(()=>[t(e(S),{variant:"ghost",class:"h-8 w-8 p-0"},{default:l(()=>[p[1]||(p[1]=d("span",{class:"sr-only"},"Open menu",-1)),t(e(Y),{class:"h-4 w-4"})]),_:1})]),_:1}),t(e(pe),{align:"end"},{default:l(()=>[t(e(fe),null,{default:l(()=>[...p[2]||(p[2]=[i("Actions",-1)])]),_:1}),t(e(L),{onClick:p[0]||(p[0]=k=>e($)?.(f.department))},{default:l(()=>[t(e(Z),{class:"mr-2 h-4 w-4"}),p[3]||(p[3]=i(" Edit ",-1))]),_:1}),t(e(_e)),t(e(L),{onClick:y,class:"text-rose-600 focus:text-rose-600 focus:bg-rose-50"},{default:l(()=>[t(e(ee),{class:"mr-2 h-4 w-4"}),p[4]||(p[4]=i(" Delete ",-1))]),_:1})]),_:1})]),_:1}))}}),Ie=(n,f)=>{M.put(E("admin.system.departments.toggle-active",{department:n.id}),{is_active:f},{preserveScroll:!0})},Ne=[{accessorKey:"name",header:({column:n})=>x(S,{variant:"ghost",class:"-ml-2 text-xs hover:bg-muted/50",onClick:()=>n.toggleSorting(n.getIsSorted()==="asc")},()=>["Name",x(te,{class:"ml-2 h-3 w-3"})]),cell:({row:n})=>{const f=n.getValue("name"),$=n.original.slug,y=n.original.code,F=y?`${y} · ${$}`:$;return x("div",{class:"flex flex-col"},[x("span",{class:"font-medium"},f),x("span",{class:"text-xs text-muted-foreground"},F)])}},{accessorKey:"faculty_name",header:"Faculty",cell:({row:n})=>n.original.faculty_name||"—"},{accessorKey:"sort_order",header:"Order",cell:({row:n})=>n.getValue("sort_order")},{accessorKey:"is_active",header:"Active",cell:({row:n})=>x(z,{checked:n.original.is_active,"onUpdate:checked":f=>Ie(n.original,f)})},{id:"actions",cell:({row:n})=>x(je,{department:n.original})}],Be={class:"grid gap-4 md:grid-cols-2 mb-6"},Oe={class:"text-2xl font-bold"},Pe={class:"text-2xl font-bold"},Ke={class:"grid gap-4 py-4"},qe={class:"grid gap-4 md:grid-cols-2"},Le={class:"space-y-1"},Te={key:0,class:"text-xs text-rose-500"},Me={class:"space-y-1"},ze={key:0,class:"text-xs text-rose-500"},Ge={class:"grid gap-4 md:grid-cols-2"},Re={class:"space-y-1"},He={key:0,class:"text-xs text-rose-500"},Je={class:"space-y-1"},Qe={key:0,class:"text-xs text-rose-500"},We={class:"space-y-2"},Xe={class:"grid gap-2 md:grid-cols-2"},Ye={key:0,class:"text-xs text-rose-500"},Ze={class:"space-y-1"},et={key:0,class:"text-xs text-rose-500"},tt={class:"grid gap-4 md:grid-cols-2"},st={class:"space-y-1"},at={key:0,class:"text-xs text-rose-500"},lt={class:"flex items-center justify-between rounded-md border border-border/70 bg-muted/30 px-3 py-2 text-sm"},rt={class:"flex justify-end gap-2"},Tt=T({__name:"Index",props:{departments:{},faculties:{},stats:{}},setup(n){const f=n,$=se(),y=h(()=>$.props.flash),F=h(()=>f.departments??[]),p=h(()=>f.faculties??[]),k=U(null),w=U(!1),u=U([]),_=U(""),O=()=>({name:"",slug:"",code:"",description:"",faculty_ids:[],primary_faculty_id:"",sort_order:0,is_active:!0}),a=ae({...O()}),D=h(()=>k.value!==null),P=()=>{k.value=null,a.clearErrors(),Object.assign(a,O()),u.value=[],_.value=""},G=()=>{P(),w.value=!0},R=o=>{k.value=o.id,a.clearErrors(),a.name=o.name??"",a.slug=o.slug??"",a.code=o.code??"",a.description=o.description??"";const s=o.faculty_id?[o.faculty_id]:[],r=o.faculty_ids&&o.faculty_ids.length>0?o.faculty_ids:s;u.value=r.filter(Boolean).map(W=>String(W));const V=o.primary_faculty_id??o.faculty_id??r[0]??null;_.value=V?String(V):"",_.value&&!u.value.includes(_.value)&&(u.value=[...u.value,_.value]),a.sort_order=Number(o.sort_order??0),a.is_active=!!o.is_active,w.value=!0},H=h(()=>p.value.filter(o=>u.value.includes(String(o.id)))),J=(o,s)=>{const r=String(o);if(console.log("toggleFaculty called",{facultyId:o,enabled:s,currentIds:[...u.value]}),s){u.value.includes(r)||(u.value=[...u.value,r],console.log("Added faculty, new array:",[...u.value])),_.value||(_.value=r);return}u.value=u.value.filter(V=>V!==r),console.log("Removed faculty, new array:",[...u.value]),_.value===r&&(_.value=u.value[0]??"")},Q=()=>{a.faculty_ids=[...u.value],a.primary_faculty_id=_.value,console.log("Submit called with faculty_ids:",[...a.faculty_ids],"primary:",a.primary_faculty_id);const o={preserveScroll:!0,onSuccess:()=>{w.value=!1,P()}};if(!a.primary_faculty_id&&a.faculty_ids.length>0&&(a.primary_faculty_id=a.faculty_ids[0]),console.log("Final faculty_ids being sent:",[...a.faculty_ids]),D.value&&k.value!==null){a.put(E("admin.system.departments.update",{department:k.value}),o);return}a.post(E("admin.system.departments.store"),o)};return le("onEditDepartment",R),(o,s)=>(c(),C(ue,{title:"Departments",subtitle:"Manage departments available for project setup."},{default:l(()=>[d("div",Be,[t(e(j),{class:"bg-card text-card-foreground border-border/50 shadow-sm"},{default:l(()=>[t(e(N),{class:"flex flex-row items-center justify-between space-y-0 pb-2"},{default:l(()=>[t(e(B),{class:"text-sm font-medium text-muted-foreground"},{default:l(()=>[...s[9]||(s[9]=[i("Total Departments",-1)])]),_:1}),t(e(re),{class:"h-4 w-4 text-muted-foreground"})]),_:1}),t(e(I),null,{default:l(()=>[d("div",Oe,m(o.stats.total),1)]),_:1})]),_:1}),t(e(j),{class:"bg-card text-card-foreground border-border/50 shadow-sm"},{default:l(()=>[t(e(N),{class:"flex flex-row items-center justify-between space-y-0 pb-2"},{default:l(()=>[t(e(B),{class:"text-sm font-medium text-muted-foreground"},{default:l(()=>[...s[10]||(s[10]=[i("Active",-1)])]),_:1}),t(e(oe),{class:"h-4 w-4 text-emerald-500"})]),_:1}),t(e(I),null,{default:l(()=>[d("div",Pe,m(o.stats.active),1)]),_:1})]),_:1})]),y.value?.success?(c(),C(e(be),{key:0,class:"mb-6 border border-emerald-500/40 bg-emerald-500/10"},{default:l(()=>[t(e(de),{class:"h-4 w-4 text-emerald-500"}),t(e(ke),null,{default:l(()=>[...s[11]||(s[11]=[i("Updated",-1)])]),_:1}),t(e($e),null,{default:l(()=>[i(m(y.value.success),1)]),_:1})]),_:1})):v("",!0),t(e(j),{class:"border border-border/50 bg-card shadow-sm"},{default:l(()=>[t(e(N),{class:"flex flex-row items-center justify-between pb-3"},{default:l(()=>[d("div",null,[t(e(B),{class:"text-base font-semibold text-foreground"},{default:l(()=>[...s[12]||(s[12]=[i("Departments",-1)])]),_:1}),t(e(ve),null,{default:l(()=>[...s[13]||(s[13]=[i("Assign departments to faculties for selection.",-1)])]),_:1})]),t(e(S),{size:"sm",onClick:G},{default:l(()=>[t(e(ne),{class:"mr-2 h-4 w-4"}),s[14]||(s[14]=i(" Add Department ",-1))]),_:1})]),_:1}),t(e(I),null,{default:l(()=>[t(me,{columns:e(Ne),data:F.value,"search-key":"name","search-placeholder":"Filter departments..."},null,8,["columns","data"])]),_:1})]),_:1}),t(e(we),{open:w.value,"onUpdate:open":s[8]||(s[8]=r=>w.value=r)},{default:l(()=>[t(e(Ve),{class:"sm:max-w-[700px] max-h-[90vh] overflow-y-auto"},{default:l(()=>[t(e(Ce),null,{default:l(()=>[t(e(Se),null,{default:l(()=>[i(m(D.value?"Edit department":"Create department"),1)]),_:1}),t(e(he),null,{default:l(()=>[i(m(D.value?"Update department details.":"Add a new department to the catalog."),1)]),_:1})]),_:1}),d("div",Ke,[d("div",qe,[d("div",Le,[t(e(b),null,{default:l(()=>[...s[15]||(s[15]=[i("Name",-1)])]),_:1}),t(e(A),{modelValue:e(a).name,"onUpdate:modelValue":s[0]||(s[0]=r=>e(a).name=r),placeholder:"Computer Science"},null,8,["modelValue"]),e(a).errors.name?(c(),g("p",Te,m(e(a).errors.name),1)):v("",!0)]),d("div",Me,[t(e(b),null,{default:l(()=>[...s[16]||(s[16]=[i("Slug",-1)])]),_:1}),t(e(A),{modelValue:e(a).slug,"onUpdate:modelValue":s[1]||(s[1]=r=>e(a).slug=r),placeholder:"computer-science"},null,8,["modelValue"]),e(a).errors.slug?(c(),g("p",ze,m(e(a).errors.slug),1)):v("",!0)])]),d("div",Ge,[d("div",Re,[t(e(b),null,{default:l(()=>[...s[17]||(s[17]=[i("Code",-1)])]),_:1}),t(e(A),{modelValue:e(a).code,"onUpdate:modelValue":s[2]||(s[2]=r=>e(a).code=r),placeholder:"CSC"},null,8,["modelValue"]),e(a).errors.code?(c(),g("p",He,m(e(a).errors.code),1)):v("",!0)]),d("div",Je,[t(e(b),null,{default:l(()=>[...s[18]||(s[18]=[i("Primary Faculty",-1)])]),_:1}),t(e(Fe),{modelValue:_.value,"onUpdate:modelValue":s[3]||(s[3]=r=>_.value=r)},{default:l(()=>[t(e(De),null,{default:l(()=>[t(e(Ue),{placeholder:"Select primary faculty"})]),_:1}),t(e(Ae),null,{default:l(()=>[(c(!0),g(K,null,q(H.value,r=>(c(),C(e(Ee),{key:r.id,value:String(r.id)},{default:l(()=>[i(m(r.name),1)]),_:2},1032,["value"]))),128))]),_:1})]),_:1},8,["modelValue"]),e(a).errors.primary_faculty_id?(c(),g("p",Qe,m(e(a).errors.primary_faculty_id),1)):v("",!0)])]),d("div",We,[t(e(b),null,{default:l(()=>[...s[19]||(s[19]=[i("Faculties (appear in multiple lists)",-1)])]),_:1}),d("div",Xe,[(c(!0),g(K,null,q(p.value,r=>(c(),g("label",{key:r.id,class:"flex items-center gap-2 rounded-md border border-border/70 bg-muted/30 px-3 py-2 text-sm"},[t(e(xe),{checked:u.value.includes(String(r.id)),"onUpdate:checked":V=>J(r.id,V)},null,8,["checked","onUpdate:checked"]),d("span",null,m(r.name),1)]))),128))]),e(a).errors.faculty_ids?(c(),g("p",Ye,m(e(a).errors.faculty_ids),1)):v("",!0)]),d("div",Ze,[t(e(b),null,{default:l(()=>[...s[20]||(s[20]=[i("Description",-1)])]),_:1}),t(e(ye),{modelValue:e(a).description,"onUpdate:modelValue":s[4]||(s[4]=r=>e(a).description=r),rows:"3",placeholder:"Optional description..."},null,8,["modelValue"]),e(a).errors.description?(c(),g("p",et,m(e(a).errors.description),1)):v("",!0)]),d("div",tt,[d("div",st,[t(e(b),null,{default:l(()=>[...s[21]||(s[21]=[i("Sort Order",-1)])]),_:1}),t(e(A),{modelValue:e(a).sort_order,"onUpdate:modelValue":s[5]||(s[5]=r=>e(a).sort_order=r),type:"number",min:"0"},null,8,["modelValue"]),e(a).errors.sort_order?(c(),g("p",at,m(e(a).errors.sort_order),1)):v("",!0)]),d("label",lt,[s[22]||(s[22]=d("span",{class:"text-foreground"},"Active",-1)),t(e(z),{checked:e(a).is_active,"onUpdate:checked":s[6]||(s[6]=r=>e(a).is_active=r)},null,8,["checked"])])])]),d("div",rt,[t(e(S),{variant:"ghost",onClick:s[7]||(s[7]=r=>w.value=!1)},{default:l(()=>[...s[23]||(s[23]=[i("Cancel",-1)])]),_:1}),t(e(S),{disabled:e(a).processing,onClick:Q},{default:l(()=>[e(a).processing?(c(),C(e(ie),{key:0,class:"mr-2 h-4 w-4 animate-spin"})):v("",!0),d("span",null,m(D.value?"Update department":"Add department"),1)]),_:1},8,["disabled"])])]),_:1})]),_:1},8,["open"])]),_:1}))}});export{Tt as default};
