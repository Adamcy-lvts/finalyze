import{aj as k,ak as L,al as M,am as B,an as H,ao as S,ap as y,aq as I,ar as R,as as W,at as j,au as E,av as q,aw as z}from"./index-C3PXxNyG.js";import{d as F,r as V,y as A,I as N,D,c as P,o as U,e as G,u as b}from"./vendor-Bd-YbXdQ.js";import{_ as J}from"./_plugin-vue_export-helper-DlAUqK2U.js";const K={class:"bg-background"},O=F({__name:"RichTextViewer",props:{content:{},showFontControls:{type:Boolean,default:!0},viewerClass:{default:"prose-sm"}},setup(T){const w=k(z),g=T,f=t=>t?(t=t.replace(/```mermaid\n?([\s\S]*?)```/g,(r,e)=>{const a=e.trim();return`<div data-mermaid data-mermaid-code="${a.replace(/&/g,"&amp;").replace(/"/g,"&quot;").replace(/</g,"&lt;").replace(/>/g,"&gt;")}" data-view-mode="diagram"><pre><code class="language-mermaid">${a}</code></pre></div>`}),t=t.replace(/``mermaid\n?([\s\S]*?)``/g,(r,e)=>{const a=e.trim();return`<div data-mermaid data-mermaid-code="${a.replace(/&/g,"&amp;").replace(/"/g,"&quot;").replace(/</g,"&lt;").replace(/>/g,"&gt;")}" data-view-mode="diagram"><pre><code class="language-mermaid">${a}</code></pre></div>`}),t=t.replace(/`mermaid\n([\s\S]*?)`/g,(r,e)=>{const a=e.trim();return`<div data-mermaid data-mermaid-code="${a.replace(/&/g,"&amp;").replace(/"/g,"&quot;").replace(/</g,"&lt;").replace(/>/g,"&gt;")}" data-view-mode="diagram"><pre><code class="language-mermaid">${a}</code></pre></div>`}),t):"",$=t=>t?(t=t.replace(/```(\w+)\n?([\s\S]*?)```/g,(r,e,a)=>`<pre><code class="language-${e}">${a.trim()}</code></pre>`),t=t.replace(/```\n?([\s\S]*?)```/g,(r,e)=>`<pre><code>${e.trim()}</code></pre>`),t):"",C=t=>{if(!t)return"";const r=t.split(`
`);let e=[],a=0;for(;a<r.length;){const s=r[a];if(s.includes("|")){const n=_(r,a);if(n.html){e.push(n.html),a=n.nextIndex;continue}}e.push(s),a++}return e.join(`
`)},_=(t,r)=>{let e=t[r];if(!e||!e.includes("|"))return{html:null,nextIndex:r+1};const a=e.split("|").map(c=>c.trim()).filter(c=>c.length>0);if(a.length===0)return{html:null,nextIndex:r+1};const s=t[r+1];if(!s||!s.includes("|")||!s.includes("-"))return{html:null,nextIndex:r+1};let n=[],p=r+2;for(;p<t.length;){const c=t[p];if(!c||!c.includes("|"))break;const m=c.split("|").map(l=>l.trim()).filter(l=>l.length>0);m.length>0&&n.push(m),p++}let o='<div class="tableWrapper"><table>';return o+="<thead><tr>",a.forEach(c=>{o+=`<th>${c}</th>`}),o+="</tr></thead>",n.length>0&&(o+="<tbody>",n.forEach(c=>{o+="<tr>";for(let m=0;m<a.length;m++){const l=c[m]||"";o+=`<td>${l}</td>`}o+="</tr>"}),o+="</tbody>"),o+="</table></div>",{html:o,nextIndex:p}},v=t=>{if(!t)return"";if(t.includes("<p>")||t.includes("<h1>")||t.includes("<h2>")||t.includes("<div>")){let s=f(t);return s=$(s),s}let e=t;return e=f(e),e=$(e),e=e.replace(/^#### (.*$)/gim,"<h4>$1</h4>"),e=e.replace(/^### (.*$)/gim,"<h3>$1</h3>"),e=e.replace(/^## (.*$)/gim,"<h2>$1</h2>"),e=e.replace(/^# (.*$)/gim,"<h1>$1</h1>"),e=e.replace(/\*\*(.*?)\*\*/g,"<strong>$1</strong>"),e=e.replace(new RegExp("(?<!\\*)\\*([^*\\n]+?)\\*(?!\\*)","g"),"<em>$1</em>"),e=e.replace(/`([^`]+)`/g,"<code>$1</code>"),e=C(e),e.split(/\n\s*\n/).filter(s=>s.trim()).map(s=>{const n=s.trim();if(n.startsWith("<h1>")||n.startsWith("<h2>")||n.startsWith("<h3>")||n.startsWith("<h4>"))return n;if(n.includes(`
`)){const o=n.split(`
`).map(l=>l.trim()).filter(l=>l),c=o.some(l=>l.match(/^\d+\.\s/)),m=o.some(l=>l.match(/^[-*]\s/));if(c||m){const l=o.map(i=>i.match(/^\d+\.\s/)?`<li>${i.replace(/^\d+\.\s/,"")}</li>`:i.match(/^[-*]\s/)?`<li>${i.replace(/^[-*]\s/,"")}</li>`:i);let h=[],u="";for(const i of l)i.startsWith("<li>")?(u&&h.push(u),u=i):u&&(u=u.replace("</li>",` ${i}</li>`));return u&&h.push(u),c?`<ol>${h.join("")}</ol>`:`<ul>${h.join("")}</ul>`}}return`<p>${n.replace(/\n/g,"<br>")}</p>`}).join("")},d=L({content:v(g.content),editable:!1,extensions:[M.configure({heading:{levels:[1,2,3]},codeBlock:!1}),B.configure({lowlight:w,HTMLAttributes:{class:"code-block-highlighted"}}),H,S,y,I.configure({resizable:!0}),R,W,j,E],editorProps:{attributes:{class:`prose dark:prose-invert max-w-none focus:outline-none ${g.viewerClass}`}}});return V("11.5"),A(()=>{setTimeout(()=>{d.value&&d.value.chain().selectAll().setFontSize("11.5pt").run()},100)}),N(()=>g.content,t=>{if(d.value&&d.value.getHTML()!==t){const r=v(t);d.value.commands.setContent(r)}}),D(()=>{d.value&&d.value.destroy()}),(t,r)=>(U(),P("div",K,[G(b(q),{editor:b(d)},null,8,["editor"])]))}}),Z=J(O,[["__scopeId","data-v-a53f8007"]]);export{Z as R};
