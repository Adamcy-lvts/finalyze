import{r as d,m as x,Q as E,R as C,d as S,g as z,o as b,b4 as B,w as m,c as N,a as R,u as s,b as t,e as l,aa as F,b5 as M,at as O,b6 as V,h as _,a6 as j}from"./vendor-Bi-OfESq.js";import{_ as v}from"./index-Bt90G_JS.js";const k=d(!1),I=d(!1);let u=null,g=null,P=!1;const T=async()=>typeof window>"u"||!("serviceWorker"in navigator)?null:u||(g||(g=navigator.serviceWorker.register("/sw.js",{scope:"/"}).then(o=>(u=o,o)).catch(o=>(console.error("SW registration error:",o),null))),g);function D(){const o=async(n=!0)=>{if(!u)return;const i=u.waiting;i&&i.postMessage({type:"SKIP_WAITING"}),n&&window.location.reload()},a=d(null),c=x(()=>a.value!==null),r=d(!1),f=n=>{n.preventDefault(),a.value=n,console.log("PWA: Install prompt available (from event)")},p=()=>{typeof window<"u"&&window.deferredPWAPrompt&&(a.value=window.deferredPWAPrompt,console.log("PWA: Using pre-captured install prompt"))},e=()=>{a.value=null,r.value=!0,typeof window<"u"&&(window.deferredPWAPrompt=null)},W=async()=>{if(!a.value)return!1;await a.value.prompt();const{outcome:n}=await a.value.userChoice;return n==="accepted"?(a.value=null,r.value=!0,!0):!1},L=()=>{a.value=null,localStorage.setItem("pwa-install-dismissed","true")},A=x(()=>!(!c.value||localStorage.getItem("pwa-install-dismissed"))),w=d(typeof navigator<"u"?navigator.onLine:!0),h=()=>{w.value=!0},y=()=>{w.value=!1};return E(()=>{typeof window<"u"&&window.matchMedia("(display-mode: standalone)").matches&&(r.value=!0),typeof window<"u"&&(T().then(n=>{!n||P||(P=!0,setInterval(()=>{n.update()},3600*1e3),n.addEventListener("updatefound",()=>{const i=n.installing;i&&i.addEventListener("statechange",()=>{i.state==="installed"&&(navigator.serviceWorker.controller?k.value=!0:I.value=!0)})}))}),p(),window.addEventListener("beforeinstallprompt",f),window.addEventListener("pwa-install-available",p),window.addEventListener("appinstalled",e),window.addEventListener("online",h),window.addEventListener("offline",y))}),C(()=>{typeof window<"u"&&(window.removeEventListener("beforeinstallprompt",f),window.removeEventListener("pwa-install-available",p),window.removeEventListener("appinstalled",e),window.removeEventListener("online",h),window.removeEventListener("offline",y))}),{needRefresh:k,offlineReady:I,updateServiceWorker:o,canInstall:c,isInstalled:r,installApp:W,dismissInstallPrompt:L,shouldShowInstallPrompt:A,isOnline:w}}const G={key:0,class:"fixed bottom-4 left-4 right-4 z-50 mx-auto max-w-sm overflow-hidden rounded-xl border bg-card shadow-2xl md:left-auto md:right-4",role:"dialog","aria-label":"Install Finalyze app"},U={class:"relative bg-gradient-to-r from-primary/20 to-primary/5 px-4 pb-4 pt-4"},K={class:"space-y-2 px-4 py-3"},Q={class:"flex items-center gap-2 text-sm text-muted-foreground"},X={class:"flex items-center gap-2 text-sm text-muted-foreground"},Z={class:"flex items-center gap-2 text-sm text-muted-foreground"},$={class:"flex gap-2 border-t bg-muted/30 px-4 py-3"},J=S({__name:"PWAInstallPrompt",setup(o){const{shouldShowInstallPrompt:a,installApp:c,dismissInstallPrompt:r}=D(),f=async()=>{await c()};return(p,e)=>(b(),z(B,{"enter-active-class":"transition duration-300 ease-out","enter-from-class":"translate-y-full opacity-0","enter-to-class":"translate-y-0 opacity-100","leave-active-class":"transition duration-200 ease-in","leave-from-class":"translate-y-0 opacity-100","leave-to-class":"translate-y-full opacity-0"},{default:m(()=>[s(a)?(b(),N("div",G,[t("div",U,[l(s(v),{variant:"ghost",size:"icon",class:"absolute right-2 top-2 h-7 w-7 rounded-full hover:bg-background/50",onClick:s(r)},{default:m(()=>[l(s(F),{class:"h-4 w-4"})]),_:1},8,["onClick"]),e[0]||(e[0]=t("div",{class:"flex items-center gap-3"},[t("div",{class:"flex h-14 w-14 shrink-0 items-center justify-center rounded-xl bg-[#0a0a0f] shadow-lg"},[t("img",{src:"/img/finalyze_icon_logo.png",alt:"Finalyze",class:"h-10 w-10 object-contain"})]),t("div",null,[t("h3",{class:"text-base font-semibold text-foreground"},"Install Finalyze"),t("p",{class:"text-sm text-muted-foreground"},"Get the full app experience")])],-1))]),t("div",K,[t("div",Q,[l(s(M),{class:"h-4 w-4 text-primary"}),e[1]||(e[1]=t("span",null,"Launch from your home screen",-1))]),t("div",X,[l(s(O),{class:"h-4 w-4 text-primary"}),e[2]||(e[2]=t("span",null,"Faster loading & performance",-1))]),t("div",Z,[l(s(V),{class:"h-4 w-4 text-primary"}),e[3]||(e[3]=t("span",null,"Access your work offline",-1))])]),t("div",$,[l(s(v),{variant:"outline",class:"flex-1",onClick:s(r)},{default:m(()=>[...e[4]||(e[4]=[_(" Maybe later ",-1)])]),_:1},8,["onClick"]),l(s(v),{class:"flex-1",onClick:f},{default:m(()=>[l(s(j),{class:"mr-2 h-4 w-4"}),e[5]||(e[5]=_(" Install App ",-1))]),_:1})])])):R("",!0)]),_:1}))}});export{J as _,D as u};
