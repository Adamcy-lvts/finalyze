import{d as F,y as x,a as V,c as S,o as k,H as l,u as p,E as f,K as c,P as L,M as I,n as D,T as W,O as E,J as $,w as H,aa as A,R as Z,q as J,ad as z}from"./app-Drfb5vhD.js";import{c as X,_ as C}from"./index-Cn9MYLLD.js";import{_ as Y}from"./ChapterNavigation.vue_vue_type_script_setup_true_lang-BZeFMCMu.js";import{_ as ee}from"./index-D-3iZmNB.js";import{_ as q,a as O,b as K}from"./CollapsibleTrigger.vue_vue_type_script_setup_true_lang-BFOmMiMf.js";import{h as te,_ as se}from"./SafeHtmlText.vue_vue_type_script_setup_true_lang-Bvq65SGC.js";import{L as ae}from"./lightbulb-DbEJmx_B.js";import{C as Q}from"./chevron-down-33M1r9k2.js";import{X as R,t as w}from"./index-D8sJQrjD.js";import{W as ne,b as oe}from"./useTextHistory-tC515YYD.js";import{S as re}from"./sparkles-DEWv_BOy.js";import{A as ie,Q as le}from"./RichTextEditor-Db4mg1yL.js";import{T as ce}from"./type-DSdf5Qle.js";import{_ as ue}from"./DefensePreparationPanel.vue_vue_type_script_setup_true_lang-mjq18iqC.js";import{_ as M}from"./Separator.vue_vue_type_script_setup_true_lang-CIDsLKap.js";import{_ as de}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{u as G}from"./index-BUawP80q.js";import{r as pe}from"./useWordBalance-DlwRiA6H.js";/**
 * @license lucide-vue-next v0.468.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ge=X("BookmarkIcon",[["path",{d:"m19 21-7-4-7 4V5a2 2 0 0 1 2-2h10a2 2 0 0 1 2 2v16z",key:"1fy3hk"}]]),me={class:"bg-card/50 backdrop-blur-sm border rounded-xl shadow-sm transition-all hover:shadow-md"},he={class:"flex items-start justify-between gap-4 p-4"},fe={class:"flex-1 min-w-0"},ve={type:"button",class:"w-full text-left flex items-center gap-2 rounded-lg hover:bg-muted/30 transition-colors pr-2 -mr-2"},be={class:"p-1.5 rounded-md bg-primary/10 text-primary shrink-0"},ye={class:"flex flex-col gap-1"},xe={class:"px-4 pb-4 space-y-3"},we={key:0,class:"pt-2 border-t border-border/50"},Ce={class:"text-xs text-amber-600 dark:text-amber-400 flex items-center gap-1.5"},_e={class:"pt-1 flex justify-end"},Se=F({__name:"SmartSuggestionPanel",props:{suggestion:{},analysis:{}},emits:["save","clear","apply"],setup(m,{emit:a}){const i=m,t=a,o=(s=>({writing_guide:{label:"Writing Guide",variant:"default"},claims_without_evidence:{label:"Evidence Needed",variant:"destructive"},insufficient_citations:{label:"Add Citations",variant:"warning"},insufficient_tables:{label:"Add Data",variant:"secondary"},weak_arguments:{label:"Strengthen Arguments",variant:"warning"},insufficient_content:{label:"Expand Content",variant:"secondary"}})[s]||{label:s,variant:"default"})(i.suggestion.suggestion_type),h=x(!0),b=s=>{const v=s.trim().match(/^```[a-zA-Z0-9_-]*\s*\n([\s\S]*?)\n?```$/);return v?v[1].trim():s},y=s=>{const n=b(s).trim();return n?n.split(/\n\s*\n/).filter(e=>e.trim()).map(e=>{const r=e.trim(),g=r.split(`
`).map(_=>_.trim()).filter(Boolean),T=g.some(_=>/^[-*•]\s+/.test(_)),j=g.some(_=>/^\d+\.\s+/.test(_));if(T||j){const _=g.map(B=>j&&/^\d+\.\s+/.test(B)?`<li>${B.replace(/^\d+\.\s+/,"")}</li>`:T&&/^[-*•]\s+/.test(B)?`<li>${B.replace(/^[-*•]\s+/,"")}</li>`:"").filter(Boolean);return j?`<ol>${_.join("")}</ol>`:`<ul>${_.join("")}</ul>`}return`<p>${r.replace(/\n/g,"<br>")}</p>`}).join(""):""},u=V(()=>{const s=i.suggestion?.suggestion_content||"";if(!s)return"";const n=b(s);return te(n)?n:y(n)});return(s,n)=>(k(),S("div",me,[l(p(q),{open:h.value,"onUpdate:open":n[3]||(n[3]=v=>h.value=v)},{default:f(()=>[c("div",he,[c("div",fe,[l(p(O),{"as-child":""},{default:f(()=>[c("button",ve,[c("div",be,[l(p(ae),{class:"w-4 h-4"})]),n[4]||(n[4]=c("h3",{class:"font-semibold text-sm truncate"},"Smart Suggestion",-1)),l(p(ee),{variant:p(o).variant,class:"text-[10px] px-2 py-0.5 h-5 shrink-0"},{default:f(()=>[L(I(p(o).label),1)]),_:1},8,["variant"]),l(p(Q),{class:D(["w-4 h-4 ml-auto text-muted-foreground transition-transform duration-200 shrink-0",h.value?"rotate-180":""])},null,8,["class"])])]),_:1})]),c("div",ye,[l(p(C),{size:"icon",variant:"ghost",class:"h-7 w-7",onClick:n[0]||(n[0]=W(v=>t("clear"),["stop"])),title:"Dismiss"},{default:f(()=>[l(p(R),{class:"w-4 h-4"})]),_:1}),l(p(C),{size:"icon",variant:"ghost",class:"h-7 w-7",onClick:n[1]||(n[1]=W(v=>t("save"),["stop"])),title:"Save for later"},{default:f(()=>[l(p(ge),{class:"w-4 h-4"})]),_:1})])]),l(p(K),null,{default:f(()=>[c("div",xe,[l(se,{as:"div",content:u.value,class:"prose prose-sm dark:prose-invert max-w-none text-sm text-muted-foreground leading-relaxed prose-p:my-2 prose-ul:my-2 prose-ol:my-2 prose-li:my-1 prose-pre:my-2 prose-code:text-xs"},null,8,["content"]),s.analysis&&s.analysis.detected_issues.length>0?(k(),S("div",we,[c("p",Ce,[n[5]||(n[5]=c("span",{class:"w-1.5 h-1.5 rounded-full bg-amber-500"},null,-1)),L(" Issues: "+I(s.analysis.detected_issues.join(", ").replace(/_/g," ")),1)])])):E("",!0),c("div",_e,[l(p(C),{size:"sm",variant:"default",onClick:n[2]||(n[2]=v=>t("apply")),class:"w-full sm:w-auto"},{default:f(()=>[...n[6]||(n[6]=[L(" Apply Suggestion ",-1)])]),_:1})])])]),_:1})]),_:1},8,["open"])]))}});function P(m){if(!m)return 0;const i=String(m).replace(/<[^>]*>/g,"").trim().replace(/\s+/g," ");if(!i)return 0;const t=i.match(/\b\w+\b/g);return t?t.length:0}const ke={class:"space-y-2"},$e={class:"flex items-center gap-3"},Te={class:"p-2 rounded-lg bg-purple-500/10 text-purple-600 dark:text-purple-400"},je={class:"grid grid-cols-2 gap-2"},Ae={class:"p-1.5 rounded-full bg-blue-500/10 text-blue-500"},Ie={class:"text-xs font-medium"},ze={class:"p-1.5 rounded-full bg-purple-500/10 text-purple-500"},Be={class:"text-xs font-medium"},Le={class:"p-1.5 rounded-full bg-orange-500/10 text-orange-500"},Ee={class:"text-xs font-medium"},Pe={class:"p-1.5 rounded-full bg-emerald-500/10 text-emerald-500"},Me={class:"text-xs font-medium"},Re=F({__name:"QuickActionsPanel",props:{projectSlug:{},chapterNumber:{},selectedText:{},chapterContent:{},isProcessing:{type:Boolean},ensureBalance:{type:Function},onUsage:{type:Function}},emits:["textImproved","textExpanded","citationsSuggested","textRephrased","customPromptExecuted","openCitationHelper"],setup(m,{emit:a}){const i=m,t=a,d=x(!0),o=x({improve:!1,expand:!1,cite:!1,rephrase:!1,custom:!1}),h=u=>{const s=i.selectedText?.trim()||"",n=i.chapterContent?.trim()||"";return u==="expand"||u==="rephrase"?s:n||s},b=async u=>{try{const s=await u.json();return s?.message||s?.error||`HTTP ${u.status}`}catch{return`HTTP ${u.status}`}},y=async u=>{if(i.ensureBalance&&!i.ensureBalance(300,"use quick actions"))return;const s=h(u);if(!s){w.error(u==="expand"||u==="rephrase"?"Please select some text first":"Please add some content first");return}if(!i.selectedText&&(u==="expand"||u==="rephrase")){w.error("Please select some text first");return}if(u==="cite"){t("openCitationHelper"),w("Opening citation helper...");return}o.value[u]=!0;try{let n="",v;switch(u){case"improve":n="projects.manual-editor.improve-text",v="textImproved";break;case"expand":n="projects.manual-editor.expand-text",v="textExpanded";break;case"rephrase":n="projects.manual-editor.rephrase-text",v="textRephrased";break}const e=await fetch($(n,{project:i.projectSlug,chapter:i.chapterNumber}),{method:"POST",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":document.querySelector('meta[name="csrf-token"]')?.content||"",Accept:"application/json"},body:JSON.stringify({text:s})});if(!e.ok){const g=await b(e);throw new Error(g)}const r=await e.json();u==="improve"&&r.improvedText?(t("textImproved",r.improvedText),await i.onUsage?.(P(r.improvedText),"Manual editor: Improve"),w.success("Text improved successfully!")):u==="expand"&&r.expandedText?(t("textExpanded",r.expandedText),await i.onUsage?.(P(r.expandedText),"Manual editor: Expand"),w.success("Text expanded successfully!")):u==="rephrase"&&r.alternatives&&(t("textRephrased",r.alternatives),await i.onUsage?.(P(r.alternatives),"Manual editor: Rephrase"),w.success("Alternative phrasings generated!"))}catch(n){console.error(`Failed to ${u} text:`,n);const v=n instanceof Error?n.message:"";w.error(`Failed to ${u} text. Please try again.`,v?{description:v}:void 0)}finally{o.value[u]=!1}};return(u,s)=>(k(),S("div",ke,[l(p(q),{open:d.value,"onUpdate:open":s[4]||(s[4]=n=>d.value=n),class:"space-y-2"},{default:f(()=>[l(p(O),{class:"flex w-full items-center justify-between rounded-xl p-4 hover:bg-accent/50 transition-colors duration-200 group"},{default:f(()=>[c("div",$e,[c("div",Te,[l(p(ne),{class:"h-4 w-4"})]),s[5]||(s[5]=c("div",{class:"flex flex-col items-start gap-1"},[c("span",{class:"text-sm font-semibold"},"Quick Actions"),c("span",{class:"text-[10px] text-muted-foreground"}," AI-powered writing tools ")],-1))]),l(p(Q),{class:D(["h-4 w-4 text-muted-foreground transition-transform duration-200",d.value?"rotate-180":""])},null,8,["class"])]),_:1}),l(p(K),{class:"space-y-4 px-4 pb-4"},{default:f(()=>[c("div",je,[l(p(C),{onClick:s[0]||(s[0]=n=>y("improve")),disabled:u.isProcessing||o.value.improve,variant:"outline",class:"h-20 flex-col gap-2 rounded-xl border-border/50 bg-background/50 hover:bg-accent hover:border-accent transition-all duration-300"},{default:f(()=>[c("div",Ae,[l(p(re),{class:"h-4 w-4"})]),c("span",Ie,I(o.value.improve?"Improving...":"Improve"),1)]),_:1},8,["disabled"]),l(p(C),{onClick:s[1]||(s[1]=n=>y("expand")),disabled:!u.selectedText||u.isProcessing||o.value.expand,variant:"outline",class:"h-20 flex-col gap-2 rounded-xl border-border/50 bg-background/50 hover:bg-accent hover:border-accent transition-all duration-300"},{default:f(()=>[c("div",ze,[l(p(ie),{class:"h-4 w-4"})]),c("span",Be,I(o.value.expand?"Expanding...":"Expand"),1)]),_:1},8,["disabled"]),l(p(C),{onClick:s[2]||(s[2]=n=>y("cite")),disabled:u.isProcessing||o.value.cite,variant:"outline",class:"h-20 flex-col gap-2 rounded-xl border-border/50 bg-background/50 hover:bg-accent hover:border-accent transition-all duration-300"},{default:f(()=>[c("div",Le,[l(p(le),{class:"h-4 w-4"})]),c("span",Ee,I(o.value.cite?"Citing...":"Cite"),1)]),_:1},8,["disabled"]),l(p(C),{onClick:s[3]||(s[3]=n=>y("rephrase")),disabled:!u.selectedText||u.isProcessing||o.value.rephrase,variant:"outline",class:"h-20 flex-col gap-2 rounded-xl border-border/50 bg-background/50 hover:bg-accent hover:border-accent transition-all duration-300"},{default:f(()=>[c("div",Pe,[l(p(ce),{class:"h-4 w-4"})]),c("span",Me,I(o.value.rephrase?"Rephrasing...":"Rephrase"),1)]),_:1},8,["disabled"])]),s[6]||(s[6]=c("div",{class:"p-3 rounded-lg bg-muted/50 border border-border/50"},[c("p",{class:"text-[10px] text-muted-foreground leading-relaxed"},[c("strong",null,"Tip:"),L(" Select text before using Expand or Rephrase. Improve and Cite work on your entire content. ")])],-1))]),_:1})]),_:1},8,["open"])]))}}),Fe={key:0,class:"fixed inset-0 z-50 lg:hidden"},Ne={class:"fixed top-0 left-0 h-full w-80 overflow-y-auto border-r bg-background shadow-xl transform transition-transform"},We={class:"border-b p-3"},Ue={class:"flex items-center justify-between"},De={class:"space-y-4 p-4 mobile-enhanced"},He={key:0,class:"fixed inset-0 z-50 lg:hidden"},qe={class:"fixed top-0 right-0 h-full w-96 overflow-y-auto border-l bg-background shadow-xl transform transition-transform"},Oe={class:"border-b p-3"},Ke={class:"flex items-center justify-between"},Qe={class:"space-y-4 p-4 mobile-enhanced"},Ge={key:0,class:"space-y-2"},Ve=F({__name:"MobileNavOverlay",props:{showLeftSidebar:{type:Boolean},showRightSidebar:{type:Boolean},isMobile:{type:Boolean},allChapters:{},currentChapter:{},project:{},facultyChapters:{},currentWordCount:{},targetWordCount:{},chapterContentLength:{},selectedText:{},isAnalyzing:{type:Boolean},isSaving:{type:Boolean},currentSuggestion:{},currentAnalysis:{},chapterContent:{},showCitationHelper:{type:Boolean},ensureBalance:{type:Function},onUsage:{type:Function}},emits:["update:showLeftSidebar","update:showRightSidebar","update:showCitationHelper","goToChapter","generateNextChapter","deleteChapter","saveSuggestion","clearSuggestion","applySuggestion","textImproved","textExpanded","citationsSuggested","textRephrased","insertCitation"],setup(m,{emit:a}){const i=m,t=a,d=x(!0),o=x(i.showCitationHelper);H(()=>i.showCitationHelper,e=>{o.value=e});const h=()=>t("update:showLeftSidebar",!1),b=()=>t("update:showRightSidebar",!1),y=e=>{o.value=e,t("update:showCitationHelper",e)},u=e=>{t("goToChapter",e),h()},s=()=>t("generateNextChapter"),n=e=>t("deleteChapter",e),v=e=>t("insertCitation",e);return(e,r)=>(k(),S("div",null,[l(A,{"enter-active-class":"duration-300 ease-out","enter-from-class":"opacity-0","enter-to-class":"opacity-100","leave-active-class":"duration-200 ease-in","leave-from-class":"opacity-100","leave-to-class":"opacity-0"},{default:f(()=>[e.showLeftSidebar&&e.isMobile?(k(),S("div",Fe,[l(A,{"enter-active-class":"duration-300 ease-out","enter-from-class":"opacity-0","enter-to-class":"opacity-100","leave-active-class":"duration-200 ease-in","leave-from-class":"opacity-100","leave-to-class":"opacity-0"},{default:f(()=>[c("div",{class:"fixed inset-0 bg-black/50",onClick:h})]),_:1}),l(A,{"enter-active-class":"duration-300 ease-out","enter-from-class":"-translate-x-full","enter-to-class":"translate-x-0","leave-active-class":"duration-200 ease-in","leave-from-class":"translate-x-0","leave-to-class":"-translate-x-full"},{default:f(()=>[c("div",Ne,[c("div",We,[c("div",Ue,[r[9]||(r[9]=c("h2",{class:"text-base font-semibold"},"Table of Contents",-1)),l(p(C),{onClick:h,variant:"ghost",size:"sm",class:"h-8 w-8"},{default:f(()=>[l(p(R),{class:"h-4 w-4"})]),_:1})])]),c("div",De,[l(Y,{"all-chapters":e.allChapters,"current-chapter":e.currentChapter,project:e.project,outlines:e.project.outlines||[],"faculty-chapters":e.facultyChapters||[],"current-word-count":e.currentWordCount,"target-word-count":e.targetWordCount,"writing-quality-score":0,"chapter-content-length":e.chapterContentLength,onGoToChapter:u,onGenerateNextChapter:s,onDeleteChapter:n},null,8,["all-chapters","current-chapter","project","outlines","faculty-chapters","current-word-count","target-word-count","chapter-content-length"])])])]),_:1})])):E("",!0)]),_:1}),l(A,{"enter-active-class":"duration-300 ease-out","enter-from-class":"opacity-0","enter-to-class":"opacity-100","leave-active-class":"duration-200 ease-in","leave-from-class":"opacity-100","leave-to-class":"opacity-0"},{default:f(()=>[e.showRightSidebar&&e.isMobile?(k(),S("div",He,[l(A,{"enter-active-class":"duration-300 ease-out","enter-from-class":"opacity-0","enter-to-class":"opacity-100","leave-active-class":"duration-200 ease-in","leave-from-class":"opacity-100","leave-to-class":"opacity-0"},{default:f(()=>[c("div",{class:"fixed inset-0 bg-black/50",onClick:b})]),_:1}),l(A,{"enter-active-class":"duration-300 ease-out","enter-from-class":"translate-x-full","enter-to-class":"translate-x-0","leave-active-class":"duration-200 ease-in","leave-from-class":"translate-x-0","leave-to-class":"translate-x-full"},{default:f(()=>[c("div",qe,[c("div",Oe,[c("div",Ke,[r[10]||(r[10]=c("h2",{class:"text-base font-semibold"},"AI Tools",-1)),l(p(C),{onClick:b,variant:"ghost",size:"sm",class:"h-8 w-8"},{default:f(()=>[l(p(R),{class:"h-4 w-4"})]),_:1})])]),c("div",Qe,[e.currentSuggestion?(k(),S("div",Ge,[l(Se,{suggestion:e.currentSuggestion,analysis:e.currentAnalysis,onSave:r[0]||(r[0]=g=>e.$emit("saveSuggestion",g)),onClear:r[1]||(r[1]=g=>e.$emit("clearSuggestion")),onApply:r[2]||(r[2]=g=>e.$emit("applySuggestion"))},null,8,["suggestion","analysis"]),l(p(M),{class:"bg-border/50"})])):E("",!0),l(Re,{"project-slug":e.project.slug,"chapter-number":e.currentChapter.chapter_number,"selected-text":e.selectedText,"chapter-content":e.chapterContent,"is-processing":e.isAnalyzing||e.isSaving,"ensure-balance":e.ensureBalance,"on-usage":e.onUsage,onTextImproved:r[3]||(r[3]=g=>e.$emit("textImproved",g)),onTextExpanded:r[4]||(r[4]=g=>e.$emit("textExpanded",g)),onCitationsSuggested:r[5]||(r[5]=g=>e.$emit("citationsSuggested",g)),onTextRephrased:r[6]||(r[6]=g=>e.$emit("textRephrased",g))},null,8,["project-slug","chapter-number","selected-text","chapter-content","is-processing","ensure-balance","on-usage"]),l(p(M),{class:"bg-border/50"}),l(oe,{"show-citation-helper":o.value,"onUpdate:showCitationHelper":[r[7]||(r[7]=g=>o.value=g),y],"chapter-content":e.chapterContent,"chapter-id":e.currentChapter?.id||0,onInsertCitation:v},null,8,["show-citation-helper","chapter-content","chapter-id"]),l(p(M),{class:"bg-border/50"}),l(ue,{"show-defense-prep":d.value,"onUpdate:showDefensePrep":r[8]||(r[8]=g=>d.value=g),questions:[],"is-loading":!1,"is-generating":!1,"chapter-context":{project:e.project,chapter:e.currentChapter,wordCount:e.currentWordCount},onGenerateMore:()=>{},onRefresh:()=>{}},null,8,["show-defense-prep","chapter-context"])])])]),_:1})])):E("",!0)]),_:1})]))}}),mt=de(Ve,[["__scopeId","data-v-ce6cd9ec"]]);function ht(m,a){const i=x(m.content||""),t=x(!1),d=x(!1),o=x(null),h=e=>{i.value=e,t.value=!0,y()},b=async()=>{if(!(!t.value||d.value)){d.value=!0;try{await z.post($("projects.manual-editor.save",{project:a,chapter:m.chapter_number}),{content:i.value}),t.value=!1,o.value=new Date().toLocaleTimeString()}catch(e){throw console.error("Failed to save chapter:",e),e}finally{d.value=!1}}},y=G(b,2e3),u=async()=>{if(!d.value){d.value=!0;try{return await z.post($("projects.manual-editor.save",{project:a,chapter:m.chapter_number}),{content:i.value}),t.value=!1,o.value=new Date().toLocaleTimeString(),!0}catch(e){throw console.error("Failed to save chapter:",e),e}finally{d.value=!1}}},s=e=>{t.value&&(e.preventDefault(),e.returnValue="")},n=e=>{t.value&&!confirm("You have unsaved changes. Are you sure you want to leave?")&&e.preventDefault()};window.addEventListener("beforeunload",s);const v=Z.on("before",n);return J(()=>{window.removeEventListener("beforeunload",s),v(),t.value&&b()}),{content:i,isDirty:t,isSaving:d,lastSaved:o,updateContent:h,save:b,manualSave:u}}class U{static analyze(a){const t=new DOMParser().parseFromString(a,"text/html");return{word_count:this.countWords(t),citation_count:this.countCitations(t),table_count:this.countTables(t),figure_count:this.countFigures(t),claim_count:this.countClaims(t),has_introduction:this.hasIntroduction(t),has_conclusion:this.hasConclusion(t),detected_issues:this.detectIssues(t),quality_metrics:this.calculateQualityMetrics(t)}}static countWords(a){return(a.body.textContent||"").trim().split(/\s+/).filter(t=>t.length>0).length}static countCitations(a){const i=a.body.textContent||"",t=[/\([A-Z][a-z]+,?\s+\d{4}\)/g,/\[[0-9]+\]/g,/\([A-Z][a-z]+\s+et al\.,?\s+\d{4}\)/g];let d=0;return t.forEach(o=>{const h=i.match(o);h&&(d+=h.length)}),d+=a.querySelectorAll("cite, [data-citation]").length,d}static countTables(a){return a.querySelectorAll("table").length}static countFigures(a){return a.querySelectorAll("img, figure").length}static countClaims(a){const t=(a.body.textContent||"").split(/[.!?]+/),d=["demonstrates","proves","shows","indicates","reveals","confirms","establishes","suggests","implies","evidences"];return t.filter(o=>d.some(h=>o.toLowerCase().includes(h))).length}static hasIntroduction(a){const i=(a.body.textContent||"").toLowerCase();return["introduction","background","overview"].some(d=>i.includes(d))}static hasConclusion(a){const i=(a.body.textContent||"").toLowerCase();return["conclusion","summary","in summary"].some(d=>i.includes(d))}static detectIssues(a){const i=[],t=a.body.textContent||"",d=this.countClaims(a),o=this.countCitations(a);return d>0&&o===0&&i.push("claims_without_evidence"),d>o*2&&i.push("insufficient_citations"),t.toLowerCase().includes("methodology")&&this.countTables(a)===0&&i.push("insufficient_tables"),["maybe","might","could possibly","seems to"].some(s=>t.toLowerCase().includes(s))&&d>3&&i.push("weak_arguments"),this.countWords(a)<100&&i.push("insufficient_content"),i}static calculateQualityMetrics(a){const t=(a.body.textContent||"").split(/[.!?]+/).filter(h=>h.trim().length>0),d=a.querySelectorAll("p").length,o=t.length>0?this.countWords(a)/t.length:0;return{avg_sentence_length:Math.round(o),paragraph_count:d,reading_level:o>25?"complex":o>15?"moderate":"simple"}}}function ft(m,a,i,t,d){const o=x(i),h=x(null),b=x(!1),y=x(new Set),s=G(async()=>{if(!(t.value.length<100)&&!(!a||!m?.chapter_number)){b.value=!0;try{const r=U.analyze(t.value);if(h.value=r,r.detected_issues.length===0){b.value=!1;return}const g=await z.post($("projects.manual-editor.analyze",{project:a,chapter:m.chapter_number}),{analysis:r});if(g.data.suggestion){o.value=g.data.suggestion;const T=Number(g.data.suggestion?.id);if(T&&!y.value.has(T)){const j=P(g.data.suggestion?.suggestion_content||"");j>0&&(y.value.add(T),pe(j,"Manual editor: Smart suggestion","chapter",m.id).then(()=>d?.onUsageRecorded?.()).catch(N=>console.error("Failed to record word usage (manual suggestion):",N)))}}}catch(r){console.error("Failed to analyze and request suggestion:",r)}finally{b.value=!1}}},5e3);return H(t,()=>{t.value.length>0&&(h.value=U.analyze(t.value)),s()}),{currentSuggestion:o,currentAnalysis:h,isAnalyzing:b,saveSuggestion:async()=>{if(o.value&&!(!a||!m?.chapter_number))try{await z.post($("projects.manual-editor.suggestion.save",{project:a,chapter:m.chapter_number,suggestion:o.value.id})),w("Suggestion saved",{description:"You can refer to this suggestion later."})}catch{w("Failed to save suggestion",{description:"Please try again."})}},clearSuggestion:async()=>{if(o.value&&!(!a||!m?.chapter_number))try{await z.post($("projects.manual-editor.suggestion.clear",{project:a,chapter:m.chapter_number,suggestion:o.value.id})),o.value=null}catch{w("Failed to clear suggestion",{description:"Please try again."})}},applySuggestion:async()=>{if(o.value&&!(!a||!m?.chapter_number))try{await z.post($("projects.manual-editor.suggestion.apply",{project:a,chapter:m.chapter_number,suggestion:o.value.id})),w("Suggestion applied",{description:"The suggestion has been marked as applied."}),o.value=null}catch{w("Failed to apply suggestion",{description:"Please try again."})}}}}export{mt as M,Re as _,ft as a,Se as b,P as c,ht as u};
