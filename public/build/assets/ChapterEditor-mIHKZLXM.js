const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/AISidebar-CePhAH1T.js","assets/app-VmIkgWBY.js","assets/app-KFpf9KFZ.css","assets/index-BJSIFph3.js","assets/CardContent.vue_vue_type_script_setup_true_lang-Cb_8jfwT.js","assets/CardTitle.vue_vue_type_script_setup_true_lang-j4AD8KV6.js","assets/CollapsibleTrigger.vue_vue_type_script_setup_true_lang-CzCuU6II.js","assets/VisuallyHidden-BAxoT5X5.js","assets/useForwardExpose-DSP-40WM.js","assets/Separator.vue_vue_type_script_setup_true_lang-CYQCz-3c.js","assets/Separator-DnC6OMFP.js","assets/Progress.vue_vue_type_script_setup_true_lang-Doo5IkBn.js","assets/nullish-CHIgUVhi.js","assets/Sonner.vue_vue_type_script_setup_true_lang-QiSNjKcB.js","assets/DropdownMenuTrigger.vue_vue_type_script_setup_true_lang-BACWwGEz.js","assets/triangle-alert-B9bRhR8x.js","assets/circle-check-Cus68PVN.js","assets/CitationHelper.vue_vue_type_script_setup_true_lang-DZB5qls-.js","assets/index-D4xO16iz.js","assets/Input.vue_vue_type_script_setup_true_lang-D0OX6Ifa.js","assets/ScrollArea.vue_vue_type_script_setup_true_lang-BvQaizao.js","assets/useNonce-Bnn6-ld9.js","assets/AlertDialogTitle.vue_vue_type_script_setup_true_lang-BY9iKP8t.js","assets/RichTextEditor-Cr6VPunt.js","assets/_plugin-vue_export-helper-DlAUqK2U.js","assets/SafeHtmlText.vue_vue_type_script_setup_true_lang-DI75JFou.js","assets/index-BWEDi_FC.js","assets/step-DrZ9DcYd.js","assets/DialogTitle.vue_vue_type_script_setup_true_lang-DIQ68_IQ.js","assets/DialogFooter.vue_vue_type_script_setup_true_lang-Dh8LRqlQ.js","assets/Label.vue_vue_type_script_setup_true_lang-BWW4caQ4.js","assets/type-BQA-ujsk.js","assets/minus-DTxf3rGE.js","assets/plus-D7tpekVh.js","assets/list-BTeXPBBG.js","assets/RichTextEditor-BDJ8Kfyb.css","assets/chevron-down-CkFng04d.js","assets/wand-sparkles-QX6A-u4r.js","assets/search-DMjEDykd.js","assets/trash-2-iJDCG_Zy.js","assets/copy-BUqoZLv1.js","assets/brain-DQjr5LD0.js","assets/zap-Byeaqa79.js","assets/pen-tool-C8tJhlsi.js","assets/refresh-cw-CpmM4lVW.js","assets/sparkles-DAQjs83T.js","assets/AISidebar-Ymbz_oju.css","assets/ChapterNavigation-C1XsoFkL.js","assets/ChapterNavigation.vue_vue_type_script_setup_true_lang-Br1QmnKo.js","assets/DialogTrigger-CvsYHybX.js","assets/chevron-right-1f__Kgh4.js","assets/circle-check-big-BpD8sRJl.js","assets/lock-BXpCMEDl.js","assets/target-B5v8cFN5.js","assets/MobileNavOverlay-Bea-z4_Y.js","assets/index-Bac4wu6G.js","assets/DefensePreparationPanel.vue_vue_type_script_setup_true_lang-DnRCgxD7.js","assets/thumbs-up-g9ZMRSSA.js","assets/lightbulb-CvNva_wt.js","assets/download-BWLv5HOw.js","assets/circle-alert-CdHxZXu6.js","assets/DataCollectionPanel.vue_vue_type_script_setup_true_lang-B2x3rqCR.js","assets/MobileNavOverlay-CN-XSdXy.css","assets/ChatModeLayout-CUSAszCq.js","assets/ChatModeLayout.vue_vue_type_script_setup_true_lang-Caj4VBPP.js","assets/useTextHistory-DWbvRP3r.js","assets/Checkbox.vue_vue_type_script_setup_true_lang-CSbd7sO8.js","assets/ohash.D__AXeF1-C-E83dC9.js","assets/VisuallyHiddenInput-BKoJ7-jS.js","assets/RovingFocusItem-NjCnkNxF.js","assets/check-B2qZeEYJ.js","assets/file-text-BhwtZJOe.js","assets/useTextHistory-BWcwai4o.css","assets/loader-BrdjTs0W.js","assets/message-square-Cb0Datnj.js","assets/chevron-left-CLObhf47.js","assets/clock-BohWxAP-.js","assets/rotate-ccw-CdHGLxmk.js","assets/chart-column-Bv615Q37.js","assets/user-v84ezFqw.js","assets/eye-DZ_L64hs.js","assets/save-DQlvth88.js","assets/ChatModeLayout-wjQGykpm.css","assets/CitationVerificationLayout-DX8HYl8d.js","assets/DefensePreparationPanel-BXBG8Gcc.js","assets/DataCollectionPanel-F72P3mCb.js"])))=>i.map(i=>d[i]);
import{ak as la,ab as ia,d as mr,g as A,c as U,q as de,o as y,u as t,w as o,k as s,e as r,s as O,n as ie,t as f,a as W,F as _t,E as Ct,Y as Le,A as c,N as ut,Q as xe,y as te,h as nt,p as ot,j as ua,al as qe,x as Ye,T as rr,am as lt,b as Ne,f as Oe,an as Re}from"./app-VmIkgWBY.js";import{_ as ke}from"./index-D4xO16iz.js";import{_ as z}from"./index-BJSIFph3.js";import{_ as St,a as kt}from"./CardContent.vue_vue_type_script_setup_true_lang-Cb_8jfwT.js";import{_ as Et,a as br}from"./CardTitle.vue_vue_type_script_setup_true_lang-j4AD8KV6.js";import{_ as ar}from"./Input.vue_vue_type_script_setup_true_lang-D0OX6Ifa.js";import{_ as bt}from"./Label.vue_vue_type_script_setup_true_lang-BWW4caQ4.js";import{_ as wr}from"./Progress.vue_vue_type_script_setup_true_lang-Doo5IkBn.js";import{_ as sr}from"./ScrollArea.vue_vue_type_script_setup_true_lang-BvQaizao.js";import{_ as se,a as ne,b as oe}from"./UserInfo.vue_vue_type_script_setup_true_lang-DIY5100-.js";import{u as ca,_ as da,a as pa,r as Ze}from"./AppLayout.vue_vue_type_script_setup_true_lang-DcLqYe8A.js";import{_ as nr}from"./SafeHtmlText.vue_vue_type_script_setup_true_lang-DI75JFou.js";import{t as k}from"./Sonner.vue_vue_type_script_setup_true_lang-QiSNjKcB.js";import{_ as ga}from"./PurchaseModal.vue_vue_type_script_setup_true_lang-kIcPIAPL.js";import{B as et,u as va,M as or,_ as wt,R as lr,a as ha,P as fa,b as ma,c as ba,d as wa}from"./useTextHistory-DWbvRP3r.js";import{T as xa}from"./trending-up-sYdTfa3G.js";import{C as ya}from"./circle-alert-CdHxZXu6.js";import{ao as ir}from"./RichTextEditor-Cr6VPunt.js";import{t as ur}from"./toNumber-Yh7dP7-P.js";import{A as cr}from"./arrow-left-CLUDUaDf.js";import{B as it}from"./brain-DQjr5LD0.js";import{T as dr}from"./target-B5v8cFN5.js";import{M as pr,S as gr}from"./sun-DB76hUIl.js";import{E as xt}from"./eye-DZ_L64hs.js";import{S as vr}from"./save-DQlvth88.js";import{C as hr}from"./circle-check-big-BpD8sRJl.js";import{M as _a}from"./message-square-Cb0Datnj.js";import{P as Ca}from"./pen-tool-C8tJhlsi.js";import"./useForwardExpose-DSP-40WM.js";import"./VisuallyHidden-BAxoT5X5.js";import"./nullish-CHIgUVhi.js";import"./useNonce-Bnn6-ld9.js";import"./DropdownMenuTrigger.vue_vue_type_script_setup_true_lang-BACWwGEz.js";import"./coins-BFuKMT37.js";import"./AppLogoIcon.vue_vue_type_script_setup_true_lang-Kk3CC2gM.js";import"./plus-D7tpekVh.js";import"./chevron-right-1f__Kgh4.js";import"./triangle-alert-B9bRhR8x.js";import"./circle-check-Cus68PVN.js";import"./DialogTitle.vue_vue_type_script_setup_true_lang-DIQ68_IQ.js";import"./DialogFooter.vue_vue_type_script_setup_true_lang-Dh8LRqlQ.js";import"./sparkles-DAQjs83T.js";import"./arrow-right-Bnw27sLu.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";import"./Checkbox.vue_vue_type_script_setup_true_lang-CSbd7sO8.js";import"./ohash.D__AXeF1-C-E83dC9.js";import"./VisuallyHiddenInput-BKoJ7-jS.js";import"./RovingFocusItem-NjCnkNxF.js";import"./minus-DTxf3rGE.js";import"./check-B2qZeEYJ.js";import"./Separator.vue_vue_type_script_setup_true_lang-CYQCz-3c.js";import"./Separator-DnC6OMFP.js";import"./download-BWLv5HOw.js";import"./chevron-down-CkFng04d.js";import"./file-text-BhwtZJOe.js";import"./index-BWEDi_FC.js";import"./step-DrZ9DcYd.js";import"./type-BQA-ujsk.js";import"./list-BTeXPBBG.js";var yt=function(){return la.Date.now()},Sa="Expected a function",ka=Math.max,Ea=Math.min;function Ta(D,S,$){var F,v,d,w,g,l,C=0,b=!1,L=!1,T=!0;if(typeof D!="function")throw new TypeError(Sa);S=ur(S)||0,ia($)&&(b=!!$.leading,L="maxWait"in $,d=L?ka(ur($.maxWait)||0,S):d,T="trailing"in $?!!$.trailing:T);function p(m){var V=F,B=v;return F=v=void 0,C=m,w=D.apply(B,V),w}function q(m){return C=m,g=setTimeout(X,S),b?p(m):w}function G(m){var V=m-l,B=m-C,re=S-V;return L?Ea(re,d-B):re}function Q(m){var V=m-l,B=m-C;return l===void 0||V>=S||V<0||L&&B>=d}function X(){var m=yt();if(Q(m))return ge(m);g=setTimeout(X,G(m))}function ge(m){return g=void 0,T&&F?p(m):(F=v=void 0,w)}function ye(){g!==void 0&&clearTimeout(g),C=0,F=l=v=g=void 0}function ve(){return g===void 0?w:ge(yt())}function he(){var m=yt(),V=Q(m);if(F=arguments,v=this,l=m,V){if(g===void 0)return q(l);if(L)return clearTimeout(g),g=setTimeout(X,S),p(l)}return g===void 0&&(g=setTimeout(X,S)),w}return he.cancel=ye,he.flush=ve,he}const Aa={class:"flex items-center justify-between mb-3"},$a={class:"flex items-center gap-3"},qa={class:"p-2 rounded-lg bg-blue-500/10"},Ra={class:"text-right"},ja={class:"space-y-2"},Pa={class:"flex justify-between items-center text-xs"},Ma={class:"relative"},Da={key:0},Fa={class:"space-y-3"},Na={class:"flex-1"},Oa={class:"text-sm font-medium"},La={class:"text-xs text-muted-foreground"},Wa={class:"w-20 h-2 bg-muted rounded-full overflow-hidden ml-3"},za={key:1},Ia={class:"space-y-2"},Ha={class:"flex-1"},Ua={class:"text-sm font-medium"},Ga={class:"text-xs text-muted-foreground"},Va={key:2,class:"flex items-center justify-center gap-3 p-4 rounded-lg bg-blue-50/50 border border-blue-200/50"},Ba={key:3,class:"text-center p-4 rounded-lg bg-muted/30"},fr=mr({__name:"WritingStatistics",props:{showStatistics:{type:Boolean},currentWordCount:{},writingStats:{},qualityAnalysis:{},isAnalyzing:{type:Boolean}},setup(D){const S=D;A(()=>{if(!S.qualityAnalysis?.quality_level)return"text-muted-foreground";switch(S.qualityAnalysis.quality_level){case"Excellent":return"text-green-600";case"Good":return"text-blue-600";case"Satisfactory":return"text-yellow-600";case"Needs Improvement":return"text-orange-600";case"Poor":return"text-red-600";default:return"text-muted-foreground"}});const $=A(()=>S.qualityAnalysis?.scores?Object.entries(S.qualityAnalysis.scores).filter(([,v])=>v.max>0).filter(([,v])=>v.percentage<75).sort(([,v],[,d])=>v.percentage-d.percentage).map(([v,d])=>({category:v.replace(" & "," & "),percentage:Math.round(d.percentage),score:d.score,max:d.max,status:d.percentage<40?"poor":d.percentage<60?"needs-work":"fair"})):[]),F=A(()=>{const v=S.qualityAnalysis?.total_score||0;return v>=80?{text:"Excellent",color:"text-green-600",bgColor:"bg-green-50"}:v>=70?{text:"Satisfactory",color:"text-yellow-600",bgColor:"bg-yellow-50"}:v>=60?{text:"Needs Work",color:"text-orange-600",bgColor:"bg-orange-50"}:{text:"Poor",color:"text-red-600",bgColor:"bg-red-50"}});return(v,d)=>v.showStatistics?(y(),U(t(St),{key:0,class:"border border-border/50 bg-gradient-to-br from-card/80 to-card/60 backdrop-blur-sm shadow-lg"},{default:o(()=>[v.qualityAnalysis?(y(),U(t(Et),{key:0,class:"pb-4 border-b border-border/50"},{default:o(()=>[r("div",Aa,[r("div",$a,[r("div",qa,[s(t(et),{class:"h-4 w-4 text-blue-600"})]),r("div",null,[s(t(br),{class:"text-sm font-semibold"},{default:o(()=>[...d[0]||(d[0]=[O("Academic Quality",-1)])]),_:1}),d[1]||(d[1]=r("p",{class:"text-xs text-muted-foreground"},"AI-powered analysis",-1))])]),r("div",Ra,[r("div",{class:ie(["text-2xl font-bold",F.value.color])},[O(f(v.qualityAnalysis.total_score),1),d[2]||(d[2]=r("span",{class:"text-sm text-muted-foreground"},"/100",-1))],2),s(t(ke),{class:ie([[F.value.color,F.value.bgColor],"text-xs font-medium"]),variant:"outline"},{default:o(()=>[O(f(F.value.text),1)]),_:1},8,["class"])])]),r("div",ja,[r("div",Pa,[d[3]||(d[3]=r("span",{class:"text-muted-foreground"},"Overall Score",-1)),r("span",{class:ie(["font-medium",v.qualityAnalysis.meets_threshold?"text-green-600":"text-orange-600"])},f(v.qualityAnalysis.meets_threshold?"Meets threshold âœ“":"Below 80% threshold"),3)]),r("div",Ma,[s(t(wr),{"model-value":Math.round(v.qualityAnalysis.total_score||0),class:ie(["h-2",{"[&>[data-slot=progress-indicator]]:bg-green-500":(v.qualityAnalysis.total_score||0)>=80,"[&>[data-slot=progress-indicator]]:bg-yellow-500":(v.qualityAnalysis.total_score||0)>=70&&(v.qualityAnalysis.total_score||0)<80,"[&>[data-slot=progress-indicator]]:bg-orange-500":(v.qualityAnalysis.total_score||0)>=60&&(v.qualityAnalysis.total_score||0)<70,"[&>[data-slot=progress-indicator]]:bg-red-500":(v.qualityAnalysis.total_score||0)<60}])},null,8,["model-value","class"]),d[4]||(d[4]=r("div",{class:"absolute inset-0 flex items-center justify-center"},[r("div",{class:"w-0.5 h-4 bg-orange-400/60 rounded-full",style:{"margin-left":"80%"}})],-1))])])]),_:1})):de("",!0),s(t(kt),{class:"p-4 space-y-4"},{default:o(()=>[v.qualityAnalysis?.scores?(y(),W("div",Da,[d[5]||(d[5]=r("h4",{class:"text-xs font-semibold text-muted-foreground mb-3 flex items-center gap-2"},[r("div",{class:"w-1 h-4 bg-green-500 rounded-full"}),O(" Analysis Results ")],-1)),r("div",Fa,[(y(!0),W(_t,null,Ct(Object.entries(v.qualityAnalysis.scores).filter(([,w])=>w.max>0),([w,g])=>(y(),W("div",{key:w,class:"flex items-center justify-between p-3 rounded-lg bg-muted/30 hover:bg-muted/40 transition-colors"},[r("div",Na,[r("div",Oa,f(w),1),r("div",La,[O(f(g.score)+"/"+f(g.max)+" points ",1),r("span",{class:ie(["ml-1",{"text-red-500":g.percentage<50,"text-orange-500":g.percentage>=50&&g.percentage<75,"text-blue-500":g.percentage>=75&&g.percentage<90,"text-green-500":g.percentage>=90}])}," ("+f(Math.round(g.percentage))+"%) ",3)])]),r("div",Wa,[r("div",{class:ie(["h-full transition-all duration-500 rounded-full",{"bg-red-500":g.percentage<50,"bg-orange-500":g.percentage>=50&&g.percentage<75,"bg-blue-500":g.percentage>=75&&g.percentage<90,"bg-green-500":g.percentage>=90}]),style:Le({width:`${g.percentage}%`})},null,6)])]))),128))])])):de("",!0),$.value.length>0?(y(),W("div",za,[d[6]||(d[6]=r("h4",{class:"text-xs font-semibold text-muted-foreground mb-3 flex items-center gap-2"},[r("div",{class:"w-1 h-4 bg-orange-500 rounded-full"}),O(" Focus Areas ")],-1)),r("div",Ia,[(y(!0),W(_t,null,Ct($.value,w=>(y(),W("div",{key:w.category,class:"flex items-center gap-3 p-3 rounded-lg border border-orange-200/50 bg-orange-50/30"},[s(t(ya),{class:"h-4 w-4 text-orange-500 flex-shrink-0"}),r("div",Ha,[r("div",Ua,f(w.category),1),r("div",Ga,[O(f(w.score)+"/"+f(w.max)+" points - ",1),r("span",{class:ie({"text-red-600":w.status==="poor","text-orange-600":w.status==="needs-work","text-yellow-600":w.status==="fair"})},f(w.status==="poor"?"needs significant improvement":w.status==="needs-work"?"needs improvement":"fair, could be better"),3)])])]))),128))])])):de("",!0),v.isAnalyzing?(y(),W("div",Va,[s(t(xa),{class:"h-4 w-4 text-blue-500 animate-pulse"}),d[7]||(d[7]=r("span",{class:"text-sm text-blue-700 font-medium"},"Analyzing academic quality with AI...",-1))])):de("",!0),!v.qualityAnalysis&&!v.isAnalyzing?(y(),W("div",Ba,[s(t(et),{class:"h-8 w-8 text-muted-foreground mx-auto mb-2"}),d[8]||(d[8]=r("p",{class:"text-sm text-muted-foreground"},'Click "Analyze" to get AI-powered quality insights',-1))])):de("",!0)]),_:1})]),_:1})):de("",!0)}});function Qa(D){const{delay:S=1e4,onSave:$}=D,F=c(!1),v=c(!1),d=c(null),w=()=>{F.value=!0,d.value&&clearTimeout(d.value),d.value=setTimeout(()=>{g(!0)},S)},g=async(C=!1)=>{if(!v.value){v.value=!0;try{await $(C),F.value=!1,d.value&&(clearTimeout(d.value),d.value=null)}finally{v.value=!1}}};return{hasUnsavedChanges:F,isSaving:v,triggerAutoSave:w,save:g,clearAutoSave:()=>{d.value&&(clearTimeout(d.value),d.value=null)}}}function Ka(D){const S=c({sentences:0,paragraphs:0,readingTime:0,avgWordLength:0,uniqueWords:0,commonWords:[]}),$=A(()=>D.value?D.value.split(/\s+/).filter(d=>d.length>0).length:0),F=()=>{if(!D.value){S.value={sentences:0,paragraphs:0,readingTime:0,avgWordLength:0,uniqueWords:0,commonWords:[]};return}const d=D.value,w=d.split(/\s+/).filter(T=>T.length>0),g=d.split(/[.!?]+/).filter(T=>T.trim().length>0),l=d.split(`

`).filter(T=>T.trim().length>0),C=new Map;w.forEach(T=>{const p=T.toLowerCase().replace(/[^a-z0-9]/g,"");p&&C.set(p,(C.get(p)||0)+1)});const b=new Set(["the","a","an","and","or","but","in","on","at","to","for","of","with","by","is","was","are","were"]),L=Array.from(C.entries()).filter(([T])=>!b.has(T)).sort((T,p)=>p[1]-T[1]).slice(0,5).map(([T])=>T);S.value={sentences:g.length,paragraphs:l.length,readingTime:Math.ceil(w.length/200),avgWordLength:w.reduce((T,p)=>T+p.length,0)/w.length,uniqueWords:C.size,commonWords:L}},v=A(()=>{if(!D.value)return 0;let d=0;const w=D.value;w.includes("##")&&(d+=20),w.length>1e3&&(d+=20),w.match(/\[.*?\]/g)&&(d+=15),(w.includes("**")||w.includes("*"))&&(d+=10);const g=w.split(/[.!?]+/).filter(C=>C.trim().length>0);if(g.length>0){const C=g.reduce((b,L)=>b+L.split(/\s+/).length,0)/g.length;C>10&&C<25&&(d+=20)}return w.split(`

`).filter(C=>C.trim().length>0).length>3&&(d+=15),Math.min(d,100)});return{writingStats:S,currentWordCount:$,writingQualityScore:v,calculateWritingStats:F}}function Ja(D,S=c(3e3),$=.8){const F=i=>{if(!i)return 0;const H=i.replace(/<[^>]*>/g,"").trim().replace(/\s+/g," ");if(!H)return 0;const R=H.match(/\b\w+\b/g);return R?R.length:0},v=i=>i?i.replace(/<[^>]*>/g,"").replace(/\r\n|\r/g,`
`).trim().split(/\n\s*\n/).filter(P=>P.trim().length>0).length:0,d=i=>{if(!i)return 0;const H=i.replace(/<[^>]*>/g,"").match(/[.!?]+/g);return H?H.length:0},w=i=>Math.round(i/200*10)/10,g=A(()=>F(D.value)),l=A(()=>D.value.length),C=A(()=>D.value.replace(/\s/g,"").length),b=A(()=>v(D.value)),L=A(()=>d(D.value)),T=A(()=>w(g.value)),p=A(()=>{const i=S.value;return!i||i<=0?0:Math.min(g.value/i*100,100)}),q=A(()=>g.value>=S.value*$),G=A(()=>{const i=S.value-g.value;return Math.max(i,0)}),Q=A(()=>{const i=S.value*$-g.value;return Math.max(i,0)}),X=A(()=>({wordCount:g.value,characterCount:l.value,characterCountNoSpaces:C.value,paragraphCount:b.value,sentenceCount:L.value,readingTimeMinutes:T.value})),ge=A(()=>({current:g.value,target:S.value,percentage:p.value,isComplete:q.value,completionThreshold:$})),ye=i=>i>=1e3?`${Math.round(i/100)/10}k`:i.toString(),ve=(i=0)=>`${Math.round(p.value*Math.pow(10,i))/Math.pow(10,i)}%`,he=()=>`${g.value} / ${S.value} words (${ve()}%)`,m=()=>{if(q.value)return`âœ… Complete (${ye(g.value)} words)`;const i=Q.value;return`${ye(i)} more words to complete`},V=()=>{const i=g.value,x=S.value;return i===0?"empty":i<x*.25?"started":i<x*.75?"progressing":i<x*$?"near_complete":i<x?"complete":"exceeded"},B=()=>{const i=V();return{empty:"text-gray-500",started:"text-blue-500",progressing:"text-yellow-500",near_complete:"text-orange-500",complete:"text-green-500",exceeded:"text-emerald-600"}[i]},re=()=>{const i=V();return{empty:"bg-gray-200",started:"bg-blue-200",progressing:"bg-yellow-200",near_complete:"bg-orange-200",complete:"bg-green-200",exceeded:"bg-emerald-200"}[i]},fe=800,Ee=A(()=>g.value>=fe),M=A(()=>Math.max(fe-g.value,0)),E=A(()=>Math.min(g.value/fe*100,100));return{currentWordCount:g,characterCount:l,characterCountNoSpaces:C,paragraphCount:b,sentenceCount:L,readingTimeMinutes:T,progressPercentage:p,isComplete:q,wordsRemaining:G,wordsToComplete:Q,wordCountStats:X,wordCountProgress:ge,meetsDefenseThreshold:Ee,defenseWordsRemaining:M,defenseProgressPercentage:E,DEFENSE_THRESHOLD:fe,formatWordCount:ye,formatProgress:ve,getProgressDisplay:he,getCompletionDisplay:m,getWordCountStatus:V,getStatusColor:B,getProgressBarColor:re,countWords:F}}function Xa(D,S,$,F){const d=c(!1),w=c(0),g=c(!1),l=m=>{if(!m)return 0;const B=m.replace(/<[^>]*>/g,"").trim().replace(/\s+/g," ");if(!B)return 0;const re=B.match(/\b\w+\b/g);return re?re.length:0},C=A(()=>l($.value)),b=A(()=>C.value>=800),L=()=>`defense_generation_triggered_${D.id}_ch_${S.chapter_number}`,T=()=>{const m=L();return localStorage.getItem(m)==="true"},p=()=>{const m=L();localStorage.removeItem(m),d.value=!1,console.log(`ðŸ”„ DEFENSE WATCHER: Reset generation trigger for Chapter ${S.chapter_number}`)},q=Ta(async()=>{if(!g.value)return;const m=C.value;console.log(`ðŸ“Š DEFENSE WATCHER: Word count check - Chapter ${S.chapter_number}: ${m} words`),m<800*.8&&d.value&&(console.log("â¬‡ï¸ DEFENSE WATCHER: Content dropped below 80% of threshold, resetting trigger"),p()),w.value=m},2e3),G=()=>g.value?void 0:(g.value=!0,d.value=T(),w.value=C.value,console.log(`ðŸ‘€ DEFENSE WATCHER: Started watching Chapter ${S.chapter_number}`),console.log(`   Initial word count: ${w.value}`),console.log(`   Generation already triggered: ${d.value}`),console.log("   Threshold: 800 words"),ut($,(V,B)=>{V!==B&&q()},{immediate:!1})),Q=()=>{g.value=!1,q.cancel(),console.log(`ðŸ›‘ DEFENSE WATCHER: Stopped watching Chapter ${S.chapter_number}`)},X=async()=>{console.log(`ðŸ” DEFENSE WATCHER: Force checking Chapter ${S.chapter_number}`),await q(),q.flush()},ge=A(()=>{const m=C.value;return m>0&&m<800&&!d.value}),ye=A(()=>{const m=C.value/800*100;return Math.min(m,100)}),ve=A(()=>{const m=800-C.value;return Math.max(m,0)});return{isWatching:g,hasTriggeredGeneration:d,currentWordCount:C,lastWordCount:w,meetsThreshold:b,shouldShowProgressIndicator:ge,progressPercentage:ye,wordsRemaining:ve,startWatching:G,stopWatching:Q,forceCheck:X,resetGenerationTrigger:p,getStatusMessage:()=>{const m=C.value;return d.value?`Defense questions available (${m} words)`:m>=800?`Ready for defense questions (${m} words)`:m>0?`${800-m} more words needed for defense questions`:"Start writing to enable defense questions (800 words needed)"},countWords:l,DEFENSE_WORD_COUNT_THRESHOLD:800}}function Ya(D){const S=c(!1),$=c(null),F=c([]),v=c(null),d=A(()=>{if(!$.value?.quality_level)return"text-muted-foreground";switch($.value.quality_level){case"Excellent":return"text-green-600";case"Good":return"text-blue-600";case"Satisfactory":return"text-yellow-600";case"Needs Improvement":return"text-orange-600";case"Poor":return"text-red-600";default:return"text-muted-foreground"}}),w=A(()=>$.value?.scores?Object.entries($.value.scores).sort(([,p],[,q])=>p.percentage-q.percentage).slice(0,3).map(([p,q])=>({category:p.replace(" & "," & "),percentage:Math.round(q.percentage),score:q.score,max:q.max})):[]),g=async()=>{try{S.value=!0,v.value=null,await xe.get("/sanctum/csrf-cookie");const p=await xe.post(te("api.chapters.analysis.analyze",{chapter:D}));if(p.data.success)return $.value=p.data.analysis,p.data.analysis;throw new Error(p.data.error||"Analysis failed")}catch(p){return v.value=p.response?.data?.error||p.message||"Analysis failed",console.error("Chapter analysis failed:",p),null}finally{S.value=!1}};return{isAnalyzing:S,latestAnalysis:$,analysisHistory:F,error:v,qualityLevelColor:d,topImprovementAreas:w,analyzeChapter:g,getLatestAnalysis:async()=>{try{await xe.get("/sanctum/csrf-cookie");const p=await xe.get(te("api.chapters.analysis.latest",{chapter:D}));return p.data.success?($.value=p.data.analysis,p.data.analysis):($.value=null,null)}catch(p){return p.response?.status!==404&&(v.value=p.response?.data?.error||p.message||"Failed to get analysis",console.error("Failed to get latest analysis:",p)),null}},getAnalysisHistory:async()=>{try{await xe.get("/sanctum/csrf-cookie");const p=await xe.get(te("api.chapters.analysis.history",{chapter:D}));if(p.data.success)return F.value=p.data.analyses,p.data.analyses;throw new Error(p.data.error||"Failed to get history")}catch(p){return v.value=p.response?.data?.error||p.message||"Failed to get analysis history",console.error("Failed to get analysis history:",p),[]}},autoAnalyze:async(p,q=500)=>{p>=q&&await g()},getScoreColor:(p,q)=>{const G=p/q*100;return G>=80?"text-green-600":G>=70?"text-blue-600":G>=60?"text-yellow-600":G>=40?"text-orange-600":"text-red-600"},getProgressVariant:p=>p>=80?"success":p>=60?"default":"destructive"}}const Za={key:2,class:"flex h-screen flex-col overflow-hidden bg-zinc-50 dark:bg-zinc-950 font-sans selection:bg-primary/20"},es={class:"relative z-20 flex flex-shrink-0 items-center justify-between border-b border-border/40 bg-background/60 p-4 backdrop-blur-xl supports-[backdrop-filter]:bg-background/40 transition-all duration-300"},ts={class:"flex items-center gap-5"},rs={class:"flex flex-col"},as={class:"flex items-center gap-3 text-xs text-muted-foreground"},ss={class:"flex items-center gap-1.5"},ns={class:"flex items-center gap-4"},os={class:"flex items-center p-1 rounded-full border border-border/40 bg-background/50 backdrop-blur-sm shadow-sm"},ls={class:"flex items-center gap-2"},is={class:"relative z-20 h-[2px] w-full bg-border/20"},us={key:0,class:"mx-3 my-2"},cs={class:"relative overflow-hidden rounded-xl border border-blue-200 bg-gradient-to-br from-blue-50 to-purple-50 p-3 shadow-sm dark:border-blue-800 dark:from-blue-950/30 dark:to-purple-950/30"},ds={class:"relative z-10 mb-2 flex items-center justify-between"},ps={class:"flex items-center gap-2"},gs={class:"relative"},vs={class:"flex h-6 w-6 items-center justify-center rounded-full bg-gradient-to-br from-blue-500 to-purple-600"},hs={class:"text-xs text-blue-700 dark:text-blue-300"},fs={class:"relative z-10 mb-2"},ms={class:"mb-1 flex items-center justify-between"},bs={class:"text-xs text-blue-600 dark:text-blue-400"},ws={class:"relative h-2 overflow-hidden rounded-full bg-blue-100 dark:bg-blue-900/50"},xs={class:"relative z-10 flex items-center gap-2"},ys={class:"flex-shrink-0"},_s={key:0,class:"h-2 w-2 animate-bounce rounded-full bg-blue-500"},Cs={key:1,class:"flex gap-0.5"},Ss={key:2,class:"h-2 w-2 animate-spin rounded-full border-2 border-blue-500 border-t-transparent"},ks={key:3,class:"h-2 w-2 rounded-full bg-green-500"},Es={key:4,class:"h-2 w-2 rounded-full bg-red-500"},Ts={class:"flex-1 text-xs text-blue-800 dark:text-blue-200"},As={class:"relative z-10 flex flex-1 overflow-hidden"},$s={key:0,class:"w-[320px] flex-shrink-0 border-r border-border/50 bg-background/80 backdrop-blur-xl shadow-xl z-20"},qs={class:"h-full overflow-y-auto custom-scrollbar"},Rs={class:"p-4"},js={class:"mb-3"},Ps={class:"text-xs text-muted-foreground"},Ms={class:"flex min-h-0 flex-1 flex-col bg-transparent relative"},Ds={class:"flex-1 overflow-hidden relative"},Fs={class:"absolute inset-0 overflow-y-auto custom-scrollbar flex flex-col items-center py-8 px-4 sm:px-8"},Ns={class:"flex items-center justify-between"},Os={class:"space-y-1"},Ls={class:"flex items-center gap-2"},Ws={class:"flex items-center justify-between px-6 py-2 border-b border-border/30 bg-muted/5"},zs={class:"flex items-center gap-2"},Is={class:"space-y-1 relative z-10"},Hs={class:"text-sm font-medium text-foreground"},Us={class:"text-[10px] text-muted-foreground line-clamp-2 leading-relaxed"},Gs={class:"flex-1 relative bg-background"},Vs={class:"px-12 py-10 min-h-[500px]"},Bs={class:"sticky bottom-0 z-10 border-t border-border/30 bg-background/80 backdrop-blur-md p-4 flex items-center justify-between"},Qs={class:"text-xs text-muted-foreground"},Ks={class:"flex items-center gap-2"},Js={key:0,class:"w-72 flex-shrink-0 border-l border-border/40 bg-background/40 backdrop-blur-md"},Xs={class:"h-full overflow-y-auto custom-scrollbar"},Ys={class:"space-y-6 p-4"},Zs={class:"min-h-screen bg-gradient-to-br from-background via-background to-muted/20"},en={class:"w-full px-4 py-6 transition-all duration-300"},tn={class:"mb-6 flex items-center justify-between"},rn={class:"flex items-center gap-4"},an={class:"text-sm text-muted-foreground"},sn={class:"flex items-center gap-2"},nn={class:"hidden items-center gap-2 lg:flex"},on={class:"mb-6"},ln={class:"mb-2 flex items-center justify-between"},un={class:"text-sm text-muted-foreground"},cn={key:0,class:"mb-6"},dn={class:"relative overflow-hidden rounded-xl border border-blue-200 bg-gradient-to-br from-blue-50 to-purple-50 p-4 shadow-sm dark:border-blue-800 dark:from-blue-950/30 dark:to-purple-950/30"},pn={class:"relative z-10 mb-3 flex items-center justify-between"},gn={class:"flex items-center gap-2"},vn={class:"relative"},hn={class:"flex h-8 w-8 items-center justify-center rounded-full bg-gradient-to-br from-blue-500 to-purple-600"},fn={class:"text-xs text-blue-700 dark:text-blue-300"},mn={class:"relative z-10 mb-3"},bn={class:"mb-1 flex items-center justify-between"},wn={class:"text-xs text-blue-600 dark:text-blue-400"},xn={class:"relative h-2 overflow-hidden rounded-full bg-blue-100 dark:bg-blue-900/50"},yn={class:"relative z-10 flex items-center gap-2"},_n={class:"flex-shrink-0"},Cn={key:0,class:"h-3 w-3 animate-bounce rounded-full bg-blue-500"},Sn={key:1,class:"flex gap-1"},kn={key:2,class:"h-3 w-3 animate-spin rounded-full border-2 border-blue-500 border-t-transparent"},En={key:3,class:"h-3 w-3 rounded-full bg-green-500"},Tn={key:4,class:"h-3 w-3 rounded-full bg-red-500"},An={class:"flex-1 text-xs text-blue-800 dark:text-blue-200"},$n={key:0,class:"relative z-10 mt-3 border-t border-blue-200 pt-3 dark:border-blue-800"},qn={class:"flex items-center justify-between text-xs"},Rn={class:"flex items-center gap-1"},jn={class:"flex gap-0.5"},Pn={class:"ml-1 text-blue-600 dark:text-blue-400"},Mn={class:"grid grid-cols-1 gap-6 lg:grid-cols-12 transition-all duration-300"},Dn={class:"hidden lg:block lg:col-span-2 transition-all duration-300"},Fn={class:"h-[calc(100vh-320px)] overflow-y-auto space-y-6 custom-scrollbar pr-1"},Nn={class:"flex items-center justify-between"},On={class:"flex items-center gap-2"},Ln={class:"flex items-center gap-2"},Wn={class:"space-y-2"},zn={class:"space-y-2"},In={class:"flex items-center justify-between"},Hn={class:"flex items-center gap-2"},Un={class:"flex flex-col gap-2 pt-4 sm:flex-row"},Gn={class:"hidden sm:inline"},Vn={class:"sm:hidden"},Bn={class:"hidden sm:inline"},Qn={class:"sm:hidden"},Kn={class:"hidden lg:block lg:col-span-3 transition-all duration-300"},Jn={class:"h-[calc(100vh-40px)] overflow-y-auto space-y-4 custom-scrollbar px-1"},Xn=1e3,nl=mr({__name:"ChapterEditor",props:{project:{},chapter:{},allChapters:{},facultyChapters:{},mode:{}},setup(D){const S=qe(()=>Re(()=>import("./AISidebar-CePhAH1T.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46]))),$=qe(()=>Re(()=>import("./ChapterNavigation-C1XsoFkL.js"),__vite__mapDeps([47,48,3,1,2,20,7,8,21,22,14,49,18,13,15,16,33,50,51,52,53,39]))),F=qe(()=>Re(()=>import("./MobileNavOverlay-Bea-z4_Y.js"),__vite__mapDeps([54,1,2,55,3,0,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,48,49,50,51,52,53,56,57,58,59,60,61,62]))),v=qe(()=>Re(()=>import("./ChatModeLayout-CUSAszCq.js"),__vite__mapDeps([63,64,1,2,18,3,8,4,11,7,12,20,21,23,24,25,26,27,14,28,29,19,30,31,32,33,34,35,65,66,67,68,69,70,9,10,13,15,16,59,36,71,72,55,73,60,39,38,74,75,50,76,77,43,78,57,53,42,41,45,40,51,79,80,81,82]))),d=qe(()=>Re(()=>import("./CitationVerificationLayout-DX8HYl8d.js"),__vite__mapDeps([83,18,3,1,2,8,4,5,11,7,12,20,21,25,65,23,24,26,27,14,28,29,19,30,31,32,33,34,35,66,67,68,69,70,9,10,13,15,16,59,36,71,72,73,51]))),w=qe(()=>Re(()=>import("./DefensePreparationPanel-BXBG8Gcc.js"),__vite__mapDeps([84,56,1,2,55,3,18,8,4,5,6,7,11,12,20,21,9,10,36,57,58,37,44,59,14,60]))),g=qe(()=>Re(()=>import("./DataCollectionPanel-F72P3mCb.js"),__vite__mapDeps([85,61,1,2,13,3,14,8,7,15,16]))),l=D,C=c(l.chapter.title||""),b=c(l.chapter.content||""),L=c(!0),T=c(!1),p=c(!1);c(!1);const q=c(!1);c("write");const G=c("");c(0);const Q=c(!1),X=c(!1),ge=c(!0),ye=()=>{try{return localStorage.getItem(`chatMode_${l.project.id}_${l.chapter.chapter_number}`)==="true"}catch(a){return console.warn("Failed to load chat mode from localStorage:",a),!1}},ve=a=>{try{localStorage.setItem(`chatMode_${l.project.id}_${l.chapter.chapter_number}`,String(a))}catch(e){console.warn("Failed to save chat mode to localStorage:",e)}},he=c(!1),m=c(!1),V=c(!1),B=c(!1),re=c(!1),fe=c(!0),Ee=c(!0),M=c(!1),E=c(""),i=c(0),x=c(""),H=c(0),R=c(0),P=c(null),N=c(""),tt=c(0),ct=c(""),Tt=c([]),We=c(!1),Te=c(!1),{balance:xr,showPurchaseModal:At,requiredWordsForModal:yr,actionDescriptionForModal:_r,checkAndPrompt:Cr,closePurchaseModal:Sr,estimates:Se}=ca(),je=(a,e)=>Cr(Math.max(1,Math.round(a)),e),ze=c(!1),Pe=c(""),Me=c(""),kr=c(0),Ae=c(null),Er=c(0),Tr=c(null),Ar=c([]),$r=c([]),qr=c(null);c(null),c(null);const Rr=c(),$t=c(),jr=c(),qt=c();c(null),c(null);const Y=c(!1),{hasUnsavedChanges:Pr,isSaving:De,triggerAutoSave:Ie,save:me,clearAutoSave:Mr}=Qa({delay:1e4,onSave:Mt});let Rt=0;const Dr=()=>{const a=Date.now();a-Rt>Xn&&(Rt=a,k.success("Saved",{duration:2e3}))},{contentHistory:Fr,historyIndex:Nr,addToHistory:Or,undo:Lr,redo:Wr}=va(l.chapter.content||""),{writingStats:dt,writingQualityScore:_e,calculateWritingStats:rt}=Ka(b),{isAnalyzing:jt,latestAnalysis:K,getLatestAnalysis:zr}=Ya(l.chapter.id),ae=A(()=>{if(l.facultyChapters&&l.facultyChapters.length>0){const e=l.facultyChapters.find(n=>n.number===l.chapter.chapter_number);if(e?.word_count)return e.word_count}if(l.project?.outlines&&l.project.outlines.length>0){const e=l.project.outlines.find(n=>n.chapter_number===l.chapter.chapter_number);if(e?.target_word_count)return e.target_word_count}const a=l.project.type==="undergraduate"?2500:3500;return l.chapter.chapter_number===1||l.chapter.chapter_number===5?Math.round(a*.8):a}),{currentWordCount:J,progressPercentage:Ir,meetsDefenseThreshold:Hr,defenseWordsRemaining:Ur,defenseProgressPercentage:Gr,DEFENSE_THRESHOLD:at,countWords:Pt}=Ja(b,ae),He=Ir,Ue=A(()=>{const a=C.value?.trim(),e=b.value?.trim();return a&&a.length>0&&e&&e.length>50}),be=A(()=>l.project),we=A(()=>l.chapter),$e=A(()=>l.allChapters);async function Mt(a=!1){try{const e=await fetch(te("chapters.save",{project:l.project.id}),{method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json","X-Requested-With":"XMLHttpRequest","X-CSRF-TOKEN":document.querySelector('meta[name="csrf-token"]')?.getAttribute("content")||""},body:JSON.stringify({project_id:l.project.id,chapter_number:l.chapter.chapter_number,title:C.value,content:b.value,auto_save:a,statistics:dt.value,quality_score:_e.value})});console.log("Response status:",e.status,e.statusText),console.log("Response headers:",e.headers);const n=await e.text();console.log("Raw response:",n);let u;try{u=JSON.parse(n)}catch(h){throw console.error("JSON parse error:",h),console.error("Response was:",n),new Error(`Server returned non-JSON response: ${e.status} ${e.statusText}`)}e.ok}catch(e){throw a||k.error("âŒ Save Failed",{description:"Please try again or check your connection."}),e}}const Dt=()=>{const a=Lr();a!==null&&(b.value=a,Ie())},Ft=()=>{const a=Wr();a!==null&&(b.value=a,Ie())},Ge=a=>{Pr.value&&confirm("You have unsaved changes. Save before switching chapters?")&&me();const e=l.allChapters.find(h=>h.chapter_number===a),u=e?.content&&e.content.trim()!==""?"chapters.edit":"chapters.write";Ye.visit(te(u,{project:l.project.slug,chapter:a}),{only:["chapter","mode","allChapters"],preserveState:!0,preserveScroll:!1})},pt=async()=>{const a=Se.chapter(ae.value||0);if(!je(a,"generate the next chapter with AI"))return;await me();const e=l.allChapters.map(h=>h.chapter_number).sort((h,_)=>h-_),n=e.indexOf(l.chapter.chapter_number);let u;if(n===-1||n===e.length-1)u=Math.max(...e)+1;else{const h=e[n+1];h===l.chapter.chapter_number+1?u=h:u=l.chapter.chapter_number+1}console.log("ðŸ“ Generating next chapter:",{currentChapter:l.chapter.chapter_number,existingChapters:e,nextChapterNumber:u});try{const h=te("chapters.write",{project:l.project.slug,chapter:u});console.log("ðŸ”— Generated URL for next chapter:",h);const _=new URL(h,window.location.origin);_.searchParams.set("ai_generate","true"),_.searchParams.set("generation_type","progressive"),console.log("ðŸš€ Navigating to:",_.toString()),Ye.visit(_.toString())}catch(h){console.error("âŒ Error generating next chapter:",h),k.error("Navigation Error",{description:"Failed to navigate to next chapter. Please try again."})}},gt=(a,e)=>{a==="section"&&e?.section?Vr(e.section):a==="rephrase"&&e?.selectedText?Br(e.selectedText,e.style||"Academic Formal"):a==="expand"&&e?.selectedText?Qr(e.selectedText):vt(a)},Vr=async a=>{M.value=!0,N.value="",R.value=0,i.value=5,x.value="Papers",E.value="Checking for verified sources...",H.value=600,ct.value=b.value||l.chapter.content||"",Y.value=!0;try{i.value=50,x.value="Papers",E.value="Using existing verified sources...",await new Promise(n=>setTimeout(n,500)),x.value="Section",E.value=`Generating ${a} section with verified sources...`,i.value=51;const e=te("chapters.stream",{project:l.project.slug,chapter:l.chapter.chapter_number});P.value=new EventSource(`${e}?generation_type=section&section_type=${a}`),P.value.onmessage=n=>{const u=JSON.parse(n.data);switch(u.type){case"start":x.value="Generating Section",i.value=52,E.value=`Starting ${a} section generation...`;break;case"content":N.value+=u.content,R.value=u.word_count||Pt(N.value);const h=Date.now();if(h-tt.value>150){const j=N.value;b.value=ct.value+`

`+j,tt.value=h;const Z=Math.min(R.value/H.value*43,43);i.value=Math.max(52,52+Z),E.value=`Generating ${a} section... (${R.value} / ${H.value} words)`,rt(),Ht()}break;case"complete":i.value=100,x.value="Complete",E.value=`âœ“ Generated ${a} section (${R.value} words)`;const _=N.value;b.value=ct.value+`

`+_,me(!0),k.success("âœ… Section Generated Successfully",{description:`Added ${a} section with ${R.value} words and verified citations.`,duration:5e3}),M.value=!1,P.value?.close();break;case"error":throw new Error(u.message||"Section generation failed");case"heartbeat":i.value<95&&(i.value+=.5);break}},P.value.onerror=()=>{M.value=!1,x.value="Error",E.value="âŒ Section generation failed",k.error("âŒ Generation Failed",{description:"Unable to generate section. Please check your connection and try again."}),P.value?.close()}}catch(e){console.error("Section generation failed:",e),M.value=!1,x.value="Error",E.value="âŒ Section generation error",k.error("âŒ Generation Failed",{description:"Section generation encountered an error."})}},Br=async(a,e)=>{const n=a.split(/\s+/).length,u=Math.max(n,Se.rephrase());if(!je(u,`rephrase about ${n} words`))return;console.log("ðŸš€ ChapterEditor - Starting rephrase generation:",{selectedTextLength:a.length,selectedTextPreview:a.substring(0,100)+(a.length>100?"...":""),style:e,timestamp:new Date().toISOString()}),M.value=!0,N.value="",R.value=0,i.value=10,x.value="Rephrasing",E.value="Preparing to rephrase selected text...",H.value=Math.max(n,50);const h=Ve.value||st.value,_=h?.getSelectionRange();console.log("ðŸ“ ChapterEditor - Editor and selection info:",{hasActiveEditor:!!h,selectionRange:_,selectedWordCount:n,estimatedWords:H.value});const j={originalText:a,range:_,wordCount:n,style:e,startTime:Date.now()};console.log("ðŸ’¾ ChapterEditor - Stored rephrase context:",j),Y.value=!0;try{i.value=20,E.value=`Rephrasing ${n} words in ${e} style...`;const ce=`${te("chapters.stream",{project:l.project.slug,chapter:l.chapter.chapter_number})}?generation_type=rephrase&selected_text=${encodeURIComponent(a)}&style=${encodeURIComponent(e)}`;console.log("ðŸŒ ChapterEditor - Creating EventSource:",{url:ce,encodedTextLength:encodeURIComponent(a).length}),P.value=new EventSource(ce),P.value.onmessage=I=>{const ee=JSON.parse(I.data);switch(console.log("ðŸ“¨ ChapterEditor - EventSource message received:",{type:ee.type,hasContent:!!ee.content,contentLength:ee.content?.length||0,wordCount:ee.word_count}),ee.type){case"start":console.log("â–¶ï¸ ChapterEditor - Rephrase generation started"),x.value="Rephrasing Text",i.value=30,E.value=`Rephrasing text in ${e} style...`;break;case"content":N.value+=ee.content,R.value=ee.word_count||Pt(N.value),console.log("ðŸ“ ChapterEditor - Content chunk received:",{chunkLength:ee.content?.length||0,totalBufferLength:N.value.length,totalWords:R.value});const pe=Math.min(R.value/H.value*60,60);i.value=Math.max(30,30+pe),E.value=`Rephrasing... (${R.value} words)`;break;case"complete":if(console.log("ðŸ ChapterEditor - Rephrase generation complete"),i.value=100,x.value="Complete",E.value=`âœ“ Text rephrased successfully (${R.value} words)`,console.log("ðŸ”„ ChapterEditor - Starting text replacement:",{hasRange:!!j.range,hasContent:!!N.value.trim(),range:j.range,newContentLength:N.value.trim().length,newContentPreview:N.value.trim().substring(0,100)+"..."}),j.range&&N.value.trim()){console.log("ðŸŽ¯ ChapterEditor - Attempting text replacement with activeEditor:",{editorType:h===Ve.value?"fullscreen":"normal",hasActiveEditor:!!h});const Ce=h?.replaceSelection(N.value.trim(),j.range);console.log("ðŸ“Š ChapterEditor - Text replacement result:",{success:Ce}),Ce?(console.log("âœ… ChapterEditor - Text replacement successful, updating chapter content"),setTimeout(()=>{const Xe=h?.getHTML()||b.value;console.log("ðŸ“„ ChapterEditor - Updated chapter content length:",Xe.length),b.value=Xe},100)):(console.warn("âŒ ChapterEditor - Failed to replace selected text, falling back to manual update"),k.warning("Please manually replace the selected text",{description:"The rephrased text is ready but couldn't be automatically replaced."}))}else console.error("âŒ ChapterEditor - Cannot replace text:",{missingRange:!j.range,missingContent:!N.value.trim()});me(!0),k.success("âœ… Text Rephrased Successfully",{description:`Rephrased ${n} words in ${e} style.`,duration:5e3}),Ze(R.value||n,`Rephrase (${e})`,"chapter",l.chapter.id).catch(Ce=>console.error("Failed to record word usage (rephrase):",Ce)),M.value=!1,P.value?.close();break;case"error":throw new Error(ee.message||"Text rephrasing failed");case"heartbeat":i.value<95&&(i.value+=.5);break}},P.value.onerror=()=>{M.value=!1,x.value="Error",E.value="âŒ Text rephrasing failed",k.error("âŒ Rephrasing Failed",{description:"Unable to rephrase text. Please check your connection and try again."}),P.value?.close()}}catch(Z){console.error("Text rephrasing failed:",Z),M.value=!1,x.value="Error",E.value="âŒ Rephrasing error",k.error("âŒ Rephrasing Failed",{description:"Text rephrasing encountered an error."})}},Qr=async a=>{const e=a.split(/\s+/).length,n=Math.max(e*2,Se.expand());if(!je(n,`expand about ${e} words`))return;console.log("ðŸ“ˆ ChapterEditor - Starting expand generation:",{selectedTextLength:a.length,selectedTextPreview:a.substring(0,100)+(a.length>100?"...":""),timestamp:new Date().toISOString()}),M.value=!0,N.value="",R.value=0,i.value=10,x.value="Expanding",E.value="Preparing to expand selected text...",H.value=Math.max(e*2,100);const u=Ve.value||st.value,h=u?.getSelectionRange();console.log("ðŸ“ ChapterEditor - Editor and selection info for expand:",{hasActiveEditor:!!u,selectionRange:h,selectedWordCount:e,estimatedWords:H.value});const _={originalText:a,range:h,wordCount:e,startTime:Date.now()};console.log("ðŸ’¾ ChapterEditor - Stored expand context:",_);try{const Z=`${te("chapters.stream",{project:l.project.slug,chapter:l.chapter.chapter_number})}?generation_type=expand&selected_text=${encodeURIComponent(a)}`;console.log("ðŸŒ ChapterEditor - Creating EventSource for expand:",{url:Z,encodedTextLength:encodeURIComponent(a).length}),P.value=new EventSource(Z),P.value.onmessage=ce=>{const I=JSON.parse(ce.data);switch(console.log("ðŸ“¨ ChapterEditor - EventSource message received:",{type:I.type,hasContent:!!I.content,contentLength:I.content?.length||0,wordCount:I.word_count}),I.type){case"start":console.log("â–¶ï¸ ChapterEditor - Expand generation started"),x.value="Expanding Text",i.value=20,E.value="Starting text expansion...";break;case"content":N.value+=I.content,R.value=I.word_count||N.value.split(/\s+/).filter(pe=>pe.length>0).length;const ee=Math.min(R.value/H.value*90,90);i.value=Math.max(ee,25),E.value=`Expanding text... ${R.value}/${H.value} words`,console.log("ðŸ“ ChapterEditor - Expand content received:",{chunkLength:I.content?.length||0,totalWords:R.value,progress:i.value});break;case"complete":if(console.log("âœ… ChapterEditor - Expand generation complete"),x.value="Complete",E.value="âœ… Text expansion completed",i.value=100,_.range&&N.value.trim()){console.log("ðŸŽ¯ ChapterEditor - Attempting text replacement for expand");const pe=u?.replaceSelection(N.value.trim(),_.range);console.log("ðŸ“Š ChapterEditor - Expand text replacement result:",{success:pe}),pe?(console.log("âœ… ChapterEditor - Expand text replacement successful"),setTimeout(()=>{const Ce=u?.getHTML()||b.value;console.log("ðŸ“„ ChapterEditor - Updated chapter content length after expand:",Ce.length),b.value=Ce},100)):(console.warn("âŒ ChapterEditor - Failed to replace expanded text"),k.warning("Please manually replace the selected text",{description:"The expanded text is ready but couldn't be automatically replaced."}))}else console.error("âŒ ChapterEditor - Cannot replace expanded text:",{missingRange:!_.range,missingContent:!N.value.trim()});me(!0),k.success("âœ… Text Expanded Successfully",{description:`Expanded ${_.wordCount} words into ${R.value} words`}),Ze(R.value||_.wordCount*2,"Expand text","chapter",l.chapter.id).catch(pe=>console.error("Failed to record word usage (expand):",pe)),M.value=!1,P.value?.close();break;case"error":console.error("âŒ ChapterEditor - Expand generation error:",I.message),M.value=!1,x.value="Error",E.value="âŒ Text expansion failed",k.error("âŒ Expansion Failed",{description:I.message||"Text expansion encountered an error."}),P.value?.close();break}},P.value.onerror=()=>{console.error("âŒ ChapterEditor - Expand stream error occurred"),M.value=!1,x.value="Error",E.value="âŒ Text expansion failed",k.error("âŒ Expansion Failed",{description:"Unable to expand text. Please check your connection and try again."}),P.value?.close()}}catch(j){console.error("Text expansion failed:",j),M.value=!1,x.value="Error",E.value="âŒ Expansion error",k.error("âŒ Expansion Failed",{description:"Text expansion encountered an error."})}},Kr=async()=>{ze.value=!0,Me.value="Starting",Pe.value="Initializing source collection...",i.value=5;try{const a=document.querySelector('meta[name="csrf-token"]')?.content;if(!a)throw new Error("CSRF token not found - please refresh the page");const e=await fetch(te("api.projects.paper-collection.start",{project:l.project.slug}),{method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json","X-CSRF-TOKEN":a,"X-Requested-With":"XMLHttpRequest"},credentials:"include"});if(!e.ok){const n=await e.text();if(console.error("API Error:",e.status,n),e.status===409)try{const u=JSON.parse(n);throw new Error(u.message||"Source collection is already in progress")}catch{throw new Error("Source collection is already in progress for this project")}throw new Error(`Failed to start source collection: ${e.status}`)}return await Jr()}catch(a){return console.error("Paper collection failed:",a),Me.value="Error",Pe.value="âŒ Source collection failed",ze.value=!1,!1}},Jr=async()=>new Promise(a=>{let e=0;const n=120,u=async()=>{try{const _=await(await fetch(te("api.projects.paper-collection.status",{project:l.project.slug}))).json();if(_.success&&_.data){qr.value=_.data;const j=_.data.status,Z=_.data.papers_count||_.data.count||0,ce=_.data.message,I=_.data.percentage||0,ee=_.data.current_source,pe=_.data.sources_completed||[],Ce=_.data.papers_preview||[];if(kr.value=Z,Er.value=I,Tr.value=ee,Ar.value=pe,$r.value=Ce,j==="completed"){Me.value="Complete",Pe.value=`âœ“ Collected ${Z} verified sources from ${pe.length} databases`,i.value=50,ze.value=!1,Ae.value&&clearInterval(Ae.value),a(!0);return}else if(j==="collecting_papers"||j==="initializing"||j==="processing"||j==="storing"){let Xe="";ee&&(Xe={semantic_scholar:"Semantic Scholar",openalex:"OpenAlex",crossref:"CrossRef",pubmed:"PubMed"}[ee]||ee),Me.value=Xe||"Collecting Sources",Pe.value=ce||"Collecting sources from academic databases...",i.value=Math.min(5+I*.4,45)}else if(j==="collection_failed"){Me.value="Error",Pe.value=ce||"âŒ Source collection failed",ze.value=!1,Ae.value&&clearInterval(Ae.value),a(!1);return}}e++,e>=n&&(Me.value="Timeout",Pe.value="â±ï¸ Source collection timed out",ze.value=!1,Ae.value&&clearInterval(Ae.value),a(!1))}catch(h){console.error("Error checking paper collection status:",h),e++}};u(),Ae.value=setInterval(u,5e3)}),vt=async a=>{const e=Se.chapter(ae.value||0);if(!je(e,"generate this chapter with AI"))return;if(M.value=!0,N.value="",R.value=0,i.value=5,x.value="Papers",E.value="Checking for verified sources...",H.value=ae.value,Y.value=!0,!await Kr()){k.error("Paper Collection Failed",{description:"Unable to collect verified papers. Please try again."}),M.value=!1,Y.value=!1;return}x.value="Initializing",E.value="Starting AI generation with verified sources...",i.value=51;const u=setInterval(()=>{i.value<52&&M.value?i.value+=.2:clearInterval(u)},100),h=te("chapters.stream",{project:l.project.slug,chapter:l.chapter.chapter_number});P.value=new EventSource(`${h}?generation_type=${a}`),P.value.onmessage=_=>{const j=JSON.parse(_.data);switch(j.type){case"start":x.value="Connecting",i.value=52,E.value="Connecting to AI service...";break;case"content":x.value="Generating",N.value+=j.content,R.value=j.word_count||N.value.split(/\s+/).filter(I=>I.length>0).length;const Z=Date.now();if(Z-tt.value>150){b.value=N.value,tt.value=Z;const I=Math.min(R.value/H.value*43,43);i.value=Math.max(52,52+I),E.value=`Generating chapter content... (${R.value} / ${H.value} words)`,rt(),Ht()}break;case"heartbeat":i.value<95&&(i.value+=.5);break;case"complete":x.value="Complete",i.value=100,M.value=!1,b.value=N.value;const ce=j.final_word_count||R.value;E.value=`âœ“ Generated ${ce} words successfully`,Ze(ce,`Chapter generation (${l.chapter.chapter_number})`,"chapter",l.chapter.id).catch(I=>console.error("Failed to record word usage (chapter generation):",I)),setTimeout(()=>{Ie()},500),P.value?.close(),P.value=null;break;case"error":x.value="Error",i.value=50,M.value=!1,j.code==="OFFLINE_MODE"?(E.value="ðŸ“¡ AI services offline",k.error("AI Services Offline",{description:"Please check your internet connection and try again."})):(E.value="âŒ Generation failed",k.error("Generation Error",{description:j.message||"Please try again."})),P.value?.close(),P.value=null;break}},P.value.onerror=()=>{x.value="Error",i.value=50,M.value=!1,E.value="âŒ Connection error",k.error("Connection Error",{description:"Please check your internet connection and try again."}),P.value?.close(),P.value=null}},ht=async()=>{if(!G.value)return;const a=Se.suggestion();if(je(a,"get AI suggestions")){We.value=!0;try{const n=await(await fetch(te("chapters.suggestions",{project:l.project.slug,chapter:l.chapter.chapter_number}),{method:"POST",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":document.querySelector('meta[name="csrf-token"]')?.getAttribute("content")||""},body:JSON.stringify({selected_text:G.value,context:b.value})})).json();Tt.value=n.suggestions||[],Tt.value.length&&Ze(Se.suggestion(),"AI suggestions","chapter",l.chapter.id).catch(u=>console.error("Failed to record word usage (suggestions):",u))}catch{k.error("Error getting suggestions",{description:"Please try again."})}finally{We.value=!1}}},ft=()=>{Te.value=!0,k.success("Citation Manager opened!",{description:"Review and verify your citations in the panel below."})},Nt=a=>{try{const e=Ve.value?.editor||st.value?.editor;if(!e){k.error("Editor not found");return}const{from:n}=e.state.selection;e.chain().focus().insertContentAt(n,` ${a} `).run(),k.success("Citation inserted successfully")}catch(e){console.error("Failed to insert citation:",e),k.error("Failed to insert citation")}},st=c(null),Ve=c(null),Xr=async()=>{try{const a=document.documentElement;a.requestFullscreen?await a.requestFullscreen():a.webkitRequestFullscreen?await a.webkitRequestFullscreen():a.msRequestFullscreen&&await a.msRequestFullscreen()}catch(a){console.error("Error entering fullscreen:",a),k.error("Fullscreen Error",{description:"Unable to enter fullscreen mode"})}},Yr=async()=>{try{document.exitFullscreen?await document.exitFullscreen():document.webkitExitFullscreen?await document.webkitExitFullscreen():document.msExitFullscreen&&await document.msExitFullscreen()}catch(a){console.error("Error exiting fullscreen:",a),k.error("Fullscreen Error",{description:"Unable to exit fullscreen mode"})}},Ot=async()=>{p.value?await Yr():await Xr()},Fe=()=>{const a=document.fullscreenElement||document.webkitFullscreenElement||document.msFullscreenElement;p.value=!!a},Lt=()=>{T.value=!T.value,document.documentElement.classList.toggle("dark",T.value),localStorage.setItem("darkMode",T.value.toString())},Zr=()=>{Q.value=!Q.value,Q.value&&(X.value=!1),ve(Q.value)},ea=()=>{Q.value=!1,ve(!1)},ta=()=>{X.value=!X.value,X.value&&(Q.value=!1,ve(!1))},ra=()=>{X.value=!1},Wt=()=>{Y.value=!Y.value},zt=()=>{Ye.visit(te("projects.analysis",{project:l.project.slug}))},aa=()=>{Or(b.value),Ie(),rt()},It=a=>{(a.ctrlKey||a.metaKey)&&a.key==="s"&&(a.preventDefault(),me(),Dr()),(a.ctrlKey||a.metaKey)&&!a.shiftKey&&a.key==="z"&&(a.preventDefault(),Dt()),(a.ctrlKey||a.metaKey)&&a.shiftKey&&a.key==="z"&&(a.preventDefault(),Ft()),a.key==="F11"&&(a.preventDefault(),Ot())};nt(()=>{const a=()=>{V.value=window.innerWidth<1024};a(),window.addEventListener("resize",a);const e=localStorage.getItem("darkMode")==="true";T.value=e,document.documentElement.classList.toggle("dark",e),Q.value=ye(),document.addEventListener("keydown",Ut),document.addEventListener("keydown",It),document.addEventListener("fullscreenchange",Fe),document.addEventListener("webkitfullscreenchange",Fe),document.addEventListener("msfullscreenchange",Fe),rt(),sa()});const Ht=()=>{ot(()=>{if(M.value){const a=Y.value?p.value?qt.value:jr.value:p.value?$t.value:Rr.value;if(a)try{const e=a;if(!e)return;const n=e.$el||e;if(!n)return;let u=n.querySelector("[data-radix-scroll-area-viewport]");if(u||(u=n.querySelector("[data-viewport]")),u||(u=n.querySelector('[role="region"]')),u||(u=n.querySelector('div[style*="overflow"]')),u||(u=n.querySelector("[data-scrollable]")),!u){const h=n.querySelectorAll("div");for(const _ of h){const j=window.getComputedStyle(_);if(j.overflow==="auto"||j.overflow==="scroll"||j.overflowY==="auto"||j.overflowY==="scroll"||_.scrollHeight>_.clientHeight){u=_;break}}}if(!u){const h=n.querySelector('.ProseMirror, [contenteditable="true"]');h&&(u=h.closest('div[style*="overflow"]')||h.closest("[data-radix-scroll-area-viewport]")||h.parentElement)}if(u){const h=u.scrollHeight-u.clientHeight;u.scrollTop=h,requestAnimationFrame(()=>{u.scrollTop=u.scrollHeight,u.scrollTo&&u.scrollTo({top:u.scrollHeight,behavior:"instant"})})}else console.warn("Could not find scrollable viewport in ScrollArea",{scrollAreaEl:n,children:n.children,mode:Y.value?"preview":"editor",fullscreen:p.value})}catch(e){console.warn("Auto-scroll failed:",e)}else{const e=document.querySelector(".ProseMirror");e&&e.scrollIntoView({behavior:"instant",block:"end"})}}})},sa=()=>{const a=new URLSearchParams(window.location.search),e=a.get("ai_generate")==="true",n=a.get("generation_type");e&&n&&setTimeout(()=>{if(n==="progressive"){vt("progressive");const u=new URL(window.location.href);u.searchParams.delete("ai_generate"),u.searchParams.delete("generation_type"),window.history.replaceState({},"",u.toString()),k.success("ðŸš€ AI Generation Started",{description:`Generating ${l.chapter.title} with AI assistance...`})}else if(n==="single"){vt("progressive");const u=new URL(window.location.href);u.searchParams.delete("ai_generate"),u.searchParams.delete("generation_type"),window.history.replaceState({},"",u.toString()),k.success("ðŸš€ AI Generation Started",{description:`Generating ${l.chapter.title} with AI assistance...`})}},1e3)},Ut=a=>{if((a.ctrlKey||a.metaKey)&&!["INPUT","TEXTAREA","SELECT"].includes(a.target?.tagName))switch(a.key){case"ArrowLeft":a.preventDefault();const e=l.chapter.chapter_number-1;l.allChapters.find(_=>_.chapter_number===e)&&Ge(e);break;case"ArrowRight":a.preventDefault();const u=l.chapter.chapter_number+1;l.allChapters.find(_=>_.chapter_number===u)&&Ge(u);break}};nt(()=>{const a=e=>{const n=u=>{const{scrollTop:h,scrollHeight:_,clientHeight:j}=e,Z=u.deltaY,ce=h<=0,I=h+j>=_;Z<0&&ce||Z>0&&I||u.stopPropagation()};return e.addEventListener("wheel",n,{passive:!0}),()=>e.removeEventListener("wheel",n)};ot(()=>{const e=document.querySelectorAll('[class*="overflow-y-auto"]'),n=[];e.forEach(u=>{if(u instanceof HTMLElement){const h=a(u);n.push(h)}}),window.__scrollChainCleanup=n})}),ua(()=>{Mr(),P.value&&P.value.close(),document.removeEventListener("keydown",It),document.removeEventListener("keydown",Ut);const a=window.__scrollChainCleanup;a&&Array.isArray(a)&&(a.forEach(e=>e()),delete window.__scrollChainCleanup),document.removeEventListener("fullscreenchange",Fe),document.removeEventListener("webkitfullscreenchange",Fe),document.removeEventListener("msfullscreenchange",Fe)}),ut(b,aa),ut(C,Ie),ut(()=>l.chapter,async a=>{C.value=a.title||"",b.value=a.content||"",ue.value=[],oa(),Bt(),await Je(),await ot(()=>{Qt()})},{immediate:!1});const ue=c([]),Be=c(!1),Qe=c(!1),Ke=c(null),le=A(()=>l.chapter),Gt=async a=>{ge.value=a,a&&na()&&await Je()},na=()=>{if(!ue.value.length||!Ke.value)return!0;const a=new Date(Date.now()-360*60*1e3);return Ke.value<a},Je=async(a=!1)=>{if(!Be.value){Be.value=!0;try{console.log("Loading defense questions with params:",{project_id:l.project.id,chapter_number:le.value?.chapter_number,limit:5,force_refresh:a});const e=await xe.get(`/api/projects/${l.project.id}/defense/questions`,{params:{chapter_number:le.value?.chapter_number||null,limit:5,force_refresh:a?1:0},headers:{Accept:"application/json","X-Requested-With":"XMLHttpRequest"}});if(console.log("Defense questions loaded:",e.data),console.log("Questions array:",e.data.questions),console.log("Questions count:",e.data.questions?e.data.questions.length:0),ue.value=e.data.questions||[],Ke.value=new Date,e.data.questions&&e.data.questions.length>0){const n=`defense_questions_${l.project.id}_chapter_${le.value?.chapter_number}`;localStorage.setItem(n,JSON.stringify({questions:e.data.questions,chapter_number:le.value?.chapter_number,loaded_at:new Date().toISOString()}))}else a||(console.log("No existing questions found for this chapter"),console.log(`Current word count: ${J.value}/${at}`),console.log('User must click "Generate Questions" button to create defense questions'))}catch(e){if(console.error("Failed to load defense questions:",e),e.response)if(console.error("Response status:",e.response.status),console.error("Response data:",e.response.data),e.response.status===422){console.error("Validation errors:",e.response.data.errors);const n=Object.values(e.response.data.errors||{})[0];n&&Array.isArray(n)?k.error(`Validation Error: ${n[0]}`):k.error("Invalid request parameters. Please refresh the page.")}else e.response.status===500?k.error("Server error. Please try again later."):k.error("Failed to load defense questions");else e.request?(console.error("No response received:",e.request),k.error("Network error. Please check your connection.")):(console.error("Error setting up request:",e.message),k.error("An unexpected error occurred"));ue.value=[]}finally{Be.value=!1}}},Vt=async()=>{if(Qe.value)return;const a=Se.defense();if(je(a,"generate defense questions")){Qe.value=!0;try{const e=await xe.post(`/api/projects/${l.project.id}/defense/questions/generate`,{chapter_number:le.value.chapter_number},{headers:{"X-CSRF-TOKEN":document.querySelector('meta[name="csrf-token"]')?.getAttribute("content"),Accept:"application/json","Content-Type":"application/json"}});if(e.data&&e.data.questions){ue.value=e.data.questions,Ke.value=new Date;const n=`defense_questions_${l.project.id}_chapter_${le.value?.chapter_number}`;localStorage.setItem(n,JSON.stringify({questions:e.data.questions,chapter_number:le.value?.chapter_number,loaded_at:new Date().toISOString()})),k.success(`Generated ${e.data.questions.length} new questions`),Ze(Se.defense(),"Defense questions","chapter",l.chapter.id).catch(u=>console.error("Failed to record word usage (defense):",u))}}catch(e){console.error("Failed to generate defense questions:",e),k.error("Failed to generate defense questions")}finally{Qe.value=!1}}},{hasTriggeredGeneration:mt,startWatching:Bt,stopWatching:oa,forceCheck:Qt,getStatusMessage:Kt}=Xa(l.project,l.chapter,b),Jt=Hr,Xt=A(()=>{const a=J.value;return a>0&&a<at&&!mt.value}),Yt=Gr,Zt=Ur,er=async(a,e)=>{try{await xe.patch(`/api/projects/${l.project.id}/defense/questions/${a}`,{user_marked_helpful:e},{headers:{"X-CSRF-TOKEN":document.querySelector('meta[name="csrf-token"]')?.getAttribute("content"),Accept:"application/json","Content-Type":"application/json"}});const n=ue.value.find(u=>u.id===a);n&&(n.user_marked_helpful=e),k.success(e?"Question marked as helpful":"Removed helpful mark")}catch(n){console.error("Failed to mark question:",n),k.error("Failed to update question")}},tr=async a=>{try{await xe.delete(`/api/projects/${l.project.id}/defense/questions/${a}`,{headers:{"X-CSRF-TOKEN":document.querySelector('meta[name="csrf-token"]')?.getAttribute("content"),Accept:"application/json"}}),ue.value=ue.value.filter(e=>e.id!==a),localStorage.setItem(`defense_questions_${l.project.id}`,JSON.stringify({questions:ue.value,loaded_at:new Date().toISOString()})),k.success("Question hidden")}catch(e){console.error("Failed to hide question:",e),k.error("Failed to hide question")}};return nt(async()=>{const a=`defense_questions_${l.project.id}_chapter_${le.value?.chapter_number}`,e=localStorage.getItem(a);let n=!0;if(e){const u=JSON.parse(e),h=new Date(u.loaded_at),_=new Date(Date.now()-360*60*1e3);h>_&&u.chapter_number===le.value?.chapter_number&&(ue.value=u.questions,Ke.value=h,n=!1)}n&&await Je(),Bt(),await ot(()=>{Qt()})}),nt(async()=>{await zr()}),(a,e)=>(y(),U(t(pa),null,{default:o(()=>[Q.value?(y(),U(t(v),{key:0,project:be.value,chapter:we.value,"chapter-title":C.value,"chapter-content":b.value,"current-word-count":t(J),"target-word-count":ae.value,"progress-percentage":t(He),"writing-quality-score":t(_e),"is-valid":Ue.value,"is-saving":t(De),"show-preview":L.value,"is-generating":M.value,"generation-progress":E.value,"history-index":t(Nr),"content-history-length":t(Fr).length,"selected-text":G.value,"onUpdate:chapterTitle":e[0]||(e[0]=n=>C.value=n),"onUpdate:chapterContent":e[1]||(e[1]=n=>b.value=n),"onUpdate:selectedText":e[2]||(e[2]=n=>G.value=n),"onUpdate:showPreview":e[3]||(e[3]=n=>L.value=n),onSave:e[4]||(e[4]=n=>Mt(n)),onUndo:Dt,onRedo:Ft,onExitChatMode:ea},null,8,["project","chapter","chapter-title","chapter-content","current-word-count","target-word-count","progress-percentage","writing-quality-score","is-valid","is-saving","show-preview","is-generating","generation-progress","history-index","content-history-length","selected-text"])):X.value?(y(),U(t(d),{key:1,project:be.value,chapter:we.value,"chapter-title":C.value,"chapter-content":b.value,"current-word-count":t(J),"target-word-count":ae.value,"progress-percentage":t(He),onExitCitationMode:ra},null,8,["project","chapter","chapter-title","chapter-content","current-word-count","target-word-count","progress-percentage"])):p.value?(y(),W("div",Za,[e[56]||(e[56]=r("div",{class:"absolute inset-0 z-0 overflow-hidden pointer-events-none"},[r("div",{class:"absolute top-[-20%] left-[-10%] w-[50%] h-[50%] rounded-full bg-blue-500/5 blur-[120px]"}),r("div",{class:"absolute bottom-[-20%] right-[-10%] w-[50%] h-[50%] rounded-full bg-purple-500/5 blur-[120px]"})],-1)),r("div",es,[r("div",ts,[s(t(se),null,{default:o(()=>[s(t(ne),{asChild:""},{default:o(()=>[s(t(z),{onClick:e[5]||(e[5]=n=>t(Ye).visit(t(te)("projects.show",l.project.slug))),variant:"ghost",size:"icon",class:"h-10 w-10 rounded-full hover:bg-primary/10 hover:text-primary transition-all duration-300"},{default:o(()=>[s(t(cr),{class:"h-5 w-5"})]),_:1})]),_:1}),s(t(oe),null,{default:o(()=>[...e[34]||(e[34]=[r("p",null,"Back to Project",-1)])]),_:1})]),_:1}),r("div",rs,[s(nr,{as:"h1",class:"text-lg font-bold tracking-tight text-foreground/90 font-display",content:l.project.title},null,8,["content"]),r("div",as,[s(t(ke),{variant:"outline",class:"h-5 px-2 rounded-full border-primary/20 bg-primary/5 text-primary font-medium"},{default:o(()=>[O(" Chapter "+f(l.chapter.chapter_number),1)]),_:1}),r("span",ss,[e[35]||(e[35]=r("span",{class:"h-1.5 w-1.5 rounded-full bg-green-500 animate-pulse"},null,-1)),O(" "+f(t(J))+" words ",1)])])])]),r("div",ns,[r("div",os,[s(t(z),{onClick:e[6]||(e[6]=n=>fe.value=!fe.value),variant:fe.value?"secondary":"ghost",size:"sm",class:ie(["h-8 px-4 rounded-full text-xs font-medium transition-all duration-300",fe.value?"bg-primary/10 text-primary hover:bg-primary/15":"hover:bg-muted"])},{default:o(()=>[s(t(or),{class:"mr-2 h-3.5 w-3.5"}),e[36]||(e[36]=O(" Outline ",-1))]),_:1},8,["variant","class"]),e[38]||(e[38]=r("div",{class:"w-px h-4 bg-border/50 mx-1"},null,-1)),s(t(z),{onClick:e[7]||(e[7]=n=>Ee.value=!Ee.value),variant:Ee.value?"secondary":"ghost",size:"sm",class:ie(["h-8 px-4 rounded-full text-xs font-medium transition-all duration-300",Ee.value?"bg-primary/10 text-primary hover:bg-primary/15":"hover:bg-muted"])},{default:o(()=>[s(t(it),{class:"mr-2 h-3.5 w-3.5"}),e[37]||(e[37]=O(" Assistant ",-1))]),_:1},8,["variant","class"])]),r("div",ls,[s(t(se),null,{default:o(()=>[s(t(ne),{asChild:""},{default:o(()=>[s(t(z),{onClick:e[8]||(e[8]=n=>q.value=!q.value),variant:q.value?"secondary":"ghost",size:"icon",class:"h-9 w-9 rounded-full transition-all hover:bg-muted"},{default:o(()=>[s(t(dr),{class:"h-4.5 w-4.5 text-muted-foreground"})]),_:1},8,["variant"])]),_:1}),s(t(oe),null,{default:o(()=>[r("p",null,f(q.value?"Hide":"Show")+" Statistics",1)]),_:1})]),_:1}),s(t(se),null,{default:o(()=>[s(t(ne),{asChild:""},{default:o(()=>[s(t(z),{onClick:Lt,variant:"ghost",size:"icon",class:"h-9 w-9 rounded-full transition-all hover:bg-muted"},{default:o(()=>[T.value?(y(),U(t(gr),{key:1,class:"h-4.5 w-4.5 text-muted-foreground"})):(y(),U(t(pr),{key:0,class:"h-4.5 w-4.5 text-muted-foreground"}))]),_:1})]),_:1}),s(t(oe),null,{default:o(()=>[...e[39]||(e[39]=[r("p",null,"Toggle Theme",-1)])]),_:1})]),_:1}),s(wt,{project:be.value,"current-chapter":we.value,"all-chapters":$e.value,size:"icon",variant:"ghost",class:"h-9 w-9 rounded-full hover:bg-muted"},null,8,["project","current-chapter","all-chapters"])])])]),r("div",is,[r("div",{class:"absolute top-0 left-0 h-full bg-gradient-to-r from-blue-500 via-purple-500 to-pink-500 transition-all duration-700 ease-out shadow-[0_0_10px_rgba(59,130,246,0.5)]",style:Le({width:`${Math.min(t(He),100)}%`})},null,4)]),M.value?(y(),W("div",us,[r("div",cs,[e[45]||(e[45]=r("div",{class:"absolute inset-0 -skew-x-12 animate-pulse bg-gradient-to-r from-transparent via-white/10 to-transparent"},null,-1)),r("div",ds,[r("div",ps,[r("div",gs,[r("div",vs,[s(t(it),{class:"h-3 w-3 text-white"})]),e[40]||(e[40]=r("div",{class:"absolute inset-0 h-6 w-6 animate-ping rounded-full bg-gradient-to-br from-blue-500 to-purple-600 opacity-20"},null,-1))]),r("div",null,[e[41]||(e[41]=r("h4",{class:"text-xs font-semibold text-blue-900 dark:text-blue-100"},"AI Generator",-1)),r("p",hs,f(x.value),1)])]),s(t(ke),{variant:"outline",class:"border-blue-300 text-xs text-blue-700 dark:border-blue-700 dark:text-blue-300"},{default:o(()=>[O(f(Math.round(i.value))+"% ",1)]),_:1})]),r("div",fs,[r("div",ms,[e[42]||(e[42]=r("span",{class:"text-xs text-blue-800 dark:text-blue-200"},"Generation Progress",-1)),r("span",bs,f(R.value)+" / "+f(H.value)+" words",1)]),r("div",ws,[r("div",{class:"absolute top-0 left-0 h-full rounded-full bg-gradient-to-r from-blue-500 to-purple-500 transition-all duration-500 ease-out",style:Le({width:`${i.value}%`})},[...e[43]||(e[43]=[r("div",{class:"absolute inset-0 animate-pulse bg-gradient-to-r from-transparent via-white/30 to-transparent"},null,-1)])],4),r("div",{class:"absolute top-0 left-0 h-full rounded-full bg-gradient-to-r from-blue-400 to-purple-400 opacity-50 blur-sm transition-all duration-500",style:Le({width:`${i.value}%`})},null,4)])]),r("div",xs,[r("div",ys,[x.value==="Initializing"?(y(),W("div",_s)):x.value==="Connecting"?(y(),W("div",Cs,[...e[44]||(e[44]=[r("div",{class:"h-2 w-0.5 animate-pulse rounded-full bg-blue-500"},null,-1),r("div",{class:"h-2 w-0.5 animate-pulse rounded-full bg-purple-500",style:{"animation-delay":"0.2s"}},null,-1),r("div",{class:"h-2 w-0.5 animate-pulse rounded-full bg-blue-500",style:{"animation-delay":"0.4s"}},null,-1)])])):x.value==="Generating"?(y(),W("div",Ss)):x.value==="Complete"?(y(),W("div",ks)):(y(),W("div",Es))]),r("p",Ts,f(E.value),1)])])])):de("",!0),q.value?(y(),U(fr,{key:1,"show-statistics":q.value,"current-word-count":t(J),"writing-stats":t(dt),"quality-analysis":t(K),"is-analyzing":t(jt),class:"relative z-20 mx-4 mt-2 rounded-lg border border-border/40 bg-background/60 backdrop-blur-md"},null,8,["show-statistics","current-word-count","writing-stats","quality-analysis","is-analyzing"])):de("",!0),r("div",As,[s(rr,{"enter-active-class":"transition-all duration-300 ease-in-out","enter-from-class":"-ml-72 opacity-0","enter-to-class":"ml-0 opacity-100","leave-active-class":"transition-all duration-300 ease-in-out","leave-from-class":"ml-0 opacity-100","leave-to-class":"-ml-72 opacity-0"},{default:o(()=>[fe.value?(y(),W("div",$s,[r("div",qs,[r("div",Rs,[r("div",js,[e[46]||(e[46]=r("h2",{class:"text-sm font-semibold text-foreground mb-1"},"Table of Contents",-1)),r("p",Ps,f($e.value.length)+" Chapters ",1)]),(y(),U(lt,null,{fallback:o(()=>[...e[47]||(e[47]=[r("div",{class:"flex items-center justify-center p-8"},[r("div",{class:"h-6 w-6 animate-spin rounded-full border-2 border-primary border-t-transparent"})],-1)])]),default:o(()=>[s(t($),{"all-chapters":$e.value,"current-chapter":we.value,project:be.value,outlines:a.project.outlines||[],"faculty-chapters":a.facultyChapters||[],"current-word-count":t(J),"target-word-count":ae.value,"writing-quality-score":t(_e),"chapter-content-length":b.value.length,onGoToChapter:Ge,onGenerateNextChapter:pt},null,8,["all-chapters","current-chapter","project","outlines","faculty-chapters","current-word-count","target-word-count","writing-quality-score","chapter-content-length"])]),_:1}))])])])):de("",!0)]),_:1}),r("div",Ms,[r("div",Ds,[r("div",Fs,[s(t(St),{class:"w-full max-w-[850px] min-h-[calc(100vh-180px)] flex flex-col bg-background shadow-xl shadow-black/5 ring-1 ring-black/5 dark:ring-white/10 rounded-xl overflow-hidden transition-all duration-300"},{default:o(()=>[s(t(Et),{class:"flex-shrink-0 border-b border-border/30 px-8 py-6 bg-background/50 backdrop-blur-sm sticky top-0 z-10"},{default:o(()=>[r("div",Ns,[r("div",Os,[s(t(bt),{for:"chapter-title-fs",class:"text-xs font-medium text-muted-foreground uppercase tracking-wider"},{default:o(()=>[...e[48]||(e[48]=[O("Chapter Title",-1)])]),_:1}),s(t(ar),{id:"chapter-title-fs",modelValue:C.value,"onUpdate:modelValue":e[9]||(e[9]=n=>C.value=n),placeholder:"Enter chapter title...",class:"h-auto p-0 border-0 bg-transparent text-2xl font-bold placeholder:text-muted-foreground/40 focus-visible:ring-0 px-0"},null,8,["modelValue"])]),r("div",Ls,[s(t(ke),{variant:a.chapter.status==="approved"?"default":"secondary",class:"rounded-full px-3"},{default:o(()=>[O(f(a.chapter.status.replace("_"," ")),1)]),_:1},8,["variant"]),s(t(ke),{variant:"outline",class:ie(["rounded-full px-3 transition-colors",{"text-green-600 border-green-200 bg-green-50 dark:bg-green-900/20 dark:border-green-800":(t(K)?.total_score||0)>=80,"text-yellow-600 border-yellow-200 bg-yellow-50 dark:bg-yellow-900/20 dark:border-yellow-800":(t(K)?.total_score||0)>=70&&(t(K)?.total_score||0)<80,"text-orange-600 border-orange-200 bg-orange-50 dark:bg-orange-900/20 dark:border-orange-800":(t(K)?.total_score||0)>=60&&(t(K)?.total_score||0)<70,"text-red-600 border-red-200 bg-red-50 dark:bg-red-900/20 dark:border-red-800":(t(K)?.total_score||0)<60}])},{default:o(()=>[O(f(t(K)?.total_score?Math.round(t(K).total_score):t(_e))+"% Quality ",1)]),_:1},8,["class"])])])]),_:1}),s(t(kt),{class:"flex min-h-0 flex-1 flex-col p-0"},{default:o(()=>[r("div",Ws,[r("div",zs,[s(t(z),{onClick:Wt,variant:Y.value?"default":"ghost",size:"sm",class:"h-7 text-xs rounded-full"},{default:o(()=>[s(t(xt),{class:"mr-1.5 h-3.5 w-3.5"}),O(" "+f(Y.value?"Edit":"Preview"),1)]),_:1},8,["variant"])]),r("div",Is,[r("div",Hs,f(a.aiChapterAnalysis?.section.name||a.getSectionInfo(a.nextSection).name),1),r("div",Us,f(a.aiChapterAnalysis?.section.description||a.getSectionInfo(a.nextSection).description),1)])]),r("div",Gs,[Ne(s(ir,{modelValue:b.value,"onUpdate:modelValue":e[10]||(e[10]=n=>b.value=n),placeholder:"Start writing your chapter...","min-height":"500px",class:"min-h-[500px] px-8 py-6",ref_key:"richTextEditor",ref:st,"show-toolbar":!0,"onUpdate:selectedText":e[11]||(e[11]=n=>{G.value=n})},null,8,["modelValue"]),[[Oe,!Y.value]]),Ne(r("div",Vs,[s(lr,{content:b.value,"show-font-controls":!1,class:"prose-lg mx-auto",style:{"font-family":"'Times New Roman', serif","line-height":"1.8"}},null,8,["content"])],512),[[Oe,Y.value]])])]),_:1}),r("div",Bs,[r("div",Qs,f(t(De)?"Saving...":"All changes saved"),1),r("div",Ks,[s(t(z),{onClick:e[12]||(e[12]=n=>t(me)(!1)),disabled:!Ue.value||t(De),size:"sm",variant:"ghost",class:"h-8 rounded-full"},{default:o(()=>[s(t(vr),{class:"mr-2 h-3.5 w-3.5"}),e[49]||(e[49]=O(" Save Draft ",-1))]),_:1},8,["disabled"]),s(t(z),{onClick:zt,variant:"outline",size:"sm",class:"h-8 rounded-full"},{default:o(()=>[s(t(et),{class:"mr-2 h-3.5 w-3.5"}),e[50]||(e[50]=O(" Run Bulk Analysis ",-1))]),_:1}),s(t(z),{onClick:e[13]||(e[13]=n=>t(me)(!1)),disabled:!Ue.value||t(J)<ae.value*.8,size:"sm",class:"h-8 rounded-full bg-gradient-to-r from-primary to-primary/90 shadow-sm hover:shadow-md transition-all"},{default:o(()=>[s(t(hr),{class:"mr-2 h-3.5 w-3.5"}),e[51]||(e[51]=O(" Complete ",-1))]),_:1},8,["disabled"])])])]),_:1}),e[52]||(e[52]=r("div",{class:"h-12"},null,-1))])])]),s(rr,{"enter-active-class":"transition-all duration-300 ease-in-out","enter-from-class":"-mr-72 opacity-0","enter-to-class":"mr-0 opacity-100","leave-active-class":"transition-all duration-300 ease-in-out","leave-from-class":"mr-0 opacity-100","leave-to-class":"-mr-72 opacity-0"},{default:o(()=>[Ee.value?(y(),W("div",Js,[r("div",Xs,[r("div",Ys,[(y(),U(lt,null,{fallback:o(()=>[...e[53]||(e[53]=[r("div",{class:"flex items-center justify-center p-8"},[r("div",{class:"h-6 w-6 animate-spin rounded-full border-2 border-primary border-t-transparent"})],-1)])]),default:o(()=>[s(t(S),{project:be.value,chapter:we.value,"is-generating":M.value,"selected-text":G.value,"is-loading-suggestions":We.value,"show-citation-helper":Te.value,"chapter-content":b.value,"current-word-count":t(J),"target-word-count":ae.value,onStartStreamingGeneration:gt,onGetAiSuggestions:ht,"onUpdate:showCitationHelper":e[14]||(e[14]=n=>Te.value=n),onInsertCitation:Nt,onCheckCitations:ft},null,8,["project","chapter","is-generating","selected-text","is-loading-suggestions","show-citation-helper","chapter-content","current-word-count","target-word-count"])]),_:1})),(y(),U(lt,null,{fallback:o(()=>[...e[54]||(e[54]=[r("div",{class:"flex items-center justify-center p-4"},[r("div",{class:"h-4 w-4 animate-spin rounded-full border-2 border-muted border-t-transparent"})],-1)])]),default:o(()=>[s(t(w),{"show-defense-prep":ge.value,questions:ue.value,"is-loading":Be.value,"is-generating":Qe.value,"chapter-context":{chapter_number:le.value.chapter_number,chapter_title:le.value.title,word_count:t(J)},"defense-watcher":{meetsThreshold:t(Jt),shouldShowProgress:Xt.value,progressPercentage:t(Yt),wordsRemaining:t(Zt),hasTriggeredGeneration:t(mt),threshold:t(at),statusMessage:t(Kt)()},"onUpdate:showDefensePrep":Gt,onGenerateMore:Vt,onRefresh:e[15]||(e[15]=()=>Je(!0)),onMarkHelpful:er,onHideQuestion:tr},null,8,["show-defense-prep","questions","is-loading","is-generating","chapter-context","defense-watcher"])]),_:1})),(y(),U(lt,null,{fallback:o(()=>[...e[55]||(e[55]=[r("div",{class:"flex items-center justify-center p-4"},[r("div",{class:"h-4 w-4 animate-spin rounded-full border-2 border-muted border-t-transparent"})],-1)])]),default:o(()=>[s(t(g),{"chapter-id":le.value.id,content:b.value},null,8,["chapter-id","content"])]),_:1}))])])])):de("",!0)]),_:1})])])):(y(),U(da,{key:3,class:"h-screen overflow-hidden"},{default:o(()=>[r("div",Zs,[r("div",en,[r("div",tn,[r("div",rn,[s(t(se),null,{default:o(()=>[s(t(ne),{asChild:""},{default:o(()=>[s(t(z),{onClick:e[16]||(e[16]=n=>t(Ye).visit(t(te)("projects.show",l.project.slug))),variant:"ghost",size:"icon",class:"hidden sm:flex"},{default:o(()=>[s(t(cr),{class:"h-4 w-4"})]),_:1})]),_:1}),s(t(oe),null,{default:o(()=>[...e[57]||(e[57]=[r("p",null,"Back to Project",-1)])]),_:1})]),_:1}),r("div",null,[s(nr,{as:"h1",class:"text-xl font-bold sm:text-2xl",content:l.project.title},null,8,["content"]),r("p",an," Chapter "+f(l.chapter.chapter_number)+" â€¢ "+f(t(J))+" / "+f(ae.value)+" words ",1)])]),r("div",sn,[s(t(se),null,{default:o(()=>[s(t(ne),{asChild:""},{default:o(()=>[s(t(z),{onClick:e[17]||(e[17]=n=>he.value=!0),variant:"outline",size:"icon",class:"lg:hidden"},{default:o(()=>[s(t(or),{class:"h-4 w-4"})]),_:1})]),_:1}),s(t(oe),null,{default:o(()=>[...e[58]||(e[58]=[r("p",null,"Chapter Navigation",-1)])]),_:1})]),_:1}),s(t(se),null,{default:o(()=>[s(t(ne),{asChild:""},{default:o(()=>[s(t(z),{onClick:e[18]||(e[18]=n=>m.value=!0),variant:"outline",size:"icon",class:"lg:hidden"},{default:o(()=>[s(t(it),{class:"h-4 w-4"})]),_:1})]),_:1}),s(t(oe),null,{default:o(()=>[...e[59]||(e[59]=[r("p",null,"AI Tools & Defense Prep",-1)])]),_:1})]),_:1}),r("div",nn,[s(t(se),null,{default:o(()=>[s(t(ne),{asChild:""},{default:o(()=>[s(t(z),{onClick:Zr,variant:Q.value?"default":"outline",size:"sm"},{default:o(()=>[s(t(_a),{class:"h-4 w-4"})]),_:1},8,["variant"])]),_:1}),s(t(oe),null,{default:o(()=>[r("p",null,f(Q.value?"Exit":"Open")+" AI Chat Assistant",1)]),_:1})]),_:1}),s(t(se),null,{default:o(()=>[s(t(ne),{asChild:""},{default:o(()=>[s(t(z),{onClick:ta,variant:X.value?"default":"outline",size:"sm"},{default:o(()=>[s(t(et),{class:"h-4 w-4"})]),_:1},8,["variant"])]),_:1}),s(t(oe),null,{default:o(()=>[r("p",null,f(X.value?"Exit":"Open")+" Citation Verification",1)]),_:1})]),_:1}),s(t(se),null,{default:o(()=>[s(t(ne),{asChild:""},{default:o(()=>[s(t(z),{onClick:e[19]||(e[19]=n=>q.value=!q.value),variant:q.value?"default":"outline",size:"sm"},{default:o(()=>[s(t(dr),{class:"h-4 w-4"})]),_:1},8,["variant"])]),_:1}),s(t(oe),null,{default:o(()=>[r("p",null,f(q.value?"Hide":"Show")+" Writing Statistics",1)]),_:1})]),_:1}),s(t(se),null,{default:o(()=>[s(t(ne),{asChild:""},{default:o(()=>[s(t(z),{onClick:Lt,variant:"outline",size:"sm"},{default:o(()=>[T.value?(y(),U(t(gr),{key:1,class:"h-4 w-4"})):(y(),U(t(pr),{key:0,class:"h-4 w-4"}))]),_:1})]),_:1}),s(t(oe),null,{default:o(()=>[r("p",null,"Switch to "+f(T.value?"Light":"Dark")+" Mode",1)]),_:1})]),_:1}),s(t(se),null,{default:o(()=>[s(t(ne),{asChild:""},{default:o(()=>[s(t(z),{onClick:Ot,variant:p.value?"default":"outline",size:"sm"},{default:o(()=>[s(t(ha),{class:"h-4 w-4"})]),_:1},8,["variant"])]),_:1}),s(t(oe),null,{default:o(()=>[r("p",null,f(p.value?"Exit":"Enter")+" Fullscreen Mode (F11)",1)]),_:1})]),_:1}),s(wt,{project:be.value,"current-chapter":we.value,"all-chapters":$e.value,size:"sm"},null,8,["project","current-chapter","all-chapters"])])])]),r("div",on,[r("div",ln,[e[60]||(e[60]=r("span",{class:"text-sm font-medium"},"Writing Progress",-1)),r("span",un,f(t(J))+" / "+f(ae.value)+" words ("+f(Math.round(t(He)))+"%)",1)]),s(t(wr),{"model-value":Number(t(He)),class:"h-2"},null,8,["model-value"])]),M.value?(y(),W("div",cn,[r("div",dn,[e[67]||(e[67]=r("div",{class:"absolute inset-0 -skew-x-12 animate-pulse bg-gradient-to-r from-transparent via-white/10 to-transparent"},null,-1)),r("div",pn,[r("div",gn,[r("div",vn,[r("div",hn,[s(t(it),{class:"h-4 w-4 text-white"})]),e[61]||(e[61]=r("div",{class:"absolute inset-0 h-8 w-8 animate-ping rounded-full bg-gradient-to-br from-blue-500 to-purple-600 opacity-20"},null,-1))]),r("div",null,[e[62]||(e[62]=r("h4",{class:"text-sm font-semibold text-blue-900 dark:text-blue-100"},"AI Chapter Generator ",-1)),r("p",fn,f(x.value),1)])]),s(t(ke),{variant:"outline",class:"border-blue-300 text-xs text-blue-700 dark:border-blue-700 dark:text-blue-300"},{default:o(()=>[O(f(Math.round(i.value))+"% ",1)]),_:1})]),r("div",mn,[r("div",bn,[e[63]||(e[63]=r("span",{class:"text-xs text-blue-800 dark:text-blue-200"},"Generation Progress",-1)),r("span",wn,f(R.value)+" / "+f(H.value)+" words",1)]),r("div",xn,[r("div",{class:"absolute top-0 left-0 h-full rounded-full bg-gradient-to-r from-blue-500 to-purple-500 transition-all duration-500 ease-out",style:Le({width:`${i.value}%`})},[...e[64]||(e[64]=[r("div",{class:"absolute inset-0 animate-pulse bg-gradient-to-r from-transparent via-white/30 to-transparent"},null,-1)])],4),r("div",{class:"absolute top-0 left-0 h-full rounded-full bg-gradient-to-r from-blue-400 to-purple-400 opacity-50 blur-sm transition-all duration-500",style:Le({width:`${i.value}%`})},null,4)])]),r("div",yn,[r("div",_n,[x.value==="Initializing"?(y(),W("div",Cn)):x.value==="Connecting"?(y(),W("div",Sn,[...e[65]||(e[65]=[r("div",{class:"h-3 w-1 animate-pulse rounded-full bg-blue-500"},null,-1),r("div",{class:"h-3 w-1 animate-pulse rounded-full bg-purple-500",style:{"animation-delay":"0.2s"}},null,-1),r("div",{class:"h-3 w-1 animate-pulse rounded-full bg-blue-500",style:{"animation-delay":"0.4s"}},null,-1)])])):x.value==="Generating"?(y(),W("div",kn)):x.value==="Complete"?(y(),W("div",En)):(y(),W("div",Tn))]),r("p",An,f(E.value),1)]),x.value==="Generating"&&R.value>50?(y(),W("div",$n,[r("div",qn,[e[66]||(e[66]=r("span",{class:"text-blue-700 dark:text-blue-300"},"Writing Quality",-1)),r("div",Rn,[r("div",jn,[(y(),W(_t,null,Ct(5,n=>r("div",{key:n,class:ie(["h-2 w-2 rounded-full",n<=Math.ceil(t(_e)/20)?"bg-yellow-400":"bg-blue-200 dark:bg-blue-800"])},null,2)),64))]),r("span",Pn,f(t(_e))+"%",1)])])])):de("",!0)])])):de("",!0),s(fr,{"show-statistics":q.value,"current-word-count":t(J),"writing-stats":t(dt),"quality-analysis":t(K),"is-analyzing":t(jt)},null,8,["show-statistics","current-word-count","writing-stats","quality-analysis","is-analyzing"]),r("div",Mn,[Ne(r("div",Dn,[r("div",Fn,[s(t($),{"all-chapters":$e.value,"current-chapter":we.value,project:be.value,outlines:a.project.outlines||[],"faculty-chapters":a.facultyChapters||[],"current-word-count":t(J),"target-word-count":ae.value,"writing-quality-score":t(_e),"chapter-content-length":b.value.length,onGoToChapter:Ge,onGenerateNextChapter:pt},null,8,["all-chapters","current-chapter","project","outlines","faculty-chapters","current-word-count","target-word-count","writing-quality-score","chapter-content-length"])])],512),[[Oe,!B.value]]),r("div",{class:ie(["transition-all duration-300",B.value&&re.value?"lg:col-span-12":B.value?"lg:col-span-9":re.value?"lg:col-span-10":"lg:col-span-7"])},[s(t(St),{class:"border-[0.5px] border-border/50 transition-all duration-300"},{default:o(()=>[s(t(Et),{class:"pb-4"},{default:o(()=>[r("div",Nn,[r("div",On,[s(t(z),{variant:"ghost",size:"icon",class:"h-6 w-6 hidden lg:flex mr-1 text-muted-foreground hover:text-foreground",onClick:e[20]||(e[20]=n=>B.value=!B.value),title:B.value?"Expand Sidebar":"Collapse Sidebar"},{default:o(()=>[B.value?(y(),U(t(ma),{key:1,class:"h-4 w-4"})):(y(),U(t(fa),{key:0,class:"h-4 w-4"}))]),_:1},8,["title"]),s(t(br),{class:"text-lg"},{default:o(()=>[O("Chapter "+f(a.chapter.chapter_number),1)]),_:1})]),r("div",Ln,[s(t(ke),{variant:a.chapter.status==="approved"?"default":"secondary"},{default:o(()=>[O(f(a.chapter.status.replace("_"," ")),1)]),_:1},8,["variant"]),s(t(ke),{variant:"outline",class:ie(["text-xs",{"text-green-600 border-green-200 bg-green-50":(t(K)?.total_score||0)>=80,"text-yellow-600 border-yellow-200 bg-yellow-50":(t(K)?.total_score||0)>=70&&(t(K)?.total_score||0)<80,"text-orange-600 border-orange-200 bg-orange-50":(t(K)?.total_score||0)>=60&&(t(K)?.total_score||0)<70,"text-red-600 border-red-200 bg-red-50":(t(K)?.total_score||0)<60}])},{default:o(()=>[O(f(t(K)?.total_score?Math.round(t(K).total_score):t(_e))+"% Quality ",1)]),_:1},8,["class"]),s(t(z),{variant:"ghost",size:"icon",class:"h-6 w-6 hidden lg:flex ml-1 text-muted-foreground hover:text-foreground",onClick:e[21]||(e[21]=n=>re.value=!re.value),title:re.value?"Expand Tools":"Collapse Tools"},{default:o(()=>[re.value?(y(),U(t(wa),{key:1,class:"h-4 w-4"})):(y(),U(t(ba),{key:0,class:"h-4 w-4"}))]),_:1},8,["title"])])])]),_:1}),s(t(kt),{class:"space-y-4"},{default:o(()=>[r("div",Wn,[s(t(bt),{for:"chapter-title"},{default:o(()=>[...e[68]||(e[68]=[O("Chapter Title",-1)])]),_:1}),s(t(ar),{id:"chapter-title",modelValue:C.value,"onUpdate:modelValue":e[22]||(e[22]=n=>C.value=n),placeholder:"Enter chapter title...",class:"text-lg font-medium"},null,8,["modelValue"])]),r("div",zn,[r("div",In,[s(t(bt),{for:"chapter-content"},{default:o(()=>[...e[69]||(e[69]=[O("Content",-1)])]),_:1}),r("div",Hn,[s(t(z),{onClick:Wt,variant:Y.value?"default":"outline",size:"sm"},{default:o(()=>[s(t(xt),{class:"mr-1 h-4 w-4"}),O(" "+f(Y.value?"Edit Mode":"Preview Mode"),1)]),_:1},8,["variant"])])]),Ne(s(t(sr),{ref_key:"editorFullscreenScrollRef",ref:$t,class:"h-[calc(100vh-320px)] w-full"},{default:o(()=>[s(ir,{modelValue:b.value,"onUpdate:modelValue":e[23]||(e[23]=n=>b.value=n),placeholder:"Start writing your chapter...","min-height":"600px",class:"text-base leading-relaxed",ref_key:"richTextEditorFullscreen",ref:Ve,"onUpdate:selectedText":e[24]||(e[24]=n=>{G.value=n,console.log("ðŸ“‹ ChapterEditor Fullscreen - Selected text updated:",{length:n.length,preview:n.substring(0,50)+(n.length>50?"...":"")})})},null,8,["modelValue"])]),_:1},512),[[Oe,!Y.value]]),Ne(s(t(sr),{ref_key:"previewFullscreenScrollRef",ref:qt,class:"h-[calc(100vh-320px)] w-full"},{default:o(()=>[s(lr,{content:b.value,"show-font-controls":!1,class:"min-h-[600px] rounded-md border border-border/50 bg-background p-6",style:{"font-family":"'Times New Roman', serif","line-height":"1.8"}},null,8,["content"])]),_:1},512),[[Oe,Y.value]])]),r("div",Un,[s(t(se),null,{default:o(()=>[s(t(ne),{asChild:""},{default:o(()=>[s(t(z),{onClick:e[25]||(e[25]=n=>t(me)(!1)),disabled:!Ue.value||t(De),size:"sm",class:"flex-1 sm:flex-none"},{default:o(()=>[s(t(vr),{class:"mr-1 h-3 w-3 sm:mr-2 sm:h-4 sm:w-4"}),r("span",Gn,f(t(De)?"Saving...":"Save Draft"),1),r("span",Vn,f(t(De)?"Saving...":"Save"),1)]),_:1},8,["disabled"])]),_:1}),s(t(oe),null,{default:o(()=>[...e[70]||(e[70]=[r("p",null,"Save chapter as draft (Ctrl+S)",-1)])]),_:1})]),_:1}),s(t(se),null,{default:o(()=>[s(t(ne),{asChild:""},{default:o(()=>[s(t(z),{onClick:zt,variant:"outline",size:"sm",class:"flex-1 sm:flex-none"},{default:o(()=>[s(t(et),{class:"mr-1 h-3 w-3 sm:mr-2 sm:h-4 sm:w-4"}),e[71]||(e[71]=r("span",{class:"hidden sm:inline"},"Bulk Analysis",-1)),e[72]||(e[72]=r("span",{class:"sm:hidden"},"Analyze",-1))]),_:1})]),_:1}),s(t(oe),null,{default:o(()=>[...e[73]||(e[73]=[r("p",null,"Open bulk chapter analysis to score this project.",-1)])]),_:1})]),_:1}),s(t(se),null,{default:o(()=>[s(t(ne),{asChild:""},{default:o(()=>[s(t(z),{onClick:e[26]||(e[26]=n=>L.value=!L.value),variant:"outline",size:"sm",class:"flex-1 sm:flex-none"},{default:o(()=>[L.value?(y(),U(t(Ca),{key:1,class:"mr-1 h-3 w-3 sm:mr-2 sm:h-4 sm:w-4"})):(y(),U(t(xt),{key:0,class:"mr-1 h-3 w-3 sm:mr-2 sm:h-4 sm:w-4"})),r("span",Bn,f(L.value?"Edit":"Preview"),1),r("span",Qn,f(L.value?"Edit":"Preview"),1)]),_:1})]),_:1}),s(t(oe),null,{default:o(()=>[r("p",null,f(L.value?"Switch to edit mode":"Switch to preview mode"),1)]),_:1})]),_:1}),s(t(se),null,{default:o(()=>[s(t(ne),{asChild:""},{default:o(()=>[s(t(z),{onClick:e[27]||(e[27]=n=>t(me)(!1)),disabled:!Ue.value||t(J)<ae.value*.8,size:"sm",class:"flex-1 sm:flex-none"},{default:o(()=>[s(t(hr),{class:"mr-1 h-3 w-3 sm:mr-2 sm:h-4 sm:w-4"}),e[74]||(e[74]=r("span",{class:"hidden sm:inline"},"Save & Mark Complete",-1)),e[75]||(e[75]=r("span",{class:"sm:hidden"},"Complete",-1))]),_:1},8,["disabled"])]),_:1}),s(t(oe),null,{default:o(()=>[...e[76]||(e[76]=[r("p",null,"Mark chapter as complete (requires 80% of target word count)",-1)])]),_:1})]),_:1}),s(wt,{project:be.value,"current-chapter":we.value,"all-chapters":$e.value,size:"sm",variant:"outline",class:"flex-1 sm:flex-none"},null,8,["project","current-chapter","all-chapters"])])]),_:1})]),_:1})],2),Ne(r("div",Kn,[r("div",Jn,[s(t(S),{project:be.value,chapter:we.value,"is-generating":M.value,"selected-text":G.value,"is-loading-suggestions":We.value,"show-citation-helper":Te.value,"chapter-content":b.value,"current-word-count":t(J),"target-word-count":ae.value,onStartStreamingGeneration:gt,onGetAiSuggestions:ht,"onUpdate:showCitationHelper":e[28]||(e[28]=n=>Te.value=n),onInsertCitation:Nt,onCheckCitations:ft},null,8,["project","chapter","is-generating","selected-text","is-loading-suggestions","show-citation-helper","chapter-content","current-word-count","target-word-count"]),s(t(w),{"show-defense-prep":ge.value,questions:ue.value,"is-loading":Be.value,"is-generating":Qe.value,"chapter-context":{chapter_number:le.value.chapter_number,chapter_title:le.value.title,word_count:t(J)},"defense-watcher":{meetsThreshold:t(Jt),shouldShowProgress:Xt.value,progressPercentage:t(Yt),wordsRemaining:t(Zt),hasTriggeredGeneration:t(mt),threshold:t(at),statusMessage:t(Kt)()},"onUpdate:showDefensePrep":Gt,onGenerateMore:Vt,onRefresh:e[29]||(e[29]=()=>Je(!0)),onMarkHelpful:er,onHideQuestion:tr},null,8,["show-defense-prep","questions","is-loading","is-generating","chapter-context","defense-watcher"])])],512),[[Oe,!re.value]])]),s(t(F),{"show-left-sidebar":he.value,"show-right-sidebar":m.value,"is-mobile":V.value,"all-chapters":$e.value,"current-chapter":we.value,project:be.value,"current-word-count":t(J),"target-word-count":ae.value,"writing-quality-score":t(_e),"chapter-content-length":b.value.length,"is-generating":M.value,"selected-text":G.value,"is-loading-suggestions":We.value,"show-citation-helper":Te.value,"chapter-content":b.value,"onUpdate:showLeftSidebar":e[30]||(e[30]=n=>he.value=n),"onUpdate:showRightSidebar":e[31]||(e[31]=n=>m.value=n),onGoToChapter:Ge,onGenerateNextChapter:pt,onStartStreamingGeneration:gt,onGetAiSuggestions:ht,"onUpdate:showCitationHelper":e[32]||(e[32]=n=>Te.value=n),onCheckCitations:ft},null,8,["show-left-sidebar","show-right-sidebar","is-mobile","all-chapters","current-chapter","project","current-word-count","target-word-count","writing-quality-score","chapter-content-length","is-generating","selected-text","is-loading-suggestions","show-citation-helper","chapter-content"]),s(ga,{open:t(At),"current-balance":t(xr),"required-words":t(yr),action:t(_r),"onUpdate:open":e[33]||(e[33]=n=>At.value=n),onClose:t(Sr)},null,8,["open","current-balance","required-words","action","onClose"])])])]),_:1}))]),_:1}))}});export{nl as default};
