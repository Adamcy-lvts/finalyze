import{_ as j}from"./index-D1Bfe2iA.js";import{_ as T}from"./index-vAbk2bOP.js";import{a as $,_ as I}from"./CardContent.vue_vue_type_script_setup_true_lang-Bm-RstVc.js";import{_ as F,a as M}from"./CardTitle.vue_vue_type_script_setup_true_lang-BRJY5xD6.js";import{_ as P}from"./Progress.vue_vue_type_script_setup_true_lang-BnryEz7I.js";import{a as L}from"./ScrollArea.vue_vue_type_script_setup_true_lang-5y8Rkj_U.js";import{_ as ee}from"./SafeHtmlText.vue_vue_type_script_setup_true_lang-AoQUy52D.js";import{d as te,I as se,y as C,G as oe,c as n,o as i,K as t,H as l,E as c,u as a,M as r,P as p,C as h,O as u,Q as O,V as B,J as S,ad as U}from"./app-D1-ZJD0S.js";import{B as V,R as ie}from"./ChapterEditor-Dn_SxIVp.js";import{X as N}from"./x-DKak0CSd.js";import{L as ae}from"./loader-DsyarZIP.js";import{C as A}from"./circle-check-big-B_KbJw2l.js";import{T as E}from"./DropdownMenuTrigger.vue_vue_type_script_setup_true_lang-DXVh9fst.js";import"./index-DSHUedNx.js";import"./Presence-BgCsZU84.js";import"./useForwardExpose-28GxStSc.js";import"./nullish-CHIgUVhi.js";import"./useNonce-B2HYzV_V.js";import"./purify.es-DxJI3Wx7.js";import"./Separator.vue_vue_type_script_setup_true_lang-CK8UI2yD.js";import"./Separator-evLQJ5jA.js";import"./TooltipTrigger.vue_vue_type_script_setup_true_lang-DHEtkRox.js";import"./DialogTitle-D-XWd999.js";import"./VisuallyHidden-G0GCiqHZ.js";import"./WordBalanceDisplay.vue_vue_type_script_setup_true_lang-BCW4QxZF.js";import"./coins-X9R8FRve.js";import"./plus-a-hjrPqv.js";import"./AppLayout.vue_vue_type_script_setup_true_lang-BZrU-4fw.js";import"./UserInfo.vue_vue_type_script_setup_true_lang-BsQkOs9d.js";import"./log-out-WHumE8jX.js";import"./AppLogo.vue_vue_type_script_setup_true_lang-BHJaMpVl.js";import"./library-nvV3QdC9.js";import"./index-Bi1qUVbe.js";import"./chevron-right-C7kEas8G.js";import"./sun-0x3cE1Si.js";import"./useWordBalance-Cxj5u-b5.js";import"./driver-B4w0q6_T.js";import"./PurchaseModal.vue_vue_type_script_setup_true_lang-CLA75FBd.js";import"./DialogTitle.vue_vue_type_script_setup_true_lang-BuWKUmEO.js";import"./DialogDescription.vue_vue_type_script_setup_true_lang-COWoln-x.js";import"./DialogFooter.vue_vue_type_script_setup_true_lang-g3H-4K57.js";import"./sparkles-CKA886iz.js";import"./arrow-right-DpMhafhR.js";import"./useChapterWordCount-BrdwDibo.js";import"./toNumber-CE-PQXij.js";import"./Input.vue_vue_type_script_setup_true_lang-Bb326Qm9.js";import"./Label.vue_vue_type_script_setup_true_lang-BNGJapuc.js";import"./RichTextEditor-C2QEU4vE.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";import"./index-BWEDi_FC.js";import"./step-DrZ9DcYd.js";import"./chart-column-DM7UK5aW.js";import"./calendar-idnGZQaO.js";import"./brain-B3TXv2of.js";import"./users-C4LSvxbs.js";import"./circle-alert-Dx8M4UPL.js";import"./eye-CSqVRC4c.js";import"./check-Dq1-0GWJ.js";import"./type-Cc80doJq.js";import"./loader-circle-DIwZu7ZG.js";import"./download-pByGX4LJ.js";import"./trash-2-C2K4m-Gb.js";import"./minus-BaOaPDgJ.js";import"./list-Ctf-wdQq.js";import"./save-Dk4Y2UZx.js";import"./CollapsibleTrigger.vue_vue_type_script_setup_true_lang-CrozhjAQ.js";import"./CollapsibleTrigger-CqLZSKeN.js";import"./useTextHistory-lX-xtm0x.js";import"./AlertDialogTitle.vue_vue_type_script_setup_true_lang-CWhvfMPm.js";import"./chevron-down-DxRstGXh.js";import"./search-CYWXkN8d.js";import"./Checkbox.vue_vue_type_script_setup_true_lang-xVpPv-Ba.js";import"./isValueEqualOrExist-DSClXoPv.js";import"./ohash.D__AXeF1-C-E83dC9.js";import"./VisuallyHiddenInput-BXVMdU8x.js";import"./RovingFocusItem-B0CXMVsW.js";import"./file-text-C5iyYYX1.js";import"./zap-4Zu81YsZ.js";import"./pen-tool-DTaGuMyB.js";import"./refresh-cw-3d884pLn.js";import"./arrow-left-DVtSKQuY.js";import"./menu-PxIZjAfI.js";import"./message-square-DwrtI3fi.js";import"./minimize-2-Chsoskou.js";import"./circle-help-C5LeXxbP.js";const re={class:"flex h-screen flex-col overflow-hidden bg-background"},le={class:"flex flex-shrink-0 items-center justify-between border-b bg-background/95 p-3 backdrop-blur supports-[backdrop-filter]:bg-background/60"},ne={class:"flex items-center gap-4"},de={class:"flex items-center gap-2"},ue={class:"text-sm text-muted-foreground"},ce={class:"flex items-center gap-2"},pe={class:"flex-shrink-0 bg-muted/30 px-3 py-2"},me={class:"mb-1 flex items-center justify-between"},fe={class:"text-xs text-muted-foreground"},ge={class:"flex flex-1 overflow-hidden"},ve={class:"flex min-h-0 flex-1 flex-col border-r"},xe={class:"flex-shrink-0 space-y-2"},he={class:"text-lg font-semibold"},_e={key:1,class:"flex items-center justify-center h-64 text-muted-foreground"},ye={class:"flex min-h-0 flex-1 flex-col bg-muted/20"},be={class:"flex-shrink-0 space-y-2"},ke={key:0,class:"flex gap-2"},Ce={key:0,class:"flex-shrink-0 space-y-2"},we={class:"text-sm text-muted-foreground p-3 bg-muted/50 rounded-md"},Te={key:0,class:"space-y-2"},Re={class:"flex items-center justify-between text-xs text-muted-foreground"},Ve={key:1,class:"flex-shrink-0"},je={class:"flex items-center justify-between"},$e={class:"grid grid-cols-2 gap-3 text-sm"},Ie={class:"flex items-center gap-2 p-2 rounded bg-background/50"},Pe={class:"font-medium"},Se={class:"flex items-center gap-2 p-2 rounded bg-background/50"},Ne={class:"font-medium"},Ae={class:"flex items-center gap-2 p-2 rounded bg-background/50"},Ee={class:"font-medium"},Fe={class:"flex items-center gap-2 p-2 rounded bg-background/50"},Me={class:"font-medium"},Le={key:0,class:"text-xs text-muted-foreground text-center"},Oe={class:"space-y-3"},Be={key:0,class:"font-medium"},Ue={class:"flex items-center gap-2"},ze={key:2,class:"h-4 w-4 rounded-full bg-gray-300"},We={class:"text-sm bg-muted px-1 rounded"},qe={class:"text-xs text-muted-foreground"},De={key:0},Xe={key:1,class:"font-medium pt-4"},He={class:"flex items-center justify-between"},Ye={class:"flex items-center gap-2"},Ge={class:"font-medium text-sm"},Je={class:"space-y-2"},Ke={key:0,class:"text-sm"},Qe={class:"font-medium text-primary"},Ze={class:"flex items-center gap-4 text-xs text-muted-foreground"},et={key:0},tt={key:1},st={key:1,class:"text-xs text-muted-foreground"},ot={key:2,class:"flex items-center gap-4 text-xs"},it={key:0,class:"flex items-center gap-1"},at=["href"],rt={key:1,class:"flex items-center gap-1"},lt=["href"],nt={key:3,class:"space-y-2"},dt={class:"text-xs text-muted-foreground"},ut={key:0,class:"ml-2"},ct={key:0,class:"mt-2 p-2 bg-muted/30 rounded border-l-2 border-green-500"},pt={class:"text-xs text-foreground italic"},mt={key:4,class:"space-y-2"},ft={key:0,class:"text-xs text-red-600"},gt={class:"flex items-center gap-2"},vt={class:"text-xs"},xt={class:"mt-1 p-2 bg-muted/20 rounded text-xs font-mono"},ht={key:2,class:"text-center text-muted-foreground py-8"},Js=te({__name:"CitationVerificationLayout",props:{project:{},chapter:{},chapterTitle:{},chapterContent:{},currentWordCount:{},targetWordCount:{},progressPercentage:{}},emits:["exitCitationMode"],setup(z,{emit:W}){const k=z,q=W;se();const w=C([]),x=C([]),m=C({total:0,verified:0,failed:0,unverified:0,pending:0}),v=C(!1),_=C(!1),d=C(""),y=C({percentage:0,message:"",completed:!1});let R=null,b=null;const D=o=>{b&&clearInterval(b),b=setInterval(async()=>{try{const e=await U.get(S("api.citation-verification.progress",o));if(e.data.success){const s=e.data.progress;y.value=s,d.value=s.message,(s.completed||s.percentage>=100)&&(clearInterval(b),b=null,setTimeout(()=>X(o),1e3))}}catch(e){console.error("Error fetching progress:",e)}},1e3)},X=async o=>{try{const e=await U.get(S("api.citation-verification.result",o));if(e.data.success){const s=e.data;w.value=s.citations||[],x.value=s.references||[],m.value=s.summary||m.value,d.value=s.message||"Verification completed",_.value=!0}else d.value=e.data.message||"Failed to fetch results"}catch(e){console.error("Error fetching results:",e),d.value="Failed to fetch verification results"}finally{v.value=!1,y.value={percentage:100,message:"Completed",completed:!0},R=null}},H=async()=>{if(!k.chapter?.id){console.error("No chapter ID available"),d.value="No chapter available to verify";return}v.value=!0,_.value=!1,y.value={percentage:0,message:"Initializing...",completed:!1},d.value="Starting async verification process...",console.log("=== ASYNC CITATION VERIFICATION START ==="),console.log("Chapter object:",k.chapter),console.log("Chapter ID:",k.chapter.id);try{const o=document.querySelector('meta[name="csrf-token"]')?.getAttribute("content");console.log("CSRF token found:",!!o);const e=S("api.projects.chapters.verify-citations",{project:k.project.slug,chapter:k.chapter.slug});console.log("Generated URL:",e);const s={method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json","X-CSRF-TOKEN":o||"","X-Requested-With":"XMLHttpRequest"},credentials:"same-origin",body:JSON.stringify({})};console.log("About to make async fetch request to:",e);const f=await fetch(e,s);if(console.log("Response received:",f.status,f.statusText),!f.ok)throw new Error(`HTTP error! status: ${f.status}`);const g=await f.json();console.log("Initial response:",g),g.success&&g.async?(R=g.session_id,d.value=g.message,console.log("Starting progress tracking for session:",R),D(R)):g.success?(w.value=g.citations||[],x.value=g.references||[],m.value=g.summary||m.value,d.value=g.message||"Verification completed",_.value=!0,v.value=!1):(d.value=g.message||"Verification failed",v.value=!1)}catch(o){console.error("Citation verification error:",o),o.message&&o.message.includes("419")?d.value="Session expired. Please refresh the page and try again.":o.message&&o.message.includes("401")?d.value="Unauthorized. Please log in again.":o.message&&o.message.includes("404")?d.value="Chapter not found. Please try again.":o.message&&o.message.includes("500")?d.value="Server error. Please try again.":(console.error("Error:",o.message),d.value="An unexpected error occurred. Please try again."),v.value=!1,y.value={percentage:0,message:"",completed:!1}}},Y=()=>{b&&(clearInterval(b),b=null)},G=async()=>{try{const o=x.value.filter(f=>f.status==="verified"&&f.formatted_citation);let e="";o.length>0?e=o.map(f=>f.formatted_citation).join(`

`):e=x.value.map(f=>{const g=f.authors?f.authors.join(", "):"Unknown",Q=f.year||"n.d.",Z=f.title||"Title not available";return`${g} (${Q}). ${Z}.`}).join(`

`),await navigator.clipboard.writeText(e);const s=d.value;d.value="References copied to clipboard!",setTimeout(()=>{d.value=s},2e3)}catch(o){console.error("Failed to copy references:",o),d.value="Failed to copy references to clipboard"}},J=()=>{console.log("Export references:",x.value),d.value="Export functionality coming soon!",setTimeout(()=>{d.value=_.value?`Verified ${m.value.verified} out of ${m.value.total} references using bibliography parsing`:""},2e3)},K=async o=>{console.log("Retrying reference:",o),d.value=`Retrying verification for reference ${o.id}...`,setTimeout(()=>{d.value='Individual retry functionality coming soon! Use "Verify Sources" to retry all.',setTimeout(()=>{d.value=_.value?`Verified ${m.value.verified} out of ${m.value.total} references using bibliography parsing`:""},2e3)},1e3)};return oe(()=>{Y()}),(o,e)=>(i(),n("div",re,[t("div",le,[t("div",ne,[l(a(T),{onClick:e[0]||(e[0]=s=>q("exitCitationMode")),variant:"ghost",size:"icon"},{default:c(()=>[l(a(N),{class:"h-4 w-4"})]),_:1}),t("div",de,[l(a(V),{class:"h-5 w-5 text-primary"}),t("div",null,[l(ee,{as:"h1",class:"text-lg font-bold",content:k.project.title},null,8,["content"]),t("p",ue," Citation Verification • Chapter "+r(k.chapter.chapter_number)+" • "+r(o.currentWordCount)+" / "+r(o.targetWordCount)+" words ",1)])])]),t("div",ce,[l(a(j),{variant:o.chapter.status==="approved"?"default":"secondary"},{default:c(()=>[p(r(o.chapter.status.replace("_"," ")),1)]),_:1},8,["variant"])])]),t("div",pe,[t("div",me,[e[1]||(e[1]=t("span",{class:"text-xs font-medium"},"Writing Progress",-1)),t("span",fe,r(Math.round(o.progressPercentage))+"%",1)]),l(a(P),{value:o.progressPercentage,class:"h-1"},null,8,["value"])]),t("div",ge,[t("div",ve,[l(a(I),{class:"flex min-h-0 flex-1 flex-col rounded-none border-0 bg-transparent shadow-none"},{default:c(()=>[l(a(F),{class:"flex-shrink-0 border-b px-4 py-3"},{default:c(()=>[l(a(M),{class:"text-base"},{default:c(()=>[p("Chapter "+r(o.chapter.chapter_number)+" - Content",1)]),_:1})]),_:1}),l(a($),{class:"flex min-h-0 flex-1 flex-col space-y-3 p-4"},{default:c(()=>[t("div",xe,[t("h2",he,r(o.chapterTitle||"Untitled Chapter"),1)]),l(a(L),{class:"min-h-0 flex-1"},{default:c(()=>[o.chapterContent?(i(),h(ie,{key:0,content:o.chapterContent,class:"p-4",style:{"font-family":"'Times New Roman', serif","line-height":"1.6"}},null,8,["content"])):(i(),n("div",_e,[...e[2]||(e[2]=[t("p",null,"No content available to verify",-1)])]))]),_:1})]),_:1})]),_:1})]),t("div",ye,[l(a(I),{class:"flex min-h-0 flex-1 flex-col rounded-none border-0 bg-transparent shadow-none"},{default:c(()=>[l(a(F),{class:"flex-shrink-0 border-b px-4 py-3"},{default:c(()=>[l(a(M),{class:"text-base flex items-center gap-2"},{default:c(()=>[l(a(V),{class:"h-4 w-4"}),e[3]||(e[3]=p(" Citation Verification ",-1))]),_:1})]),_:1}),l(a($),{class:"flex min-h-0 flex-1 flex-col space-y-4 p-4"},{default:c(()=>[t("div",be,[l(a(T),{onClick:H,disabled:v.value||!o.chapterContent,class:"w-full"},{default:c(()=>[v.value?(i(),h(a(ae),{key:0,class:"h-4 w-4 mr-2 animate-spin"})):(i(),h(a(V),{key:1,class:"h-4 w-4 mr-2"})),p(" "+r(v.value?"Verifying...":"Verify Sources"),1)]),_:1},8,["disabled"]),_.value&&x.value.length>0?(i(),n("div",ke,[l(a(T),{onClick:G,variant:"outline",size:"sm",class:"flex-1 text-xs"},{default:c(()=>[...e[4]||(e[4]=[p(" Copy References ",-1)])]),_:1}),l(a(T),{onClick:J,variant:"outline",size:"sm",class:"flex-1 text-xs"},{default:c(()=>[...e[5]||(e[5]=[p(" Export ",-1)])]),_:1})])):u("",!0)]),d.value||v.value?(i(),n("div",Ce,[t("div",we,r(d.value),1),v.value&&y.value.percentage>0?(i(),n("div",Te,[t("div",Re,[t("span",null,r(y.value.message),1),t("span",null,r(Math.round(y.value.percentage))+"%",1)]),l(a(P),{value:y.value.percentage,class:"h-2"},null,8,["value"])])):u("",!0)])):u("",!0),_.value?(i(),n("div",Ve,[l(a(I),{class:"bg-muted/30"},{default:c(()=>[l(a($),{class:"p-4 space-y-3"},{default:c(()=>[t("div",je,[e[6]||(e[6]=t("h4",{class:"font-medium text-sm"},"Verification Results",-1)),l(a(j),{variant:"outline",class:"text-xs"},{default:c(()=>[p(r(Math.round(m.value.verified/m.value.total*100))+"% verified ",1)]),_:1})]),l(a(P),{value:m.value.verified/m.value.total*100,class:"h-2"},null,8,["value"]),t("div",$e,[t("div",Ie,[e[7]||(e[7]=t("div",{class:"h-3 w-3 rounded-full bg-blue-500"},null,-1)),t("span",Pe,r(m.value.total),1),e[8]||(e[8]=t("span",{class:"text-muted-foreground text-xs"},"Total",-1))]),t("div",Se,[l(a(A),{class:"h-3 w-3 text-green-500"}),t("span",Ne,r(m.value.verified),1),e[9]||(e[9]=t("span",{class:"text-muted-foreground text-xs"},"Verified",-1))]),t("div",Ae,[l(a(N),{class:"h-3 w-3 text-red-500"}),t("span",Ee,r(m.value.failed||0),1),e[10]||(e[10]=t("span",{class:"text-muted-foreground text-xs"},"Failed",-1))]),t("div",Fe,[l(a(E),{class:"h-3 w-3 text-orange-500"}),t("span",Me,r(m.value.pending||0),1),e[11]||(e[11]=t("span",{class:"text-muted-foreground text-xs"},"Pending",-1))])]),m.value.processing_time_ms||d.value.includes("processing_time_ms")?(i(),n("div",Le,[...e[12]||(e[12]=[t("span",null,"Processing completed",-1)])])):u("",!0)]),_:1})]),_:1})])):u("",!0),_.value?(i(),h(a(L),{key:2,class:"min-h-0 flex-1"},{default:c(()=>[t("div",Oe,[w.value.length>0?(i(),n("h3",Be,"In-text Citations")):u("",!0),(i(!0),n(O,null,B(w.value,s=>(i(),n("div",{key:s.id,class:"border rounded-md p-3 space-y-2"},[t("div",Ue,[s.status==="verified"?(i(),h(a(A),{key:0,class:"h-4 w-4 text-green-500"})):s.status==="unverified"?(i(),h(a(E),{key:1,class:"h-4 w-4 text-orange-500"})):(i(),n("div",ze)),t("code",We,r(s.text),1)]),t("div",qe,[t("p",null,[e[13]||(e[13]=t("strong",null,"Author:",-1)),p(" "+r(s.author),1)]),t("p",null,[e[14]||(e[14]=t("strong",null,"Year:",-1)),p(" "+r(s.year),1)]),s.details?(i(),n("p",De,[e[15]||(e[15]=t("strong",null,"Status:",-1)),p(" "+r(s.details),1)])):u("",!0)])]))),128)),x.value.length>0?(i(),n("h3",Xe,"Reference List")):u("",!0),(i(!0),n(O,null,B(x.value,s=>(i(),n("div",{key:s.id,class:"border rounded-md p-4 space-y-3"},[t("div",He,[t("div",Ye,[s.status==="verified"?(i(),h(a(A),{key:0,class:"h-5 w-5 text-green-500"})):s.status==="failed"?(i(),h(a(N),{key:1,class:"h-5 w-5 text-red-500"})):(i(),h(a(E),{key:2,class:"h-5 w-5 text-orange-500"})),t("span",Ge,"Reference "+r(s.id),1)]),l(a(j),{variant:s.status==="verified"?"default":s.status==="failed"?"destructive":"secondary",class:"text-xs"},{default:c(()=>[p(r(s.status||"unverified"),1)]),_:2},1032,["variant"])]),t("div",Je,[s.title?(i(),n("div",Ke,[t("span",Qe,r(s.title),1)])):u("",!0),t("div",Ze,[s.authors&&s.authors.length>0?(i(),n("div",et,[e[16]||(e[16]=t("strong",null,"Authors:",-1)),p(" "+r(s.authors.join(", ")),1)])):u("",!0),s.year?(i(),n("div",tt,[e[17]||(e[17]=t("strong",null,"Year:",-1)),p(" "+r(s.year),1)])):u("",!0)]),s.journal||s.publisher?(i(),n("div",st,[e[18]||(e[18]=t("strong",null,"Published in:",-1)),p(" "+r(s.journal||s.publisher),1)])):u("",!0),s.doi||s.url?(i(),n("div",ot,[s.doi?(i(),n("div",it,[e[19]||(e[19]=t("strong",null,"DOI:",-1)),t("a",{href:"https://doi.org/"+s.doi,target:"_blank",class:"text-blue-600 hover:underline"},r(s.doi),9,at)])):u("",!0),s.url&&!s.doi?(i(),n("div",rt,[e[20]||(e[20]=t("strong",null,"URL:",-1)),t("a",{href:s.url,target:"_blank",class:"text-blue-600 hover:underline break-all"},r(s.url.length>40?s.url.substring(0,40)+"...":s.url),9,lt)])):u("",!0)])):u("",!0),s.status==="verified"?(i(),n("div",nt,[t("div",dt,[e[23]||(e[23]=t("strong",null,"Verification Method:",-1)),p(" "+r(s.verification_method||"api")+" ",1),s.confidence?(i(),n("span",ut,[e[21]||(e[21]=p(" | ",-1)),e[22]||(e[22]=t("strong",null,"Confidence:",-1)),p(" "+r(Math.round(s.confidence*100))+"% ",1)])):u("",!0)]),s.formatted_citation?(i(),n("div",ct,[e[24]||(e[24]=t("div",{class:"text-xs font-medium text-muted-foreground mb-1"},"Formatted Citation (APA):",-1)),t("div",pt,r(s.formatted_citation),1)])):u("",!0)])):u("",!0),s.status==="failed"?(i(),n("div",mt,[s.failure_reason?(i(),n("div",ft,[e[25]||(e[25]=t("strong",null,"Issue:",-1)),p(" "+r(s.failure_reason),1)])):u("",!0),t("div",gt,[l(a(T),{onClick:f=>K(s),variant:"outline",size:"sm",class:"text-xs h-6 px-2",disabled:v.value},{default:c(()=>[...e[26]||(e[26]=[p(" Retry ",-1)])]),_:2},1032,["onClick","disabled"]),e[27]||(e[27]=t("span",{class:"text-xs text-muted-foreground"}," Try searching with different criteria ",-1))])])):u("",!0),t("details",vt,[e[28]||(e[28]=t("summary",{class:"cursor-pointer text-muted-foreground hover:text-foreground"}," Show raw reference text ",-1)),t("div",xt,r(s.raw_text),1)])])]))),128)),w.value.length===0&&x.value.length===0?(i(),n("div",ht,[l(a(V),{class:"h-12 w-12 mx-auto mb-2 opacity-50"}),e[29]||(e[29]=t("p",null,"No citations found in this chapter",-1)),e[30]||(e[30]=t("p",{class:"text-xs"},"Citations will appear here when detected",-1))])):u("",!0)])]),_:1})):u("",!0)]),_:1})]),_:1})])])]))}});export{Js as default};
