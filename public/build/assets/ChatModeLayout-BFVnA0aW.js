import{d as me,t as ue,s as it,c as _,o as f,f as U,g as i,k as s,u as t,j as d,b as D,e as ie,q as ke,n as I,i as Q,z as E,y as T,F as be,h as xe,v as lt,ad as he,U as pe,ak as dt,J as ut,p as Ie,aa as ve,aj as ct,T as ft,Q as Fe,V as Le}from"./app-DXo2qlXx.js";import{_ as ce}from"./index-Dg5asTLP.js";import{c as Se,_ as k}from"./index-CkWWMrP7.js";import{a as pt,_ as mt}from"./CardContent.vue_vue_type_script_setup_true_lang-OnXYEK3B.js";import{_ as Ze}from"./Progress.vue_vue_type_script_setup_true_lang-DO3MrglI.js";import{a as Ce}from"./ScrollArea.vue_vue_type_script_setup_true_lang-IfPPnQQY.js";import{az as vt,aA as gt,aO as ht,aP as yt,aQ as bt,aR as xt,aK as wt,ap as Je,aa as _t}from"./RichTextEditor-4qQRVwyV.js";import{S as et}from"./send-BBClmdVt.js";import{_ as _e}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{R as we,B as kt}from"./ChapterEditor-Cb4MoSPb.js";import{_ as Ue,a as Ye}from"./index-DkHDFKSv.js";import{L as Ct}from"./loader-BGpmQimG.js";import{C as Ae}from"./circle-alert-CTxpdSQx.js";import{C as Tt}from"./check-BWhUQiN7.js";import{T as St}from"./trash-2-ZdRL_uST.js";import{F as tt}from"./file-text-B2fGNh-t.js";import{_ as $t}from"./Input.vue_vue_type_script_setup_true_lang-C66Y-kcM.js";import{S as ye}from"./search-DtukjWEs.js";import{X as Te}from"./x-CGUx5PeF.js";import{M as st}from"./message-square-DeC7Bfmk.js";import{C as He}from"./clock-DdmFr2P4.js";import{C as at}from"./chevron-left-DNXQwBGQ.js";import{C as ot}from"./chevron-right-Cdb8ZCTO.js";import{_ as $e,c as Ee,a as Me,b as Re}from"./DialogTitle.vue_vue_type_script_setup_true_lang-Bl25YZsR.js";import{_ as je}from"./DialogDescription.vue_vue_type_script_setup_true_lang-Dug2njhh.js";import{_ as De}from"./DialogFooter.vue_vue_type_script_setup_true_lang-BbesDam9.js";import{C as Et}from"./chevron-down-hlx1znAb.js";import{P as Oe}from"./pen-tool-CsINhjyb.js";import{P as Be}from"./plus-BsOPr_x8.js";import{M as Mt}from"./minimize-2-C0PnclNY.js";import{M as Rt}from"./useTextHistory-D8jRyost.js";import{C as jt}from"./chart-column-DIQGbb-G.js";import{C as Dt,T as zt,a as Pt}from"./thumbs-up-Vgu2sdx1.js";import{T as At}from"./target-BFRAcJHy.js";import{Z as Ot}from"./zap-CsN_1AdD.js";import{T as Nt,C as It}from"./type-CK_QB0xm.js";import{B as Ht}from"./brain-C5NopvCi.js";import{S as Ft}from"./sparkles-Bxwwotgz.js";import{B as Ve}from"./bot-PGRNlCwR.js";import{C as rt}from"./circle-check-big-BIM4RW94.js";import{U as Lt}from"./user-CGU6ompW.js";import{S as Ut}from"./square-CvKUX5ej.js";import{E as Yt}from"./eye-6CFFy5ii.js";import{S as Bt}from"./save-6RmHBhN5.js";import"./index-I-wGS76U.js";import"./Presence-o50VOThk.js";import"./useForwardExpose--YCaV9Ag.js";import"./nullish-CHIgUVhi.js";import"./useNonce-BTT7VnfA.js";import"./purify.es-DxJI3Wx7.js";import"./index-BWEDi_FC.js";import"./step-DrZ9DcYd.js";import"./calendar-CS_W0kI0.js";import"./users-qPvWTk-A.js";import"./loader-circle-HypqbmCP.js";import"./download-BFKqnz8y.js";import"./DropdownMenuTrigger.vue_vue_type_script_setup_true_lang-bOf5zfcv.js";import"./index-h2yNoIu5.js";import"./DialogTitle-DmgzGPjX.js";import"./VisuallyHidden-Cpehayb9.js";import"./Label.vue_vue_type_script_setup_true_lang-B2_Isfyb.js";import"./minus--pKQSyt-.js";import"./list-8-t4TrUl.js";import"./CardTitle.vue_vue_type_script_setup_true_lang-B67ut52-.js";import"./Separator.vue_vue_type_script_setup_true_lang-Cms0ZhOQ.js";import"./Separator-CVYdywNN.js";import"./TooltipTrigger.vue_vue_type_script_setup_true_lang-Te2Mupkp.js";import"./WordBalanceDisplay.vue_vue_type_script_setup_true_lang-P-TYEUtw.js";import"./coins-BLHCBV4j.js";import"./AppLayout.vue_vue_type_script_setup_true_lang-Cj7vy2op.js";import"./UserInfo.vue_vue_type_script_setup_true_lang-DCHY8X4F.js";import"./log-out-CPpZl4ET.js";import"./AppLogo.vue_vue_type_script_setup_true_lang-qEo6aqYC.js";import"./library-DWvVXjsr.js";import"./book-open-4pdaK7B5.js";import"./sun-DxH2VbQ8.js";import"./useWordBalance-BmjeI9Ym.js";import"./PurchaseModal.vue_vue_type_script_setup_true_lang-ngRaXqLT.js";import"./arrow-right-B2GGlXWT.js";import"./useChapterWordCount-CEPwK_ux.js";import"./toNumber-BXqd8Mmu.js";import"./CollapsibleTrigger.vue_vue_type_script_setup_true_lang-GtjbMb7J.js";import"./refresh-cw-CyCh2FLz.js";import"./arrow-left-Oyx9ETbj.js";import"./menu-B7fO4jHJ.js";import"./AlertDialogTitle.vue_vue_type_script_setup_true_lang-V3ktc8lA.js";import"./Checkbox.vue_vue_type_script_setup_true_lang-BMXQVWEI.js";import"./ohash.D__AXeF1-C-E83dC9.js";import"./VisuallyHiddenInput-17Z2Fvum.js";import"./RovingFocusItem-DQZ-mCSn.js";/**
 * @license lucide-vue-next v0.468.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Vt=Se("Building2Icon",[["path",{d:"M6 22V4a2 2 0 0 1 2-2h8a2 2 0 0 1 2 2v18Z",key:"1b4qmf"}],["path",{d:"M6 12H4a2 2 0 0 0-2 2v6a2 2 0 0 0 2 2h2",key:"i71pzd"}],["path",{d:"M18 9h2a2 2 0 0 1 2 2v9a2 2 0 0 1-2 2h-2",key:"10jefs"}],["path",{d:"M10 6h4",key:"1itunk"}],["path",{d:"M10 10h4",key:"tcdvrf"}],["path",{d:"M10 14h4",key:"kelpxr"}],["path",{d:"M10 18h4",key:"1ulq68"}]]);/**
 * @license lucide-vue-next v0.468.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const qt=Se("MessageCircleIcon",[["path",{d:"M7.9 20A9 9 0 1 0 4 16.1L2 22Z",key:"vv11sd"}]]);/**
 * @license lucide-vue-next v0.468.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const fe=Se("TrashIcon",[["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6",key:"4alrt4"}],["path",{d:"M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2",key:"v07s0e"}]]);/**
 * @license lucide-vue-next v0.468.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Gt=Se("UploadIcon",[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"17 8 12 3 7 8",key:"t8dd8p"}],["line",{x1:"12",x2:"12",y1:"3",y2:"15",key:"widbto"}]]),Qt={class:"w-full border rounded-md bg-background"},Wt={key:0,class:"flex items-center gap-1 p-1 border-b bg-muted/20"},Xt={class:"relative"},Kt=me({__name:"CompactRichTextEditor",props:{modelValue:{},placeholder:{default:"Type your message..."},disabled:{type:Boolean,default:!1},showToolbar:{type:Boolean,default:!0}},emits:["update:modelValue","submit","keydown"],setup(F,{expose:y,emit:n}){const v=F,g=n,p=vt({content:v.modelValue,editable:!v.disabled,extensions:[gt.configure({heading:!1,bulletList:!1,orderedList:!1,blockquote:!1,horizontalRule:!1,codeBlock:!1}),ht.configure({placeholder:v.placeholder})],editorProps:{attributes:{class:"prose prose-sm dark:prose-invert max-w-none focus:outline-none min-h-[2rem] max-h-32 overflow-y-auto",style:"padding: 8px; line-height: 1.5;"},handleKeyDown:(M,O)=>(g("keydown",O),O.key==="Enter"&&!O.shiftKey?(O.preventDefault(),g("submit"),!0):!1)},onUpdate:({editor:M})=>{g("update:modelValue",M.getHTML())}});ue(()=>v.modelValue,M=>{p.value&&p.value.getHTML()!==M&&p.value.commands.setContent(M,!1)}),ue(()=>v.disabled,M=>{p.value&&p.value.setEditable(!M)}),it(()=>{p.value&&p.value.destroy()});const b=()=>p.value?.chain().focus().toggleBold().run(),w=()=>p.value?.chain().focus().toggleItalic().run(),u=()=>p.value?.chain().focus().toggleCode().run(),r=M=>p.value?.isActive(M)??!1,h=()=>{p.value?.commands.focus()},S=()=>p.value?.getText()??"";return y({focus:h,clear:()=>{p.value?.commands.clearContent()},getTextContent:S,editor:p}),(M,O)=>(f(),_("div",Qt,[M.showToolbar?(f(),_("div",Wt,[s(t(k),{onClick:b,variant:r("bold")?"default":"ghost",size:"sm",class:"h-6 w-6 p-0"},{default:d(()=>[s(t(yt),{class:"w-3 h-3"})]),_:1},8,["variant"]),s(t(k),{onClick:w,variant:r("italic")?"default":"ghost",size:"sm",class:"h-6 w-6 p-0"},{default:d(()=>[s(t(bt),{class:"w-3 h-3"})]),_:1},8,["variant"]),s(t(k),{onClick:u,variant:r("code")?"default":"ghost",size:"sm",class:"h-6 w-6 p-0"},{default:d(()=>[s(t(xt),{class:"w-3 h-3"})]),_:1},8,["variant"]),O[1]||(O[1]=i("div",{class:"flex-1"},null,-1)),s(t(k),{onClick:O[0]||(O[0]=W=>g("submit")),disabled:M.disabled||!S().trim(),size:"sm",class:"h-6 px-2"},{default:d(()=>[s(t(et),{class:"w-3 h-3"})]),_:1},8,["disabled"])])):U("",!0),i("div",Xt,[s(t(wt),{editor:t(p),class:"compact-prose-editor"},null,8,["editor"])])]))}}),Zt=_e(Kt,[["__scopeId","data-v-06ee7de1"]]),Jt={class:"space-y-4"},es=["accept","disabled"],ts={class:"flex flex-col items-center gap-3"},ss={class:"space-y-1"},as={class:"text-sm font-medium"},os={class:"text-xs text-muted-foreground"},rs={key:0,class:"w-full max-w-xs"},ns={class:"text-xs text-muted-foreground mt-1"},is={key:0,class:"space-y-2"},ls={key:1,class:"space-y-2"},ds={key:2,class:"space-y-3"},us={class:"space-y-2"},cs={class:"flex-1 min-w-0 space-y-2"},fs={class:"flex items-start justify-between gap-2"},ps={class:"min-w-0 flex-1"},ms={class:"text-sm font-medium truncate"},vs={class:"text-xs text-muted-foreground"},gs={class:"flex flex-wrap gap-1"},hs={key:0,class:"text-xs text-muted-foreground"},ys=me({__name:"FileUpload",props:{projectSlug:{},chapterNumber:{},sessionId:{},disabled:{type:Boolean}},emits:["file-uploaded","file-deleted","files-loaded"],setup(F,{emit:y}){const n=F,v=y,g=D(),p=D(!1),b=D(0),w=D(""),u=D(""),r=D(!1),h=D([]),S=ie(()=>h.value.length>0),H=ie(()=>".pdf,.doc,.docx,.txt,.rtf,.md"),M=ie(()=>"10 MB"),O=()=>{!n.disabled&&!p.value&&g.value?.click()},W=c=>{const o=c.target;o.files&&o.files.length>0&&K(o.files[0])},q=c=>{if(c.preventDefault(),r.value=!1,n.disabled||p.value)return;const o=c.dataTransfer?.files;o&&o.length>0&&K(o[0])},J=c=>{c.preventDefault(),!n.disabled&&!p.value&&(r.value=!0)},Y=()=>{r.value=!1},K=async c=>{if(!n.disabled){if(w.value="",u.value="",p.value=!0,b.value=0,!G(c)){p.value=!1;return}try{const o=new FormData;o.append("file",c),o.append("session_id",n.sessionId);const m=await he.post(pe("chapters.chat-upload",{project:n.projectSlug,chapter:n.chapterNumber}),o,{headers:{"Content-Type":"multipart/form-data"},onUploadProgress:L=>{L.total&&(b.value=Math.round(L.loaded*100/L.total))}});m.data.success?(u.value=m.data.message,h.value.unshift(m.data.upload),v("file-uploaded",m.data.upload),g.value&&(g.value.value=""),setTimeout(()=>{u.value=""},3e3)):w.value=m.data.error||"Upload failed"}catch(o){console.error("Upload error:",o),w.value=o.response?.data?.error||"Failed to upload file. Please try again."}finally{p.value=!1,b.value=0}}},G=c=>{if(c.size>10485760)return w.value=`File size exceeds ${M.value} limit`,!1;const m=["pdf","doc","docx","txt","rtf","md"],L=c.name.split(".").pop()?.toLowerCase();return!L||!m.includes(L)?(w.value="Please upload PDF, DOC, DOCX, TXT, RTF, or MD files only",!1):!0},N=async c=>{try{(await he.delete(pe("chapters.chat-file-delete",{project:n.projectSlug,chapter:n.chapterNumber,uploadId:c}))).data.success&&(h.value=h.value.filter(m=>m.id!==c),v("file-deleted",c))}catch(o){console.error("Delete error:",o),w.value="Failed to delete file"}},se=async()=>{try{const c=await he.get(pe("chapters.chat-files",{project:n.projectSlug,chapter:n.chapterNumber}),{params:{session_id:n.sessionId}});c.data.success&&(h.value=c.data.files,v("files-loaded",c.data.files))}catch(c){console.error("Failed to load existing files:",c)}},te=c=>(c.split(".").pop()?.toLowerCase(),tt),ae=c=>c.slice(0,3).join(", ")+(c.length>3?"...":"");return ke(()=>{se()}),(c,o)=>(f(),_("div",Jt,[i("div",{class:I(["border-2 border-dashed rounded-lg p-6 text-center transition-all",r.value?"border-primary bg-primary/5":"border-muted-foreground/25 hover:border-muted-foreground/50",c.disabled||p.value?"opacity-50 cursor-not-allowed":"cursor-pointer"]),onClick:O,onDragover:J,onDragleave:Y,onDrop:q},[i("input",{ref_key:"fileInput",ref:g,type:"file",accept:H.value,class:"hidden",onChange:W,disabled:c.disabled||p.value},null,40,es),i("div",ts,[i("div",{class:I(["flex h-12 w-12 items-center justify-center rounded-full",p.value?"bg-primary/10":"bg-muted"])},[p.value?(f(),Q(t(Ct),{key:0,class:"h-6 w-6 animate-spin text-primary"})):(f(),Q(t(Gt),{key:1,class:"h-6 w-6 text-muted-foreground"}))],2),i("div",ss,[i("p",as,E(p.value?"Uploading and analyzing...":"Drop files here or click to browse"),1),i("p",os," PDF, DOC, DOCX, TXT, RTF, MD up to "+E(M.value),1)]),p.value?(f(),_("div",rs,[s(t(Ze),{value:b.value,class:"h-2"},null,8,["value"]),i("p",ns,E(b.value)+"%",1)])):U("",!0)])],34),w.value?(f(),_("div",is,[s(t(Ue),{variant:"destructive"},{default:d(()=>[s(t(Ae),{class:"h-4 w-4"}),s(t(Ye),null,{default:d(()=>[T(E(w.value),1)]),_:1})]),_:1})])):U("",!0),u.value?(f(),_("div",ls,[s(t(Ue),null,{default:d(()=>[s(t(Tt),{class:"h-4 w-4"}),s(t(Ye),null,{default:d(()=>[T(E(u.value),1)]),_:1})]),_:1})])):U("",!0),S.value?(f(),_("div",ds,[o[0]||(o[0]=i("h4",{class:"text-sm font-medium text-foreground"},"Uploaded Documents",-1)),i("div",us,[(f(!0),_(be,null,xe(h.value,m=>(f(),_("div",{key:m.id,class:"flex items-start gap-3 p-3 bg-muted/30 rounded-lg border"},[(f(),Q(lt(te(m.filename)),{class:"h-5 w-5 text-muted-foreground mt-0.5 flex-shrink-0"})),i("div",cs,[i("div",fs,[i("div",ps,[i("p",ms,E(m.filename),1),i("p",vs,E(m.size),1)]),s(t(k),{onClick:L=>N(m.id),variant:"ghost",size:"sm",class:"h-6 w-6 p-0 text-muted-foreground hover:text-destructive"},{default:d(()=>[s(t(St),{class:"h-3 w-3"})]),_:2},1032,["onClick"])]),i("div",gs,[s(t(ce),{variant:"secondary",class:"text-xs"},{default:d(()=>[T(E(m.word_count)+" words ",1)]),_:2},1024),m.citations_found>0?(f(),Q(t(ce),{key:0,variant:"secondary",class:"text-xs"},{default:d(()=>[T(E(m.citations_found)+" citations ",1)]),_:2},1024)):U("",!0),m.main_topics.length>0?(f(),Q(t(ce),{key:1,variant:"outline",class:"text-xs"},{default:d(()=>[T(E(ae(m.main_topics)),1)]),_:2},1024)):U("",!0)]),m.uploaded_at?(f(),_("p",hs," Uploaded "+E(m.uploaded_at),1)):U("",!0)])]))),128))])])):U("",!0)]))}}),bs=_e(ys,[["__scopeId","data-v-0e5d2848"]]),xs={key:0,class:"flex h-full flex-col bg-background border-l"},ws={class:"flex-shrink-0 border-b p-3"},_s={class:"flex items-center justify-between mb-3"},ks={class:"text-sm font-semibold flex items-center gap-2"},Cs={class:"space-y-2"},Ts={class:"relative"},Ss={class:"flex gap-1"},$s={class:"p-3 space-y-3"},Es={key:0,class:"text-center py-8"},Ms={key:1,class:"text-center py-8"},Rs={class:"text-sm text-destructive"},js={key:2,class:"text-center py-8"},Ds={class:"flex flex-col items-center gap-2"},zs={key:3,class:"space-y-2"},Ps={class:"flex items-center justify-between"},As={class:"text-xs text-muted-foreground"},Os={key:0,class:"text-xs text-muted-foreground"},Ns={class:"space-y-2"},Is=["onClick"],Hs={class:"flex items-start justify-between gap-2 mb-2"},Fs={class:"flex items-center gap-1 text-xs text-muted-foreground"},Ls={class:"space-y-2"},Us=["innerHTML"],Ys={key:0,class:"text-xs text-muted-foreground border-l-2 pl-2"},Bs={key:0,class:"flex items-center justify-center gap-1 pt-2 border-t"},Vs={class:"text-xs text-muted-foreground px-2"},qs={key:4,class:"text-center py-8"},Gs={class:"flex flex-col items-center gap-2"},qe=10,Qs=me({__name:"ChatSearch",props:{projectSlug:{},chapterNumber:{},show:{type:Boolean}},emits:["close","message-selected"],setup(F,{emit:y}){const n=F,v=y,g=D(""),p=D([]),b=D(!1),w=D(""),u=D(1),r=D(0),h=D("all"),S=ie(()=>p.value.length>0),H=ie(()=>Math.ceil(r.value/qe)),M=ie(()=>u.value<H.value),O=ie(()=>u.value>1),W=ie(()=>!b.value&&g.value.length>0&&!S.value);let q=null;const J=()=>{q&&clearTimeout(q),q=setTimeout(()=>{g.value.trim().length>=2?Y():(p.value=[],r.value=0,u.value=1)},300)},Y=async(c=1)=>{if(!(!g.value.trim()||b.value)){b.value=!0,w.value="",u.value=c;try{const o=await he.get(pe("chapters.chat-search",{project:n.projectSlug,chapter:n.chapterNumber}),{params:{q:g.value.trim(),type:h.value==="all"?null:h.value,page:c,per_page:qe}});o.data.success?(p.value=o.data.results,r.value=o.data.total):w.value=o.data.error||"Search failed"}catch(o){console.error("Search error:",o),w.value="Failed to search chat history. Please try again."}finally{b.value=!1}}},K=()=>{g.value="",p.value=[],r.value=0,u.value=1,w.value=""},G=c=>{c>=1&&c<=H.value&&c!==u.value&&Y(c)},N=c=>{v("message-selected",c.id,c.session_id),v("close")},se=c=>{const o=new Date(c),L=new Date().getTime()-o.getTime(),re=Math.floor(L/(1e3*60*60*24));return re===0?"Today "+o.toLocaleTimeString("en-US",{hour:"2-digit",minute:"2-digit",hour12:!1}):re===1?"Yesterday "+o.toLocaleTimeString("en-US",{hour:"2-digit",minute:"2-digit",hour12:!1}):re<7?o.toLocaleDateString("en-US",{weekday:"short",hour:"2-digit",minute:"2-digit",hour12:!1}):o.toLocaleDateString("en-US",{month:"short",day:"numeric",hour:"2-digit",minute:"2-digit",hour12:!1})},te=c=>{switch(c){case"user":return"You";case"ai":return"AI";case"system":return"System";default:return c}},ae=c=>{switch(c){case"user":return"bg-blue-100 text-blue-800 dark:bg-blue-900 dark:text-blue-200";case"ai":return"bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-200";case"system":return"bg-gray-100 text-gray-800 dark:bg-gray-900 dark:text-gray-200";default:return"bg-gray-100 text-gray-800 dark:bg-gray-900 dark:text-gray-200"}};return ue(g,J),ue(h,()=>{g.value.trim().length>=2&&(u.value=1,Y())}),ue(()=>n.show,c=>{c&&ke(()=>{document.querySelector("[data-search-input]")?.focus()})}),(c,o)=>c.show?(f(),_("div",xs,[i("div",ws,[i("div",_s,[i("h3",ks,[s(t(ye),{class:"h-4 w-4"}),o[8]||(o[8]=T(" Search Chat History ",-1))]),s(t(k),{onClick:o[0]||(o[0]=m=>v("close")),variant:"ghost",size:"icon",class:"h-6 w-6"},{default:d(()=>[s(t(Te),{class:"h-3 w-3"})]),_:1})]),i("div",Cs,[i("div",Ts,[s(t(ye),{class:"absolute left-2 top-1/2 h-3 w-3 -translate-y-1/2 text-muted-foreground"}),s(t($t),{modelValue:g.value,"onUpdate:modelValue":o[1]||(o[1]=m=>g.value=m),"data-search-input":"",placeholder:"Search messages...",class:"pl-7 pr-8 h-8 text-sm"},null,8,["modelValue"]),g.value?(f(),Q(t(k),{key:0,onClick:K,variant:"ghost",size:"icon",class:"absolute right-1 top-1/2 h-6 w-6 -translate-y-1/2"},{default:d(()=>[s(t(Te),{class:"h-3 w-3"})]),_:1})):U("",!0)]),i("div",Ss,[s(t(k),{onClick:o[2]||(o[2]=m=>h.value="all"),variant:h.value==="all"?"default":"outline",size:"xs",class:"h-6 px-2 text-xs"},{default:d(()=>[...o[9]||(o[9]=[T(" All ",-1)])]),_:1},8,["variant"]),s(t(k),{onClick:o[3]||(o[3]=m=>h.value="user"),variant:h.value==="user"?"default":"outline",size:"xs",class:"h-6 px-2 text-xs"},{default:d(()=>[...o[10]||(o[10]=[T(" Your Messages ",-1)])]),_:1},8,["variant"]),s(t(k),{onClick:o[4]||(o[4]=m=>h.value="ai"),variant:h.value==="ai"?"default":"outline",size:"xs",class:"h-6 px-2 text-xs"},{default:d(()=>[...o[11]||(o[11]=[T(" AI Responses ",-1)])]),_:1},8,["variant"])])])]),s(t(Ce),{class:"flex-1"},{default:d(()=>[i("div",$s,[b.value?(f(),_("div",Es,[...o[12]||(o[12]=[i("div",{class:"inline-flex items-center gap-2 text-sm text-muted-foreground"},[i("div",{class:"h-4 w-4 animate-spin rounded-full border-2 border-primary border-t-transparent"}),T(" Searching... ")],-1)])])):w.value?(f(),_("div",Ms,[i("p",Rs,E(w.value),1),s(t(k),{onClick:o[5]||(o[5]=m=>Y()),variant:"outline",size:"sm",class:"mt-2"},{default:d(()=>[...o[13]||(o[13]=[T(" Try Again ",-1)])]),_:1})])):W.value?(f(),_("div",js,[i("div",Ds,[s(t(st),{class:"h-8 w-8 text-muted-foreground/50"}),o[14]||(o[14]=i("p",{class:"text-sm text-muted-foreground"},"No messages found",-1)),o[15]||(o[15]=i("p",{class:"text-xs text-muted-foreground"},"Try a different search term",-1))])])):S.value?(f(),_("div",zs,[i("div",Ps,[i("p",As,E(r.value)+" result"+E(r.value!==1?"s":"")+" found ",1),H.value>1?(f(),_("p",Os," Page "+E(u.value)+" of "+E(H.value),1)):U("",!0)]),i("div",Ns,[(f(!0),_(be,null,xe(p.value,m=>(f(),_("div",{key:m.id,onClick:L=>N(m),class:"cursor-pointer rounded-lg border p-3 hover:bg-muted/50 transition-colors"},[i("div",Hs,[s(t(ce),{class:I([ae(m.message_type),"text-xs"])},{default:d(()=>[T(E(te(m.message_type)),1)]),_:2},1032,["class"]),i("div",Fs,[s(t(He),{class:"h-3 w-3"}),T(" "+E(se(m.timestamp)),1)])]),i("div",Ls,[i("p",{class:"text-sm leading-relaxed",innerHTML:m.highlight},null,8,Us),m.context?(f(),_("p",Ys,E(m.context),1)):U("",!0)])],8,Is))),128))]),H.value>1?(f(),_("div",Bs,[s(t(k),{onClick:o[6]||(o[6]=m=>G(u.value-1)),disabled:!O.value,variant:"outline",size:"icon",class:"h-6 w-6"},{default:d(()=>[s(t(at),{class:"h-3 w-3"})]),_:1},8,["disabled"]),i("span",Vs,E(u.value)+" / "+E(H.value),1),s(t(k),{onClick:o[7]||(o[7]=m=>G(u.value+1)),disabled:!M.value,variant:"outline",size:"icon",class:"h-6 w-6"},{default:d(()=>[s(t(ot),{class:"h-3 w-3"})]),_:1},8,["disabled"])])):U("",!0)])):g.value?U("",!0):(f(),_("div",qs,[i("div",Gs,[s(t(ye),{class:"h-8 w-8 text-muted-foreground/50"}),o[16]||(o[16]=i("p",{class:"text-sm text-muted-foreground"},"Search your chat history",-1)),o[17]||(o[17]=i("p",{class:"text-xs text-muted-foreground"},"Enter at least 2 characters to search",-1))])]))])]),_:1})])):U("",!0)}}),Ws=_e(Qs,[["__scopeId","data-v-a92378d7"]]);var ze={exports:{}},z={};/**
 * @license React
 * react.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Ge;function Xs(){if(Ge)return z;Ge=1;var F=Symbol.for("react.transitional.element"),y=Symbol.for("react.portal"),n=Symbol.for("react.fragment"),v=Symbol.for("react.strict_mode"),g=Symbol.for("react.profiler"),p=Symbol.for("react.consumer"),b=Symbol.for("react.context"),w=Symbol.for("react.forward_ref"),u=Symbol.for("react.suspense"),r=Symbol.for("react.memo"),h=Symbol.for("react.lazy"),S=Symbol.iterator;function H(e){return e===null||typeof e!="object"?null:(e=S&&e[S]||e["@@iterator"],typeof e=="function"?e:null)}var M={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},O=Object.assign,W={};function q(e,a,C){this.props=e,this.context=a,this.refs=W,this.updater=C||M}q.prototype.isReactComponent={},q.prototype.setState=function(e,a){if(typeof e!="object"&&typeof e!="function"&&e!=null)throw Error("takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,e,a,"setState")},q.prototype.forceUpdate=function(e){this.updater.enqueueForceUpdate(this,e,"forceUpdate")};function J(){}J.prototype=q.prototype;function Y(e,a,C){this.props=e,this.context=a,this.refs=W,this.updater=C||M}var K=Y.prototype=new J;K.constructor=Y,O(K,q.prototype),K.isPureReactComponent=!0;var G=Array.isArray,N={H:null,A:null,T:null,S:null,V:null},se=Object.prototype.hasOwnProperty;function te(e,a,C,$,P,A){return C=A.ref,{$$typeof:F,type:e,key:a,ref:C!==void 0?C:null,props:A}}function ae(e,a){return te(e.type,a,void 0,void 0,void 0,e.props)}function c(e){return typeof e=="object"&&e!==null&&e.$$typeof===F}function o(e){var a={"=":"=0",":":"=2"};return"$"+e.replace(/[=:]/g,function(C){return a[C]})}var m=/\/+/g;function L(e,a){return typeof e=="object"&&e!==null&&e.key!=null?o(""+e.key):a.toString(36)}function re(){}function x(e){switch(e.status){case"fulfilled":return e.value;case"rejected":throw e.reason;default:switch(typeof e.status=="string"?e.then(re,re):(e.status="pending",e.then(function(a){e.status==="pending"&&(e.status="fulfilled",e.value=a)},function(a){e.status==="pending"&&(e.status="rejected",e.reason=a)})),e.status){case"fulfilled":return e.value;case"rejected":throw e.reason}}throw e}function j(e,a,C,$,P){var A=typeof e;(A==="undefined"||A==="boolean")&&(e=null);var R=!1;if(e===null)R=!0;else switch(A){case"bigint":case"string":case"number":R=!0;break;case"object":switch(e.$$typeof){case F:case y:R=!0;break;case h:return R=e._init,j(R(e._payload),a,C,$,P)}}if(R)return P=P(e),R=$===""?"."+L(e,0):$,G(P)?(C="",R!=null&&(C=R.replace(m,"$&/")+"/"),j(P,a,C,"",function(ne){return ne})):P!=null&&(c(P)&&(P=ae(P,C+(P.key==null||e&&e.key===P.key?"":(""+P.key).replace(m,"$&/")+"/")+R)),a.push(P)),1;R=0;var X=$===""?".":$+":";if(G(e))for(var V=0;V<e.length;V++)$=e[V],A=X+L($,V),R+=j($,a,C,A,P);else if(V=H(e),typeof V=="function")for(e=V.call(e),V=0;!($=e.next()).done;)$=$.value,A=X+L($,V++),R+=j($,a,C,A,P);else if(A==="object"){if(typeof e.then=="function")return j(x(e),a,C,$,P);throw a=String(e),Error("Objects are not valid as a React child (found: "+(a==="[object Object]"?"object with keys {"+Object.keys(e).join(", ")+"}":a)+"). If you meant to render a collection of children, use an array instead.")}return R}function B(e,a,C){if(e==null)return e;var $=[],P=0;return j(e,$,"","",function(A){return a.call(C,A,P++)}),$}function ee(e){if(e._status===-1){var a=e._result;a=a(),a.then(function(C){(e._status===0||e._status===-1)&&(e._status=1,e._result=C)},function(C){(e._status===0||e._status===-1)&&(e._status=2,e._result=C)}),e._status===-1&&(e._status=0,e._result=a)}if(e._status===1)return e._result.default;throw e._result}var le=typeof reportError=="function"?reportError:function(e){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var a=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof e=="object"&&e!==null&&typeof e.message=="string"?String(e.message):String(e),error:e});if(!window.dispatchEvent(a))return}else if(typeof process=="object"&&typeof process.emit=="function"){process.emit("uncaughtException",e);return}console.error(e)};function l(){}return z.Children={map:B,forEach:function(e,a,C){B(e,function(){a.apply(this,arguments)},C)},count:function(e){var a=0;return B(e,function(){a++}),a},toArray:function(e){return B(e,function(a){return a})||[]},only:function(e){if(!c(e))throw Error("React.Children.only expected to receive a single React element child.");return e}},z.Component=q,z.Fragment=n,z.Profiler=g,z.PureComponent=Y,z.StrictMode=v,z.Suspense=u,z.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=N,z.__COMPILER_RUNTIME={__proto__:null,c:function(e){return N.H.useMemoCache(e)}},z.cache=function(e){return function(){return e.apply(null,arguments)}},z.cloneElement=function(e,a,C){if(e==null)throw Error("The argument must be a React element, but you passed "+e+".");var $=O({},e.props),P=e.key,A=void 0;if(a!=null)for(R in a.ref!==void 0&&(A=void 0),a.key!==void 0&&(P=""+a.key),a)!se.call(a,R)||R==="key"||R==="__self"||R==="__source"||R==="ref"&&a.ref===void 0||($[R]=a[R]);var R=arguments.length-2;if(R===1)$.children=C;else if(1<R){for(var X=Array(R),V=0;V<R;V++)X[V]=arguments[V+2];$.children=X}return te(e.type,P,void 0,void 0,A,$)},z.createContext=function(e){return e={$$typeof:b,_currentValue:e,_currentValue2:e,_threadCount:0,Provider:null,Consumer:null},e.Provider=e,e.Consumer={$$typeof:p,_context:e},e},z.createElement=function(e,a,C){var $,P={},A=null;if(a!=null)for($ in a.key!==void 0&&(A=""+a.key),a)se.call(a,$)&&$!=="key"&&$!=="__self"&&$!=="__source"&&(P[$]=a[$]);var R=arguments.length-2;if(R===1)P.children=C;else if(1<R){for(var X=Array(R),V=0;V<R;V++)X[V]=arguments[V+2];P.children=X}if(e&&e.defaultProps)for($ in R=e.defaultProps,R)P[$]===void 0&&(P[$]=R[$]);return te(e,A,void 0,void 0,null,P)},z.createRef=function(){return{current:null}},z.forwardRef=function(e){return{$$typeof:w,render:e}},z.isValidElement=c,z.lazy=function(e){return{$$typeof:h,_payload:{_status:-1,_result:e},_init:ee}},z.memo=function(e,a){return{$$typeof:r,type:e,compare:a===void 0?null:a}},z.startTransition=function(e){var a=N.T,C={};N.T=C;try{var $=e(),P=N.S;P!==null&&P(C,$),typeof $=="object"&&$!==null&&typeof $.then=="function"&&$.then(l,le)}catch(A){le(A)}finally{N.T=a}},z.unstable_useCacheRefresh=function(){return N.H.useCacheRefresh()},z.use=function(e){return N.H.use(e)},z.useActionState=function(e,a,C){return N.H.useActionState(e,a,C)},z.useCallback=function(e,a){return N.H.useCallback(e,a)},z.useContext=function(e){return N.H.useContext(e)},z.useDebugValue=function(){},z.useDeferredValue=function(e,a){return N.H.useDeferredValue(e,a)},z.useEffect=function(e,a,C){var $=N.H;if(typeof C=="function")throw Error("useEffect CRUD overload is not enabled in this build of React.");return $.useEffect(e,a)},z.useId=function(){return N.H.useId()},z.useImperativeHandle=function(e,a,C){return N.H.useImperativeHandle(e,a,C)},z.useInsertionEffect=function(e,a){return N.H.useInsertionEffect(e,a)},z.useLayoutEffect=function(e,a){return N.H.useLayoutEffect(e,a)},z.useMemo=function(e,a){return N.H.useMemo(e,a)},z.useOptimistic=function(e,a){return N.H.useOptimistic(e,a)},z.useReducer=function(e,a,C){return N.H.useReducer(e,a,C)},z.useRef=function(e){return N.H.useRef(e)},z.useState=function(e){return N.H.useState(e)},z.useSyncExternalStore=function(e,a,C){return N.H.useSyncExternalStore(e,a,C)},z.useTransition=function(){return N.H.useTransition()},z.version="19.1.1",z}var Qe;function nt(){return Qe||(Qe=1,ze.exports=Xs()),ze.exports}var Ks=nt();const ge=dt(Ks);var Pe={exports:{}},Z={};/**
 * @license React
 * react-dom.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var We;function Zs(){if(We)return Z;We=1;var F=nt();function y(u){var r="https://react.dev/errors/"+u;if(1<arguments.length){r+="?args[]="+encodeURIComponent(arguments[1]);for(var h=2;h<arguments.length;h++)r+="&args[]="+encodeURIComponent(arguments[h])}return"Minified React error #"+u+"; visit "+r+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function n(){}var v={d:{f:n,r:function(){throw Error(y(522))},D:n,C:n,L:n,m:n,X:n,S:n,M:n},p:0,findDOMNode:null},g=Symbol.for("react.portal");function p(u,r,h){var S=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:g,key:S==null?null:""+S,children:u,containerInfo:r,implementation:h}}var b=F.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE;function w(u,r){if(u==="font")return"";if(typeof r=="string")return r==="use-credentials"?r:""}return Z.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=v,Z.createPortal=function(u,r){var h=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!r||r.nodeType!==1&&r.nodeType!==9&&r.nodeType!==11)throw Error(y(299));return p(u,r,null,h)},Z.flushSync=function(u){var r=b.T,h=v.p;try{if(b.T=null,v.p=2,u)return u()}finally{b.T=r,v.p=h,v.d.f()}},Z.preconnect=function(u,r){typeof u=="string"&&(r?(r=r.crossOrigin,r=typeof r=="string"?r==="use-credentials"?r:"":void 0):r=null,v.d.C(u,r))},Z.prefetchDNS=function(u){typeof u=="string"&&v.d.D(u)},Z.preinit=function(u,r){if(typeof u=="string"&&r&&typeof r.as=="string"){var h=r.as,S=w(h,r.crossOrigin),H=typeof r.integrity=="string"?r.integrity:void 0,M=typeof r.fetchPriority=="string"?r.fetchPriority:void 0;h==="style"?v.d.S(u,typeof r.precedence=="string"?r.precedence:void 0,{crossOrigin:S,integrity:H,fetchPriority:M}):h==="script"&&v.d.X(u,{crossOrigin:S,integrity:H,fetchPriority:M,nonce:typeof r.nonce=="string"?r.nonce:void 0})}},Z.preinitModule=function(u,r){if(typeof u=="string")if(typeof r=="object"&&r!==null){if(r.as==null||r.as==="script"){var h=w(r.as,r.crossOrigin);v.d.M(u,{crossOrigin:h,integrity:typeof r.integrity=="string"?r.integrity:void 0,nonce:typeof r.nonce=="string"?r.nonce:void 0})}}else r==null&&v.d.M(u)},Z.preload=function(u,r){if(typeof u=="string"&&typeof r=="object"&&r!==null&&typeof r.as=="string"){var h=r.as,S=w(h,r.crossOrigin);v.d.L(u,h,{crossOrigin:S,integrity:typeof r.integrity=="string"?r.integrity:void 0,nonce:typeof r.nonce=="string"?r.nonce:void 0,type:typeof r.type=="string"?r.type:void 0,fetchPriority:typeof r.fetchPriority=="string"?r.fetchPriority:void 0,referrerPolicy:typeof r.referrerPolicy=="string"?r.referrerPolicy:void 0,imageSrcSet:typeof r.imageSrcSet=="string"?r.imageSrcSet:void 0,imageSizes:typeof r.imageSizes=="string"?r.imageSizes:void 0,media:typeof r.media=="string"?r.media:void 0})}},Z.preloadModule=function(u,r){if(typeof u=="string")if(r){var h=w(r.as,r.crossOrigin);v.d.m(u,{as:typeof r.as=="string"&&r.as!=="script"?r.as:void 0,crossOrigin:h,integrity:typeof r.integrity=="string"?r.integrity:void 0})}else v.d.m(u)},Z.requestFormReset=function(u){v.d.r(u)},Z.unstable_batchedUpdates=function(u,r){return u(r)},Z.useFormState=function(u,r,h){return b.H.useFormState(u,r,h)},Z.useFormStatus=function(){return b.H.useHostTransitionStatus()},Z.version="19.1.1",Z}var Xe;function Js(){if(Xe)return Pe.exports;Xe=1;function F(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(F)}catch(y){console.error(y)}}return F(),Pe.exports=Zs(),Pe.exports}Js();function ea(F){if(typeof document>"u")return;let y=document.head||document.getElementsByTagName("head")[0],n=document.createElement("style");n.type="text/css",y.appendChild(n),n.styleSheet?n.styleSheet.cssText=F:n.appendChild(document.createTextNode(F))}Array(12).fill(0);let Ne=1;class ta{constructor(){this.subscribe=y=>(this.subscribers.push(y),()=>{const n=this.subscribers.indexOf(y);this.subscribers.splice(n,1)}),this.publish=y=>{this.subscribers.forEach(n=>n(y))},this.addToast=y=>{this.publish(y),this.toasts=[...this.toasts,y]},this.create=y=>{var n;const{message:v,...g}=y,p=typeof y?.id=="number"||((n=y.id)==null?void 0:n.length)>0?y.id:Ne++,b=this.toasts.find(u=>u.id===p),w=y.dismissible===void 0?!0:y.dismissible;return this.dismissedToasts.has(p)&&this.dismissedToasts.delete(p),b?this.toasts=this.toasts.map(u=>u.id===p?(this.publish({...u,...y,id:p,title:v}),{...u,...y,id:p,dismissible:w,title:v}):u):this.addToast({title:v,...g,dismissible:w,id:p}),p},this.dismiss=y=>(y?(this.dismissedToasts.add(y),requestAnimationFrame(()=>this.subscribers.forEach(n=>n({id:y,dismiss:!0})))):this.toasts.forEach(n=>{this.subscribers.forEach(v=>v({id:n.id,dismiss:!0}))}),y),this.message=(y,n)=>this.create({...n,message:y}),this.error=(y,n)=>this.create({...n,message:y,type:"error"}),this.success=(y,n)=>this.create({...n,type:"success",message:y}),this.info=(y,n)=>this.create({...n,type:"info",message:y}),this.warning=(y,n)=>this.create({...n,type:"warning",message:y}),this.loading=(y,n)=>this.create({...n,type:"loading",message:y}),this.promise=(y,n)=>{if(!n)return;let v;n.loading!==void 0&&(v=this.create({...n,promise:y,type:"loading",message:n.loading,description:typeof n.description!="function"?n.description:void 0}));const g=Promise.resolve(y instanceof Function?y():y);let p=v!==void 0,b;const w=g.then(async r=>{if(b=["resolve",r],ge.isValidElement(r))p=!1,this.create({id:v,type:"default",message:r});else if(aa(r)&&!r.ok){p=!1;const S=typeof n.error=="function"?await n.error(`HTTP error! status: ${r.status}`):n.error,H=typeof n.description=="function"?await n.description(`HTTP error! status: ${r.status}`):n.description,O=typeof S=="object"&&!ge.isValidElement(S)?S:{message:S};this.create({id:v,type:"error",description:H,...O})}else if(r instanceof Error){p=!1;const S=typeof n.error=="function"?await n.error(r):n.error,H=typeof n.description=="function"?await n.description(r):n.description,O=typeof S=="object"&&!ge.isValidElement(S)?S:{message:S};this.create({id:v,type:"error",description:H,...O})}else if(n.success!==void 0){p=!1;const S=typeof n.success=="function"?await n.success(r):n.success,H=typeof n.description=="function"?await n.description(r):n.description,O=typeof S=="object"&&!ge.isValidElement(S)?S:{message:S};this.create({id:v,type:"success",description:H,...O})}}).catch(async r=>{if(b=["reject",r],n.error!==void 0){p=!1;const h=typeof n.error=="function"?await n.error(r):n.error,S=typeof n.description=="function"?await n.description(r):n.description,M=typeof h=="object"&&!ge.isValidElement(h)?h:{message:h};this.create({id:v,type:"error",description:S,...M})}}).finally(()=>{p&&(this.dismiss(v),v=void 0),n.finally==null||n.finally.call(n)}),u=()=>new Promise((r,h)=>w.then(()=>b[0]==="reject"?h(b[1]):r(b[1])).catch(h));return typeof v!="string"&&typeof v!="number"?{unwrap:u}:Object.assign(v,{unwrap:u})},this.custom=(y,n)=>{const v=n?.id||Ne++;return this.create({jsx:y(v),id:v,...n}),v},this.getActiveToasts=()=>this.toasts.filter(y=>!this.dismissedToasts.has(y.id)),this.subscribers=[],this.toasts=[],this.dismissedToasts=new Set}}const oe=new ta,sa=(F,y)=>{const n=y?.id||Ne++;return oe.addToast({title:F,...y,id:n}),n},aa=F=>F&&typeof F=="object"&&"ok"in F&&typeof F.ok=="boolean"&&"status"in F&&typeof F.status=="number",oa=sa,ra=()=>oe.toasts,na=()=>oe.getActiveToasts(),de=Object.assign(oa,{success:oe.success,info:oe.info,warning:oe.warning,error:oe.error,custom:oe.custom,message:oe.message,promise:oe.promise,dismiss:oe.dismiss,loading:oe.loading},{getHistory:ra,getToasts:na});ea("[data-sonner-toaster][dir=ltr],html[dir=ltr]{--toast-icon-margin-start:-3px;--toast-icon-margin-end:4px;--toast-svg-margin-start:-1px;--toast-svg-margin-end:0px;--toast-button-margin-start:auto;--toast-button-margin-end:0;--toast-close-button-start:0;--toast-close-button-end:unset;--toast-close-button-transform:translate(-35%, -35%)}[data-sonner-toaster][dir=rtl],html[dir=rtl]{--toast-icon-margin-start:4px;--toast-icon-margin-end:-3px;--toast-svg-margin-start:0px;--toast-svg-margin-end:-1px;--toast-button-margin-start:0;--toast-button-margin-end:auto;--toast-close-button-start:unset;--toast-close-button-end:0;--toast-close-button-transform:translate(35%, -35%)}[data-sonner-toaster]{position:fixed;width:var(--width);font-family:ui-sans-serif,system-ui,-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Helvetica Neue,Arial,Noto Sans,sans-serif,Apple Color Emoji,Segoe UI Emoji,Segoe UI Symbol,Noto Color Emoji;--gray1:hsl(0, 0%, 99%);--gray2:hsl(0, 0%, 97.3%);--gray3:hsl(0, 0%, 95.1%);--gray4:hsl(0, 0%, 93%);--gray5:hsl(0, 0%, 90.9%);--gray6:hsl(0, 0%, 88.7%);--gray7:hsl(0, 0%, 85.8%);--gray8:hsl(0, 0%, 78%);--gray9:hsl(0, 0%, 56.1%);--gray10:hsl(0, 0%, 52.3%);--gray11:hsl(0, 0%, 43.5%);--gray12:hsl(0, 0%, 9%);--border-radius:8px;box-sizing:border-box;padding:0;margin:0;list-style:none;outline:0;z-index:999999999;transition:transform .4s ease}@media (hover:none) and (pointer:coarse){[data-sonner-toaster][data-lifted=true]{transform:none}}[data-sonner-toaster][data-x-position=right]{right:var(--offset-right)}[data-sonner-toaster][data-x-position=left]{left:var(--offset-left)}[data-sonner-toaster][data-x-position=center]{left:50%;transform:translateX(-50%)}[data-sonner-toaster][data-y-position=top]{top:var(--offset-top)}[data-sonner-toaster][data-y-position=bottom]{bottom:var(--offset-bottom)}[data-sonner-toast]{--y:translateY(100%);--lift-amount:calc(var(--lift) * var(--gap));z-index:var(--z-index);position:absolute;opacity:0;transform:var(--y);touch-action:none;transition:transform .4s,opacity .4s,height .4s,box-shadow .2s;box-sizing:border-box;outline:0;overflow-wrap:anywhere}[data-sonner-toast][data-styled=true]{padding:16px;background:var(--normal-bg);border:1px solid var(--normal-border);color:var(--normal-text);border-radius:var(--border-radius);box-shadow:0 4px 12px rgba(0,0,0,.1);width:var(--width);font-size:13px;display:flex;align-items:center;gap:6px}[data-sonner-toast]:focus-visible{box-shadow:0 4px 12px rgba(0,0,0,.1),0 0 0 2px rgba(0,0,0,.2)}[data-sonner-toast][data-y-position=top]{top:0;--y:translateY(-100%);--lift:1;--lift-amount:calc(1 * var(--gap))}[data-sonner-toast][data-y-position=bottom]{bottom:0;--y:translateY(100%);--lift:-1;--lift-amount:calc(var(--lift) * var(--gap))}[data-sonner-toast][data-styled=true] [data-description]{font-weight:400;line-height:1.4;color:#3f3f3f}[data-rich-colors=true][data-sonner-toast][data-styled=true] [data-description]{color:inherit}[data-sonner-toaster][data-sonner-theme=dark] [data-description]{color:#e8e8e8}[data-sonner-toast][data-styled=true] [data-title]{font-weight:500;line-height:1.5;color:inherit}[data-sonner-toast][data-styled=true] [data-icon]{display:flex;height:16px;width:16px;position:relative;justify-content:flex-start;align-items:center;flex-shrink:0;margin-left:var(--toast-icon-margin-start);margin-right:var(--toast-icon-margin-end)}[data-sonner-toast][data-promise=true] [data-icon]>svg{opacity:0;transform:scale(.8);transform-origin:center;animation:sonner-fade-in .3s ease forwards}[data-sonner-toast][data-styled=true] [data-icon]>*{flex-shrink:0}[data-sonner-toast][data-styled=true] [data-icon] svg{margin-left:var(--toast-svg-margin-start);margin-right:var(--toast-svg-margin-end)}[data-sonner-toast][data-styled=true] [data-content]{display:flex;flex-direction:column;gap:2px}[data-sonner-toast][data-styled=true] [data-button]{border-radius:4px;padding-left:8px;padding-right:8px;height:24px;font-size:12px;color:var(--normal-bg);background:var(--normal-text);margin-left:var(--toast-button-margin-start);margin-right:var(--toast-button-margin-end);border:none;font-weight:500;cursor:pointer;outline:0;display:flex;align-items:center;flex-shrink:0;transition:opacity .4s,box-shadow .2s}[data-sonner-toast][data-styled=true] [data-button]:focus-visible{box-shadow:0 0 0 2px rgba(0,0,0,.4)}[data-sonner-toast][data-styled=true] [data-button]:first-of-type{margin-left:var(--toast-button-margin-start);margin-right:var(--toast-button-margin-end)}[data-sonner-toast][data-styled=true] [data-cancel]{color:var(--normal-text);background:rgba(0,0,0,.08)}[data-sonner-toaster][data-sonner-theme=dark] [data-sonner-toast][data-styled=true] [data-cancel]{background:rgba(255,255,255,.3)}[data-sonner-toast][data-styled=true] [data-close-button]{position:absolute;left:var(--toast-close-button-start);right:var(--toast-close-button-end);top:0;height:20px;width:20px;display:flex;justify-content:center;align-items:center;padding:0;color:var(--gray12);background:var(--normal-bg);border:1px solid var(--gray4);transform:var(--toast-close-button-transform);border-radius:50%;cursor:pointer;z-index:1;transition:opacity .1s,background .2s,border-color .2s}[data-sonner-toast][data-styled=true] [data-close-button]:focus-visible{box-shadow:0 4px 12px rgba(0,0,0,.1),0 0 0 2px rgba(0,0,0,.2)}[data-sonner-toast][data-styled=true] [data-disabled=true]{cursor:not-allowed}[data-sonner-toast][data-styled=true]:hover [data-close-button]:hover{background:var(--gray2);border-color:var(--gray5)}[data-sonner-toast][data-swiping=true]::before{content:'';position:absolute;left:-100%;right:-100%;height:100%;z-index:-1}[data-sonner-toast][data-y-position=top][data-swiping=true]::before{bottom:50%;transform:scaleY(3) translateY(50%)}[data-sonner-toast][data-y-position=bottom][data-swiping=true]::before{top:50%;transform:scaleY(3) translateY(-50%)}[data-sonner-toast][data-swiping=false][data-removed=true]::before{content:'';position:absolute;inset:0;transform:scaleY(2)}[data-sonner-toast][data-expanded=true]::after{content:'';position:absolute;left:0;height:calc(var(--gap) + 1px);bottom:100%;width:100%}[data-sonner-toast][data-mounted=true]{--y:translateY(0);opacity:1}[data-sonner-toast][data-expanded=false][data-front=false]{--scale:var(--toasts-before) * 0.05 + 1;--y:translateY(calc(var(--lift-amount) * var(--toasts-before))) scale(calc(-1 * var(--scale)));height:var(--front-toast-height)}[data-sonner-toast]>*{transition:opacity .4s}[data-sonner-toast][data-x-position=right]{right:0}[data-sonner-toast][data-x-position=left]{left:0}[data-sonner-toast][data-expanded=false][data-front=false][data-styled=true]>*{opacity:0}[data-sonner-toast][data-visible=false]{opacity:0;pointer-events:none}[data-sonner-toast][data-mounted=true][data-expanded=true]{--y:translateY(calc(var(--lift) * var(--offset)));height:var(--initial-height)}[data-sonner-toast][data-removed=true][data-front=true][data-swipe-out=false]{--y:translateY(calc(var(--lift) * -100%));opacity:0}[data-sonner-toast][data-removed=true][data-front=false][data-swipe-out=false][data-expanded=true]{--y:translateY(calc(var(--lift) * var(--offset) + var(--lift) * -100%));opacity:0}[data-sonner-toast][data-removed=true][data-front=false][data-swipe-out=false][data-expanded=false]{--y:translateY(40%);opacity:0;transition:transform .5s,opacity .2s}[data-sonner-toast][data-removed=true][data-front=false]::before{height:calc(var(--initial-height) + 20%)}[data-sonner-toast][data-swiping=true]{transform:var(--y) translateY(var(--swipe-amount-y,0)) translateX(var(--swipe-amount-x,0));transition:none}[data-sonner-toast][data-swiped=true]{user-select:none}[data-sonner-toast][data-swipe-out=true][data-y-position=bottom],[data-sonner-toast][data-swipe-out=true][data-y-position=top]{animation-duration:.2s;animation-timing-function:ease-out;animation-fill-mode:forwards}[data-sonner-toast][data-swipe-out=true][data-swipe-direction=left]{animation-name:swipe-out-left}[data-sonner-toast][data-swipe-out=true][data-swipe-direction=right]{animation-name:swipe-out-right}[data-sonner-toast][data-swipe-out=true][data-swipe-direction=up]{animation-name:swipe-out-up}[data-sonner-toast][data-swipe-out=true][data-swipe-direction=down]{animation-name:swipe-out-down}@keyframes swipe-out-left{from{transform:var(--y) translateX(var(--swipe-amount-x));opacity:1}to{transform:var(--y) translateX(calc(var(--swipe-amount-x) - 100%));opacity:0}}@keyframes swipe-out-right{from{transform:var(--y) translateX(var(--swipe-amount-x));opacity:1}to{transform:var(--y) translateX(calc(var(--swipe-amount-x) + 100%));opacity:0}}@keyframes swipe-out-up{from{transform:var(--y) translateY(var(--swipe-amount-y));opacity:1}to{transform:var(--y) translateY(calc(var(--swipe-amount-y) - 100%));opacity:0}}@keyframes swipe-out-down{from{transform:var(--y) translateY(var(--swipe-amount-y));opacity:1}to{transform:var(--y) translateY(calc(var(--swipe-amount-y) + 100%));opacity:0}}@media (max-width:600px){[data-sonner-toaster]{position:fixed;right:var(--mobile-offset-right);left:var(--mobile-offset-left);width:100%}[data-sonner-toaster][dir=rtl]{left:calc(var(--mobile-offset-left) * -1)}[data-sonner-toaster] [data-sonner-toast]{left:0;right:0;width:calc(100% - var(--mobile-offset-left) * 2)}[data-sonner-toaster][data-x-position=left]{left:var(--mobile-offset-left)}[data-sonner-toaster][data-y-position=bottom]{bottom:var(--mobile-offset-bottom)}[data-sonner-toaster][data-y-position=top]{top:var(--mobile-offset-top)}[data-sonner-toaster][data-x-position=center]{left:var(--mobile-offset-left);right:var(--mobile-offset-right);transform:none}}[data-sonner-toaster][data-sonner-theme=light]{--normal-bg:#fff;--normal-border:var(--gray4);--normal-text:var(--gray12);--success-bg:hsl(143, 85%, 96%);--success-border:hsl(145, 92%, 87%);--success-text:hsl(140, 100%, 27%);--info-bg:hsl(208, 100%, 97%);--info-border:hsl(221, 91%, 93%);--info-text:hsl(210, 92%, 45%);--warning-bg:hsl(49, 100%, 97%);--warning-border:hsl(49, 91%, 84%);--warning-text:hsl(31, 92%, 45%);--error-bg:hsl(359, 100%, 97%);--error-border:hsl(359, 100%, 94%);--error-text:hsl(360, 100%, 45%)}[data-sonner-toaster][data-sonner-theme=light] [data-sonner-toast][data-invert=true]{--normal-bg:#000;--normal-border:hsl(0, 0%, 20%);--normal-text:var(--gray1)}[data-sonner-toaster][data-sonner-theme=dark] [data-sonner-toast][data-invert=true]{--normal-bg:#fff;--normal-border:var(--gray3);--normal-text:var(--gray12)}[data-sonner-toaster][data-sonner-theme=dark]{--normal-bg:#000;--normal-bg-hover:hsl(0, 0%, 12%);--normal-border:hsl(0, 0%, 20%);--normal-border-hover:hsl(0, 0%, 25%);--normal-text:var(--gray1);--success-bg:hsl(150, 100%, 6%);--success-border:hsl(147, 100%, 12%);--success-text:hsl(150, 86%, 65%);--info-bg:hsl(215, 100%, 6%);--info-border:hsl(223, 43%, 17%);--info-text:hsl(216, 87%, 65%);--warning-bg:hsl(64, 100%, 6%);--warning-border:hsl(60, 100%, 9%);--warning-text:hsl(46, 87%, 65%);--error-bg:hsl(358, 76%, 10%);--error-border:hsl(357, 89%, 16%);--error-text:hsl(358, 100%, 81%)}[data-sonner-toaster][data-sonner-theme=dark] [data-sonner-toast] [data-close-button]{background:var(--normal-bg);border-color:var(--normal-border);color:var(--normal-text)}[data-sonner-toaster][data-sonner-theme=dark] [data-sonner-toast] [data-close-button]:hover{background:var(--normal-bg-hover);border-color:var(--normal-border-hover)}[data-rich-colors=true][data-sonner-toast][data-type=success]{background:var(--success-bg);border-color:var(--success-border);color:var(--success-text)}[data-rich-colors=true][data-sonner-toast][data-type=success] [data-close-button]{background:var(--success-bg);border-color:var(--success-border);color:var(--success-text)}[data-rich-colors=true][data-sonner-toast][data-type=info]{background:var(--info-bg);border-color:var(--info-border);color:var(--info-text)}[data-rich-colors=true][data-sonner-toast][data-type=info] [data-close-button]{background:var(--info-bg);border-color:var(--info-border);color:var(--info-text)}[data-rich-colors=true][data-sonner-toast][data-type=warning]{background:var(--warning-bg);border-color:var(--warning-border);color:var(--warning-text)}[data-rich-colors=true][data-sonner-toast][data-type=warning] [data-close-button]{background:var(--warning-bg);border-color:var(--warning-border);color:var(--warning-text)}[data-rich-colors=true][data-sonner-toast][data-type=error]{background:var(--error-bg);border-color:var(--error-border);color:var(--error-text)}[data-rich-colors=true][data-sonner-toast][data-type=error] [data-close-button]{background:var(--error-bg);border-color:var(--error-border);color:var(--error-text)}.sonner-loading-wrapper{--size:16px;height:var(--size);width:var(--size);position:absolute;inset:0;z-index:10}.sonner-loading-wrapper[data-visible=false]{transform-origin:center;animation:sonner-fade-out .2s ease forwards}.sonner-spinner{position:relative;top:50%;left:50%;height:var(--size);width:var(--size)}.sonner-loading-bar{animation:sonner-spin 1.2s linear infinite;background:var(--gray11);border-radius:6px;height:8%;left:-10%;position:absolute;top:-3.9%;width:24%}.sonner-loading-bar:first-child{animation-delay:-1.2s;transform:rotate(.0001deg) translate(146%)}.sonner-loading-bar:nth-child(2){animation-delay:-1.1s;transform:rotate(30deg) translate(146%)}.sonner-loading-bar:nth-child(3){animation-delay:-1s;transform:rotate(60deg) translate(146%)}.sonner-loading-bar:nth-child(4){animation-delay:-.9s;transform:rotate(90deg) translate(146%)}.sonner-loading-bar:nth-child(5){animation-delay:-.8s;transform:rotate(120deg) translate(146%)}.sonner-loading-bar:nth-child(6){animation-delay:-.7s;transform:rotate(150deg) translate(146%)}.sonner-loading-bar:nth-child(7){animation-delay:-.6s;transform:rotate(180deg) translate(146%)}.sonner-loading-bar:nth-child(8){animation-delay:-.5s;transform:rotate(210deg) translate(146%)}.sonner-loading-bar:nth-child(9){animation-delay:-.4s;transform:rotate(240deg) translate(146%)}.sonner-loading-bar:nth-child(10){animation-delay:-.3s;transform:rotate(270deg) translate(146%)}.sonner-loading-bar:nth-child(11){animation-delay:-.2s;transform:rotate(300deg) translate(146%)}.sonner-loading-bar:nth-child(12){animation-delay:-.1s;transform:rotate(330deg) translate(146%)}@keyframes sonner-fade-in{0%{opacity:0;transform:scale(.8)}100%{opacity:1;transform:scale(1)}}@keyframes sonner-fade-out{0%{opacity:1;transform:scale(1)}100%{opacity:0;transform:scale(.8)}}@keyframes sonner-spin{0%{opacity:1}100%{opacity:.15}}@media (prefers-reduced-motion){.sonner-loading-bar,[data-sonner-toast],[data-sonner-toast]>*{transition:none!important;animation:none!important}}.sonner-loader{position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);transform-origin:center;transition:opacity .2s,transform .2s}.sonner-loader[data-visible=false]{opacity:0;transform:scale(.8) translate(-50%,-50%)}");const ia={class:"chat-history"},la={class:"flex items-center justify-between mb-4"},da={class:"flex items-center gap-2"},ua={class:"flex items-center gap-2"},ca={key:0,class:"flex items-center justify-center py-8"},fa={key:1,class:"text-center py-8"},pa={class:"text-muted-foreground"},ma={key:2,class:"space-y-4"},va={class:"flex items-center justify-between p-4 border-b bg-muted/30"},ga={class:"flex-1"},ha={class:"font-medium text-sm truncate"},ya={class:"flex items-center gap-4 text-xs text-muted-foreground mt-1"},ba={class:"flex items-center gap-2"},xa={key:0,class:"p-4 space-y-3 max-h-96 overflow-y-auto"},wa={class:"flex items-center justify-between mt-2 pt-2 border-t border-current/20"},_a={class:"text-xs opacity-70"},ka={key:3,class:"flex items-center justify-between mt-6"},Ca={class:"text-sm text-muted-foreground"},Ta={key:1,class:"animate-spin rounded-full h-4 w-4 border-b-2 border-current mr-2"},Sa={key:1,class:"animate-spin rounded-full h-4 w-4 border-b-2 border-current mr-2"},$a={key:1,class:"animate-spin rounded-full h-4 w-4 border-b-2 border-current mr-2"},Ea=me({__name:"ChatHistory",props:{projectSlug:{},chapterNumber:{}},emits:["chat-deleted","chat-cleared"],setup(F,{emit:y}){const n=F,v=y,g=D([]),p=D(!1),b=D(!1),w=D(1),u=D(1),r=D(0),h=ut(new Set),S=D(!1),H=D(!1),M=D(!1),O=D(null),W=D(null),q=async(c=1)=>{p.value=!0;try{const m=await(await fetch(`/projects/${n.projectSlug}/chapters/${n.chapterNumber}/chat/sessions?page=${c}&per_page=10`)).json();if(m.success)g.value=m.sessions,w.value=m.page,u.value=m.total_pages,r.value=m.total_sessions;else throw new Error(m.error||"Failed to load chat history")}catch(o){console.error("Failed to load chat history:",o),de.error("Failed to load chat history")}finally{p.value=!1}},J=c=>{c>=1&&c<=u.value&&q(c)},Y=()=>{q(w.value)},K=c=>{h.has(c)?h.delete(c):h.add(c)},G=c=>{O.value=c,S.value=!0},N=(c,o)=>{W.value=c,O.value=o,H.value=!0},se=async()=>{if(O.value){b.value=!0;try{const o=await(await fetch(`/projects/${n.projectSlug}/chapters/${n.chapterNumber}/chat/sessions/${O.value.session_id}`,{method:"DELETE",headers:{"X-CSRF-TOKEN":document.querySelector('meta[name="csrf-token"]')?.getAttribute("content")||"",Accept:"application/json"}})).json();if(o.success)de.success(o.message),S.value=!1,O.value=null,v("chat-deleted"),q(w.value);else throw new Error(o.error||"Failed to delete session")}catch(c){console.error("Failed to delete session:",c),de.error("Failed to delete chat session")}finally{b.value=!1}}},te=async()=>{if(W.value){b.value=!0;try{const o=await(await fetch(`/projects/${n.projectSlug}/chapters/${n.chapterNumber}/chat/messages/${W.value.id}`,{method:"DELETE",headers:{"X-CSRF-TOKEN":document.querySelector('meta[name="csrf-token"]')?.getAttribute("content")||"",Accept:"application/json"}})).json();if(o.success)de.success(o.message),H.value=!1,W.value=null,q(w.value);else throw new Error(o.error||"Failed to delete message")}catch(c){console.error("Failed to delete message:",c),de.error("Failed to delete message")}finally{b.value=!1}}},ae=async()=>{b.value=!0;try{const o=await(await fetch(`/projects/${n.projectSlug}/chapters/${n.chapterNumber}/chat/clear`,{method:"DELETE",headers:{"X-CSRF-TOKEN":document.querySelector('meta[name="csrf-token"]')?.getAttribute("content")||"",Accept:"application/json"}})).json();if(o.success)de.success(o.message),M.value=!1,v("chat-cleared"),g.value=[],r.value=0,u.value=1,w.value=1,h.clear();else throw new Error(o.error||"Failed to clear history")}catch(c){console.error("Failed to clear history:",c),de.error("Failed to clear chat history")}finally{b.value=!1}};return Ie(()=>{q()}),(c,o)=>(f(),_("div",ia,[i("div",la,[i("div",da,[s(t(He),{class:"h-5 w-5 text-muted-foreground"}),o[9]||(o[9]=i("h3",{class:"text-lg font-semibold"},"Chat History",-1))]),i("div",ua,[s(t(k),{variant:"outline",size:"sm",onClick:Y,disabled:p.value},{default:d(()=>[s(t(Je),{class:"h-4 w-4"}),o[10]||(o[10]=T(" Refresh ",-1))]),_:1},8,["disabled"]),s(t(k),{variant:"destructive",size:"sm",onClick:o[0]||(o[0]=m=>M.value=!0),disabled:g.value.length===0||p.value},{default:d(()=>[s(t(fe),{class:"h-4 w-4"}),o[11]||(o[11]=T(" Clear All ",-1))]),_:1},8,["disabled"])])]),p.value?(f(),_("div",ca,[...o[12]||(o[12]=[i("div",{class:"flex items-center gap-2 text-muted-foreground"},[i("div",{class:"animate-spin rounded-full h-4 w-4 border-b-2 border-current"}),T(" Loading chat history... ")],-1)])])):g.value.length===0?(f(),_("div",fa,[i("div",pa,[s(t(qt),{class:"h-12 w-12 mx-auto mb-2 opacity-50"}),o[13]||(o[13]=i("p",{class:"text-lg"},"No chat history yet",-1)),o[14]||(o[14]=i("p",{class:"text-sm"},"Start a conversation to see your chat history here.",-1))])])):(f(),_("div",ma,[(f(!0),_(be,null,xe(g.value,m=>(f(),_("div",{key:m.session_id,class:"border rounded-lg"},[i("div",va,[i("div",ga,[i("div",ha,[s(we,{content:m.title,class:"prose prose-sm max-w-none prose-headings:text-sm prose-headings:m-0 prose-p:m-0 prose-p:text-sm"},null,8,["content"])]),i("div",ya,[i("span",null,E(m.started_at),1),i("span",null,E(m.message_count)+" messages",1),i("span",null,E(m.duration),1)])]),i("div",ba,[s(t(k),{variant:"ghost",size:"sm",onClick:L=>K(m.session_id)},{default:d(()=>[s(t(Et),{class:I(["h-4 w-4 transition-transform",{"rotate-180":h.has(m.session_id)}])},null,8,["class"])]),_:2},1032,["onClick"]),s(t(k),{variant:"ghost",size:"sm",onClick:L=>G(m)},{default:d(()=>[s(t(fe),{class:"h-4 w-4 text-destructive"})]),_:2},1032,["onClick"])])]),h.has(m.session_id)?(f(),_("div",xa,[(f(!0),_(be,null,xe(m.messages,L=>(f(),_("div",{key:L.id,class:I(["flex gap-3 group",L.message_type==="user"?"justify-end":"justify-start"])},[i("div",{class:I(["max-w-[80%] rounded-lg p-3 text-sm",L.message_type==="user"?"bg-primary text-primary-foreground":"bg-muted"])},[s(we,{content:L.content,class:I(["prose prose-sm max-w-none",L.message_type==="user"?"chat-message-user prose-invert":"chat-message-ai"])},null,8,["content","class"]),i("div",wa,[i("div",_a,E(L.formatted_time),1),s(t(k),{variant:"ghost",size:"sm",class:"opacity-0 group-hover:opacity-100 transition-opacity h-6 w-6 p-0",onClick:re=>N(L,m)},{default:d(()=>[s(t(fe),{class:"h-3 w-3"})]),_:2},1032,["onClick"])])],2)],2))),128))])):U("",!0)]))),128))])),u.value>1?(f(),_("div",ka,[s(t(k),{variant:"outline",size:"sm",onClick:o[1]||(o[1]=m=>J(w.value-1)),disabled:w.value===1||p.value},{default:d(()=>[s(t(at),{class:"h-4 w-4"}),o[15]||(o[15]=T(" Previous ",-1))]),_:1},8,["disabled"]),i("span",Ca," Page "+E(w.value)+" of "+E(u.value),1),s(t(k),{variant:"outline",size:"sm",onClick:o[2]||(o[2]=m=>J(w.value+1)),disabled:w.value===u.value||p.value},{default:d(()=>[o[16]||(o[16]=T(" Next ",-1)),s(t(ot),{class:"h-4 w-4"})]),_:1},8,["disabled"])])):U("",!0),s(t($e),{open:S.value,"onUpdate:open":o[4]||(o[4]=m=>S.value=m)},{default:d(()=>[s(t(Ee),null,{default:d(()=>[s(t(Me),null,{default:d(()=>[s(t(Re),null,{default:d(()=>[...o[17]||(o[17]=[T("Delete Chat Session",-1)])]),_:1}),s(t(je),null,{default:d(()=>[T(" Are you sure you want to delete this chat session? This will permanently remove "+E(O.value?.message_count)+" messages. This action cannot be undone. ",1)]),_:1})]),_:1}),s(t(De),null,{default:d(()=>[s(t(k),{variant:"outline",onClick:o[3]||(o[3]=m=>S.value=!1)},{default:d(()=>[...o[18]||(o[18]=[T(" Cancel ",-1)])]),_:1}),s(t(k),{variant:"destructive",onClick:se,disabled:b.value},{default:d(()=>[b.value?(f(),_("div",Ta)):(f(),Q(t(fe),{key:0,class:"h-4 w-4 mr-2"})),T(" "+E(b.value?"Deleting...":"Delete Session"),1)]),_:1},8,["disabled"])]),_:1})]),_:1})]),_:1},8,["open"]),s(t($e),{open:H.value,"onUpdate:open":o[6]||(o[6]=m=>H.value=m)},{default:d(()=>[s(t(Ee),null,{default:d(()=>[s(t(Me),null,{default:d(()=>[s(t(Re),null,{default:d(()=>[...o[19]||(o[19]=[T("Delete Message",-1)])]),_:1}),s(t(je),null,{default:d(()=>[...o[20]||(o[20]=[T(" Are you sure you want to delete this message? This action cannot be undone. ",-1)])]),_:1})]),_:1}),s(t(De),null,{default:d(()=>[s(t(k),{variant:"outline",onClick:o[5]||(o[5]=m=>H.value=!1)},{default:d(()=>[...o[21]||(o[21]=[T(" Cancel ",-1)])]),_:1}),s(t(k),{variant:"destructive",onClick:te,disabled:b.value},{default:d(()=>[b.value?(f(),_("div",Sa)):(f(),Q(t(fe),{key:0,class:"h-4 w-4 mr-2"})),T(" "+E(b.value?"Deleting...":"Delete Message"),1)]),_:1},8,["disabled"])]),_:1})]),_:1})]),_:1},8,["open"]),s(t($e),{open:M.value,"onUpdate:open":o[8]||(o[8]=m=>M.value=m)},{default:d(()=>[s(t(Ee),null,{default:d(()=>[s(t(Me),null,{default:d(()=>[s(t(Re),null,{default:d(()=>[...o[22]||(o[22]=[T("Clear All Chat History",-1)])]),_:1}),s(t(je),null,{default:d(()=>[T(" Are you sure you want to clear all chat history for this chapter? This will permanently delete all "+E(g.value.reduce((m,L)=>m+L.message_count,0))+" messages across "+E(g.value.length)+" sessions. This action cannot be undone. ",1)]),_:1})]),_:1}),s(t(De),null,{default:d(()=>[s(t(k),{variant:"outline",onClick:o[7]||(o[7]=m=>M.value=!1)},{default:d(()=>[...o[23]||(o[23]=[T(" Cancel ",-1)])]),_:1}),s(t(k),{variant:"destructive",onClick:ae,disabled:b.value},{default:d(()=>[b.value?(f(),_("div",$a)):(f(),Q(t(fe),{key:0,class:"h-4 w-4 mr-2"})),T(" "+E(b.value?"Clearing...":"Clear All History"),1)]),_:1},8,["disabled"])]),_:1})]),_:1})]),_:1},8,["open"])]))}}),Ma=_e(Ea,[["__scopeId","data-v-aca492d0"]]),Ra={class:"flex items-center gap-2"},ja={key:0,class:"flex rounded-md border bg-background p-0.5"},Da={class:"flex items-center gap-1"},za={key:0,class:"flex flex-1 flex-col items-center justify-center space-y-2 p-2"},Pa={key:1,class:"relative flex-1 overflow-hidden"},Aa={key:"search",class:"absolute inset-0 bg-background"},Oa={key:"history",class:"absolute inset-0 bg-background overflow-y-auto"},Na={class:"p-4"},Ia={key:"chat",class:"flex flex-col h-full"},Ha={class:"flex-shrink-0 border-b bg-gradient-to-r from-green-50 to-blue-50 p-2 dark:from-green-950/20 dark:to-blue-950/20"},Fa={class:"flex items-start gap-2"},La={class:"min-w-0 flex-1"},Ua={class:"text-xs text-green-600 dark:text-green-400"},Ya={key:0,class:"flex-shrink-0 border-b bg-blue-50 p-2 dark:bg-blue-950/20"},Ba={class:"flex items-start gap-2"},Va={class:"min-w-0 flex-1"},qa={class:"truncate text-xs text-blue-600 dark:text-blue-400"},Ga={key:0,class:"flex-shrink-0 border-b bg-orange-50 p-3 dark:bg-orange-950/20"},Qa={class:"min-h-full space-y-4 p-3"},Wa={key:0,class:"flex max-w-[85%] gap-2"},Xa={class:"flex-1"},Ka={key:1,class:"flex items-center gap-2 py-2"},Za={key:2,class:"mt-2 flex items-center justify-between border-t border-border/50 pt-2"},Ja={class:"flex items-center gap-1"},eo={key:3,class:"text-green-600"},to={key:4},so={key:5},ao={class:"mt-1 px-1 text-xs text-muted-foreground"},oo={key:1,class:"flex max-w-[85%] gap-2"},ro={class:"flex-1 text-right"},no={class:"inline-block rounded-lg bg-primary p-3 text-sm text-primary-foreground"},io={class:"mt-1 px-1 text-xs text-muted-foreground"},lo={class:"mt-1 flex h-6 w-6 flex-shrink-0 items-center justify-center rounded-full bg-primary"},uo={key:0,class:"flex gap-2"},co={class:"flex h-6 w-6 flex-shrink-0 items-center justify-center rounded-full bg-gradient-to-br from-blue-500 to-purple-600"},fo={class:"flex-shrink-0 border-t bg-background p-3"},po={class:"relative"},mo={class:"absolute right-2 top-1/2 -translate-y-1/2"},vo={class:"mt-2 flex items-center justify-between text-xs text-muted-foreground"},go={key:0},ho={key:1,class:"flex items-center gap-1"},yo={class:"flex items-center gap-2"},bo=me({__name:"ChatAssistant",props:{isMinimized:{type:Boolean},messages:{},isTyping:{type:Boolean},selectedText:{},chapterContent:{},chapterNumber:{},input:{},currentMode:{default:"assist"},projectSlug:{},sessionId:{},isMobile:{type:Boolean,default:!1}},emits:["update:input","send-message","quick-action","retry-message","stop-generation","toggle-minimize","change-mode","copy-message","rate-message","new-session","chat-deleted","chat-cleared"],setup(F,{emit:y}){const n=F,v=y,g=D(),p=D(),b=D(!1),w=D(!1),u=D(!1),r=D([]),h=ie(()=>n.selectedText.trim().length>0),S=ie(()=>n.messages.length),H=ie(()=>n.messages.reduce((l,e)=>l+e.content.length,0)),M=()=>{ke(()=>{setTimeout(()=>{try{const l=g.value;if(!l)return;const e=l.$el||l;if(!e)return;let a=e.querySelector("[data-radix-scroll-area-viewport]");if(a||(a=e.querySelector("[data-viewport]")),a||(a=e.querySelector('[role="region"]')),a||(a=e.querySelector('div[style*="overflow"]')),!a){const C=e.querySelectorAll("div");for(const $ of C){const P=window.getComputedStyle($);if(P.overflow==="auto"||P.overflow==="scroll"||P.overflowY==="auto"||P.overflowY==="scroll"){a=$;break}}}a?(console.log("Scrolling chat to bottom:",{scrollHeight:a.scrollHeight,clientHeight:a.clientHeight,currentScrollTop:a.scrollTop}),a.scrollTop=a.scrollHeight,a.scrollTo&&a.scrollTo({top:a.scrollHeight,behavior:"auto"})):(console.warn("Could not find scrollable viewport in ScrollArea"),console.log("ScrollArea element structure:",e))}catch(l){console.warn("Chat scroll to bottom failed:",l)}},100)})};ue(S,()=>{M()},{flush:"post"}),ue(H,()=>{n.messages.some(e=>e.isStreaming)&&W()},{flush:"post"});let O=null;const W=()=>{O&&clearTimeout(O),O=setTimeout(()=>{M()},50)};Ie(()=>{setTimeout(()=>{M()},300)});const q=()=>{n.input.trim()&&(v("send-message"),setTimeout(()=>{M()},100),ke(()=>{try{p.value&&p.value.$el?p.value.$el.focus():p.value&&p.value.focus&&p.value.focus()}catch(l){console.warn("Focus failed:",l)}}))},J=l=>{l.key==="Enter"&&!l.shiftKey&&(l.preventDefault(),q())},Y=l=>{v("quick-action",l)},K=l=>l.toLocaleTimeString("en-US",{hour:"2-digit",minute:"2-digit",hour12:!1}),G=D(null),N=async l=>{try{const e=document.createElement("div");e.innerHTML=l.content;const a=e.textContent||e.innerText||l.content;await navigator.clipboard.writeText(a),v("copy-message",l),G.value=l.id,setTimeout(()=>{G.value=null},1500)}catch(e){console.error("Failed to copy message:",e),G.value=-1,setTimeout(()=>{G.value=null},1500)}},se=()=>{h.value&&v("update:input",`Can you help me improve this text: "${n.selectedText}"`)},te=()=>{b.value=!b.value,b.value&&(w.value=!1,u.value=!1)},ae=()=>{w.value=!w.value,w.value&&(b.value=!1,u.value=!1)},c=()=>{u.value=!u.value,u.value&&(b.value=!1,w.value=!1)},o=l=>{r.value.unshift(l),console.log("File uploaded and will be included in chat context:",l)},m=l=>{r.value=r.value.filter(e=>e.id!==l)},L=l=>{r.value=l},re=(l,e)=>{console.log("Navigate to message:",l,"in session:",e),w.value=!1},x=()=>{v("new-session")},j=()=>{v("chat-deleted")},B=()=>{v("chat-cleared")},ee=l=>{v("retry-message",l)},le=()=>{v("stop-generation")};return(l,e)=>(f(),_("div",{class:I(["flex h-full flex-col bg-background",l.isMobile?"border-0":"border-l"])},[i("div",{class:I(["flex flex-shrink-0 items-center justify-between border-b bg-muted/30",l.isMobile?"p-3":"p-2"])},[i("div",Ra,[l.isMinimized?U("",!0):(f(),_("div",ja,[s(t(k),{onClick:e[0]||(e[0]=a=>v("change-mode","assist")),variant:l.currentMode==="assist"?"secondary":"ghost",size:"sm",class:"h-7 px-2 text-xs gap-1.5"},{default:d(()=>[s(t(Oe),{class:"h-3.5 w-3.5"}),e[15]||(e[15]=T(" Assist ",-1))]),_:1},8,["variant"]),s(t(k),{onClick:e[1]||(e[1]=a=>v("change-mode","review")),variant:l.currentMode==="review"?"secondary":"ghost",size:"sm",class:"h-7 px-2 text-xs gap-1.5"},{default:d(()=>[s(t(ye),{class:"h-3.5 w-3.5"}),e[16]||(e[16]=T(" Review ",-1))]),_:1},8,["variant"])]))]),i("div",Da,[s(t(k),{onClick:x,variant:"ghost",size:"icon",class:"h-8 w-8",title:"New Session"},{default:d(()=>[s(t(Be),{class:"h-4 w-4"})]),_:1}),e[17]||(e[17]=i("div",{class:"h-4 w-px bg-border mx-1"},null,-1)),s(t(k),{onClick:ae,variant:"ghost",size:"icon",class:I(["h-8 w-8",{"bg-muted":w.value}]),title:"Search"},{default:d(()=>[s(t(ye),{class:"h-4 w-4"})]),_:1},8,["class"]),s(t(k),{onClick:c,variant:"ghost",size:"icon",class:I(["h-8 w-8",{"bg-muted":u.value}]),title:"History"},{default:d(()=>[s(t(He),{class:"h-4 w-4"})]),_:1},8,["class"]),s(t(k),{onClick:te,variant:"ghost",size:"icon",class:I(["h-8 w-8",{"bg-muted":b.value}]),title:"Upload Context"},{default:d(()=>[s(t(tt),{class:"h-4 w-4"})]),_:1},8,["class"]),l.isMobile?U("",!0):(f(),Q(t(k),{key:0,onClick:e[2]||(e[2]=a=>v("toggle-minimize")),variant:"ghost",size:"icon",class:"h-8 w-8"},{default:d(()=>[l.isMinimized?(f(),Q(t(Rt),{key:1,class:"h-4 w-4"})):(f(),Q(t(Mt),{key:0,class:"h-4 w-4"}))]),_:1})),l.isMobile?(f(),Q(t(k),{key:1,onClick:e[3]||(e[3]=a=>v("toggle-minimize")),variant:"ghost",size:"icon",class:"h-8 w-8"},{default:d(()=>[s(t(Te),{class:"h-4 w-4"})]),_:1})):U("",!0)])],2),l.isMinimized?(f(),_("div",za,[s(t(k),{onClick:e[4]||(e[4]=a=>v("toggle-minimize")),variant:"ghost",size:"icon",class:"h-12 w-12 rounded-full"},{default:d(()=>[s(t(st),{class:"h-6 w-6"})]),_:1}),e[18]||(e[18]=i("p",{class:"-rotate-90 transform text-center text-xs whitespace-nowrap text-muted-foreground"},"Chat",-1))])):(f(),_("div",Pa,[s(ve,{name:"slide-left",mode:"out-in",appear:""},{default:d(()=>[w.value?(f(),_("div",Aa,[s(Ws,{"project-slug":l.projectSlug,"chapter-number":l.chapterNumber,show:w.value,onClose:e[5]||(e[5]=a=>w.value=!1),onMessageSelected:re},null,8,["project-slug","chapter-number","show"])])):U("",!0)]),_:1}),s(ve,{name:"slide-right",mode:"out-in",appear:""},{default:d(()=>[u.value?(f(),_("div",Oa,[i("div",Na,[s(Ma,{"project-slug":l.projectSlug,"chapter-number":l.chapterNumber,onChatDeleted:j,onChatCleared:B},null,8,["project-slug","chapter-number"])])])):U("",!0)]),_:1}),s(ve,{name:"slide-up",mode:"out-in",appear:""},{default:d(()=>[!w.value&&!u.value&&!b.value?(f(),_("div",Ia,[i("div",{class:I(["flex-shrink-0 border-b bg-muted/20",l.isMobile?"p-2":"p-1.5"])},[l.currentMode==="review"?(f(),_("div",{key:0,class:I(["flex flex-wrap gap-1",l.isMobile?"justify-center":"justify-start"])},[s(t(k),{onClick:e[6]||(e[6]=a=>Y("overall-review")),size:"sm",variant:"ghost",class:I(l.isMobile?"h-9 px-3 text-xs":"h-7 px-2.5 text-xs")},{default:d(()=>[s(t(jt),{class:I(l.isMobile?"mr-1.5 h-3.5 w-3.5":"mr-1 h-3 w-3")},null,8,["class"]),e[19]||(e[19]=T(" Overall Review ",-1))]),_:1},8,["class"]),s(t(k),{onClick:e[7]||(e[7]=a=>Y("test-knowledge")),size:"sm",variant:"ghost",class:I(l.isMobile?"h-9 px-3 text-xs":"h-7 px-2.5 text-xs")},{default:d(()=>[s(t(Dt),{class:I(l.isMobile?"mr-1.5 h-3.5 w-3.5":"mr-1 h-3 w-3")},null,8,["class"]),e[20]||(e[20]=T(" Test Knowledge ",-1))]),_:1},8,["class"]),s(t(k),{onClick:e[8]||(e[8]=a=>Y("find-weaknesses")),size:"sm",variant:"ghost",class:I(l.isMobile?"h-9 px-3 text-xs":"h-7 px-2.5 text-xs")},{default:d(()=>[s(t(At),{class:I(l.isMobile?"mr-1.5 h-3.5 w-3.5":"mr-1 h-3 w-3")},null,8,["class"]),e[21]||(e[21]=T(" Find Weaknesses ",-1))]),_:1},8,["class"]),s(t(k),{onClick:e[9]||(e[9]=a=>Y("citation-check")),size:"sm",variant:"ghost",class:I(l.isMobile?"h-9 px-3 text-xs":"h-7 px-2.5 text-xs")},{default:d(()=>[s(t(kt),{class:I(l.isMobile?"mr-1.5 h-3.5 w-3.5":"mr-1 h-3 w-3")},null,8,["class"]),e[22]||(e[22]=T(" Check Citations ",-1))]),_:1},8,["class"]),s(t(k),{onClick:e[10]||(e[10]=a=>Y("structure-review")),size:"sm",variant:"ghost",class:I(l.isMobile?"h-9 px-3 text-xs":"h-7 px-2.5 text-xs")},{default:d(()=>[s(t(Vt),{class:I(l.isMobile?"mr-1.5 h-3.5 w-3.5":"mr-1 h-3 w-3")},null,8,["class"]),e[23]||(e[23]=T(" Review Structure ",-1))]),_:1},8,["class"])],2)):(f(),_("div",{key:1,class:I(["flex flex-wrap gap-1",l.isMobile?"justify-center":"justify-start"])},[s(t(k),{onClick:e[11]||(e[11]=a=>Y("improve-writing")),size:"sm",variant:"ghost",class:I(l.isMobile?"h-9 px-3 text-xs":"h-7 px-2.5 text-xs")},{default:d(()=>[s(t(Oe),{class:I(l.isMobile?"mr-1.5 h-3.5 w-3.5":"mr-1 h-3 w-3")},null,8,["class"]),e[24]||(e[24]=T(" Improve Writing ",-1))]),_:1},8,["class"]),s(t(k),{onClick:e[12]||(e[12]=a=>Y("expand-section")),size:"sm",variant:"ghost",class:I(l.isMobile?"h-9 px-3 text-xs":"h-7 px-2.5 text-xs")},{default:d(()=>[s(t(Ot),{class:I(l.isMobile?"mr-1.5 h-3.5 w-3.5":"mr-1 h-3 w-3")},null,8,["class"]),e[25]||(e[25]=T(" Expand Section ",-1))]),_:1},8,["class"]),s(t(k),{onClick:e[13]||(e[13]=a=>Y("fix-grammar")),size:"sm",variant:"ghost",class:I(l.isMobile?"h-9 px-3 text-xs":"h-7 px-2.5 text-xs")},{default:d(()=>[s(t(Nt),{class:I(l.isMobile?"mr-1.5 h-3.5 w-3.5":"mr-1 h-3 w-3")},null,8,["class"]),e[26]||(e[26]=T(" Fix Grammar ",-1))]),_:1},8,["class"])],2))],2),i("div",Ha,[i("div",Fa,[s(t(Ht),{class:"mt-0.5 h-4 w-4 flex-shrink-0 text-green-600 dark:text-green-400"}),i("div",La,[e[27]||(e[27]=i("p",{class:"text-xs font-medium text-green-700 dark:text-green-300"},"AI Context:",-1)),i("p",Ua," I can see your full chapter content ("+E(Math.round(l.chapterContent.length/1e3))+"k chars) and will provide specific advice ",1)])])]),h.value?(f(),_("div",Ya,[i("div",Ba,[s(t(Ft),{class:"mt-0.5 h-4 w-4 flex-shrink-0 text-blue-500"}),i("div",Va,[e[28]||(e[28]=i("p",{class:"text-xs font-medium text-blue-700 dark:text-blue-300"},"Selected text:",-1)),i("p",qa,' "'+E(l.selectedText.substring(0,60))+E(l.selectedText.length>60?"...":"")+'" ',1)]),s(t(k),{onClick:se,size:"sm",variant:"outline",class:"h-6 px-2 text-xs"},{default:d(()=>[...e[29]||(e[29]=[T(" Help ",-1)])]),_:1})])])):U("",!0),s(ve,{name:"slide-down",appear:""},{default:d(()=>[b.value?(f(),_("div",Ga,[s(bs,{"project-slug":l.projectSlug,"chapter-number":l.chapterNumber,"session-id":l.sessionId,disabled:l.isTyping,onFileUploaded:o,onFileDeleted:m,onFilesLoaded:L},null,8,["project-slug","chapter-number","session-id","disabled"])])):U("",!0)]),_:1}),s(t(Ce),{ref_key:"scrollContainer",ref:g,class:"min-h-0 flex-1"},{default:d(()=>[i("div",Qa,[s(ct,{name:"message-list",tag:"div",class:"space-y-4"},{default:d(()=>[(f(!0),_(be,null,xe(l.messages,a=>(f(),_("div",{key:a.id,class:I(["flex gap-3",a.type==="user"?"justify-end":"justify-start"])},[a.type!=="user"?(f(),_("div",Wa,[i("div",{class:I(["mt-1 flex h-6 w-6 flex-shrink-0 items-center justify-center rounded-full",a.type==="ai"?"bg-gradient-to-br from-blue-500 to-purple-600":"bg-orange-500"])},[a.type==="ai"?(f(),Q(t(Ve),{key:0,class:"h-3 w-3 text-white"})):(f(),Q(t(Ae),{key:1,class:"h-3 w-3 text-white"}))],2),i("div",Xa,[i("div",{class:I(["rounded-lg p-3 text-sm",a.type==="ai"?"border bg-muted":"border border-orange-200 bg-orange-50 dark:border-orange-800 dark:bg-orange-950/20"])},[a.content?(f(),Q(we,{key:0,content:a.content,class:"prose prose-sm dark:prose-invert max-w-none chat-message-ai"},null,8,["content"])):a.isStreaming?(f(),_("div",Ka,[...e[30]||(e[30]=[i("div",{class:"flex gap-1"},[i("div",{class:"h-2 w-2 animate-bounce rounded-full bg-muted-foreground/60"}),i("div",{class:"h-2 w-2 animate-bounce rounded-full bg-muted-foreground/60",style:{"animation-delay":"0.1s"}}),i("div",{class:"h-2 w-2 animate-bounce rounded-full bg-muted-foreground/60",style:{"animation-delay":"0.2s"}})],-1),i("span",{class:"text-xs text-muted-foreground/80"},"Thinking...",-1)])])):U("",!0),a.type==="ai"?(f(),_("div",Za,[i("div",Ja,[a.failed?(f(),Q(t(k),{key:0,onClick:C=>ee(a),size:"sm",variant:"outline",class:"h-6 px-2 text-xs border-orange-300 text-orange-600 hover:bg-orange-50"},{default:d(()=>[s(t(Je),{class:"mr-1 h-3 w-3"}),e[31]||(e[31]=T(" Try Again ",-1))]),_:2},1032,["onClick"])):U("",!0),s(t(k),{onClick:C=>N(a),size:"sm",variant:"ghost",class:"h-6 px-2 text-xs",disabled:G.value===a.id||G.value===-1},{default:d(()=>[G.value!==a.id&&G.value!==-1?(f(),Q(t(It),{key:0,class:"mr-1 h-3 w-3"})):G.value===a.id?(f(),Q(t(rt),{key:1,class:"mr-1 h-3 w-3 text-green-600"})):(f(),Q(t(Ae),{key:2,class:"mr-1 h-3 w-3 text-red-600"})),G.value===a.id?(f(),_("span",eo,"Copied!")):G.value===-1?(f(),_("span",to,"Failed")):(f(),_("span",so,"Copy"))]),_:2},1032,["onClick","disabled"]),s(t(k),{onClick:C=>v("rate-message",a.id,1),size:"sm",variant:"ghost",class:"h-6 px-2 text-xs"},{default:d(()=>[s(t(zt),{class:"h-3 w-3"})]),_:2},1032,["onClick"]),s(t(k),{onClick:C=>v("rate-message",a.id,-1),size:"sm",variant:"ghost",class:"h-6 px-2 text-xs"},{default:d(()=>[s(t(Pt),{class:"h-3 w-3"})]),_:2},1032,["onClick"])]),s(t(ce),{variant:"outline",class:"text-xs"},{default:d(()=>[T(E(l.currentMode==="review"?"GPT-4o":"GPT-4o-mini"),1)]),_:1})])):U("",!0)],2),i("p",ao,E(K(a.timestamp)),1)])])):(f(),_("div",oo,[i("div",ro,[i("div",no,[s(we,{content:a.content,class:"prose prose-sm prose-invert max-w-none chat-message-user"},null,8,["content"])]),i("p",io,E(K(a.timestamp)),1)]),i("div",lo,[s(t(Lt),{class:"h-3 w-3 text-primary-foreground"})])]))],2))),128))]),_:1}),s(ve,{name:"fade"},{default:d(()=>[l.isTyping?(f(),_("div",uo,[i("div",co,[s(t(Ve),{class:"h-3 w-3 text-white"})]),e[32]||(e[32]=i("div",{class:"max-w-[85%] rounded-lg border bg-muted p-3"},[i("div",{class:"flex items-center gap-1"},[i("div",{class:"flex gap-1"},[i("div",{class:"h-2 w-2 animate-bounce rounded-full bg-muted-foreground"}),i("div",{class:"h-2 w-2 animate-bounce rounded-full bg-muted-foreground",style:{"animation-delay":"0.1s"}}),i("div",{class:"h-2 w-2 animate-bounce rounded-full bg-muted-foreground",style:{"animation-delay":"0.2s"}})]),i("span",{class:"ml-2 text-xs text-muted-foreground"},"AI is thinking...")])],-1))])):U("",!0)]),_:1})])]),_:1},512),i("div",fo,[i("div",po,[s(Zt,{ref_key:"inputRef",ref:p,"model-value":l.input,"onUpdate:modelValue":e[14]||(e[14]=a=>v("update:input",a)),onSubmit:q,onKeydown:J,disabled:l.isTyping,"show-toolbar":!1,placeholder:"Ask about your chapter...",class:"pr-12"},null,8,["model-value","disabled"]),i("div",mo,[l.isTyping?(f(),Q(t(k),{key:1,onClick:le,size:"sm",variant:"ghost",class:"h-8 w-8 p-0 rounded-full hover:bg-destructive hover:text-destructive-foreground"},{default:d(()=>[s(t(Ut),{class:"h-4 w-4"})]),_:1})):(f(),Q(t(k),{key:0,onClick:q,size:"sm",variant:"ghost",class:"h-8 w-8 p-0 rounded-full hover:bg-primary hover:text-primary-foreground",disabled:!l.input.trim()},{default:d(()=>[s(t(et),{class:"h-4 w-4"})]),_:1},8,["disabled"]))])]),i("div",vo,[l.isTyping?(f(),_("span",ho,[...e[33]||(e[33]=[i("div",{class:"h-3 w-3 animate-spin rounded-full border-b border-current"},null,-1),T(" Generating response... ",-1)])])):(f(),_("span",go,"Press Enter to send, Shift+Enter for new line")),i("div",yo,[s(t(k),{onClick:x,variant:"outline",size:"sm",class:"h-6 px-2 text-xs",disabled:l.isTyping||l.messages.length===0},{default:d(()=>[s(t(Be),{class:"mr-1 h-3 w-3"}),e[34]||(e[34]=T(" New Session ",-1))]),_:1},8,["disabled"]),s(t(ce),{variant:"secondary",class:"text-xs"},{default:d(()=>[T(E(l.messages.length)+" messages ",1)]),_:1})])])])])):U("",!0)]),_:1})]))],2))}}),Ke=_e(bo,[["__scopeId","data-v-23b14c9f"]]),xo={class:"flex h-screen flex-col overflow-hidden bg-background"},wo={class:"flex flex-shrink-0 items-center justify-between border-b bg-background/95 p-2 backdrop-blur supports-[backdrop-filter]:bg-background/60"},_o={class:"flex items-center gap-2"},ko={class:"flex items-center gap-2"},Co={class:"flex-shrink-0 bg-muted/30 px-3 py-2"},To={class:"mb-1 flex items-center justify-between"},So={class:"text-xs text-muted-foreground"},$o={class:"flex flex-1 overflow-hidden"},Eo={key:0,class:"absolute inset-0 z-50 bg-background md:hidden"},Mo={class:"flex min-h-0 flex-1 flex-col border-r"},Ro={class:"flex min-h-0 flex-1 flex-col space-y-2"},jo={class:"flex items-center justify-end"},Do={key:0,class:"flex flex-shrink-0 items-center gap-2 rounded-lg bg-muted/30 p-2"},zo={class:"text-xs"},Po={class:"flex flex-shrink-0 gap-2 pt-2"},yn=me({__name:"ChatModeLayout",props:{project:{},chapter:{},chapterTitle:{},chapterContent:{},currentWordCount:{},targetWordCount:{},progressPercentage:{},writingQualityScore:{},isValid:{type:Boolean},isSaving:{type:Boolean},showPreview:{type:Boolean},isGenerating:{type:Boolean},generationProgress:{},historyIndex:{},contentHistoryLength:{},selectedText:{}},emits:["update:chapterTitle","update:chapterContent","update:selectedText","update:showPreview","save","undo","redo","exitChatMode"],setup(F,{emit:y}){const n=F,v=y,g=D([]),p=D(""),b=D(!1),w=D(null),u=D(!1),r=D(null),h=D(!1),S=D(!1),H=D("review"),M=D(!1),O=D(0),W=()=>{O.value=window.innerWidth,M.value=window.innerWidth<768,M.value&&S.value},q=()=>{W()},J=async()=>{u.value=!0;try{const x=await he.get(pe("chapters.chat-history",{project:n.project.slug,chapter:n.chapter.chapter_number})),{messages:j,current_session_id:B}=x.data;j&&j.length>0?(g.value=j.map(ee=>({id:ee.id,type:ee.type,content:ee.content,timestamp:new Date(ee.timestamp)})),w.value=B):g.value=[]}catch(x){console.warn("Failed to load chat history:",x),g.value=[]}finally{u.value=!1}};Ie(()=>{J(),W(),window.addEventListener("resize",q)}),ft(()=>{window.removeEventListener("resize",q)});const Y=async x=>{if(!p.value.trim()&&!x)return;const j=x?"":p.value,B=p.value;p.value="",x||g.value.push({id:Date.now(),type:"user",content:j,timestamp:new Date}),b.value=!0;const ee=Date.now()+1;try{const le=await fetch(pe("chapters.chat-stream",{project:n.project.slug,chapter:n.chapter.chapter_number}),{method:"POST",headers:{"Content-Type":"application/json",Accept:"text/event-stream","X-CSRF-TOKEN":document.querySelector('meta[name="csrf-token"]')?.getAttribute("content")||""},body:JSON.stringify({message:j,chapter_content:n.chapterContent||"",selected_text:n.selectedText||"",session_id:w.value,task_type:H.value,quick_action:x||null})});if(!le.ok)throw new Error(`HTTP error! status: ${le.status}`);const l=le.body?.getReader();if(!l)throw new Error("No response body reader available");r.value=l;const e=new TextDecoder;let a="";const C=async()=>{try{for(;;){const{done:A,value:R}=await l.read();if(A)break;a+=e.decode(R,{stream:!0});const X=a.split(`
`);a=X.pop()||"";for(const V of X)if(V.startsWith("data: "))try{const ne=JSON.parse(V.slice(6));$(ne)}catch(ne){console.error("Failed to parse streaming data:",ne)}}}catch(A){console.error("Stream reading error:",A),P(A)}},$=A=>{switch(A.type){case"start":b.value=!0,A.session_id&&(w.value=A.session_id);break;case"content":b.value&&(b.value=!1);const R=g.value.findIndex(ne=>ne.id===ee);R===-1?g.value.push({id:ee,type:"ai",content:A.content,timestamp:new Date,isStreaming:!0}):g.value[R].content+=A.content;break;case"complete":b.value=!1,A.session_id&&(w.value=A.session_id);const X=g.value.findIndex(ne=>ne.id===ee);X!==-1&&(g.value[X].isStreaming=!1,A.ai_message_id&&(g.value[X].id=A.ai_message_id));break;case"error":b.value=!1;const V=g.value.findIndex(ne=>ne.id===ee);V!==-1?g.value[V]={id:g.value[V].id,type:"ai",content:A.message||" Sorry, I encountered an error processing your message.",timestamp:new Date,failed:!0,lastPrompt:B,lastQuickAction:x}:g.value.push({id:Date.now(),type:"ai",content:A.message||" Sorry, I encountered an error processing your message.",timestamp:new Date,failed:!0,lastPrompt:B,lastQuickAction:x});break;case"heartbeat":break}},P=A=>{b.value=!1;const R=g.value.findIndex(X=>X.id===ee);R!==-1?g.value[R]={id:g.value[R].id,type:"ai",content:" Connection error. Please check your internet and try again.",timestamp:new Date,failed:!0,lastPrompt:B,lastQuickAction:x}:g.value.push({id:Date.now(),type:"ai",content:" Connection error. Please check your internet and try again.",timestamp:new Date,failed:!0,lastPrompt:B,lastQuickAction:x})};try{await C()}finally{r.value=null}}catch(le){console.error("Chat streaming error:",le),b.value=!1;const l=g.value.findIndex(e=>e.id===ee);l!==-1?g.value[l]={id:g.value[l].id,type:"ai",content:" Failed to start conversation. Please try again.",timestamp:new Date,failed:!0,lastPrompt:B,lastQuickAction:x}:g.value.push({id:Date.now(),type:"ai",content:" Failed to start conversation. Please try again.",timestamp:new Date,failed:!0,lastPrompt:B,lastQuickAction:x})}},K=x=>{Y(x)},G=x=>{H.value=x,console.log("Chat mode changed to:",x)},N=x=>{console.log("Message copied:",x)},se=(x,j)=>{console.log("Message rated:",x,j)},te=()=>{console.log("Starting new chat session..."),g.value=[],w.value=null,p.value="",console.log("New chat session started")},ae=()=>{console.log("Chat deleted - refreshing main chat"),J()},c=()=>{console.log("Chat cleared - refreshing main chat"),g.value=[],w.value=null,J()},o=x=>{console.log("Retrying failed message:",x);const j=g.value.findIndex(B=>B.id===x.id);j!==-1&&g.value.splice(j,1),x.lastQuickAction?Y(x.lastQuickAction):x.lastPrompt&&(p.value=x.lastPrompt,Y())},m=()=>{if(console.log("Stopping generation..."),r.value){try{r.value.cancel()}catch(j){console.warn("Error cancelling stream:",j)}r.value=null}b.value=!1;const x=g.value[g.value.length-1];x&&x.type==="ai"&&x.isStreaming&&(x.isStreaming=!1,x.content+=`

*[Generation stopped by user]*`)},L=()=>{S.value=!S.value},re=()=>{h.value=!h.value};return(x,j)=>(f(),_("div",xo,[i("div",wo,[i("div",_o,[s(t(k),{onClick:j[0]||(j[0]=B=>v("exitChatMode")),variant:"ghost",size:"sm",class:"gap-1"},{default:d(()=>[s(t(Te),{class:"h-4 w-4"}),j[6]||(j[6]=T(" Exit Chat ",-1))]),_:1})]),i("div",ko,[s(t(ce),{variant:"outline",class:"text-xs"},{default:d(()=>[T(E(x.writingQualityScore)+"% Quality ",1)]),_:1})])]),i("div",Co,[i("div",To,[j[7]||(j[7]=i("span",{class:"text-xs font-medium"},"Writing Progress",-1)),i("span",So,E(Math.round(x.progressPercentage))+"% ("+E(x.currentWordCount)+" / "+E(x.targetWordCount)+" words)",1)]),s(t(Ze),{"model-value":x.progressPercentage,class:"h-1"},null,8,["model-value"])]),i("div",$o,[M.value&&!S.value?(f(),_("div",Eo,[s(Ke,{"is-minimized":!1,messages:g.value,"is-typing":b.value,"selected-text":x.selectedText,"chapter-content":x.chapterContent,"chapter-number":x.chapter.chapter_number,"current-mode":H.value,"project-slug":x.project.slug,"session-id":w.value||"temp-session","is-mobile":!0,onSendMessage:Y,onQuickAction:K,onRetryMessage:o,onStopGeneration:m,onToggleMinimize:L,onChangeMode:G,onCopyMessage:N,onRateMessage:se,onNewSession:te,onChatDeleted:ae,onChatCleared:c,input:p.value,"onUpdate:input":j[1]||(j[1]=B=>p.value=B),class:"mobile-chat-overlay"},null,8,["messages","is-typing","selected-text","chapter-content","chapter-number","current-mode","project-slug","session-id","input"])])):U("",!0),i("div",Mo,[s(t(mt),{class:"flex min-h-0 flex-1 flex-col rounded-none border-0 bg-transparent shadow-none"},{default:d(()=>[s(t(pt),{class:"flex min-h-0 flex-1 flex-col space-y-4 p-6"},{default:d(()=>[i("div",Ro,[i("div",jo,[s(t(k),{onClick:re,variant:h.value?"default":"ghost",size:"sm",class:"h-7 text-xs"},{default:d(()=>[h.value?(f(),Q(t(Oe),{key:0,class:"mr-1.5 h-3 w-3"})):(f(),Q(t(Yt),{key:1,class:"mr-1.5 h-3 w-3"})),T(" "+E(h.value?"Edit":"Preview"),1)]),_:1},8,["variant"])]),Fe(s(t(Ce),{class:"min-h-0 flex-1"},{default:d(()=>[s(_t,{"model-value":x.chapterContent,"onUpdate:modelValue":j[2]||(j[2]=B=>v("update:chapterContent",B)),placeholder:"Start writing your chapter...","min-height":"400px",class:"text-sm leading-relaxed"},null,8,["model-value"])]),_:1},512),[[Le,!h.value]]),Fe(s(t(Ce),{class:"min-h-0 flex-1"},{default:d(()=>[s(we,{content:x.chapterContent,class:"p-4",style:{"font-family":"'Times New Roman', serif","line-height":"1.6"}},null,8,["content"])]),_:1},512),[[Le,h.value]])]),x.isGenerating?(f(),_("div",Do,[j[8]||(j[8]=i("div",{class:"h-3 w-3 animate-spin rounded-full border-2 border-primary border-t-transparent"},null,-1)),i("span",zo,E(x.generationProgress),1)])):U("",!0),i("div",Po,[s(t(k),{onClick:j[3]||(j[3]=B=>v("save",!1)),disabled:!x.isValid||x.isSaving,size:"sm"},{default:d(()=>[s(t(Bt),{class:"mr-1 h-3 w-3"}),T(" "+E(x.isSaving?"Saving...":"Save"),1)]),_:1},8,["disabled"]),s(t(k),{onClick:j[4]||(j[4]=B=>v("save",!1)),disabled:!x.isValid||x.currentWordCount<x.targetWordCount*.8,size:"sm"},{default:d(()=>[s(t(rt),{class:"mr-1 h-3 w-3"}),j[9]||(j[9]=T(" Complete ",-1))]),_:1},8,["disabled"])])]),_:1})]),_:1})]),M.value?U("",!0):(f(),_("div",{key:1,class:I(["flex min-h-0 flex-col bg-muted/20 border-l transition-all duration-300 ease-in-out",S.value?"w-[60px]":"w-[450px] xl:w-[500px]"])},[s(Ke,{"is-minimized":S.value,messages:g.value,"is-typing":b.value,"selected-text":x.selectedText,"chapter-content":x.chapterContent,"chapter-number":x.chapter.chapter_number,"current-mode":H.value,"project-slug":x.project.slug,"session-id":w.value||"temp-session",onSendMessage:Y,onQuickAction:K,onRetryMessage:o,onStopGeneration:m,onToggleMinimize:L,onChangeMode:G,onCopyMessage:N,onRateMessage:se,onNewSession:te,onChatDeleted:ae,onChatCleared:c,input:p.value,"onUpdate:input":j[5]||(j[5]=B=>p.value=B)},null,8,["is-minimized","messages","is-typing","selected-text","chapter-content","chapter-number","current-mode","project-slug","session-id","input"])],2))])]))}});export{yn as default};
