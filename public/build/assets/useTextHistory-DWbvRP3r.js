import{c as j,_ as D}from"./index-BJSIFph3.js";import{au as J,av as B,aw as K,ax as Q,ay as X,az as Y,aA as ee,aB as te,aC as re,aD as ae,aE as oe,aF as ne,aG as se,aH as le}from"./RichTextEditor-Cr6VPunt.js";import{d as Z,A as R,h as ce,p as I,N as ie,B as de,a as M,o as $,k as l,u as n,g as U,w as p,c as z,F as O,s as _,e as g,q as N,t as w,E as pe,n as ue,y as A}from"./app-VmIkgWBY.js";import{_ as me}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{_ as W}from"./index-D4xO16iz.js";import{_ as he,a as fe}from"./CardContent.vue_vue_type_script_setup_true_lang-Cb_8jfwT.js";import{_ as ge}from"./Checkbox.vue_vue_type_script_setup_true_lang-CSbd7sO8.js";import{_ as ve,d as xe,a as ye,b as _e,c as we}from"./DialogTitle.vue_vue_type_script_setup_true_lang-DIQ68_IQ.js";import{_ as ke}from"./DialogFooter.vue_vue_type_script_setup_true_lang-Dh8LRqlQ.js";import{_ as be,a as Ce,b as $e,d as q,c as V,e as je}from"./DropdownMenuTrigger.vue_vue_type_script_setup_true_lang-BACWwGEz.js";import{_ as Pe}from"./ScrollArea.vue_vue_type_script_setup_true_lang-BvQaizao.js";import{_ as Fe}from"./Separator.vue_vue_type_script_setup_true_lang-CYQCz-3c.js";import{t as f}from"./Sonner.vue_vue_type_script_setup_true_lang-QiSNjKcB.js";import{D as H}from"./download-BWLv5HOw.js";import{C as Ee}from"./chevron-down-CkFng04d.js";import{F as G}from"./file-text-BhwtZJOe.js";/**
 * @license lucide-vue-next v0.468.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const st=j("BookCheckIcon",[["path",{d:"M4 19.5v-15A2.5 2.5 0 0 1 6.5 2H19a1 1 0 0 1 1 1v18a1 1 0 0 1-1 1H6.5a1 1 0 0 1 0-5H20",key:"k3hazp"}],["path",{d:"m9 9.5 2 2 4-4",key:"1dth82"}]]);/**
 * @license lucide-vue-next v0.468.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Le=j("FileDownIcon",[["path",{d:"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z",key:"1rqfz7"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}],["path",{d:"M12 18v-6",key:"17g6i2"}],["path",{d:"m9 15 3 3 3-3",key:"1npd3o"}]]);/**
 * @license lucide-vue-next v0.468.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const lt=j("Maximize2Icon",[["polyline",{points:"15 3 21 3 21 9",key:"mznyad"}],["polyline",{points:"9 21 3 21 3 15",key:"1avn1i"}],["line",{x1:"21",x2:"14",y1:"3",y2:"10",key:"ota7mn"}],["line",{x1:"3",x2:"10",y1:"21",y2:"14",key:"1atl0r"}]]);/**
 * @license lucide-vue-next v0.468.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ct=j("MenuIcon",[["line",{x1:"4",x2:"20",y1:"12",y2:"12",key:"1e0a9i"}],["line",{x1:"4",x2:"20",y1:"6",y2:"6",key:"1owob3"}],["line",{x1:"4",x2:"20",y1:"18",y2:"18",key:"yk5zj1"}]]);/**
 * @license lucide-vue-next v0.468.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const it=j("PanelLeftCloseIcon",[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",key:"afitv7"}],["path",{d:"M9 3v18",key:"fh3hqa"}],["path",{d:"m16 15-3-3 3-3",key:"14y99z"}]]);/**
 * @license lucide-vue-next v0.468.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const dt=j("PanelLeftOpenIcon",[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",key:"afitv7"}],["path",{d:"M9 3v18",key:"fh3hqa"}],["path",{d:"m14 9 3 3-3 3",key:"8010ee"}]]);/**
 * @license lucide-vue-next v0.468.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const pt=j("PanelRightCloseIcon",[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",key:"afitv7"}],["path",{d:"M15 3v18",key:"14nvp0"}],["path",{d:"m8 9 3 3-3 3",key:"12hl5m"}]]);/**
 * @license lucide-vue-next v0.468.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ut=j("PanelRightOpenIcon",[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",key:"afitv7"}],["path",{d:"M15 3v18",key:"14nvp0"}],["path",{d:"m10 15-3-3 3-3",key:"1pgupc"}]]),Te=Z({__name:"RichTextViewer",props:{content:{},showFontControls:{type:Boolean,default:!0}},setup(E){const v=J(le);B.initialize({startOnLoad:!1,theme:"default",securityLevel:"loose",fontFamily:"Arial, sans-serif"});const h=E,s=async a=>{const d=a.querySelectorAll("pre code.language-mermaid, .mermaid-diagram");for(let r=0;r<d.length;r++){const o=d[r],e=o.textContent||"";try{const{svg:t}=await B.render(`mermaid-${Date.now()}-${r}`,e),u=document.createElement("div");u.className="mermaid-container",u.innerHTML=t,o.parentElement?.replaceWith(u)}catch(t){console.error("Mermaid rendering error:",t),o.parentElement?.classList.add("mermaid-error")}}},P=a=>a?(a=a.replace(/```mermaid\n?([\s\S]*?)```/g,(d,r)=>`<pre><code class="language-mermaid">${r.trim()}</code></pre>`),a=a.replace(/``mermaid\n?([\s\S]*?)``/g,(d,r)=>`<pre><code class="language-mermaid">${r.trim()}</code></pre>`),a=a.replace(/`mermaid\n?([\s\S]*?)`/g,(d,r)=>`<pre><code class="language-mermaid">${r.trim()}</code></pre>`),a):"",b=a=>a?(a=a.replace(/```(\w+)\n?([\s\S]*?)```/g,(d,r,o)=>`<pre><code class="language-${r}">${o.trim()}</code></pre>`),a=a.replace(/```\n?([\s\S]*?)```/g,(d,r)=>`<pre><code>${r.trim()}</code></pre>`),a):"",L=a=>{if(!a)return"";const d=a.split(`
`);let r=[],o=0;for(;o<d.length;){const e=d[o];if(e.includes("|")){const t=S(d,o);if(t.html){r.push(t.html),o=t.nextIndex;continue}}r.push(e),o++}return r.join(`
`)},S=(a,d)=>{let r=a[d];if(!r||!r.includes("|"))return{html:null,nextIndex:d+1};const o=r.split("|").map(c=>c.trim()).filter(c=>c.length>0);if(o.length===0)return{html:null,nextIndex:d+1};const e=a[d+1];if(!e||!e.includes("|")||!e.includes("-"))return{html:null,nextIndex:d+1};let t=[],u=d+2;for(;u<a.length;){const c=a[u];if(!c||!c.includes("|"))break;const x=c.split("|").map(m=>m.trim()).filter(m=>m.length>0);x.length>0&&t.push(x),u++}let i='<div class="tableWrapper"><table>';return i+="<thead><tr>",o.forEach(c=>{i+=`<th>${c}</th>`}),i+="</tr></thead>",t.length>0&&(i+="<tbody>",t.forEach(c=>{i+="<tr>";for(let x=0;x<o.length;x++){const m=c[x]||"";i+=`<td>${m}</td>`}i+="</tr>"}),i+="</tbody>"),i+="</table></div>",{html:i,nextIndex:u}},T=a=>{if(!a)return"";if(a.includes("<p>")||a.includes("<h1>")||a.includes("<h2>")||a.includes("<div>")){let e=P(a);return e=b(e),e}let r=a;return r=P(r),r=b(r),r=r.replace(/^#### (.*$)/gim,"<h4>$1</h4>"),r=r.replace(/^### (.*$)/gim,"<h3>$1</h3>"),r=r.replace(/^## (.*$)/gim,"<h2>$1</h2>"),r=r.replace(/^# (.*$)/gim,"<h1>$1</h1>"),r=r.replace(/\*\*(.*?)\*\*/g,"<strong>$1</strong>"),r=r.replace(new RegExp("(?<!\\*)\\*([^*\\n]+?)\\*(?!\\*)","g"),"<em>$1</em>"),r=r.replace(/`([^`]+)`/g,"<code>$1</code>"),r=L(r),r.split(/\n\s*\n/).filter(e=>e.trim()).map(e=>{const t=e.trim();if(t.startsWith("<h1>")||t.startsWith("<h2>")||t.startsWith("<h3>")||t.startsWith("<h4>"))return t;if(t.includes(`
`)){const i=t.split(`
`).map(m=>m.trim()).filter(m=>m),c=i.some(m=>m.match(/^\d+\.\s/)),x=i.some(m=>m.match(/^[-*]\s/));if(c||x){const m=i.map(k=>k.match(/^\d+\.\s/)?`<li>${k.replace(/^\d+\.\s/,"")}</li>`:k.match(/^[-*]\s/)?`<li>${k.replace(/^[-*]\s/,"")}</li>`:k);let F=[],C="";for(const k of m)k.startsWith("<li>")?(C&&F.push(C),C=k):C&&(C=C.replace("</li>",` ${k}</li>`));return C&&F.push(C),c?`<ol>${F.join("")}</ol>`:`<ul>${F.join("")}</ul>`}}return`<p>${t.replace(/\n/g,"<br>")}</p>`}).join("")},y=K({content:T(h.content),editable:!1,extensions:[Q.configure({heading:{levels:[1,2,3]},codeBlock:!1}),X.configure({lowlight:v,HTMLAttributes:{class:"code-block-highlighted"}}),Y,ee,te,re.configure({resizable:!0}),ae,oe,ne],editorProps:{attributes:{class:"prose prose-sm dark:prose-invert max-w-none focus:outline-none"}}});return R("12"),ce(()=>{setTimeout(async()=>{if(y.value){y.value.chain().selectAll().setFontSize("12pt").run(),await I();const a=document.querySelector(".ProseMirror");a&&await s(a)}},100)}),ie(()=>h.content,async a=>{if(y.value&&y.value.getHTML()!==a){const d=T(a);y.value.commands.setContent(d),await I();const r=document.querySelector(".ProseMirror");r&&await s(r)}}),de(()=>{y.value&&y.value.destroy()}),(a,d)=>($(),M("div",null,[l(n(se),{editor:n(y)},null,8,["editor"])]))}}),mt=me(Te,[["__scopeId","data-v-107ec45b"]]),De={class:"inline-flex"},Me={class:"space-y-4"},Re={class:"flex items-center justify-between"},Se={class:"flex items-center gap-2 text-sm text-muted-foreground"},Ue={class:"flex items-center gap-2"},ze={class:"space-y-2"},Ae={class:"flex items-start gap-3"},He={class:"flex-1 min-w-0"},Be={class:"flex items-center gap-2 mb-1"},Ie={class:"font-medium truncate"},Oe={class:"flex items-center gap-4 text-sm text-muted-foreground"},Ne={key:0},ht=Z({__name:"ExportMenu",props:{project:{},currentChapter:{},allChapters:{},triggerElement:{default:"button"},size:{default:"default"},variant:{default:"outline"}},setup(E){const v=E,h=R(!1),s=R([]),P=U(()=>v.allChapters.filter(o=>o.content&&o.content.trim().length>0)),b=U(()=>s.value.length),L=U(()=>v.allChapters.filter(o=>s.value.includes(o.chapter_number)).reduce((o,e)=>o+e.word_count,0)),S=async()=>{f.loading("Generating project PDF...",{id:"export-project-pdf"});const o=A("export.project.pdf",{project:v.project.slug});try{const e=await fetch(o,{method:"GET",headers:{Accept:"application/pdf"}});if(e.ok){const t=e.headers.get("content-type");if(t&&t.includes("application/json")){const x=await e.json();f.error("Export Failed",{id:"export-project-pdf",description:x.message||"An error occurred during PDF export."});return}const u=await e.blob(),i=window.URL.createObjectURL(u),c=document.createElement("a");c.href=i,c.download=`${v.project.slug}_full_project.pdf`,document.body.appendChild(c),c.click(),document.body.removeChild(c),window.URL.revokeObjectURL(i),f.success("Project PDF exported successfully!",{id:"export-project-pdf",description:`${v.project.title} has been downloaded as PDF.`})}else try{const t=await e.json();f.error("Export Failed",{id:"export-project-pdf",description:t.message||"An error occurred during PDF export."})}catch{f.error("Export Failed",{id:"export-project-pdf",description:"Unable to export project as PDF. Please try again."})}}catch{f.error("Export Failed",{id:"export-project-pdf",description:"Network error occurred. Please check your connection and try again."})}},T=async()=>{if(s.value.length===0){f.error("No chapters selected",{description:"Please select at least one chapter to export."});return}try{f.loading(`Exporting ${s.value.length} chapters...`,{id:"export-chapters"});const o=A("export.chapters.word",{project:v.project.slug}),e=new FormData;s.value.forEach(i=>{e.append("chapters[]",i.toString())});const t=document.querySelector('meta[name="csrf-token"]')?.getAttribute("content");t&&e.append("_token",t);const u=await fetch(o,{method:"POST",body:e,headers:{Accept:"application/json"}});if(u.ok){const i=u.headers.get("content-type");if(i&&i.includes("application/json")){const F=await u.json();f.error("Export Failed",{id:"export-chapters",description:F.message||"An error occurred during export."});return}const c=await u.blob(),x=window.URL.createObjectURL(c),m=document.createElement("a");m.href=x,m.download=`${v.project.slug}-chapters-${s.value.join("-")}.docx`,document.body.appendChild(m),m.click(),document.body.removeChild(m),window.URL.revokeObjectURL(x),f.success("Selected chapters exported successfully!",{id:"export-chapters",description:`${s.value.length} chapters exported to Word.`}),s.value=[],h.value=!1}else try{const i=await u.json();f.error("Export Failed",{id:"export-chapters",description:i.message||"An error occurred during export."})}catch{f.error("Export Failed",{id:"export-chapters",description:"Unable to export selected chapters. Please try again."})}}catch{f.error("Export Failed",{id:"export-chapters",description:"Network error occurred. Please check your connection and try again."})}},y=o=>{const e=s.value.indexOf(o);e>-1?s.value.splice(e,1):s.value.push(o)},a=()=>{s.value=P.value.map(o=>o.chapter_number)},d=()=>{s.value=[]},r=async()=>{f.loading("Generating PDF...",{id:"export-chapter-pdf"});const o=A("export.chapter.pdf",{project:v.project.slug,chapterNumber:v.currentChapter.chapter_number});try{const e=await fetch(o,{method:"GET",headers:{Accept:"application/pdf"}});if(e.ok){const t=e.headers.get("content-type");if(t&&t.includes("application/json")){const x=await e.json();f.error("Export Failed",{id:"export-chapter-pdf",description:x.message||"An error occurred during PDF export."});return}const u=await e.blob(),i=window.URL.createObjectURL(u),c=document.createElement("a");c.href=i,c.download=`chapter_${v.currentChapter.chapter_number}_${v.currentChapter.title.toLowerCase().replace(/\s+/g,"_")}.pdf`,document.body.appendChild(c),c.click(),document.body.removeChild(c),window.URL.revokeObjectURL(i),f.success("PDF exported successfully!",{id:"export-chapter-pdf",description:`${v.currentChapter.title} has been downloaded as PDF.`})}else try{const t=await e.json();f.error("Export Failed",{id:"export-chapter-pdf",description:t.message||"An error occurred during PDF export."})}catch{f.error("Export Failed",{id:"export-chapter-pdf",description:"Unable to export chapter as PDF. Please try again."})}}catch{f.error("Export Failed",{id:"export-chapter-pdf",description:"Network error occurred. Please check your connection and try again."})}};return(o,e)=>($(),M("div",De,[l(n(be),null,{default:p(()=>[l(n(Ce),{asChild:""},{default:p(()=>[l(n(D),{variant:o.variant,size:o.size,class:"gap-2"},{default:p(()=>[o.triggerElement==="button"?($(),M(O,{key:0},[l(n(H),{class:"h-4 w-4"}),e[2]||(e[2]=_(" Export ",-1)),l(n(Ee),{class:"h-3 w-3"})],64)):($(),z(n(H),{key:1,class:"h-4 w-4"}))]),_:1},8,["variant","size"])]),_:1}),l(n($e),{align:"end",class:"w-64"},{default:p(()=>[l(n(q),null,{default:p(()=>[...e[3]||(e[3]=[_("Current Chapter",-1)])]),_:1}),l(n(V),{onClick:r,class:"gap-2"},{default:p(()=>[l(n(G),{class:"h-4 w-4"}),e[4]||(e[4]=g("div",{class:"flex flex-col"},[g("span",{class:"font-medium"},"Export as PDF"),g("span",{class:"text-xs text-muted-foreground"}," Professional academic format ")],-1))]),_:1}),l(n(je)),l(n(q),null,{default:p(()=>[...e[5]||(e[5]=[_("Full Project",-1)])]),_:1}),l(n(V),{onClick:S,class:"gap-2"},{default:p(()=>[l(n(G),{class:"h-4 w-4"}),e[6]||(e[6]=g("div",{class:"flex flex-col"},[g("span",{class:"font-medium"},"Export as PDF"),g("span",{class:"text-xs text-muted-foreground"}," Professional academic format with cover page ")],-1))]),_:1})]),_:1})]),_:1}),l(n(ve),{open:h.value,"onUpdate:open":e[1]||(e[1]=t=>h.value=t)},{default:p(()=>[l(n(xe),{class:"max-w-2xl"},{default:p(()=>[l(n(ye),null,{default:p(()=>[l(n(_e),{class:"flex items-center gap-2"},{default:p(()=>[l(n(Le),{class:"h-5 w-5"}),e[7]||(e[7]=_(" Select Chapters to Export ",-1))]),_:1}),l(n(we),null,{default:p(()=>[...e[8]||(e[8]=[_(" Choose which chapters you want to include in your Word export. Only chapters with content can be exported. ",-1)])]),_:1})]),_:1}),g("div",Me,[g("div",Re,[g("div",Se,[g("span",null,w(b.value)+" of "+w(P.value.length)+" chapters selected",1),L.value>0?($(),z(n(W),{key:0,variant:"outline",class:"text-xs"},{default:p(()=>[_(w(L.value.toLocaleString())+" words ",1)]),_:1})):N("",!0)]),g("div",Ue,[l(n(D),{onClick:a,variant:"ghost",size:"sm"},{default:p(()=>[...e[9]||(e[9]=[_(" Select All ",-1)])]),_:1}),l(n(D),{onClick:d,variant:"ghost",size:"sm"},{default:p(()=>[...e[10]||(e[10]=[_(" Clear ",-1)])]),_:1})])]),l(n(Fe)),l(n(Pe),{class:"h-[300px]"},{default:p(()=>[g("div",ze,[($(!0),M(O,null,pe(P.value,t=>($(),z(n(he),{key:t.id,class:ue(["cursor-pointer transition-colors hover:bg-muted/50",{"ring-2 ring-primary":s.value.includes(t.chapter_number),"bg-muted/30":s.value.includes(t.chapter_number)}]),onClick:u=>y(t.chapter_number)},{default:p(()=>[l(n(fe),{class:"p-4"},{default:p(()=>[g("div",Ae,[l(n(ge),{checked:s.value.includes(t.chapter_number),"onUpdate:checked":u=>y(t.chapter_number),class:"mt-1"},null,8,["checked","onUpdate:checked"]),g("div",He,[g("div",Be,[g("h4",Ie," Chapter "+w(t.chapter_number)+": "+w(t.title),1),l(n(W),{variant:t.status==="approved"?"default":"secondary",class:"text-xs"},{default:p(()=>[_(w(t.status.replace("_"," ")),1)]),_:2},1032,["variant"])]),g("div",Oe,[g("span",null,w(t.word_count.toLocaleString())+" words",1),t.word_count>0?($(),M("span",Ne,w(Math.ceil(t.word_count/250))+" pages approx. ",1)):N("",!0)])])])]),_:2},1024)]),_:2},1032,["class","onClick"]))),128))])]),_:1})]),l(n(ke),null,{default:p(()=>[l(n(D),{onClick:e[0]||(e[0]=t=>h.value=!1),variant:"outline"},{default:p(()=>[...e[11]||(e[11]=[_(" Cancel ",-1)])]),_:1}),l(n(D),{onClick:T,disabled:b.value===0,class:"gap-2"},{default:p(()=>[l(n(H),{class:"h-4 w-4"}),_(" Export "+w(b.value)+" Chapter"+w(b.value===1?"":"s"),1)]),_:1},8,["disabled"])]),_:1})]),_:1})]),_:1},8,["open"])]))}});function ft(E="",v=50){const h=R([E]),s=R(0);return{contentHistory:h,historyIndex:s,addToHistory:y=>{h.value[s.value]!==y&&(h.value=h.value.slice(0,s.value+1),h.value.push(y),h.value.length>v?h.value.shift():s.value++)},undo:()=>s.value>0?(s.value--,h.value[s.value]):null,redo:()=>s.value<h.value.length-1?(s.value++,h.value[s.value]):null,canUndo:()=>s.value>0,canRedo:()=>s.value<h.value.length-1}}export{st as B,ct as M,it as P,mt as R,ht as _,lt as a,dt as b,pt as c,ut as d,ft as u};
