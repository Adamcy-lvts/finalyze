import{bt as d,ck as x,bB as E,cS as C,bu as S,cn as B,co as b,cH as z,cp as m,cD as F,cI as N,bF as a,cr as t,cq as l,es as V,fV as M,cF as O,f9 as R,cs as k,eB as j}from"./vendor-B5jlBrgV.js";import{_ as v}from"./index-D4mJyiz8.js";const I=d(!1),_=d(!1);let u=null,g=null,P=!1;const D=async()=>typeof window>"u"||!("serviceWorker"in navigator)?null:u||(g||(g=navigator.serviceWorker.register("/sw.js",{scope:"/"}).then(o=>(u=o,o)).catch(o=>(console.error("SW registration error:",o),null))),g);function T(){const o=async(n=!0)=>{if(!u)return;const i=u.waiting;i&&i.postMessage({type:"SKIP_WAITING"}),n&&window.location.reload()},s=d(null),c=x(()=>s.value!==null),r=d(!1),f=n=>{n.preventDefault(),s.value=n,console.log("PWA: Install prompt available (from event)")},p=()=>{typeof window<"u"&&window.deferredPWAPrompt&&(s.value=window.deferredPWAPrompt,console.log("PWA: Using pre-captured install prompt"))},e=()=>{s.value=null,r.value=!0,typeof window<"u"&&(window.deferredPWAPrompt=null)},W=async()=>{if(!s.value)return!1;await s.value.prompt();const{outcome:n}=await s.value.userChoice;return n==="accepted"?(s.value=null,r.value=!0,!0):!1},L=()=>{s.value=null,localStorage.setItem("pwa-install-dismissed","true")},A=x(()=>!(!c.value||localStorage.getItem("pwa-install-dismissed"))),w=d(typeof navigator<"u"?navigator.onLine:!0),y=()=>{w.value=!0},h=()=>{w.value=!1};return E(()=>{typeof window<"u"&&window.matchMedia("(display-mode: standalone)").matches&&(r.value=!0),typeof window<"u"&&(D().then(n=>{!n||P||(P=!0,setInterval(()=>{n.update()},3600*1e3),n.addEventListener("updatefound",()=>{const i=n.installing;i&&i.addEventListener("statechange",()=>{i.state==="installed"&&(navigator.serviceWorker.controller?I.value=!0:_.value=!0)})}))}),p(),window.addEventListener("beforeinstallprompt",f),window.addEventListener("pwa-install-available",p),window.addEventListener("appinstalled",e),window.addEventListener("online",y),window.addEventListener("offline",h))}),C(()=>{typeof window<"u"&&(window.removeEventListener("beforeinstallprompt",f),window.removeEventListener("pwa-install-available",p),window.removeEventListener("appinstalled",e),window.removeEventListener("online",y),window.removeEventListener("offline",h))}),{needRefresh:I,offlineReady:_,updateServiceWorker:o,canInstall:c,isInstalled:r,installApp:W,dismissInstallPrompt:L,shouldShowInstallPrompt:A,isOnline:w}}const G={key:0,class:"fixed bottom-4 left-4 right-4 z-50 mx-auto max-w-sm overflow-hidden rounded-xl border bg-card shadow-2xl md:left-auto md:right-4",role:"dialog","aria-label":"Install Finalyze app"},U={class:"relative bg-gradient-to-r from-primary/20 to-primary/5 px-4 pb-4 pt-4"},q={class:"space-y-2 px-4 py-3"},H={class:"flex items-center gap-2 text-sm text-muted-foreground"},K={class:"flex items-center gap-2 text-sm text-muted-foreground"},X={class:"flex items-center gap-2 text-sm text-muted-foreground"},Z={class:"flex gap-2 border-t bg-muted/30 px-4 py-3"},Q=S({__name:"PWAInstallPrompt",setup(o){const{shouldShowInstallPrompt:s,installApp:c,dismissInstallPrompt:r}=T(),f=async()=>{await c()};return(p,e)=>(b(),B(z,{"enter-active-class":"transition duration-300 ease-out","enter-from-class":"translate-y-full opacity-0","enter-to-class":"translate-y-0 opacity-100","leave-active-class":"transition duration-200 ease-in","leave-from-class":"translate-y-0 opacity-100","leave-to-class":"translate-y-full opacity-0"},{default:m(()=>[a(s)?(b(),F("div",G,[t("div",U,[l(a(v),{variant:"ghost",size:"icon",class:"absolute right-2 top-2 h-7 w-7 rounded-full hover:bg-background/50",onClick:a(r)},{default:m(()=>[l(a(V),{class:"h-4 w-4"})]),_:1},8,["onClick"]),e[0]||(e[0]=t("div",{class:"flex items-center gap-3"},[t("div",{class:"flex h-14 w-14 shrink-0 items-center justify-center rounded-xl bg-[#0a0a0f] shadow-lg"},[t("img",{src:"/img/finalyze_icon_logo.png",alt:"Finalyze",class:"h-10 w-10 object-contain"})]),t("div",null,[t("h3",{class:"text-base font-semibold text-foreground"},"Install Finalyze"),t("p",{class:"text-sm text-muted-foreground"},"Get the full app experience")])],-1))]),t("div",q,[t("div",H,[l(a(M),{class:"h-4 w-4 text-primary"}),e[1]||(e[1]=t("span",null,"Launch from your home screen",-1))]),t("div",K,[l(a(O),{class:"h-4 w-4 text-primary"}),e[2]||(e[2]=t("span",null,"Faster loading & performance",-1))]),t("div",X,[l(a(R),{class:"h-4 w-4 text-primary"}),e[3]||(e[3]=t("span",null,"Access your work offline",-1))])]),t("div",Z,[l(a(v),{variant:"outline",class:"flex-1",onClick:a(r)},{default:m(()=>[...e[4]||(e[4]=[k(" Maybe later ",-1)])]),_:1},8,["onClick"]),l(a(v),{class:"flex-1",onClick:f},{default:m(()=>[l(a(j),{class:"mr-2 h-4 w-4"}),e[5]||(e[5]=k(" Install App ",-1))]),_:1})])])):N("",!0)]),_:1}))}});export{Q as _,T as u};
