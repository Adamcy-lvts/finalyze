import{d as qe,b as v,p as He,T as Ke,t as he,q as xe,c,o as d,k as r,j as l,g as s,f as y,n as w,i as F,v as we,u as o,z as _,y as m,F as B,h as Q,ac as A,Q as Xe,ab as Y,R as Ge,X as I,U as k}from"./app-DI0P-SCf.js";import{b as Qe,_ as Ye}from"./AppLayout.vue_vue_type_script_setup_true_lang-Bl-UPu6g.js";import{c as de,_ as h}from"./index-BNCR1WzN.js";import{_ as Ze}from"./Input.vue_vue_type_script_setup_true_lang-BYz-tnUZ.js";import{_ as _e}from"./index-xJ5Oeg8M.js";import{_ as ke}from"./Textarea.vue_vue_type_script_setup_true_lang-Cti3-4ln.js";import{a as et}from"./ScrollArea.vue_vue_type_script_setup_true_lang-CEw2aNhZ.js";import{d as tt,a as st,b as ot,c as rt,_ as nt}from"./DialogTitle.vue_vue_type_script_setup_true_lang-YWUBEI1G.js";import{_ as it}from"./DialogFooter.vue_vue_type_script_setup_true_lang-BLye3tDr.js";import{H as ae,a as Ce,P as at,b as lt,c as dt,d as ct,e as ut,f as pt,g as ft,h as mt,_ as vt}from"./AlertDialogTitle.vue_vue_type_script_setup_true_lang-CyfOzzXw.js";import{_ as gt,a as bt,b as yt}from"./UserInfo.vue_vue_type_script_setup_true_lang-DJeZkgOX.js";import{_ as le}from"./SafeHtmlText.vue_vue_type_script_setup_true_lang-CdcL2AEG.js";import{t as u}from"./index-D1DrIvjI.js";import{u as ht}from"./useWordBalance-Du-eSUrp.js";import{S as J}from"./sparkles-By8c6WbP.js";import{P as xt}from"./plus-CIVqX7tK.js";import{C as wt}from"./check-COZqqKzN.js";import{X as _t}from"./x-D-oiaNfd.js";import{P as kt}from"./pencil-DBPOka2a.js";import{T as Se}from"./trash-2-ElVY0woU.js";import{M as Ct}from"./message-square-DA6NUBYj.js";import{A as Te}from"./arrow-left-DkewZFEB.js";import{C as $e}from"./DropdownMenuTrigger.vue_vue_type_script_setup_true_lang-B1iWO8oL.js";import{B as St}from"./bot-D6l7zrKt.js";import{S as Ie}from"./save-CAtbi7NL.js";import{U as Tt}from"./user-CIJhs3Ar.js";import{_ as $t}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./useForwardExpose-DExeGtxo.js";import"./index-DF4e6W7v.js";import"./coins-gNw7Syml.js";import"./log-out-CwEw-MxT.js";import"./AppLogo.vue_vue_type_script_setup_true_lang-CZfY7_Y0.js";import"./library-DFzZ_wcn.js";import"./book-open-DTt_5lyB.js";import"./chevron-right-j5jojjre.js";import"./VisuallyHidden-A35wewYD.js";import"./Presence-8uqkmKQu.js";import"./CardContent.vue_vue_type_script_setup_true_lang-DTMY-zGL.js";import"./sun-CN57iDOP.js";import"./useNonce-CESPcQCj.js";import"./purify.es-DxJI3Wx7.js";import"./loader-circle-DYdv4uHQ.js";/**
 * @license lucide-vue-next v0.468.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const je=de("BookmarkPlusIcon",[["path",{d:"m19 21-7-4-7 4V5a2 2 0 0 1 2-2h10a2 2 0 0 1 2 2v16z",key:"1fy3hk"}],["line",{x1:"12",x2:"12",y1:"7",y2:"13",key:"1cppfj"}],["line",{x1:"15",x2:"9",y1:"10",y2:"10",key:"1gty7f"}]]);/**
 * @license lucide-vue-next v0.468.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const It=de("SendIcon",[["path",{d:"M14.536 21.686a.5.5 0 0 0 .937-.024l6.5-19a.496.496 0 0 0-.635-.635l-19 6.5a.5.5 0 0 0-.024.937l7.93 3.18a2 2 0 0 1 1.112 1.11z",key:"1ffxy3"}],["path",{d:"m21.854 2.147-10.94 10.939",key:"12cjpa"}]]);/**
 * @license lucide-vue-next v0.468.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const jt=de("SquareIcon",[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",key:"afitv7"}]]),Nt={class:"flex h-[calc(100vh-4rem)] min-h-0 overflow-hidden relative bg-background w-full"},Ot={class:"min-w-[20rem] h-full flex flex-col"},Dt={class:"p-4 border-b border-border/50"},Et={class:"flex items-center justify-between mb-4"},Rt={class:"flex items-center gap-2"},Ft={class:"p-1.5 bg-primary/10 rounded-md"},Mt={class:"font-semibold text-foreground tracking-tight"},Pt={class:"flex bg-muted rounded-lg p-1"},Lt={key:0,class:"p-3 space-y-2"},zt={key:0,class:"text-center py-10 text-muted-foreground text-sm flex flex-col items-center"},Vt=["onClick"],Bt={class:"flex items-center gap-2"},At={key:0,class:"text-[10px] text-muted-foreground font-medium"},Jt={key:1,class:"p-3 space-y-2"},Ut={key:0,class:"text-center py-10 text-muted-foreground text-sm flex flex-col items-center"},Wt=["onClick"],qt=["onKeydown"],Ht=["onClick"],Kt={key:1,class:"flex flex-col gap-1"},Xt={class:"flex items-start justify-between"},Gt={key:0,class:"flex items-center opacity-0 group-hover:opacity-100 transition-opacity absolute right-2 top-2 bg-card/80 backdrop-blur-sm rounded shadow-sm border border-border/50 p-0.5"},Qt=["onClick"],Yt=["onClick"],Zt={class:"flex items-center justify-between text-[10px] text-muted-foreground"},es={class:"flex items-center gap-1"},ts={class:"p-4 border-t border-border/50 bg-background/50 backdrop-blur-sm mt-auto"},ss={class:"flex-1 flex flex-col min-w-0 bg-background h-full relative z-0"},os={class:"h-16 flex-none border-b border-border/50 flex items-center justify-between px-4 sticky top-0 bg-background/80 backdrop-blur-md z-10 transition-all"},rs={class:"flex items-center gap-3 min-w-0"},ns={class:"flex flex-col min-w-0"},is={class:"flex items-center gap-2"},as={class:"text-[10px] text-muted-foreground truncate hidden sm:block"},ls={class:"flex items-center gap-2"},ds={class:"hidden md:flex flex-col items-end mr-2 cursor-help"},cs={class:"max-w-3xl mx-auto space-y-6 pb-4"},us={key:0,class:"mb-8 animate-in fade-in slide-in-from-top-4 duration-700"},ps={class:"rounded-xl border border-primary/20 bg-gradient-to-br from-primary/5 via-background to-background p-4 md:p-6 shadow-sm relative overflow-hidden group"},fs={class:"absolute top-0 right-0 p-3 opacity-10 group-hover:opacity-20 transition-opacity"},ms={class:"flex items-start gap-4 relative z-10"},vs={class:"p-2 bg-primary/10 rounded-lg text-primary mt-1 shrink-0"},gs={class:"min-w-0 flex-1 space-y-2"},bs={key:0,class:"h-8 w-8 rounded-full bg-primary/10 flex items-center justify-center shrink-0 border border-primary/20 self-start mt-1"},ys={class:"flex flex-col gap-1 max-w-[85%] md:max-w-[80%] min-w-0"},hs={key:0,class:"flex gap-1 items-center h-5 px-1"},xs={key:1,class:"markdown-body"},ws={key:0,class:"mt-4 pt-3 border-t border-border/30"},_s={class:"text-[10px] uppercase tracking-wider text-muted-foreground mb-2 flex items-center gap-1 font-semibold opacity-70"},ks={class:"flex flex-wrap gap-2"},Cs=["onClick"],Ss={class:"truncate"},Ts={key:1,class:"mt-4 pt-3 border-t border-border/30"},$s={class:"text-[10px] uppercase tracking-wider text-muted-foreground mb-2 flex items-center gap-1 font-semibold opacity-70"},Is={class:"flex flex-wrap gap-2"},js=["onClick"],Ns=["disabled"],Os={key:1,class:"h-8 w-8 rounded-full bg-muted flex items-center justify-center shrink-0 border border-border self-start mt-1"},Ds={class:"p-3 md:p-4 border-t border-border/50 bg-background/80 backdrop-blur-md sticky bottom-0 z-20"},Es={class:"max-w-3xl mx-auto relative flex flex-col gap-2"},Rs={class:"relative w-full"},Fs={class:"p-2 bg-primary/10 rounded-lg"},Ms={class:"space-y-4"},Ps={class:"space-y-2"},Ls={class:"space-y-2"},zs=qe({__name:"TopicsLab",props:{project:{},topics:{},sessionId:{},returnToSelection:{type:Boolean},historySessions:{},initialMessages:{},initialTopic:{}},setup(Ne){const p=Ne,g=v(p.initialTopic||(p.topics&&p.topics.length>0?p.topics[0]:null)),a=v(p.initialMessages||[]),j=v(""),S=v(!1),U=v(null),N=v(!1),x=v(!0),{formattedBalance:Oe,hasWords:De}=ht(),Z=v(!1),ee=()=>{typeof window>"u"||(N.value=window.innerWidth<1024,N.value=window.innerWidth<1024,window.innerWidth<1024||(x.value=!0))};He(()=>{ee(),window.addEventListener("resize",ee),M()}),Ke(()=>{window.removeEventListener("resize",ee)});const T=v((()=>{if(typeof window<"u"){const n=localStorage.getItem("topicsLab_sidebarMode");if(n==="topics"||n==="history")return n}return"topics"})());he(T,n=>{typeof window<"u"&&localStorage.setItem("topicsLab_sidebarMode",n)});const Ee=n=>{I.visit(k("topics.lab",{project:p.project.slug,session_id:n}))},ce=()=>{I.visit(k("topics.lab",{project:p.project.slug,new:"true"}))},Re=()=>{I.visit(k("projects.topics.index"))},Fe=()=>{I.visit(k("projects.topic-selection",p.project.slug))},W=v(null),D=v(""),Me=(n,e)=>{e.stopPropagation(),W.value=n.id,D.value=n.title},q=()=>{W.value=null,D.value=""},ue=async n=>{if(!D.value.trim()){q();return}try{(await fetch(k("topics.chat.rename",p.project.slug),{method:"POST",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":document.querySelector('meta[name="csrf-token"]')?.getAttribute("content")||""},body:JSON.stringify({session_id:n,name:D.value.trim()})})).ok?(u.success("Session renamed!"),I.reload()):u.error("Failed to rename session")}catch{u.error("Failed to rename session")}finally{q()}},te=v(!1),H=v(null),se=v(!1),Pe=n=>{H.value=n,se.value=!0},oe=()=>{se.value=!1,H.value=null},Le=async()=>{if(te.value||!H.value)return;const n=H.value;te.value=!0;try{(await fetch(k("topics.chat.delete-session",p.project.slug),{method:"DELETE",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":document.querySelector('meta[name="csrf-token"]')?.getAttribute("content")||""},body:JSON.stringify({session_id:n})})).ok?(u.success("Conversation deleted"),oe(),n===p.sessionId?ce():I.reload()):u.error("Failed to delete conversation")}catch{u.error("Failed to delete conversation")}finally{te.value=!1}},ze=async n=>{try{const e=n.replace(/<[^>]*>/g,"").replace(/&nbsp;/g," ").trim();await navigator.clipboard.writeText(e),u.success("Copied to clipboard")}catch{u.error("Failed to copy")}},K=v(!1),Ve=async()=>{if(K.value||!g.value)return;const n=a.value.filter(i=>i.role==="user");if(n.length===0){u.error("No message to regenerate");return}const e=a.value.findIndex(i=>i.id===n[n.length-1].id);e>=0&&e<a.value.length-1&&(a.value=a.value.slice(0,e+1)),K.value=!0;const t=Date.now().toString();a.value.push({id:t,role:"assistant",content:"",isTyping:!0}),M();try{const i=await fetch(k("topics.chat",p.project.slug),{method:"POST",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":document.querySelector('meta[name="csrf-token"]')?.getAttribute("content")||""},body:JSON.stringify({messages:a.value.filter(b=>!b.isTyping).map(b=>({role:b.role,content:b.content})),topic_context:g.value,session_id:p.sessionId})});if(!i.ok)throw new Error(`Server error: ${i.status}`);if(!i.body)throw new Error("No response body");const f=i.body.getReader(),$=new TextDecoder;let R="";for(;;){const{done:b,value:L}=await f.read();if(b)break;const ne=$.decode(L).split(`

`);for(const z of ne)if(z.startsWith("data: "))try{const V=JSON.parse(z.slice(6));if(V.content){R+=V.content;const O=a.value.findIndex(ie=>ie.id===t);O!==-1&&(a.value[O].content=R,a.value[O].isTyping=!1),M()}}catch{}}}catch(i){console.error("Regenerate error:",i),u.error("Failed to regenerate response"),a.value=a.value.filter(f=>f.id!==t)}finally{K.value=!1;const i=a.value.findIndex(f=>f.id===t);i!==-1&&(a.value[i].isTyping=!1)}};let E=null;const Be=()=>{E&&(E.abort(),E=null,S.value=!1,u.info("Generation stopped"))},M=async()=>{await xe(),U.value&&(U.value.scrollTop=U.value.scrollHeight)},pe=async()=>{if(!j.value.trim()||!g.value||S.value)return;const n={id:Date.now().toString(),role:"user",content:j.value.trim()};a.value.push(n),j.value="",S.value=!0,M();const e=(Date.now()+1).toString();a.value.push({id:e,role:"assistant",content:"",isTyping:!0}),E=new AbortController;try{const t=await fetch(k("topics.chat",p.project.slug),{method:"POST",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":document.querySelector('meta[name="csrf-token"]')?.getAttribute("content")||""},body:JSON.stringify({messages:a.value.filter(b=>!b.isTyping).map(b=>({role:b.role,content:b.content})),topic_context:g.value,session_id:p.sessionId}),signal:E.signal});if(t.status===402){const b=await t.json();u.error(b.message||"Insufficient word balance"),a.value=a.value.filter(L=>L.id!==e),S.value=!1;return}if(!t.ok)throw new Error(`Server error: ${t.status}`);if(!t.body)throw new Error("No response body");const i=t.body.getReader(),f=new TextDecoder;let $="";for(;;){const{done:b,value:L}=await i.read();if(b)break;const ne=f.decode(L).split(`

`);for(const z of ne)if(z.startsWith("data: "))try{const V=JSON.parse(z.slice(6));if(V.content){$+=V.content;const O=a.value.findIndex(ie=>ie.id===e);O!==-1&&(a.value[O].content=$,a.value[O].isTyping=!1),M()}}catch{}}const R=re($);R&&(ve.value=R,ge(R),u.success("Refined topic detected",{description:"The refined topic is ready to select."}))}catch(t){if(t.name==="AbortError"){const i=a.value.findIndex(f=>f.id===e);i!==-1&&(a.value[i].content?a.value[i].isTyping=!1:a.value.splice(i,1))}else console.error("Chat error:",t),u.error("Failed to get response")}finally{S.value=!1,E=null;const t=a.value.findIndex(i=>i.id===e);t!==-1&&(a.value[t].isTyping=!1)}},X=n=>{const e=document.createElement("DIV");return e.innerHTML=n,e.textContent||e.innerText||""};let fe=!0;he(g,n=>{if(n&&!Z.value){if(fe){fe=!1,a.value.length===0&&(a.value=[{id:"system-welcome",role:"assistant",content:`Hi! I see you're interested in **${X(n.title||"")}**. How can I help you refine or understand this topic better?`}]);return}a.value=[{id:"system-welcome-"+Date.now(),role:"assistant",content:`Hi! I see you're interested in **${X(n.title||"")}**. How can I help you refine or understand this topic better?`}]}},{immediate:!0});const P=v(!1),C=v({title:"",description:""}),G=v(!1),me=n=>{const e=[],t=/"([^"]{20,200})"/g;let i;for(;(i=t.exec(n))!==null;){const f=i[1].trim();!f.toLowerCase().startsWith("how ")&&!f.toLowerCase().startsWith("what ")&&!f.toLowerCase().startsWith("why ")&&f.length>30&&e.push(f)}return e},ve=v(null),ge=n=>{Z.value=!0,g.value=n,xe(()=>{Z.value=!1})},re=n=>{if(!n)return null;const e=n.match(/<REFINED_TOPIC_JSON>\s*([\s\S]*?)\s*<\/REFINED_TOPIC_JSON>/i);if(!e)return null;const t=e[1].trim();try{const i=JSON.parse(t),f=typeof i?.title=="string"?i.title.trim():"",$=typeof i?.description=="string"?i.description.trim():"";return f?{id:0,title:f,description:$,difficulty:"Intermediate",resource_level:"Medium",feasibility_score:75}:null}catch{return null}},be=async(n,e=!1)=>{const t=re(n);if(!t){u.error("No refined topic found in this message");return}ve.value=t,ge(t),e&&await ye()},Ae=n=>{C.value={title:n,description:""},P.value=!0},Je=async()=>{if(!C.value.title.trim()){u.error("Please enter a topic title");return}G.value=!0;try{(await fetch(k("topics.chat.save-topic",p.project.slug),{method:"POST",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":document.querySelector('meta[name="csrf-token"]')?.getAttribute("content")||""},body:JSON.stringify({title:C.value.title.trim(),description:C.value.description.trim(),session_id:p.sessionId})})).ok?(u.success("Topic saved successfully!"),P.value=!1,I.reload()):u.error("Failed to save topic")}catch{u.error("Failed to save topic")}finally{G.value=!1}},ye=async()=>{if(!g.value)return;const n=u.loading("Setting topic...");try{const e=X(g.value.title);if((await fetch(k("topics.select",p.project.slug),{method:"POST",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":document.querySelector('meta[name="csrf-token"]')?.getAttribute("content")||""},body:JSON.stringify({topic:e,title:e.substring(0,100),description:g.value.description})})).ok)u.dismiss(n),u.success("Topic selected successfully!"),I.visit(k("projects.topic-approval",p.project.slug));else throw new Error("Failed")}catch{u.dismiss(n),u.error("Failed to select topic")}},Ue=n=>{if(!n)return"";n=n.replace(/<REFINED_TOPIC_JSON>[\s\S]*?<\/REFINED_TOPIC_JSON>/gi,"").trim();let e=n.replace(/^### (.*$)/gim,"<strong>$1</strong>").replace(/^## (.*$)/gim,'<strong class="text-lg">$1</strong>').replace(/^# (.*$)/gim,'<strong class="text-xl">$1</strong>');return e=e.replace(/\*\*(.*?)\*\*/g,"<strong>$1</strong>"),e=e.replace(/^\s*-\s+(.*$)/gim,'<li class="ml-4 list-disc">$1</li>'),e=e.replace(/^\s*\d+\.\s+(.*$)/gim,'<li class="ml-4 list-decimal">$1</li>'),e=e.replace(/\n/g,"<br>"),e};return(n,e)=>(d(),c(B,null,[r(Ye,{title:"Topic Lab"},{default:l(()=>[s("div",Nt,[x.value&&N.value?(d(),c("div",{key:0,class:"absolute inset-0 bg-background/80 backdrop-blur-sm z-30 animate-in fade-in duration-200 lg:hidden",onClick:e[0]||(e[0]=t=>x.value=!1)})):y("",!0),s("aside",{class:w(["flex flex-col border-r border-border/50 bg-muted/10 transition-all duration-300 ease-in-out z-40 h-full","lg:relative absolute inset-y-0 left-0",x.value?"translate-x-0 w-80 shadow-2xl lg:shadow-none":"-translate-x-full lg:translate-x-0 lg:w-0 lg:border-none lg:overflow-hidden"])},[s("div",Ot,[s("div",Dt,[s("div",Et,[s("div",Rt,[s("div",Ft,[(d(),F(we(T.value==="topics"?o(J):o(ae)),{class:"h-4 w-4 text-primary"}))]),s("h2",Mt,_(T.value==="topics"?"Generated Topics":"History"),1)]),N.value?(d(),F(o(h),{key:0,variant:"ghost",size:"icon",onClick:e[1]||(e[1]=t=>x.value=!1),class:"h-8 w-8 lg:hidden"},{default:l(()=>[r(o(Ce),{class:"h-4 w-4"})]),_:1})):y("",!0)]),s("div",Pt,[s("button",{onClick:e[2]||(e[2]=t=>T.value="topics"),class:w(["flex-1 flex items-center justify-center gap-2 text-xs font-medium py-1.5 rounded-md transition-all",T.value==="topics"?"bg-background shadow-sm text-foreground":"text-muted-foreground hover:text-foreground"])},[r(o(J),{class:"h-3 w-3"}),e[14]||(e[14]=m(" Topics ",-1))],2),s("button",{onClick:e[3]||(e[3]=t=>T.value="history"),class:w(["flex-1 flex items-center justify-center gap-2 text-xs font-medium py-1.5 rounded-md transition-all",T.value==="history"?"bg-background shadow-sm text-foreground":"text-muted-foreground hover:text-foreground"])},[r(o(ae),{class:"h-3 w-3"}),e[15]||(e[15]=m(" History ",-1))],2)])]),r(o(et),{class:"flex-1 min-h-0"},{default:l(()=>[T.value==="topics"?(d(),c("div",Lt,[n.topics.length===0?(d(),c("div",zt,[r(o(J),{class:"h-8 w-8 mb-3 opacity-20"}),e[16]||(e[16]=s("p",null,"No topics available",-1))])):y("",!0),(d(!0),c(B,null,Q(n.topics,t=>(d(),c("div",{key:t.id,onClick:i=>{g.value=t,N.value&&(x.value=!1)},class:w(["p-3 rounded-lg cursor-pointer border transition-all text-left hover:border-primary/30 active:scale-[0.98]",g.value?.id===t.id?"bg-primary/5 border-primary/50 shadow-sm":"bg-card border-transparent hover:bg-card/80"])},[s("h3",{class:w(["text-sm font-medium mb-1.5 line-clamp-2 leading-snug",g.value?.id===t.id?"text-primary":"text-foreground"])},_(X(t.title)),3),s("div",Bt,[r(o(_e),{variant:"outline",class:"text-[10px] h-5 px-1.5 bg-background/50 font-normal border-primary/20"},{default:l(()=>[m(_(t.difficulty||"Intermediate"),1)]),_:2},1024),t.feasibility_score?(d(),c("span",At,_(t.feasibility_score)+"% match ",1)):y("",!0)])],10,Vt))),128))])):(d(),c("div",Jt,[r(o(h),{variant:"outline",class:"w-full mb-3 justify-start overflow-hidden bg-background/50 hover:bg-background border-dashed",onClick:ce},{default:l(()=>[r(o(xt),{class:"h-4 w-4 mr-2"}),e[17]||(e[17]=m(" New Conversation ",-1))]),_:1}),n.historySessions.length===0?(d(),c("div",Ut,[r(o(ae),{class:"h-8 w-8 mb-3 opacity-20"}),e[18]||(e[18]=s("p",null,"No previous conversations",-1))])):y("",!0),(d(!0),c(B,null,Q(n.historySessions,t=>(d(),c("div",{key:t.id,onClick:i=>W.value!==t.id&&(Ee(t.id),N.value?x.value=!1:null),class:w(["p-3 rounded-lg cursor-pointer border transition-all text-left hover:border-primary/30 group relative",p.sessionId===t.id?"bg-primary/5 border-primary/50 shadow-sm":"bg-card border-transparent hover:bg-card/80"])},[W.value===t.id?(d(),c("div",{key:0,class:"flex items-center gap-1",onClick:e[5]||(e[5]=A(()=>{},["stop"]))},[Xe(s("input",{"onUpdate:modelValue":e[4]||(e[4]=i=>D.value=i),class:"flex-1 text-sm px-2 py-1 h-7 bg-background border border-primary/50 rounded focus:outline-none focus:ring-1 focus:ring-primary w-full",onKeydown:[Y(i=>ue(t.id),["enter"]),Y(q,["escape"])],autofocus:""},null,40,qt),[[Ge,D.value]]),s("button",{onClick:i=>ue(t.id),class:"p-1 hover:bg-green-500/20 rounded text-green-500 shrink-0"},[r(o(wt),{class:"h-3.5 w-3.5"})],8,Ht),s("button",{onClick:q,class:"p-1 hover:bg-red-500/20 rounded text-red-500 shrink-0"},[r(o(_t),{class:"h-3.5 w-3.5"})])])):(d(),c("div",Kt,[s("div",Xt,[s("h3",{class:w(["text-sm font-medium line-clamp-1 break-all",p.sessionId===t.id?"text-primary":"text-foreground"])},_(t.title),3),p.sessionId===t.id||!N.value?(d(),c("div",Gt,[s("button",{onClick:A(i=>Me(t,i),["stop"]),class:"p-1.5 hover:bg-muted rounded text-muted-foreground hover:text-primary transition-colors"},[r(o(kt),{class:"h-3 w-3"})],8,Qt),s("button",{onClick:A(i=>Pe(t.id),["stop"]),class:"p-1.5 hover:bg-red-500/10 rounded text-muted-foreground hover:text-red-500 transition-colors"},[r(o(Se),{class:"h-3 w-3"})],8,Yt)])):y("",!0)]),s("div",Zt,[s("span",es,[r(o(Ct),{class:"h-3 w-3 opacity-70"}),m(" "+_(t.message_count),1)]),s("span",null,_(t.date),1)])]))],10,Wt))),128))]))]),_:1}),s("div",ts,[p.returnToSelection?(d(),F(o(h),{key:0,variant:"outline",class:"w-full justify-start overflow-hidden bg-background/50 hover:bg-background border-border/60 mb-2",onClick:Fe},{default:l(()=>[r(o(Te),{class:"mr-2 h-4 w-4"}),e[19]||(e[19]=m(" Back to Topic Selection ",-1))]),_:1})):y("",!0),r(o(h),{variant:"ghost",class:"w-full justify-start text-muted-foreground hover:text-foreground",onClick:Re},{default:l(()=>[r(o(Te),{class:"mr-2 h-4 w-4"}),e[20]||(e[20]=m(" Back to Library ",-1))]),_:1})])])],2),s("main",ss,[s("header",os,[s("div",rs,[r(o(h),{variant:"ghost",size:"icon",class:"shrink-0 -ml-2",onClick:e[6]||(e[6]=t=>x.value=!x.value),title:x.value?"Close sidebar":"Open sidebar"},{default:l(()=>[(d(),F(we(x.value?o(Ce):o(at)),{class:"h-5 w-5 text-muted-foreground"}))]),_:1},8,["title"]),s("div",ns,[s("div",is,[e[22]||(e[22]=s("h1",{class:"font-semibold text-foreground truncate text-sm md:text-base"}," Topic Laboratory ",-1)),r(o(_e),{variant:"secondary",class:"font-normal text-[10px] hidden sm:inline-flex bg-primary/10 text-primary border-transparent"},{default:l(()=>[...e[21]||(e[21]=[m(" AI Assistant ",-1)])]),_:1})]),s("span",as,_(n.project.title),1)])]),s("div",ls,[r(o(Qe),null,{default:l(()=>[r(o(gt),null,{default:l(()=>[r(o(bt),{"as-child":""},{default:l(()=>[s("div",ds,[e[23]||(e[23]=s("span",{class:"text-[10px] font-medium uppercase tracking-wider text-muted-foreground"},"Credits",-1)),s("span",{class:w(["text-xs font-bold",o(De)?"text-primary":"text-red-500"])},_(o(Oe)),3)])]),_:1}),r(o(yt),null,{default:l(()=>[...e[24]||(e[24]=[s("p",null,"Your word balance",-1)])]),_:1})]),_:1})]),_:1}),r(o(h),{disabled:!g.value||S.value,onClick:ye,class:"shadow-lg shadow-primary/20 h-9 px-4 text-xs md:text-sm"},{default:l(()=>[r(o($e),{class:"h-4 w-4 mr-2"}),e[25]||(e[25]=s("span",{class:"hidden sm:inline"},"Select Topic",-1)),e[26]||(e[26]=s("span",{class:"sm:hidden"},"Select",-1))]),_:1},8,["disabled"])])]),s("div",{class:"flex-1 overflow-y-auto px-4 py-6 scroll-smooth w-full",ref_key:"chatContainer",ref:U},[s("div",cs,[g.value?(d(),c("div",us,[s("div",ps,[s("div",fs,[r(o(J),{class:"w-12 h-12 text-primary rotate-12"})]),s("div",ms,[s("div",vs,[r(o(J),{class:"h-5 w-5"})]),s("div",gs,[r(le,{content:g.value.title,as:"h3",class:"text-base md:text-lg font-bold text-foreground leading-tight"},null,8,["content"]),r(le,{content:g.value.description,as:"div",class:"text-xs md:text-sm text-muted-foreground leading-relaxed pl-3 border-l-2 border-primary/20"},null,8,["content"])])])])])):y("",!0),a.value.length?(d(!0),c(B,{key:1},Q(a.value,t=>(d(),c("div",{key:t.id,class:w(["flex gap-3 animate-in fade-in slide-in-from-bottom-2",t.role==="user"?"justify-end":"justify-start"])},[t.role==="assistant"?(d(),c("div",bs,[r(o(St),{class:"h-4 w-4 text-primary"})])):y("",!0),s("div",ys,[s("div",{class:w(["rounded-2xl px-4 md:px-5 py-3 shadow-sm text-sm leading-relaxed overflow-hidden break-words",t.role==="user"?"bg-primary text-primary-foreground rounded-tr-none":"bg-muted/50 border border-border/50 text-foreground rounded-tl-none"])},[t.isTyping?(d(),c("div",hs,[...e[27]||(e[27]=[s("span",{class:"w-1.5 h-1.5 bg-current rounded-full animate-bounce",style:{"animation-delay":"0ms"}},null,-1),s("span",{class:"w-1.5 h-1.5 bg-current rounded-full animate-bounce",style:{"animation-delay":"150ms"}},null,-1),s("span",{class:"w-1.5 h-1.5 bg-current rounded-full animate-bounce",style:{"animation-delay":"300ms"}},null,-1)])])):(d(),c("div",xs,[r(le,{content:Ue(t.content)},null,8,["content"]),t.role==="assistant"&&me(t.content).length>0?(d(),c("div",ws,[s("div",_s,[r(o(je),{class:"h-3 w-3"}),e[28]||(e[28]=m(" Suggested Topics ",-1))]),s("div",ks,[(d(!0),c(B,null,Q(me(t.content),(i,f)=>(d(),c("button",{key:f,onClick:$=>Ae(i),class:"text-xs px-3 py-1.5 bg-background hover:bg-primary/10 text-primary border border-primary/20 hover:border-primary/50 rounded-full transition-all flex items-center gap-1.5 shadow-sm active:scale-95 text-left max-w-full"},[r(o(Ie),{class:"h-3 w-3 shrink-0"}),s("span",Ss,_(i),1)],8,Cs))),128))])])):y("",!0),t.role==="assistant"&&re(t.content)?(d(),c("div",Ts,[s("div",$s,[r(o($e),{class:"h-3 w-3"}),e[29]||(e[29]=m(" Refined Topic ",-1))]),s("div",Is,[r(o(h),{size:"sm",variant:"outline",class:"h-8",onClick:i=>be(t.content,!1)},{default:l(()=>[...e[30]||(e[30]=[m(" Use refined topic ",-1)])]),_:2},1032,["onClick"]),r(o(h),{size:"sm",class:"h-8",onClick:i=>be(t.content,!0)},{default:l(()=>[...e[31]||(e[31]=[m(" Select refined topic ",-1)])]),_:2},1032,["onClick"])])])):y("",!0)]))],2),t.isTyping?y("",!0):(d(),c("div",{key:0,class:w(["flex items-center gap-1 opacity-0 group-hover:opacity-100 transition-opacity",t.role==="user"?"justify-end":"justify-start ml-1"])},[s("button",{onClick:i=>ze(t.content),class:"text-[10px] text-muted-foreground hover:text-foreground p-1 transition-colors",title:"Copy"}," Copy ",8,js),t.role==="assistant"&&t.id===a.value.filter(i=>i.role==="assistant"&&!i.isTyping).slice(-1)[0]?.id?(d(),c("button",{key:0,onClick:Ve,disabled:K.value||S.value,class:"text-[10px] text-muted-foreground hover:text-foreground p-1 transition-colors flex items-center gap-1 disabled:opacity-50",title:"Regenerate"}," Regenerate ",8,Ns)):y("",!0)],2))]),t.role==="user"?(d(),c("div",Os,[r(o(Tt),{class:"h-4 w-4 text-muted-foreground"})])):y("",!0)],2))),128)):y("",!0)])],512),s("div",Ds,[s("div",Es,[s("div",Rs,[r(o(ke),{modelValue:j.value,"onUpdate:modelValue":e[7]||(e[7]=t=>j.value=t),placeholder:"Refine this topic, ask about methodologies, or check feasibility...",class:"min-h-[3rem] md:min-h-[3.5rem] max-h-32 pr-12 pl-4 py-3 bg-muted/40 hover:bg-muted/60 focus:bg-background focus:ring-1 focus:ring-primary/50 resize-none rounded-xl border-border/50 shadow-sm transition-all",onKeydown:[Y(A(pe,["exact","prevent"]),["enter"]),e[8]||(e[8]=Y(A(t=>j.value+=`
`,["shift","prevent"]),["enter"]))]},null,8,["modelValue","onKeydown"]),S.value?(d(),F(o(h),{key:0,class:"absolute right-2 bottom-2 h-8 w-8 rounded-lg bg-red-500 hover:bg-red-600 shadow-sm transition-transform hover:scale-105",size:"icon",onClick:Be,title:"Stop"},{default:l(()=>[r(o(jt),{class:"h-4 w-4 fill-current text-white"})]),_:1})):(d(),F(o(h),{key:1,class:"absolute right-2 bottom-2 h-8 w-8 rounded-lg shadow-sm transition-transform hover:scale-105",size:"icon",disabled:!j.value.trim()||!g.value,onClick:pe},{default:l(()=>[r(o(It),{class:"h-4 w-4"})]),_:1},8,["disabled"]))]),e[32]||(e[32]=s("p",{class:"text-center text-[10px] text-muted-foreground/70 select-none"}," AI may display inaccurate info. ",-1))])])])])]),_:1}),r(o(nt),{open:P.value,"onUpdate:open":e[12]||(e[12]=t=>P.value=t)},{default:l(()=>[r(o(tt),{class:"sm:max-w-[500px] gap-6"},{default:l(()=>[r(o(st),null,{default:l(()=>[r(o(ot),{class:"flex items-center gap-2"},{default:l(()=>[s("div",Fs,[r(o(je),{class:"h-5 w-5 text-primary"})]),e[33]||(e[33]=m(" Save Refined Topic ",-1))]),_:1}),r(o(rt),null,{default:l(()=>[...e[34]||(e[34]=[m(" Save this topic to your project's library. ",-1)])]),_:1})]),_:1}),s("div",Ms,[s("div",Ps,[e[35]||(e[35]=s("label",{class:"text-sm font-medium"},"Title",-1)),r(o(Ze),{modelValue:C.value.title,"onUpdate:modelValue":e[9]||(e[9]=t=>C.value.title=t),placeholder:"Topic title...",class:"w-full"},null,8,["modelValue"])]),s("div",Ls,[e[36]||(e[36]=s("label",{class:"text-sm font-medium"},"Description",-1)),r(o(ke),{modelValue:C.value.description,"onUpdate:modelValue":e[10]||(e[10]=t=>C.value.description=t),placeholder:"Optional description...",class:"resize-none",rows:"4"},null,8,["modelValue"])])]),r(o(it),null,{default:l(()=>[r(o(h),{variant:"outline",onClick:e[11]||(e[11]=t=>P.value=!1)},{default:l(()=>[...e[37]||(e[37]=[m("Cancel",-1)])]),_:1}),r(o(h),{onClick:Je,disabled:!C.value.title.trim()||G.value},{default:l(()=>[r(o(Ie),{class:"h-4 w-4 mr-2"}),m(" "+_(G.value?"Saving...":"Save"),1)]),_:1},8,["disabled"])]),_:1})]),_:1})]),_:1},8,["open"]),r(o(vt),{open:se.value,"onUpdate:open":e[13]||(e[13]=t=>{t||oe()})},{default:l(()=>[r(o(lt),null,{default:l(()=>[r(o(dt),null,{default:l(()=>[r(o(ct),{class:"flex items-center gap-2 text-destructive"},{default:l(()=>[r(o(Se),{class:"h-5 w-5"}),e[38]||(e[38]=m(" Delete Conversation ",-1))]),_:1}),r(o(ut),null,{default:l(()=>[...e[39]||(e[39]=[m(" Permanent action. Cannot be undone. ",-1)])]),_:1})]),_:1}),r(o(pt),null,{default:l(()=>[r(o(ft),{onClick:oe},{default:l(()=>[...e[40]||(e[40]=[m("Cancel",-1)])]),_:1}),r(o(mt),{onClick:Le,class:"bg-destructive hover:bg-destructive/90 text-destructive-foreground"},{default:l(()=>[...e[41]||(e[41]=[m(" Delete ",-1)])]),_:1})]),_:1})]),_:1})]),_:1},8,["open"])],64))}}),No=$t(zs,[["__scopeId","data-v-91477b9e"]]);export{No as default};
