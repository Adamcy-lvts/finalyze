import{bt as T,bs as p,du as j,ch as U,cm as y,cn as d,co as n,cp as o,bE as a,cq as t,cr as i,cs as l,cC as _,cH as b,cS as D,dh as P,ct as z,dm as A,dv as B,dw as L,cd as h,ck as C,ci as m}from"./vendor-B0P7kkmx.js";import{_ as O}from"./AdminLayout.vue_vue_type_script_setup_true_lang-B-851hYY.js";import{_ as q,a as K}from"./CardContent.vue_vue_type_script_setup_true_lang-Inj97kMy.js";import{_ as M}from"./CardDescription.vue_vue_type_script_setup_true_lang-DRGhurAy.js";import{_ as X,a as H}from"./CardTitle.vue_vue_type_script_setup_true_lang-mTag2pdV.js";import{_ as u}from"./index-CeE5dpwC.js";import{_ as $}from"./Input.vue_vue_type_script_setup_true_lang-0iIQAkgW.js";import{_ as J}from"./Label.vue_vue_type_script_setup_true_lang-DRSnzPnQ.js";import{_ as Q}from"./index-DoaZXG4c.js";import{_ as G,a as I}from"./DialogContent.vue_vue_type_script_setup_true_lang-BcLRXWRk.js";import{_ as W}from"./DialogDescription.vue_vue_type_script_setup_true_lang-CZgsL1-5.js";import{_ as Y}from"./DialogFooter.vue_vue_type_script_setup_true_lang-9Y22KIen.js";import{_ as Z,a as ee}from"./DialogTitle.vue_vue_type_script_setup_true_lang-BZjZPbYx.js";import"./Sonner.vue_vue_type_script_setup_true_lang-DEHww6d5.js";import"./UserInfo.vue_vue_type_script_setup_true_lang-mfygCHkH.js";import"./TooltipTrigger.vue_vue_type_script_setup_true_lang-j6BVOz2e.js";const te={class:"mb-6"},se={key:0,class:"text-center py-12 text-muted-foreground"},ae={key:1,class:"overflow-x-auto"},re={class:"w-full"},oe={class:"py-4 px-2"},ne={class:"font-medium"},le={class:"text-sm text-muted-foreground"},ie={class:"py-4 px-2"},de={class:"px-2 py-1 bg-muted rounded text-sm"},me={class:"py-4 px-2 text-center"},ue={class:"py-4 px-2 text-right font-medium text-green-600"},ce={class:"py-4 px-2 text-center"},fe={class:"flex items-center justify-center gap-2"},pe={class:"font-medium"},_e={class:"py-4 px-2 text-right"},ge={class:"flex items-center justify-end gap-2"},ve={key:2,class:"flex items-center justify-between mt-6"},xe={class:"text-sm text-muted-foreground"},ye={class:"flex gap-2"},be={class:"space-y-4 py-4"},he={class:"space-y-2"},Ce={class:"text-sm text-muted-foreground"},Be=T({__name:"Users",props:{referrers:{},defaultRate:{}},setup(R){const w=R,c=p(""),f=p(!1),g=p(null),v=p(!1),x=p({commission_rate:0}),S=j(()=>{h.get(C("admin.referrals.users"),{search:c.value},{preserveState:!0,replace:!0})},300);U(c,()=>{S()});const k=r=>{h.get(C("admin.referrals.users"),{page:r,search:c.value},{preserveState:!0})},E=r=>{g.value=r,x.value.commission_rate=r.commission_rate??w.defaultRate,f.value=!0},V=async()=>{if(g.value){v.value=!0;try{const e=await(await fetch(C("admin.referrals.update-user-rate",g.value.id),{method:"PUT",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":document.querySelector('meta[name="csrf-token"]')?.getAttribute("content")||""},body:JSON.stringify({commission_rate:x.value.commission_rate})})).json();e.success?(m.success(e.message||"Commission rate updated"),f.value=!1,h.reload({only:["referrers"]})):m.error(e.message||"Failed to update rate")}catch{m.error("Failed to update rate")}finally{v.value=!1}}},F=async r=>{try{const s=await(await fetch(C("admin.referrals.reset-user-rate",r.id),{method:"DELETE",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":document.querySelector('meta[name="csrf-token"]')?.getAttribute("content")||""}})).json();s.success?(m.success(s.message||"Rate reset to default"),h.reload({only:["referrers"]})):m.error(s.message||"Failed to reset rate")}catch{m.error("Failed to reset rate")}};return(r,e)=>(d(),y(O,{title:"Referral Partners",subtitle:"Manage referrers and their commission rates."},{default:n(()=>[o(a(q),{class:"border-border/50"},{default:n(()=>[o(a(X),{class:"flex flex-row items-center justify-between pb-4"},{default:n(()=>[t("div",null,[o(a(H),{class:"text-base"},{default:n(()=>[...e[6]||(e[6]=[i("All Referrers",-1)])]),_:1}),o(a(M),null,{default:n(()=>[i(" Default commission rate: "+l(r.defaultRate)+"%. Users with custom rates are highlighted. ",1)]),_:1})])]),_:1}),o(a(K),null,{default:n(()=>[t("div",te,[o(a($),{modelValue:c.value,"onUpdate:modelValue":e[0]||(e[0]=s=>c.value=s),placeholder:"Search by name, email, or referral code...",class:"max-w-md"},null,8,["modelValue"])]),r.referrers.data.length===0?(d(),_("div",se," No referrers found ")):(d(),_("div",ae,[t("table",re,[e[8]||(e[8]=t("thead",null,[t("tr",{class:"border-b border-border/50"},[t("th",{class:"text-left py-3 px-2 text-sm font-medium text-muted-foreground"},"User"),t("th",{class:"text-left py-3 px-2 text-sm font-medium text-muted-foreground"},"Referral Code"),t("th",{class:"text-center py-3 px-2 text-sm font-medium text-muted-foreground"},"Referrals"),t("th",{class:"text-right py-3 px-2 text-sm font-medium text-muted-foreground"},"Total Earned"),t("th",{class:"text-center py-3 px-2 text-sm font-medium text-muted-foreground"},"Commission Rate"),t("th",{class:"text-right py-3 px-2 text-sm font-medium text-muted-foreground"},"Actions")])],-1)),t("tbody",null,[(d(!0),_(D,null,P(r.referrers.data,s=>(d(),_("tr",{key:s.id,class:z(["border-b border-border/30",{"bg-primary/5":s.has_custom_rate}])},[t("td",oe,[t("div",null,[t("p",ne,l(s.name),1),t("p",le,l(s.email),1)])]),t("td",ie,[t("code",de,l(s.referral_code),1)]),t("td",me,l(s.total_referrals),1),t("td",ue,l(s.total_earned_formatted),1),t("td",ce,[t("div",fe,[t("span",pe,l(s.effective_rate)+"%",1),s.has_custom_rate?(d(),y(a(Q),{key:0,variant:"secondary",class:"text-xs"},{default:n(()=>[...e[7]||(e[7]=[i(" Custom ",-1)])]),_:1})):b("",!0)])]),t("td",_e,[t("div",ge,[o(a(u),{variant:"outline",size:"sm",onClick:N=>E(s)},{default:n(()=>[o(a(A),{class:"h-4 w-4"})]),_:2},1032,["onClick"]),s.has_custom_rate?(d(),y(a(u),{key:0,variant:"ghost",size:"sm",onClick:N=>F(s),title:"Reset to default"},{default:n(()=>[o(a(B),{class:"h-4 w-4"})]),_:2},1032,["onClick"])):b("",!0)])])],2))),128))])])])),r.referrers.last_page>1?(d(),_("div",ve,[t("p",xe," Page "+l(r.referrers.current_page)+" of "+l(r.referrers.last_page),1),t("div",ye,[o(a(u),{variant:"outline",size:"sm",disabled:r.referrers.current_page===1,onClick:e[1]||(e[1]=s=>k(r.referrers.current_page-1))},{default:n(()=>[...e[9]||(e[9]=[i(" Previous ",-1)])]),_:1},8,["disabled"]),o(a(u),{variant:"outline",size:"sm",disabled:r.referrers.current_page===r.referrers.last_page,onClick:e[2]||(e[2]=s=>k(r.referrers.current_page+1))},{default:n(()=>[...e[10]||(e[10]=[i(" Next ",-1)])]),_:1},8,["disabled"])])])):b("",!0)]),_:1})]),_:1}),o(a(G),{open:f.value,"onUpdate:open":e[5]||(e[5]=s=>f.value=s)},{default:n(()=>[o(a(I),null,{default:n(()=>[o(a(Z),null,{default:n(()=>[o(a(ee),null,{default:n(()=>[...e[11]||(e[11]=[i("Edit Commission Rate",-1)])]),_:1}),o(a(W),null,{default:n(()=>[i(" Set a custom commission rate for "+l(g.value?.name),1)]),_:1})]),_:1}),t("div",be,[t("div",he,[o(a(J),null,{default:n(()=>[...e[12]||(e[12]=[i("Commission Rate (%)",-1)])]),_:1}),o(a($),{modelValue:x.value.commission_rate,"onUpdate:modelValue":e[3]||(e[3]=s=>x.value.commission_rate=s),modelModifiers:{number:!0},type:"number",min:"0",max:"100",step:"0.5"},null,8,["modelValue"]),t("p",Ce," Default rate is "+l(r.defaultRate)+"%. Leave empty or set to default to use the global rate. ",1)])]),o(a(Y),null,{default:n(()=>[o(a(u),{variant:"outline",onClick:e[4]||(e[4]=s=>f.value=!1)},{default:n(()=>[...e[13]||(e[13]=[i(" Cancel ",-1)])]),_:1}),o(a(u),{onClick:V,disabled:v.value},{default:n(()=>[v.value?(d(),y(a(L),{key:0,class:"h-4 w-4 animate-spin mr-2"})):b("",!0),e[14]||(e[14]=i(" Save Rate ",-1))]),_:1},8,["disabled"])]),_:1})]),_:1})]),_:1},8,["open"])]),_:1}))}});export{Be as default};
